class PubSub{constructor(){this.events={}}on(r,o){let a=this;a.events||(a.events={}),a.events.hasOwnProperty(r)||(a.events[r]=[]),a.events[r].push(o)}emit(r,...o){let a=this;a.events||(a.events={}),a.events.hasOwnProperty(r)&&a.events[r].map(x=>x(...o))}off(r,o){if(this.events[r])if(o===void 0)this.events[r]=[];else{const a=this.events[r].indexOf(o);this.events[r].splice(a,1)}}}class Store{constructor(r){let o=this;o.actions={},o.mutations={},o.state=r.state,o.status="resting",o.events=new PubSub,r.hasOwnProperty("actions")&&(o.actions=r.actions),r.hasOwnProperty("mutations")&&(o.mutations=r.mutations)}dispatch(r,o){let a=this;return typeof a.actions[r]=="function"&&(console.groupCollapsed(`ACTION: ${r}`),a.status="action",a.actions[r](a,o),console.groupEnd(),!0)}commit(r,o){let a=this;if(typeof a.mutations[r]!="function")return console.log(`Mutation "${r}" doesn't exist`),!1;a.status="mutation";let x=a.mutations[r](a.state,o);return a.state=Object.assign(a.state,x),!0}}const options={state:{MxFun:null,Mxassembly:null,isCreateDrawObj:!1},actions:{},mutations:{}};for(let T in options.state){const r=T.charAt(0).toUpperCase()+T.slice(1);options.mutations["set"+r]=(o,a)=>{o[T]=a}}const store=new Store(options);function mxfun(){(function T(r,o,a){function x(I,H){if(!o[I]){if(!r[I]){var G=typeof require=="function"&&require;if(!H&&G)return G(I,!0);if(u)return u(I,!0);var L=new Error("Cannot find module '"+I+"'");throw L.code="MODULE_NOT_FOUND",L}var y=o[I]={exports:{}};r[I][0].call(y.exports,function(D){return x(r[I][1][D]||D)},y,y.exports,T,r,o,a)}return o[I].exports}for(var u=typeof require=="function"&&require,M=0;M<a.length;M++)x(a[M]);return x})({1:[function(T,r,o){var a={};(0,T("./lib/utils/common").assign)(a,T("./lib/deflate"),T("./lib/inflate"),T("./lib/zlib/constants")),r.exports=a},{"./lib/deflate":2,"./lib/inflate":3,"./lib/utils/common":4,"./lib/zlib/constants":7}],2:[function(T,r,o){var a=T("./zlib/deflate"),x=T("./utils/common"),u=T("./utils/strings"),M=T("./zlib/messages"),I=T("./zlib/zstream"),H=Object.prototype.toString;function G(y){if(!(this instanceof G))return new G(y);this.options=x.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},y||{});var D=this.options;D.raw&&0<D.windowBits?D.windowBits=-D.windowBits:D.gzip&&0<D.windowBits&&D.windowBits<16&&(D.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new I,this.strm.avail_out=0;var C=a.deflateInit2(this.strm,D.level,D.method,D.windowBits,D.memLevel,D.strategy);if(C!==0)throw new Error(M[C]);if(D.header&&a.deflateSetHeader(this.strm,D.header),D.dictionary){var B;if(B=typeof D.dictionary=="string"?u.string2buf(D.dictionary):H.call(D.dictionary)==="[object ArrayBuffer]"?new Uint8Array(D.dictionary):D.dictionary,(C=a.deflateSetDictionary(this.strm,B))!==0)throw new Error(M[C]);this._dict_set=!0}}function L(y,D){var C=new G(D);if(C.push(y,!0),C.err)throw C.msg||M[C.err];return C.result}G.prototype.push=function(y,D){var C,B,z=this.strm,A=this.options.chunkSize;if(this.ended)return!1;B=D===~~D?D:D===!0?4:0,typeof y=="string"?z.input=u.string2buf(y):H.call(y)==="[object ArrayBuffer]"?z.input=new Uint8Array(y):z.input=y,z.next_in=0,z.avail_in=z.input.length;do{if(z.avail_out===0&&(z.output=new x.Buf8(A),z.next_out=0,z.avail_out=A),(C=a.deflate(z,B))!==1&&C!==0)return this.onEnd(C),!(this.ended=!0);z.avail_out!==0&&(z.avail_in!==0||B!==4&&B!==2)||(this.options.to==="string"?this.onData(u.buf2binstring(x.shrinkBuf(z.output,z.next_out))):this.onData(x.shrinkBuf(z.output,z.next_out)))}while((0<z.avail_in||z.avail_out===0)&&C!==1);return B===4?(C=a.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===0):B!==2||(this.onEnd(0),!(z.avail_out=0))},G.prototype.onData=function(y){this.chunks.push(y)},G.prototype.onEnd=function(y){y===0&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=x.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},o.Deflate=G,o.deflate=L,o.deflateRaw=function(y,D){return(D=D||{}).raw=!0,L(y,D)},o.gzip=function(y,D){return(D=D||{}).gzip=!0,L(y,D)}},{"./utils/common":4,"./utils/strings":5,"./zlib/deflate":9,"./zlib/messages":14,"./zlib/zstream":16}],3:[function(T,r,o){var a=T("./zlib/inflate"),x=T("./utils/common"),u=T("./utils/strings"),M=T("./zlib/constants"),I=T("./zlib/messages"),H=T("./zlib/zstream"),G=T("./zlib/gzheader"),L=Object.prototype.toString;function y(C){if(!(this instanceof y))return new y(C);this.options=x.assign({chunkSize:16384,windowBits:0,to:""},C||{});var B=this.options;B.raw&&0<=B.windowBits&&B.windowBits<16&&(B.windowBits=-B.windowBits,B.windowBits===0&&(B.windowBits=-15)),!(0<=B.windowBits&&B.windowBits<16)||C&&C.windowBits||(B.windowBits+=32),15<B.windowBits&&B.windowBits<48&&!(15&B.windowBits)&&(B.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new H,this.strm.avail_out=0;var z=a.inflateInit2(this.strm,B.windowBits);if(z!==M.Z_OK)throw new Error(I[z]);if(this.header=new G,a.inflateGetHeader(this.strm,this.header),B.dictionary&&(typeof B.dictionary=="string"?B.dictionary=u.string2buf(B.dictionary):L.call(B.dictionary)==="[object ArrayBuffer]"&&(B.dictionary=new Uint8Array(B.dictionary)),B.raw&&(z=a.inflateSetDictionary(this.strm,B.dictionary))!==M.Z_OK))throw new Error(I[z])}function D(C,B){var z=new y(B);if(z.push(C,!0),z.err)throw z.msg||I[z.err];return z.result}y.prototype.push=function(C,B){var z,A,S,q,W,_=this.strm,R=this.options.chunkSize,v=this.options.dictionary,V=!1;if(this.ended)return!1;A=B===~~B?B:B===!0?M.Z_FINISH:M.Z_NO_FLUSH,typeof C=="string"?_.input=u.binstring2buf(C):L.call(C)==="[object ArrayBuffer]"?_.input=new Uint8Array(C):_.input=C,_.next_in=0,_.avail_in=_.input.length;do{if(_.avail_out===0&&(_.output=new x.Buf8(R),_.next_out=0,_.avail_out=R),(z=a.inflate(_,M.Z_NO_FLUSH))===M.Z_NEED_DICT&&v&&(z=a.inflateSetDictionary(this.strm,v)),z===M.Z_BUF_ERROR&&V===!0&&(z=M.Z_OK,V=!1),z!==M.Z_STREAM_END&&z!==M.Z_OK)return this.onEnd(z),!(this.ended=!0);_.next_out&&(_.avail_out!==0&&z!==M.Z_STREAM_END&&(_.avail_in!==0||A!==M.Z_FINISH&&A!==M.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=u.utf8border(_.output,_.next_out),q=_.next_out-S,W=u.buf2string(_.output,S),_.next_out=q,_.avail_out=R-q,q&&x.arraySet(_.output,_.output,S,q,0),this.onData(W)):this.onData(x.shrinkBuf(_.output,_.next_out)))),_.avail_in===0&&_.avail_out===0&&(V=!0)}while((0<_.avail_in||_.avail_out===0)&&z!==M.Z_STREAM_END);return z===M.Z_STREAM_END&&(A=M.Z_FINISH),A===M.Z_FINISH?(z=a.inflateEnd(this.strm),this.onEnd(z),this.ended=!0,z===M.Z_OK):A!==M.Z_SYNC_FLUSH||(this.onEnd(M.Z_OK),!(_.avail_out=0))},y.prototype.onData=function(C){this.chunks.push(C)},y.prototype.onEnd=function(C){C===M.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=x.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},o.Inflate=y,o.inflate=D,o.inflateRaw=function(C,B){return(B=B||{}).raw=!0,D(C,B)},o.ungzip=D},{"./utils/common":4,"./utils/strings":5,"./zlib/constants":7,"./zlib/gzheader":10,"./zlib/inflate":12,"./zlib/messages":14,"./zlib/zstream":16}],4:[function(T,r,o){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(M){for(var I,H,G=Array.prototype.slice.call(arguments,1);G.length;){var L=G.shift();if(L){if(typeof L!="object")throw new TypeError(L+"must be non-object");for(var y in L)I=L,H=y,Object.prototype.hasOwnProperty.call(I,H)&&(M[y]=L[y])}}return M},o.shrinkBuf=function(M,I){return M.length===I?M:M.subarray?M.subarray(0,I):(M.length=I,M)};var x={arraySet:function(M,I,H,G,L){if(I.subarray&&M.subarray)M.set(I.subarray(H,H+G),L);else for(var y=0;y<G;y++)M[L+y]=I[H+y]},flattenChunks:function(M){var I,H,G,L,y,D;for(I=G=0,H=M.length;I<H;I++)G+=M[I].length;for(D=new Uint8Array(G),I=L=0,H=M.length;I<H;I++)y=M[I],D.set(y,L),L+=y.length;return D}},u={arraySet:function(M,I,H,G,L){for(var y=0;y<G;y++)M[L+y]=I[H+y]},flattenChunks:function(M){return[].concat.apply([],M)}};o.setTyped=function(M){M?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,x)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,u))},o.setTyped(a)},{}],5:[function(T,r,o){var a=T("./common"),x=!0,u=!0;try{String.fromCharCode.apply(null,[0])}catch{x=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{u=!1}for(var M=new a.Buf8(256),I=0;I<256;I++)M[I]=252<=I?6:248<=I?5:240<=I?4:224<=I?3:192<=I?2:1;function H(G,L){if(L<65534&&(G.subarray&&u||!G.subarray&&x))return String.fromCharCode.apply(null,a.shrinkBuf(G,L));for(var y="",D=0;D<L;D++)y+=String.fromCharCode(G[D]);return y}M[254]=M[254]=1,o.string2buf=function(G){var L,y,D,C,B,z=G.length,A=0;for(C=0;C<z;C++)(64512&(y=G.charCodeAt(C)))==55296&&C+1<z&&(64512&(D=G.charCodeAt(C+1)))==56320&&(y=65536+(y-55296<<10)+(D-56320),C++),A+=y<128?1:y<2048?2:y<65536?3:4;for(L=new a.Buf8(A),C=B=0;B<A;C++)(64512&(y=G.charCodeAt(C)))==55296&&C+1<z&&(64512&(D=G.charCodeAt(C+1)))==56320&&(y=65536+(y-55296<<10)+(D-56320),C++),y<128?L[B++]=y:(y<2048?L[B++]=192|y>>>6:(y<65536?L[B++]=224|y>>>12:(L[B++]=240|y>>>18,L[B++]=128|y>>>12&63),L[B++]=128|y>>>6&63),L[B++]=128|63&y);return L},o.buf2binstring=function(G){return H(G,G.length)},o.binstring2buf=function(G){for(var L=new a.Buf8(G.length),y=0,D=L.length;y<D;y++)L[y]=G.charCodeAt(y);return L},o.buf2string=function(G,L){var y,D,C,B,z=L||G.length,A=new Array(2*z);for(y=D=0;y<z;)if((C=G[y++])<128)A[D++]=C;else if(4<(B=M[C]))A[D++]=65533,y+=B-1;else{for(C&=B===2?31:B===3?15:7;1<B&&y<z;)C=C<<6|63&G[y++],B--;1<B?A[D++]=65533:C<65536?A[D++]=C:(C-=65536,A[D++]=55296|C>>10&1023,A[D++]=56320|1023&C)}return H(A,D)},o.utf8border=function(G,L){var y;for((L=L||G.length)>G.length&&(L=G.length),y=L-1;0<=y&&(192&G[y])==128;)y--;return!(y<0)&&y!==0&&y+M[G[y]]>L?y:L}},{"./common":4}],6:[function(T,r,o){r.exports=function(a,x,u,M){for(var I=65535&a,H=a>>>16&65535,G=0;u!==0;){for(u-=G=2e3<u?2e3:u;H=H+(I=I+x[M++]|0)|0,--G;);I%=65521,H%=65521}return I|H<<16}},{}],7:[function(T,r,o){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],8:[function(T,r,o){var a=function(){for(var x,u=[],M=0;M<256;M++){x=M;for(var I=0;I<8;I++)x=1&x?3988292384^x>>>1:x>>>1;u[M]=x}return u}();r.exports=function(x,u,M,I){var H=a,G=I+M;x^=-1;for(var L=I;L<G;L++)x=x>>>8^H[255&(x^u[L])];return~x}},{}],9:[function(T,r,o){var a,x=T("../utils/common"),u=T("./trees"),M=T("./adler32"),I=T("./crc32"),H=T("./messages"),G=-2,L=258,y=262,D=113;function C(f,N){return f.msg=H[N],N}function B(f){return(f<<1)-(4<f?9:0)}function z(f){for(var N=f.length;0<=--N;)f[N]=0}function A(f){var N=f.state,P=N.pending;P>f.avail_out&&(P=f.avail_out),P!==0&&(x.arraySet(f.output,N.pending_buf,N.pending_out,P,f.next_out),f.next_out+=P,N.pending_out+=P,f.total_out+=P,f.avail_out-=P,N.pending-=P,N.pending===0&&(N.pending_out=0))}function S(f,N){u._tr_flush_block(f,0<=f.block_start?f.block_start:-1,f.strstart-f.block_start,N),f.block_start=f.strstart,A(f.strm)}function q(f,N){f.pending_buf[f.pending++]=N}function W(f,N){f.pending_buf[f.pending++]=N>>>8&255,f.pending_buf[f.pending++]=255&N}function _(f,N){var P,O,Z=f.max_chain_length,te=f.strstart,de=f.prev_length,me=f.nice_match,we=f.strstart>f.w_size-y?f.strstart-(f.w_size-y):0,ge=f.window,Le=f.w_mask,Pe=f.prev,ae=f.strstart+L,ve=ge[te+de-1],Ie=ge[te+de];f.prev_length>=f.good_match&&(Z>>=2),me>f.lookahead&&(me=f.lookahead);do if(ge[(P=N)+de]===Ie&&ge[P+de-1]===ve&&ge[P]===ge[te]&&ge[++P]===ge[te+1]){te+=2,P++;do;while(ge[++te]===ge[++P]&&ge[++te]===ge[++P]&&ge[++te]===ge[++P]&&ge[++te]===ge[++P]&&ge[++te]===ge[++P]&&ge[++te]===ge[++P]&&ge[++te]===ge[++P]&&ge[++te]===ge[++P]&&te<ae);if(O=L-(ae-te),te=ae-L,de<O){if(f.match_start=N,me<=(de=O))break;ve=ge[te+de-1],Ie=ge[te+de]}}while((N=Pe[N&Le])>we&&--Z!=0);return de<=f.lookahead?de:f.lookahead}function R(f){var N,P,O,Z,te,de,me,we,ge,Le,Pe=f.w_size;do{if(Z=f.window_size-f.lookahead-f.strstart,f.strstart>=Pe+(Pe-y)){for(x.arraySet(f.window,f.window,Pe,Pe,0),f.match_start-=Pe,f.strstart-=Pe,f.block_start-=Pe,N=P=f.hash_size;O=f.head[--N],f.head[N]=Pe<=O?O-Pe:0,--P;);for(N=P=Pe;O=f.prev[--N],f.prev[N]=Pe<=O?O-Pe:0,--P;);Z+=Pe}if(f.strm.avail_in===0)break;if(de=f.strm,me=f.window,we=f.strstart+f.lookahead,Le=void 0,(ge=Z)<(Le=de.avail_in)&&(Le=ge),P=Le===0?0:(de.avail_in-=Le,x.arraySet(me,de.input,de.next_in,Le,we),de.state.wrap===1?de.adler=M(de.adler,me,Le,we):de.state.wrap===2&&(de.adler=I(de.adler,me,Le,we)),de.next_in+=Le,de.total_in+=Le,Le),f.lookahead+=P,f.lookahead+f.insert>=3)for(te=f.strstart-f.insert,f.ins_h=f.window[te],f.ins_h=(f.ins_h<<f.hash_shift^f.window[te+1])&f.hash_mask;f.insert&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[te+3-1])&f.hash_mask,f.prev[te&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=te,te++,f.insert--,!(f.lookahead+f.insert<3)););}while(f.lookahead<y&&f.strm.avail_in!==0)}function v(f,N){for(var P,O;;){if(f.lookahead<y){if(R(f),f.lookahead<y&&N===0)return 1;if(f.lookahead===0)break}if(P=0,f.lookahead>=3&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+3-1])&f.hash_mask,P=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),P!==0&&f.strstart-P<=f.w_size-y&&(f.match_length=_(f,P)),f.match_length>=3)if(O=u._tr_tally(f,f.strstart-f.match_start,f.match_length-3),f.lookahead-=f.match_length,f.match_length<=f.max_lazy_match&&f.lookahead>=3){for(f.match_length--;f.strstart++,f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+3-1])&f.hash_mask,P=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart,--f.match_length!=0;);f.strstart++}else f.strstart+=f.match_length,f.match_length=0,f.ins_h=f.window[f.strstart],f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+1])&f.hash_mask;else O=u._tr_tally(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++;if(O&&(S(f,!1),f.strm.avail_out===0))return 1}return f.insert=f.strstart<2?f.strstart:2,N===4?(S(f,!0),f.strm.avail_out===0?3:4):f.last_lit&&(S(f,!1),f.strm.avail_out===0)?1:2}function V(f,N){for(var P,O,Z;;){if(f.lookahead<y){if(R(f),f.lookahead<y&&N===0)return 1;if(f.lookahead===0)break}if(P=0,f.lookahead>=3&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+3-1])&f.hash_mask,P=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),f.prev_length=f.match_length,f.prev_match=f.match_start,f.match_length=2,P!==0&&f.prev_length<f.max_lazy_match&&f.strstart-P<=f.w_size-y&&(f.match_length=_(f,P),f.match_length<=5&&(f.strategy===1||f.match_length===3&&4096<f.strstart-f.match_start)&&(f.match_length=2)),f.prev_length>=3&&f.match_length<=f.prev_length){for(Z=f.strstart+f.lookahead-3,O=u._tr_tally(f,f.strstart-1-f.prev_match,f.prev_length-3),f.lookahead-=f.prev_length-1,f.prev_length-=2;++f.strstart<=Z&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+3-1])&f.hash_mask,P=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),--f.prev_length!=0;);if(f.match_available=0,f.match_length=2,f.strstart++,O&&(S(f,!1),f.strm.avail_out===0))return 1}else if(f.match_available){if((O=u._tr_tally(f,0,f.window[f.strstart-1]))&&S(f,!1),f.strstart++,f.lookahead--,f.strm.avail_out===0)return 1}else f.match_available=1,f.strstart++,f.lookahead--}return f.match_available&&(O=u._tr_tally(f,0,f.window[f.strstart-1]),f.match_available=0),f.insert=f.strstart<2?f.strstart:2,N===4?(S(f,!0),f.strm.avail_out===0?3:4):f.last_lit&&(S(f,!1),f.strm.avail_out===0)?1:2}function Y(f,N,P,O,Z){this.good_length=f,this.max_lazy=N,this.nice_length=P,this.max_chain=O,this.func=Z}function c(f){var N;return f&&f.state?(f.total_in=f.total_out=0,f.data_type=2,(N=f.state).pending=0,N.pending_out=0,N.wrap<0&&(N.wrap=-N.wrap),N.status=N.wrap?42:D,f.adler=N.wrap===2?0:1,N.last_flush=0,u._tr_init(N),0):C(f,G)}function p(f){var N,P=c(f);return P===0&&((N=f.state).window_size=2*N.w_size,z(N.head),N.max_lazy_match=a[N.level].max_lazy,N.good_match=a[N.level].good_length,N.nice_match=a[N.level].nice_length,N.max_chain_length=a[N.level].max_chain,N.strstart=0,N.block_start=0,N.lookahead=0,N.insert=0,N.match_length=N.prev_length=2,N.match_available=0,N.ins_h=0),P}function m(f,N,P,O,Z,te){if(!f)return G;var de=1;if(N===-1&&(N=6),O<0?(de=0,O=-O):15<O&&(de=2,O-=16),Z<1||9<Z||P!==8||O<8||15<O||N<0||9<N||te<0||4<te)return C(f,G);O===8&&(O=9);var me=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new x.Buf16(1146),this.dyn_dtree=new x.Buf16(122),this.bl_tree=new x.Buf16(78),z(this.dyn_ltree),z(this.dyn_dtree),z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new x.Buf16(16),this.heap=new x.Buf16(573),z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new x.Buf16(573),z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return(f.state=me).strm=f,me.wrap=de,me.gzhead=null,me.w_bits=O,me.w_size=1<<me.w_bits,me.w_mask=me.w_size-1,me.hash_bits=Z+7,me.hash_size=1<<me.hash_bits,me.hash_mask=me.hash_size-1,me.hash_shift=~~((me.hash_bits+3-1)/3),me.window=new x.Buf8(2*me.w_size),me.head=new x.Buf16(me.hash_size),me.prev=new x.Buf16(me.w_size),me.lit_bufsize=1<<Z+6,me.pending_buf_size=4*me.lit_bufsize,me.pending_buf=new x.Buf8(me.pending_buf_size),me.d_buf=+me.lit_bufsize,me.l_buf=3*me.lit_bufsize,me.level=N,me.strategy=te,me.method=P,p(f)}a=[new Y(0,0,0,0,function(f,N){var P=65535;for(P>f.pending_buf_size-5&&(P=f.pending_buf_size-5);;){if(f.lookahead<=1){if(R(f),f.lookahead===0&&N===0)return 1;if(f.lookahead===0)break}f.strstart+=f.lookahead,f.lookahead=0;var O=f.block_start+P;if((f.strstart===0||f.strstart>=O)&&(f.lookahead=f.strstart-O,f.strstart=O,S(f,!1),f.strm.avail_out===0)||f.strstart-f.block_start>=f.w_size-y&&(S(f,!1),f.strm.avail_out===0))return 1}return f.insert=0,N===4?(S(f,!0),f.strm.avail_out===0?3:4):(f.strstart>f.block_start&&(S(f,!1),f.strm.avail_out),1)}),new Y(4,4,8,4,v),new Y(4,5,16,8,v),new Y(4,6,32,32,v),new Y(4,4,16,16,V),new Y(8,16,32,32,V),new Y(8,16,128,128,V),new Y(8,32,128,256,V),new Y(32,128,258,1024,V),new Y(32,258,258,4096,V)],o.deflateInit=function(f,N){return m(f,N,8,15,8,0)},o.deflateInit2=m,o.deflateReset=p,o.deflateResetKeep=c,o.deflateSetHeader=function(f,N){return f&&f.state&&f.state.wrap===2?(f.state.gzhead=N,0):G},o.deflate=function(f,N){var P,O,Z,te;if(!f||!f.state||5<N||N<0)return f?C(f,G):G;if(O=f.state,!f.output||!f.input&&f.avail_in!==0||O.status===666&&N!==4)return C(f,f.avail_out===0?-5:G);if(O.strm=f,P=O.last_flush,O.last_flush=N,O.status===42)if(O.wrap===2)f.adler=0,q(O,31),q(O,139),q(O,8),O.gzhead?(q(O,(O.gzhead.text?1:0)+(O.gzhead.hcrc?2:0)+(O.gzhead.extra?4:0)+(O.gzhead.name?8:0)+(O.gzhead.comment?16:0)),q(O,255&O.gzhead.time),q(O,O.gzhead.time>>8&255),q(O,O.gzhead.time>>16&255),q(O,O.gzhead.time>>24&255),q(O,O.level===9?2:2<=O.strategy||O.level<2?4:0),q(O,255&O.gzhead.os),O.gzhead.extra&&O.gzhead.extra.length&&(q(O,255&O.gzhead.extra.length),q(O,O.gzhead.extra.length>>8&255)),O.gzhead.hcrc&&(f.adler=I(f.adler,O.pending_buf,O.pending,0)),O.gzindex=0,O.status=69):(q(O,0),q(O,0),q(O,0),q(O,0),q(O,0),q(O,O.level===9?2:2<=O.strategy||O.level<2?4:0),q(O,3),O.status=D);else{var de=8+(O.w_bits-8<<4)<<8;de|=(2<=O.strategy||O.level<2?0:O.level<6?1:O.level===6?2:3)<<6,O.strstart!==0&&(de|=32),de+=31-de%31,O.status=D,W(O,de),O.strstart!==0&&(W(O,f.adler>>>16),W(O,65535&f.adler)),f.adler=1}if(O.status===69)if(O.gzhead.extra){for(Z=O.pending;O.gzindex<(65535&O.gzhead.extra.length)&&(O.pending!==O.pending_buf_size||(O.gzhead.hcrc&&O.pending>Z&&(f.adler=I(f.adler,O.pending_buf,O.pending-Z,Z)),A(f),Z=O.pending,O.pending!==O.pending_buf_size));)q(O,255&O.gzhead.extra[O.gzindex]),O.gzindex++;O.gzhead.hcrc&&O.pending>Z&&(f.adler=I(f.adler,O.pending_buf,O.pending-Z,Z)),O.gzindex===O.gzhead.extra.length&&(O.gzindex=0,O.status=73)}else O.status=73;if(O.status===73)if(O.gzhead.name){Z=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>Z&&(f.adler=I(f.adler,O.pending_buf,O.pending-Z,Z)),A(f),Z=O.pending,O.pending===O.pending_buf_size)){te=1;break}te=O.gzindex<O.gzhead.name.length?255&O.gzhead.name.charCodeAt(O.gzindex++):0,q(O,te)}while(te!==0);O.gzhead.hcrc&&O.pending>Z&&(f.adler=I(f.adler,O.pending_buf,O.pending-Z,Z)),te===0&&(O.gzindex=0,O.status=91)}else O.status=91;if(O.status===91)if(O.gzhead.comment){Z=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>Z&&(f.adler=I(f.adler,O.pending_buf,O.pending-Z,Z)),A(f),Z=O.pending,O.pending===O.pending_buf_size)){te=1;break}te=O.gzindex<O.gzhead.comment.length?255&O.gzhead.comment.charCodeAt(O.gzindex++):0,q(O,te)}while(te!==0);O.gzhead.hcrc&&O.pending>Z&&(f.adler=I(f.adler,O.pending_buf,O.pending-Z,Z)),te===0&&(O.status=103)}else O.status=103;if(O.status===103&&(O.gzhead.hcrc?(O.pending+2>O.pending_buf_size&&A(f),O.pending+2<=O.pending_buf_size&&(q(O,255&f.adler),q(O,f.adler>>8&255),f.adler=0,O.status=D)):O.status=D),O.pending!==0){if(A(f),f.avail_out===0)return O.last_flush=-1,0}else if(f.avail_in===0&&B(N)<=B(P)&&N!==4)return C(f,-5);if(O.status===666&&f.avail_in!==0)return C(f,-5);if(f.avail_in!==0||O.lookahead!==0||N!==0&&O.status!==666){var me=O.strategy===2?function(we,ge){for(var Le;;){if(we.lookahead===0&&(R(we),we.lookahead===0)){if(ge===0)return 1;break}if(we.match_length=0,Le=u._tr_tally(we,0,we.window[we.strstart]),we.lookahead--,we.strstart++,Le&&(S(we,!1),we.strm.avail_out===0))return 1}return we.insert=0,ge===4?(S(we,!0),we.strm.avail_out===0?3:4):we.last_lit&&(S(we,!1),we.strm.avail_out===0)?1:2}(O,N):O.strategy===3?function(we,ge){for(var Le,Pe,ae,ve,Ie=we.window;;){if(we.lookahead<=L){if(R(we),we.lookahead<=L&&ge===0)return 1;if(we.lookahead===0)break}if(we.match_length=0,we.lookahead>=3&&0<we.strstart&&(Pe=Ie[ae=we.strstart-1])===Ie[++ae]&&Pe===Ie[++ae]&&Pe===Ie[++ae]){ve=we.strstart+L;do;while(Pe===Ie[++ae]&&Pe===Ie[++ae]&&Pe===Ie[++ae]&&Pe===Ie[++ae]&&Pe===Ie[++ae]&&Pe===Ie[++ae]&&Pe===Ie[++ae]&&Pe===Ie[++ae]&&ae<ve);we.match_length=L-(ve-ae),we.match_length>we.lookahead&&(we.match_length=we.lookahead)}if(we.match_length>=3?(Le=u._tr_tally(we,1,we.match_length-3),we.lookahead-=we.match_length,we.strstart+=we.match_length,we.match_length=0):(Le=u._tr_tally(we,0,we.window[we.strstart]),we.lookahead--,we.strstart++),Le&&(S(we,!1),we.strm.avail_out===0))return 1}return we.insert=0,ge===4?(S(we,!0),we.strm.avail_out===0?3:4):we.last_lit&&(S(we,!1),we.strm.avail_out===0)?1:2}(O,N):a[O.level].func(O,N);if(me!==3&&me!==4||(O.status=666),me===1||me===3)return f.avail_out===0&&(O.last_flush=-1),0;if(me===2&&(N===1?u._tr_align(O):N!==5&&(u._tr_stored_block(O,0,0,!1),N===3&&(z(O.head),O.lookahead===0&&(O.strstart=0,O.block_start=0,O.insert=0))),A(f),f.avail_out===0))return O.last_flush=-1,0}return N!==4?0:O.wrap<=0?1:(O.wrap===2?(q(O,255&f.adler),q(O,f.adler>>8&255),q(O,f.adler>>16&255),q(O,f.adler>>24&255),q(O,255&f.total_in),q(O,f.total_in>>8&255),q(O,f.total_in>>16&255),q(O,f.total_in>>24&255)):(W(O,f.adler>>>16),W(O,65535&f.adler)),A(f),0<O.wrap&&(O.wrap=-O.wrap),O.pending!==0?0:1)},o.deflateEnd=function(f){var N;return f&&f.state?(N=f.state.status)!==42&&N!==69&&N!==73&&N!==91&&N!==103&&N!==D&&N!==666?C(f,G):(f.state=null,N===D?C(f,-3):0):G},o.deflateSetDictionary=function(f,N){var P,O,Z,te,de,me,we,ge,Le=N.length;if(!f||!f.state||(te=(P=f.state).wrap)===2||te===1&&P.status!==42||P.lookahead)return G;for(te===1&&(f.adler=M(f.adler,N,Le,0)),P.wrap=0,Le>=P.w_size&&(te===0&&(z(P.head),P.strstart=0,P.block_start=0,P.insert=0),ge=new x.Buf8(P.w_size),x.arraySet(ge,N,Le-P.w_size,P.w_size,0),N=ge,Le=P.w_size),de=f.avail_in,me=f.next_in,we=f.input,f.avail_in=Le,f.next_in=0,f.input=N,R(P);P.lookahead>=3;){for(O=P.strstart,Z=P.lookahead-2;P.ins_h=(P.ins_h<<P.hash_shift^P.window[O+3-1])&P.hash_mask,P.prev[O&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=O,O++,--Z;);P.strstart=O,P.lookahead=2,R(P)}return P.strstart+=P.lookahead,P.block_start=P.strstart,P.insert=P.lookahead,P.lookahead=0,P.match_length=P.prev_length=2,P.match_available=0,f.next_in=me,f.input=we,f.avail_in=de,P.wrap=te,0},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":4,"./adler32":6,"./crc32":8,"./messages":14,"./trees":15}],10:[function(T,r,o){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],11:[function(T,r,o){r.exports=function(a,x){var u,M,I,H,G,L,y,D,C,B,z,A,S,q,W,_,R,v,V,Y,c,p,m,f,N;u=a.state,M=a.next_in,f=a.input,I=M+(a.avail_in-5),H=a.next_out,N=a.output,G=H-(x-a.avail_out),L=H+(a.avail_out-257),y=u.dmax,D=u.wsize,C=u.whave,B=u.wnext,z=u.window,A=u.hold,S=u.bits,q=u.lencode,W=u.distcode,_=(1<<u.lenbits)-1,R=(1<<u.distbits)-1;e:do{S<15&&(A+=f[M++]<<S,S+=8,A+=f[M++]<<S,S+=8),v=q[A&_];t:for(;;){if(A>>>=V=v>>>24,S-=V,(V=v>>>16&255)==0)N[H++]=65535&v;else{if(!(16&V)){if(!(64&V)){v=q[(65535&v)+(A&(1<<V)-1)];continue t}if(32&V){u.mode=12;break e}a.msg="invalid literal/length code",u.mode=30;break e}Y=65535&v,(V&=15)&&(S<V&&(A+=f[M++]<<S,S+=8),Y+=A&(1<<V)-1,A>>>=V,S-=V),S<15&&(A+=f[M++]<<S,S+=8,A+=f[M++]<<S,S+=8),v=W[A&R];n:for(;;){if(A>>>=V=v>>>24,S-=V,!(16&(V=v>>>16&255))){if(!(64&V)){v=W[(65535&v)+(A&(1<<V)-1)];continue n}a.msg="invalid distance code",u.mode=30;break e}if(c=65535&v,S<(V&=15)&&(A+=f[M++]<<S,(S+=8)<V&&(A+=f[M++]<<S,S+=8)),y<(c+=A&(1<<V)-1)){a.msg="invalid distance too far back",u.mode=30;break e}if(A>>>=V,S-=V,(V=H-G)<c){if(C<(V=c-V)&&u.sane){a.msg="invalid distance too far back",u.mode=30;break e}if(m=z,(p=0)===B){if(p+=D-V,V<Y){for(Y-=V;N[H++]=z[p++],--V;);p=H-c,m=N}}else if(B<V){if(p+=D+B-V,(V-=B)<Y){for(Y-=V;N[H++]=z[p++],--V;);if(p=0,B<Y){for(Y-=V=B;N[H++]=z[p++],--V;);p=H-c,m=N}}}else if(p+=B-V,V<Y){for(Y-=V;N[H++]=z[p++],--V;);p=H-c,m=N}for(;2<Y;)N[H++]=m[p++],N[H++]=m[p++],N[H++]=m[p++],Y-=3;Y&&(N[H++]=m[p++],1<Y&&(N[H++]=m[p++]))}else{for(p=H-c;N[H++]=N[p++],N[H++]=N[p++],N[H++]=N[p++],2<(Y-=3););Y&&(N[H++]=N[p++],1<Y&&(N[H++]=N[p++]))}break}}break}}while(M<I&&H<L);M-=Y=S>>3,A&=(1<<(S-=Y<<3))-1,a.next_in=M,a.next_out=H,a.avail_in=M<I?I-M+5:5-(M-I),a.avail_out=H<L?L-H+257:257-(H-L),u.hold=A,u.bits=S}},{}],12:[function(T,r,o){var a=T("../utils/common"),x=T("./adler32"),u=T("./crc32"),M=T("./inffast"),I=T("./inftrees"),H=-2;function G(_){return(_>>>24&255)+(_>>>8&65280)+((65280&_)<<8)+((255&_)<<24)}function L(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(_){var R;return _&&_.state?(R=_.state,_.total_in=_.total_out=R.total=0,_.msg="",R.wrap&&(_.adler=1&R.wrap),R.mode=1,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new a.Buf32(852),R.distcode=R.distdyn=new a.Buf32(592),R.sane=1,R.back=-1,0):H}function D(_){var R;return _&&_.state?((R=_.state).wsize=0,R.whave=0,R.wnext=0,y(_)):H}function C(_,R){var v,V;return _&&_.state?(V=_.state,R<0?(v=0,R=-R):(v=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?H:(V.window!==null&&V.wbits!==R&&(V.window=null),V.wrap=v,V.wbits=R,D(_))):H}function B(_,R){var v,V;return _?(V=new L,(_.state=V).window=null,(v=C(_,R))!==0&&(_.state=null),v):H}var z,A,S=!0;function q(_){if(S){var R;for(z=new a.Buf32(512),A=new a.Buf32(32),R=0;R<144;)_.lens[R++]=8;for(;R<256;)_.lens[R++]=9;for(;R<280;)_.lens[R++]=7;for(;R<288;)_.lens[R++]=8;for(I(1,_.lens,0,288,z,0,_.work,{bits:9}),R=0;R<32;)_.lens[R++]=5;I(2,_.lens,0,32,A,0,_.work,{bits:5}),S=!1}_.lencode=z,_.lenbits=9,_.distcode=A,_.distbits=5}function W(_,R,v,V){var Y,c=_.state;return c.window===null&&(c.wsize=1<<c.wbits,c.wnext=0,c.whave=0,c.window=new a.Buf8(c.wsize)),V>=c.wsize?(a.arraySet(c.window,R,v-c.wsize,c.wsize,0),c.wnext=0,c.whave=c.wsize):(V<(Y=c.wsize-c.wnext)&&(Y=V),a.arraySet(c.window,R,v-V,Y,c.wnext),(V-=Y)?(a.arraySet(c.window,R,v-V,V,0),c.wnext=V,c.whave=c.wsize):(c.wnext+=Y,c.wnext===c.wsize&&(c.wnext=0),c.whave<c.wsize&&(c.whave+=Y))),0}o.inflateReset=D,o.inflateReset2=C,o.inflateResetKeep=y,o.inflateInit=function(_){return B(_,15)},o.inflateInit2=B,o.inflate=function(_,R){var v,V,Y,c,p,m,f,N,P,O,Z,te,de,me,we,ge,Le,Pe,ae,ve,Ie,ze,He,at,tt=0,le=new a.Buf8(4),De=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!_||!_.state||!_.output||!_.input&&_.avail_in!==0)return H;(v=_.state).mode===12&&(v.mode=13),p=_.next_out,Y=_.output,f=_.avail_out,c=_.next_in,V=_.input,m=_.avail_in,N=v.hold,P=v.bits,O=m,Z=f,ze=0;e:for(;;)switch(v.mode){case 1:if(v.wrap===0){v.mode=13;break}for(;P<16;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}if(2&v.wrap&&N===35615){le[v.check=0]=255&N,le[1]=N>>>8&255,v.check=u(v.check,le,2,0),P=N=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&N)<<8)+(N>>8))%31){_.msg="incorrect header check",v.mode=30;break}if((15&N)!=8){_.msg="unknown compression method",v.mode=30;break}if(P-=4,Ie=8+(15&(N>>>=4)),v.wbits===0)v.wbits=Ie;else if(Ie>v.wbits){_.msg="invalid window size",v.mode=30;break}v.dmax=1<<Ie,_.adler=v.check=1,v.mode=512&N?10:12,P=N=0;break;case 2:for(;P<16;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}if(v.flags=N,(255&v.flags)!=8){_.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){_.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=N>>8&1),512&v.flags&&(le[0]=255&N,le[1]=N>>>8&255,v.check=u(v.check,le,2,0)),P=N=0,v.mode=3;case 3:for(;P<32;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}v.head&&(v.head.time=N),512&v.flags&&(le[0]=255&N,le[1]=N>>>8&255,le[2]=N>>>16&255,le[3]=N>>>24&255,v.check=u(v.check,le,4,0)),P=N=0,v.mode=4;case 4:for(;P<16;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}v.head&&(v.head.xflags=255&N,v.head.os=N>>8),512&v.flags&&(le[0]=255&N,le[1]=N>>>8&255,v.check=u(v.check,le,2,0)),P=N=0,v.mode=5;case 5:if(1024&v.flags){for(;P<16;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}v.length=N,v.head&&(v.head.extra_len=N),512&v.flags&&(le[0]=255&N,le[1]=N>>>8&255,v.check=u(v.check,le,2,0)),P=N=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(m<(te=v.length)&&(te=m),te&&(v.head&&(Ie=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),a.arraySet(v.head.extra,V,c,te,Ie)),512&v.flags&&(v.check=u(v.check,V,te,c)),m-=te,c+=te,v.length-=te),v.length))break e;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(m===0)break e;for(te=0;Ie=V[c+te++],v.head&&Ie&&v.length<65536&&(v.head.name+=String.fromCharCode(Ie)),Ie&&te<m;);if(512&v.flags&&(v.check=u(v.check,V,te,c)),m-=te,c+=te,Ie)break e}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(m===0)break e;for(te=0;Ie=V[c+te++],v.head&&Ie&&v.length<65536&&(v.head.comment+=String.fromCharCode(Ie)),Ie&&te<m;);if(512&v.flags&&(v.check=u(v.check,V,te,c)),m-=te,c+=te,Ie)break e}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;P<16;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}if(N!==(65535&v.check)){_.msg="header crc mismatch",v.mode=30;break}P=N=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),_.adler=v.check=0,v.mode=12;break;case 10:for(;P<32;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}_.adler=v.check=G(N),P=N=0,v.mode=11;case 11:if(v.havedict===0)return _.next_out=p,_.avail_out=f,_.next_in=c,_.avail_in=m,v.hold=N,v.bits=P,2;_.adler=v.check=1,v.mode=12;case 12:if(R===5||R===6)break e;case 13:if(v.last){N>>>=7&P,P-=7&P,v.mode=27;break}for(;P<3;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}switch(v.last=1&N,--P,3&(N>>>=1)){case 0:v.mode=14;break;case 1:if(q(v),v.mode=20,R!==6)break;N>>>=2,P-=2;break e;case 2:v.mode=17;break;case 3:_.msg="invalid block type",v.mode=30}N>>>=2,P-=2;break;case 14:for(N>>>=7&P,P-=7&P;P<32;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}if((65535&N)!=(N>>>16^65535)){_.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&N,P=N=0,v.mode=15,R===6)break e;case 15:v.mode=16;case 16:if(te=v.length){if(m<te&&(te=m),f<te&&(te=f),te===0)break e;a.arraySet(Y,V,c,te,p),m-=te,c+=te,f-=te,p+=te,v.length-=te;break}v.mode=12;break;case 17:for(;P<14;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}if(v.nlen=257+(31&N),N>>>=5,P-=5,v.ndist=1+(31&N),N>>>=5,P-=5,v.ncode=4+(15&N),N>>>=4,P-=4,286<v.nlen||30<v.ndist){_.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;P<3;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}v.lens[De[v.have++]]=7&N,N>>>=3,P-=3}for(;v.have<19;)v.lens[De[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,He={bits:v.lenbits},ze=I(0,v.lens,0,19,v.lencode,0,v.work,He),v.lenbits=He.bits,ze){_.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;ge=(tt=v.lencode[N&(1<<v.lenbits)-1])>>>16&255,Le=65535&tt,!((we=tt>>>24)<=P);){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}if(Le<16)N>>>=we,P-=we,v.lens[v.have++]=Le;else{if(Le===16){for(at=we+2;P<at;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}if(N>>>=we,P-=we,v.have===0){_.msg="invalid bit length repeat",v.mode=30;break}Ie=v.lens[v.have-1],te=3+(3&N),N>>>=2,P-=2}else if(Le===17){for(at=we+3;P<at;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}P-=we,Ie=0,te=3+(7&(N>>>=we)),N>>>=3,P-=3}else{for(at=we+7;P<at;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}P-=we,Ie=0,te=11+(127&(N>>>=we)),N>>>=7,P-=7}if(v.have+te>v.nlen+v.ndist){_.msg="invalid bit length repeat",v.mode=30;break}for(;te--;)v.lens[v.have++]=Ie}}if(v.mode===30)break;if(v.lens[256]===0){_.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,He={bits:v.lenbits},ze=I(1,v.lens,0,v.nlen,v.lencode,0,v.work,He),v.lenbits=He.bits,ze){_.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,He={bits:v.distbits},ze=I(2,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,He),v.distbits=He.bits,ze){_.msg="invalid distances set",v.mode=30;break}if(v.mode=20,R===6)break e;case 20:v.mode=21;case 21:if(6<=m&&258<=f){_.next_out=p,_.avail_out=f,_.next_in=c,_.avail_in=m,v.hold=N,v.bits=P,M(_,Z),p=_.next_out,Y=_.output,f=_.avail_out,c=_.next_in,V=_.input,m=_.avail_in,N=v.hold,P=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;ge=(tt=v.lencode[N&(1<<v.lenbits)-1])>>>16&255,Le=65535&tt,!((we=tt>>>24)<=P);){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}if(ge&&!(240&ge)){for(Pe=we,ae=ge,ve=Le;ge=(tt=v.lencode[ve+((N&(1<<Pe+ae)-1)>>Pe)])>>>16&255,Le=65535&tt,!(Pe+(we=tt>>>24)<=P);){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}N>>>=Pe,P-=Pe,v.back+=Pe}if(N>>>=we,P-=we,v.back+=we,v.length=Le,ge===0){v.mode=26;break}if(32&ge){v.back=-1,v.mode=12;break}if(64&ge){_.msg="invalid literal/length code",v.mode=30;break}v.extra=15&ge,v.mode=22;case 22:if(v.extra){for(at=v.extra;P<at;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}v.length+=N&(1<<v.extra)-1,N>>>=v.extra,P-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;ge=(tt=v.distcode[N&(1<<v.distbits)-1])>>>16&255,Le=65535&tt,!((we=tt>>>24)<=P);){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}if(!(240&ge)){for(Pe=we,ae=ge,ve=Le;ge=(tt=v.distcode[ve+((N&(1<<Pe+ae)-1)>>Pe)])>>>16&255,Le=65535&tt,!(Pe+(we=tt>>>24)<=P);){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}N>>>=Pe,P-=Pe,v.back+=Pe}if(N>>>=we,P-=we,v.back+=we,64&ge){_.msg="invalid distance code",v.mode=30;break}v.offset=Le,v.extra=15&ge,v.mode=24;case 24:if(v.extra){for(at=v.extra;P<at;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}v.offset+=N&(1<<v.extra)-1,N>>>=v.extra,P-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){_.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(f===0)break e;if(te=Z-f,v.offset>te){if((te=v.offset-te)>v.whave&&v.sane){_.msg="invalid distance too far back",v.mode=30;break}de=te>v.wnext?(te-=v.wnext,v.wsize-te):v.wnext-te,te>v.length&&(te=v.length),me=v.window}else me=Y,de=p-v.offset,te=v.length;for(f<te&&(te=f),f-=te,v.length-=te;Y[p++]=me[de++],--te;);v.length===0&&(v.mode=21);break;case 26:if(f===0)break e;Y[p++]=v.length,f--,v.mode=21;break;case 27:if(v.wrap){for(;P<32;){if(m===0)break e;m--,N|=V[c++]<<P,P+=8}if(Z-=f,_.total_out+=Z,v.total+=Z,Z&&(_.adler=v.check=(v.flags?u:x)(v.check,Y,Z,p-Z)),Z=f,(v.flags?N:G(N))!==v.check){_.msg="incorrect data check",v.mode=30;break}P=N=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;P<32;){if(m===0)break e;m--,N+=V[c++]<<P,P+=8}if(N!==(4294967295&v.total)){_.msg="incorrect length check",v.mode=30;break}P=N=0}v.mode=29;case 29:ze=1;break e;case 30:ze=-3;break e;case 31:return-4;default:return H}return _.next_out=p,_.avail_out=f,_.next_in=c,_.avail_in=m,v.hold=N,v.bits=P,(v.wsize||Z!==_.avail_out&&v.mode<30&&(v.mode<27||R!==4))&&W(_,_.output,_.next_out,Z-_.avail_out)?(v.mode=31,-4):(O-=_.avail_in,Z-=_.avail_out,_.total_in+=O,_.total_out+=Z,v.total+=Z,v.wrap&&Z&&(_.adler=v.check=(v.flags?u:x)(v.check,Y,Z,_.next_out-Z)),_.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(O==0&&Z===0||R===4)&&ze===0&&(ze=-5),ze)},o.inflateEnd=function(_){if(!_||!_.state)return H;var R=_.state;return R.window&&(R.window=null),_.state=null,0},o.inflateGetHeader=function(_,R){var v;return _&&_.state&&2&(v=_.state).wrap?((v.head=R).done=!1,0):H},o.inflateSetDictionary=function(_,R){var v,V=R.length;return!_||!_.state||(v=_.state).wrap!==0&&v.mode!==11?H:v.mode===11&&x(1,R,V,0)!==v.check?-3:W(_,R,V,V)?(v.mode=31,-4):(v.havedict=1,0)},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":4,"./adler32":6,"./crc32":8,"./inffast":11,"./inftrees":13}],13:[function(T,r,o){var a=T("../utils/common"),x=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],M=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],I=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(H,G,L,y,D,C,B,z){var A,S,q,W,_,R,v,V,Y,c=z.bits,p=0,m=0,f=0,N=0,P=0,O=0,Z=0,te=0,de=0,me=0,we=null,ge=0,Le=new a.Buf16(16),Pe=new a.Buf16(16),ae=null,ve=0;for(p=0;p<=15;p++)Le[p]=0;for(m=0;m<y;m++)Le[G[L+m]]++;for(P=c,N=15;1<=N&&Le[N]===0;N--);if(N<P&&(P=N),N===0)return D[C++]=20971520,D[C++]=20971520,z.bits=1,0;for(f=1;f<N&&Le[f]===0;f++);for(P<f&&(P=f),p=te=1;p<=15;p++)if(te<<=1,(te-=Le[p])<0)return-1;if(0<te&&(H===0||N!==1))return-1;for(Pe[1]=0,p=1;p<15;p++)Pe[p+1]=Pe[p]+Le[p];for(m=0;m<y;m++)G[L+m]!==0&&(B[Pe[G[L+m]]++]=m);if(R=H===0?(we=ae=B,19):H===1?(we=x,ge-=257,ae=u,ve-=257,256):(we=M,ae=I,-1),p=f,_=C,Z=m=me=0,q=-1,W=(de=1<<(O=P))-1,H===1&&852<de||H===2&&592<de)return 1;for(;;){for(v=p-Z,Y=B[m]<R?(V=0,B[m]):B[m]>R?(V=ae[ve+B[m]],we[ge+B[m]]):(V=96,0),A=1<<p-Z,f=S=1<<O;D[_+(me>>Z)+(S-=A)]=v<<24|V<<16|Y,S!==0;);for(A=1<<p-1;me&A;)A>>=1;if(A!==0?(me&=A-1,me+=A):me=0,m++,--Le[p]==0){if(p===N)break;p=G[L+B[m]]}if(P<p&&(me&W)!==q){for(Z===0&&(Z=P),_+=f,te=1<<(O=p-Z);O+Z<N&&!((te-=Le[O+Z])<=0);)O++,te<<=1;if(de+=1<<O,H===1&&852<de||H===2&&592<de)return 1;D[q=me&W]=P<<24|O<<16|_-C}}return me!==0&&(D[_+me]=p-Z<<24|64<<16),z.bits=P,0}},{"../utils/common":4}],14:[function(T,r,o){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],15:[function(T,r,o){var a=T("../utils/common");function x(ae){for(var ve=ae.length;0<=--ve;)ae[ve]=0}var u=256,M=286,I=30,H=15,G=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=new Array(576);x(C);var B=new Array(60);x(B);var z=new Array(512);x(z);var A=new Array(256);x(A);var S=new Array(29);x(S);var q,W,_,R=new Array(I);function v(ae,ve,Ie,ze,He){this.static_tree=ae,this.extra_bits=ve,this.extra_base=Ie,this.elems=ze,this.max_length=He,this.has_stree=ae&&ae.length}function V(ae,ve){this.dyn_tree=ae,this.max_code=0,this.stat_desc=ve}function Y(ae){return ae<256?z[ae]:z[256+(ae>>>7)]}function c(ae,ve){ae.pending_buf[ae.pending++]=255&ve,ae.pending_buf[ae.pending++]=ve>>>8&255}function p(ae,ve,Ie){ae.bi_valid>16-Ie?(ae.bi_buf|=ve<<ae.bi_valid&65535,c(ae,ae.bi_buf),ae.bi_buf=ve>>16-ae.bi_valid,ae.bi_valid+=Ie-16):(ae.bi_buf|=ve<<ae.bi_valid&65535,ae.bi_valid+=Ie)}function m(ae,ve,Ie){p(ae,Ie[2*ve],Ie[2*ve+1])}function f(ae,ve){for(var Ie=0;Ie|=1&ae,ae>>>=1,Ie<<=1,0<--ve;);return Ie>>>1}function N(ae,ve,Ie){var ze,He,at=new Array(16),tt=0;for(ze=1;ze<=H;ze++)at[ze]=tt=tt+Ie[ze-1]<<1;for(He=0;He<=ve;He++){var le=ae[2*He+1];le!==0&&(ae[2*He]=f(at[le]++,le))}}function P(ae){var ve;for(ve=0;ve<M;ve++)ae.dyn_ltree[2*ve]=0;for(ve=0;ve<I;ve++)ae.dyn_dtree[2*ve]=0;for(ve=0;ve<19;ve++)ae.bl_tree[2*ve]=0;ae.dyn_ltree[512]=1,ae.opt_len=ae.static_len=0,ae.last_lit=ae.matches=0}function O(ae){8<ae.bi_valid?c(ae,ae.bi_buf):0<ae.bi_valid&&(ae.pending_buf[ae.pending++]=ae.bi_buf),ae.bi_buf=0,ae.bi_valid=0}function Z(ae,ve,Ie,ze){var He=2*ve,at=2*Ie;return ae[He]<ae[at]||ae[He]===ae[at]&&ze[ve]<=ze[Ie]}function te(ae,ve,Ie){for(var ze=ae.heap[Ie],He=Ie<<1;He<=ae.heap_len&&(He<ae.heap_len&&Z(ve,ae.heap[He+1],ae.heap[He],ae.depth)&&He++,!Z(ve,ze,ae.heap[He],ae.depth));)ae.heap[Ie]=ae.heap[He],Ie=He,He<<=1;ae.heap[Ie]=ze}function de(ae,ve,Ie){var ze,He,at,tt,le=0;if(ae.last_lit!==0)for(;ze=ae.pending_buf[ae.d_buf+2*le]<<8|ae.pending_buf[ae.d_buf+2*le+1],He=ae.pending_buf[ae.l_buf+le],le++,ze===0?m(ae,He,ve):(m(ae,(at=A[He])+u+1,ve),(tt=G[at])!==0&&p(ae,He-=S[at],tt),m(ae,at=Y(--ze),Ie),(tt=L[at])!==0&&p(ae,ze-=R[at],tt)),le<ae.last_lit;);m(ae,256,ve)}function me(ae,ve){var Ie,ze,He,at=ve.dyn_tree,tt=ve.stat_desc.static_tree,le=ve.stat_desc.has_stree,De=ve.stat_desc.elems,st=-1;for(ae.heap_len=0,ae.heap_max=573,Ie=0;Ie<De;Ie++)at[2*Ie]!==0?(ae.heap[++ae.heap_len]=st=Ie,ae.depth[Ie]=0):at[2*Ie+1]=0;for(;ae.heap_len<2;)at[2*(He=ae.heap[++ae.heap_len]=st<2?++st:0)]=1,ae.depth[He]=0,ae.opt_len--,le&&(ae.static_len-=tt[2*He+1]);for(ve.max_code=st,Ie=ae.heap_len>>1;1<=Ie;Ie--)te(ae,at,Ie);for(He=De;Ie=ae.heap[1],ae.heap[1]=ae.heap[ae.heap_len--],te(ae,at,1),ze=ae.heap[1],ae.heap[--ae.heap_max]=Ie,ae.heap[--ae.heap_max]=ze,at[2*He]=at[2*Ie]+at[2*ze],ae.depth[He]=(ae.depth[Ie]>=ae.depth[ze]?ae.depth[Ie]:ae.depth[ze])+1,at[2*Ie+1]=at[2*ze+1]=He,ae.heap[1]=He++,te(ae,at,1),2<=ae.heap_len;);ae.heap[--ae.heap_max]=ae.heap[1],function(gt,St){var Rt,Pt,Je,bt,jt,Ln,Yt=St.dyn_tree,Qt=St.max_code,Ve=St.stat_desc.static_tree,Be=St.stat_desc.has_stree,Wt=St.stat_desc.extra_bits,Kn=St.stat_desc.extra_base,nn=St.stat_desc.max_length,ct=0;for(bt=0;bt<=H;bt++)gt.bl_count[bt]=0;for(Yt[2*gt.heap[gt.heap_max]+1]=0,Rt=gt.heap_max+1;Rt<573;Rt++)nn<(bt=Yt[2*Yt[2*(Pt=gt.heap[Rt])+1]+1]+1)&&(bt=nn,ct++),Yt[2*Pt+1]=bt,Qt<Pt||(gt.bl_count[bt]++,jt=0,Kn<=Pt&&(jt=Wt[Pt-Kn]),Ln=Yt[2*Pt],gt.opt_len+=Ln*(bt+jt),Be&&(gt.static_len+=Ln*(Ve[2*Pt+1]+jt)));if(ct!==0){do{for(bt=nn-1;gt.bl_count[bt]===0;)bt--;gt.bl_count[bt]--,gt.bl_count[bt+1]+=2,gt.bl_count[nn]--,ct-=2}while(0<ct);for(bt=nn;bt!==0;bt--)for(Pt=gt.bl_count[bt];Pt!==0;)Qt<(Je=gt.heap[--Rt])||(Yt[2*Je+1]!==bt&&(gt.opt_len+=(bt-Yt[2*Je+1])*Yt[2*Je],Yt[2*Je+1]=bt),Pt--)}}(ae,ve),N(at,st,ae.bl_count)}function we(ae,ve,Ie){var ze,He,at=-1,tt=ve[1],le=0,De=7,st=4;for(tt===0&&(De=138,st=3),ve[2*(Ie+1)+1]=65535,ze=0;ze<=Ie;ze++)He=tt,tt=ve[2*(ze+1)+1],++le<De&&He===tt||(le<st?ae.bl_tree[2*He]+=le:He!==0?(He!==at&&ae.bl_tree[2*He]++,ae.bl_tree[32]++):le<=10?ae.bl_tree[34]++:ae.bl_tree[36]++,at=He,st=(le=0)===tt?(De=138,3):He===tt?(De=6,3):(De=7,4))}function ge(ae,ve,Ie){var ze,He,at=-1,tt=ve[1],le=0,De=7,st=4;for(tt===0&&(De=138,st=3),ze=0;ze<=Ie;ze++)if(He=tt,tt=ve[2*(ze+1)+1],!(++le<De&&He===tt)){if(le<st)for(;m(ae,He,ae.bl_tree),--le!=0;);else He!==0?(He!==at&&(m(ae,He,ae.bl_tree),le--),m(ae,16,ae.bl_tree),p(ae,le-3,2)):le<=10?(m(ae,17,ae.bl_tree),p(ae,le-3,3)):(m(ae,18,ae.bl_tree),p(ae,le-11,7));at=He,st=(le=0)===tt?(De=138,3):He===tt?(De=6,3):(De=7,4)}}x(R);var Le=!1;function Pe(ae,ve,Ie,ze){var He,at,tt;p(ae,0+(ze?1:0),3),at=ve,tt=Ie,O(He=ae),c(He,tt),c(He,~tt),a.arraySet(He.pending_buf,He.window,at,tt,He.pending),He.pending+=tt}o._tr_init=function(ae){Le||(function(){var ve,Ie,ze,He,at,tt=new Array(16);for(He=ze=0;He<28;He++)for(S[He]=ze,ve=0;ve<1<<G[He];ve++)A[ze++]=He;for(A[ze-1]=He,He=at=0;He<16;He++)for(R[He]=at,ve=0;ve<1<<L[He];ve++)z[at++]=He;for(at>>=7;He<I;He++)for(R[He]=at<<7,ve=0;ve<1<<L[He]-7;ve++)z[256+at++]=He;for(Ie=0;Ie<=H;Ie++)tt[Ie]=0;for(ve=0;ve<=143;)C[2*ve+1]=8,ve++,tt[8]++;for(;ve<=255;)C[2*ve+1]=9,ve++,tt[9]++;for(;ve<=279;)C[2*ve+1]=7,ve++,tt[7]++;for(;ve<=287;)C[2*ve+1]=8,ve++,tt[8]++;for(N(C,287,tt),ve=0;ve<I;ve++)B[2*ve+1]=5,B[2*ve]=f(ve,5);q=new v(C,G,257,M,H),W=new v(B,L,0,I,H),_=new v(new Array(0),y,0,19,7)}(),Le=!0),ae.l_desc=new V(ae.dyn_ltree,q),ae.d_desc=new V(ae.dyn_dtree,W),ae.bl_desc=new V(ae.bl_tree,_),ae.bi_buf=0,ae.bi_valid=0,P(ae)},o._tr_stored_block=Pe,o._tr_flush_block=function(ae,ve,Ie,ze){var He,at,tt=0;0<ae.level?(ae.strm.data_type===2&&(ae.strm.data_type=function(le){var De,st=4093624447;for(De=0;De<=31;De++,st>>>=1)if(1&st&&le.dyn_ltree[2*De]!==0)return 0;if(le.dyn_ltree[18]!==0||le.dyn_ltree[20]!==0||le.dyn_ltree[26]!==0)return 1;for(De=32;De<u;De++)if(le.dyn_ltree[2*De]!==0)return 1;return 0}(ae)),me(ae,ae.l_desc),me(ae,ae.d_desc),tt=function(le){var De;for(we(le,le.dyn_ltree,le.l_desc.max_code),we(le,le.dyn_dtree,le.d_desc.max_code),me(le,le.bl_desc),De=18;3<=De&&le.bl_tree[2*D[De]+1]===0;De--);return le.opt_len+=3*(De+1)+5+5+4,De}(ae),He=ae.opt_len+3+7>>>3,(at=ae.static_len+3+7>>>3)<=He&&(He=at)):He=at=Ie+5,Ie+4<=He&&ve!==-1?Pe(ae,ve,Ie,ze):ae.strategy===4||at===He?(p(ae,2+(ze?1:0),3),de(ae,C,B)):(p(ae,4+(ze?1:0),3),function(le,De,st,gt){var St;for(p(le,De-257,5),p(le,st-1,5),p(le,gt-4,4),St=0;St<gt;St++)p(le,le.bl_tree[2*D[St]+1],3);ge(le,le.dyn_ltree,De-1),ge(le,le.dyn_dtree,st-1)}(ae,ae.l_desc.max_code+1,ae.d_desc.max_code+1,tt+1),de(ae,ae.dyn_ltree,ae.dyn_dtree)),P(ae),ze&&O(ae)},o._tr_tally=function(ae,ve,Ie){return ae.pending_buf[ae.d_buf+2*ae.last_lit]=ve>>>8&255,ae.pending_buf[ae.d_buf+2*ae.last_lit+1]=255&ve,ae.pending_buf[ae.l_buf+ae.last_lit]=255&Ie,ae.last_lit++,ve===0?ae.dyn_ltree[2*Ie]++:(ae.matches++,ve--,ae.dyn_ltree[2*(A[Ie]+u+1)]++,ae.dyn_dtree[2*Y(ve)]++),ae.last_lit===ae.lit_bufsize-1},o._tr_align=function(ae){var ve;p(ae,2,3),m(ae,256,C),(ve=ae).bi_valid===16?(c(ve,ve.bi_buf),ve.bi_buf=0,ve.bi_valid=0):8<=ve.bi_valid&&(ve.pending_buf[ve.pending++]=255&ve.bi_buf,ve.bi_buf>>=8,ve.bi_valid-=8)}},{"../utils/common":4}],16:[function(T,r,o){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],17:[function(T,r,o){var a=T("three");a.OrbitControls=function(x,u){var M,I,H,G,L;u===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),u===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=x,this.domElement=u,this.enabled=!0,this.target=new a.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:a.MOUSE.ROTATE,MIDDLE:a.MOUSE.DOLLY,RIGHT:a.MOUSE.PAN},this.touches={ONE:a.TOUCH.ROTATE,TWO:a.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return q.phi},this.getAzimuthalAngle=function(){return q.theta},this.saveState=function(){y.target0.copy(y.target),y.position0.copy(y.object.position),y.zoom0=y.object.zoom},this.resetStatusValue=function(){A=z.NONE},this.reset=function(){y.target.copy(y.target0),y.object.position.copy(y.position0),y.object.zoom=y.zoom0,y.object.updateProjectionMatrix(),y.dispatchEvent(D),y.update(),A=z.NONE},this.update=(M=new a.Vector3,I=new a.Quaternion().setFromUnitVectors(x.up,new a.Vector3(0,1,0)),H=I.clone().inverse(),G=new a.Vector3,L=new a.Quaternion,function(){var Ve=y.object.position;return M.copy(Ve).sub(y.target),M.applyQuaternion(I),q.setFromVector3(M),y.autoRotate&&A===z.NONE&&te(2*Math.PI/60/60*y.autoRotateSpeed),y.enableDamping?(q.theta+=W.theta*y.dampingFactor,q.phi+=W.phi*y.dampingFactor):(q.theta+=W.theta,q.phi+=W.phi),q.theta=Math.max(y.minAzimuthAngle,Math.min(y.maxAzimuthAngle,q.theta)),q.phi=Math.max(y.minPolarAngle,Math.min(y.maxPolarAngle,q.phi)),q.makeSafe(),q.radius*=_,q.radius=Math.max(y.minDistance,Math.min(y.maxDistance,q.radius)),y.enableDamping===!0?y.target.addScaledVector(R,y.dampingFactor):y.target.add(R),M.setFromSpherical(q),M.applyQuaternion(H),Ve.copy(y.target).add(M),y.object.lookAt(y.target),y.enableDamping===!0?(W.theta*=1-y.dampingFactor,W.phi*=1-y.dampingFactor,R.multiplyScalar(1-y.dampingFactor)):(W.set(0,0,0),R.set(0,0,0)),_=1,!(!(v||G.distanceToSquared(y.object.position)>S||8*(1-L.dot(y.object.quaternion))>S)||(y.dispatchEvent(D),G.copy(y.object.position),L.copy(y.object.quaternion),v=!1))}),this.dispose=function(){y.domElement.removeEventListener("contextmenu",Qt,!1),y.domElement.removeEventListener("mousedown",gt,!1),y.domElement.removeEventListener("wheel",Pt,!1),y.domElement.removeEventListener("touchstart",jt,!1),y.domElement.removeEventListener("touchend",Yt,!1),y.domElement.removeEventListener("touchmove",Ln,!1),document.removeEventListener("mousemove",St,!1),document.removeEventListener("mouseup",Rt,!1),y.domElement.removeEventListener("keydown",Je,!1)};var y=this,D={type:"change"},C={type:"start"},B={type:"end"},z={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},A=z.NONE,S=1e-6,q=new a.Spherical,W=new a.Spherical,_=1,R=new a.Vector3,v=!1,V=new a.Vector2,Y=new a.Vector2,c=new a.Vector2,p=new a.Vector2,m=new a.Vector2,f=new a.Vector2,N=new a.Vector2,P=new a.Vector2,O=new a.Vector2;function Z(){return Math.pow(.95,y.zoomSpeed)}function te(Ve){W.theta-=Ve}function de(Ve){W.phi-=Ve}var me,we,ge,Le=(me=new a.Vector3,function(Ve,Be){me.setFromMatrixColumn(Be,0),me.multiplyScalar(-Ve),R.add(me)}),Pe=(we=new a.Vector3,function(Ve,Be){y.screenSpacePanning===!0?we.setFromMatrixColumn(Be,1):(we.setFromMatrixColumn(Be,0),we.crossVectors(y.object.up,we)),we.multiplyScalar(Ve),R.add(we)}),ae=(ge=new a.Vector3,function(Ve,Be){var Wt=y.domElement;if(y.object.isPerspectiveCamera){var Kn=y.object.position;ge.copy(Kn).sub(y.target);var nn=ge.length();nn*=Math.tan(y.object.fov/2*Math.PI/180),Le(2*Ve*nn/Wt.clientHeight,y.object.matrix),Pe(2*Be*nn/Wt.clientHeight,y.object.matrix)}else y.object.isOrthographicCamera?(Le(Ve*(y.object.right-y.object.left)/y.object.zoom/Wt.clientWidth,y.object.matrix),Pe(Be*(y.object.top-y.object.bottom)/y.object.zoom/Wt.clientHeight,y.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),y.enablePan=!1)});function ve(Ve){y.object.isPerspectiveCamera?_/=Ve:y.object.isOrthographicCamera?(y.object.zoom=Math.max(y.minZoom,Math.min(y.maxZoom,y.object.zoom*Ve)),y.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),y.enableZoom=!1)}function Ie(Ve){V.set(Ve.clientX,Ve.clientY)}function ze(Ve){p.set(Ve.clientX,Ve.clientY)}function He(Ve){if(Ve.touches.length==1)V.set(Ve.touches[0].pageX,Ve.touches[0].pageY);else{var Be=.5*(Ve.touches[0].pageX+Ve.touches[1].pageX),Wt=.5*(Ve.touches[0].pageY+Ve.touches[1].pageY);V.set(Be,Wt)}}function at(Ve){if(Ve.touches.length==1)p.set(Ve.touches[0].pageX,Ve.touches[0].pageY);else{var Be=.5*(Ve.touches[0].pageX+Ve.touches[1].pageX),Wt=.5*(Ve.touches[0].pageY+Ve.touches[1].pageY);p.set(Be,Wt)}}function tt(Ve){var Be=Ve.touches[0].pageX-Ve.touches[1].pageX,Wt=Ve.touches[0].pageY-Ve.touches[1].pageY,Kn=Math.sqrt(Be*Be+Wt*Wt);N.set(0,Kn)}function le(Ve){if(Ve.touches.length==1)Y.set(Ve.touches[0].pageX,Ve.touches[0].pageY);else{var Be=.5*(Ve.touches[0].pageX+Ve.touches[1].pageX),Wt=.5*(Ve.touches[0].pageY+Ve.touches[1].pageY);Y.set(Be,Wt)}c.subVectors(Y,V).multiplyScalar(y.rotateSpeed);var Kn=y.domElement;te(2*Math.PI*c.x/Kn.clientHeight),de(2*Math.PI*c.y/Kn.clientHeight),V.copy(Y)}function De(Ve){if(Ve.touches.length==1)m.set(Ve.touches[0].pageX,Ve.touches[0].pageY);else{var Be=.5*(Ve.touches[0].pageX+Ve.touches[1].pageX),Wt=.5*(Ve.touches[0].pageY+Ve.touches[1].pageY);m.set(Be,Wt)}f.subVectors(m,p).multiplyScalar(y.panSpeed),ae(f.x,f.y),p.copy(m)}function st(Ve){var Be=Ve.touches[0].pageX-Ve.touches[1].pageX,Wt=Ve.touches[0].pageY-Ve.touches[1].pageY,Kn=Math.sqrt(Be*Be+Wt*Wt);P.set(0,Kn),O.set(0,Math.pow(P.y/N.y,y.zoomSpeed)),ve(O.y),N.copy(P)}function gt(Ve){if(y.enabled!==!1){switch(Ve.preventDefault(),y.domElement.focus?y.domElement.focus():window.focus(),Ve.button){case 0:switch(y.mouseButtons.LEFT){case a.MOUSE.ROTATE:if(Ve.ctrlKey||Ve.metaKey||Ve.shiftKey){if(y.enablePan===!1)return;ze(Ve),A=z.PAN}else{if(y.enableRotate===!1)return;Ie(Ve),A=z.ROTATE}break;case a.MOUSE.PAN:if(Ve.ctrlKey||Ve.metaKey||Ve.shiftKey){if(y.enableRotate===!1)return;Ie(Ve),A=z.ROTATE}else{if(y.enablePan===!1)return;ze(Ve),A=z.PAN}break;default:A=z.NONE}break;case 1:switch(y.mouseButtons.MIDDLE){case a.MOUSE.DOLLY:if(y.enableZoom===!1)return;Be=Ve,N.set(Be.clientX,Be.clientY),A=z.DOLLY;break;case a.MOUSE.PAN:if(y.enablePan===!1)return;ze(Ve),A=z.PAN;break;default:A=z.NONE}break;case 2:switch(y.mouseButtons.RIGHT){case a.MOUSE.ROTATE:if(y.enableRotate===!1)return;Ie(Ve),A=z.ROTATE;break;case a.MOUSE.PAN:if(y.enablePan===!1)return;ze(Ve),A=z.PAN;break;default:A=z.NONE}}var Be;A!==z.NONE&&(document.addEventListener("mousemove",St,!1),document.addEventListener("mouseup",Rt,!1),y.dispatchEvent(C))}}function St(Ve){var Be;if(y.enabled!==!1)switch(Ve.preventDefault(),A){case z.ROTATE:if(y.enableRotate===!1)return;(function(Wt){Y.set(Wt.clientX,Wt.clientY),c.subVectors(Y,V).multiplyScalar(y.rotateSpeed);var Kn=y.domElement;te(2*Math.PI*c.x/Kn.clientHeight),de(2*Math.PI*c.y/Kn.clientHeight),V.copy(Y),y.update()})(Ve);break;case z.DOLLY:if(y.enableZoom===!1)return;(function(Wt){var Kn;P.set(Wt.clientX,Wt.clientY),O.subVectors(P,N),0<O.y?ve(Z()):O.y<0&&(Kn=Z(),y.object.isPerspectiveCamera?_*=Kn:y.object.isOrthographicCamera?(y.object.zoom=Math.max(y.minZoom,Math.min(y.maxZoom,y.object.zoom/Kn)),y.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),y.enableZoom=!1)),N.copy(P),y.update()})(Ve);break;case z.PAN:if(y.enablePan===!1)return;Be=Ve,m.set(Be.clientX,Be.clientY),f.subVectors(m,p).multiplyScalar(y.panSpeed),ae(f.x,f.y),p.copy(m),y.update()}}function Rt(Ve){y.enabled!==!1&&(document.removeEventListener("mousemove",St,!1),document.removeEventListener("mouseup",Rt,!1),y.dispatchEvent(B),A=z.NONE)}function Pt(Ve){y.enabled===!1||y.enableZoom===!1||A!==z.NONE&&A!==z.ROTATE||(Ve.preventDefault(),Ve.stopPropagation(),y.dispatchEvent(C),function(Be){Be.deltaY<0?function(Wt,Kn){if(y.object.isPerspectiveCamera)qe*=Wt;else if(y.object.isOrthographicCamera){var nn=y.domElement.clientWidth,ct=y.domElement.clientHeight,rt=(y.object.near+y.object.far)/(y.object.near-y.object.far),Zt=Kn.offsetX,bn=Kn.offsetY,Kt=new a.Vector3(Zt/nn*2-1,-bn/ct*2+1,rt);Kt.applyMatrix4(y.object.projectionMatrixInverse);var Zn=new a.Vector3(-1,-1,rt),Se=new a.Vector3(1,1,rt);Zn.applyMatrix4(y.object.projectionMatrixInverse),Se.applyMatrix4(y.object.projectionMatrixInverse);var Cr=Math.max(y.minZoom,Math.min(y.maxZoom,1/Wt)),Xe=new a.Matrix4;Xe.makeTranslation(-Kt.x,-Kt.y,0);var qe=new a.Matrix4().scale(new a.Vector3(1/Cr,1/Cr,1/Cr)),ut=new a.Matrix4;ut.makeTranslation(Kt.x,Kt.y,0);var Re=new a.Matrix4().multiply(ut).multiply(qe).multiply(Xe);Zn.applyMatrix4(Re),Se.applyMatrix4(Re),y.object.left=Zn.x,y.object.right=Se.x,y.object.top=Se.y,y.object.bottom=Zn.y,y.object.zoom=1,y.object.updateProjectionMatrix(),v=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),y.enableZoom=!1}(Z(),Be):0<Be.deltaY&&function(Wt,Kn){if(y.object.isPerspectiveCamera)qe/=Wt;else if(y.object.isOrthographicCamera){var nn=y.domElement.clientWidth,ct=y.domElement.clientHeight,rt=(y.object.near+y.object.far)/(y.object.near-y.object.far),Zt=Kn.offsetX,bn=Kn.offsetY,Kt=new a.Vector3(Zt/nn*2-1,-bn/ct*2+1,rt);Kt.applyMatrix4(y.object.projectionMatrixInverse);var Zn=new a.Vector3(-1,-1,rt),Se=new a.Vector3(1,1,rt);Zn.applyMatrix4(y.object.projectionMatrixInverse),Se.applyMatrix4(y.object.projectionMatrixInverse);var Cr=Math.max(y.minZoom,Math.min(y.maxZoom,Wt)),Xe=new a.Matrix4;Xe.makeTranslation(-Kt.x,-Kt.y,0);var qe=new a.Matrix4().scale(new a.Vector3(1/Cr,1/Cr,1/Cr)),ut=new a.Matrix4;ut.makeTranslation(Kt.x,Kt.y,0);var Re=new a.Matrix4().multiply(ut).multiply(qe).multiply(Xe);Zn.applyMatrix4(Re),Se.applyMatrix4(Re),y.object.left=Zn.x,y.object.right=Se.x,y.object.top=Se.y,y.object.bottom=Zn.y,y.object.zoom=1,y.object.updateProjectionMatrix(),v=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),y.enableZoom=!1}(Z(),Be),y.update()}(Ve),y.dispatchEvent(B))}function Je(Ve){y.enabled!==!1&&y.enableKeys!==!1&&y.enablePan!==!1&&function(Be){var Wt=!1;switch(Be.keyCode){case y.keys.UP:ae(0,y.keyPanSpeed),Wt=!0;break;case y.keys.BOTTOM:ae(0,-y.keyPanSpeed),Wt=!0;break;case y.keys.LEFT:ae(y.keyPanSpeed,0),Wt=!0;break;case y.keys.RIGHT:ae(-y.keyPanSpeed,0),Wt=!0}Wt&&(Be.preventDefault(),y.update())}(Ve)}function bt(Ve){switch(Ve.touches.length){case 1:switch(y.touches.ONE){case a.TOUCH.ROTATE:if(y.enableRotate===!1)return;He(Ve),A=z.TOUCH_ROTATE;break;case a.TOUCH.PAN:if(y.enablePan===!1)return;at(Ve),A=z.TOUCH_PAN;break;default:A=z.NONE}break;case 2:switch(y.touches.TWO){case a.TOUCH.DOLLY_PAN:if(y.enableZoom===!1&&y.enablePan===!1)return;Wt=Ve,y.enableZoom&&tt(Wt),y.enablePan&&at(Wt),A=z.TOUCH_DOLLY_PAN;break;case a.TOUCH.DOLLY_ROTATE:if(y.enableZoom===!1&&y.enableRotate===!1)return;Be=Ve,y.enableZoom&&tt(Be),y.enableRotate&&He(Be),A=z.TOUCH_DOLLY_ROTATE;break;default:A=z.NONE}break;default:A=z.NONE}var Be,Wt}function jt(Ve){y.enabled!==!1&&(Ve.preventDefault(),bt(Ve),A!==z.NONE&&y.dispatchEvent(C))}function Ln(Ve){var Be,Wt;if(y.enabled!==!1)switch(Ve.preventDefault(),Ve.stopPropagation(),A){case z.TOUCH_ROTATE:if(y.enableRotate===!1)return;le(Ve),y.update();break;case z.TOUCH_PAN:if(y.enablePan===!1)return;De(Ve),y.update();break;case z.TOUCH_DOLLY_PAN:if(y.enableZoom===!1&&y.enablePan===!1)return;Wt=Ve,y.enableZoom&&st(Wt),y.enablePan&&De(Wt),y.update();break;case z.TOUCH_DOLLY_ROTATE:if(y.enableZoom===!1&&y.enableRotate===!1)return;Be=Ve,y.enableZoom&&st(Be),y.enableRotate&&le(Be),y.update();break;default:bt(Ve)}}function Yt(Ve){y.enabled!==!1&&(y.dispatchEvent(B),A=z.NONE)}function Qt(Ve){y.enabled!==!1&&Ve.preventDefault()}y.domElement.addEventListener("contextmenu",Qt,!1),y.domElement.addEventListener("mousedown",gt,!1),y.domElement.addEventListener("wheel",Pt,!1),y.domElement.addEventListener("touchstart",jt,!1),y.domElement.addEventListener("touchend",Yt,!1),y.domElement.addEventListener("touchmove",Ln,!1),y.domElement.addEventListener("keydown",Je,!1),y.domElement.tabIndex===-1&&(y.domElement.tabIndex=0),this.update()},a.OrbitControls.prototype=Object.create(a.EventDispatcher.prototype),a.OrbitControls.prototype.constructor=a.OrbitControls,a.MapControls=function(x,u){a.OrbitControls.call(this,x,u),this.mouseButtons.LEFT=a.MOUSE.PAN,this.mouseButtons.RIGHT=a.MOUSE.ROTATE,this.touches.ONE=a.TOUCH.PAN,this.touches.TWO=a.TOUCH.DOLLY_ROTATE},a.MapControls.prototype=Object.create(a.EventDispatcher.prototype),a.MapControls.prototype.constructor=a.MapControls,o!==void 0&&(r!==void 0&&r.exports&&(o=r.exports={OrbitControls:a.OrbitControls,MapControls:a.MapControls}),o.OrbitControls=a.OrbitControls,o.MapControls=a.MapControls)},{three:19}],18:[function(T,r,o){(function(){var a,x,u,M=T!==void 0,I=this.THREE||M&&T("three");if(!I)throw new Error("MeshLine requires three.js");function H(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new I.BufferGeometry,this.widthCallback=null,this.matrixWorld=new I.Matrix4}function G(y,D,C,B,z){var A;if(y=y.subarray||y.slice?y:y.buffer,C=C.subarray||C.slice?C:C.buffer,y=D?y.subarray?y.subarray(D,z&&D+z):y.slice(D,z&&D+z):y,C.set)C.set(y,B);else for(A=0;A<y.length;A++)C[A+B]=y[A];return C}function L(y){I.ShaderMaterial.call(this,{uniforms:Object.assign({},I.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new I.Color(16777215)},opacity:{value:1},resolution:{value:new I.Vector2(1,1)},sizeAttenuation:{value:1},near:{value:1},far:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new I.Vector2(1,1)}}),vertexShader:I.ShaderChunk.meshline_vert,fragmentShader:I.ShaderChunk.meshline_frag}),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(D){this.uniforms.lineWidth.value=D}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(D){this.uniforms.map.value=D}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(D){this.uniforms.useMap.value=D}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(D){this.uniforms.alphaMap.value=D}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(D){this.uniforms.useAlphaMap.value=D}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(D){this.uniforms.color.value=D}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(D){this.uniforms.opacity.value=D}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(D){this.uniforms.resolution.value.copy(D)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(D){this.uniforms.sizeAttenuation.value=D}},near:{enumerable:!0,get:function(){return this.uniforms.near.value},set:function(D){this.uniforms.near.value=D}},far:{enumerable:!0,get:function(){return this.uniforms.far.value},set:function(D){this.uniforms.far.value=D}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(D){this.uniforms.dashArray.value=D,this.useDash=D!==0?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(D){this.uniforms.dashOffset.value=D}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(D){this.uniforms.dashRatio.value=D}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(D){this.uniforms.useDash.value=D}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(D){this.uniforms.visibility.value=D}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(D){this.uniforms.alphaTest.value=D}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(D){this.uniforms.repeat.value.copy(D)}}}),this.setValues(y)}H.prototype.setMatrixWorld=function(y){this.matrixWorld=y},H.prototype.setGeometry=function(y,D){if(this.widthCallback=D,this.positions=[],this.counters=[],y instanceof I.Geometry)for(var C=0;C<y.vertices.length;C++){var B=y.vertices[C];D=C/y.vertices.length,this.positions.push(B.x,B.y,B.z),this.positions.push(B.x,B.y,B.z),this.counters.push(D),this.counters.push(D)}if(I.BufferGeometry,y instanceof Float32Array||y instanceof Array)for(C=0;C<y.length;C+=3)D=C/y.length,this.positions.push(y[C],y[C+1],y[C+2]),this.positions.push(y[C],y[C+1],y[C+2]),this.counters.push(D),this.counters.push(D);this.process()},H.prototype.raycast=(a=new I.Matrix4,x=new I.Ray,u=new I.Sphere,function(y,D){var C=y.linePrecision,B=C*C,z=this.geometry;if(z.boundingSphere===null&&z.computeBoundingSphere(),u.copy(z.boundingSphere),u.applyMatrix4(this.matrixWorld),y.ray.intersectSphere(u)!==!1){a.getInverse(this.matrixWorld),x.copy(y.ray).applyMatrix4(a);var A=new I.Vector3,S=new I.Vector3,q=new I.Vector3,W=new I.Vector3,_=this instanceof I.LineSegments?2:1;if(z instanceof I.BufferGeometry){var R=z.index,v=z.attributes;if(R!==null)for(var V=R.array,Y=v.position.array,c=0,p=V.length-1;c<p;c+=_){var m=V[c],f=V[c+1];A.fromArray(Y,3*m),S.fromArray(Y,3*f),B<x.distanceSqToSegment(A,S,W,q)||(W.applyMatrix4(this.matrixWorld),(O=y.ray.origin.distanceTo(W))<y.near||O>y.far||D.push({distance:O,point:q.clone().applyMatrix4(this.matrixWorld),index:c,face:null,faceIndex:null,object:this}))}else for(c=0,p=(Y=v.position.array).length/3-1;c<p;c+=_)A.fromArray(Y,3*c),S.fromArray(Y,3*c+3),B<x.distanceSqToSegment(A,S,W,q)||(W.applyMatrix4(this.matrixWorld),(O=y.ray.origin.distanceTo(W))<y.near||O>y.far||D.push({distance:O,point:q.clone().applyMatrix4(this.matrixWorld),index:c,face:null,faceIndex:null,object:this}))}else if(z instanceof I.Geometry){var N=z.vertices,P=N.length;for(c=0;c<P-1;c+=_){var O;B<x.distanceSqToSegment(N[c],N[c+1],W,q)||(W.applyMatrix4(this.matrixWorld),(O=y.ray.origin.distanceTo(W))<y.near||O>y.far||D.push({distance:O,point:q.clone().applyMatrix4(this.matrixWorld),index:c,face:null,faceIndex:null,object:this}))}}}}),H.prototype.compareV3=function(y,D){var C=6*y,B=6*D;return this.positions[C]===this.positions[B]&&this.positions[1+C]===this.positions[1+B]&&this.positions[2+C]===this.positions[2+B]},H.prototype.copyV3=function(y){var D=6*y;return[this.positions[D],this.positions[1+D],this.positions[2+D]]},H.prototype.process=function(){var y,D,C=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(var B=0;B<C;B++)this.side.push(1),this.side.push(-1);for(B=0;B<C;B++)y=this.widthCallback?this.widthCallback(B/(C-1)):1,this.width.push(y),this.width.push(y);for(B=0;B<C;B++)this.uvs.push(B/(C-1),0),this.uvs.push(B/(C-1),1);for(D=this.compareV3(0,C-1)?this.copyV3(C-2):this.copyV3(0),this.previous.push(D[0],D[1],D[2]),this.previous.push(D[0],D[1],D[2]),B=0;B<C-1;B++)D=this.copyV3(B),this.previous.push(D[0],D[1],D[2]),this.previous.push(D[0],D[1],D[2]);for(B=1;B<C;B++)D=this.copyV3(B),this.next.push(D[0],D[1],D[2]),this.next.push(D[0],D[1],D[2]);for(D=this.compareV3(C-1,0)?this.copyV3(1):this.copyV3(C-1),this.next.push(D[0],D[1],D[2]),this.next.push(D[0],D[1],D[2]),B=0;B<C-1;B++){var z=2*B;this.indices_array.push(z,1+z,2+z),this.indices_array.push(2+z,1+z,3+z)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new I.BufferAttribute(new Float32Array(this.positions),3),previous:new I.BufferAttribute(new Float32Array(this.previous),3),next:new I.BufferAttribute(new Float32Array(this.next),3),side:new I.BufferAttribute(new Float32Array(this.side),1),width:new I.BufferAttribute(new Float32Array(this.width),1),uv:new I.BufferAttribute(new Float32Array(this.uvs),2),index:new I.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new I.BufferAttribute(new Float32Array(this.counters),1)},this.geometry.setAttribute("position",this.attributes.position),this.geometry.setAttribute("previous",this.attributes.previous),this.geometry.setAttribute("next",this.attributes.next),this.geometry.setAttribute("side",this.attributes.side),this.geometry.setAttribute("width",this.attributes.width),this.geometry.setAttribute("uv",this.attributes.uv),this.geometry.setAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)},H.prototype.advance=function(y){var D=this.attributes.position.array,C=this.attributes.previous.array,B=this.attributes.next.array,z=D.length;G(D,0,C,0,z),G(D,6,D,0,z-6),D[z-6]=y.x,D[z-5]=y.y,D[z-4]=y.z,D[z-3]=y.x,D[z-2]=y.y,D[z-1]=y.z,G(D,6,B,0,z-6),B[z-6]=y.x,B[z-5]=y.y,B[z-4]=y.z,B[z-3]=y.x,B[z-2]=y.y,B[z-1]=y.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0},I.ShaderChunk.meshline_vert=["",I.ShaderChunk.logdepthbuf_pars_vertex,I.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","	 vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",I.ShaderChunk.logdepthbuf_vertex,I.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",I.ShaderChunk.fog_vertex,"}"].join(`
`),I.ShaderChunk.meshline_frag=["",I.ShaderChunk.fog_pars_fragment,I.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",I.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",I.ShaderChunk.fog_fragment,"}"].join(`
`),((L.prototype=Object.create(I.ShaderMaterial.prototype)).constructor=L).prototype.isMeshLineMaterial=!0,L.prototype.copy=function(y){return I.ShaderMaterial.prototype.copy.call(this,y),this.lineWidth=y.lineWidth,this.map=y.map,this.useMap=y.useMap,this.alphaMap=y.alphaMap,this.useAlphaMap=y.useAlphaMap,this.color.copy(y.color),this.opacity=y.opacity,this.resolution.copy(y.resolution),this.sizeAttenuation=y.sizeAttenuation,this.near=y.near,this.far=y.far,this.dashArray.copy(y.dashArray),this.dashOffset.copy(y.dashOffset),this.dashRatio.copy(y.dashRatio),this.useDash=y.useDash,this.visibility=y.visibility,this.alphaTest=y.alphaTest,this.repeat.copy(y.repeat),this},o!==void 0?(r!==void 0&&r.exports&&(o=r.exports={MeshLine:H,MeshLineMaterial:L}),o.MeshLine=H,o.MeshLineMaterial=L):(this.MeshLine=H,this.MeshLineMaterial=L)}).call(this)},{three:19}],19:[function(T,r,o){var a,x;a=this,x=function(u){Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52)),Number.isInteger===void 0&&(Number.isInteger=function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}),Math.sign===void 0&&(Math.sign=function(e){return e<0?-1:0<e?1:+e}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),Object.assign===void 0&&(Object.assign=function(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i!=null)for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(t[l]=i[l])}return t});var M=100,I=301,H=302,G=304,L=306,y=307,D=1e3,C=1001,B=1002,z=1003,A=1004,S=1005,q=1006,W=1007,_=1008,R=1009,v=1012,V=1014,Y=1015,c=1016,p=1020,m=1022,f=1023,N=f,P=1026,O=1027,Z=33776,te=33777,de=33778,me=33779,we=35840,ge=35841,Le=35842,Pe=35843,ae=2300,ve=2301,Ie=2400,ze=2401,He=2402,at=3e3,tt=3001,le=3007,De=3002,st=3004,gt=3005,St=3006,Rt=7680,Pt=35044,Je=35048;function bt(){}Object.assign(bt.prototype,{addEventListener:function(e,t){this._listeners===void 0&&(this._listeners={});var n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)},hasEventListener:function(e,t){if(this._listeners===void 0)return!1;var n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(this._listeners!==void 0){var n=this._listeners[e];if(n!==void 0){var i=n.indexOf(t);i!==-1&&n.splice(i,1)}}},dispatchEvent:function(e){if(this._listeners!==void 0){var t=this._listeners[e.type];if(t!==void 0){e.target=this;for(var n=t.slice(0),i=0,l=n.length;i<l;i++)n[i].call(this,e)}}}});for(var jt=[],Ln=0;Ln<256;Ln++)jt[Ln]=(Ln<16?"0":"")+Ln.toString(16);var Yt,Qt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(jt[255&e]+jt[e>>8&255]+jt[e>>16&255]+jt[e>>24&255]+"-"+jt[255&t]+jt[t>>8&255]+"-"+jt[t>>16&15|64]+jt[t>>24&255]+"-"+jt[63&n|128]+jt[n>>8&255]+"-"+jt[n>>16&255]+jt[n>>24&255]+jt[255&i]+jt[i>>8&255]+jt[i>>16&255]+jt[i>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,l){return i+(e-t)*(l-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:n<=e?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:n<=e?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Qt.DEG2RAD},radToDeg:function(e){return e*Qt.RAD2DEG},isPowerOfTwo:function(e){return!(e&e-1)&&e!==0},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,l){var h=Math.cos,g=Math.sin,b=h(n/2),k=g(n/2),F=h((t+i)/2),K=g((t+i)/2),Q=h((t-i)/2),ne=g((t-i)/2),U=h((i-t)/2),oe=g((i-t)/2);l==="XYX"?e.set(b*K,k*Q,k*ne,b*F):l==="YZY"?e.set(k*ne,b*K,k*Q,b*F):l==="ZXZ"?e.set(k*Q,k*ne,b*K,b*F):l==="XZX"?e.set(b*K,k*oe,k*U,b*F):l==="YXY"?e.set(k*U,b*K,k*oe,b*F):l==="ZYZ"?e.set(k*oe,k*U,b*K,b*F):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function Ve(e,t){this.x=e||0,this.y=t||0}function Be(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Ve.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Ve.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),i=Math.sin(t),l=this.x-e.x,h=this.y-e.y;return this.x=l*n-h*i+e.x,this.y=l*i+h*n+e.y,this}}),Object.assign(Be.prototype,{isMatrix3:!0,set:function(e,t,n,i,l,h,g,b,k){var F=this.elements;return F[0]=e,F[1]=i,F[2]=g,F[3]=t,F[4]=l,F[5]=b,F[6]=n,F[7]=h,F[8]=k,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,l=this.elements,h=n[0],g=n[3],b=n[6],k=n[1],F=n[4],K=n[7],Q=n[2],ne=n[5],U=n[8],oe=i[0],ue=i[3],pe=i[6],Te=i[1],Oe=i[4],Fe=i[7],Ze=i[2],Ge=i[5],et=i[8];return l[0]=h*oe+g*Te+b*Ze,l[3]=h*ue+g*Oe+b*Ge,l[6]=h*pe+g*Fe+b*et,l[1]=k*oe+F*Te+K*Ze,l[4]=k*ue+F*Oe+K*Ge,l[7]=k*pe+F*Fe+K*et,l[2]=Q*oe+ne*Te+U*Ze,l[5]=Q*ue+ne*Oe+U*Ge,l[8]=Q*pe+ne*Fe+U*et,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],l=e[3],h=e[4],g=e[5],b=e[6],k=e[7],F=e[8];return t*h*F-t*g*k-n*l*F+n*g*b+i*l*k-i*h*b},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,i=this.elements,l=n[0],h=n[1],g=n[2],b=n[3],k=n[4],F=n[5],K=n[6],Q=n[7],ne=n[8],U=ne*k-F*Q,oe=F*K-ne*b,ue=Q*b-k*K,pe=l*U+h*oe+g*ue;if(pe==0){var Te="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(t===!0)throw new Error(Te);return console.warn(Te),this.identity()}var Oe=1/pe;return i[0]=U*Oe,i[1]=(g*Q-ne*h)*Oe,i[2]=(F*h-g*k)*Oe,i[3]=oe*Oe,i[4]=(ne*l-g*K)*Oe,i[5]=(g*b-F*l)*Oe,i[6]=ue*Oe,i[7]=(h*K-Q*l)*Oe,i[8]=(k*l-h*b)*Oe,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,i,l,h,g){var b=Math.cos(l),k=Math.sin(l);this.set(n*b,n*k,-n*(b*h+k*g)+h+e,-i*k,i*b,-i*(-k*h+b*g)+g+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.elements,l=i[0],h=i[3],g=i[6],b=i[1],k=i[4],F=i[7];return i[0]=t*l+n*b,i[3]=t*h+n*k,i[6]=t*g+n*F,i[1]=-n*l+t*b,i[4]=-n*h+t*k,i[7]=-n*g+t*F,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});var Wt={getDataURL:function(e){var t;if(typeof HTMLCanvasElement>"u")return e.src;if(e instanceof HTMLCanvasElement)t=e;else{Yt===void 0&&(Yt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Yt.width=e.width,Yt.height=e.height;var n=Yt.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Yt}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},Kn=0;function nn(e,t,n,i,l,h,g,b,k,F){Object.defineProperty(this,"id",{value:Kn++}),this.uuid=Qt.generateUUID(),this.name="",this.image=e!==void 0?e:nn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=t!==void 0?t:nn.DEFAULT_MAPPING,this.wrapS=n!==void 0?n:C,this.wrapT=i!==void 0?i:C,this.magFilter=l!==void 0?l:q,this.minFilter=h!==void 0?h:_,this.anisotropy=k!==void 0?k:1,this.format=g!==void 0?g:f,this.internalFormat=null,this.type=b!==void 0?b:R,this.offset=new Ve(0,0),this.repeat=new Ve(1,1),this.center=new Ve(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Be,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=F!==void 0?F:at,this.version=0,this.onUpdate=null}function ct(e,t,n,i){this.x=e||0,this.y=t||0,this.z=n||0,this.w=i!==void 0?i:1}function rt(e,t,n){this.width=e,this.height=t,this.scissor=new ct(0,0,e,t),this.scissorTest=!1,this.viewport=new ct(0,0,e,t),n=n||{},this.texture=new nn(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=n.generateMipmaps!==void 0&&n.generateMipmaps,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:q,this.depthBuffer=n.depthBuffer===void 0||n.depthBuffer,this.stencilBuffer=n.stencilBuffer===void 0||n.stencilBuffer,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null}function Zt(e,t,n){rt.call(this,e,t,n),this.samples=4}function bn(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._w=i!==void 0?i:1}nn.DEFAULT_IMAGE=void 0,nn.DEFAULT_MAPPING=300,nn.prototype=Object.assign(Object.create(bt.prototype),{constructor:nn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var i=this.image;if(i.uuid===void 0&&(i.uuid=Qt.generateUUID()),!t&&e.images[i.uuid]===void 0){var l;if(Array.isArray(i)){l=[];for(var h=0,g=i.length;h<g;h++)l.push(Wt.getDataURL(i[h]))}else l=Wt.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:l}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case D:e.x=e.x-Math.floor(e.x);break;case C:e.x=e.x<0?0:1;break;case B:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case D:e.y=e.y-Math.floor(e.y);break;case C:e.y=e.y<0?0:1;break;case B:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(nn.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.defineProperties(ct.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(ct.prototype,{isVector4:!0,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,l=this.w,h=e.elements;return this.x=h[0]*t+h[4]*n+h[8]*i+h[12]*l,this.y=h[1]*t+h[5]*n+h[9]*i+h[13]*l,this.z=h[2]*t+h[6]*n+h[10]*i+h[14]*l,this.w=h[3]*t+h[7]*n+h[11]*i+h[15]*l,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,i,l,h=e.elements,g=h[0],b=h[4],k=h[8],F=h[1],K=h[5],Q=h[9],ne=h[2],U=h[6],oe=h[10];if(Math.abs(b-F)<.01&&Math.abs(k-ne)<.01&&Math.abs(Q-U)<.01){if(Math.abs(b+F)<.1&&Math.abs(k+ne)<.1&&Math.abs(Q+U)<.1&&Math.abs(g+K+oe-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var ue=(g+1)/2,pe=(K+1)/2,Te=(oe+1)/2,Oe=(b+F)/4,Fe=(k+ne)/4,Ze=(Q+U)/4;return pe<ue&&Te<ue?l=ue<.01?(n=0,i=.707106781):(i=Oe/(n=Math.sqrt(ue)),Fe/n):Te<pe?l=pe<.01?(i=0,n=.707106781):(n=Oe/(i=Math.sqrt(pe)),Ze/i):Te<.01?(i=n=.707106781,l=0):(n=Fe/(l=Math.sqrt(Te)),i=Ze/l),this.set(n,i,l,t),this}var Ge=Math.sqrt((U-Q)*(U-Q)+(k-ne)*(k-ne)+(F-b)*(F-b));return Math.abs(Ge)<.001&&(Ge=1),this.x=(U-Q)/Ge,this.y=(k-ne)/Ge,this.z=(F-b)/Ge,this.w=Math.acos((g+K+oe-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),rt.prototype=Object.assign(Object.create(bt.prototype),{constructor:rt,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Zt.prototype=Object.assign(Object.create(rt.prototype),{constructor:Zt,isWebGLMultisampleRenderTarget:!0,copy:function(e){return rt.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign(bn,{slerp:function(e,t,n,i){return n.copy(e).slerp(t,i)},slerpFlat:function(e,t,n,i,l,h,g){var b=n[i+0],k=n[i+1],F=n[i+2],K=n[i+3],Q=l[h+0],ne=l[h+1],U=l[h+2],oe=l[h+3];if(K!==oe||b!==Q||k!==ne||F!==U){var ue=1-g,pe=b*Q+k*ne+F*U+K*oe,Te=0<=pe?1:-1,Oe=1-pe*pe;if(Oe>Number.EPSILON){var Fe=Math.sqrt(Oe),Ze=Math.atan2(Fe,pe*Te);ue=Math.sin(ue*Ze)/Fe,g=Math.sin(g*Ze)/Fe}var Ge=g*Te;if(b=b*ue+Q*Ge,k=k*ue+ne*Ge,F=F*ue+U*Ge,K=K*ue+oe*Ge,ue===1-g){var et=1/Math.sqrt(b*b+k*k+F*F+K*K);b*=et,k*=et,F*=et,K*=et}}e[t]=b,e[t+1]=k,e[t+2]=F,e[t+3]=K}}),Object.defineProperties(bn.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(bn.prototype,{isQuaternion:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,l=e._z,h=e.order,g=Math.cos,b=Math.sin,k=g(n/2),F=g(i/2),K=g(l/2),Q=b(n/2),ne=b(i/2),U=b(l/2);return h==="XYZ"?(this._x=Q*F*K+k*ne*U,this._y=k*ne*K-Q*F*U,this._z=k*F*U+Q*ne*K,this._w=k*F*K-Q*ne*U):h==="YXZ"?(this._x=Q*F*K+k*ne*U,this._y=k*ne*K-Q*F*U,this._z=k*F*U-Q*ne*K,this._w=k*F*K+Q*ne*U):h==="ZXY"?(this._x=Q*F*K-k*ne*U,this._y=k*ne*K+Q*F*U,this._z=k*F*U+Q*ne*K,this._w=k*F*K-Q*ne*U):h==="ZYX"?(this._x=Q*F*K-k*ne*U,this._y=k*ne*K+Q*F*U,this._z=k*F*U-Q*ne*K,this._w=k*F*K+Q*ne*U):h==="YZX"?(this._x=Q*F*K+k*ne*U,this._y=k*ne*K+Q*F*U,this._z=k*F*U-Q*ne*K,this._w=k*F*K-Q*ne*U):h==="XZY"&&(this._x=Q*F*K-k*ne*U,this._y=k*ne*K-Q*F*U,this._z=k*F*U+Q*ne*K,this._w=k*F*K+Q*ne*U),t!==!1&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,i=n[0],l=n[4],h=n[8],g=n[1],b=n[5],k=n[9],F=n[2],K=n[6],Q=n[10],ne=i+b+Q;return 0<ne?(t=.5/Math.sqrt(ne+1),this._w=.25/t,this._x=(K-k)*t,this._y=(h-F)*t,this._z=(g-l)*t):b<i&&Q<i?(t=2*Math.sqrt(1+i-b-Q),this._w=(K-k)/t,this._x=.25*t,this._y=(l+g)/t,this._z=(h+F)/t):Q<b?(t=2*Math.sqrt(1+b-i-Q),this._w=(h-F)/t,this._x=(l+g)/t,this._y=.25*t,this._z=(k+K)/t):(t=2*Math.sqrt(1+Q-i-b),this._w=(g-l)/t,this._x=(h+F)/t,this._y=(k+K)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=n,this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(Qt.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(n===0)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,i=e._y,l=e._z,h=e._w,g=t._x,b=t._y,k=t._z,F=t._w;return this._x=n*F+h*g+i*k-l*b,this._y=i*F+h*b+l*g-n*k,this._z=l*F+h*k+n*b-i*g,this._w=h*F-n*g-i*b-l*k,this._onChangeCallback(),this},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var n=this._x,i=this._y,l=this._z,h=this._w,g=h*e._w+n*e._x+i*e._y+l*e._z;if(g<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,g=-g):this.copy(e),1<=g)return this._w=h,this._x=n,this._y=i,this._z=l,this;var b=1-g*g;if(b<=Number.EPSILON){var k=1-t;return this._w=k*h+t*this._w,this._x=k*n+t*this._x,this._y=k*i+t*this._y,this._z=k*l+t*this._z,this.normalize(),this._onChangeCallback(),this}var F=Math.sqrt(b),K=Math.atan2(F,g),Q=Math.sin((1-t)*K)/F,ne=Math.sin(t*K)/F;return this._w=h*Q+this._w*ne,this._x=n*Q+this._x*ne,this._y=i*Q+this._y*ne,this._z=l*Q+this._z*ne,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return t===void 0&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var Kt=new Se,Zn=new bn;function Se(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}Object.assign(Se.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Zn.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(Zn.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,n=this.y,i=this.z,l=e.elements;return this.x=l[0]*t+l[3]*n+l[6]*i,this.y=l[1]*t+l[4]*n+l[7]*i,this.z=l[2]*t+l[5]*n+l[8]*i,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,l=e.elements,h=1/(l[3]*t+l[7]*n+l[11]*i+l[15]);return this.x=(l[0]*t+l[4]*n+l[8]*i+l[12])*h,this.y=(l[1]*t+l[5]*n+l[9]*i+l[13])*h,this.z=(l[2]*t+l[6]*n+l[10]*i+l[14])*h,this},applyQuaternion:function(e){var t=this.x,n=this.y,i=this.z,l=e.x,h=e.y,g=e.z,b=e.w,k=b*t+h*i-g*n,F=b*n+g*t-l*i,K=b*i+l*n-h*t,Q=-l*t-h*n-g*i;return this.x=k*b+Q*-l+F*-g-K*-h,this.y=F*b+Q*-h+K*-l-k*-g,this.z=K*b+Q*-g+k*-h-F*-l,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,n=this.y,i=this.z,l=e.elements;return this.x=l[0]*t+l[4]*n+l[8]*i,this.y=l[1]*t+l[5]*n+l[9]*i,this.z=l[2]*t+l[6]*n+l[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,i=e.y,l=e.z,h=t.x,g=t.y,b=t.z;return this.x=i*b-l*g,this.y=l*h-n*b,this.z=n*g-i*h,this},projectOnVector:function(e){var t=e.lengthSq();if(t===0)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)},projectOnPlane:function(e){return Kt.copy(this).projectOnVector(e),this.sub(Kt)},reflect:function(e){return this.sub(Kt.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(Qt.clamp(n,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,3*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var Cr=new Se,Xe=new Lt,qe=new Se(0,0,0),ut=new Se(1,1,1),Re=new Se,xt=new Se,qt=new Se;function Lt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Lt.prototype,{isMatrix4:!0,set:function(e,t,n,i,l,h,g,b,k,F,K,Q,ne,U,oe,ue){var pe=this.elements;return pe[0]=e,pe[4]=t,pe[8]=n,pe[12]=i,pe[1]=l,pe[5]=h,pe[9]=g,pe[13]=b,pe[2]=k,pe[6]=F,pe[10]=K,pe[14]=Q,pe[3]=ne,pe[7]=U,pe[11]=oe,pe[15]=ue,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new Lt().fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,n=e.elements,i=1/Cr.setFromMatrixColumn(e,0).length(),l=1/Cr.setFromMatrixColumn(e,1).length(),h=1/Cr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*l,t[5]=n[5]*l,t[6]=n[6]*l,t[7]=0,t[8]=n[8]*h,t[9]=n[9]*h,t[10]=n[10]*h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,l=e.z,h=Math.cos(n),g=Math.sin(n),b=Math.cos(i),k=Math.sin(i),F=Math.cos(l),K=Math.sin(l);if(e.order==="XYZ"){var Q=h*F,ne=h*K,U=g*F,oe=g*K;t[0]=b*F,t[4]=-b*K,t[8]=k,t[1]=ne+U*k,t[5]=Q-oe*k,t[9]=-g*b,t[2]=oe-Q*k,t[6]=U+ne*k,t[10]=h*b}else if(e.order==="YXZ"){var ue=b*F,pe=b*K,Te=k*F,Oe=k*K;t[0]=ue+Oe*g,t[4]=Te*g-pe,t[8]=h*k,t[1]=h*K,t[5]=h*F,t[9]=-g,t[2]=pe*g-Te,t[6]=Oe+ue*g,t[10]=h*b}else if(e.order==="ZXY")ue=b*F,pe=b*K,Te=k*F,Oe=k*K,t[0]=ue-Oe*g,t[4]=-h*K,t[8]=Te+pe*g,t[1]=pe+Te*g,t[5]=h*F,t[9]=Oe-ue*g,t[2]=-h*k,t[6]=g,t[10]=h*b;else if(e.order==="ZYX")Q=h*F,ne=h*K,U=g*F,oe=g*K,t[0]=b*F,t[4]=U*k-ne,t[8]=Q*k+oe,t[1]=b*K,t[5]=oe*k+Q,t[9]=ne*k-U,t[2]=-k,t[6]=g*b,t[10]=h*b;else if(e.order==="YZX"){var Fe=h*b,Ze=h*k,Ge=g*b,et=g*k;t[0]=b*F,t[4]=et-Fe*K,t[8]=Ge*K+Ze,t[1]=K,t[5]=h*F,t[9]=-g*F,t[2]=-k*F,t[6]=Ze*K+Ge,t[10]=Fe-et*K}else e.order==="XZY"&&(Fe=h*b,Ze=h*k,Ge=g*b,et=g*k,t[0]=b*F,t[4]=-K,t[8]=k*F,t[1]=Fe*K+et,t[5]=h*F,t[9]=Ze*K-Ge,t[2]=Ge*K-Ze,t[6]=g*F,t[10]=et*K+Fe);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(qe,e,ut)},lookAt:function(e,t,n){var i=this.elements;return qt.subVectors(e,t),qt.lengthSq()===0&&(qt.z=1),qt.normalize(),Re.crossVectors(n,qt),Re.lengthSq()===0&&(Math.abs(n.z)===1?qt.x+=1e-4:qt.z+=1e-4,qt.normalize(),Re.crossVectors(n,qt)),Re.normalize(),xt.crossVectors(qt,Re),i[0]=Re.x,i[4]=xt.x,i[8]=qt.x,i[1]=Re.y,i[5]=xt.y,i[9]=qt.y,i[2]=Re.z,i[6]=xt.z,i[10]=qt.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,l=this.elements,h=n[0],g=n[4],b=n[8],k=n[12],F=n[1],K=n[5],Q=n[9],ne=n[13],U=n[2],oe=n[6],ue=n[10],pe=n[14],Te=n[3],Oe=n[7],Fe=n[11],Ze=n[15],Ge=i[0],et=i[4],We=i[8],ft=i[12],_t=i[1],Et=i[5],At=i[9],Nt=i[13],Xt=i[2],Tt=i[6],wt=i[10],sn=i[14],gn=i[3],Jn=i[7],Gn=i[11],Nn=i[15];return l[0]=h*Ge+g*_t+b*Xt+k*gn,l[4]=h*et+g*Et+b*Tt+k*Jn,l[8]=h*We+g*At+b*wt+k*Gn,l[12]=h*ft+g*Nt+b*sn+k*Nn,l[1]=F*Ge+K*_t+Q*Xt+ne*gn,l[5]=F*et+K*Et+Q*Tt+ne*Jn,l[9]=F*We+K*At+Q*wt+ne*Gn,l[13]=F*ft+K*Nt+Q*sn+ne*Nn,l[2]=U*Ge+oe*_t+ue*Xt+pe*gn,l[6]=U*et+oe*Et+ue*Tt+pe*Jn,l[10]=U*We+oe*At+ue*wt+pe*Gn,l[14]=U*ft+oe*Nt+ue*sn+pe*Nn,l[3]=Te*Ge+Oe*_t+Fe*Xt+Ze*gn,l[7]=Te*et+Oe*Et+Fe*Tt+Ze*Jn,l[11]=Te*We+Oe*At+Fe*wt+Ze*Gn,l[15]=Te*ft+Oe*Nt+Fe*sn+Ze*Nn,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],l=e[12],h=e[1],g=e[5],b=e[9],k=e[13],F=e[2],K=e[6],Q=e[10],ne=e[14];return e[3]*(l*b*K-i*k*K-l*g*Q+n*k*Q+i*g*ne-n*b*ne)+e[7]*(t*b*ne-t*k*Q+l*h*Q-i*h*ne+i*k*F-l*b*F)+e[11]*(t*k*K-t*g*ne-l*h*K+n*h*ne+l*g*F-n*k*F)+e[15]*(-i*g*F-t*b*K+t*g*Q+i*h*K-n*h*Q+n*b*F)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this},getInverse:function(e,t){var n=this.elements,i=e.elements,l=i[0],h=i[1],g=i[2],b=i[3],k=i[4],F=i[5],K=i[6],Q=i[7],ne=i[8],U=i[9],oe=i[10],ue=i[11],pe=i[12],Te=i[13],Oe=i[14],Fe=i[15],Ze=U*Oe*Q-Te*oe*Q+Te*K*ue-F*Oe*ue-U*K*Fe+F*oe*Fe,Ge=pe*oe*Q-ne*Oe*Q-pe*K*ue+k*Oe*ue+ne*K*Fe-k*oe*Fe,et=ne*Te*Q-pe*U*Q+pe*F*ue-k*Te*ue-ne*F*Fe+k*U*Fe,We=pe*U*K-ne*Te*K-pe*F*oe+k*Te*oe+ne*F*Oe-k*U*Oe,ft=l*Ze+h*Ge+g*et+b*We;if(ft==0){var _t="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(t===!0)throw new Error(_t);return console.warn(_t),this.identity()}var Et=1/ft;return n[0]=Ze*Et,n[1]=(Te*oe*b-U*Oe*b-Te*g*ue+h*Oe*ue+U*g*Fe-h*oe*Fe)*Et,n[2]=(F*Oe*b-Te*K*b+Te*g*Q-h*Oe*Q-F*g*Fe+h*K*Fe)*Et,n[3]=(U*K*b-F*oe*b-U*g*Q+h*oe*Q+F*g*ue-h*K*ue)*Et,n[4]=Ge*Et,n[5]=(ne*Oe*b-pe*oe*b+pe*g*ue-l*Oe*ue-ne*g*Fe+l*oe*Fe)*Et,n[6]=(pe*K*b-k*Oe*b-pe*g*Q+l*Oe*Q+k*g*Fe-l*K*Fe)*Et,n[7]=(k*oe*b-ne*K*b+ne*g*Q-l*oe*Q-k*g*ue+l*K*ue)*Et,n[8]=et*Et,n[9]=(pe*U*b-ne*Te*b-pe*h*ue+l*Te*ue+ne*h*Fe-l*U*Fe)*Et,n[10]=(k*Te*b-pe*F*b+pe*h*Q-l*Te*Q-k*h*Fe+l*F*Fe)*Et,n[11]=(ne*F*b-k*U*b-ne*h*Q+l*U*Q+k*h*ue-l*F*ue)*Et,n[12]=We*Et,n[13]=(ne*Te*g-pe*U*g+pe*h*oe-l*Te*oe-ne*h*Oe+l*U*Oe)*Et,n[14]=(pe*F*g-k*Te*g-pe*h*K+l*Te*K+k*h*Oe-l*F*Oe)*Et,n[15]=(k*U*g-ne*F*g+ne*h*K-l*U*K-k*h*oe+l*F*oe)*Et,this},scale:function(e){var t=this.elements,n=e.x,i=e.y,l=e.z;return t[0]*=n,t[4]*=i,t[8]*=l,t[1]*=n,t[5]*=i,t[9]*=l,t[2]*=n,t[6]*=i,t[10]*=l,t[3]*=n,t[7]*=i,t[11]*=l,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),l=1-n,h=e.x,g=e.y,b=e.z,k=l*h,F=l*g;return this.set(k*h+n,k*g-i*b,k*b+i*g,0,k*g+i*b,F*g+n,F*b-i*h,0,k*b-i*g,F*b+i*h,l*b*b+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var i=this.elements,l=t._x,h=t._y,g=t._z,b=t._w,k=l+l,F=h+h,K=g+g,Q=l*k,ne=l*F,U=l*K,oe=h*F,ue=h*K,pe=g*K,Te=b*k,Oe=b*F,Fe=b*K,Ze=n.x,Ge=n.y,et=n.z;return i[0]=(1-(oe+pe))*Ze,i[1]=(ne+Fe)*Ze,i[2]=(U-Oe)*Ze,i[3]=0,i[4]=(ne-Fe)*Ge,i[5]=(1-(Q+pe))*Ge,i[6]=(ue+Te)*Ge,i[7]=0,i[8]=(U+Oe)*et,i[9]=(ue-Te)*et,i[10]=(1-(Q+oe))*et,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:function(e,t,n){var i=this.elements,l=Cr.set(i[0],i[1],i[2]).length(),h=Cr.set(i[4],i[5],i[6]).length(),g=Cr.set(i[8],i[9],i[10]).length();this.determinant()<0&&(l=-l),e.x=i[12],e.y=i[13],e.z=i[14],Xe.copy(this);var b=1/l,k=1/h,F=1/g;return Xe.elements[0]*=b,Xe.elements[1]*=b,Xe.elements[2]*=b,Xe.elements[4]*=k,Xe.elements[5]*=k,Xe.elements[6]*=k,Xe.elements[8]*=F,Xe.elements[9]*=F,Xe.elements[10]*=F,t.setFromRotationMatrix(Xe),n.x=l,n.y=h,n.z=g,this},makePerspective:function(e,t,n,i,l,h){h===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var g=this.elements,b=2*l/(t-e),k=2*l/(n-i),F=(t+e)/(t-e),K=(n+i)/(n-i),Q=-(h+l)/(h-l),ne=-2*h*l/(h-l);return g[0]=b,g[4]=0,g[8]=F,g[12]=0,g[1]=0,g[5]=k,g[9]=K,g[13]=0,g[2]=0,g[6]=0,g[10]=Q,g[14]=ne,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this},makeOrthographic:function(e,t,n,i,l,h){var g=this.elements,b=1/(t-e),k=1/(n-i),F=1/(h-l),K=(t+e)*b,Q=(n+i)*k,ne=(h+l)*F;return g[0]=2*b,g[4]=0,g[8]=0,g[12]=-K,g[1]=0,g[5]=2*k,g[9]=0,g[13]=-Q,g[2]=0,g[6]=0,g[10]=-2*F,g[14]=-ne,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});var En=new Lt,yr=new bn;function pr(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._order=i||pr.DefaultOrder}function Mr(){this.mask=1}pr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],pr.DefaultOrder="XYZ",Object.defineProperties(pr.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(pr.prototype,{isEuler:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var i=Qt.clamp,l=e.elements,h=l[0],g=l[4],b=l[8],k=l[1],F=l[5],K=l[9],Q=l[2],ne=l[6],U=l[10];return(t=t||this._order)==="XYZ"?(this._y=Math.asin(i(b,-1,1)),Math.abs(b)<.9999999?(this._x=Math.atan2(-K,U),this._z=Math.atan2(-g,h)):(this._x=Math.atan2(ne,F),this._z=0)):t==="YXZ"?(this._x=Math.asin(-i(K,-1,1)),Math.abs(K)<.9999999?(this._y=Math.atan2(b,U),this._z=Math.atan2(k,F)):(this._y=Math.atan2(-Q,h),this._z=0)):t==="ZXY"?(this._x=Math.asin(i(ne,-1,1)),Math.abs(ne)<.9999999?(this._y=Math.atan2(-Q,U),this._z=Math.atan2(-g,F)):(this._y=0,this._z=Math.atan2(k,h))):t==="ZYX"?(this._y=Math.asin(-i(Q,-1,1)),Math.abs(Q)<.9999999?(this._x=Math.atan2(ne,U),this._z=Math.atan2(k,h)):(this._x=0,this._z=Math.atan2(-g,F))):t==="YZX"?(this._z=Math.asin(i(k,-1,1)),Math.abs(k)<.9999999?(this._x=Math.atan2(-K,F),this._y=Math.atan2(-Q,h)):(this._x=0,this._y=Math.atan2(b,U))):t==="XZY"?(this._z=Math.asin(-i(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(ne,F),this._y=Math.atan2(b,h)):(this._x=Math.atan2(-K,U),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,n!==!1&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,n){return En.makeRotationFromQuaternion(e),this.setFromRotationMatrix(En,t,n)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return yr.setFromEuler(this),this.setFromQuaternion(yr,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Se(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(Mr.prototype,{set:function(e){this.mask=1<<e},enable:function(e){this.mask|=1<<e},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e},disable:function(e){this.mask&=~(1<<e)},disableAll:function(){this.mask=0},test:function(e){return!!(this.mask&e.mask)}});var Si=0,ci=new Se,Ni=new bn,Jr=new Lt,ai=new Se,hr=new Se,xi=new Se,J=new bn,Lr=new Se(1,0,0),Pi=new Se(0,1,0),zn=new Se(0,0,1),Zi={type:"added"},mo={type:"removed"};function mn(){Object.defineProperty(this,"id",{value:Si++}),this.uuid=Qt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=mn.DefaultUp.clone();var e=new Se,t=new pr,n=new bn,i=new Se(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Lt},normalMatrix:{value:new Be}}),this.matrix=new Lt,this.matrixWorld=new Lt,this.matrixAutoUpdate=mn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Mr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Ca(){mn.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}mn.DefaultUp=new Se(0,1,0),mn.DefaultMatrixAutoUpdate=!0,mn.prototype=Object.assign(Object.create(bt.prototype),{constructor:mn,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return Ni.setFromAxisAngle(e,t),this.quaternion.multiply(Ni),this},rotateOnWorldAxis:function(e,t){return Ni.setFromAxisAngle(e,t),this.quaternion.premultiply(Ni),this},rotateX:function(e){return this.rotateOnAxis(Lr,e)},rotateY:function(e){return this.rotateOnAxis(Pi,e)},rotateZ:function(e){return this.rotateOnAxis(zn,e)},translateOnAxis:function(e,t){return ci.copy(e).applyQuaternion(this.quaternion),this.position.add(ci.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(Lr,e)},translateY:function(e){return this.translateOnAxis(Pi,e)},translateZ:function(e){return this.translateOnAxis(zn,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(Jr.getInverse(this.matrixWorld))},lookAt:function(e,t,n){e.isVector3?ai.copy(e):ai.set(e,t,n);var i=this.parent;this.updateWorldMatrix(!0,!1),hr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Jr.lookAt(hr,ai,this.up):Jr.lookAt(ai,hr,this.up),this.quaternion.setFromRotationMatrix(Jr),i&&(Jr.extractRotation(i.matrixWorld),Ni.setFromRotationMatrix(Jr),this.quaternion.premultiply(Ni.inverse()))},add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),(e.parent=this).children.push(e),e.dispatchEvent(Zi)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(mo)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),Jr.getInverse(this.matrixWorld),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Jr.multiply(e.parent.matrixWorld)),e.applyMatrix4(Jr),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var l=this.children[n].getObjectByProperty(e,t);if(l!==void 0)return l}},getWorldPosition:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Se),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new bn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(hr,e,xi),e},getWorldScale:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Se),this.updateMatrixWorld(!0),this.matrixWorld.decompose(hr,J,e),e},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Se),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e=!(this.matrixWorldNeedsUpdate=!1));for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0)for(var i=this.children,l=0,h=i.length;l<h;l++)i[l].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function l(pe,Te){return pe[Te.uuid]===void 0&&(pe[Te.uuid]=Te.toJSON(e)),Te.uuid}if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){i.geometry=l(e.geometries,this.geometry);var h=this.geometry.parameters;if(h!==void 0&&h.shapes!==void 0){var g=h.shapes;if(Array.isArray(g))for(var b=0,k=g.length;b<k;b++){var F=g[b];l(e.shapes,F)}else l(e.shapes,g)}}if(this.material!==void 0)if(Array.isArray(this.material)){var K=[];for(b=0,k=this.material.length;b<k;b++)K.push(l(e.materials,this.material[b]));i.material=K}else i.material=l(e.materials,this.material);if(0<this.children.length)for(i.children=[],b=0;b<this.children.length;b++)i.children.push(this.children[b].toJSON(e).object);if(t){var Q=ue(e.geometries),ne=ue(e.materials),U=ue(e.textures),oe=ue(e.images);g=ue(e.shapes),0<Q.length&&(n.geometries=Q),0<ne.length&&(n.materials=ne),0<U.length&&(n.textures=U),0<oe.length&&(n.images=oe),0<g.length&&(n.shapes=g)}return n.object=i,n;function ue(pe){var Te=[];for(var Oe in pe){var Fe=pe[Oe];delete Fe.metadata,Te.push(Fe)}return Te}},clone:function(e){return new this.constructor().copy(this,e)},copy:function(e,t){if(t===void 0&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(var n=0;n<e.children.length;n++){var i=e.children[n];this.add(i.clone())}return this}}),Ca.prototype=Object.assign(Object.create(mn.prototype),{constructor:Ca,isScene:!0,copy:function(e,t){return mn.prototype.copy.call(this,e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=mn.prototype.toJSON.call(this,e);return this.background!==null&&(t.object.background=this.background.toJSON(e)),this.environment!==null&&(t.object.environment=this.environment.toJSON(e)),this.fog!==null&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ka=[new Se,new Se,new Se,new Se,new Se,new Se,new Se,new Se],Sa=new Se,Co=new Oi,Vi=new Se,Wa=new Se,Ki=new Se,ja=new Se,Ja=new Se,ra=new Se,go=new Se,ia=new Se,So=new Se,aa=new Se;function Oi(e,t){this.min=e!==void 0?e:new Se(1/0,1/0,1/0),this.max=t!==void 0?t:new Se(-1/0,-1/0,-1/0)}function zr(e,t,n,i,l){var h,g;for(h=0,g=e.length-3;h<=g;h+=3){aa.fromArray(e,h);var b=l.x*Math.abs(aa.x)+l.y*Math.abs(aa.y)+l.z*Math.abs(aa.z),k=t.dot(aa),F=n.dot(aa),K=i.dot(aa);if(Math.max(-Math.max(k,F,K),Math.min(k,F,K))>b)return!1}return!0}Object.assign(Oi.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,i=1/0,l=-1/0,h=-1/0,g=-1/0,b=0,k=e.length;b<k;b+=3){var F=e[b],K=e[b+1],Q=e[b+2];F<t&&(t=F),K<n&&(n=K),Q<i&&(i=Q),l<F&&(l=F),h<K&&(h=K),g<Q&&(g=Q)}return this.min.set(t,n,i),this.max.set(l,h,g),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,i=1/0,l=-1/0,h=-1/0,g=-1/0,b=0,k=e.count;b<k;b++){var F=e.getX(b),K=e.getY(b),Q=e.getZ(b);F<t&&(t=F),K<n&&(n=K),Q<i&&(i=Q),l<F&&(l=F),h<K&&(h=K),g<Q&&(g=Q)}return this.min.set(t,n,i),this.max.set(l,h,g),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=Sa.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Se),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Se),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),Co.copy(t.boundingBox),Co.applyMatrix4(e.matrixWorld),this.expandByPoint(Co.min),this.expandByPoint(Co.max));for(var n=e.children,i=0,l=n.length;i<l;i++)this.expandByObject(n[i]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Se),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,Sa),Sa.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,n;return n=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(go),ia.subVectors(this.max,go),Vi.subVectors(e.a,go),Wa.subVectors(e.b,go),Ki.subVectors(e.c,go),ja.subVectors(Wa,Vi),Ja.subVectors(Ki,Wa),ra.subVectors(Vi,Ki);var t=[0,-ja.z,ja.y,0,-Ja.z,Ja.y,0,-ra.z,ra.y,ja.z,0,-ja.x,Ja.z,0,-Ja.x,ra.z,0,-ra.x,-ja.y,ja.x,0,-Ja.y,Ja.x,0,-ra.y,ra.x,0];return!!zr(t,Vi,Wa,Ki,ia)&&!!zr(t=[1,0,0,0,1,0,0,0,1],Vi,Wa,Ki,ia)&&(So.crossVectors(ja,Ja),zr(t=[So.x,So.y,So.z],Vi,Wa,Ki,ia))},clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Se),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Sa.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return e===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(Sa).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(ka[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ka[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ka[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ka[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ka[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ka[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ka[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ka[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ka)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Sr=new Oi;function xa(e,t){this.center=e!==void 0?e:new Se,this.radius=t!==void 0?t:0}Object.assign(xa.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var n=this.center;t!==void 0?n.copy(t):Sr.setFromPoints(e).getCenter(n);for(var i=0,l=0,h=e.length;l<h;l++)i=Math.max(i,n.distanceToSquared(e[l]));return this.radius=Math.sqrt(i),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return t===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Se),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return e===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Oi),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var Da=new Se,Do=new Se,ro=new Se,ui=new Se,kr=new Se,ee=new Se,Ce=new Se;function se(e,t){this.origin=e!==void 0?e:new Se,this.direction=t!==void 0?t:new Se(0,0,-1)}Object.assign(se.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return t===void 0&&(console.warn("THREE.Ray: .at() target is now required"),t=new Se),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,Da)),this},closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Se),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=Da.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Da.copy(this.direction).multiplyScalar(t).add(this.origin),Da.distanceToSquared(e))},distanceSqToSegment:function(e,t,n,i){Do.copy(e).add(t).multiplyScalar(.5),ro.copy(t).sub(e).normalize(),ui.copy(this.origin).sub(Do);var l,h,g,b,k=.5*e.distanceTo(t),F=-this.direction.dot(ro),K=ui.dot(this.direction),Q=-ui.dot(ro),ne=ui.lengthSq(),U=Math.abs(1-F*F);if(0<U)if(h=F*K-Q,b=k*U,0<=(l=F*Q-K))if(-b<=h)if(h<=b){var oe=1/U;g=(l*=oe)*(l+F*(h*=oe)+2*K)+h*(F*l+h+2*Q)+ne}else h=k,g=-(l=Math.max(0,-(F*h+K)))*l+h*(h+2*Q)+ne;else h=-k,g=-(l=Math.max(0,-(F*h+K)))*l+h*(h+2*Q)+ne;else g=h<=-b?-(l=Math.max(0,-(-F*k+K)))*l+(h=0<l?-k:Math.min(Math.max(-k,-Q),k))*(h+2*Q)+ne:h<=b?(l=0,(h=Math.min(Math.max(-k,-Q),k))*(h+2*Q)+ne):-(l=Math.max(0,-(F*k+K)))*l+(h=0<l?k:Math.min(Math.max(-k,-Q),k))*(h+2*Q)+ne;else h=0<F?-k:k,g=-(l=Math.max(0,-(F*h+K)))*l+h*(h+2*Q)+ne;return n&&n.copy(this.direction).multiplyScalar(l).add(this.origin),i&&i.copy(ro).multiplyScalar(h).add(Do),g},intersectSphere:function(e,t){Da.subVectors(e.center,this.origin);var n=Da.dot(this.direction),i=Da.dot(Da)-n*n,l=e.radius*e.radius;if(l<i)return null;var h=Math.sqrt(l-i),g=n-h,b=n+h;return g<0&&b<0?null:g<0?this.at(b,t):this.at(g,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=n?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return n===null?null:this.at(n,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var n,i,l,h,g,b,k=1/this.direction.x,F=1/this.direction.y,K=1/this.direction.z,Q=this.origin;return i=0<=k?(n=(e.min.x-Q.x)*k,(e.max.x-Q.x)*k):(n=(e.max.x-Q.x)*k,(e.min.x-Q.x)*k),(h=0<=F?(l=(e.min.y-Q.y)*F,(e.max.y-Q.y)*F):(l=(e.max.y-Q.y)*F,(e.min.y-Q.y)*F))<n||i<l?null:((n<l||n!=n)&&(n=l),(h<i||i!=i)&&(i=h),(b=0<=K?(g=(e.min.z-Q.z)*K,(e.max.z-Q.z)*K):(g=(e.max.z-Q.z)*K,(e.min.z-Q.z)*K))<n||i<g?null:((n<g||n!=n)&&(n=g),(b<i||i!=i)&&(i=b),i<0?null:this.at(0<=n?n:i,t)))},intersectsBox:function(e){return this.intersectBox(e,Da)!==null},intersectTriangle:function(e,t,n,i,l){kr.subVectors(t,e),ee.subVectors(n,e),Ce.crossVectors(kr,ee);var h,g=this.direction.dot(Ce);if(0<g){if(i)return null;h=1}else{if(!(g<0))return null;h=-1,g=-g}ui.subVectors(this.origin,e);var b=h*this.direction.dot(ee.crossVectors(ui,ee));if(b<0)return null;var k=h*this.direction.dot(kr.cross(ui));if(k<0||g<b+k)return null;var F=-h*ui.dot(Ce);return F<0?null:this.at(F/g,l)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var _e=new Se,Ke=new Se,mt=new Be;function It(e,t){this.normal=e!==void 0?e:new Se(1,0,0),this.constant=t!==void 0?t:0}Object.assign(It.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,n){var i=_e.subVectors(n,t).cross(Ke.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return t===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Se),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){t===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Se);var n=e.delta(_e),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):void 0;var l=-(e.start.dot(this.normal)+this.constant)/i;return l<0||1<l?void 0:t.copy(n).multiplyScalar(l).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&0<n||n<0&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return e===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Se),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var n=t||mt.getNormalMatrix(e),i=this.coplanarPoint(_e).applyMatrix4(e),l=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(l),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var Gt=new Se,Mn=new Se,Vn=new Se,qn=new Se,$r=new Se,ha=new Se,wi=new Se,hs=new Se,io=new Se,ao=new Se;function Di(e,t,n){this.a=e!==void 0?e:new Se,this.b=t!==void 0?t:new Se,this.c=n!==void 0?n:new Se}Object.assign(Di,{getNormal:function(e,t,n,i){i===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Se),i.subVectors(n,t),Gt.subVectors(e,t),i.cross(Gt);var l=i.lengthSq();return 0<l?i.multiplyScalar(1/Math.sqrt(l)):i.set(0,0,0)},getBarycoord:function(e,t,n,i,l){Gt.subVectors(i,t),Mn.subVectors(n,t),Vn.subVectors(e,t);var h=Gt.dot(Gt),g=Gt.dot(Mn),b=Gt.dot(Vn),k=Mn.dot(Mn),F=Mn.dot(Vn),K=h*k-g*g;if(l===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),l=new Se),K==0)return l.set(-2,-1,-1);var Q=1/K,ne=(k*b-g*F)*Q,U=(h*F-g*b)*Q;return l.set(1-ne-U,U,ne)},containsPoint:function(e,t,n,i){return Di.getBarycoord(e,t,n,i,qn),0<=qn.x&&0<=qn.y&&qn.x+qn.y<=1},getUV:function(e,t,n,i,l,h,g,b){return this.getBarycoord(e,t,n,i,qn),b.set(0,0),b.addScaledVector(l,qn.x),b.addScaledVector(h,qn.y),b.addScaledVector(g,qn.z),b},isFrontFacing:function(e,t,n,i){return Gt.subVectors(n,t),Mn.subVectors(e,t),Gt.cross(Mn).dot(i)<0}}),Object.assign(Di.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return Gt.subVectors(this.c,this.b),Mn.subVectors(this.a,this.b),.5*Gt.cross(Mn).length()},getMidpoint:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Se),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Di.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new It),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Di.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,n,i,l){return Di.getUV(e,this.a,this.b,this.c,t,n,i,l)},containsPoint:function(e){return Di.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return Di.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Se);var n,i,l=this.a,h=this.b,g=this.c;$r.subVectors(h,l),ha.subVectors(g,l),hs.subVectors(e,l);var b=$r.dot(hs),k=ha.dot(hs);if(b<=0&&k<=0)return t.copy(l);io.subVectors(e,h);var F=$r.dot(io),K=ha.dot(io);if(0<=F&&K<=F)return t.copy(h);var Q=b*K-F*k;if(Q<=0&&0<=b&&F<=0)return n=b/(b-F),t.copy(l).addScaledVector($r,n);ao.subVectors(e,g);var ne=$r.dot(ao),U=ha.dot(ao);if(0<=U&&ne<=U)return t.copy(g);var oe=ne*k-b*U;if(oe<=0&&0<=k&&U<=0)return i=k/(k-U),t.copy(l).addScaledVector(ha,i);var ue=F*U-ne*K;if(ue<=0&&0<=K-F&&0<=ne-U)return wi.subVectors(g,h),i=(K-F)/(K-F+(ne-U)),t.copy(h).addScaledVector(wi,i);var pe=1/(ue+oe+Q);return n=oe*pe,i=Q*pe,t.copy(l).addScaledVector($r,n).addScaledVector(ha,i)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var Qr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Fi={h:0,s:0,l:0},Uo={h:0,s:0,l:0};function Cn(e,t,n){return t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}function ps(e,t,n){return n<0&&(n+=1),1<n&&--n,n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Zl(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function dl(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function qa(e,t,n,i,l,h){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new Se,this.vertexNormals=Array.isArray(i)?i:[],this.color=l&&l.isColor?l:new Cn,this.vertexColors=Array.isArray(l)?l:[],this.materialIndex=h!==void 0?h:0}Object.assign(Cn.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(e=Qt.euclideanModulo(e,1),t=Qt.clamp(t,0,1),n=Qt.clamp(n,0,1),t===0)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+t):n+t-n*t,l=2*n-i;this.r=ps(l,i,e+1/3),this.g=ps(l,i,e),this.b=ps(l,i,e-1/3)}return this},setStyle:function(e){function t(Q){Q!==void 0&&parseFloat(Q)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,l=n[1],h=n[2];switch(l){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(h))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(h))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(h)){var g=parseFloat(i[1])/360,b=parseInt(i[2],10)/100,k=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(g,b,k)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var F=n[1],K=F.length;if(K===3)return this.r=parseInt(F.charAt(0)+F.charAt(0),16)/255,this.g=parseInt(F.charAt(1)+F.charAt(1),16)/255,this.b=parseInt(F.charAt(2)+F.charAt(2),16)/255,this;if(K===6)return this.r=parseInt(F.charAt(0)+F.charAt(1),16)/255,this.g=parseInt(F.charAt(2)+F.charAt(3),16)/255,this.b=parseInt(F.charAt(4)+F.charAt(5),16)/255,this}return e&&0<e.length?this.setColorName(e):this},setColorName:function(e){var t=Qr[e];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return t===void 0&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){t===void 0&&(t=2);var n=0<t?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=Zl(e.r),this.g=Zl(e.g),this.b=Zl(e.b),this},copyLinearToSRGB:function(e){return this.r=dl(e.r),this.g=dl(e.g),this.b=dl(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){e===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,i=this.r,l=this.g,h=this.b,g=Math.max(i,l,h),b=Math.min(i,l,h),k=(b+g)/2;if(b===g)n=t=0;else{var F=g-b;switch(n=k<=.5?F/(g+b):F/(2-g-b),g){case i:t=(l-h)/F+(l<h?6:0);break;case l:t=(h-i)/F+2;break;case h:t=(i-l)/F+4}t/=6}return e.h=t,e.s=n,e.l=k,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){return this.getHSL(Fi),Fi.h+=e,Fi.s+=t,Fi.l+=n,this.setHSL(Fi.h,Fi.s,Fi.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(Fi),e.getHSL(Uo);var n=Qt.lerp(Fi.h,Uo.h,t),i=Qt.lerp(Fi.s,Uo.s,t),l=Qt.lerp(Fi.l,Uo.l,t);return this.setHSL(n,i,l),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return t===void 0&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Cn.NAMES=Qr,Object.assign(qa.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var ds=0;function rr(){Object.defineProperty(this,"id",{value:ds++}),this.uuid=Qt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=M,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Rt,this.stencilZFail=Rt,this.stencilZPass=Rt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Xa(e){rr.call(this),this.type="MeshBasicMaterial",this.color=new Cn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}rr.prototype=Object.assign(Object.create(bt.prototype),{constructor:rr,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(e!==void 0)for(var t in e){var n=e[t];if(n!==void 0)if(t!=="shading"){var i=this[t];i!==void 0?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===1;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(g){var b=[];for(var k in g){var F=g[k];delete F.metadata,b.push(F)}return b}if(n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,this.combine!==void 0&&(n.combine=this.combine),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.size!==void 0&&(n.size=this.size),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(n.blending=this.blending),this.flatShading===!0&&(n.flatShading=this.flatShading),this.side!==0&&(n.side=this.side),this.vertexColors!==0&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),0<this.alphaTest&&(n.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),1<this.wireframeLinewidth&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(n.morphTargets=!0),this.morphNormals===!0&&(n.morphNormals=!0),this.skinning===!0&&(n.skinning=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),t){var l=i(e.textures),h=i(e.images);0<l.length&&(n.textures=l),0<h.length&&(n.images=h)}return n},clone:function(){return new this.constructor().copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(t!==null){var i=t.length;n=new Array(i);for(var l=0;l!==i;++l)n[l]=t[l].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(rr.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),((Xa.prototype=Object.create(rr.prototype)).constructor=Xa).prototype.isMeshBasicMaterial=!0,Xa.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var qr=new Se;function $n(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=Pt,this.updateRange={offset:0,count:-1},this.version=0}function fs(e,t,n){$n.call(this,new Int8Array(e),t,n)}function ms(e,t,n){$n.call(this,new Uint8Array(e),t,n)}function Eo(e,t,n){$n.call(this,new Uint8ClampedArray(e),t,n)}function Ho(e,t,n){$n.call(this,new Int16Array(e),t,n)}function yo(e,t,n){$n.call(this,new Uint16Array(e),t,n)}function $i(e,t,n){$n.call(this,new Int32Array(e),t,n)}function vo(e,t,n){$n.call(this,new Uint32Array(e),t,n)}function ln(e,t,n){$n.call(this,new Float32Array(e),t,n)}function ks(e,t,n){$n.call(this,new Float64Array(e),t,n)}function Wo(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Kl(e){if(e.length===0)return-1/0;for(var t=e[0],n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}Object.defineProperty($n.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.assign($n.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,l=this.itemSize;i<l;i++)this.array[e+i]=t.array[n+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,i=0,l=e.length;i<l;i++){var h=e[i];h===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),h=new Cn),t[n++]=h.r,t[n++]=h.g,t[n++]=h.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,i=0,l=e.length;i<l;i++){var h=e[i];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),h=new Ve),t[n++]=h.x,t[n++]=h.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,i=0,l=e.length;i<l;i++){var h=e[i];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),h=new Se),t[n++]=h.x,t[n++]=h.y,t[n++]=h.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,i=0,l=e.length;i<l;i++){var h=e[i];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),h=new ct),t[n++]=h.x,t[n++]=h.y,t[n++]=h.z,t[n++]=h.w}return this},applyMatrix3:function(e){for(var t=0,n=this.count;t<n;t++)qr.x=this.getX(t),qr.y=this.getY(t),qr.z=this.getZ(t),qr.applyMatrix3(e),this.setXYZ(t,qr.x,qr.y,qr.z);return this},applyMatrix4:function(e){for(var t=0,n=this.count;t<n;t++)qr.x=this.getX(t),qr.y=this.getY(t),qr.z=this.getZ(t),qr.applyMatrix4(e),this.setXYZ(t,qr.x,qr.y,qr.z);return this},applyNormalMatrix:function(e){for(var t=0,n=this.count;t<n;t++)qr.x=this.getX(t),qr.y=this.getY(t),qr.z=this.getZ(t),qr.applyNormalMatrix(e),this.setXYZ(t,qr.x,qr.y,qr.z);return this},transformDirection:function(e){for(var t=0,n=this.count;t<n;t++)qr.x=this.getX(t),qr.y=this.getY(t),qr.z=this.getZ(t),qr.transformDirection(e),this.setXYZ(t,qr.x,qr.y,qr.z);return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.itemSize<3?0:this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,l){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=l,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),(fs.prototype=Object.create($n.prototype)).constructor=fs,(ms.prototype=Object.create($n.prototype)).constructor=ms,(Eo.prototype=Object.create($n.prototype)).constructor=Eo,(Ho.prototype=Object.create($n.prototype)).constructor=Ho,(yo.prototype=Object.create($n.prototype)).constructor=yo,($i.prototype=Object.create($n.prototype)).constructor=$i,(vo.prototype=Object.create($n.prototype)).constructor=vo,(ln.prototype=Object.create($n.prototype)).constructor=ln,(ks.prototype=Object.create($n.prototype)).constructor=ks,Object.assign(Wo.prototype,{computeGroups:function(e){for(var t,n=[],i=void 0,l=e.faces,h=0;h<l.length;h++){var g=l[h];g.materialIndex!==i&&(i=g.materialIndex,t!==void 0&&(t.count=3*h-t.start,n.push(t)),t={start:3*h,materialIndex:i})}t!==void 0&&(t.count=3*h-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,n=e.faces,i=e.vertices,l=e.faceVertexUvs,h=l[0]&&0<l[0].length,g=l[1]&&0<l[1].length,b=e.morphTargets,k=b.length;if(0<k){t=[];for(var F=0;F<k;F++)t[F]={name:b[F].name,data:[]};this.morphTargets.position=t}var K,Q=e.morphNormals,ne=Q.length;if(0<ne){for(K=[],F=0;F<ne;F++)K[F]={name:Q[F].name,data:[]};this.morphTargets.normal=K}var U=e.skinIndices,oe=e.skinWeights,ue=U.length===i.length,pe=oe.length===i.length;for(0<i.length&&n.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),F=0;F<n.length;F++){var Te=n[F];this.vertices.push(i[Te.a],i[Te.b],i[Te.c]);var Oe=Te.vertexNormals;if(Oe.length===3)this.normals.push(Oe[0],Oe[1],Oe[2]);else{var Fe=Te.normal;this.normals.push(Fe,Fe,Fe)}var Ze,Ge=Te.vertexColors;if(Ge.length===3)this.colors.push(Ge[0],Ge[1],Ge[2]);else{var et=Te.color;this.colors.push(et,et,et)}h===!0&&((Ze=l[0][F])!==void 0?this.uvs.push(Ze[0],Ze[1],Ze[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",F),this.uvs.push(new Ve,new Ve,new Ve))),g===!0&&((Ze=l[1][F])!==void 0?this.uvs2.push(Ze[0],Ze[1],Ze[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",F),this.uvs2.push(new Ve,new Ve,new Ve)));for(var We=0;We<k;We++){var ft=b[We].vertices;t[We].data.push(ft[Te.a],ft[Te.b],ft[Te.c])}for(We=0;We<ne;We++){var _t=Q[We].vertexNormals[F];K[We].data.push(_t.a,_t.b,_t.c)}ue&&this.skinIndices.push(U[Te.a],U[Te.b],U[Te.c]),pe&&this.skinWeights.push(oe[Te.a],oe[Te.b],oe[Te.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}});var iu=2147483647,Na=new Lt,Ao=new mn,Po=new Se,wa=new Oi,w=new Oi,E=new Se;function X(){Object.defineProperty(this,"id",{value:iu+=2}),this.uuid=Qt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}X.prototype=Object.assign(Object.create(bt.prototype),{constructor:X,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(65535<Kl(e)?vo:yo)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:n!==void 0?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(n!==void 0){var i=new Be().getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}var l=this.attributes.tangent;return l!==void 0&&(l.transformDirection(e),l.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(e){return Na.makeRotationX(e),this.applyMatrix4(Na),this},rotateY:function(e){return Na.makeRotationY(e),this.applyMatrix4(Na),this},rotateZ:function(e){return Na.makeRotationZ(e),this.applyMatrix4(Na),this},translate:function(e,t,n){return Na.makeTranslation(e,t,n),this.applyMatrix4(Na),this},scale:function(e,t,n){return Na.makeScale(e,t,n),this.applyMatrix4(Na),this},lookAt:function(e){return Ao.lookAt(e),Ao.updateMatrix(),this.applyMatrix4(Ao.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Po).negate(),this.translate(Po.x,Po.y,Po.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new ln(3*t.vertices.length,3),i=new ln(3*t.colors.length,3);if(this.setAttribute("position",n.copyVector3sArray(t.vertices)),this.setAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var l=new ln(t.lineDistances.length,1);this.setAttribute("lineDistance",l.copyArray(t.lineDistances))}t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var l=e[n];t.push(l.x,l.y,l.z||0)}return this.setAttribute("position",new ln(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var i=n.__directGeometry;if(n.elementsNeedUpdate===!0&&(i=void 0,n.elementsNeedUpdate=!1),i===void 0)return this.fromGeometry(n);i.verticesNeedUpdate=n.verticesNeedUpdate,i.normalsNeedUpdate=n.normalsNeedUpdate,i.colorsNeedUpdate=n.colorsNeedUpdate,i.uvsNeedUpdate=n.uvsNeedUpdate,i.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=i}return n.verticesNeedUpdate===!0&&((t=this.attributes.position)!==void 0&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),n.normalsNeedUpdate===!0&&((t=this.attributes.normal)!==void 0&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),n.colorsNeedUpdate===!0&&((t=this.attributes.color)!==void 0&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&((t=this.attributes.uv)!==void 0&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&((t=this.attributes.lineDistance)!==void 0&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new Wo().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new $n(t,3).copyVector3sArray(e.vertices)),0<e.normals.length){var n=new Float32Array(3*e.normals.length);this.setAttribute("normal",new $n(n,3).copyVector3sArray(e.normals))}if(0<e.colors.length){var i=new Float32Array(3*e.colors.length);this.setAttribute("color",new $n(i,3).copyColorsArray(e.colors))}if(0<e.uvs.length){var l=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new $n(l,2).copyVector2sArray(e.uvs))}if(0<e.uvs2.length){var h=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new $n(h,2).copyVector2sArray(e.uvs2))}for(var g in this.groups=e.groups,e.morphTargets){for(var b=[],k=e.morphTargets[g],F=0,K=k.length;F<K;F++){var Q=k[F],ne=new ln(3*Q.data.length,3);ne.name=Q.name,b.push(ne.copyVector3sArray(Q.data))}this.morphAttributes[g]=b}if(0<e.skinIndices.length){var U=new ln(4*e.skinIndices.length,4);this.setAttribute("skinIndex",U.copyVector4sArray(e.skinIndices))}if(0<e.skinWeights.length){var oe=new ln(4*e.skinWeights.length,4);this.setAttribute("skinWeight",oe.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Oi);var e=this.attributes.position,t=this.morphAttributes.position;if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var l=t[n];wa.setFromBufferAttribute(l),this.morphTargetsRelative?(E.addVectors(this.boundingBox.min,wa.min),this.boundingBox.expandByPoint(E),E.addVectors(this.boundingBox.max,wa.max),this.boundingBox.expandByPoint(E)):(this.boundingBox.expandByPoint(wa.min),this.boundingBox.expandByPoint(wa.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new xa);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var n=this.boundingSphere.center;if(wa.setFromBufferAttribute(e),t)for(var i=0,l=t.length;i<l;i++){var h=t[i];w.setFromBufferAttribute(h),this.morphTargetsRelative?(E.addVectors(wa.min,w.min),wa.expandByPoint(E),E.addVectors(wa.max,w.max),wa.expandByPoint(E)):(wa.expandByPoint(w.min),wa.expandByPoint(w.max))}wa.getCenter(n);var g=0;for(i=0,l=e.count;i<l;i++)E.fromBufferAttribute(e,i),g=Math.max(g,n.distanceToSquared(E));if(t)for(i=0,l=t.length;i<l;i++){h=t[i];for(var b=this.morphTargetsRelative,k=0,F=h.count;k<F;k++)E.fromBufferAttribute(h,k),b&&(Po.fromBufferAttribute(e,k),E.add(Po)),g=Math.max(g,n.distanceToSquared(E))}this.boundingSphere.radius=Math.sqrt(g),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(t.normal===void 0)this.setAttribute("normal",new $n(new Float32Array(n.length),3));else for(var i=t.normal.array,l=0,h=i.length;l<h;l++)i[l]=0;var g,b,k,F=t.normal.array,K=new Se,Q=new Se,ne=new Se,U=new Se,oe=new Se;if(e){var ue=e.array;for(l=0,h=e.count;l<h;l+=3)g=3*ue[l+0],b=3*ue[l+1],k=3*ue[l+2],K.fromArray(n,g),Q.fromArray(n,b),ne.fromArray(n,k),U.subVectors(ne,Q),oe.subVectors(K,Q),U.cross(oe),F[g]+=U.x,F[1+g]+=U.y,F[2+g]+=U.z,F[b]+=U.x,F[1+b]+=U.y,F[2+b]+=U.z,F[k]+=U.x,F[1+k]+=U.y,F[2+k]+=U.z}else for(l=0,h=n.length;l<h;l+=9)K.fromArray(n,l),Q.fromArray(n,l+3),ne.fromArray(n,l+6),U.subVectors(ne,Q),oe.subVectors(K,Q),U.cross(oe),F[l]=U.x,F[l+1]=U.y,F[l+2]=U.z,F[l+3]=U.x,F[l+4]=U.y,F[l+5]=U.z,F[l+6]=U.x,F[l+7]=U.y,F[l+8]=U.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var i in n)if(e.attributes[i]!==void 0)for(var l=n[i].array,h=e.attributes[i],g=h.array,b=h.itemSize*t,k=Math.min(g.length,l.length-b),F=0,K=b;F<k;F++,K++)l[K]=g[F];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)E.x=e.getX(t),E.y=e.getY(t),E.z=e.getZ(t),E.normalize(),e.setXYZ(t,E.x,E.y,E.z)},toNonIndexed:function(){function e(oe,ue){for(var pe=oe.array,Te=oe.itemSize,Oe=new pe.constructor(ue.length*Te),Fe=0,Ze=0,Ge=0,et=ue.length;Ge<et;Ge++){Fe=ue[Ge]*Te;for(var We=0;We<Te;We++)Oe[Ze++]=pe[Fe++]}return new $n(Oe,Te)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new X,n=this.index.array,i=this.attributes;for(var l in i){var h=e(i[l],n);t.setAttribute(l,h)}var g=this.morphAttributes;for(l in g){for(var b=[],k=g[l],F=0,K=k.length;F<K;F++)h=e(k[F],n),b.push(h);t.morphAttributes[l]=b}t.morphTargetsRelative=this.morphTargetsRelative;for(var Q=this.groups,ne=(F=0,Q.length);F<ne;F++){var U=Q[F];t.addGroup(U.start,U.count,U.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),0<Object.keys(this.userData).length&&(e.userData=this.userData),this.parameters!==void 0){var t=this.parameters;for(var n in t)t[n]!==void 0&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var l=this.attributes;for(var n in l){var h=(ne=l[n]).toJSON();ne.name!==""&&(h.name=ne.name),e.data.attributes[n]=h}var g={},b=!1;for(var n in this.morphAttributes){for(var k=this.morphAttributes[n],F=[],K=0,Q=k.length;K<Q;K++){var ne;h=(ne=k[K]).toJSON(),ne.name!==""&&(h.name=ne.name),F.push(h)}0<F.length&&(g[n]=F,b=!0)}b&&(e.data.morphAttributes=g,e.data.morphTargetsRelative=this.morphTargetsRelative);var U=this.groups;0<U.length&&(e.data.groups=JSON.parse(JSON.stringify(U)));var oe=this.boundingSphere;return oe!==null&&(e.data.boundingSphere={center:oe.center.toArray(),radius:oe.radius}),e},clone:function(){return new X().copy(this)},copy:function(e){var t,n,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var l=e.index;l!==null&&this.setIndex(l.clone());var h=e.attributes;for(t in h){var g=h[t];this.setAttribute(t,g.clone())}var b=e.morphAttributes;for(t in b){var k=[],F=b[t];for(n=0,i=F.length;n<i;n++)k.push(F[n].clone());this.morphAttributes[t]=k}this.morphTargetsRelative=e.morphTargetsRelative;var K=e.groups;for(n=0,i=K.length;n<i;n++){var Q=K[n];this.addGroup(Q.start,Q.count,Q.materialIndex)}var ne=e.boundingBox;ne!==null&&(this.boundingBox=ne.clone());var U=e.boundingSphere;return U!==null&&(this.boundingSphere=U.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var re=new Lt,ce=new se,fe=new xa,be=new Se,xe=new Se,Me=new Se,Ne=new Se,Qe=new Se,ht=new Se,lt=new Se,Ot=new Se,Pn=new Se,_n=new Ve,Xn=new Ve,ni=new Ve,Nr=new Se,oa=new Se;function Vr(e,t){mn.call(this),this.type="Mesh",this.geometry=e!==void 0?e:new X,this.material=t!==void 0?t:new Xa,this.updateMorphTargets()}function vr(e,t,n,i,l,h,g,b){if((t.side===1?i.intersectTriangle(g,h,l,!0,b):i.intersectTriangle(l,h,g,t.side!==2,b))===null)return null;oa.copy(b),oa.applyMatrix4(e.matrixWorld);var k=n.ray.origin.distanceTo(oa);return k<n.near||k>n.far?null:{distance:k,point:oa.clone(),object:e}}function Ea(e,t,n,i,l,h,g,b,k,F,K,Q){be.fromBufferAttribute(l,F),xe.fromBufferAttribute(l,K),Me.fromBufferAttribute(l,Q);var ne=e.morphTargetInfluences;if(t.morphTargets&&h&&ne){lt.set(0,0,0),Ot.set(0,0,0),Pn.set(0,0,0);for(var U=0,oe=h.length;U<oe;U++){var ue=ne[U],pe=h[U];ue!==0&&(Ne.fromBufferAttribute(pe,F),Qe.fromBufferAttribute(pe,K),ht.fromBufferAttribute(pe,Q),g?(lt.addScaledVector(Ne,ue),Ot.addScaledVector(Qe,ue),Pn.addScaledVector(ht,ue)):(lt.addScaledVector(Ne.sub(be),ue),Ot.addScaledVector(Qe.sub(xe),ue),Pn.addScaledVector(ht.sub(Me),ue)))}be.add(lt),xe.add(Ot),Me.add(Pn)}var Te=vr(e,t,n,i,be,xe,Me,Nr);if(Te){b&&(_n.fromBufferAttribute(b,F),Xn.fromBufferAttribute(b,K),ni.fromBufferAttribute(b,Q),Te.uv=Di.getUV(Nr,be,xe,Me,_n,Xn,ni,new Ve)),k&&(_n.fromBufferAttribute(k,F),Xn.fromBufferAttribute(k,K),ni.fromBufferAttribute(k,Q),Te.uv2=Di.getUV(Nr,be,xe,Me,_n,Xn,ni,new Ve));var Oe=new qa(F,K,Q);Di.getNormal(be,xe,Me,Oe.normal),Te.face=Oe}return Te}Vr.prototype=Object.assign(Object.create(mn.prototype),{constructor:Vr,isMesh:!0,copy:function(e){return mn.prototype.copy.call(this,e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,i=this.geometry;if(i.isBufferGeometry){var l=i.morphAttributes,h=Object.keys(l);if(0<h.length){var g=l[h[0]];if(g!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=g.length;e<t;e++)n=g[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var b=i.morphTargets;b!==void 0&&0<b.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var n,i=this.geometry,l=this.material,h=this.matrixWorld;if(l!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),fe.copy(i.boundingSphere),fe.applyMatrix4(h),e.ray.intersectsSphere(fe)!==!1&&(re.getInverse(h),ce.copy(e.ray).applyMatrix4(re),i.boundingBox===null||ce.intersectsBox(i.boundingBox)!==!1))){if(i.isBufferGeometry){var g,b,k,F,K,Q,ne,U,oe,ue=i.index,pe=i.attributes.position,Te=i.morphAttributes.position,Oe=i.morphTargetsRelative,Fe=i.attributes.uv,Ze=i.attributes.uv2,Ge=i.groups,et=i.drawRange;if(ue!==null)if(Array.isArray(l))for(F=0,Q=Ge.length;F<Q;F++)for(oe=l[(U=Ge[F]).materialIndex],K=Math.max(U.start,et.start),ne=Math.min(U.start+U.count,et.start+et.count);K<ne;K+=3)g=ue.getX(K),b=ue.getX(K+1),k=ue.getX(K+2),(n=Ea(this,oe,e,ce,pe,Te,Oe,Fe,Ze,g,b,k))&&(n.faceIndex=Math.floor(K/3),n.face.materialIndex=U.materialIndex,t.push(n));else for(F=Math.max(0,et.start),Q=Math.min(ue.count,et.start+et.count);F<Q;F+=3)g=ue.getX(F),b=ue.getX(F+1),k=ue.getX(F+2),(n=Ea(this,l,e,ce,pe,Te,Oe,Fe,Ze,g,b,k))&&(n.faceIndex=Math.floor(F/3),t.push(n));else if(pe!==void 0)if(Array.isArray(l))for(F=0,Q=Ge.length;F<Q;F++)for(oe=l[(U=Ge[F]).materialIndex],K=Math.max(U.start,et.start),ne=Math.min(U.start+U.count,et.start+et.count);K<ne;K+=3)(n=Ea(this,oe,e,ce,pe,Te,Oe,Fe,Ze,g=K,b=K+1,k=K+2))&&(n.faceIndex=Math.floor(K/3),n.face.materialIndex=U.materialIndex,t.push(n));else for(F=Math.max(0,et.start),Q=Math.min(pe.count,et.start+et.count);F<Q;F+=3)(n=Ea(this,l,e,ce,pe,Te,Oe,Fe,Ze,g=F,b=F+1,k=F+2))&&(n.faceIndex=Math.floor(F/3),t.push(n))}else if(i.isGeometry){var We,ft,_t,Et,At=Array.isArray(l),Nt=i.vertices,Xt=i.faces,Tt=i.faceVertexUvs[0];0<Tt.length&&(Et=Tt);for(var wt=0,sn=Xt.length;wt<sn;wt++){var gn=Xt[wt],Jn=At?l[gn.materialIndex]:l;if(Jn!==void 0&&(We=Nt[gn.a],ft=Nt[gn.b],_t=Nt[gn.c],n=vr(this,Jn,e,ce,We,ft,_t,Nr))){if(Et&&Et[wt]){var Gn=Et[wt];_n.copy(Gn[0]),Xn.copy(Gn[1]),ni.copy(Gn[2]),n.uv=Di.getUV(Nr,We,ft,_t,_n,Xn,ni,new Ve)}n.face=gn,n.faceIndex=wt,t.push(n)}}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ar=0,Fn=new Lt,Jo=new mn,qo=new Se;function kn(){Object.defineProperty(this,"id",{value:Ar+=2}),this.uuid=Qt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}kn.prototype=Object.assign(Object.create(bt.prototype),{constructor:kn,isGeometry:!0,applyMatrix4:function(e){for(var t=new Be().getNormalMatrix(e),n=0,i=this.vertices.length;n<i;n++)this.vertices[n].applyMatrix4(e);for(n=0,i=this.faces.length;n<i;n++){var l=this.faces[n];l.normal.applyMatrix3(t).normalize();for(var h=0,g=l.vertexNormals.length;h<g;h++)l.vertexNormals[h].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Fn.makeRotationX(e),this.applyMatrix4(Fn),this},rotateY:function(e){return Fn.makeRotationY(e),this.applyMatrix4(Fn),this},rotateZ:function(e){return Fn.makeRotationZ(e),this.applyMatrix4(Fn),this},translate:function(e,t,n){return Fn.makeTranslation(e,t,n),this.applyMatrix4(Fn),this},scale:function(e,t,n){return Fn.makeScale(e,t,n),this.applyMatrix4(Fn),this},lookAt:function(e){return Jo.lookAt(e),Jo.updateMatrix(),this.applyMatrix4(Jo.matrix),this},fromBufferGeometry:function(e){var t=this,n=e.index!==null?e.index.array:void 0,i=e.attributes;if(i.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var l=i.position.array,h=i.normal!==void 0?i.normal.array:void 0,g=i.color!==void 0?i.color.array:void 0,b=i.uv!==void 0?i.uv.array:void 0,k=i.uv2!==void 0?i.uv2.array:void 0;k!==void 0&&(this.faceVertexUvs[1]=[]);for(var F=0;F<l.length;F+=3)t.vertices.push(new Se().fromArray(l,F)),g!==void 0&&t.colors.push(new Cn().fromArray(g,F));function K(pe,Te,Oe,Fe){var Ze=g===void 0?[]:[t.colors[pe].clone(),t.colors[Te].clone(),t.colors[Oe].clone()],Ge=new qa(pe,Te,Oe,h===void 0?[]:[new Se().fromArray(h,3*pe),new Se().fromArray(h,3*Te),new Se().fromArray(h,3*Oe)],Ze,Fe);t.faces.push(Ge),b!==void 0&&t.faceVertexUvs[0].push([new Ve().fromArray(b,2*pe),new Ve().fromArray(b,2*Te),new Ve().fromArray(b,2*Oe)]),k!==void 0&&t.faceVertexUvs[1].push([new Ve().fromArray(k,2*pe),new Ve().fromArray(k,2*Te),new Ve().fromArray(k,2*Oe)])}var Q=e.groups;if(0<Q.length)for(F=0;F<Q.length;F++)for(var ne=Q[F],U=ne.start,oe=U,ue=U+ne.count;oe<ue;oe+=3)n!==void 0?K(n[oe],n[oe+1],n[oe+2],ne.materialIndex):K(oe,oe+1,oe+2,ne.materialIndex);else if(n!==void 0)for(F=0;F<n.length;F+=3)K(n[F],n[F+1],n[F+2]);else for(F=0;F<l.length/3;F+=3)K(F,F+1,F+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(qo).negate(),this.translate(qo.x,qo.y,qo.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=t===0?1:1/t,i=new Lt;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(i),this},computeFaceNormals:function(){for(var e=new Se,t=new Se,n=0,i=this.faces.length;n<i;n++){var l=this.faces[n],h=this.vertices[l.a],g=this.vertices[l.b],b=this.vertices[l.c];e.subVectors(b,g),t.subVectors(h,g),e.cross(t),e.normalize(),l.normal.copy(e)}},computeVertexNormals:function(e){var t,n,i,l,h,g;for(e===void 0&&(e=!0),g=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)g[t]=new Se;if(e){var b,k,F,K=new Se,Q=new Se;for(i=0,l=this.faces.length;i<l;i++)h=this.faces[i],b=this.vertices[h.a],k=this.vertices[h.b],F=this.vertices[h.c],K.subVectors(F,k),Q.subVectors(b,k),K.cross(Q),g[h.a].add(K),g[h.b].add(K),g[h.c].add(K)}else for(this.computeFaceNormals(),i=0,l=this.faces.length;i<l;i++)g[(h=this.faces[i]).a].add(h.normal),g[h.b].add(h.normal),g[h.c].add(h.normal);for(t=0,n=this.vertices.length;t<n;t++)g[t].normalize();for(i=0,l=this.faces.length;i<l;i++){var ne=(h=this.faces[i]).vertexNormals;ne.length===3?(ne[0].copy(g[h.a]),ne[1].copy(g[h.b]),ne[2].copy(g[h.c])):(ne[0]=g[h.a].clone(),ne[1]=g[h.b].clone(),ne[2]=g[h.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var i=(n=this.faces[e]).vertexNormals;i.length===3?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,i,l;for(n=0,i=this.faces.length;n<i;n++)for((l=this.faces[n]).__originalFaceNormal?l.__originalFaceNormal.copy(l.normal):l.__originalFaceNormal=l.normal.clone(),l.__originalVertexNormals||(l.__originalVertexNormals=[]),e=0,t=l.vertexNormals.length;e<t;e++)l.__originalVertexNormals[e]?l.__originalVertexNormals[e].copy(l.vertexNormals[e]):l.__originalVertexNormals[e]=l.vertexNormals[e].clone();var h=new kn;for(h.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var g=this.morphNormals[e].faceNormals,b=this.morphNormals[e].vertexNormals;for(n=0,i=this.faces.length;n<i;n++)k=new Se,F={a:new Se,b:new Se,c:new Se},g.push(k),b.push(F)}var k,F,K=this.morphNormals[e];for(h.vertices=this.morphTargets[e].vertices,h.computeFaceNormals(),h.computeVertexNormals(),n=0,i=this.faces.length;n<i;n++)l=this.faces[n],k=K.faceNormals[n],F=K.vertexNormals[n],k.copy(l.normal),F.a.copy(l.vertexNormals[0]),F.b.copy(l.vertexNormals[1]),F.c.copy(l.vertexNormals[2])}for(n=0,i=this.faces.length;n<i;n++)(l=this.faces[n]).normal=l.__originalFaceNormal,l.vertexNormals=l.__originalVertexNormals},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Oi),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new xa),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var i,l=this.vertices.length,h=this.vertices,g=e.vertices,b=this.faces,k=e.faces,F=this.colors,K=e.colors;n===void 0&&(n=0),t!==void 0&&(i=new Be().getNormalMatrix(t));for(var Q=0,ne=g.length;Q<ne;Q++){var U=g[Q].clone();t!==void 0&&U.applyMatrix4(t),h.push(U)}for(Q=0,ne=K.length;Q<ne;Q++)F.push(K[Q].clone());for(Q=0,ne=k.length;Q<ne;Q++){var oe,ue,pe,Te=k[Q],Oe=Te.vertexNormals,Fe=Te.vertexColors;(oe=new qa(Te.a+l,Te.b+l,Te.c+l)).normal.copy(Te.normal),i!==void 0&&oe.normal.applyMatrix3(i).normalize();for(var Ze=0,Ge=Oe.length;Ze<Ge;Ze++)ue=Oe[Ze].clone(),i!==void 0&&ue.applyMatrix3(i).normalize(),oe.vertexNormals.push(ue);for(oe.color.copy(Te.color),Ze=0,Ge=Fe.length;Ze<Ge;Ze++)pe=Fe[Ze],oe.vertexColors.push(pe.clone());oe.materialIndex=Te.materialIndex+n,b.push(oe)}for(Q=0,ne=e.faceVertexUvs.length;Q<ne;Q++){var et=e.faceVertexUvs[Q];for(this.faceVertexUvs[Q]===void 0&&(this.faceVertexUvs[Q]=[]),Ze=0,Ge=et.length;Ze<Ge;Ze++){for(var We=et[Ze],ft=[],_t=0,Et=We.length;_t<Et;_t++)ft.push(We[_t].clone());this.faceVertexUvs[Q].push(ft)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,i,l,h,g,b,k={},F=[],K=[],Q=Math.pow(10,4);for(n=0,i=this.vertices.length;n<i;n++)e=this.vertices[n],k[t=Math.round(e.x*Q)+"_"+Math.round(e.y*Q)+"_"+Math.round(e.z*Q)]===void 0?(k[t]=n,F.push(this.vertices[n]),K[n]=F.length-1):K[n]=K[k[t]];var ne=[];for(n=0,i=this.faces.length;n<i;n++){(l=this.faces[n]).a=K[l.a],l.b=K[l.b],l.c=K[l.c],h=[l.a,l.b,l.c];for(var U=0;U<3;U++)if(h[U]===h[(U+1)%3]){ne.push(n);break}}for(n=ne.length-1;0<=n;n--){var oe=ne[n];for(this.faces.splice(oe,1),g=0,b=this.faceVertexUvs.length;g<b;g++)this.faceVertexUvs[g].splice(oe,1)}var ue=this.vertices.length-F.length;return this.vertices=F,ue},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var i=e[t];this.vertices.push(new Se(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort(function(k,F){return k.materialIndex-F.materialIndex});var i,l,h=this.faceVertexUvs[0],g=this.faceVertexUvs[1];for(h&&h.length===t&&(i=[]),g&&g.length===t&&(l=[]),n=0;n<t;n++){var b=e[n]._id;i&&i.push(h[b]),l&&l.push(g[b])}i&&(this.faceVertexUvs[0]=i),l&&(this.faceVertexUvs[1]=l)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){var t=this.parameters;for(var n in t)t[n]!==void 0&&(e[n]=t[n]);return e}for(var i=[],l=0;l<this.vertices.length;l++){var h=this.vertices[l];i.push(h.x,h.y,h.z)}var g=[],b=[],k={},F=[],K={},Q=[],ne={};for(l=0;l<this.faces.length;l++){var U=this.faces[l],oe=this.faceVertexUvs[0][l]!==void 0,ue=0<U.normal.length(),pe=0<U.vertexNormals.length,Te=U.color.r!==1||U.color.g!==1||U.color.b!==1,Oe=0<U.vertexColors.length,Fe=0;if(Fe=We(Fe=We(Fe=We(Fe=We(Fe=We(Fe=We(Fe=We(Fe=We(Fe,0,0),1,!0),2,!1),3,oe),4,ue),5,pe),6,Te),7,Oe),g.push(Fe),g.push(U.a,U.b,U.c),g.push(U.materialIndex),oe){var Ze=this.faceVertexUvs[0][l];g.push(Et(Ze[0]),Et(Ze[1]),Et(Ze[2]))}if(ue&&g.push(ft(U.normal)),pe){var Ge=U.vertexNormals;g.push(ft(Ge[0]),ft(Ge[1]),ft(Ge[2]))}if(Te&&g.push(_t(U.color)),Oe){var et=U.vertexColors;g.push(_t(et[0]),_t(et[1]),_t(et[2]))}}function We(At,Nt,Xt){return Xt?At|1<<Nt:At&~(1<<Nt)}function ft(At){var Nt=At.x.toString()+At.y.toString()+At.z.toString();return k[Nt]!==void 0||(k[Nt]=b.length/3,b.push(At.x,At.y,At.z)),k[Nt]}function _t(At){var Nt=At.r.toString()+At.g.toString()+At.b.toString();return K[Nt]!==void 0||(K[Nt]=F.length,F.push(At.getHex())),K[Nt]}function Et(At){var Nt=At.x.toString()+At.y.toString();return ne[Nt]!==void 0||(ne[Nt]=Q.length/2,Q.push(At.x,At.y)),ne[Nt]}return e.data={},e.data.vertices=i,e.data.normals=b,0<F.length&&(e.data.colors=F),0<Q.length&&(e.data.uvs=[Q]),e.data.faces=g,e},clone:function(){return new kn().copy(this)},copy:function(e){var t,n,i,l,h,g;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var b=e.vertices;for(t=0,n=b.length;t<n;t++)this.vertices.push(b[t].clone());var k=e.colors;for(t=0,n=k.length;t<n;t++)this.colors.push(k[t].clone());var F=e.faces;for(t=0,n=F.length;t<n;t++)this.faces.push(F[t].clone());for(t=0,n=e.faceVertexUvs.length;t<n;t++){var K=e.faceVertexUvs[t];for(this.faceVertexUvs[t]===void 0&&(this.faceVertexUvs[t]=[]),i=0,l=K.length;i<l;i++){var Q=K[i],ne=[];for(h=0,g=Q.length;h<g;h++){var U=Q[h];ne.push(U.clone())}this.faceVertexUvs[t].push(ne)}}var oe=e.morphTargets;for(t=0,n=oe.length;t<n;t++){var ue={};if(ue.name=oe[t].name,oe[t].vertices!==void 0)for(ue.vertices=[],i=0,l=oe[t].vertices.length;i<l;i++)ue.vertices.push(oe[t].vertices[i].clone());if(oe[t].normals!==void 0)for(ue.normals=[],i=0,l=oe[t].normals.length;i<l;i++)ue.normals.push(oe[t].normals[i].clone());this.morphTargets.push(ue)}var pe=e.morphNormals;for(t=0,n=pe.length;t<n;t++){var Te={};if(pe[t].vertexNormals!==void 0)for(Te.vertexNormals=[],i=0,l=pe[t].vertexNormals.length;i<l;i++){var Oe=pe[t].vertexNormals[i],Fe={};Fe.a=Oe.a.clone(),Fe.b=Oe.b.clone(),Fe.c=Oe.c.clone(),Te.vertexNormals.push(Fe)}if(pe[t].faceNormals!==void 0)for(Te.faceNormals=[],i=0,l=pe[t].faceNormals.length;i<l;i++)Te.faceNormals.push(pe[t].faceNormals[i].clone());this.morphNormals.push(Te)}var Ze=e.skinWeights;for(t=0,n=Ze.length;t<n;t++)this.skinWeights.push(Ze[t].clone());var Ge=e.skinIndices;for(t=0,n=Ge.length;t<n;t++)this.skinIndices.push(Ge[t].clone());var et=e.lineDistances;for(t=0,n=et.length;t<n;t++)this.lineDistances.push(et[t]);var We=e.boundingBox;We!==null&&(this.boundingBox=We.clone());var ft=e.boundingSphere;return ft!==null&&(this.boundingSphere=ft.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Xo=function(e){function t(n,i,l,h,g,b){e.call(this),this.type="BoxGeometry",this.parameters={width:n,height:i,depth:l,widthSegments:h,heightSegments:g,depthSegments:b},this.fromBufferGeometry(new Aa(n,i,l,h,g,b)),this.mergeVertices()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t}(kn),Aa=function(e){function t(n,i,l,h,g,b){e.call(this),this.type="BoxBufferGeometry",this.parameters={width:n,height:i,depth:l,widthSegments:h,heightSegments:g,depthSegments:b};var k=this;n=n||1,i=i||1,l=l||1,h=Math.floor(h)||1,g=Math.floor(g)||1;var F=[],K=[],Q=[],ne=[],U=0,oe=0;function ue(pe,Te,Oe,Fe,Ze,Ge,et,We,ft,_t,Et){var At,Nt,Xt=Ge/ft,Tt=et/_t,wt=Ge/2,sn=et/2,gn=We/2,Jn=ft+1,Gn=_t+1,Nn=0,sr=0,Tn=new Se;for(Nt=0;Nt<Gn;Nt++){var je=Nt*Tt-sn;for(At=0;At<Jn;At++){var nt=At*Xt-wt;Tn[pe]=nt*Fe,Tn[Te]=je*Ze,Tn[Oe]=gn,K.push(Tn.x,Tn.y,Tn.z),Tn[pe]=0,Tn[Te]=0,Tn[Oe]=0<We?1:-1,Q.push(Tn.x,Tn.y,Tn.z),ne.push(At/ft),ne.push(1-Nt/_t),Nn+=1}}for(Nt=0;Nt<_t;Nt++)for(At=0;At<ft;At++){var Jt=U+At+Jn*Nt,zt=U+At+Jn*(Nt+1),Qn=U+(At+1)+Jn*(Nt+1),Sn=U+(At+1)+Jn*Nt;F.push(Jt,zt,Sn),F.push(zt,Qn,Sn),sr+=6}k.addGroup(oe,sr,Et),oe+=sr,U+=Nn}ue("z","y","x",-1,-1,l,i,n,b=Math.floor(b)||1,g,0),ue("z","y","x",1,-1,l,i,-n,b,g,1),ue("x","z","y",1,1,n,l,i,h,b,2),ue("x","z","y",1,-1,n,l,-i,h,b,3),ue("x","y","z",1,-1,n,i,l,h,g,4),ue("x","y","z",-1,-1,n,i,-l,h,g,5),this.setIndex(F),this.setAttribute("position",new ln(K,3)),this.setAttribute("normal",new ln(Q,3)),this.setAttribute("uv",new ln(ne,2))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t}(X);function Pa(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var l=e[n][i];l&&(l.isColor||l.isMatrix3||l.isMatrix4||l.isVector2||l.isVector3||l.isVector4||l.isTexture)?t[n][i]=l.clone():Array.isArray(l)?t[n][i]=l.slice():t[n][i]=l}return t}function hi(e){for(var t={},n=0;n<e.length;n++){var i=Pa(e[n]);for(var l in i)t[l]=i[l]}return t}var Ri={clone:Pa,merge:hi};function Fr(e){rr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Ur(){mn.call(this),this.type="Camera",this.matrixWorldInverse=new Lt,this.projectionMatrix=new Lt,this.projectionMatrixInverse=new Lt}function Dr(e,t,n,i){Ur.call(this),this.type="PerspectiveCamera",this.fov=e!==void 0?e:50,this.zoom=1,this.near=n!==void 0?n:.1,this.far=i!==void 0?i:2e3,this.focus=10,this.aspect=t!==void 0?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Oa(e,t,n,i){mn.call(this),this.type="CubeCamera";var l=new Dr(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new Se(1,0,0)),this.add(l);var h=new Dr(90,1,e,t);h.up.set(0,-1,0),h.lookAt(new Se(-1,0,0)),this.add(h);var g=new Dr(90,1,e,t);g.up.set(0,0,1),g.lookAt(new Se(0,1,0)),this.add(g);var b=new Dr(90,1,e,t);b.up.set(0,0,-1),b.lookAt(new Se(0,-1,0)),this.add(b);var k=new Dr(90,1,e,t);k.up.set(0,-1,0),k.lookAt(new Se(0,0,1)),this.add(k);var F=new Dr(90,1,e,t);F.up.set(0,-1,0),F.lookAt(new Se(0,0,-1)),this.add(F),i=i||{format:m,magFilter:q,minFilter:q},this.renderTarget=new Ei(n,i),this.renderTarget.texture.name="CubeCamera",this.update=function(K,Q){this.parent===null&&this.updateMatrixWorld();var ne=K.getRenderTarget(),U=this.renderTarget,oe=U.texture.generateMipmaps;U.texture.generateMipmaps=!1,K.setRenderTarget(U,0),K.render(Q,l),K.setRenderTarget(U,1),K.render(Q,h),K.setRenderTarget(U,2),K.render(Q,g),K.setRenderTarget(U,3),K.render(Q,b),K.setRenderTarget(U,4),K.render(Q,k),U.texture.generateMipmaps=oe,K.setRenderTarget(U,5),K.render(Q,F),K.setRenderTarget(ne)},this.clear=function(K,Q,ne,U){for(var oe=K.getRenderTarget(),ue=this.renderTarget,pe=0;pe<6;pe++)K.setRenderTarget(ue,pe),K.clear(Q,ne,U);K.setRenderTarget(oe)}}function Ei(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),rt.call(this,e,e,t)}function jn(e,t,n,i,l,h,g,b,k,F,K,Q){nn.call(this,null,h,g,b,k,F,i,l,K,Q),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=k!==void 0?k:z,this.minFilter=F!==void 0?F:z,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}((Fr.prototype=Object.create(rr.prototype)).constructor=Fr).prototype.isShaderMaterial=!0,Fr.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Pa(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Fr.prototype.toJSON=function(e){var t=rr.prototype.toJSON.call(this,e);for(var n in t.uniforms={},this.uniforms){var i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var l={};for(var h in this.extensions)this.extensions[h]===!0&&(l[h]=!0);return 0<Object.keys(l).length&&(t.extensions=l),t},Ur.prototype=Object.assign(Object.create(mn.prototype),{constructor:Ur,isCamera:!0,copy:function(e,t){return mn.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Se),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){mn.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){mn.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}}),Dr.prototype=Object.assign(Object.create(Ur.prototype),{constructor:Dr,isPerspectiveCamera:!0,copy:function(e,t){return Ur.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Qt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Qt.DEG2RAD*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Qt.RAD2DEG*Math.atan(Math.tan(.5*Qt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,i,l,h){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=l,this.view.height=h,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Qt.DEG2RAD*this.fov)/this.zoom,n=2*t,i=this.aspect*n,l=-.5*i,h=this.view;if(this.view!==null&&this.view.enabled){var g=h.fullWidth,b=h.fullHeight;l+=h.offsetX*i/g,t-=h.offsetY*n/b,i*=h.width/g,n*=h.height/b}var k=this.filmOffset;k!==0&&(l+=e*k/this.getFilmWidth()),this.projectionMatrix.makePerspective(l,l+i,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=mn.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),(Oa.prototype=Object.create(mn.prototype)).constructor=Oa,((Ei.prototype=Object.create(rt.prototype)).constructor=Ei).prototype.isWebGLCubeRenderTarget=!0,Ei.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var n=new Ca,i={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","	vWorldDirection = transformDirection( position, modelMatrix );","	#include <begin_vertex>","	#include <project_vertex>","}"].join(`
`),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","	vec3 direction = normalize( vWorldDirection );","	vec2 sampleUV;","	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","	gl_FragColor = texture2D( tEquirect, sampleUV );","}"].join(`
`)},l=new Fr({type:"CubemapFromEquirect",uniforms:Pa(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});l.uniforms.tEquirect.value=t;var h=new Vr(new Aa(5,5,5),l);n.add(h);var g=new Oa(1,10,1);return g.renderTarget=this,g.renderTarget.texture.name="CubeCameraTexture",g.update(e,n),h.geometry.dispose(),h.material.dispose(),this},((jn.prototype=Object.create(nn.prototype)).constructor=jn).prototype.isDataTexture=!0;var ei=new xa,Zr=new Se;function Pr(e,t,n,i,l,h){this.planes=[e!==void 0?e:new It,t!==void 0?t:new It,n!==void 0?n:new It,i!==void 0?i:new It,l!==void 0?l:new It,h!==void 0?h:new It]}Object.assign(Pr.prototype,{set:function(e,t,n,i,l,h){var g=this.planes;return g[0].copy(e),g[1].copy(t),g[2].copy(n),g[3].copy(i),g[4].copy(l),g[5].copy(h),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromProjectionMatrix:function(e){var t=this.planes,n=e.elements,i=n[0],l=n[1],h=n[2],g=n[3],b=n[4],k=n[5],F=n[6],K=n[7],Q=n[8],ne=n[9],U=n[10],oe=n[11],ue=n[12],pe=n[13],Te=n[14],Oe=n[15];return t[0].setComponents(g-i,K-b,oe-Q,Oe-ue).normalize(),t[1].setComponents(g+i,K+b,oe+Q,Oe+ue).normalize(),t[2].setComponents(g+l,K+k,oe+ne,Oe+pe).normalize(),t[3].setComponents(g-l,K-k,oe-ne,Oe-pe).normalize(),t[4].setComponents(g-h,K-F,oe-U,Oe-Te).normalize(),t[5].setComponents(g+h,K+F,oe+U,Oe+Te).normalize(),this},intersectsObject:function(e){var t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),ei.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ei)},intersectsSprite:function(e){return ei.center.set(0,0,0),ei.radius=.7071067811865476,ei.applyMatrix4(e.matrixWorld),this.intersectsSphere(ei)},intersectsSphere:function(e){for(var t=this.planes,n=e.center,i=-e.radius,l=0;l<6;l++)if(t[l].distanceToPoint(n)<i)return!1;return!0},intersectsBox:function(e){for(var t=this.planes,n=0;n<6;n++){var i=t[n];if(Zr.x=0<i.normal.x?e.max.x:e.min.x,Zr.y=0<i.normal.y?e.max.y:e.min.y,Zr.z=0<i.normal.z?e.max.z:e.min.z,i.distanceToPoint(Zr)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}});var en={common:{diffuse:{value:new Cn(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Be},uv2Transform:{value:new Be},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ve(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Cn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Cn(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Be}},sprite:{diffuse:{value:new Cn(15658734)},opacity:{value:1},center:{value:new Ve(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Be}}};function Yo(){var e=null,t=!1,n=null;function i(l,h){t!==!1&&(n(l,h),e.requestAnimationFrame(i))}return{start:function(){t!==!0&&n!==null&&(e.requestAnimationFrame(i),t=!0)},stop:function(){t=!1},setAnimationLoop:function(l){n=l},setContext:function(l){e=l}}}function Zo(e,t,n,i){kn.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new Va(e,t,n,i)),this.mergeVertices()}function Va(e,t,n,i){X.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};var l,h,g=(e=e||1)/2,b=(t=t||1)/2,k=Math.floor(n)||1,F=Math.floor(i)||1,K=k+1,Q=F+1,ne=e/k,U=t/F,oe=[],ue=[],pe=[],Te=[];for(h=0;h<Q;h++){var Oe=h*U-b;for(l=0;l<K;l++){var Fe=l*ne-g;ue.push(Fe,-Oe,0),pe.push(0,0,1),Te.push(l/k),Te.push(1-h/F)}}for(h=0;h<F;h++)for(l=0;l<k;l++){var Ze=l+K*h,Ge=l+K*(h+1),et=l+1+K*(h+1),We=l+1+K*h;oe.push(Ze,Ge,We),oe.push(Ge,et,We)}this.setIndex(oe),this.setAttribute("position",new ln(ue,3)),this.setAttribute("normal",new ln(pe,3)),this.setAttribute("uv",new ln(Te,2))}(Zo.prototype=Object.create(kn.prototype)).constructor=Zo,(Va.prototype=Object.create(X.prototype)).constructor=Va;var dr={alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE  = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS  = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha  = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;
	}
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;
		}
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
		varying vec3 vViewPosition;
	#endif
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
	varying vec3 vViewPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
	vViewPosition = - mvPosition.xyz;
#endif`,color_fragment:`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,color_pars_vertex:`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,color_vertex:`#ifdef USE_COLOR
	vColor.xyz = color.xyz;
#endif`,common:`#define PI 3.14159265359
#define PI2 6.28318530718
#define PI_HALF 1.5707963267949
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
#define LOG2 1.442695
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
  return m[ 2 ][ 3 ] == - 1.0;
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
#define cubeUV_maxMipLevel 8.0
#define cubeUV_minMipLevel 4.0
#define cubeUV_maxTileSize 256.0
#define cubeUV_minTileSize 16.0
float getFace(vec3 direction) {
    vec3 absDirection = abs(direction);
    float face = -1.0;
    if (absDirection.x > absDirection.z) {
      if (absDirection.x > absDirection.y)
        face = direction.x > 0.0 ? 0.0 : 3.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    } else {
      if (absDirection.z > absDirection.y)
        face = direction.z > 0.0 ? 2.0 : 5.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    }
    return face;
}
vec2 getUV(vec3 direction, float face) {
    vec2 uv;
    if (face == 0.0) {
      uv = vec2(-direction.z, direction.y) / abs(direction.x);
    } else if (face == 1.0) {
      uv = vec2(direction.x, -direction.z) / abs(direction.y);
    } else if (face == 2.0) {
      uv = direction.xy / abs(direction.z);
    } else if (face == 3.0) {
      uv = vec2(direction.z, direction.y) / abs(direction.x);
    } else if (face == 4.0) {
      uv = direction.xz / abs(direction.y);
    } else {
      uv = vec2(-direction.x, direction.y) / abs(direction.z);
    }
    return 0.5 * (uv + 1.0);
}
vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
  float face = getFace(direction);
  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
  mipInt = max(mipInt, cubeUV_minMipLevel);
  float faceSize = exp2(mipInt);
  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
  vec2 uv = getUV(direction, face) * (faceSize - 1.0);
  vec2 f = fract(uv);
  uv += 0.5 - f;
  if (face > 2.0) {
    uv.y += faceSize;
    face -= 3.0;
  }
  uv.x += face * faceSize;
  if(mipInt < cubeUV_maxMipLevel){
    uv.y += 2.0 * cubeUV_maxTileSize;
  }
  uv.y += filterInt * 2.0 * cubeUV_minTileSize;
  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
  uv *= texelSize;
  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x += texelSize;
  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.y += texelSize;
  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x -= texelSize;
  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  vec3 tm = mix(tl, tr, f.x);
  vec3 bm = mix(bl, br, f.x);
  return mix(tm, bm, f.y);
}
#define r0 1.0
#define v0 0.339
#define m0 -2.0
#define r1 0.8
#define v1 0.276
#define m1 -1.0
#define r4 0.4
#define v4 0.046
#define m4 2.0
#define r5 0.305
#define v5 0.016
#define m5 3.0
#define r6 0.21
#define v6 0.0038
#define m6 4.0
float roughnessToMip(float roughness) {
  float mip = 0.0;
  if (roughness >= r1) {
    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
  } else if (roughness >= r4) {
    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
  } else if (roughness >= r5) {
    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
  } else if (roughness >= r6) {
    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
  } else {
    mip = -2.0 * log2(1.16 * roughness);  }
  return mip;
}
vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {
  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);
  float mipF = fract(mip);
  float mipInt = floor(mip);
  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);
  if (mipF == 0.0) {
    return vec4(color0, 1.0);
  } else {
    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);
    return vec4(mix(color0, color1, mipF), 1.0);
  }
}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	transformedNormal = mat3( instanceMatrix ) * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value )  {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		}  else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#elif defined( ENVMAP_TYPE_EQUIREC )
		vec2 sampleUV;
		reflectVec = normalize( reflectVec );
		sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
		sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
		vec4 envColor = texture2D( envMap, sampleUV );
	#elif defined( ENVMAP_TYPE_SPHERE )
		reflectVec = normalize( reflectVec );
		vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );
		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
		  vec3 reflectVec = reflect( -viewDir, normal );
		  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
		  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#elif defined( ENVMAP_TYPE_EQUIREC )
			vec2 sampleUV;
			sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
			sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_SPHERE )
			vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) { 
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	fogDepth = -mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float fogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex:`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
#endif`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
		float shadowCameraNear;
		float shadowCameraFar;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = saturate( clearcoat );	material.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3	diffuseColor;
	float	specularRoughness;
	vec3	specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
	uniform float morphTargetInfluences[ 8 ];
	#else
	uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
	transformed += morphTarget4 * morphTargetInfluences[ 4 ];
	transformed += morphTarget5 * morphTargetInfluences[ 5 ];
	transformed += morphTarget6 * morphTargetInfluences[ 6 ];
	transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,normal_fragment_begin:`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		float scale = sign( st1.t * st0.s - st0.t * st1.s );
		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );
		mat3 tsn = mat3( S, T, N );
		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		return normalize( tsn * mapN );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );
	#endif
#endif`,clearcoat_normalmap_pars_fragment:`#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;
	}
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLights[ i ];
		shadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLights[ i ];
		shadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLights[ i ];
		shadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
uniform float toneMappingWhitePoint;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );
}`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( gl_FragCoord.z );
	#endif
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV;
	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	vLineDistance = scale * lineDistance;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSPARENCY
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSPARENCY
	uniform float transparency;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_normalmap_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSPARENCY
		diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,normal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,normal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,shadow_vert:`#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`},Li={basic:{uniforms:hi([en.common,en.specularmap,en.envmap,en.aomap,en.lightmap,en.fog]),vertexShader:dr.meshbasic_vert,fragmentShader:dr.meshbasic_frag},lambert:{uniforms:hi([en.common,en.specularmap,en.envmap,en.aomap,en.lightmap,en.emissivemap,en.fog,en.lights,{emissive:{value:new Cn(0)}}]),vertexShader:dr.meshlambert_vert,fragmentShader:dr.meshlambert_frag},phong:{uniforms:hi([en.common,en.specularmap,en.envmap,en.aomap,en.lightmap,en.emissivemap,en.bumpmap,en.normalmap,en.displacementmap,en.fog,en.lights,{emissive:{value:new Cn(0)},specular:{value:new Cn(1118481)},shininess:{value:30}}]),vertexShader:dr.meshphong_vert,fragmentShader:dr.meshphong_frag},standard:{uniforms:hi([en.common,en.envmap,en.aomap,en.lightmap,en.emissivemap,en.bumpmap,en.normalmap,en.displacementmap,en.roughnessmap,en.metalnessmap,en.fog,en.lights,{emissive:{value:new Cn(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:dr.meshphysical_vert,fragmentShader:dr.meshphysical_frag},toon:{uniforms:hi([en.common,en.specularmap,en.aomap,en.lightmap,en.emissivemap,en.bumpmap,en.normalmap,en.displacementmap,en.gradientmap,en.fog,en.lights,{emissive:{value:new Cn(0)},specular:{value:new Cn(1118481)},shininess:{value:30}}]),vertexShader:dr.meshtoon_vert,fragmentShader:dr.meshtoon_frag},matcap:{uniforms:hi([en.common,en.bumpmap,en.normalmap,en.displacementmap,en.fog,{matcap:{value:null}}]),vertexShader:dr.meshmatcap_vert,fragmentShader:dr.meshmatcap_frag},points:{uniforms:hi([en.points,en.fog]),vertexShader:dr.points_vert,fragmentShader:dr.points_frag},dashed:{uniforms:hi([en.common,en.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:dr.linedashed_vert,fragmentShader:dr.linedashed_frag},depth:{uniforms:hi([en.common,en.displacementmap]),vertexShader:dr.depth_vert,fragmentShader:dr.depth_frag},normal:{uniforms:hi([en.common,en.bumpmap,en.normalmap,en.displacementmap,{opacity:{value:1}}]),vertexShader:dr.normal_vert,fragmentShader:dr.normal_frag},sprite:{uniforms:hi([en.sprite,en.fog]),vertexShader:dr.sprite_vert,fragmentShader:dr.sprite_frag},background:{uniforms:{uvTransform:{value:new Be},t2D:{value:null}},vertexShader:dr.background_vert,fragmentShader:dr.background_frag},cube:{uniforms:hi([en.envmap,{opacity:{value:1}}]),vertexShader:dr.cube_vert,fragmentShader:dr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:dr.equirect_vert,fragmentShader:dr.equirect_frag},distanceRGBA:{uniforms:hi([en.common,en.displacementmap,{referencePosition:{value:new Se},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:dr.distanceRGBA_vert,fragmentShader:dr.distanceRGBA_frag},shadow:{uniforms:hi([en.lights,en.fog,{color:{value:new Cn(0)},opacity:{value:1}}]),vertexShader:dr.shadow_vert,fragmentShader:dr.shadow_frag}};function fl(e,t,n,i){var l,h,g=new Cn(0),b=0,k=null,F=0,K=null;function Q(ne,U){t.buffers.color.setClear(ne.r,ne.g,ne.b,U,i)}return{getClearColor:function(){return g},setClearColor:function(ne,U){g.set(ne),Q(g,b=U!==void 0?U:1)},getClearAlpha:function(){return b},setClearAlpha:function(ne){Q(g,b=ne)},render:function(ne,U,oe,ue){var pe=U.background,Te=e.xr,Oe=Te.getSession&&Te.getSession();if(Oe&&Oe.environmentBlendMode==="additive"&&(pe=null),pe===null?Q(g,b):pe&&pe.isColor&&(Q(pe,1),ue=!0),(e.autoClear||ue)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),pe&&(pe.isCubeTexture||pe.isWebGLCubeRenderTarget||pe.mapping===L)){h===void 0&&((h=new Vr(new Aa(1,1,1),new Fr({type:"BackgroundCubeMaterial",uniforms:Pa(Li.cube.uniforms),vertexShader:Li.cube.vertexShader,fragmentShader:Li.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(Ze,Ge,et){this.matrixWorld.copyPosition(et.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h));var Fe=pe.isWebGLCubeRenderTarget?pe.texture:pe;h.material.uniforms.envMap.value=Fe,h.material.uniforms.flipEnvMap.value=Fe.isCubeTexture?-1:1,k===pe&&F===Fe.version&&K===e.toneMapping||(h.material.needsUpdate=!0,k=pe,F=Fe.version,K=e.toneMapping),ne.unshift(h,h.geometry,h.material,0,0,null)}else pe&&pe.isTexture&&(l===void 0&&((l=new Vr(new Va(2,2),new Fr({type:"BackgroundMaterial",uniforms:Pa(Li.background.uniforms),vertexShader:Li.background.vertexShader,fragmentShader:Li.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(l)),(l.material.uniforms.t2D.value=pe).matrixAutoUpdate===!0&&pe.updateMatrix(),l.material.uniforms.uvTransform.value.copy(pe.matrix),k===pe&&F===pe.version&&K===e.toneMapping||(l.material.needsUpdate=!0,F=(k=pe).version,K=e.toneMapping),ne.unshift(l,l.geometry,l.material,0,0,null))}}}function js(){var e=this,t=null,n=0,i=!1,l=!1,h=new It,g=new Be,b={value:null,needsUpdate:!1};function k(){b.value!==t&&(b.value=t,b.needsUpdate=0<n),e.numPlanes=n,e.numIntersection=0}function F(K,Q,ne,U){var oe=K!==null?K.length:0,ue=null;if(oe!==0){if(ue=b.value,U!==!0||ue===null){var pe=ne+4*oe,Te=Q.matrixWorldInverse;g.getNormalMatrix(Te),(ue===null||ue.length<pe)&&(ue=new Float32Array(pe));for(var Oe=0,Fe=ne;Oe!==oe;++Oe,Fe+=4)h.copy(K[Oe]).applyMatrix4(Te,g),h.normal.toArray(ue,Fe),ue[Fe+3]=h.constant}b.value=ue,b.needsUpdate=!0}return e.numPlanes=oe,ue}this.uniform=b,this.numPlanes=0,this.numIntersection=0,this.init=function(K,Q,ne){var U=K.length!==0||Q||n!==0||i;return i=Q,t=F(K,ne,0),n=K.length,U},this.beginShadows=function(){l=!0,F(null)},this.endShadows=function(){l=!1,k()},this.setState=function(K,Q,ne,U,oe,ue){if(!i||K===null||K.length===0||l&&!ne)l?F(null):k();else{var pe=l?0:n,Te=4*pe,Oe=oe.clippingState||null;b.value=Oe,Oe=F(K,U,Te,ue);for(var Fe=0;Fe!==Te;++Fe)Oe[Fe]=t[Fe];oe.clippingState=Oe,this.numIntersection=Q?this.numPlanes:0,this.numPlanes+=pe}}}function Ns(e,t){return Math.abs(t[1])-Math.abs(e[1])}function oo(e,t,n,i,l,h,g,b,k,F){nn.call(this,e=e!==void 0?e:[],t=t!==void 0?t:I,n,i,l,h,g=g!==void 0?g:m,b,k,F),this.flipY=!1}function gs(e,t,n,i){nn.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:i||1},this.magFilter=z,this.minFilter=z,this.wrapR=C,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function oi(e,t,n,i){nn.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:i||1},this.magFilter=z,this.minFilter=z,this.wrapR=C,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Li.physical={uniforms:hi([Li.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new Cn(0)},clearcoatNormalScale:{value:new Ve(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:dr.meshphysical_vert,fragmentShader:dr.meshphysical_frag},((oo.prototype=Object.create(nn.prototype)).constructor=oo).prototype.isCubeTexture=!0,Object.defineProperty(oo.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),((gs.prototype=Object.create(nn.prototype)).constructor=gs).prototype.isDataTexture2DArray=!0,((oi.prototype=Object.create(nn.prototype)).constructor=oi).prototype.isDataTexture3D=!0;var Bi=new nn,$l=new gs,Ql=new oi,ml=new oo,ke=[],ot=[],vt=new Float32Array(16),Dt=new Float32Array(9),kt=new Float32Array(4);function on(e,t,n){var i=e[0];if(i<=0||0<i)return e;var l=t*n,h=ke[l];if(h===void 0&&(h=new Float32Array(l),ke[l]=h),t!==0){i.toArray(h,0);for(var g=1,b=0;g!==t;++g)b+=n,e[g].toArray(h,b)}return h}function rn(e,t){if(e.length===t.length){for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return;return 1}}function pn(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function un(e,t){var n=ot[t];n===void 0&&(n=new Int32Array(t),ot[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Br(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function _r(e,t){var n=this.cache;if(t.x!==void 0)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(rn(n,t))return;e.uniform2fv(this.addr,t),pn(n,t)}}function fr(e,t){var n=this.cache;if(t.x!==void 0)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(t.r!==void 0)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(rn(n,t))return;e.uniform3fv(this.addr,t),pn(n,t)}}function jr(e,t){var n=this.cache;if(t.x!==void 0)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(rn(n,t))return;e.uniform4fv(this.addr,t),pn(n,t)}}function ir(e,t){var n=this.cache,i=t.elements;if(i===void 0){if(rn(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),pn(n,t)}else{if(rn(n,i))return;kt.set(i),e.uniformMatrix2fv(this.addr,!1,kt),pn(n,i)}}function bi(e,t){var n=this.cache,i=t.elements;if(i===void 0){if(rn(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),pn(n,t)}else{if(rn(n,i))return;Dt.set(i),e.uniformMatrix3fv(this.addr,!1,Dt),pn(n,i)}}function Ii(e,t){var n=this.cache,i=t.elements;if(i===void 0){if(rn(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),pn(n,t)}else{if(rn(n,i))return;vt.set(i),e.uniformMatrix4fv(this.addr,!1,vt),pn(n,i)}}function Gi(e,t,n){var i=this.cache,l=n.allocateTextureUnit();i[0]!==l&&(e.uniform1i(this.addr,l),i[0]=l),n.safeSetTexture2D(t||Bi,l)}function ye(e,t,n){var i=this.cache,l=n.allocateTextureUnit();i[0]!==l&&(e.uniform1i(this.addr,l),i[0]=l),n.setTexture2DArray(t||$l,l)}function Wi(e,t,n){var i=this.cache,l=n.allocateTextureUnit();i[0]!==l&&(e.uniform1i(this.addr,l),i[0]=l),n.setTexture3D(t||Ql,l)}function ba(e,t,n){var i=this.cache,l=n.allocateTextureUnit();i[0]!==l&&(e.uniform1i(this.addr,l),i[0]=l),n.safeSetTextureCube(t||ml,l)}function Or(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function xr(e,t){var n=this.cache;rn(n,t)||(e.uniform2iv(this.addr,t),pn(n,t))}function Qi(e,t){var n=this.cache;rn(n,t)||(e.uniform3iv(this.addr,t),pn(n,t))}function Fa(e,t){var n=this.cache;rn(n,t)||(e.uniform4iv(this.addr,t),pn(n,t))}function so(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Oo(e,t){e.uniform1fv(this.addr,t)}function Ya(e,t){e.uniform1iv(this.addr,t)}function Lh(e,t){e.uniform2iv(this.addr,t)}function Ih(e,t){e.uniform3iv(this.addr,t)}function Hu(e,t){e.uniform4iv(this.addr,t)}function ec(e,t){var n=on(t,this.size,2);e.uniform2fv(this.addr,n)}function au(e,t){var n=on(t,this.size,3);e.uniform3fv(this.addr,n)}function pp(e,t){var n=on(t,this.size,4);e.uniform4fv(this.addr,n)}function kh(e,t){var n=on(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Ko(e,t){var n=on(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Wu(e,t){var n=on(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Vs(e,t,n){var i=t.length,l=un(n,i);e.uniform1iv(this.addr,l);for(var h=0;h!==i;++h)n.safeSetTexture2D(t[h]||Bi,l[h])}function lo(e,t,n){var i=t.length,l=un(n,i);e.uniform1iv(this.addr,l);for(var h=0;h!==i;++h)n.safeSetTextureCube(t[h]||ml,l[h])}function jh(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(i){switch(t.type){case 5126:return Br;case 35664:return _r;case 35665:return fr;case 35666:return jr;case 35674:return ir;case 35675:return bi;case 35676:return Ii;case 5124:case 35670:return Or;case 35667:case 35671:return xr;case 35668:case 35672:return Qi;case 35669:case 35673:return Fa;case 5125:return so;case 35678:case 36198:case 36298:case 36306:case 35682:return Gi;case 35679:case 36299:case 36307:return Wi;case 35680:case 36300:case 36308:case 36293:return ba;case 36289:case 36303:case 36311:case 36292:return ye}}()}function Ju(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(i){switch(t.type){case 5126:return Oo;case 35664:return ec;case 35665:return au;case 35666:return pp;case 35674:return kh;case 35675:return Ko;case 35676:return Wu;case 5124:case 35670:return Ya;case 35667:case 35671:return Lh;case 35668:case 35672:return Ih;case 35669:case 35673:return Hu;case 35678:case 36198:case 36298:case 36306:case 35682:return Vs;case 35680:case 36300:case 36308:case 36293:return lo}}()}function gl(e){this.id=e,this.seq=[],this.map={}}Ju.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),pn(t,e)},gl.prototype.setValue=function(e,t,n){for(var i=this.seq,l=0,h=i.length;l!==h;++l){var g=i[l];g.setValue(e,t[g.id],n)}};var Ro=/([\w\d_]+)(\])?(\[|\.)?/g;function qu(e,t){e.seq.push(t),e.map[t.id]=t}function dp(e,t,n){var i=e.name,l=i.length;for(Ro.lastIndex=0;;){var h=Ro.exec(i),g=Ro.lastIndex,b=h[1],k=h[2]==="]",F=h[3];if(k&&(b|=0),F===void 0||F==="["&&g+2===l){qu(n,new(F===void 0?jh:Ju)(b,e,t));break}var K=n.map[b];K===void 0&&qu(n,K=new gl(b)),n=K}}function xo(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),i=0;i<n;++i){var l=e.getActiveUniform(t,i);dp(l,e.getUniformLocation(t,l.name),this)}}function Xu(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}xo.prototype.setValue=function(e,t,n,i){var l=this.map[t];l!==void 0&&l.setValue(e,n,i)},xo.prototype.setOptional=function(e,t,n){var i=t[n];i!==void 0&&this.setValue(e,n,i)},xo.upload=function(e,t,n,i){for(var l=0,h=t.length;l!==h;++l){var g=t[l],b=n[g.id];b.needsUpdate!==!1&&g.setValue(e,b.value,i)}},xo.seqWithValue=function(e,t){for(var n=[],i=0,l=e.length;i!==l;++i){var h=e[i];h.id in t&&n.push(h)}return n};var pa=0;function ou(e){switch(e){case at:return["Linear","( value )"];case tt:return["sRGB","( value )"];case De:return["RGBE","( value )"];case st:return["RGBM","( value, 7.0 )"];case gt:return["RGBM","( value, 16.0 )"];case St:return["RGBD","( value, 256.0 )"];case le:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function Yu(e,t,n){var i=e.getShaderParameter(t,35713),l=e.getShaderInfoLog(t).trim();return i&&l===""?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+`
`+l+function(h){for(var g=h.split(`
`),b=0;b<g.length;b++)g[b]=b+1+": "+g[b];return g.join(`
`)}(e.getShaderSource(t))}function Ba(e,t){var n=ou(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Fs(e){return e!==""}function tc(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ys(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Nh=/^[ \t]*#include +<([\w\d./]+)>/gm;function da(e){return e.replace(Nh,Zu)}function Zu(e,t){var n=dr[t];if(n===void 0)throw new Error("Can not resolve #include <"+t+">");return da(n)}var fp=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function Vh(e){return e.replace(fp,Ku)}function Ku(e,t,n,i){for(var l="",h=parseInt(t);h<parseInt(n);h++)l+=i.replace(/\[ i \]/g,"[ "+h+" ]").replace(/UNROLLED_LOOP_INDEX/g,h);return l}function yl(e){var t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function Fh(e,t,n){var i,l,h,g,b,k,F,K=e.getContext(),Q=n.defines,ne=n.vertexShader,U=n.fragmentShader,oe=(l="SHADOWMAP_TYPE_BASIC",(i=n).shadowMapType===1?l="SHADOWMAP_TYPE_PCF":i.shadowMapType===2?l="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===3&&(l="SHADOWMAP_TYPE_VSM"),l),ue=function(sr){var Tn="ENVMAP_TYPE_CUBE";if(sr.envMap)switch(sr.envMapMode){case I:case H:Tn="ENVMAP_TYPE_CUBE";break;case L:case y:Tn="ENVMAP_TYPE_CUBE_UV";break;case 303:case G:Tn="ENVMAP_TYPE_EQUIREC";break;case 305:Tn="ENVMAP_TYPE_SPHERE"}return Tn}(n),pe=function(sr){var Tn="ENVMAP_MODE_REFLECTION";if(sr.envMap)switch(sr.envMapMode){case H:case G:Tn="ENVMAP_MODE_REFRACTION"}return Tn}(n),Te=function(sr){var Tn="ENVMAP_BLENDING_NONE";if(sr.envMap)switch(sr.combine){case 0:Tn="ENVMAP_BLENDING_MULTIPLY";break;case 1:Tn="ENVMAP_BLENDING_MIX";break;case 2:Tn="ENVMAP_BLENDING_ADD"}return Tn}(n),Oe=0<e.gammaFactor?e.gammaFactor:1,Fe=n.isWebGL2?"":[(h=n).extensionDerivatives||h.envMapCubeUV||h.bumpMap||h.tangentSpaceNormalMap||h.clearcoatNormalMap||h.flatShading||h.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(h.extensionFragDepth||h.logarithmicDepthBuffer)&&h.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",h.extensionDrawBuffers&&h.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(h.extensionShaderTextureLOD||h.envMap)&&h.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Fs).join(`
`),Ze=function(sr){var Tn=[];for(var je in sr){var nt=sr[je];nt!==!1&&Tn.push("#define "+je+" "+nt)}return Tn.join(`
`)}(Q),Ge=K.createProgram(),et=n.numMultiviewViews;if(n.isRawShaderMaterial?(0<(g=[Ze].filter(Fs).join(`
`)).length&&(g+=`
`),0<(b=[Fe,Ze].filter(Fs).join(`
`)).length&&(b+=`
`)):(g=[yl(n),"#define SHADER_NAME "+n.shaderName,Ze,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+Oe,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+pe:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+oe:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Fs).join(`
`),b=[Fe,yl(n),"#define SHADER_NAME "+n.shaderName,Ze,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+Oe,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+ue:"",n.envMap?"#define "+pe:"",n.envMap?"#define "+Te:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+oe:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==0?"#define TONE_MAPPING":"",n.toneMapping!==0?dr.tonemapping_pars_fragment:"",n.toneMapping!==0?function(sr,Tn){var je;switch(Tn){case 1:je="Linear";break;case 2:je="Reinhard";break;case 3:je="Uncharted2";break;case 4:je="OptimizedCineon";break;case 5:je="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+Tn)}return"vec3 toneMapping( vec3 color ) { return "+je+"ToneMapping( color ); }"}(0,n.toneMapping):"",n.dithering?"#define DITHERING":"",n.outputEncoding||n.mapEncoding||n.matcapEncoding||n.envMapEncoding||n.emissiveMapEncoding||n.lightMapEncoding?dr.encodings_pars_fragment:"",n.mapEncoding?Ba("mapTexelToLinear",n.mapEncoding):"",n.matcapEncoding?Ba("matcapTexelToLinear",n.matcapEncoding):"",n.envMapEncoding?Ba("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?Ba("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMapEncoding?Ba("lightMapTexelToLinear",n.lightMapEncoding):"",n.outputEncoding?(k=n.outputEncoding,F=ou(k),"vec4 linearToOutputTexel( vec4 value ) { return LinearTo"+F[0]+F[1]+"; }"):"",n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(Fs).join(`
`)),ne=ys(ne=tc(ne=da(ne),n),n),U=ys(U=tc(U=da(U),n),n),ne=Vh(ne),U=Vh(U),n.isWebGL2&&!n.isRawShaderMaterial){var We=!1,ft=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&ne.match(ft)!==null&&U.match(ft)!==null&&(We=!0,ne=ne.replace(ft,""),U=U.replace(ft,"")),g=[`#version 300 es
`,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,b=[`#version 300 es
`,"#define varying in",We?"":"out highp vec4 pc_fragColor;",We?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b,0<et&&(g=(g=g.replace(`#version 300 es
`,[`#version 300 es
`,"#extension GL_OVR_multiview2 : require","layout(num_views = "+et+") in;","#define VIEW_ID gl_ViewID_OVR"].join(`
`))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join(`
`),["uniform mat4 modelViewMatrices["+et+"];","uniform mat4 projectionMatrices["+et+"];","uniform mat4 viewMatrices["+et+"];","uniform mat3 normalMatrices["+et+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join(`
`)),b=(b=b.replace(`#version 300 es
`,[`#version 300 es
`,"#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join(`
`))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+et+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join(`
`)))}var _t,Et,At=b+U,Nt=Xu(K,35633,g+ne),Xt=Xu(K,35632,At);if(K.attachShader(Ge,Nt),K.attachShader(Ge,Xt),n.index0AttributeName!==void 0?K.bindAttribLocation(Ge,0,n.index0AttributeName):n.morphTargets===!0&&K.bindAttribLocation(Ge,0,"position"),K.linkProgram(Ge),e.debug.checkShaderErrors){var Tt=K.getProgramInfoLog(Ge).trim(),wt=K.getShaderInfoLog(Nt).trim(),sn=K.getShaderInfoLog(Xt).trim(),gn=!0,Jn=!0;if(K.getProgramParameter(Ge,35714)===!1){gn=!1;var Gn=Yu(K,Nt,"vertex"),Nn=Yu(K,Xt,"fragment");console.error("THREE.WebGLProgram: shader error: ",K.getError(),"35715",K.getProgramParameter(Ge,35715),"gl.getProgramInfoLog",Tt,Gn,Nn)}else Tt!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",Tt):wt!==""&&sn!==""||(Jn=!1);Jn&&(this.diagnostics={runnable:gn,programLog:Tt,vertexShader:{log:wt,prefix:g},fragmentShader:{log:sn,prefix:b}})}return K.deleteShader(Nt),K.deleteShader(Xt),this.getUniforms=function(){return _t===void 0&&(_t=new xo(K,Ge)),_t},this.getAttributes=function(){return Et===void 0&&(Et=function(sr,Tn){for(var je={},nt=sr.getProgramParameter(Tn,35721),Jt=0;Jt<nt;Jt++){var zt=sr.getActiveAttrib(Tn,Jt).name;je[zt]=sr.getAttribLocation(Tn,zt)}return je}(K,Ge)),Et},this.destroy=function(){K.deleteProgram(Ge),this.program=void 0},this.name=n.shaderName,this.id=pa++,this.cacheKey=t,this.usedTimes=1,this.program=Ge,this.vertexShader=Nt,this.fragmentShader=Xt,this.numMultiviewViews=et,this}function nc(e,t,n){var i=[],l=n.isWebGL2,h=n.logarithmicDepthBuffer,g=n.floatVertexTextures,b=n.precision,k=n.maxVertexUniforms,F=n.vertexTextures,K={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},Q=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function ne(U){var oe;return U?U.isTexture?oe=U.encoding:U.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),oe=U.texture.encoding):oe=at,oe}this.getParameters=function(U,oe,ue,pe,Te,Oe,Fe){var Ze=pe.fog,Ge=U.isMeshStandardMaterial?pe.environment:null,et=U.envMap||Ge,We=K[U.type],ft=Fe.isSkinnedMesh?function(Nt){var Xt=Fe.skeleton.bones;if(g)return 1024;var Tt=k,wt=Math.floor((Tt-20)/4),sn=Math.min(wt,Xt.length);return sn<Xt.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+Xt.length+" bones. This GPU supports "+sn+"."),0):sn}():0;U.precision!==null&&(b=n.getMaxPrecision(U.precision))!==U.precision&&console.warn("THREE.WebGLProgram.getParameters:",U.precision,"not supported, using",b,"instead.");var _t=function(Nt,Xt){var Tt;if(We){var wt=Li[We];Tt={name:Nt.type,uniforms:Ri.clone(wt.uniforms),vertexShader:wt.vertexShader,fragmentShader:wt.fragmentShader}}else Tt={name:Nt.type,uniforms:Nt.uniforms,vertexShader:Nt.vertexShader,fragmentShader:Nt.fragmentShader};return Tt}(U);U.onBeforeCompile(_t,e);var Et=e.getRenderTarget(),At=Et&&Et.isWebGLMultiviewRenderTarget?Et.numViews:0;return{isWebGL2:l,shaderID:We,shaderName:_t.name,uniforms:_t.uniforms,vertexShader:_t.vertexShader,fragmentShader:_t.fragmentShader,defines:U.defines,isRawShaderMaterial:U.isRawShaderMaterial,isShaderMaterial:U.isShaderMaterial,precision:b,instancing:Fe.isInstancedMesh===!0,supportsVertexTextures:F,numMultiviewViews:At,outputEncoding:Et!==null?ne(Et.texture):e.outputEncoding,map:!!U.map,mapEncoding:ne(U.map),matcap:!!U.matcap,matcapEncoding:ne(U.matcap),envMap:!!et,envMapMode:et&&et.mapping,envMapEncoding:ne(et),envMapCubeUV:!!et&&(et.mapping===L||et.mapping===y),lightMap:!!U.lightMap,lightMapEncoding:ne(U.lightMap),aoMap:!!U.aoMap,emissiveMap:!!U.emissiveMap,emissiveMapEncoding:ne(U.emissiveMap),bumpMap:!!U.bumpMap,normalMap:!!U.normalMap,objectSpaceNormalMap:U.normalMapType===1,tangentSpaceNormalMap:U.normalMapType===0,clearcoatNormalMap:!!U.clearcoatNormalMap,displacementMap:!!U.displacementMap,roughnessMap:!!U.roughnessMap,metalnessMap:!!U.metalnessMap,specularMap:!!U.specularMap,alphaMap:!!U.alphaMap,gradientMap:!!U.gradientMap,sheen:!!U.sheen,combine:U.combine,vertexTangents:U.normalMap&&U.vertexTangents,vertexColors:U.vertexColors,vertexUvs:!!(U.map||U.bumpMap||U.normalMap||U.specularMap||U.alphaMap||U.emissiveMap||U.roughnessMap||U.metalnessMap||U.clearcoatNormalMap||U.displacementMap),uvsVertexOnly:!(U.map||U.bumpMap||U.normalMap||U.specularMap||U.alphaMap||U.emissiveMap||U.roughnessMap||U.metalnessMap||U.clearcoatNormalMap||!U.displacementMap),fog:!!Ze,useFog:U.fog,fogExp2:Ze&&Ze.isFogExp2,flatShading:U.flatShading,sizeAttenuation:U.sizeAttenuation,logarithmicDepthBuffer:h,skinning:U.skinning&&0<ft,maxBones:ft,useVertexTexture:g,morphTargets:U.morphTargets,morphNormals:U.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:oe.directional.length,numPointLights:oe.point.length,numSpotLights:oe.spot.length,numRectAreaLights:oe.rectArea.length,numHemiLights:oe.hemi.length,numDirLightShadows:oe.directionalShadowMap.length,numPointLightShadows:oe.pointShadowMap.length,numSpotLightShadows:oe.spotShadowMap.length,numClippingPlanes:Te,numClipIntersection:Oe,dithering:U.dithering,shadowMapEnabled:e.shadowMap.enabled&&0<ue.length,shadowMapType:e.shadowMap.type,toneMapping:U.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:U.premultipliedAlpha,alphaTest:U.alphaTest,doubleSided:U.side===2,flipSided:U.side===1,depthPacking:U.depthPacking!==void 0&&U.depthPacking,index0AttributeName:U.index0AttributeName,extensionDerivatives:U.extensions&&U.extensions.derivatives,extensionFragDepth:U.extensions&&U.extensions.frawbuffers,extensionDrawbuffers:U.extensions&&U.extensions.drawbuffers,extensionShaderTextureLOD:U.extensions&&U.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||t.get("EXT_frag_depth")!==null,rendererExtensionDrawBuffers:l||t.get("WEBGL_draw_buffers")!==null,rendererExtensionShaderTextureLod:l||t.get("EXT_shader_texture_lod")!==null,onBeforeCompile:U.onBeforeCompile}},this.getProgramCacheKey=function(U){var oe=[];if(U.shaderID?oe.push(U.shaderID):(oe.push(U.fragmentShader),oe.push(U.vertexShader)),U.defines!==void 0)for(var ue in U.defines)oe.push(ue),oe.push(U.defines[ue]);if(U.isRawShaderMaterial===void 0){for(var pe=0;pe<Q.length;pe++)oe.push(U[Q[pe]]);oe.push(e.outputEncoding),oe.push(e.gammaFactor)}return oe.push(U.onBeforeCompile.toString()),oe.join()},this.acquireProgram=function(U,oe){for(var ue,pe=0,Te=i.length;pe<Te;pe++){var Oe=i[pe];if(Oe.cacheKey===oe){++(ue=Oe).usedTimes;break}}return ue===void 0&&(ue=new Fh(e,oe,U),i.push(ue)),ue},this.releaseProgram=function(U){if(--U.usedTimes==0){var oe=i.indexOf(U);i[oe]=i[i.length-1],i.pop(),U.destroy()}},this.programs=i}function $u(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Bh(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Qu(){var e=[],t=0,n=[],i=[],l={id:-1};function h(g,b,k,F,K,Q){var ne=e[t];return ne===void 0?(ne={id:g.id,object:g,geometry:b,material:k,program:k.program||l,groupOrder:F,renderOrder:g.renderOrder,z:K,group:Q},e[t]=ne):(ne.id=g.id,ne.object=g,ne.geometry=b,ne.material=k,ne.program=k.program||l,ne.groupOrder=F,ne.renderOrder=g.renderOrder,ne.z=K,ne.group=Q),t++,ne}return{opaque:n,transparent:i,init:function(){t=0,n.length=0,i.length=0},push:function(g,b,k,F,K,Q){var ne=h(g,b,k,F,K,Q);(k.transparent===!0?i:n).push(ne)},unshift:function(g,b,k,F,K,Q){var ne=h(g,b,k,F,K,Q);(k.transparent===!0?i:n).unshift(ne)},sort:function(g,b){1<n.length&&n.sort(g||$u),1<i.length&&i.sort(b||Bh)}}}var eh=0;function th(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Gh(){for(var e=new function(){var g={};return{get:function(b){if(g[b.id]!==void 0)return g[b.id];var k;switch(b.type){case"DirectionalLight":k={direction:new Se,color:new Cn,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ve};break;case"SpotLight":k={position:new Se,direction:new Se,color:new Cn,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ve};break;case"PointLight":k={position:new Se,color:new Cn,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ve,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":k={direction:new Se,skyColor:new Cn,groundColor:new Cn};break;case"RectAreaLight":k={color:new Cn,position:new Se,halfWidth:new Se,halfHeight:new Se}}return g[b.id]=k}}},t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},n=0;n<9;n++)t.probe.push(new Se);var i=new Se,l=new Lt,h=new Lt;return{setup:function(g,b,k){for(var F=0,K=0,Q=0,ne=0;ne<9;ne++)t.probe[ne].set(0,0,0);var U=0,oe=0,ue=0,pe=0,Te=0,Oe=0,Fe=0,Ze=0,Ge=k.matrixWorldInverse;g.sort(th),ne=0;for(var et=g.length;ne<et;ne++){var We=g[ne],ft=We.color,_t=We.intensity,Et=We.distance,At=We.shadow&&We.shadow.map?We.shadow.map.texture:null;if(We.isAmbientLight)F+=ft.r*_t,K+=ft.g*_t,Q+=ft.b*_t;else if(We.isLightProbe)for(var Nt=0;Nt<9;Nt++)t.probe[Nt].addScaledVector(We.sh.coefficients[Nt],_t);else if(We.isDirectionalLight){if((Tt=e.get(We)).color.copy(We.color).multiplyScalar(We.intensity),Tt.direction.setFromMatrixPosition(We.matrixWorld),i.setFromMatrixPosition(We.target.matrixWorld),Tt.direction.sub(i),Tt.direction.transformDirection(Ge),Tt.shadow=We.castShadow,We.castShadow){var Xt=We.shadow;Tt.shadowBias=Xt.bias,Tt.shadowRadius=Xt.radius,Tt.shadowMapSize=Xt.mapSize,t.directionalShadowMap[U]=At,t.directionalShadowMatrix[U]=We.shadow.matrix,Oe++}t.directional[U]=Tt,U++}else if(We.isSpotLight)(Tt=e.get(We)).position.setFromMatrixPosition(We.matrixWorld),Tt.position.applyMatrix4(Ge),Tt.color.copy(ft).multiplyScalar(_t),Tt.distance=Et,Tt.direction.setFromMatrixPosition(We.matrixWorld),i.setFromMatrixPosition(We.target.matrixWorld),Tt.direction.sub(i),Tt.direction.transformDirection(Ge),Tt.coneCos=Math.cos(We.angle),Tt.penumbraCos=Math.cos(We.angle*(1-We.penumbra)),Tt.decay=We.decay,Tt.shadow=We.castShadow,We.castShadow&&(Xt=We.shadow,Tt.shadowBias=Xt.bias,Tt.shadowRadius=Xt.radius,Tt.shadowMapSize=Xt.mapSize,t.spotShadowMap[ue]=At,t.spotShadowMatrix[ue]=We.shadow.matrix,Ze++),t.spot[ue]=Tt,ue++;else if(We.isRectAreaLight)(Tt=e.get(We)).color.copy(ft).multiplyScalar(_t),Tt.position.setFromMatrixPosition(We.matrixWorld),Tt.position.applyMatrix4(Ge),h.identity(),l.copy(We.matrixWorld),l.premultiply(Ge),h.extractRotation(l),Tt.halfWidth.set(.5*We.width,0,0),Tt.halfHeight.set(0,.5*We.height,0),Tt.halfWidth.applyMatrix4(h),Tt.halfHeight.applyMatrix4(h),t.rectArea[pe]=Tt,pe++;else if(We.isPointLight)(Tt=e.get(We)).position.setFromMatrixPosition(We.matrixWorld),Tt.position.applyMatrix4(Ge),Tt.color.copy(We.color).multiplyScalar(We.intensity),Tt.distance=We.distance,Tt.decay=We.decay,Tt.shadow=We.castShadow,We.castShadow&&(Xt=We.shadow,Tt.shadowBias=Xt.bias,Tt.shadowRadius=Xt.radius,Tt.shadowMapSize=Xt.mapSize,Tt.shadowCameraNear=Xt.camera.near,Tt.shadowCameraFar=Xt.camera.far,t.pointShadowMap[oe]=At,t.pointShadowMatrix[oe]=We.shadow.matrix,Fe++),t.point[oe]=Tt,oe++;else if(We.isHemisphereLight){var Tt;(Tt=e.get(We)).direction.setFromMatrixPosition(We.matrixWorld),Tt.direction.transformDirection(Ge),Tt.direction.normalize(),Tt.skyColor.copy(We.color).multiplyScalar(_t),Tt.groundColor.copy(We.groundColor).multiplyScalar(_t),t.hemi[Te]=Tt,Te++}}t.ambient[0]=F,t.ambient[1]=K,t.ambient[2]=Q;var wt=t.hash;wt.directionalLength===U&&wt.pointLength===oe&&wt.spotLength===ue&&wt.rectAreaLength===pe&&wt.hemiLength===Te&&wt.numDirectionalShadows===Oe&&wt.numPointShadows===Fe&&wt.numSpotShadows===Ze||(t.directional.length=U,t.spot.length=ue,t.rectArea.length=pe,t.point.length=oe,t.hemi.length=Te,t.directionalShadowMap.length=Oe,t.pointShadowMap.length=Fe,t.spotShadowMap.length=Ze,t.directionalShadowMatrix.length=Oe,t.pointShadowMatrix.length=Fe,t.spotShadowMatrix.length=Ze,wt.directionalLength=U,wt.pointLength=oe,wt.spotLength=ue,wt.rectAreaLength=pe,wt.hemiLength=Te,wt.numDirectionalShadows=Oe,wt.numPointShadows=Fe,wt.numSpotShadows=Ze,t.version=eh++)},state:t}}function nh(){var e=new Gh,t=[],n=[];return{init:function(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function(i){e.setup(t,n,i)},pushLight:function(i){t.push(i)},pushShadow:function(i){n.push(i)}}}function Bs(e){rr.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function $o(e){rr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Se,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}function rh(e,t,n){var i=new Pr,l=new Ve,h=new Ve,g=new ct,b=[],k=[],F={},K={0:1,1:0,2:2},Q=new Fr({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ve},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
  float mean = 0.0;
  float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );
  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
    #ifdef HORIZONAL_PASS
      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
      mean += distribution.x;
      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
    #else
      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );
      mean += depth;
      squared_mean += depth * depth;
    #endif
  }
  mean = mean * HALF_SAMPLE_RATE;
  squared_mean = squared_mean * HALF_SAMPLE_RATE;
  float std_dev = sqrt( squared_mean - mean * mean );
  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),ne=Q.clone();ne.defines.HORIZONAL_PASS=1;var U=new X;U.setAttribute("position",new $n(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var oe=new Vr(U,Q),ue=this;function pe(Ge,et){var We=t.update(oe);Q.uniforms.shadow_pass.value=Ge.map.texture,Q.uniforms.resolution.value=Ge.mapSize,Q.uniforms.radius.value=Ge.radius,e.setRenderTarget(Ge.mapPass),e.clear(),e.renderBufferDirect(et,null,We,Q,oe,null),ne.uniforms.shadow_pass.value=Ge.mapPass.texture,ne.uniforms.resolution.value=Ge.mapSize,ne.uniforms.radius.value=Ge.radius,e.setRenderTarget(Ge.map),e.clear(),e.renderBufferDirect(et,null,We,ne,oe,null)}function Te(Ge,et,We){var ft=Ge|et<<1|We<<2,_t=b[ft];return _t===void 0&&(_t=new Bs({depthPacking:3201,morphTargets:Ge,skinning:et}),b[ft]=_t),_t}function Oe(Ge,et,We){var ft=Ge|et<<1|We<<2,_t=k[ft];return _t===void 0&&(_t=new $o({morphTargets:Ge,skinning:et}),k[ft]=_t),_t}function Fe(Ge,et,We,ft,_t,Et){var At=Ge.geometry,Nt=null,Xt=Te,Tt=Ge.customDepthMaterial;if(We.isPointLight===!0&&(Xt=Oe,Tt=Ge.customDistanceMaterial),Tt===void 0){var wt=!1;et.morphTargets===!0&&(At.isBufferGeometry===!0?wt=At.morphAttributes&&At.morphAttributes.position&&0<At.morphAttributes.position.length:At.isGeometry===!0&&(wt=At.morphTargets&&0<At.morphTargets.length));var sn=!1;Ge.isSkinnedMesh===!0&&(et.skinning===!0?sn=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",Ge)),Nt=Xt(wt,sn,Ge.isInstancedMesh===!0)}else Nt=Tt;if(e.localClippingEnabled&&et.clipShadows===!0&&et.clippingPlanes.length!==0){var gn=Nt.uuid,Jn=et.uuid,Gn=F[gn];Gn===void 0&&(Gn={},F[gn]=Gn);var Nn=Gn[Jn];Nn===void 0&&(Nn=Nt.clone(),Gn[Jn]=Nn),Nt=Nn}return Nt.visible=et.visible,Nt.wireframe=et.wireframe,Nt.side=Et===3?et.shadowSide!==null?et.shadowSide:et.side:et.shadowSide!==null?et.shadowSide:K[et.side],Nt.clipShadows=et.clipShadows,Nt.clippingPlanes=et.clippingPlanes,Nt.clipIntersection=et.clipIntersection,Nt.wireframeLinewidth=et.wireframeLinewidth,Nt.linewidth=et.linewidth,We.isPointLight===!0&&Nt.isMeshDistanceMaterial===!0&&(Nt.referencePosition.setFromMatrixPosition(We.matrixWorld),Nt.nearDistance=ft,Nt.farDistance=_t),Nt}function Ze(Ge,et,We,ft,_t){if(Ge.visible!==!1){if(Ge.layers.test(et.layers)&&(Ge.isMesh||Ge.isLine||Ge.isPoints)&&(Ge.castShadow||Ge.receiveShadow&&_t===3)&&(!Ge.frustumCulled||i.intersectsObject(Ge))){Ge.modelViewMatrix.multiplyMatrices(We.matrixWorldInverse,Ge.matrixWorld);var Et=t.update(Ge),At=Ge.material;if(Array.isArray(At))for(var Nt=Et.groups,Xt=0,Tt=Nt.length;Xt<Tt;Xt++){var wt=Nt[Xt],sn=At[wt.materialIndex];if(sn&&sn.visible){var gn=Fe(Ge,sn,ft,We.near,We.far,_t);e.renderBufferDirect(We,null,Et,gn,Ge,wt)}}else At.visible&&(gn=Fe(Ge,At,ft,We.near,We.far,_t),e.renderBufferDirect(We,null,Et,gn,Ge,null))}for(var Jn=Ge.children,Gn=0,Nn=Jn.length;Gn<Nn;Gn++)Ze(Jn[Gn],et,We,ft,_t)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(Ge,et,We){if(ue.enabled!==!1&&(ue.autoUpdate!==!1||ue.needsUpdate!==!1)&&Ge.length!==0){var ft=e.getRenderTarget(),_t=e.getActiveCubeFace(),Et=e.getActiveMipmapLevel(),At=e.state;At.setBlending(0),At.buffers.color.setClear(1,1,1,1),At.buffers.depth.setTest(!0),At.setScissorTest(!1);for(var Nt=0,Xt=Ge.length;Nt<Xt;Nt++){var Tt=Ge[Nt],wt=Tt.shadow;if(wt!==void 0){l.copy(wt.mapSize);var sn=wt.getFrameExtents();if(l.multiply(sn),h.copy(wt.mapSize),(l.x>n||l.y>n)&&(console.warn("THREE.WebGLShadowMap:",Tt,"has shadow exceeding max texture size, reducing"),l.x>n&&(h.x=Math.floor(n/sn.x),l.x=h.x*sn.x,wt.mapSize.x=h.x),l.y>n&&(h.y=Math.floor(n/sn.y),l.y=h.y*sn.y,wt.mapSize.y=h.y)),wt.map===null&&!wt.isPointLightShadow&&this.type===3){var gn={minFilter:q,magFilter:q,format:f};wt.map=new rt(l.x,l.y,gn),wt.map.texture.name=Tt.name+".shadowMap",wt.mapPass=new rt(l.x,l.y,gn),wt.camera.updateProjectionMatrix()}wt.map===null&&(gn={minFilter:z,magFilter:z,format:f},wt.map=new rt(l.x,l.y,gn),wt.map.texture.name=Tt.name+".shadowMap",wt.camera.updateProjectionMatrix()),e.setRenderTarget(wt.map),e.clear();for(var Jn=wt.getViewportCount(),Gn=0;Gn<Jn;Gn++){var Nn=wt.getViewport(Gn);g.set(h.x*Nn.x,h.y*Nn.y,h.x*Nn.z,h.y*Nn.w),At.viewport(g),wt.updateMatrices(Tt,Gn),i=wt.getFrustum(),Ze(et,We,wt.camera,Tt,this.type)}wt.isPointLightShadow||this.type!==3||pe(wt,We)}else console.warn("THREE.WebGLShadowMap:",Tt,"has no shadow.")}ue.needsUpdate=!1,e.setRenderTarget(ft,_t,Et)}}}function zh(e,t,n){var i=n.isWebGL2,l=new function(){var pt=!1,yn=new ct,vn=null,tr=new ct(0,0,0,0);return{setMask:function(an){vn===an||pt||(e.colorMask(an,an,an,an),vn=an)},setLocked:function(an){pt=an},setClear:function(an,gr,Tr,fi,to){to===!0&&(an*=fi,gr*=fi,Tr*=fi),yn.set(an,gr,Tr,fi),tr.equals(yn)===!1&&(e.clearColor(an,gr,Tr,fi),tr.copy(yn))},reset:function(){pt=!1,vn=null,tr.set(-1,0,0,0)}}},h=new function(){var pt=!1,yn=null,vn=null,tr=null;return{setTest:function(an){(an?Tn:je)(2929)},setMask:function(an){yn===an||pt||(e.depthMask(an),yn=an)},setFunc:function(an){if(vn!==an){if(an)switch(an){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}else e.depthFunc(515);vn=an}},setLocked:function(an){pt=an},setClear:function(an){tr!==an&&(e.clearDepth(an),tr=an)},reset:function(){pt=!1,tr=vn=yn=null}}},g=new function(){var pt=!1,yn=null,vn=null,tr=null,an=null,gr=null,Tr=null,fi=null,to=null;return{setTest:function(Ir){pt||(Ir?Tn:je)(2960)},setMask:function(Ir){yn===Ir||pt||(e.stencilMask(Ir),yn=Ir)},setFunc:function(Ir,Ti,Er){vn===Ir&&tr===Ti&&an===Er||(e.stencilFunc(Ir,Ti,Er),vn=Ir,tr=Ti,an=Er)},setOp:function(Ir,Ti,Er){gr===Ir&&Tr===Ti&&fi===Er||(e.stencilOp(Ir,Ti,Er),gr=Ir,Tr=Ti,fi=Er)},setLocked:function(Ir){pt=Ir},setClear:function(Ir){to!==Ir&&(e.clearStencil(Ir),to=Ir)},reset:function(){pt=!1,to=fi=Tr=gr=an=tr=vn=yn=null}}},b=e.getParameter(34921),k=new Uint8Array(b),F=new Uint8Array(b),K=new Uint8Array(b),Q={},ne=null,U=null,oe=null,ue=null,pe=null,Te=null,Oe=null,Fe=null,Ze=null,Ge=!1,et=null,We=null,ft=null,_t=null,Et=null,At=e.getParameter(35661),Nt=!1,Xt=0,Tt=e.getParameter(7938);Tt.indexOf("WebGL")!==-1?(Xt=parseFloat(/^WebGL\ ([0-9])/.exec(Tt)[1]),Nt=1<=Xt):Tt.indexOf("OpenGL ES")!==-1&&(Xt=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(Tt)[1]),Nt=2<=Xt);var wt=null,sn={},gn=new ct,Jn=new ct;function Gn(pt,yn,vn){var tr=new Uint8Array(4),an=e.createTexture();e.bindTexture(pt,an),e.texParameteri(pt,10241,9728),e.texParameteri(pt,10240,9728);for(var gr=0;gr<vn;gr++)e.texImage2D(yn+gr,0,6408,1,1,0,6408,5121,tr);return an}var Nn={};function sr(pt,yn){k[pt]=1,F[pt]===0&&(e.enableVertexAttribArray(pt),F[pt]=1),K[pt]!==yn&&((i?e:t.get("ANGLE_instanced_arrays"))[i?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](pt,yn),K[pt]=yn)}function Tn(pt){Q[pt]!==!0&&(e.enable(pt),Q[pt]=!0)}function je(pt){Q[pt]!==!1&&(e.disable(pt),Q[pt]=!1)}Nn[3553]=Gn(3553,3553,1),Nn[34067]=Gn(34067,34069,6),l.setClear(0,0,0,1),h.setClear(1),g.setClear(0),Tn(2929),h.setFunc(3),Sn(!1),Ct(1),Tn(2884),Qn(0);var nt={100:32774,101:32778,102:32779};if(i)nt[103]=32775,nt[104]=32776;else{var Jt=t.get("EXT_blend_minmax");Jt!==null&&(nt[103]=Jt.MIN_EXT,nt[104]=Jt.MAX_EXT)}var zt={};function Qn(pt,yn,vn,tr,an,gr,Tr,fi){if(pt!==0){if(U||(Tn(3042),U=!0),pt===5)an=an||yn,gr=gr||vn,Tr=Tr||tr,yn===ue&&an===Oe||(e.blendEquationSeparate(nt[yn],nt[an]),ue=yn,Oe=an),vn===pe&&tr===Te&&gr===Fe&&Tr===Ze||(e.blendFuncSeparate(zt[vn],zt[tr],zt[gr],zt[Tr]),pe=vn,Te=tr,Fe=gr,Ze=Tr),oe=pt,Ge=null;else if(pt!==oe||fi!==Ge){if(ue===M&&Oe===M||(e.blendEquation(32774),Oe=ue=M),fi)switch(pt){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",pt)}else switch(pt){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",pt)}Ze=Fe=Te=pe=null,oe=pt,Ge=fi}}else U&&(je(3042),U=!1)}function Sn(pt){et!==pt&&(pt?e.frontFace(2304):e.frontFace(2305),et=pt)}function Ct(pt){pt!==0?(Tn(2884),pt!==We&&(pt===1?e.cullFace(1029):pt===2?e.cullFace(1028):e.cullFace(1032))):je(2884),We=pt}function An(pt,yn,vn){pt?(Tn(32823),_t===yn&&Et===vn||(e.polygonOffset(yn,vn),_t=yn,Et=vn)):je(32823)}function lr(pt){pt===void 0&&(pt=33984+At-1),wt!==pt&&(e.activeTexture(pt),wt=pt)}return zt[200]=0,zt[201]=1,zt[202]=768,zt[204]=770,zt[210]=776,zt[208]=774,zt[206]=772,zt[203]=769,zt[205]=771,zt[209]=775,zt[207]=773,{buffers:{color:l,depth:h,stencil:g},initAttributes:function(){for(var pt=0,yn=k.length;pt<yn;pt++)k[pt]=0},enableAttribute:function(pt){sr(pt,0)},enableAttributeAndDivisor:sr,disableUnusedAttributes:function(){for(var pt=0,yn=F.length;pt!==yn;++pt)F[pt]!==k[pt]&&(e.disableVertexAttribArray(pt),F[pt]=0)},enable:Tn,disable:je,useProgram:function(pt){return ne!==pt&&(e.useProgram(pt),ne=pt,!0)},setBlending:Qn,setMaterial:function(pt,yn){(pt.side===2?je:Tn)(2884);var vn=pt.side===1;yn&&(vn=!vn),Sn(vn),pt.blending===1&&pt.transparent===!1?Qn(0):Qn(pt.blending,pt.blendEquation,pt.blendSrc,pt.blendDst,pt.blendEquationAlpha,pt.blendSrcAlpha,pt.blendDstAlpha,pt.premultipliedAlpha),h.setFunc(pt.depthFunc),h.setTest(pt.depthTest),h.setMask(pt.depthWrite),l.setMask(pt.colorWrite);var tr=pt.stencilWrite;g.setTest(tr),tr&&(g.setMask(pt.stencilWriteMask),g.setFunc(pt.stencilFunc,pt.stencilRef,pt.stencilFuncMask),g.setOp(pt.stencilFail,pt.stencilZFail,pt.stencilZPass)),An(pt.polygonOffset,pt.polygonOffsetFactor,pt.polygonOffsetUnits)},setFlipSided:Sn,setCullFace:Ct,setLineWidth:function(pt){pt!==ft&&(Nt&&e.lineWidth(pt),ft=pt)},setPolygonOffset:An,setScissorTest:function(pt){(pt?Tn:je)(3089)},activeTexture:lr,bindTexture:function(pt,yn){wt===null&&lr();var vn=sn[wt];vn===void 0&&(vn={type:void 0,texture:void 0},sn[wt]=vn),vn.type===pt&&vn.texture===yn||(e.bindTexture(pt,yn||Nn[pt]),vn.type=pt,vn.texture=yn)},unbindTexture:function(){var pt=sn[wt];pt!==void 0&&pt.type!==void 0&&(e.bindTexture(pt.type,null),pt.type=void 0,pt.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},scissor:function(pt){gn.equals(pt)===!1&&(e.scissor(pt.x,pt.y,pt.z,pt.w),gn.copy(pt))},viewport:function(pt){Jn.equals(pt)===!1&&(e.viewport(pt.x,pt.y,pt.z,pt.w),Jn.copy(pt))},reset:function(){for(var pt=0;pt<F.length;pt++)F[pt]===1&&(e.disableVertexAttribArray(pt),F[pt]=0);Q={},sn={},We=et=oe=ne=wt=null,l.reset(),h.reset(),g.reset()}}}function Uh(e,t,n,i,l,h,g){var b,k=l.isWebGL2,F=l.maxTextures,K=l.maxCubemapSize,Q=l.maxTextureSize,ne=l.maxSamples,U=new WeakMap,oe=!1;try{oe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function ue(je,nt){return oe?new OffscreenCanvas(je,nt):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function pe(je,nt,Jt,zt){var Qn=1;if((je.width>zt||je.height>zt)&&(Qn=zt/Math.max(je.width,je.height)),Qn<1||nt===!0){if(typeof HTMLImageElement<"u"&&je instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&je instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&je instanceof ImageBitmap){var Sn=nt?Qt.floorPowerOfTwo:Math.floor,Ct=Sn(Qn*je.width),An=Sn(Qn*je.height);b===void 0&&(b=ue(Ct,An));var lr=Jt?ue(Ct,An):b;return lr.width=Ct,lr.height=An,lr.getContext("2d").drawImage(je,0,0,Ct,An),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+je.width+"x"+je.height+") to ("+Ct+"x"+An+")."),lr}return"data"in je&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+je.width+"x"+je.height+")."),je}return je}function Te(je){return Qt.isPowerOfTwo(je.width)&&Qt.isPowerOfTwo(je.height)}function Oe(je,nt){return je.generateMipmaps&&nt&&je.minFilter!==z&&je.minFilter!==q}function Fe(je,nt,Jt,zt){e.generateMipmap(je),i.get(nt).__maxMipLevel=Math.log(Math.max(Jt,zt))*Math.LOG2E}function Ze(je,nt,Jt){if(k===!1)return nt;if(je!==null){if(e[je]!==void 0)return e[je];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+je+"'")}var zt=nt;return nt===6403&&(Jt===5126&&(zt=33326),Jt===5131&&(zt=33325),Jt===5121&&(zt=33321)),nt===6407&&(Jt===5126&&(zt=34837),Jt===5131&&(zt=34843),Jt===5121&&(zt=32849)),nt===6408&&(Jt===5126&&(zt=34836),Jt===5131&&(zt=34842),Jt===5121&&(zt=32856)),zt===33325||zt===33326||zt===34842||zt===34836?t.get("EXT_color_buffer_float"):zt!==34843&&zt!==34837||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),zt}function Ge(je){return je===z||je===A||je===S?9728:9729}function et(je){var nt=je.target;nt.removeEventListener("dispose",et),function(Jt){var zt=i.get(Jt);zt.__webglInit!==void 0&&(e.deleteTexture(zt.__webglTexture),i.remove(Jt))}(nt),nt.isVideoTexture&&U.delete(nt),g.memory.textures--}function We(je){var nt=je.target;nt.removeEventListener("dispose",We),function(Jt){var zt=i.get(Jt),Qn=i.get(Jt.texture);if(Jt){if(Qn.__webglTexture!==void 0&&e.deleteTexture(Qn.__webglTexture),Jt.depthTexture&&Jt.depthTexture.dispose(),Jt.isWebGLCubeRenderTarget)for(var Sn=0;Sn<6;Sn++)e.deleteFramebuffer(zt.__webglFramebuffer[Sn]),zt.__webglDepthbuffer&&e.deleteRenderbuffer(zt.__webglDepthbuffer[Sn]);else e.deleteFramebuffer(zt.__webglFramebuffer),zt.__webglDepthbuffer&&e.deleteRenderbuffer(zt.__webglDepthbuffer);if(Jt.isWebGLMultiviewRenderTarget){e.deleteTexture(zt.__webglColorTexture),e.deleteTexture(zt.__webglDepthStencilTexture),g.memory.textures-=2,Sn=0;for(var Ct=zt.__webglViewFramebuffers.length;Sn<Ct;Sn++)e.deleteFramebuffer(zt.__webglViewFramebuffers[Sn])}i.remove(Jt.texture),i.remove(Jt)}}(nt),g.memory.textures--}var ft=0;function _t(je,nt){var Jt,zt,Qn=i.get(je);if(je.isVideoTexture&&(Jt=je,zt=g.render.frame,U.get(Jt)!==zt&&(U.set(Jt,zt),Jt.update())),0<je.version&&Qn.__version!==je.version){var Sn=je.image;if(Sn===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(Sn.complete!==!1)return void sn(Qn,je,nt);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+nt),n.bindTexture(3553,Qn.__webglTexture)}function Et(je,nt){if(je.image.length===6){var Jt=i.get(je);if(0<je.version&&Jt.__version!==je.version){wt(Jt,je),n.activeTexture(33984+nt),n.bindTexture(34067,Jt.__webglTexture),e.pixelStorei(37440,je.flipY);for(var zt=je&&(je.isCompressedTexture||je.image[0].isCompressedTexture),Qn=je.image[0]&&je.image[0].isDataTexture,Sn=[],Ct=0;Ct<6;Ct++)Sn[Ct]=zt||Qn?Qn?je.image[Ct].image:je.image[Ct]:pe(je.image[Ct],!1,!0,K);var An,lr=Sn[0],pt=Te(lr)||k,yn=h.convert(je.format),vn=h.convert(je.type),tr=Ze(je.internalFormat,yn,vn);if(Tt(34067,je,pt),zt){for(Ct=0;Ct<6;Ct++){An=Sn[Ct].mipmaps;for(var an=0;an<An.length;an++){var gr=An[an];je.format!==f&&je.format!==m?yn!==null?n.compressedTexImage2D(34069+Ct,an,tr,gr.width,gr.height,0,gr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+Ct,an,tr,gr.width,gr.height,0,yn,vn,gr.data)}}Jt.__maxMipLevel=An.length-1}else{for(An=je.mipmaps,Ct=0;Ct<6;Ct++)if(Qn)for(n.texImage2D(34069+Ct,0,tr,Sn[Ct].width,Sn[Ct].height,0,yn,vn,Sn[Ct].data),an=0;an<An.length;an++){var Tr=(gr=An[an]).image[Ct].image;n.texImage2D(34069+Ct,an+1,tr,Tr.width,Tr.height,0,yn,vn,Tr.data)}else for(n.texImage2D(34069+Ct,0,tr,yn,vn,Sn[Ct]),an=0;an<An.length;an++)gr=An[an],n.texImage2D(34069+Ct,an+1,tr,yn,vn,gr.image[Ct]);Jt.__maxMipLevel=An.length}Oe(je,pt)&&Fe(34067,je,lr.width,lr.height),Jt.__version=je.version,je.onUpdate&&je.onUpdate(je)}else n.activeTexture(33984+nt),n.bindTexture(34067,Jt.__webglTexture)}}function At(je,nt){n.activeTexture(33984+nt),n.bindTexture(34067,i.get(je).__webglTexture)}var Nt={1e3:10497,1001:33071,1002:33648},Xt={};function Tt(je,nt,Jt){Jt?(e.texParameteri(je,10242,Nt[nt.wrapS]),e.texParameteri(je,10243,Nt[nt.wrapT]),je!==32879&&je!==35866||e.texParameteri(je,32882,Nt[nt.wrapR]),e.texParameteri(je,10240,Xt[nt.magFilter]),e.texParameteri(je,10241,Xt[nt.minFilter])):(e.texParameteri(je,10242,33071),e.texParameteri(je,10243,33071),je!==32879&&je!==35866||e.texParameteri(je,32882,33071),nt.wrapS===C&&nt.wrapT===C||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(je,10240,Ge(nt.magFilter)),e.texParameteri(je,10241,Ge(nt.minFilter)),nt.minFilter!==z&&nt.minFilter!==q&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var zt=t.get("EXT_texture_filter_anisotropic");if(zt){if(nt.type===Y&&t.get("OES_texture_float_linear")===null||nt.type===c&&(k||t.get("OES_texture_half_float_linear"))===null)return;(1<nt.anisotropy||i.get(nt).__currentAnisotropy)&&(e.texParameterf(je,zt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(nt.anisotropy,l.getMaxAnisotropy())),i.get(nt).__currentAnisotropy=nt.anisotropy)}}function wt(je,nt){je.__webglInit===void 0&&(je.__webglInit=!0,nt.addEventListener("dispose",et),je.__webglTexture=e.createTexture(),g.memory.textures++)}function sn(je,nt,Jt){var zt=3553;nt.isDataTexture2DArray&&(zt=35866),nt.isDataTexture3D&&(zt=32879),wt(je,nt),n.activeTexture(33984+Jt),n.bindTexture(zt,je.__webglTexture),e.pixelStorei(37440,nt.flipY),e.pixelStorei(37441,nt.premultiplyAlpha),e.pixelStorei(3317,nt.unpackAlignment);var Qn,Sn=(Qn=nt,!k&&(Qn.wrapS!==C||Qn.wrapT!==C||Qn.minFilter!==z&&Qn.minFilter!==q)&&Te(nt.image)===!1),Ct=pe(nt.image,Sn,!1,Q),An=Te(Ct)||k,lr=h.convert(nt.format),pt=h.convert(nt.type),yn=Ze(nt.internalFormat,lr,pt);Tt(zt,nt,An);var vn,tr=nt.mipmaps;if(nt.isDepthTexture){if(yn=6402,nt.type===Y){if(k===!1)throw new Error("Float Depth Texture only supported in WebGL2.0");yn=36012}else k&&(yn=33189);nt.format===P&&yn===6402&&nt.type!==v&&nt.type!==V&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),nt.type=v,pt=h.convert(nt.type)),nt.format===O&&(yn=34041,nt.type!==p&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),nt.type=p,pt=h.convert(nt.type))),n.texImage2D(3553,0,yn,Ct.width,Ct.height,0,lr,pt,null)}else if(nt.isDataTexture)if(0<tr.length&&An){for(var an=0,gr=tr.length;an<gr;an++)vn=tr[an],n.texImage2D(3553,an,yn,vn.width,vn.height,0,lr,pt,vn.data);nt.generateMipmaps=!1,je.__maxMipLevel=tr.length-1}else n.texImage2D(3553,0,yn,Ct.width,Ct.height,0,lr,pt,Ct.data),je.__maxMipLevel=0;else if(nt.isCompressedTexture){for(an=0,gr=tr.length;an<gr;an++)vn=tr[an],nt.format!==f&&nt.format!==m?lr!==null?n.compressedTexImage2D(3553,an,yn,vn.width,vn.height,0,vn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,an,yn,vn.width,vn.height,0,lr,pt,vn.data);je.__maxMipLevel=tr.length-1}else if(nt.isDataTexture2DArray)n.texImage3D(35866,0,yn,Ct.width,Ct.height,Ct.depth,0,lr,pt,Ct.data),je.__maxMipLevel=0;else if(nt.isDataTexture3D)n.texImage3D(32879,0,yn,Ct.width,Ct.height,Ct.depth,0,lr,pt,Ct.data),je.__maxMipLevel=0;else if(0<tr.length&&An){for(an=0,gr=tr.length;an<gr;an++)vn=tr[an],n.texImage2D(3553,an,yn,lr,pt,vn);nt.generateMipmaps=!1,je.__maxMipLevel=tr.length-1}else n.texImage2D(3553,0,yn,lr,pt,Ct),je.__maxMipLevel=0;Oe(nt,An)&&Fe(zt,nt,Ct.width,Ct.height),je.__version=nt.version,nt.onUpdate&&nt.onUpdate(nt)}function gn(je,nt,Jt,zt){var Qn=h.convert(nt.texture.format),Sn=h.convert(nt.texture.type),Ct=Ze(nt.texture.internalFormat,Qn,Sn);n.texImage2D(zt,0,Ct,nt.width,nt.height,0,Qn,Sn,null),e.bindFramebuffer(36160,je),e.framebufferTexture2D(36160,Jt,zt,i.get(nt.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function Jn(je,nt,Jt){if(e.bindRenderbuffer(36161,je),nt.depthBuffer&&!nt.stencilBuffer){if(Jt){var zt=Nn(nt);e.renderbufferStorageMultisample(36161,zt,33189,nt.width,nt.height)}else e.renderbufferStorage(36161,33189,nt.width,nt.height);e.framebufferRenderbuffer(36160,36096,36161,je)}else if(nt.depthBuffer&&nt.stencilBuffer)Jt?(zt=Nn(nt),e.renderbufferStorageMultisample(36161,zt,35056,nt.width,nt.height)):e.renderbufferStorage(36161,34041,nt.width,nt.height),e.framebufferRenderbuffer(36160,33306,36161,je);else{var Qn=h.convert(nt.texture.format),Sn=h.convert(nt.texture.type),Ct=Ze(nt.texture.internalFormat,Qn,Sn);Jt?(zt=Nn(nt),e.renderbufferStorageMultisample(36161,zt,Ct,nt.width,nt.height)):e.renderbufferStorage(36161,Ct,nt.width,nt.height)}e.bindRenderbuffer(36161,null)}function Gn(je){var nt=i.get(je),Jt=je.isWebGLCubeRenderTarget===!0;if(je.depthTexture){if(Jt)throw new Error("target.depthTexture not supported in Cube render targets");(function(Qn,Sn){if(Sn&&Sn.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,Qn),!Sn.depthTexture||!Sn.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(Sn.depthTexture).__webglTexture&&Sn.depthTexture.image.width===Sn.width&&Sn.depthTexture.image.height===Sn.height||(Sn.depthTexture.image.width=Sn.width,Sn.depthTexture.image.height=Sn.height,Sn.depthTexture.needsUpdate=!0),_t(Sn.depthTexture,0);var Ct=i.get(Sn.depthTexture).__webglTexture;if(Sn.depthTexture.format===P)e.framebufferTexture2D(36160,36096,3553,Ct,0);else{if(Sn.depthTexture.format!==O)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,Ct,0)}})(nt.__webglFramebuffer,je)}else if(Jt){nt.__webglDepthbuffer=[];for(var zt=0;zt<6;zt++)e.bindFramebuffer(36160,nt.__webglFramebuffer[zt]),nt.__webglDepthbuffer[zt]=e.createRenderbuffer(),Jn(nt.__webglDepthbuffer[zt],je)}else e.bindFramebuffer(36160,nt.__webglFramebuffer),nt.__webglDepthbuffer=e.createRenderbuffer(),Jn(nt.__webglDepthbuffer,je);e.bindFramebuffer(36160,null)}function Nn(je){return k&&je.isWebGLMultisampleRenderTarget?Math.min(ne,je.samples):0}Xt[z]=9728,Xt[A]=9984,Xt[S]=9986,Xt[q]=9729,Xt[W]=9985;var sr=!(Xt[_]=9987),Tn=!1;this.allocateTextureUnit=function(){var je=ft;return F<=je&&console.warn("THREE.WebGLTextures: Trying to use "+je+" texture units while this GPU supports only "+F),ft+=1,je},this.resetTextureUnits=function(){ft=0},this.setTexture2D=_t,this.setTexture2DArray=function(je,nt){var Jt=i.get(je);0<je.version&&Jt.__version!==je.version?sn(Jt,je,nt):(n.activeTexture(33984+nt),n.bindTexture(35866,Jt.__webglTexture))},this.setTexture3D=function(je,nt){var Jt=i.get(je);0<je.version&&Jt.__version!==je.version?sn(Jt,je,nt):(n.activeTexture(33984+nt),n.bindTexture(32879,Jt.__webglTexture))},this.setTextureCube=Et,this.setTextureCubeDynamic=At,this.setupRenderTarget=function(je){var nt=i.get(je),Jt=i.get(je.texture);je.addEventListener("dispose",We),Jt.__webglTexture=e.createTexture(),g.memory.textures++;var zt=je.isWebGLCubeRenderTarget===!0,Qn=je.isWebGLMultisampleRenderTarget===!0,Sn=je.isWebGLMultiviewRenderTarget===!0,Ct=Te(je)||k;if(zt){nt.__webglFramebuffer=[];for(var An=0;An<6;An++)nt.__webglFramebuffer[An]=e.createFramebuffer()}else if(nt.__webglFramebuffer=e.createFramebuffer(),Qn)if(k){nt.__webglMultisampledFramebuffer=e.createFramebuffer(),nt.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,nt.__webglColorRenderbuffer);var lr=h.convert(je.texture.format),pt=h.convert(je.texture.type),yn=Ze(je.texture.internalFormat,lr,pt),vn=Nn(je);e.renderbufferStorageMultisample(36161,vn,yn,je.width,je.height),e.bindFramebuffer(36160,nt.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,nt.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),je.depthBuffer&&(nt.__webglDepthRenderbuffer=e.createRenderbuffer(),Jn(nt.__webglDepthRenderbuffer,je,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(Sn){var tr=je.width,an=je.height,gr=je.numViews;e.bindFramebuffer(36160,nt.__webglFramebuffer);var Tr=t.get("OVR_multiview2");g.memory.textures+=2;var fi=e.createTexture();e.bindTexture(35866,fi),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,32856,tr,an,gr,0,6408,5121,null),Tr.framebufferTextureMultiviewOVR(36160,36064,fi,0,0,gr);var to=e.createTexture();e.bindTexture(35866,to),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,35056,tr,an,gr,0,34041,34042,null),Tr.framebufferTextureMultiviewOVR(36160,33306,to,0,0,gr);var Ir=new Array(gr);for(An=0;An<gr;++An)Ir[An]=e.createFramebuffer(),e.bindFramebuffer(36160,Ir[An]),e.framebufferTextureLayer(36160,36064,fi,0,An);nt.__webglColorTexture=fi,nt.__webglDepthStencilTexture=to,nt.__webglViewFramebuffers=Ir,e.bindFramebuffer(36160,null),e.bindTexture(35866,null)}if(zt){for(n.bindTexture(34067,Jt.__webglTexture),Tt(34067,je.texture,Ct),An=0;An<6;An++)gn(nt.__webglFramebuffer[An],je,36064,34069+An);Oe(je.texture,Ct)&&Fe(34067,je.texture,je.width,je.height),n.bindTexture(34067,null)}else Sn||(n.bindTexture(3553,Jt.__webglTexture),Tt(3553,je.texture,Ct),gn(nt.__webglFramebuffer,je,36064,3553),Oe(je.texture,Ct)&&Fe(3553,je.texture,je.width,je.height),n.bindTexture(3553,null));je.depthBuffer&&Gn(je)},this.updateRenderTargetMipmap=function(je){var nt=je.texture;if(Oe(nt,Te(je)||k)){var Jt=je.isWebGLCubeRenderTarget?34067:3553,zt=i.get(nt).__webglTexture;n.bindTexture(Jt,zt),Fe(Jt,nt,je.width,je.height),n.bindTexture(Jt,null)}},this.updateMultisampleRenderTarget=function(je){if(je.isWebGLMultisampleRenderTarget)if(k){var nt=i.get(je);e.bindFramebuffer(36008,nt.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,nt.__webglFramebuffer);var Jt=je.width,zt=je.height,Qn=16384;je.depthBuffer&&(Qn|=256),je.stencilBuffer&&(Qn|=1024),e.blitFramebuffer(0,0,Jt,zt,0,0,Jt,zt,Qn,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(je,nt){je&&je.isWebGLRenderTarget&&(sr===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),sr=!0),je=je.texture),_t(je,nt)},this.safeSetTextureCube=function(je,nt){je&&je.isWebGLCubeRenderTarget&&(Tn===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Tn=!0),je=je.texture),(je&&je.isCubeTexture||Array.isArray(je.image)&&je.image.length===6?Et:At)(je,nt)}}function su(e,t,n){var i=n.isWebGL2;return{convert:function(l){var h;if(l===R)return 5121;if(l===1017)return 32819;if(l===1018)return 32820;if(l===1019)return 33635;if(l===1010)return 5120;if(l===1011)return 5122;if(l===v)return 5123;if(l===1013)return 5124;if(l===V)return 5125;if(l===Y)return 5126;if(l===c)return i?5131:(h=t.get("OES_texture_half_float"))!==null?h.HALF_FLOAT_OES:null;if(l===1021)return 6406;if(l===m)return 6407;if(l===f)return 6408;if(l===1024)return 6409;if(l===1025)return 6410;if(l===P)return 6402;if(l===O)return 34041;if(l===1028)return 6403;if(l===1029)return 36244;if(l===1030)return 33319;if(l===1031)return 33320;if(l===1032)return 36248;if(l===1033)return 36249;if(l===Z||l===te||l===de||l===me){if((h=t.get("WEBGL_compressed_texture_s3tc"))===null)return null;if(l===Z)return h.COMPRESSED_RGB_S3TC_DXT1_EXT;if(l===te)return h.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(l===de)return h.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(l===me)return h.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(l===we||l===ge||l===Le||l===Pe){if((h=t.get("WEBGL_compressed_texture_pvrtc"))===null)return null;if(l===we)return h.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(l===ge)return h.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(l===Le)return h.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(l===Pe)return h.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return l===36196?(h=t.get("WEBGL_compressed_texture_etc1"))!==null?h.COMPRESSED_RGB_ETC1_WEBGL:null:l===37808||l===37809||l===37810||l===37811||l===37812||l===37813||l===37814||l===37815||l===37816||l===37817||l===37818||l===37819||l===37820||l===37821?(h=t.get("WEBGL_compressed_texture_astc"))!==null?l:null:l===p?i?34042:(h=t.get("WEBGL_depth_texture"))!==null?h.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function lu(e,t,n,i){rt.call(this,e,t,i),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=n}function ih(e,t){var n,i,l,h,g,b,k,F=e.extensions,K=e.properties,Q=0;function ne(U){return U.isArrayCamera?U.cameras:(g[0]=U,g)}this.isAvailable=function(){if(k===void 0){var U=F.get("OVR_multiview2");if(k=U!==null&&t.getContextAttributes().antialias===!1){Q=t.getParameter(U.MAX_VIEWS_OVR),n=new lu(0,0,2),b=new Ve,h=[],l=[],g=[];for(var oe=0;oe<Q;oe++)h[oe]=new Lt,l[oe]=new Be}}return k},this.attachCamera=function(U){(function(oe){if(oe.isArrayCamera===void 0)return!0;var ue=oe.cameras;if(ue.length>Q)return!1;for(var pe=1,Te=ue.length;pe<Te;pe++)if(ue[0].viewport.z!==ue[pe].viewport.z||ue[0].viewport.w!==ue[pe].viewport.w)return!1;return!0})(U)!==!1&&(i=e.getRenderTarget(),function(oe){if(i?b.set(i.width,i.height):e.getDrawingBufferSize(b),oe.isArrayCamera){var ue=oe.cameras[0].viewport;n.setSize(ue.z,ue.w),n.setNumViews(oe.cameras.length)}else n.setSize(b.x,b.y),n.setNumViews(2)}(U),e.setRenderTarget(n))},this.detachCamera=function(U){n===e.getRenderTarget()&&(e.setRenderTarget(i),function(oe){var ue=n,pe=ue.numViews,Te=K.get(ue).__webglViewFramebuffers,Oe=ue.width,Fe=ue.height;if(oe.isArrayCamera)for(var Ze=0;Ze<pe;Ze++){var Ge=oe.cameras[Ze].viewport,et=Ge.x,We=Ge.y,ft=et+Ge.z,_t=We+Ge.w;t.bindFramebuffer(36008,Te[Ze]),t.blitFramebuffer(0,0,Oe,Fe,et,We,ft,_t,16384,9728)}else t.bindFramebuffer(36008,Te[0]),t.blitFramebuffer(0,0,Oe,Fe,0,0,b.x,b.y,16384,9728)}(U))},this.updateCameraProjectionMatricesUniform=function(U,oe){for(var ue=ne(U),pe=0;pe<ue.length;pe++)h[pe].copy(ue[pe].projectionMatrix);oe.setValue(t,"projectionMatrices",h)},this.updateCameraViewMatricesUniform=function(U,oe){for(var ue=ne(U),pe=0;pe<ue.length;pe++)h[pe].copy(ue[pe].matrixWorldInverse);oe.setValue(t,"viewMatrices",h)},this.updateObjectMatricesUniforms=function(U,oe,ue){for(var pe=ne(oe),Te=0;Te<pe.length;Te++)h[Te].multiplyMatrices(pe[Te].matrixWorldInverse,U.matrixWorld),l[Te].getNormalMatrix(h[Te]);ue.setValue(t,"modelViewMatrices",h),ue.setValue(t,"normalMatrices",l)}}function vl(e){Dr.call(this),this.cameras=e||[]}function wr(){mn.call(this),this.type="Group"}function xl(e,t){var n=this,i=null,l=null,h="local-floor",g=null,b=[],k=new Map,F=new Dr;F.layers.enable(1),F.viewport=new ct;var K=new Dr;K.layers.enable(2),K.viewport=new ct;var Q=new vl([F,K]);Q.layers.enable(1),Q.layers.enable(2);var ne=null,U=null;function oe(We){var ft=k.get(We.inputSource);ft&&(ft.targetRay&&ft.targetRay.dispatchEvent({type:We.type}),ft.grip&&ft.grip.dispatchEvent({type:We.type}))}function ue(){k.forEach(function(We,ft){We.targetRay&&(We.targetRay.dispatchEvent({type:"disconnected",data:ft}),We.targetRay.visible=!1),We.grip&&(We.grip.dispatchEvent({type:"disconnected",data:ft}),We.grip.visible=!1)}),k.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),et.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function pe(We){l=We,et.setContext(i),et.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function Te(We){for(var ft=i.inputSources,_t=0;_t<b.length;_t++)k.set(ft[_t],b[_t]);for(_t=0;_t<We.removed.length;_t++){var Et=We.removed[_t];(At=k.get(Et))&&(At.targetRay&&At.targetRay.dispatchEvent({type:"disconnected",data:Et}),At.grip&&At.grip.dispatchEvent({type:"disconnected",data:Et}),k.delete(Et))}for(_t=0;_t<We.added.length;_t++){var At;Et=We.added[_t],(At=k.get(Et))&&(At.targetRay&&At.targetRay.dispatchEvent({type:"connected",data:Et}),At.grip&&At.grip.dispatchEvent({type:"connected",data:Et}))}}this.enabled=!1,this.isPresenting=!1,this.getController=function(We){var ft=b[We];return ft===void 0&&(ft={},b[We]=ft),ft.targetRay===void 0&&(ft.targetRay=new wr,ft.targetRay.matrixAutoUpdate=!1,ft.targetRay.visible=!1),ft.targetRay},this.getControllerGrip=function(We){var ft=b[We];return ft===void 0&&(ft={},b[We]=ft),ft.grip===void 0&&(ft.grip=new wr,ft.grip.matrixAutoUpdate=!1,ft.grip.visible=!1),ft.grip},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(We){h=We},this.getReferenceSpace=function(){return l},this.getSession=function(){return i},this.setSession=function(We){if((i=We)!==null){i.addEventListener("select",oe),i.addEventListener("selectstart",oe),i.addEventListener("selectend",oe),i.addEventListener("squeeze",oe),i.addEventListener("squeezestart",oe),i.addEventListener("squeezeend",oe),i.addEventListener("end",ue);var ft=t.getContextAttributes(),_t={antialias:ft.antialias,alpha:ft.alpha,depth:ft.depth,stencil:ft.stencil},Et=new XRWebGLLayer(i,t,_t);i.updateRenderState({baseLayer:Et}),i.requestReferenceSpace(h).then(pe),i.addEventListener("inputsourceschange",Te)}};var Oe=new Se,Fe=new Se;function Ze(We,ft){ft===null?We.matrixWorld.copy(We.matrix):We.matrixWorld.multiplyMatrices(ft.matrixWorld,We.matrix),We.matrixWorldInverse.getInverse(We.matrixWorld)}this.getCamera=function(We){Q.near=K.near=F.near=We.near,Q.far=K.far=F.far=We.far,ne===Q.near&&U===Q.far||(i.updateRenderState({depthNear:Q.near,depthFar:Q.far}),ne=Q.near,U=Q.far);var ft=We.parent,_t=Q.cameras;Ze(Q,ft);for(var Et=0;Et<_t.length;Et++)Ze(_t[Et],ft);We.matrixWorld.copy(Q.matrixWorld);for(var At=We.children,Nt=(Et=0,At.length);Et<Nt;Et++)At[Et].updateMatrixWorld(!0);return function(Xt,Tt,wt){Oe.setFromMatrixPosition(Tt.matrixWorld),Fe.setFromMatrixPosition(wt.matrixWorld);var sn=Oe.distanceTo(Fe),gn=Tt.projectionMatrix.elements,Jn=wt.projectionMatrix.elements,Gn=gn[14]/(gn[10]-1),Nn=gn[14]/(gn[10]+1),sr=(gn[9]+1)/gn[5],Tn=(gn[9]-1)/gn[5],je=(gn[8]-1)/gn[0],nt=(Jn[8]+1)/Jn[0],Jt=Gn*je,zt=Gn*nt,Qn=sn/(nt-je),Sn=Qn*-je;Tt.matrixWorld.decompose(Xt.position,Xt.quaternion,Xt.scale),Xt.translateX(Sn),Xt.translateZ(Qn),Xt.matrixWorld.compose(Xt.position,Xt.quaternion,Xt.scale),Xt.matrixWorldInverse.getInverse(Xt.matrixWorld);var Ct=Gn+Qn,An=Nn+Qn,lr=Jt-Sn,pt=sn-Sn+zt,yn=sr*Nn/An*Ct,vn=Tn*Nn/An*Ct;Xt.projectionMatrix.makePerspective(lr,pt,yn,vn,Ct,An)}(Q,F,K),Q};var Ge=null,et=new Yo;et.setAnimationLoop(function(We,ft){if((g=ft.getViewerPose(l))!==null){var _t=g.views,Et=i.renderState.baseLayer;e.setFramebuffer(Et.framebuffer);for(var At=0;At<_t.length;At++){var Nt=_t[At],Xt=Et.getViewport(Nt),Tt=Q.cameras[At];Tt.matrix.fromArray(Nt.transform.matrix),Tt.projectionMatrix.fromArray(Nt.projectionMatrix),Tt.viewport.set(Xt.x,Xt.y,Xt.width,Xt.height),At===0&&Q.matrix.copy(Tt.matrix)}}var wt=i.inputSources;for(At=0;At<b.length;At++){var sn=b[At],gn=wt[At],Jn=null,Gn=null;gn&&(sn.targetRay&&(Jn=ft.getPose(gn.targetRaySpace,l))!==null&&(sn.targetRay.matrix.fromArray(Jn.transform.matrix),sn.targetRay.matrix.decompose(sn.targetRay.position,sn.targetRay.rotation,sn.targetRay.scale)),sn.grip&&gn.gripSpace&&(Gn=ft.getPose(gn.gripSpace,l))!==null&&(sn.grip.matrix.fromArray(Gn.transform.matrix),sn.grip.matrix.decompose(sn.grip.position,sn.grip.rotation,sn.grip.scale))),sn.targetRay&&(sn.targetRay.visible=Jn!==null),sn.grip&&(sn.grip.visible=Gn!==null)}Ge&&Ge(We,ft)}),this.setAnimationLoop=function(We){Ge=We},this.dispose=function(){}}function cu(e){var t=(e=e||{}).canvas!==void 0?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=e.context!==void 0?e.context:null,i=e.alpha!==void 0&&e.alpha,l=e.depth===void 0||e.depth,h=e.stencil===void 0||e.stencil,g=e.antialias!==void 0&&e.antialias,b=e.premultipliedAlpha===void 0||e.premultipliedAlpha,k=e.preserveDrawingBuffer!==void 0&&e.preserveDrawingBuffer,F=e.powerPreference!==void 0?e.powerPreference:"default",K=e.failIfMajorPerformanceCaveat!==void 0&&e.failIfMajorPerformanceCaveat,Q=null,ne=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=at,this.physicallyCorrectLights=!1,this.toneMapping=1,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var U,oe,ue,pe,Te,Oe,Fe,Ze,Ge,et,We,ft,_t,Et,At,Nt,Xt,Tt,wt=this,sn=!1,gn=null,Jn=0,Gn=0,Nn=null,sr=null,Tn=-1,je={geometry:null,program:null,wireframe:!1},nt=null,Jt=null,zt=new ct,Qn=new ct,Sn=null,Ct=t.width,An=t.height,lr=1,pt=null,yn=null,vn=new ct(0,0,Ct,An),tr=new ct(0,0,Ct,An),an=!1,gr=new Pr,Tr=new js,fi=!1,to=!1,Ir=new Lt,Ti=new Se;function Er(){return Nn===null?lr:1}try{var ii={alpha:i,depth:l,stencil:h,antialias:g,premultipliedAlpha:b,preserveDrawingBuffer:k,powerPreference:F,failIfMajorPerformanceCaveat:K,xrCompatible:!0};t.addEventListener("webglcontextlost",no,!1),t.addEventListener("webglcontextrestored",us,!1);var mi="webgl";if(e.webgl2===!0&&(mi="webgl2"),(U=n||t.getContext(mi,ii)||t.getContext("experimental-webgl",ii))===null)throw t.getContext("webgl")!==null?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");e.retver=mi,U.getShaderPrecisionFormat===void 0&&(U.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ae){throw console.error("THREE.WebGLRenderer: "+Ae.message),Ae}function na(){oe=new function(Ae){var $e={};return{get:function(Ye){if($e[Ye]!==void 0)return $e[Ye];var dt;switch(Ye){case"WEBGL_depth_texture":dt=Ae.getExtension("WEBGL_depth_texture")||Ae.getExtension("MOZ_WEBGL_depth_texture")||Ae.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":dt=Ae.getExtension("EXT_texture_filter_anisotropic")||Ae.getExtension("MOZ_EXT_texture_filter_anisotropic")||Ae.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":dt=Ae.getExtension("WEBGL_compressed_texture_s3tc")||Ae.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Ae.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":dt=Ae.getExtension("WEBGL_compressed_texture_pvrtc")||Ae.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:dt=Ae.getExtension(Ye)}return dt===null&&console.warn("THREE.WebGLRenderer: "+Ye+" extension not supported."),$e[Ye]=dt}}}(U),(ue=new function(Ae,$e,Ye){var dt;function Mt(Ci){if(Ci==="highp"){if(0<Ae.getShaderPrecisionFormat(35633,36338).precision&&0<Ae.getShaderPrecisionFormat(35632,36338).precision)return"highp";Ci="mediump"}return Ci==="mediump"&&0<Ae.getShaderPrecisionFormat(35633,36337).precision&&0<Ae.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var Rn=typeof WebGL2RenderingContext<"u"&&Ae instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&Ae instanceof WebGL2ComputeRenderingContext,xn=Ye.precision!==void 0?Ye.precision:"highp",Dn=Mt(xn);Dn!==xn&&(console.warn("THREE.WebGLRenderer:",xn,"not supported, using",Dn,"instead."),xn=Dn);var wn=Ye.logarithmicDepthBuffer===!0,Bt=Ae.getParameter(34930),hn=Ae.getParameter(35660),nr=Ae.getParameter(3379),ur=Ae.getParameter(34076),Hn=Ae.getParameter(34921),Wn=Ae.getParameter(36347),Ui=Ae.getParameter(36348),gi=Ae.getParameter(36349),ti=0<hn,va=Rn||!!$e.get("OES_texture_float");return{isWebGL2:Rn,getMaxAnisotropy:function(){if(dt!==void 0)return dt;var Ci=$e.get("EXT_texture_filter_anisotropic");return dt=Ci!==null?Ae.getParameter(Ci.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:Mt,precision:xn,logarithmicDepthBuffer:wn,maxTextures:Bt,maxVertexTextures:hn,maxTextureSize:nr,maxCubemapSize:ur,maxAttributes:Hn,maxVertexUniforms:Wn,maxVaryings:Ui,maxFragmentUniforms:gi,vertexTextures:ti,floatFragmentTextures:va,floatVertexTextures:ti&&va,maxSamples:Rn?Ae.getParameter(36183):0}}(U,oe,e)).isWebGL2===!1&&(oe.get("WEBGL_depth_texture"),oe.get("OES_texture_float"),oe.get("OES_texture_half_float"),oe.get("OES_texture_half_float_linear"),oe.get("OES_standard_derivatives"),oe.get("OES_element_index_uint"),oe.get("ANGLE_instanced_arrays")),oe.get("OES_texture_float_linear"),Tt=new su(0,oe,ue),(pe=new zh(U,oe,ue)).scissor(Qn.copy(tr).multiplyScalar(lr).floor()),pe.viewport(zt.copy(vn).multiplyScalar(lr).floor()),Te=new function(Ae){var $e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:$e,programs:null,autoReset:!0,reset:function(){$e.frame++,$e.calls=0,$e.triangles=0,$e.points=0,$e.lines=0},update:function(Ye,dt,Mt){switch(Mt=Mt||1,$e.calls++,dt){case 4:$e.triangles+=Mt*(Ye/3);break;case 1:$e.lines+=Mt*(Ye/2);break;case 3:$e.lines+=Mt*(Ye-1);break;case 2:$e.lines+=Mt*Ye;break;case 0:$e.points+=Mt*Ye;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",dt)}}}},Oe=new function(){var Ae=new WeakMap;return{get:function($e){var Ye=Ae.get($e);return Ye===void 0&&(Ye={},Ae.set($e,Ye)),Ye},remove:function($e){Ae.delete($e)},update:function($e,Ye,dt){Ae.get($e)[Ye]=dt},dispose:function(){Ae=new WeakMap}}},Fe=new Uh(U,oe,pe,Oe,ue,Tt,Te),Ze=new function(Ae,$e){var Ye=$e.isWebGL2,dt=new WeakMap;return{get:function(Mt){return Mt.isInterleavedBufferAttribute&&(Mt=Mt.data),dt.get(Mt)},remove:function(Mt){Mt.isInterleavedBufferAttribute&&(Mt=Mt.data);var Rn=dt.get(Mt);Rn&&(Ae.deleteBuffer(Rn.buffer),dt.delete(Mt))},update:function(Mt,Rn){Mt.isInterleavedBufferAttribute&&(Mt=Mt.data);var xn,Dn,wn,Bt,hn,nr=dt.get(Mt);nr===void 0?dt.set(Mt,function(ur,Hn){var Wn=ur.array,Ui=ur.usage,gi=Ae.createBuffer();Ae.bindBuffer(Hn,gi),Ae.bufferData(Hn,Wn,Ui),ur.onUploadCallback();var ti=5126;return Wn instanceof Float32Array?ti=5126:Wn instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):Wn instanceof Uint16Array?ti=5123:Wn instanceof Int16Array?ti=5122:Wn instanceof Uint32Array?ti=5125:Wn instanceof Int32Array?ti=5124:Wn instanceof Int8Array?ti=5120:Wn instanceof Uint8Array&&(ti=5121),{buffer:gi,type:ti,bytesPerElement:Wn.BYTES_PER_ELEMENT,version:ur.version}}(Mt,Rn)):nr.version<Mt.version&&(xn=nr.buffer,wn=Rn,Bt=(Dn=Mt).array,hn=Dn.updateRange,Ae.bindBuffer(wn,xn),hn.count===-1?Ae.bufferSubData(wn,0,Bt):(Ye?Ae.bufferSubData(wn,hn.offset*Bt.BYTES_PER_ELEMENT,Bt,hn.offset,hn.count):Ae.bufferSubData(wn,hn.offset*Bt.BYTES_PER_ELEMENT,Bt.subarray(hn.offset,hn.offset+hn.count)),hn.count=-1),nr.version=Mt.version)}}}(U,ue),Ge=new function(Ae,$e,Ye){var dt=new WeakMap,Mt=new WeakMap;function Rn(Dn){var wn=Dn.target,Bt=dt.get(wn);for(var hn in Bt.index!==null&&$e.remove(Bt.index),Bt.attributes)$e.remove(Bt.attributes[hn]);wn.removeEventListener("dispose",Rn),dt.delete(wn);var nr=Mt.get(Bt);nr&&($e.remove(nr),Mt.delete(Bt)),Ye.memory.geometries--}function xn(Dn){var wn=[],Bt=Dn.index,hn=Dn.attributes.position,nr=0;if(Bt!==null){var ur=Bt.array;nr=Bt.version;for(var Hn=0,Wn=ur.length;Hn<Wn;Hn+=3){var Ui=ur[Hn+0],gi=ur[Hn+1],ti=ur[Hn+2];wn.push(Ui,gi,gi,ti,ti,Ui)}}else for(ur=hn.array,nr=hn.version,Hn=0,Wn=ur.length/3-1;Hn<Wn;Hn+=3)Ui=Hn+0,gi=Hn+1,ti=Hn+2,wn.push(Ui,gi,gi,ti,ti,Ui);var va=new(65535<Kl(wn)?vo:yo)(wn,1);va.version=nr,$e.update(va,34963);var Ci=Mt.get(Dn);Ci&&$e.remove(Ci),Mt.set(Dn,va)}return{get:function(Dn,wn){var Bt=dt.get(wn);return Bt||(wn.addEventListener("dispose",Rn),wn.isBufferGeometry?Bt=wn:wn.isGeometry&&(wn._bufferGeometry===void 0&&(wn._bufferGeometry=new X().setFromObject(Dn)),Bt=wn._bufferGeometry),dt.set(wn,Bt),Ye.memory.geometries++,Bt)},update:function(Dn){var wn=Dn.index,Bt=Dn.attributes;for(var hn in wn!==null&&$e.update(wn,34963),Bt)$e.update(Bt[hn],34962);var nr=Dn.morphAttributes;for(var hn in nr)for(var ur=nr[hn],Hn=0,Wn=ur.length;Hn<Wn;Hn++)$e.update(ur[Hn],34962)},getWireframeAttribute:function(Dn){var wn=Mt.get(Dn);if(wn){var Bt=Dn.index;Bt!==null&&wn.version<Bt.version&&xn(Dn)}else xn(Dn);return Mt.get(Dn)}}}(0,Ze,Te),et=new function(Ae,$e,Ye,dt){var Mt={};return{update:function(Rn){var xn=dt.render.frame,Dn=Rn.geometry,wn=$e.get(Rn,Dn);return Mt[wn.id]!==xn&&(Dn.isGeometry&&wn.updateFromObject(Rn),$e.update(wn),Mt[wn.id]=xn),Rn.isInstancedMesh&&Ye.update(Rn.instanceMatrix,34962),wn},dispose:function(){Mt={}}}}(0,Ge,Ze,Te),At=new function(Ae){var $e={},Ye=new Float32Array(8);return{update:function(dt,Mt,Rn,xn){var Dn=dt.morphTargetInfluences,wn=Dn===void 0?0:Dn.length,Bt=$e[Mt.id];if(Bt===void 0){Bt=[];for(var hn=0;hn<wn;hn++)Bt[hn]=[hn,0];$e[Mt.id]=Bt}var nr=Rn.morphTargets&&Mt.morphAttributes.position,ur=Rn.morphNormals&&Mt.morphAttributes.normal;for(hn=0;hn<wn;hn++)(Wn=Bt[hn])[1]!==0&&(nr&&Mt.deleteAttribute("morphTarget"+hn),ur&&Mt.deleteAttribute("morphNormal"+hn));for(hn=0;hn<wn;hn++)(Wn=Bt[hn])[0]=hn,Wn[1]=Dn[hn];Bt.sort(Ns);var Hn=0;for(hn=0;hn<8;hn++){var Wn;if(Wn=Bt[hn]){var Ui=Wn[0],gi=Wn[1];if(gi){nr&&Mt.setAttribute("morphTarget"+hn,nr[Ui]),ur&&Mt.setAttribute("morphNormal"+hn,ur[Ui]),Hn+=Ye[hn]=gi;continue}}Ye[hn]=0}var ti=Mt.morphTargetsRelative?1:1-Hn;xn.getUniforms().setValue(Ae,"morphTargetBaseInfluence",ti),xn.getUniforms().setValue(Ae,"morphTargetInfluences",Ye)}}}(U),We=new nc(wt,oe,ue),ft=new function(){var Ae=new WeakMap;function $e(Ye){var dt=Ye.target;dt.removeEventListener("dispose",$e),Ae.delete(dt)}return{get:function(Ye,dt){var Mt,Rn=Ae.get(Ye);return Rn===void 0?(Mt=new Qu,Ae.set(Ye,new WeakMap),Ae.get(Ye).set(dt,Mt),Ye.addEventListener("dispose",$e)):(Mt=Rn.get(dt))===void 0&&(Mt=new Qu,Rn.set(dt,Mt)),Mt},dispose:function(){Ae=new WeakMap}}},_t=new function(){var Ae=new WeakMap;function $e(Ye){var dt=Ye.target;dt.removeEventListener("dispose",$e),Ae.delete(dt)}return{get:function(Ye,dt){var Mt;return Ae.has(Ye)===!1?(Mt=new nh,Ae.set(Ye,new WeakMap),Ae.get(Ye).set(dt,Mt),Ye.addEventListener("dispose",$e)):Ae.get(Ye).has(dt)===!1?(Mt=new nh,Ae.get(Ye).set(dt,Mt)):Mt=Ae.get(Ye).get(dt),Mt},dispose:function(){Ae=new WeakMap}}},Et=new fl(wt,pe,et,b),Nt=new function(Ae,$e,Ye,dt){var Mt,Rn=dt.isWebGL2;this.setMode=function(xn){Mt=xn},this.render=function(xn,Dn){Ae.drawArrays(Mt,xn,Dn),Ye.update(Dn,Mt)},this.renderInstances=function(xn,Dn,wn,Bt){if(Bt!==0){var hn,nr;if(Rn)hn=Ae,nr="drawArraysInstanced";else if(nr="drawArraysInstancedANGLE",(hn=$e.get("ANGLE_instanced_arrays"))===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");hn[nr](Mt,Dn,wn,Bt),Ye.update(wn,Mt,Bt)}}}(U,oe,Te,ue),Xt=new function(Ae,$e,Ye,dt){var Mt,Rn,xn,Dn=dt.isWebGL2;this.setMode=function(wn){Mt=wn},this.setIndex=function(wn){Rn=wn.type,xn=wn.bytesPerElement},this.render=function(wn,Bt){Ae.drawElements(Mt,Bt,Rn,wn*xn),Ye.update(Bt,Mt)},this.renderInstances=function(wn,Bt,hn,nr){if(nr!==0){var ur,Hn;if(Dn)ur=Ae,Hn="drawElementsInstanced";else if(Hn="drawElementsInstancedANGLE",(ur=$e.get("ANGLE_instanced_arrays"))===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");ur[Hn](Mt,hn,Rn,Bt*xn,nr),Ye.update(hn,Mt,nr)}}}(U,oe,Te,ue),Te.programs=We.programs,wt.capabilities=ue,wt.extensions=oe,wt.properties=Oe,wt.renderLists=ft,wt.state=pe,wt.info=Te}na();var Xr=new xl(wt,U);this.xr=Xr;var Xi=new ih(wt,U),Ha=new rh(wt,et,ue.maxTextureSize);function no(Ae){Ae.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),sn=!0}function us(){console.log("THREE.WebGLRenderer: Context Restored."),sn=!1,na()}function Is(Ae){var $e,Ye=Ae.target;Ye.removeEventListener("dispose",Is),Fu($e=Ye),Oe.remove($e)}function Fu(Ae){var $e=Oe.get(Ae).program;(Ae.program=void 0)!==$e&&We.releaseProgram($e)}this.shadowMap=Ha,this.getContext=function(){return U},this.getContextAttributes=function(){return U.getContextAttributes()},this.forceContextLoss=function(){var Ae=oe.get("WEBGL_lose_context");Ae&&Ae.loseContext()},this.forceContextRestore=function(){var Ae=oe.get("WEBGL_lose_context");Ae&&Ae.restoreContext()},this.getPixelRatio=function(){return lr},this.setPixelRatio=function(Ae){Ae!==void 0&&(lr=Ae,this.setSize(Ct,An,!1))},this.getSize=function(Ae){return Ae===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),Ae=new Ve),Ae.set(Ct,An)},this.setSize=function(Ae,$e,Ye){Xr.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Ct=Ae,An=$e,t.width=Math.floor(Ae*lr),t.height=Math.floor($e*lr),Ye!==!1&&(t.style.width=Ae+"px",t.style.height=$e+"px"),this.setViewport(0,0,Ae,$e))},this.getDrawingBufferSize=function(Ae){return Ae===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),Ae=new Ve),Ae.set(Ct*lr,An*lr).floor()},this.setDrawingBufferSize=function(Ae,$e,Ye){Ct=Ae,An=$e,lr=Ye,t.width=Math.floor(Ae*Ye),t.height=Math.floor($e*Ye),this.setViewport(0,0,Ae,$e)},this.getCurrentViewport=function(Ae){return Ae===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),Ae=new ct),Ae.copy(zt)},this.getViewport=function(Ae){return Ae.copy(vn)},this.setViewport=function(Ae,$e,Ye,dt){Ae.isVector4?vn.set(Ae.x,Ae.y,Ae.z,Ae.w):vn.set(Ae,$e,Ye,dt),pe.viewport(zt.copy(vn).multiplyScalar(lr).floor())},this.getScissor=function(Ae){return Ae.copy(tr)},this.setScissor=function(Ae,$e,Ye,dt){Ae.isVector4?tr.set(Ae.x,Ae.y,Ae.z,Ae.w):tr.set(Ae,$e,Ye,dt),pe.scissor(Qn.copy(tr).multiplyScalar(lr).floor())},this.getScissorTest=function(){return an},this.setScissorTest=function(Ae){pe.setScissorTest(an=Ae)},this.setOpaqueSort=function(Ae){pt=Ae},this.setTransparentSort=function(Ae){yn=Ae},this.getClearColor=function(){return Et.getClearColor()},this.setClearColor=function(){Et.setClearColor.apply(Et,arguments)},this.getClearAlpha=function(){return Et.getClearAlpha()},this.setClearAlpha=function(){Et.setClearAlpha.apply(Et,arguments)},this.clear=function(Ae,$e,Ye){var dt=0;Ae!==void 0&&!Ae||(dt|=16384),$e!==void 0&&!$e||(dt|=256),Ye!==void 0&&!Ye||(dt|=1024),U.clear(dt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",no,!1),t.removeEventListener("webglcontextrestored",us,!1),ft.dispose(),_t.dispose(),Oe.dispose(),et.dispose(),Xr.dispose(),Kc.stop()},this.renderBufferImmediate=function(Ae,$e){pe.initAttributes();var Ye=Oe.get(Ae);Ae.hasPositions&&!Ye.position&&(Ye.position=U.createBuffer()),Ae.hasNormals&&!Ye.normal&&(Ye.normal=U.createBuffer()),Ae.hasUvs&&!Ye.uv&&(Ye.uv=U.createBuffer()),Ae.hasColors&&!Ye.color&&(Ye.color=U.createBuffer());var dt=$e.getAttributes();Ae.hasPositions&&(U.bindBuffer(34962,Ye.position),U.bufferData(34962,Ae.positionArray,35048),pe.enableAttribute(dt.position),U.vertexAttribPointer(dt.position,3,5126,!1,0,0)),Ae.hasNormals&&(U.bindBuffer(34962,Ye.normal),U.bufferData(34962,Ae.normalArray,35048),pe.enableAttribute(dt.normal),U.vertexAttribPointer(dt.normal,3,5126,!1,0,0)),Ae.hasUvs&&(U.bindBuffer(34962,Ye.uv),U.bufferData(34962,Ae.uvArray,35048),pe.enableAttribute(dt.uv),U.vertexAttribPointer(dt.uv,2,5126,!1,0,0)),Ae.hasColors&&(U.bindBuffer(34962,Ye.color),U.bufferData(34962,Ae.colorArray,35048),pe.enableAttribute(dt.color),U.vertexAttribPointer(dt.color,3,5126,!1,0,0)),pe.disableUnusedAttributes(),U.drawArrays(4,0,Ae.count),Ae.count=0};var Lp=new Ca;this.renderBufferDirect=function(Ae,$e,Ye,dt,Mt,Rn){$e===null&&($e=Lp);var xn=Mt.isMesh&&Mt.matrixWorld.determinant()<0,Dn=Rh(Ae,$e,dt,Mt);pe.setMaterial(dt,xn);var wn=!1;je.geometry===Ye.id&&je.program===Dn.id&&je.wireframe===(dt.wireframe===!0)||(je.geometry=Ye.id,je.program=Dn.id,je.wireframe=dt.wireframe===!0,wn=!0),(dt.morphTargets||dt.morphNormals)&&(At.update(Mt,Ye,dt,Dn),wn=!0);var Bt=Ye.index,hn=Ye.attributes.position;if(Bt===null){if(hn===void 0||hn.count===0)return}else if(Bt.count===0)return;var nr,ur=1;dt.wireframe===!0&&(Bt=Ge.getWireframeAttribute(Ye),ur=2);var Hn=Nt;Bt!==null&&((nr=Ze.get(Bt))?(Hn=Xt).setIndex(nr):(console.log("mx attribute == null"),Bt=null)),wn&&(function(Gu,Mo,Yi,Yr){if(ue.isWebGL2!==!1||!Gu.isInstancedMesh&&!Mo.isInstancedBufferGeometry||oe.get("ANGLE_instanced_arrays")!==null){pe.initAttributes();var up=Mo.attributes,_o=Yr.getAttributes(),hp=Yi.defaultAttributeValues;for(var fo in _o){var Hi=_o[fo];if(0<=Hi){var To=up[fo];if(To!==void 0){var cn=To.normalized,Ht=To.itemSize;if((ru=Ze.get(To))===void 0)continue;var ua=ru.buffer,nu=ru.type,$p=ru.bytesPerElement;if(To.isInterleavedBufferAttribute){var zu=To.data,td=zu.stride,nd=To.offset;zu&&zu.isInstancedInterleavedBuffer?(pe.enableAttributeAndDivisor(Hi,zu.meshPerAttribute),Mo.maxInstancedCount===void 0&&(Mo.maxInstancedCount=zu.meshPerAttribute*zu.count)):pe.enableAttribute(Hi),U.bindBuffer(34962,ua),U.vertexAttribPointer(Hi,Ht,nu,cn,td*$p,nd*$p)}else To.isInstancedBufferAttribute?(pe.enableAttributeAndDivisor(Hi,To.meshPerAttribute),Mo.maxInstancedCount===void 0&&(Mo.maxInstancedCount=To.meshPerAttribute*To.count)):pe.enableAttribute(Hi),U.bindBuffer(34962,ua),U.vertexAttribPointer(Hi,Ht,nu,cn,0,0)}else if(fo==="instanceMatrix"){var ru;if((ru=Ze.get(Gu.instanceMatrix))===void 0)continue;ua=ru.buffer,nu=ru.type,pe.enableAttributeAndDivisor(Hi+0,1),pe.enableAttributeAndDivisor(Hi+1,1),pe.enableAttributeAndDivisor(Hi+2,1),pe.enableAttributeAndDivisor(Hi+3,1),U.bindBuffer(34962,ua),U.vertexAttribPointer(Hi+0,4,nu,!1,64,0),U.vertexAttribPointer(Hi+1,4,nu,!1,64,16),U.vertexAttribPointer(Hi+2,4,nu,!1,64,32),U.vertexAttribPointer(Hi+3,4,nu,!1,64,48)}else if(hp!==void 0){var Uu=hp[fo];if(Uu!==void 0)switch(Uu.length){case 2:U.vertexAttrib2fv(Hi,Uu);break;case 3:U.vertexAttrib3fv(Hi,Uu);break;case 4:U.vertexAttrib4fv(Hi,Uu);break;default:U.vertexAttrib1fv(Hi,Uu)}}}}pe.disableUnusedAttributes()}}(Mt,Ye,dt,Dn),Bt!==null&&U.bindBuffer(34963,nr.buffer));var Wn=Bt!==null?Bt.count:hn.count,Ui=Ye.drawRange.start*ur,gi=Ye.drawRange.count*ur,ti=Rn!==null?Rn.start*ur:0,va=Rn!==null?Rn.count*ur:1/0,Ci=Math.max(Ui,ti),bo=Math.min(Wn,Ui+gi,ti+va)-1,tu=Math.max(0,bo-Ci+1);if(tu!==0){if(Mt.isMesh)dt.wireframe===!0?(pe.setLineWidth(dt.wireframeLinewidth*Er()),Hn.setMode(1)):Hn.setMode(4);else if(Mt.isLine){var pl=dt.linewidth;pl===void 0&&(pl=1),pe.setLineWidth(pl*Er()),Mt.isLineSegments?Hn.setMode(1):Mt.isLineLoop?Hn.setMode(2):Hn.setMode(3)}else Mt.isPoints?Hn.setMode(0):Mt.isSprite&&Hn.setMode(4);Mt.isInstancedMesh?Hn.renderInstances(Ye,Ci,tu,Mt.count):Ye.isInstancedBufferGeometry?Hn.renderInstances(Ye,Ci,tu,Ye.maxInstancedCount):Hn.render(Ci,tu)}},this.compile=function(Ae,$e){(ne=_t.get(Ae,$e)).init(),Ae.traverse(function(dt){dt.isLight&&(ne.pushLight(dt),dt.castShadow&&ne.pushShadow(dt))}),ne.setupLights($e);var Ye={};Ae.traverse(function(dt){if(dt.material)if(Array.isArray(dt.material))for(var Mt=0;Mt<dt.material.length;Mt++)dt.material[Mt].uuid in Ye==0&&(eu(dt.material[Mt],Ae,dt),Ye[dt.material[Mt].uuid]=!0);else dt.material.uuid in Ye==0&&(eu(dt.material,Ae,dt),Ye[dt.material.uuid]=!0)})};var Bu=null,Kc=new Yo;function $c(Ae,$e,Ye,dt){for(var Mt=0,Rn=Ae.length;Mt<Rn;Mt++){var xn=Ae[Mt],Dn=xn.object,wn=xn.geometry,Bt=dt===void 0?xn.material:dt,hn=xn.group;if(Ye.isArrayCamera)if(Jt=Ye,Xr.enabled&&Xi.isAvailable())Qc(Dn,$e,Ye,wn,Bt,hn);else for(var nr=Ye.cameras,ur=0,Hn=nr.length;ur<Hn;ur++){var Wn=nr[ur];Dn.layers.test(Wn.layers)&&(pe.viewport(zt.copy(Wn.viewport)),ne.setupLights(Wn),Qc(Dn,$e,Wn,wn,Bt,hn))}else Jt=null,Qc(Dn,$e,Ye,wn,Bt,hn)}}function Qc(Ae,$e,Ye,dt,Mt,Rn){if(Ae.onBeforeRender(wt,$e,Ye,dt,Mt,Rn),ne=_t.get($e,Jt||Ye),Ae.modelViewMatrix.multiplyMatrices(Ye.matrixWorldInverse,Ae.matrixWorld),Ae.normalMatrix.getNormalMatrix(Ae.modelViewMatrix),Ae.isImmediateRenderObject){var xn=Rh(Ye,$e,Mt,Ae);pe.setMaterial(Mt),je.geometry=null,je.program=null,je.wireframe=!1,Dn=xn,Ae.render(function(wn){wt.renderBufferImmediate(wn,Dn)})}else wt.renderBufferDirect(Ye,$e,dt,Mt,Ae,Rn);var Dn;Ae.onAfterRender(wt,$e,Ye,dt,Mt,Rn),ne=_t.get($e,Jt||Ye)}function eu(Ae,$e,Ye){var dt=Oe.get(Ae),Mt=ne.state.lights,Rn=ne.state.shadowsArray,xn=Mt.state.version,Dn=We.getParameters(Ae,Mt.state,Rn,$e,Tr.numPlanes,Tr.numIntersection,Ye),wn=We.getProgramCacheKey(Dn),Bt=dt.program,hn=!0;if(Bt===void 0)Ae.addEventListener("dispose",Is);else if(Bt.cacheKey!==wn)Fu(Ae);else if(dt.lightsStateVersion!==xn)dt.lightsStateVersion=xn,hn=!1;else{if(Dn.shaderID!==void 0)return;hn=!1}hn&&(Bt=We.acquireProgram(Dn,wn),dt.program=Bt,dt.uniforms=Dn.uniforms,dt.environment=Ae.isMeshStandardMaterial?$e.environment:null,dt.outputEncoding=wt.outputEncoding,Ae.program=Bt);var nr=Bt.getAttributes();if(Ae.morphTargets)for(var ur=Ae.numSupportedMorphTargets=0;ur<wt.maxMorphTargets;ur++)0<=nr["morphTarget"+ur]&&Ae.numSupportedMorphTargets++;if(Ae.morphNormals)for(ur=Ae.numSupportedMorphNormals=0;ur<wt.maxMorphNormals;ur++)0<=nr["morphNormal"+ur]&&Ae.numSupportedMorphNormals++;var Hn,Wn=dt.uniforms;(Ae.isShaderMaterial||Ae.isRawShaderMaterial)&&Ae.clipping!==!0||(dt.numClippingPlanes=Tr.numPlanes,dt.numIntersection=Tr.numIntersection,Wn.clippingPlanes=Tr.uniform),dt.fog=$e.fog,dt.needsLights=(Hn=Ae).isMeshLambertMaterial||Hn.isMeshToonMaterial||Hn.isMeshPhongMaterial||Hn.isMeshStandardMaterial||Hn.isShadowMaterial||Hn.isShaderMaterial&&Hn.lights===!0,dt.lightsStateVersion=xn,dt.needsLights&&(Wn.ambientLightColor.value=Mt.state.ambient,Wn.lightProbe.value=Mt.state.probe,Wn.directionalLights.value=Mt.state.directional,Wn.spotLights.value=Mt.state.spot,Wn.rectAreaLights.value=Mt.state.rectArea,Wn.pointLights.value=Mt.state.point,Wn.hemisphereLights.value=Mt.state.hemi,Wn.directionalShadowMap.value=Mt.state.directionalShadowMap,Wn.directionalShadowMatrix.value=Mt.state.directionalShadowMatrix,Wn.spotShadowMap.value=Mt.state.spotShadowMap,Wn.spotShadowMatrix.value=Mt.state.spotShadowMatrix,Wn.pointShadowMap.value=Mt.state.pointShadowMap,Wn.pointShadowMatrix.value=Mt.state.pointShadowMatrix);var Ui=dt.program.getUniforms(),gi=xo.seqWithValue(Ui.seq,Wn);dt.uniformsList=gi}function Rh(Ae,$e,Ye,dt){Fe.resetTextureUnits();var Mt=$e.fog,Rn=Ye.isMeshStandardMaterial?$e.environment:null,xn=Oe.get(Ye),Dn=ne.state.lights;if(fi&&(to||Ae!==nt)){var wn=Ae===nt&&Ye.id===Tn;Tr.setState(Ye.clippingPlanes,Ye.clipIntersection,Ye.clipShadows,Ae,xn,wn)}Ye.version===xn.__version?(xn.program===void 0||Ye.fog&&xn.fog!==Mt||xn.environment!==Rn||xn.needsLights&&xn.lightsStateVersion!==Dn.state.version||xn.numClippingPlanes!==void 0&&(xn.numClippingPlanes!==Tr.numPlanes||xn.numIntersection!==Tr.numIntersection)||xn.outputEncoding!==wt.outputEncoding)&&eu(Ye,$e,dt):(Oe.update(Ye,"uniforms",Ye.uniforms),eu(Ye,$e,dt),xn.__version=Ye.version);var Bt,hn,nr,ur,Hn,Wn,Ui,gi,ti,va,Ci,bo,tu=!1,pl=!1,Gu=!1,Mo=xn.program,Yi=Mo.getUniforms(),Yr=xn.uniforms;if(pe.useProgram(Mo.program)&&(Gu=pl=tu=!0),Ye.id!==Tn&&(Tn=Ye.id,pl=!0),tu||nt!==Ae){if(0<Mo.numMultiviewViews?Xi.updateCameraProjectionMatricesUniform(Ae,Yi):Yi.setValue(U,"projectionMatrix",Ae.projectionMatrix),ue.logarithmicDepthBuffer&&Yi.setValue(U,"logDepthBufFC",2/(Math.log(Ae.far+1)/Math.LN2)),nt!==Ae&&(nt=Ae,Gu=pl=!0),Ye.isShaderMaterial||Ye.isMeshPhongMaterial||Ye.isMeshToonMaterial||Ye.isMeshStandardMaterial||Ye.envMap){var up=Yi.map.cameraPosition;up!==void 0&&up.setValue(U,Ti.setFromMatrixPosition(Ae.matrixWorld))}(Ye.isMeshPhongMaterial||Ye.isMeshToonMaterial||Ye.isMeshLambertMaterial||Ye.isMeshBasicMaterial||Ye.isMeshStandardMaterial||Ye.isShaderMaterial)&&Yi.setValue(U,"isOrthographic",Ae.isOrthographicCamera===!0),(Ye.isMeshPhongMaterial||Ye.isMeshToonMaterial||Ye.isMeshLambertMaterial||Ye.isMeshBasicMaterial||Ye.isMeshStandardMaterial||Ye.isShaderMaterial||Ye.skinning)&&(0<Mo.numMultiviewViews?Xi.updateCameraViewMatricesUniform(Ae,Yi):Yi.setValue(U,"viewMatrix",Ae.matrixWorldInverse))}if(Ye.skinning){Yi.setOptional(U,dt,"bindMatrix"),Yi.setOptional(U,dt,"bindMatrixInverse");var _o=dt.skeleton;if(_o){var hp=_o.bones;if(ue.floatVertexTextures){if(_o.boneTexture===void 0){var fo=Math.sqrt(4*hp.length);fo=Qt.ceilPowerOfTwo(fo),fo=Math.max(fo,4);var Hi=new Float32Array(fo*fo*4);Hi.set(_o.boneMatrices);var To=new jn(Hi,fo,fo,f,Y);_o.boneMatrices=Hi,_o.boneTexture=To,_o.boneTextureSize=fo}Yi.setValue(U,"boneTexture",_o.boneTexture,Fe),Yi.setValue(U,"boneTextureSize",_o.boneTextureSize)}else Yi.setOptional(U,_o,"boneMatrices")}}return!pl&&xn.receiveShadow===dt.receiveShadow||(xn.receiveShadow=dt.receiveShadow,Yi.setValue(U,"receiveShadow",dt.receiveShadow)),pl&&(Yi.setValue(U,"toneMappingExposure",wt.toneMappingExposure),Yi.setValue(U,"toneMappingWhitePoint",wt.toneMappingWhitePoint),xn.needsLights&&(bo=Gu,(Ci=Yr).ambientLightColor.needsUpdate=bo,Ci.lightProbe.needsUpdate=bo,Ci.directionalLights.needsUpdate=bo,Ci.pointLights.needsUpdate=bo,Ci.spotLights.needsUpdate=bo,Ci.rectAreaLights.needsUpdate=bo,Ci.hemisphereLights.needsUpdate=bo),Mt&&Ye.fog&&(va=Mt,(ti=Yr).fogColor.value.copy(va.color),va.isFog?(ti.fogNear.value=va.near,ti.fogFar.value=va.far):va.isFogExp2&&(ti.fogDensity.value=va.density)),Ye.isMeshBasicMaterial?po(Yr,Ye):Ye.isMeshLambertMaterial?(po(Yr,Ye),Ui=Yr,(gi=Ye).emissiveMap&&(Ui.emissiveMap.value=gi.emissiveMap)):Ye.isMeshToonMaterial?(po(Yr,Ye),function(cn,Ht){cn.specular.value.copy(Ht.specular),cn.shininess.value=Math.max(Ht.shininess,1e-4),Ht.gradientMap&&(cn.gradientMap.value=Ht.gradientMap),Ht.emissiveMap&&(cn.emissiveMap.value=Ht.emissiveMap),Ht.bumpMap&&(cn.bumpMap.value=Ht.bumpMap,cn.bumpScale.value=Ht.bumpScale,Ht.side===1&&(cn.bumpScale.value*=-1)),Ht.normalMap&&(cn.normalMap.value=Ht.normalMap,cn.normalScale.value.copy(Ht.normalScale),Ht.side===1&&cn.normalScale.value.negate()),Ht.displacementMap&&(cn.displacementMap.value=Ht.displacementMap,cn.displacementScale.value=Ht.displacementScale,cn.displacementBias.value=Ht.displacementBias)}(Yr,Ye)):Ye.isMeshPhongMaterial?(po(Yr,Ye),function(cn,Ht){cn.specular.value.copy(Ht.specular),cn.shininess.value=Math.max(Ht.shininess,1e-4),Ht.emissiveMap&&(cn.emissiveMap.value=Ht.emissiveMap),Ht.bumpMap&&(cn.bumpMap.value=Ht.bumpMap,cn.bumpScale.value=Ht.bumpScale,Ht.side===1&&(cn.bumpScale.value*=-1)),Ht.normalMap&&(cn.normalMap.value=Ht.normalMap,cn.normalScale.value.copy(Ht.normalScale),Ht.side===1&&cn.normalScale.value.negate()),Ht.displacementMap&&(cn.displacementMap.value=Ht.displacementMap,cn.displacementScale.value=Ht.displacementScale,cn.displacementBias.value=Ht.displacementBias)}(Yr,Ye)):Ye.isMeshStandardMaterial?(po(Yr,Ye,Rn),(Ye.isMeshPhysicalMaterial?function(cn,Ht,ua){Kp(cn,Ht,ua),cn.reflectivity.value=Ht.reflectivity,cn.clearcoat.value=Ht.clearcoat,cn.clearcoatRoughness.value=Ht.clearcoatRoughness,Ht.sheen&&cn.sheen.value.copy(Ht.sheen),Ht.clearcoatNormalMap&&(cn.clearcoatNormalScale.value.copy(Ht.clearcoatNormalScale),cn.clearcoatNormalMap.value=Ht.clearcoatNormalMap,Ht.side===1&&cn.clearcoatNormalScale.value.negate()),cn.transparency.value=Ht.transparency}:Kp)(Yr,Ye,Rn)):Ye.isMeshMatcapMaterial?(po(Yr,Ye),function(cn,Ht){Ht.matcap&&(cn.matcap.value=Ht.matcap),Ht.bumpMap&&(cn.bumpMap.value=Ht.bumpMap,cn.bumpScale.value=Ht.bumpScale,Ht.side===1&&(cn.bumpScale.value*=-1)),Ht.normalMap&&(cn.normalMap.value=Ht.normalMap,cn.normalScale.value.copy(Ht.normalScale),Ht.side===1&&cn.normalScale.value.negate()),Ht.displacementMap&&(cn.displacementMap.value=Ht.displacementMap,cn.displacementScale.value=Ht.displacementScale,cn.displacementBias.value=Ht.displacementBias)}(Yr,Ye)):Ye.isMeshDepthMaterial?(po(Yr,Ye),Hn=Yr,(Wn=Ye).displacementMap&&(Hn.displacementMap.value=Wn.displacementMap,Hn.displacementScale.value=Wn.displacementScale,Hn.displacementBias.value=Wn.displacementBias)):Ye.isMeshDistanceMaterial?(po(Yr,Ye),function(cn,Ht){Ht.displacementMap&&(cn.displacementMap.value=Ht.displacementMap,cn.displacementScale.value=Ht.displacementScale,cn.displacementBias.value=Ht.displacementBias),cn.referencePosition.value.copy(Ht.referencePosition),cn.nearDistance.value=Ht.nearDistance,cn.farDistance.value=Ht.farDistance}(Yr,Ye)):Ye.isMeshNormalMaterial?(po(Yr,Ye),function(cn,Ht){Ht.bumpMap&&(cn.bumpMap.value=Ht.bumpMap,cn.bumpScale.value=Ht.bumpScale,Ht.side===1&&(cn.bumpScale.value*=-1)),Ht.normalMap&&(cn.normalMap.value=Ht.normalMap,cn.normalScale.value.copy(Ht.normalScale),Ht.side===1&&cn.normalScale.value.negate()),Ht.displacementMap&&(cn.displacementMap.value=Ht.displacementMap,cn.displacementScale.value=Ht.displacementScale,cn.displacementBias.value=Ht.displacementBias)}(Yr,Ye)):Ye.isLineBasicMaterial?(ur=Ye,(nr=Yr).diffuse.value.copy(ur.color),nr.opacity.value=ur.opacity,Ye.isLineDashedMaterial&&(hn=Ye,(Bt=Yr).dashSize.value=hn.dashSize,Bt.totalSize.value=hn.dashSize+hn.gapSize,Bt.scale.value=hn.scale)):Ye.isPointsMaterial?function(cn,Ht){var ua;cn.diffuse.value.copy(Ht.color),cn.opacity.value=Ht.opacity,cn.size.value=Ht.size*lr,cn.scale.value=.5*An,Ht.map&&(cn.map.value=Ht.map),Ht.alphaMap&&(cn.alphaMap.value=Ht.alphaMap),Ht.map?ua=Ht.map:Ht.alphaMap&&(ua=Ht.alphaMap),ua!==void 0&&(ua.matrixAutoUpdate===!0&&ua.updateMatrix(),cn.uvTransform.value.copy(ua.matrix))}(Yr,Ye):Ye.isSpriteMaterial?function(cn,Ht){var ua;cn.diffuse.value.copy(Ht.color),cn.opacity.value=Ht.opacity,cn.rotation.value=Ht.rotation,Ht.map&&(cn.map.value=Ht.map),Ht.alphaMap&&(cn.alphaMap.value=Ht.alphaMap),Ht.map?ua=Ht.map:Ht.alphaMap&&(ua=Ht.alphaMap),ua!==void 0&&(ua.matrixAutoUpdate===!0&&ua.updateMatrix(),cn.uvTransform.value.copy(ua.matrix))}(Yr,Ye):Ye.isShadowMaterial&&(Yr.color.value.copy(Ye.color),Yr.opacity.value=Ye.opacity),Yr.ltc_1!==void 0&&(Yr.ltc_1.value=en.LTC_1),Yr.ltc_2!==void 0&&(Yr.ltc_2.value=en.LTC_2),xo.upload(U,xn.uniformsList,Yr,Fe),Ye.isShaderMaterial&&(Ye.uniformsNeedUpdate=!1)),Ye.isShaderMaterial&&Ye.uniformsNeedUpdate===!0&&(xo.upload(U,xn.uniformsList,Yr,Fe),Ye.uniformsNeedUpdate=!1),Ye.isSpriteMaterial&&Yi.setValue(U,"center",dt.center),0<Mo.numMultiviewViews?Xi.updateObjectMatricesUniforms(dt,Ae,Yi):(Yi.setValue(U,"modelViewMatrix",dt.modelViewMatrix),Yi.setValue(U,"normalMatrix",dt.normalMatrix)),Yi.setValue(U,"modelMatrix",dt.matrixWorld),Mo}function po(Ae,$e,Ye){Ae.opacity.value=$e.opacity,$e.color&&Ae.diffuse.value.copy($e.color),$e.emissive&&Ae.emissive.value.copy($e.emissive).multiplyScalar($e.emissiveIntensity),$e.map&&(Ae.map.value=$e.map),$e.alphaMap&&(Ae.alphaMap.value=$e.alphaMap),$e.specularMap&&(Ae.specularMap.value=$e.specularMap);var dt,Mt,Rn=$e.envMap||Ye;Rn&&(Ae.envMap.value=Rn,Ae.flipEnvMap.value=Rn.isCubeTexture?-1:1,Ae.reflectivity.value=$e.reflectivity,Ae.refractionRatio.value=$e.refractionRatio,Ae.maxMipLevel.value=Oe.get(Rn).__maxMipLevel),$e.lightMap&&(Ae.lightMap.value=$e.lightMap,Ae.lightMapIntensity.value=$e.lightMapIntensity),$e.aoMap&&(Ae.aoMap.value=$e.aoMap,Ae.aoMapIntensity.value=$e.aoMapIntensity),$e.map?dt=$e.map:$e.specularMap?dt=$e.specularMap:$e.displacementMap?dt=$e.displacementMap:$e.normalMap?dt=$e.normalMap:$e.bumpMap?dt=$e.bumpMap:$e.roughnessMap?dt=$e.roughnessMap:$e.metalnessMap?dt=$e.metalnessMap:$e.alphaMap?dt=$e.alphaMap:$e.emissiveMap&&(dt=$e.emissiveMap),dt!==void 0&&(dt.isWebGLRenderTarget&&(dt=dt.texture),dt.matrixAutoUpdate===!0&&dt.updateMatrix(),Ae.uvTransform.value.copy(dt.matrix)),$e.aoMap?Mt=$e.aoMap:$e.lightMap&&(Mt=$e.lightMap),Mt!==void 0&&(Mt.isWebGLRenderTarget&&(Mt=Mt.texture),Mt.matrixAutoUpdate===!0&&Mt.updateMatrix(),Ae.uv2Transform.value.copy(Mt.matrix))}function Kp(Ae,$e,Ye){Ae.roughness.value=$e.roughness,Ae.metalness.value=$e.metalness,$e.roughnessMap&&(Ae.roughnessMap.value=$e.roughnessMap),$e.metalnessMap&&(Ae.metalnessMap.value=$e.metalnessMap),$e.emissiveMap&&(Ae.emissiveMap.value=$e.emissiveMap),$e.bumpMap&&(Ae.bumpMap.value=$e.bumpMap,Ae.bumpScale.value=$e.bumpScale,$e.side===1&&(Ae.bumpScale.value*=-1)),$e.normalMap&&(Ae.normalMap.value=$e.normalMap,Ae.normalScale.value.copy($e.normalScale),$e.side===1&&Ae.normalScale.value.negate()),$e.displacementMap&&(Ae.displacementMap.value=$e.displacementMap,Ae.displacementScale.value=$e.displacementScale,Ae.displacementBias.value=$e.displacementBias),($e.envMap||Ye)&&(Ae.envMapIntensity.value=$e.envMapIntensity)}Kc.setAnimationLoop(function(Ae){Xr.isPresenting||Bu&&Bu(Ae)}),typeof window<"u"&&Kc.setContext(window),this.setAnimationLoop=function(Ae){Bu=Ae,Xr.setAnimationLoop(Ae),Kc.start()},this.render=function(Ae,$e){var Ye,dt;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Ye=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),dt=arguments[3]),$e&&$e.isCamera){if(!sn){je.geometry=null,je.program=null,je.wireframe=!1,Tn=-1,!(nt=null)===Ae.autoUpdate&&Ae.updateMatrixWorld(),$e.parent===null&&$e.updateMatrixWorld(),Xr.enabled&&Xr.isPresenting&&($e=Xr.getCamera($e)),(ne=_t.get(Ae,$e)).init(),Ae.onBeforeRender(wt,Ae,$e,Ye||Nn),Ir.multiplyMatrices($e.projectionMatrix,$e.matrixWorldInverse),gr.setFromProjectionMatrix(Ir),to=this.localClippingEnabled,fi=Tr.init(this.clippingPlanes,to,$e),(Q=ft.get(Ae,$e)).init(),function wn(Bt,hn,nr,ur){if(Bt.visible!==!1){if(Bt.layers.test(hn.layers)){if(Bt.isGroup)nr=Bt.renderOrder;else if(Bt.isLOD)Bt.autoUpdate===!0&&Bt.update(hn);else if(Bt.isLight)ne.pushLight(Bt),Bt.castShadow&&ne.pushShadow(Bt);else if(Bt.isSprite){if(!Bt.frustumCulled||gr.intersectsSprite(Bt)){ur&&Ti.setFromMatrixPosition(Bt.matrixWorld).applyMatrix4(Ir);var Hn=et.update(Bt);(Wn=Bt.material).visible&&Q.push(Bt,Hn,Wn,nr,Ti.z,null)}}else if(Bt.isImmediateRenderObject)ur&&Ti.setFromMatrixPosition(Bt.matrixWorld).applyMatrix4(Ir),Q.push(Bt,null,Bt.material,nr,Ti.z,null);else if((Bt.isMesh||Bt.isLine||Bt.isPoints)&&(Bt.isSkinnedMesh&&Bt.skeleton.frame!==Te.render.frame&&(Bt.skeleton.update(),Bt.skeleton.frame=Te.render.frame),!Bt.frustumCulled||gr.intersectsObject(Bt))){ur&&Ti.setFromMatrixPosition(Bt.matrixWorld).applyMatrix4(Ir),Hn=et.update(Bt);var Wn=Bt.material;if(Array.isArray(Wn))for(var Ui=Hn.groups,gi=0,ti=Ui.length;gi<ti;gi++){var va=Ui[gi],Ci=Wn[va.materialIndex];Ci&&Ci.visible&&Q.push(Bt,Hn,Ci,nr,Ti.z,va)}else Wn.visible&&Q.push(Bt,Hn,Wn,nr,Ti.z,null)}}var bo=Bt.children;for(gi=0,ti=bo.length;gi<ti;gi++)wn(bo[gi],hn,nr,ur)}}(Ae,$e,0,wt.sortObjects),wt.sortObjects===!0&&Q.sort(pt,yn),fi&&Tr.beginShadows();var Mt=ne.state.shadowsArray;Ha.render(Mt,Ae,$e),ne.setupLights($e),fi&&Tr.endShadows(),this.info.autoReset&&this.info.reset(),Ye!==void 0&&this.setRenderTarget(Ye),Xr.enabled&&Xi.isAvailable()&&Xi.attachCamera($e),Et.render(Q,Ae,$e,dt);var Rn=Q.opaque,xn=Q.transparent;if(Ae.overrideMaterial){var Dn=Ae.overrideMaterial;Rn.length&&$c(Rn,Ae,$e,Dn),xn.length&&$c(xn,Ae,$e,Dn)}else Rn.length&&$c(Rn,Ae,$e),xn.length&&$c(xn,Ae,$e);Ae.onAfterRender(wt,Ae,$e),Nn!==null&&(Fe.updateRenderTargetMipmap(Nn),Fe.updateMultisampleRenderTarget(Nn)),pe.buffers.depth.setTest(!0),pe.buffers.depth.setMask(!0),pe.buffers.color.setMask(!0),pe.setPolygonOffset(!1),Xr.enabled&&Xi.isAvailable()&&Xi.detachCamera($e),ne=Q=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.mxRenderObject=function(Ae,$e,Ye,dt,Mt){Qc(Ae,$e,Ye,et.update(Ae),dt,Mt)},this.setFramebuffer=function(Ae){gn!==Ae&&Nn===null&&U.bindFramebuffer(36160,Ae),gn=Ae},this.getActiveCubeFace=function(){return Jn},this.getActiveMipmapLevel=function(){return Gn},this.getRenderTarget=function(){return Nn},this.setRenderTarget=function(Ae,$e,Ye){Jn=$e,Gn=Ye,(Nn=Ae)&&Oe.get(Ae).__webglFramebuffer===void 0&&Fe.setupRenderTarget(Ae);var dt=gn,Mt=!1;if(Ae){var Rn=Oe.get(Ae).__webglFramebuffer;Ae.isWebGLCubeRenderTarget?(dt=Rn[$e||0],Mt=!0):dt=Ae.isWebGLMultisampleRenderTarget?Oe.get(Ae).__webglMultisampledFramebuffer:Rn,zt.copy(Ae.viewport),Qn.copy(Ae.scissor),Sn=Ae.scissorTest}else zt.copy(vn).multiplyScalar(lr).floor(),Qn.copy(tr).multiplyScalar(lr).floor(),Sn=an;if(sr!==dt&&(U.bindFramebuffer(36160,dt),sr=dt),pe.viewport(zt),pe.scissor(Qn),pe.setScissorTest(Sn),Mt){var xn=Oe.get(Ae.texture);U.framebufferTexture2D(36160,36064,34069+($e||0),xn.__webglTexture,Ye||0)}},this.readRenderTargetPixels=function(Ae,$e,Ye,dt,Mt,Rn,xn){if(Ae&&Ae.isWebGLRenderTarget){var Dn=Oe.get(Ae).__webglFramebuffer;if(Ae.isWebGLCubeRenderTarget&&xn!==void 0&&(Dn=Dn[xn]),Dn){var wn=!1;Dn!==sr&&(U.bindFramebuffer(36160,Dn),wn=!0);try{var Bt=Ae.texture,hn=Bt.format,nr=Bt.type;if(hn!==f&&Tt.convert(hn)!==U.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(nr===R||Tt.convert(nr)===U.getParameter(35738)||nr===Y&&(ue.isWebGL2||oe.get("OES_texture_float")||oe.get("WEBGL_color_buffer_float"))||nr===c&&(ue.isWebGL2?oe.get("EXT_color_buffer_float"):oe.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");U.checkFramebufferStatus(36160)===36053?0<=$e&&$e<=Ae.width-dt&&0<=Ye&&Ye<=Ae.height-Mt&&U.readPixels($e,Ye,dt,Mt,Tt.convert(hn),Tt.convert(nr),Rn):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{wn&&U.bindFramebuffer(36160,sr)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(Ae,$e,Ye){Ye===void 0&&(Ye=0);var dt=Math.pow(2,-Ye),Mt=Math.floor($e.image.width*dt),Rn=Math.floor($e.image.height*dt),xn=Tt.convert($e.format);Fe.setTexture2D($e,0),U.copyTexImage2D(3553,Ye,xn,Ae.x,Ae.y,Mt,Rn,0),pe.unbindTexture()},this.copyTextureToTexture=function(Ae,$e,Ye,dt){var Mt=$e.image.width,Rn=$e.image.height,xn=Tt.convert(Ye.format),Dn=Tt.convert(Ye.type);Fe.setTexture2D(Ye,0),$e.isDataTexture?U.texSubImage2D(3553,dt||0,Ae.x,Ae.y,Mt,Rn,xn,Dn,$e.image.data):U.texSubImage2D(3553,dt||0,Ae.x,Ae.y,xn,Dn,$e.image),pe.unbindTexture()},this.initTexture=function(Ae){Fe.setTexture2D(Ae,0),pe.unbindTexture()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function uu(e,t){this.name="",this.color=new Cn(e),this.density=t!==void 0?t:25e-5}function Ra(e,t,n){this.name="",this.color=new Cn(e),this.near=t!==void 0?t:1,this.far=n!==void 0?n:1e3}function Qo(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Pt,this.updateRange={offset:0,count:-1},this.version=0}((Bs.prototype=Object.create(rr.prototype)).constructor=Bs).prototype.isMeshDepthMaterial=!0,Bs.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},(($o.prototype=Object.create(rr.prototype)).constructor=$o).prototype.isMeshDistanceMaterial=!0,$o.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},lu.prototype=Object.assign(Object.create(rt.prototype),{constructor:lu,isWebGLMultiviewRenderTarget:!0,copy:function(e){return rt.prototype.copy.call(this,e),this.numViews=e.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}}),vl.prototype=Object.assign(Object.create(Dr.prototype),{constructor:vl,isArrayCamera:!0}),wr.prototype=Object.assign(Object.create(mn.prototype),{constructor:wr,isGroup:!0}),Object.assign(xl.prototype,bt.prototype),Object.assign(uu.prototype,{isFogExp2:!0,clone:function(){return new uu(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Ra.prototype,{isFog:!0,clone:function(){return new Ra(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Qo.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.assign(Qo.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,l=this.stride;i<l;i++)this.array[e+i]=t.array[n+i];return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});var es,ts=new Se;function wl(e,t,n,i){this.data=e,this.itemSize=t,this.offset=n,this.normalized=i===!0}function Gs(e){rr.call(this),this.type="SpriteMaterial",this.color=new Cn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(wl.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(wl.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,n=this.data.count;t<n;t++)ts.x=this.getX(t),ts.y=this.getY(t),ts.z=this.getZ(t),ts.applyMatrix4(e),this.setXYZ(t,ts.x,ts.y,ts.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this},setXYZW:function(e,t,n,i,l){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=l,this}}),((Gs.prototype=Object.create(rr.prototype)).constructor=Gs).prototype.isSpriteMaterial=!0,Gs.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var fa=new Se,Za=new Se,vs=new Se,zs=new Ve,xs=new Ve,ah=new Lt,bl=new Se,Ml=new Se,_l=new Se,hu=new Ve,Lo=new Ve,Hh=new Ve;function co(e){if(mn.call(this),this.type="Sprite",es===void 0){es=new X;var t=new Qo(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);es.setIndex([0,1,2,0,2,3]),es.setAttribute("position",new wl(t,3,0,!1)),es.setAttribute("uv",new wl(t,2,3,!1))}this.geometry=es,this.material=e!==void 0?e:new Gs,this.center=new Ve(.5,.5)}function rc(e,t,n,i,l,h){zs.subVectors(e,n).addScalar(.5).multiply(i),l!==void 0?(xs.x=h*zs.x-l*zs.y,xs.y=l*zs.x+h*zs.y):xs.copy(zs),e.copy(t),e.x+=xs.x,e.y+=xs.y,e.applyMatrix4(ah)}co.prototype=Object.assign(Object.create(mn.prototype),{constructor:co,isSprite:!0,raycast:function(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Za.setFromMatrixScale(this.matrixWorld),ah.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),vs.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Za.multiplyScalar(-vs.z);var n,i,l=this.material.rotation;l!==0&&(i=Math.cos(l),n=Math.sin(l));var h=this.center;rc(bl.set(-.5,-.5,0),vs,h,Za,n,i),rc(Ml.set(.5,-.5,0),vs,h,Za,n,i),rc(_l.set(.5,.5,0),vs,h,Za,n,i),hu.set(0,0),Lo.set(1,0),Hh.set(1,1);var g=e.ray.intersectTriangle(bl,Ml,_l,!1,fa);if(g!==null||(rc(Ml.set(-.5,.5,0),vs,h,Za,n,i),Lo.set(0,1),(g=e.ray.intersectTriangle(bl,_l,Ml,!1,fa))!==null)){var b=e.ray.origin.distanceTo(fa);b<e.near||b>e.far||t.push({distance:b,point:fa.clone(),uv:Di.getUV(fa,bl,Ml,_l,hu,Lo,Hh,new Ve),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return mn.prototype.copy.call(this,e),e.center!==void 0&&this.center.copy(e.center),this}});var ic=new Se,pu=new Se;function Tl(){mn.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Cl(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Vr.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Lt,this.bindMatrixInverse=new Lt}Tl.prototype=Object.assign(Object.create(mn.prototype),{constructor:Tl,isLOD:!0,copy:function(e){mn.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,i=t.length;n<i;n++){var l=t[n];this.addLevel(l.object.clone(),l.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){t===void 0&&(t=0),t=Math.abs(t);for(var n=this.levels,i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){var t=this.levels;if(0<t.length){for(var n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(0<this.levels.length){ic.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(ic);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(1<t.length){ic.setFromMatrixPosition(e.matrixWorld),pu.setFromMatrixPosition(this.matrixWorld);var n=ic.distanceTo(pu);t[0].object.visible=!0;for(var i=1,l=t.length;i<l&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(;i<l;i++)t[i].object.visible=!1}},toJSON:function(e){var t=mn.prototype.toJSON.call(this,e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];for(var n=this.levels,i=0,l=n.length;i<l;i++){var h=n[i];t.object.levels.push({object:h.object.uuid,distance:h.distance})}return t}}),Cl.prototype=Object.assign(Object.create(Vr.prototype),{constructor:Cl,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new ct,t=this.geometry.attributes.skinWeight,n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var l=1/e.manhattanLength();l!=1/0?e.multiplyScalar(l):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Vr.prototype.updateMatrixWorld.call(this,e),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var oh=new Lt,Wh=new Lt;function ma(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,t===void 0)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new Lt)}}function uo(){mn.call(this),this.type="Bone"}Object.assign(ma.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new Lt;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n;for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture,l=0,h=e.length;l<h;l++){var g=e[l]?e[l].matrixWorld:Wh;oh.multiplyMatrices(g,t[l]),oh.toArray(n,16*l)}i!==void 0&&(i.needsUpdate=!0)},clone:function(){return new ma(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var i=this.bones[t];if(i.name===e)return i}}}),uo.prototype=Object.assign(Object.create(mn.prototype),{constructor:uo,isBone:!0});var ac=new Lt,Us=new Lt,Hs=[],Sl=new Vr;function oc(e,t,n){Vr.call(this,e,t),this.instanceMatrix=new $n(new Float32Array(16*n),16),this.count=n,this.frustumCulled=!1}function si(e){rr.call(this),this.type="LineBasicMaterial",this.color=new Cn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}oc.prototype=Object.assign(Object.create(Vr.prototype),{constructor:oc,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var n=this.matrixWorld,i=this.count;if(Sl.geometry=this.geometry,Sl.material=this.material,Sl.material!==void 0)for(var l=0;l<i;l++)this.getMatrixAt(l,ac),Us.multiplyMatrices(n,ac),Sl.matrixWorld=Us,Sl.raycast(e,Hs),0<Hs.length&&(Hs[0].instanceId=l,Hs[0].object=this,t.push(Hs[0]),Hs.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),((si.prototype=Object.create(rr.prototype)).constructor=si).prototype.isLineBasicMaterial=!0,si.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var Dl=new Se,sh=new Se,lh=new Lt,Ws=new se,sc=new xa;function Ma(e,t,n){n===1&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),mn.call(this),this.type="Line",this.geometry=e!==void 0?e:new X,this.material=t!==void 0?t:new si}Ma.prototype=Object.assign(Object.create(mn.prototype),{constructor:Ma,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(e.index===null){for(var t=e.attributes.position,n=[0],i=1,l=t.count;i<l;i++)Dl.fromBufferAttribute(t,i-1),sh.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=Dl.distanceTo(sh);e.setAttribute("lineDistance",new ln(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var h=e.vertices;for((n=e.lineDistances)[0]=0,i=1,l=h.length;i<l;i++)n[i]=n[i-1],n[i]+=h[i-1].distanceTo(h[i])}return this},raycast:function(e,t){var n=e.linePrecision,i=this.geometry,l=this.matrixWorld;if(i.boundingSphere===null&&i.computeBoundingSphere(),sc.copy(i.boundingSphere),sc.applyMatrix4(l),sc.radius+=n,e.ray.intersectsSphere(sc)!==!1){lh.getInverse(l),Ws.copy(e.ray).applyMatrix4(lh);var h=n/((this.scale.x+this.scale.y+this.scale.z)/3),g=h*h,b=new Se,k=new Se,F=new Se,K=new Se,Q=this&&this.isLineSegments?2:1;if(i.isBufferGeometry){var ne=i.index,U=i.attributes.position.array;if(ne!==null)for(var oe=ne.array,ue=0,pe=oe.length-1;ue<pe;ue+=Q){var Te=oe[ue],Oe=oe[ue+1];b.fromArray(U,3*Te),k.fromArray(U,3*Oe),g<Ws.distanceSqToSegment(b,k,K,F)||(K.applyMatrix4(this.matrixWorld),(Ge=e.ray.origin.distanceTo(K))<e.near||Ge>e.far||t.push({distance:Ge,point:F.clone().applyMatrix4(this.matrixWorld),index:ue,face:null,faceIndex:null,object:this}))}else for(ue=0,pe=U.length/3-1;ue<pe;ue+=Q)b.fromArray(U,3*ue),k.fromArray(U,3*ue+3),g<Ws.distanceSqToSegment(b,k,K,F)||(K.applyMatrix4(this.matrixWorld),(Ge=e.ray.origin.distanceTo(K))<e.near||Ge>e.far||t.push({distance:Ge,point:F.clone().applyMatrix4(this.matrixWorld),index:ue,face:null,faceIndex:null,object:this}))}else if(i.isGeometry){var Fe=i.vertices,Ze=Fe.length;for(ue=0;ue<Ze-1;ue+=Q){var Ge;g<Ws.distanceSqToSegment(Fe[ue],Fe[ue+1],K,F)||(K.applyMatrix4(this.matrixWorld),(Ge=e.ray.origin.distanceTo(K))<e.near||Ge>e.far||t.push({distance:Ge,point:F.clone().applyMatrix4(this.matrixWorld),index:ue,face:null,faceIndex:null,object:this}))}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var El=new Se,Js=new Se;function Mi(e,t){Ma.call(this,e,t),this.type="LineSegments"}function qs(e,t){Ma.call(this,e,t),this.type="LineLoop"}function Io(e){rr.call(this),this.type="PointsMaterial",this.color=new Cn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}Mi.prototype=Object.assign(Object.create(Ma.prototype),{constructor:Mi,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(e.index===null){for(var t=e.attributes.position,n=[],i=0,l=t.count;i<l;i+=2)El.fromBufferAttribute(t,i),Js.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+El.distanceTo(Js);e.setAttribute("lineDistance",new ln(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var h=e.vertices;for(n=e.lineDistances,i=0,l=h.length;i<l;i+=2)El.copy(h[i]),Js.copy(h[i+1]),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+El.distanceTo(Js)}return this}}),qs.prototype=Object.assign(Object.create(Ma.prototype),{constructor:qs,isLineLoop:!0}),((Io.prototype=Object.create(rr.prototype)).constructor=Io).prototype.isPointsMaterial=!0,Io.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var du=new Lt,ch=new se,lc=new xa,ho=new Se;function Xs(e,t){mn.call(this),this.type="Points",this.geometry=e!==void 0?e:new X,this.material=t!==void 0?t:new Io,this.updateMorphTargets()}function fu(e,t,n,i,l,h,g){var b=ch.distanceSqToPoint(e);if(b<n){var k=new Se;ch.closestPointToPoint(e,k),k.applyMatrix4(i);var F=l.ray.origin.distanceTo(k);if(F<l.near||F>l.far)return;h.push({distance:F,distanceToRay:Math.sqrt(b),point:k,index:t,face:null,object:g})}}function uh(e,t,n,i,l,h,g,b,k){nn.call(this,e,t,n,i,l,h,g,b,k),this.format=g!==void 0?g:m,this.minFilter=h!==void 0?h:q,this.magFilter=l!==void 0?l:q,this.generateMipmaps=!1}function cc(e,t,n,i,l,h,g,b,k,F,K,Q){nn.call(this,null,h,g,b,k,F,i,l,K,Q),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function wo(e,t,n,i,l,h,g,b,k){nn.call(this,e,t,n,i,l,h,g,b,k),this.needsUpdate=!0}function uc(e,t,n,i,l,h,g,b,k,F){if((F=F!==void 0?F:P)!==P&&F!==O)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&F===P&&(n=v),n===void 0&&F===O&&(n=p),nn.call(this,null,i,l,h,g,b,F,n,k),this.image={width:e,height:t},this.magFilter=g!==void 0?g:z,this.minFilter=b!==void 0?b:z,this.flipY=!1,this.generateMipmaps=!1}function Ys(e){X.call(this),this.type="WireframeGeometry";var t,n,i,l,h,g,b,k,F,K,Q=[],ne=[0,0],U={},oe=["a","b","c"];if(e&&e.isGeometry){var ue=e.faces;for(t=0,i=ue.length;t<i;t++){var pe=ue[t];for(n=0;n<3;n++)b=pe[oe[n]],k=pe[oe[(n+1)%3]],ne[0]=Math.min(b,k),ne[1]=Math.max(b,k),U[F=ne[0]+","+ne[1]]===void 0&&(U[F]={index1:ne[0],index2:ne[1]})}for(F in U)g=U[F],K=e.vertices[g.index1],Q.push(K.x,K.y,K.z),K=e.vertices[g.index2],Q.push(K.x,K.y,K.z)}else if(e&&e.isBufferGeometry){var Te,Oe,Fe,Ze,Ge,et;if(K=new Se,e.index!==null){for(Te=e.attributes.position,Oe=e.index,(Fe=e.groups).length===0&&(Fe=[{start:0,count:Oe.count,materialIndex:0}]),l=0,h=Fe.length;l<h;++l)for(i=(t=(Ze=Fe[l]).start)+Ze.count;t<i;t+=3)for(n=0;n<3;n++)b=Oe.getX(t+n),k=Oe.getX(t+(n+1)%3),ne[0]=Math.min(b,k),ne[1]=Math.max(b,k),U[F=ne[0]+","+ne[1]]===void 0&&(U[F]={index1:ne[0],index2:ne[1]});for(F in U)g=U[F],K.fromBufferAttribute(Te,g.index1),Q.push(K.x,K.y,K.z),K.fromBufferAttribute(Te,g.index2),Q.push(K.x,K.y,K.z)}else for(t=0,i=(Te=e.attributes.position).count/3;t<i;t++)for(n=0;n<3;n++)Ge=3*t+n,K.fromBufferAttribute(Te,Ge),Q.push(K.x,K.y,K.z),et=3*t+(n+1)%3,K.fromBufferAttribute(Te,et),Q.push(K.x,K.y,K.z)}this.setAttribute("position",new ln(Q,3))}function Al(e,t,n){kn.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new ws(e,t,n)),this.mergeVertices()}function ws(e,t,n){X.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var i,l,h=[],g=[],b=[],k=[],F=new Se,K=new Se,Q=new Se,ne=new Se,U=new Se;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var oe=t+1;for(i=0;i<=n;i++){var ue=i/n;for(l=0;l<=t;l++){var pe=l/t;e(pe,ue,K),g.push(K.x,K.y,K.z),0<=pe-1e-5?(e(pe-1e-5,ue,Q),ne.subVectors(K,Q)):(e(1e-5+pe,ue,Q),ne.subVectors(Q,K)),0<=ue-1e-5?(e(pe,ue-1e-5,Q),U.subVectors(K,Q)):(e(pe,1e-5+ue,Q),U.subVectors(Q,K)),F.crossVectors(ne,U).normalize(),b.push(F.x,F.y,F.z),k.push(pe,ue)}}for(i=0;i<n;i++)for(l=0;l<t;l++){var Te=i*oe+l,Oe=i*oe+l+1,Fe=(i+1)*oe+l+1,Ze=(i+1)*oe+l;h.push(Te,Oe,Ze),h.push(Oe,Fe,Ze)}this.setIndex(h),this.setAttribute("position",new ln(g,3)),this.setAttribute("normal",new ln(b,3)),this.setAttribute("uv",new ln(k,2))}function ns(e,t,n,i){kn.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},this.fromBufferGeometry(new In(e,t,n,i)),this.mergeVertices()}function In(e,t,n,i){X.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},n=n||1;var l=[],h=[];function g(Q,ne,U,oe){var ue,pe,Te=Math.pow(2,oe),Oe=[];for(ue=0;ue<=Te;ue++){Oe[ue]=[];var Fe=Q.clone().lerp(U,ue/Te),Ze=ne.clone().lerp(U,ue/Te),Ge=Te-ue;for(pe=0;pe<=Ge;pe++)Oe[ue][pe]=pe===0&&ue===Te?Fe:Fe.clone().lerp(Ze,pe/Ge)}for(ue=0;ue<Te;ue++)for(pe=0;pe<2*(Te-ue)-1;pe++){var et=Math.floor(pe/2);pe%2==0?(b(Oe[ue][et+1]),b(Oe[ue+1][et]),b(Oe[ue][et])):(b(Oe[ue][et+1]),b(Oe[ue+1][et+1]),b(Oe[ue+1][et]))}}function b(Q){l.push(Q.x,Q.y,Q.z)}function k(Q,ne){var U=3*Q;ne.x=e[0+U],ne.y=e[1+U],ne.z=e[2+U]}function F(Q,ne,U,oe){oe<0&&Q.x===1&&(h[ne]=Q.x-1),U.x===0&&U.z===0&&(h[ne]=oe/2/Math.PI+.5)}function K(Q){return Math.atan2(Q.z,-Q.x)}(function(Q){for(var ne=new Se,U=new Se,oe=new Se,ue=0;ue<t.length;ue+=3)k(t[ue+0],ne),k(t[ue+1],U),k(t[ue+2],oe),g(ne,U,oe,Q)})(i=i||0),function(Q){for(var ne=new Se,U=0;U<l.length;U+=3)ne.x=l[U+0],ne.y=l[U+1],ne.z=l[U+2],ne.normalize().multiplyScalar(Q),l[U+0]=ne.x,l[U+1]=ne.y,l[U+2]=ne.z}(n),function(){for(var Q=new Se,ne=0;ne<l.length;ne+=3){Q.x=l[ne+0],Q.y=l[ne+1],Q.z=l[ne+2];var U=K(Q)/2/Math.PI+.5,oe=(ue=Q,Math.atan2(-ue.y,Math.sqrt(ue.x*ue.x+ue.z*ue.z))/Math.PI+.5);h.push(U,1-oe)}var ue;(function(){for(var pe=new Se,Te=new Se,Oe=new Se,Fe=new Se,Ze=new Ve,Ge=new Ve,et=new Ve,We=0,ft=0;We<l.length;We+=9,ft+=6){pe.set(l[We+0],l[We+1],l[We+2]),Te.set(l[We+3],l[We+4],l[We+5]),Oe.set(l[We+6],l[We+7],l[We+8]),Ze.set(h[ft+0],h[ft+1]),Ge.set(h[ft+2],h[ft+3]),et.set(h[ft+4],h[ft+5]),Fe.copy(pe).add(Te).add(Oe).divideScalar(3);var _t=K(Fe);F(Ze,ft+0,pe,_t),F(Ge,ft+2,Te,_t),F(et,ft+4,Oe,_t)}})(),function(){for(var pe=0;pe<h.length;pe+=6){var Te=h[pe+0],Oe=h[pe+2],Fe=h[pe+4],Ze=Math.max(Te,Oe,Fe),Ge=Math.min(Te,Oe,Fe);.9<Ze&&Ge<.1&&(Te<.2&&(h[pe+0]+=1),Oe<.2&&(h[pe+2]+=1),Fe<.2&&(h[pe+4]+=1))}}()}(),this.setAttribute("position",new ln(l,3)),this.setAttribute("normal",new ln(l.slice(),3)),this.setAttribute("uv",new ln(h,2)),i===0?this.computeVertexNormals():this.normalizeNormals()}function Zs(e,t){kn.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ks(e,t)),this.mergeVertices()}function Ks(e,t){In.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ko(e,t){kn.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new bs(e,t)),this.mergeVertices()}function bs(e,t){In.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function hc(e,t){kn.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ji(e,t)),this.mergeVertices()}function Ji(e,t){var n=(1+Math.sqrt(5))/2;In.call(this,[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function pc(e,t){kn.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Pl(e,t)),this.mergeVertices()}function Pl(e,t){var n=(1+Math.sqrt(5))/2,i=1/n;In.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function mu(e,t,n,i,l,h){kn.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:l},h!==void 0&&console.warn("THREE.TubeGeometry: taper has been removed.");var g=new Ka(e,t,n,i,l);this.tangents=g.tangents,this.normals=g.normals,this.binormals=g.binormals,this.fromBufferGeometry(g),this.mergeVertices()}function Ka(e,t,n,i,l){X.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:l},t=t||64,n=n||1,i=i||8,l=l||!1;var h=e.computeFrenetFrames(t,l);this.tangents=h.tangents,this.normals=h.normals,this.binormals=h.binormals;var g,b,k=new Se,F=new Se,K=new Ve,Q=new Se,ne=[],U=[],oe=[],ue=[];function pe(Te){Q=e.getPointAt(Te/t,Q);var Oe=h.normals[Te],Fe=h.binormals[Te];for(b=0;b<=i;b++){var Ze=b/i*Math.PI*2,Ge=Math.sin(Ze),et=-Math.cos(Ze);F.x=et*Oe.x+Ge*Fe.x,F.y=et*Oe.y+Ge*Fe.y,F.z=et*Oe.z+Ge*Fe.z,F.normalize(),U.push(F.x,F.y,F.z),k.x=Q.x+n*F.x,k.y=Q.y+n*F.y,k.z=Q.z+n*F.z,ne.push(k.x,k.y,k.z)}}(function(){for(g=0;g<t;g++)pe(g);pe(l===!1?t:0),function(){for(g=0;g<=t;g++)for(b=0;b<=i;b++)K.x=g/t,K.y=b/i,oe.push(K.x,K.y)}(),function(){for(b=1;b<=t;b++)for(g=1;g<=i;g++){var Te=(i+1)*(b-1)+(g-1),Oe=(i+1)*b+(g-1),Fe=(i+1)*b+g,Ze=(i+1)*(b-1)+g;ue.push(Te,Oe,Ze),ue.push(Oe,Fe,Ze)}}()})(),this.setIndex(ue),this.setAttribute("position",new ln(ne,3)),this.setAttribute("normal",new ln(U,3)),this.setAttribute("uv",new ln(oe,2))}function sa(e,t,n,i,l,h,g){kn.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:l,q:h},g!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new $s(e,t,n,i,l,h)),this.mergeVertices()}function $s(e,t,n,i,l,h){X.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:l,q:h},e=e||1,t=t||.4,n=Math.floor(n)||64,i=Math.floor(i)||8,l=l||2,h=h||3;var g,b,k=[],F=[],K=[],Q=[],ne=new Se,U=new Se,oe=new Se,ue=new Se,pe=new Se,Te=new Se,Oe=new Se;for(g=0;g<=n;++g){var Fe=g/n*l*Math.PI*2;for(At(Fe,l,h,e,oe),At(.01+Fe,l,h,e,ue),Te.subVectors(ue,oe),Oe.addVectors(ue,oe),pe.crossVectors(Te,Oe),Oe.crossVectors(pe,Te),pe.normalize(),Oe.normalize(),b=0;b<=i;++b){var Ze=b/i*Math.PI*2,Ge=-t*Math.cos(Ze),et=t*Math.sin(Ze);ne.x=oe.x+(Ge*Oe.x+et*pe.x),ne.y=oe.y+(Ge*Oe.y+et*pe.y),ne.z=oe.z+(Ge*Oe.z+et*pe.z),F.push(ne.x,ne.y,ne.z),U.subVectors(ne,oe).normalize(),K.push(U.x,U.y,U.z),Q.push(g/n),Q.push(b/i)}}for(b=1;b<=n;b++)for(g=1;g<=i;g++){var We=(i+1)*(b-1)+(g-1),ft=(i+1)*b+(g-1),_t=(i+1)*b+g,Et=(i+1)*(b-1)+g;k.push(We,ft,Et),k.push(ft,_t,Et)}function At(Nt,Xt,Tt,wt,sn){var gn=Math.cos(Nt),Jn=Math.sin(Nt),Gn=Tt/Xt*Nt,Nn=Math.cos(Gn);sn.x=wt*(2+Nn)*.5*gn,sn.y=wt*(2+Nn)*Jn*.5,sn.z=wt*Math.sin(Gn)*.5}this.setIndex(k),this.setAttribute("position",new ln(F,3)),this.setAttribute("normal",new ln(K,3)),this.setAttribute("uv",new ln(Q,2))}function Ol(e,t,n,i,l){kn.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:l},this.fromBufferGeometry(new dc(e,t,n,i,l)),this.mergeVertices()}function dc(e,t,n,i,l){X.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:l},e=e||1,t=t||.4,n=Math.floor(n)||8,i=Math.floor(i)||6,l=l||2*Math.PI;var h,g,b=[],k=[],F=[],K=[],Q=new Se,ne=new Se,U=new Se;for(h=0;h<=n;h++)for(g=0;g<=i;g++){var oe=g/i*l,ue=h/n*Math.PI*2;ne.x=(e+t*Math.cos(ue))*Math.cos(oe),ne.y=(e+t*Math.cos(ue))*Math.sin(oe),ne.z=t*Math.sin(ue),k.push(ne.x,ne.y,ne.z),Q.x=e*Math.cos(oe),Q.y=e*Math.sin(oe),U.subVectors(ne,Q).normalize(),F.push(U.x,U.y,U.z),K.push(g/i),K.push(h/n)}for(h=1;h<=n;h++)for(g=1;g<=i;g++){var pe=(i+1)*h+g-1,Te=(i+1)*(h-1)+g-1,Oe=(i+1)*(h-1)+g,Fe=(i+1)*h+g;b.push(pe,Te,Fe),b.push(Te,Oe,Fe)}this.setIndex(b),this.setAttribute("position",new ln(k,3)),this.setAttribute("normal",new ln(F,3)),this.setAttribute("uv",new ln(K,2))}function Rl(e,t,n,i,l){var h,g;if(l===0<function(b,k,F,K){for(var Q=0,ne=k,U=F-K;ne<F;ne+=K)Q+=(b[U]-b[ne])*(b[ne+1]+b[U+1]),U=ne;return Q}(e,t,n,i))for(h=t;h<n;h+=i)g=Kh(h,e[h],e[h+1],g);else for(h=n-i;t<=h;h-=i)g=Kh(h,e[h],e[h+1],g);return g&&_a(g,g.next)&&(mc(g),g=g.next),g}function Ll(e,t){if(!e)return e;t=t||e;var n,i=e;do if(n=!1,i.steiner||!_a(i,i.next)&&la(i.prev,i,i.next)!==0)i=i.next;else{if(mc(i),(i=t=i.prev)===i.next)break;n=!0}while(n||i!==t);return t}function Il(e,t,n,i,l,h,g){if(e){!g&&h&&function(K,Q,ne,U){for(var oe=K;oe.z===null&&(oe.z=gu(oe.x,oe.y,Q,ne,U)),oe.prevZ=oe.prev,oe.nextZ=oe.next,(oe=oe.next)!==K;);oe.prevZ.nextZ=null,oe.prevZ=null,function(ue){var pe,Te,Oe,Fe,Ze,Ge,et,We,ft=1;do{for(Te=ue,Ze=ue=null,Ge=0;Te;){for(Ge++,Oe=Te,pe=et=0;pe<ft&&(et++,Oe=Oe.nextZ);pe++);for(We=ft;0<et||0<We&&Oe;)et!==0&&(We===0||!Oe||Te.z<=Oe.z)?(Te=(Fe=Te).nextZ,et--):(Oe=(Fe=Oe).nextZ,We--),Ze?Ze.nextZ=Fe:ue=Fe,Fe.prevZ=Ze,Ze=Fe;Te=Oe}Ze.nextZ=null,ft*=2}while(1<Ge)}(oe)}(e,i,l,h);for(var b,k,F=e;e.prev!==e.next;)if(b=e.prev,k=e.next,h?qh(e,i,l,h):Jh(e))t.push(b.i/n),t.push(e.i/n),t.push(k.i/n),mc(e),e=k.next,F=k.next;else if((e=k)===F){g?g===1?Il(e=hh(e,t,n),t,n,i,l,h,2):g===2&&Xh(e,t,n,i,l,h):Il(Ll(e),t,n,i,l,h,1);break}}}function Jh(e){var t=e.prev,n=e,i=e.next;if(!(0<=la(t,n,i))){for(var l=e.next.next;l!==e.prev;){if(rs(t.x,t.y,n.x,n.y,i.x,i.y,l.x,l.y)&&0<=la(l.prev,l,l.next))return;l=l.next}return 1}}function qh(e,t,n,i){var l=e.prev,h=e,g=e.next;if(!(0<=la(l,h,g))){for(var b=l.x<h.x?l.x<g.x?l.x:g.x:h.x<g.x?h.x:g.x,k=l.y<h.y?l.y<g.y?l.y:g.y:h.y<g.y?h.y:g.y,F=l.x>h.x?l.x>g.x?l.x:g.x:h.x>g.x?h.x:g.x,K=l.y>h.y?l.y>g.y?l.y:g.y:h.y>g.y?h.y:g.y,Q=gu(b,k,t,n,i),ne=gu(F,K,t,n,i),U=e.prevZ,oe=e.nextZ;U&&U.z>=Q&&oe&&oe.z<=ne;){if(U!==e.prev&&U!==e.next&&rs(l.x,l.y,h.x,h.y,g.x,g.y,U.x,U.y)&&0<=la(U.prev,U,U.next)||(U=U.prevZ,oe!==e.prev&&oe!==e.next&&rs(l.x,l.y,h.x,h.y,g.x,g.y,oe.x,oe.y)&&0<=la(oe.prev,oe,oe.next)))return;oe=oe.nextZ}for(;U&&U.z>=Q;){if(U!==e.prev&&U!==e.next&&rs(l.x,l.y,h.x,h.y,g.x,g.y,U.x,U.y)&&0<=la(U.prev,U,U.next))return;U=U.prevZ}for(;oe&&oe.z<=ne;){if(oe!==e.prev&&oe!==e.next&&rs(l.x,l.y,h.x,h.y,g.x,g.y,oe.x,oe.y)&&0<=la(oe.prev,oe,oe.next))return;oe=oe.nextZ}return 1}}function hh(e,t,n){var i=e;do{var l=i.prev,h=i.next.next;!_a(l,h)&&Ms(l,i,i.next,h)&&kl(l,h)&&kl(h,l)&&(t.push(l.i/n),t.push(i.i/n),t.push(h.i/n),mc(i),mc(i.next),i=e=h),i=i.next}while(i!==e);return i}function Xh(e,t,n,i,l,h){var g,b,k=e;do{for(var F=k.next.next;F!==k.prev;){if(k.i!==F.i&&(b=F,(g=k).next.i!==b.i&&g.prev.i!==b.i&&!function(Q,ne){var U=Q;do{if(U.i!==Q.i&&U.next.i!==Q.i&&U.i!==ne.i&&U.next.i!==ne.i&&Ms(U,U.next,Q,ne))return 1;U=U.next}while(U!==Q)}(g,b)&&kl(g,b)&&kl(b,g)&&function(Q,ne){for(var U=Q,oe=!1,ue=(Q.x+ne.x)/2,pe=(Q.y+ne.y)/2;U.y>pe!=U.next.y>pe&&U.next.y!==U.y&&ue<(U.next.x-U.x)*(pe-U.y)/(U.next.y-U.y)+U.x&&(oe=!oe),(U=U.next)!==Q;);return oe}(g,b))){var K=Zh(k,F);return k=Ll(k,k.next),K=Ll(K,K.next),Il(k,t,n,i,l,h),void Il(K,t,n,i,l,h)}F=F.next}k=k.next}while(k!==e)}function fc(e,t){return e.x-t.x}function ph(e,t){if(t=function(i,l){var h,g=l,b=i.x,k=i.y,F=-1/0;do{if(k<=g.y&&k>=g.next.y&&g.next.y!==g.y){var K=g.x+(k-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(K<=b&&F<K){if((F=K)===b){if(k===g.y)return g;if(k===g.next.y)return g.next}h=g.x<g.next.x?g:g.next}}g=g.next}while(g!==l);if(!h)return null;if(b===F)return h.prev;var Q,ne=h,U=h.x,oe=h.y,ue=1/0;for(g=h.next;g!==ne;)b>=g.x&&g.x>=U&&b!==g.x&&rs(k<oe?b:F,k,U,oe,k<oe?F:b,k,g.x,g.y)&&((Q=Math.abs(k-g.y)/(b-g.x))<ue||Q===ue&&g.x>h.x)&&kl(g,i)&&(h=g,ue=Q),g=g.next;return h}(e,t)){var n=Zh(t,e);Ll(n,n.next)}}function gu(e,t,n,i,l){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*l)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*l)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Yh(e){for(var t=e,n=e;(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),(t=t.next)!==e;);return n}function rs(e,t,n,i,l,h,g,b){return 0<=(l-g)*(t-b)-(e-g)*(h-b)&&0<=(e-g)*(i-b)-(n-g)*(t-b)&&0<=(n-g)*(h-b)-(l-g)*(i-b)}function la(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function _a(e,t){return e.x===t.x&&e.y===t.y}function Ms(e,t,n,i){return _a(e,n)&&_a(t,i)||_a(e,i)&&_a(n,t)||0<la(e,t,n)!=0<la(e,t,i)&&0<la(n,i,e)!=0<la(n,i,t)}function kl(e,t){return la(e.prev,e,e.next)<0?0<=la(e,t,e.next)&&0<=la(e,e.prev,t):la(e,t,e.prev)<0||la(e,e.next,t)<0}function Zh(e,t){var n=new yu(e.i,e.x,e.y),i=new yu(t.i,t.x,t.y),l=e.next,h=t.prev;return(e.next=t).prev=e,(n.next=l).prev=n,(i.next=n).prev=i,(h.next=i).prev=h,i}function Kh(e,t,n,i){var l=new yu(e,t,n);return i?(l.next=i.next,(l.prev=i).next.prev=l,i.next=l):(l.prev=l).next=l,l}function mc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function yu(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}Xs.prototype=Object.assign(Object.create(mn.prototype),{constructor:Xs,isPoints:!0,raycast:function(e,t){var n=this.geometry,i=this.matrixWorld,l=e.params.Points.threshold;if(n.boundingSphere===null&&n.computeBoundingSphere(),lc.copy(n.boundingSphere),lc.applyMatrix4(i),lc.radius+=l,e.ray.intersectsSphere(lc)!==!1){du.getInverse(i),ch.copy(e.ray).applyMatrix4(du);var h=l/((this.scale.x+this.scale.y+this.scale.z)/3),g=h*h;if(n.isBufferGeometry){var b=n.index,k=n.attributes.position.array;if(b!==null)for(var F=b.array,K=0,Q=F.length;K<Q;K++){var ne=F[K];ho.fromArray(k,3*ne),fu(ho,ne,g,i,e,t,this)}else{K=0;for(var U=k.length/3;K<U;K++)ho.fromArray(k,3*K),fu(ho,K,g,i,e,t,this)}}else{var oe=n.vertices;for(K=0,U=oe.length;K<U;K++)fu(oe[K],K,g,i,e,t,this)}}},updateMorphTargets:function(){var e,t,n,i=this.geometry;if(i.isBufferGeometry){var l=i.morphAttributes,h=Object.keys(l);if(0<h.length){var g=l[h[0]];if(g!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=g.length;e<t;e++)n=g[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var b=i.morphTargets;b!==void 0&&0<b.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),uh.prototype=Object.assign(Object.create(nn.prototype),{constructor:uh,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),((cc.prototype=Object.create(nn.prototype)).constructor=cc).prototype.isCompressedTexture=!0,((wo.prototype=Object.create(nn.prototype)).constructor=wo).prototype.isCanvasTexture=!0,((uc.prototype=Object.create(nn.prototype)).constructor=uc).prototype.isDepthTexture=!0,(Ys.prototype=Object.create(X.prototype)).constructor=Ys,(Al.prototype=Object.create(kn.prototype)).constructor=Al,(ws.prototype=Object.create(X.prototype)).constructor=ws,(ns.prototype=Object.create(kn.prototype)).constructor=ns,(In.prototype=Object.create(X.prototype)).constructor=In,(Zs.prototype=Object.create(kn.prototype)).constructor=Zs,(Ks.prototype=Object.create(In.prototype)).constructor=Ks,(ko.prototype=Object.create(kn.prototype)).constructor=ko,(bs.prototype=Object.create(In.prototype)).constructor=bs,(hc.prototype=Object.create(kn.prototype)).constructor=hc,(Ji.prototype=Object.create(In.prototype)).constructor=Ji,(pc.prototype=Object.create(kn.prototype)).constructor=pc,(Pl.prototype=Object.create(In.prototype)).constructor=Pl,(mu.prototype=Object.create(kn.prototype)).constructor=mu,((Ka.prototype=Object.create(X.prototype)).constructor=Ka).prototype.toJSON=function(){var e=X.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},(sa.prototype=Object.create(kn.prototype)).constructor=sa,($s.prototype=Object.create(X.prototype)).constructor=$s,(Ol.prototype=Object.create(kn.prototype)).constructor=Ol,(dc.prototype=Object.create(X.prototype)).constructor=dc;var jo={area:function(e){for(var t=e.length,n=0,i=t-1,l=0;l<t;i=l++)n+=e[i].x*e[l].y-e[l].x*e[i].y;return .5*n},isClockWise:function(e){return jo.area(e)<0},triangulateShape:function(e,t){var n=[],i=[],l=[];dh(e),fh(n,e);var h=e.length;t.forEach(dh);for(var g=0;g<t.length;g++)i.push(h),h+=t[g].length,fh(n,t[g]);var b=function(k,F,K){K=K||2;var Q,ne,U,oe,ue,pe,Te,Oe=F&&F.length,Fe=Oe?F[0]*K:k.length,Ze=Rl(k,0,Fe,K,!0),Ge=[];if(!Ze||Ze.next===Ze.prev)return Ge;if(Oe&&(Ze=function(We,ft,_t,Et){var At,Nt,Xt,Tt=[];for(At=0,Nt=ft.length;At<Nt;At++)(Xt=Rl(We,ft[At]*Et,At<Nt-1?ft[At+1]*Et:We.length,Et,!1))===Xt.next&&(Xt.steiner=!0),Tt.push(Yh(Xt));for(Tt.sort(fc),At=0;At<Tt.length;At++)ph(Tt[At],_t),_t=Ll(_t,_t.next);return _t}(k,F,Ze,K)),k.length>80*K){Q=U=k[0],ne=oe=k[1];for(var et=K;et<Fe;et+=K)(ue=k[et])<Q&&(Q=ue),(pe=k[et+1])<ne&&(ne=pe),U<ue&&(U=ue),oe<pe&&(oe=pe);Te=(Te=Math.max(U-Q,oe-ne))!==0?1/Te:0}return Il(Ze,Ge,K,Q,ne,Te),Ge}(n,i);for(g=0;g<b.length;g+=3)l.push(b.slice(g,g+3));return l}};function dh(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function fh(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function gc(e,t){kn.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new _s(e,t)),this.mergeVertices()}function _s(e,t){X.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t};for(var n=this,i=[],l=[],h=0,g=(e=Array.isArray(e)?e:[e]).length;h<g;h++)b(e[h]);function b(k){var F=[],K=t.curveSegments!==void 0?t.curveSegments:12,Q=t.steps!==void 0?t.steps:1,ne=t.depth!==void 0?t.depth:100,U=t.bevelEnabled===void 0||t.bevelEnabled,oe=t.bevelThickness!==void 0?t.bevelThickness:6,ue=t.bevelSize!==void 0?t.bevelSize:oe-2,pe=t.bevelOffset!==void 0?t.bevelOffset:0,Te=t.bevelSegments!==void 0?t.bevelSegments:3,Oe=t.extrudePath,Fe=t.UVGenerator!==void 0?t.UVGenerator:mp;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),ne=t.amount);var Ze,Ge,et,We,ft,_t,Et,At,Nt=!1;Oe&&(Ze=Oe.getSpacedPoints(Q),U=!(Nt=!0),Ge=Oe.computeFrenetFrames(Q,!1),et=new Se,We=new Se,ft=new Se),U||(pe=ue=oe=Te=0);var Xt=k.extractPoints(K),Tt=Xt.shape,wt=Xt.holes;if(!jo.isClockWise(Tt))for(Tt=Tt.reverse(),Et=0,At=wt.length;Et<At;Et++)_t=wt[Et],jo.isClockWise(_t)&&(wt[Et]=_t.reverse());var sn=jo.triangulateShape(Tt,wt),gn=Tt;for(Et=0,At=wt.length;Et<At;Et++)_t=wt[Et],Tt=Tt.concat(_t);function Jn(Er,ii,mi){return ii||console.error("THREE.ExtrudeGeometry: vec does not exist"),ii.clone().multiplyScalar(mi).add(Er)}var Gn,Nn,sr,Tn,je,nt,Jt=Tt.length,zt=sn.length;function Qn(Er,ii,mi){var na,Xr,Xi,Ha=Er.x-ii.x,no=Er.y-ii.y,us=mi.x-Er.x,Is=mi.y-Er.y,Fu=Ha*Ha+no*no,Lp=Ha*Is-no*us;if(Math.abs(Lp)>Number.EPSILON){var Bu=Math.sqrt(Fu),Kc=Math.sqrt(us*us+Is*Is),$c=ii.x-no/Bu,Qc=ii.y+Ha/Bu,eu=((mi.x-Is/Kc-$c)*Is-(mi.y+us/Kc-Qc)*us)/(Ha*Is-no*us),Rh=(na=$c+Ha*eu-Er.x)*na+(Xr=Qc+no*eu-Er.y)*Xr;if(Rh<=2)return new Ve(na,Xr);Xi=Math.sqrt(Rh/2)}else{var po=!1;Ha>Number.EPSILON?us>Number.EPSILON&&(po=!0):Ha<-Number.EPSILON?us<-Number.EPSILON&&(po=!0):Math.sign(no)===Math.sign(Is)&&(po=!0),Xi=po?(na=-no,Xr=Ha,Math.sqrt(Fu)):(na=Ha,Xr=no,Math.sqrt(Fu/2))}return new Ve(na/Xi,Xr/Xi)}for(var Sn=[],Ct=0,An=gn.length,lr=An-1,pt=Ct+1;Ct<An;Ct++,lr++,pt++)lr===An&&(lr=0),pt===An&&(pt=0),Sn[Ct]=Qn(gn[Ct],gn[lr],gn[pt]);var yn,vn,tr=[],an=Sn.concat();for(Et=0,At=wt.length;Et<At;Et++){for(_t=wt[Et],yn=[],Ct=0,lr=(An=_t.length)-1,pt=Ct+1;Ct<An;Ct++,lr++,pt++)lr===An&&(lr=0),pt===An&&(pt=0),yn[Ct]=Qn(_t[Ct],_t[lr],_t[pt]);tr.push(yn),an=an.concat(yn)}for(Gn=0;Gn<Te;Gn++){for(sr=Gn/Te,Tn=oe*Math.cos(sr*Math.PI/2),Nn=ue*Math.sin(sr*Math.PI/2)+pe,Ct=0,An=gn.length;Ct<An;Ct++)Tr((je=Jn(gn[Ct],Sn[Ct],Nn)).x,je.y,-Tn);for(Et=0,At=wt.length;Et<At;Et++)for(_t=wt[Et],yn=tr[Et],Ct=0,An=_t.length;Ct<An;Ct++)Tr((je=Jn(_t[Ct],yn[Ct],Nn)).x,je.y,-Tn)}for(Nn=ue+pe,Ct=0;Ct<Jt;Ct++)je=U?Jn(Tt[Ct],an[Ct],Nn):Tt[Ct],Nt?(We.copy(Ge.normals[0]).multiplyScalar(je.x),et.copy(Ge.binormals[0]).multiplyScalar(je.y),ft.copy(Ze[0]).add(We).add(et),Tr(ft.x,ft.y,ft.z)):Tr(je.x,je.y,0);for(vn=1;vn<=Q;vn++)for(Ct=0;Ct<Jt;Ct++)je=U?Jn(Tt[Ct],an[Ct],Nn):Tt[Ct],Nt?(We.copy(Ge.normals[vn]).multiplyScalar(je.x),et.copy(Ge.binormals[vn]).multiplyScalar(je.y),ft.copy(Ze[vn]).add(We).add(et),Tr(ft.x,ft.y,ft.z)):Tr(je.x,je.y,ne/Q*vn);for(Gn=Te-1;0<=Gn;Gn--){for(sr=Gn/Te,Tn=oe*Math.cos(sr*Math.PI/2),Nn=ue*Math.sin(sr*Math.PI/2)+pe,Ct=0,An=gn.length;Ct<An;Ct++)Tr((je=Jn(gn[Ct],Sn[Ct],Nn)).x,je.y,ne+Tn);for(Et=0,At=wt.length;Et<At;Et++)for(_t=wt[Et],yn=tr[Et],Ct=0,An=_t.length;Ct<An;Ct++)je=Jn(_t[Ct],yn[Ct],Nn),Nt?Tr(je.x,je.y+Ze[Q-1].y,Ze[Q-1].x+Tn):Tr(je.x,je.y,ne+Tn)}function gr(Er,ii){var mi,na;for(Ct=Er.length;0<=--Ct;){(na=(mi=Ct)-1)<0&&(na=Er.length-1);var Xr=0,Xi=Q+2*Te;for(Xr=0;Xr<Xi;Xr++){var Ha=Jt*Xr,no=Jt*(Xr+1);to(ii+mi+Ha,ii+na+Ha,ii+na+no,ii+mi+no)}}}function Tr(Er,ii,mi){F.push(Er),F.push(ii),F.push(mi)}function fi(Er,ii,mi){Ir(Er),Ir(ii),Ir(mi);var na=i.length/3,Xr=Fe.generateTopUV(n,i,na-3,na-2,na-1);Ti(Xr[0]),Ti(Xr[1]),Ti(Xr[2])}function to(Er,ii,mi,na){Ir(Er),Ir(ii),Ir(na),Ir(ii),Ir(mi),Ir(na);var Xr=i.length/3,Xi=Fe.generateSideWallUV(n,i,Xr-6,Xr-3,Xr-2,Xr-1);Ti(Xi[0]),Ti(Xi[1]),Ti(Xi[3]),Ti(Xi[1]),Ti(Xi[2]),Ti(Xi[3])}function Ir(Er){i.push(F[3*Er+0]),i.push(F[3*Er+1]),i.push(F[3*Er+2])}function Ti(Er){l.push(Er.x),l.push(Er.y)}(function(){var Er=i.length/3;if(U){var ii=0,mi=Jt*ii;for(Ct=0;Ct<zt;Ct++)fi((nt=sn[Ct])[2]+mi,nt[1]+mi,nt[0]+mi);for(mi=Jt*(ii=Q+2*Te),Ct=0;Ct<zt;Ct++)fi((nt=sn[Ct])[0]+mi,nt[1]+mi,nt[2]+mi)}else{for(Ct=0;Ct<zt;Ct++)fi((nt=sn[Ct])[2],nt[1],nt[0]);for(Ct=0;Ct<zt;Ct++)fi((nt=sn[Ct])[0]+Jt*Q,nt[1]+Jt*Q,nt[2]+Jt*Q)}n.addGroup(Er,i.length/3-Er,0)})(),function(){var Er=i.length/3,ii=0;for(gr(gn,ii),ii+=gn.length,Et=0,At=wt.length;Et<At;Et++)gr(_t=wt[Et],ii),ii+=_t.length;n.addGroup(Er,i.length/3-Er,1)}()}this.setAttribute("position",new ln(i,3)),this.setAttribute("uv",new ln(l,2)),this.computeVertexNormals()}((gc.prototype=Object.create(kn.prototype)).constructor=gc).prototype.toJSON=function(){var e=kn.prototype.toJSON.call(this);return $a(this.parameters.shapes,this.parameters.options,e)},((_s.prototype=Object.create(X.prototype)).constructor=_s).prototype.toJSON=function(){var e=X.prototype.toJSON.call(this);return $a(this.parameters.shapes,this.parameters.options,e)};var mp={generateTopUV:function(e,t,n,i,l){var h=t[3*n],g=t[3*n+1],b=t[3*i],k=t[3*i+1],F=t[3*l],K=t[3*l+1];return[new Ve(h,g),new Ve(b,k),new Ve(F,K)]},generateSideWallUV:function(e,t,n,i,l,h){var g=t[3*n],b=t[3*n+1],k=t[3*n+2],F=t[3*i],K=t[3*i+1],Q=t[3*i+2],ne=t[3*l],U=t[3*l+1],oe=t[3*l+2],ue=t[3*h],pe=t[3*h+1],Te=t[3*h+2];return Math.abs(b-K)<.01?[new Ve(g,1-k),new Ve(F,1-Q),new Ve(ne,1-oe),new Ve(ue,1-Te)]:[new Ve(b,1-k),new Ve(K,1-Q),new Ve(U,1-oe),new Ve(pe,1-Te)]}};function $a(e,t,n){if(n.shapes=[],Array.isArray(e))for(var i=0,l=e.length;i<l;i++){var h=e[i];n.shapes.push(h.uuid)}else n.shapes.push(e.uuid);return t.extrudePath!==void 0&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function vu(e,t){kn.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new jl(e,t)),this.mergeVertices()}function jl(e,t){var n=(t=t||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new kn;var i=n.generateShapes(e,t.size);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),_s.call(this,i,t),this.type="TextBufferGeometry"}function xu(e,t,n,i,l,h,g){kn.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:l,thetaStart:h,thetaLength:g},this.fromBufferGeometry(new Ts(e,t,n,i,l,h,g)),this.mergeVertices()}function Ts(e,t,n,i,l,h,g){X.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:l,thetaStart:h,thetaLength:g},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=i!==void 0?i:0,l=l!==void 0?l:2*Math.PI,h=h!==void 0?h:0,g=g!==void 0?g:Math.PI;var b,k,F=Math.min(h+g,Math.PI),K=0,Q=[],ne=new Se,U=new Se,oe=[],ue=[],pe=[],Te=[];for(k=0;k<=n;k++){var Oe=[],Fe=k/n,Ze=0;for(k==0&&h==0?Ze=.5/t:k==n&&F==Math.PI&&(Ze=-.5/t),b=0;b<=t;b++){var Ge=b/t;ne.x=-e*Math.cos(i+Ge*l)*Math.sin(h+Fe*g),ne.y=e*Math.cos(h+Fe*g),ne.z=e*Math.sin(i+Ge*l)*Math.sin(h+Fe*g),ue.push(ne.x,ne.y,ne.z),U.copy(ne).normalize(),pe.push(U.x,U.y,U.z),Te.push(Ge+Ze,1-Fe),Oe.push(K++)}Q.push(Oe)}for(k=0;k<n;k++)for(b=0;b<t;b++){var et=Q[k][b+1],We=Q[k][b],ft=Q[k+1][b],_t=Q[k+1][b+1];(k!==0||0<h)&&oe.push(et,We,_t),(k!==n-1||F<Math.PI)&&oe.push(We,ft,_t)}this.setIndex(oe),this.setAttribute("position",new ln(ue,3)),this.setAttribute("normal",new ln(pe,3)),this.setAttribute("uv",new ln(Te,2))}function wu(e,t,n,i,l,h){kn.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:l,thetaLength:h},this.fromBufferGeometry(new yc(e,t,n,i,l,h)),this.mergeVertices()}function yc(e,t,n,i,l,h){X.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:l,thetaLength:h},e=e||.5,t=t||1,l=l!==void 0?l:0,h=h!==void 0?h:2*Math.PI,n=n!==void 0?Math.max(3,n):8;var g,b,k,F=[],K=[],Q=[],ne=[],U=e,oe=(t-e)/(i=i!==void 0?Math.max(1,i):1),ue=new Se,pe=new Ve;for(b=0;b<=i;b++){for(k=0;k<=n;k++)g=l+k/n*h,ue.x=U*Math.cos(g),ue.y=U*Math.sin(g),K.push(ue.x,ue.y,ue.z),Q.push(0,0,1),pe.x=(ue.x/t+1)/2,pe.y=(ue.y/t+1)/2,ne.push(pe.x,pe.y);U+=oe}for(b=0;b<i;b++){var Te=b*(n+1);for(k=0;k<n;k++){var Oe=g=k+Te,Fe=g+n+1,Ze=g+n+2,Ge=g+1;F.push(Oe,Fe,Ge),F.push(Fe,Ze,Ge)}}this.setIndex(F),this.setAttribute("position",new ln(K,3)),this.setAttribute("normal",new ln(Q,3)),this.setAttribute("uv",new ln(ne,2))}function bu(e,t,n,i){kn.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},this.fromBufferGeometry(new Qs(e,t,n,i)),this.mergeVertices()}function Qs(e,t,n,i){X.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t)||12,n=n||0,i=i||2*Math.PI,i=Qt.clamp(i,0,2*Math.PI);var l,h,g,b=[],k=[],F=[],K=1/t,Q=new Se,ne=new Ve;for(h=0;h<=t;h++){var U=n+h*K*i,oe=Math.sin(U),ue=Math.cos(U);for(g=0;g<=e.length-1;g++)Q.x=e[g].x*oe,Q.y=e[g].y,Q.z=e[g].x*ue,k.push(Q.x,Q.y,Q.z),ne.x=h/t,ne.y=g/(e.length-1),F.push(ne.x,ne.y)}for(h=0;h<t;h++)for(g=0;g<e.length-1;g++){var pe=l=g+h*e.length,Te=l+e.length,Oe=l+e.length+1,Fe=l+1;b.push(pe,Te,Fe),b.push(Te,Oe,Fe)}if(this.setIndex(b),this.setAttribute("position",new ln(k,3)),this.setAttribute("uv",new ln(F,2)),this.computeVertexNormals(),i===2*Math.PI){var Ze=this.attributes.normal.array,Ge=new Se,et=new Se,We=new Se;for(l=t*e.length*3,g=h=0;h<e.length;h++,g+=3)Ge.x=Ze[g+0],Ge.y=Ze[g+1],Ge.z=Ze[g+2],et.x=Ze[l+g+0],et.y=Ze[l+g+1],et.z=Ze[l+g+2],We.addVectors(Ge,et).normalize(),Ze[g+0]=Ze[l+g+0]=We.x,Ze[g+1]=Ze[l+g+1]=We.y,Ze[g+2]=Ze[l+g+2]=We.z}}function Nl(e,t){kn.call(this),this.type="ShapeGeometry",typeof t=="object"&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new vc(e,t)),this.mergeVertices()}function vc(e,t){X.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var n=[],i=[],l=[],h=[],g=0,b=0;if(Array.isArray(e)===!1)F(e);else for(var k=0;k<e.length;k++)F(e[k]),this.addGroup(g,b,k),g+=b,b=0;function F(K){var Q,ne,U,oe=i.length/3,ue=K.extractPoints(t),pe=ue.shape,Te=ue.holes;for(jo.isClockWise(pe)===!1&&(pe=pe.reverse()),Q=0,ne=Te.length;Q<ne;Q++)U=Te[Q],jo.isClockWise(U)===!0&&(Te[Q]=U.reverse());var Oe=jo.triangulateShape(pe,Te);for(Q=0,ne=Te.length;Q<ne;Q++)U=Te[Q],pe=pe.concat(U);for(Q=0,ne=pe.length;Q<ne;Q++){var Fe=pe[Q];i.push(Fe.x,Fe.y,0),l.push(0,0,1),h.push(Fe.x,Fe.y)}for(Q=0,ne=Oe.length;Q<ne;Q++){var Ze=Oe[Q],Ge=Ze[0]+oe,et=Ze[1]+oe,We=Ze[2]+oe;n.push(Ge,et,We),b+=3}}this.setIndex(n),this.setAttribute("position",new ln(i,3)),this.setAttribute("normal",new ln(l,3)),this.setAttribute("uv",new ln(h,2))}function $h(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var l=e[n];t.shapes.push(l.uuid)}else t.shapes.push(e.uuid);return t}function xc(e,t){X.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=t!==void 0?t:1;var n,i,l,h,g=[],b=Math.cos(Qt.DEG2RAD*t),k=[0,0],F={},K=["a","b","c"];e.isBufferGeometry?(h=new kn).fromBufferGeometry(e):h=e.clone(),h.mergeVertices(),h.computeFaceNormals();for(var Q=h.vertices,ne=h.faces,U=0,oe=ne.length;U<oe;U++)for(var ue=ne[U],pe=0;pe<3;pe++)n=ue[K[pe]],i=ue[K[(pe+1)%3]],k[0]=Math.min(n,i),k[1]=Math.max(n,i),F[l=k[0]+","+k[1]]===void 0?F[l]={index1:k[0],index2:k[1],face1:U,face2:void 0}:F[l].face2=U;for(l in F){var Te=F[l];if(Te.face2===void 0||ne[Te.face1].normal.dot(ne[Te.face2].normal)<=b){var Oe=Q[Te.index1];g.push(Oe.x,Oe.y,Oe.z),Oe=Q[Te.index2],g.push(Oe.x,Oe.y,Oe.z)}}this.setAttribute("position",new ln(g,3))}function Vl(e,t,n,i,l,h,g,b){kn.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:l,openEnded:h,thetaStart:g,thetaLength:b},this.fromBufferGeometry(new Cs(e,t,n,i,l,h,g,b)),this.mergeVertices()}function Cs(e,t,n,i,l,h,g,b){X.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:l,openEnded:h,thetaStart:g,thetaLength:b};var k=this;e=e!==void 0?e:1,t=t!==void 0?t:1,n=n||1,i=Math.floor(i)||8,l=Math.floor(l)||1,h=h!==void 0&&h,g=g!==void 0?g:0,b=b!==void 0?b:2*Math.PI;var F=[],K=[],Q=[],ne=[],U=0,oe=[],ue=n/2,pe=0;function Te(Oe){var Fe,Ze,Ge,et=new Ve,We=new Se,ft=0,_t=Oe===!0?e:t,Et=Oe===!0?1:-1;for(Ze=U,Fe=1;Fe<=i;Fe++)K.push(0,ue*Et,0),Q.push(0,Et,0),ne.push(.5,.5),U++;for(Ge=U,Fe=0;Fe<=i;Fe++){var At=Fe/i*b+g,Nt=Math.cos(At),Xt=Math.sin(At);We.x=_t*Xt,We.y=ue*Et,We.z=_t*Nt,K.push(We.x,We.y,We.z),Q.push(0,Et,0),et.x=.5*Nt+.5,et.y=.5*Xt*Et+.5,ne.push(et.x,et.y),U++}for(Fe=0;Fe<i;Fe++){var Tt=Ze+Fe,wt=Ge+Fe;Oe===!0?F.push(wt,wt+1,Tt):F.push(wt+1,wt,Tt),ft+=3}k.addGroup(pe,ft,Oe===!0?1:2),pe+=ft}(function(){var Oe,Fe,Ze=new Se,Ge=new Se,et=0,We=(t-e)/n;for(Fe=0;Fe<=l;Fe++){var ft=[],_t=Fe/l,Et=_t*(t-e)+e;for(Oe=0;Oe<=i;Oe++){var At=Oe/i,Nt=At*b+g,Xt=Math.sin(Nt),Tt=Math.cos(Nt);Ge.x=Et*Xt,Ge.y=-_t*n+ue,Ge.z=Et*Tt,K.push(Ge.x,Ge.y,Ge.z),Ze.set(Xt,We,Tt).normalize(),Q.push(Ze.x,Ze.y,Ze.z),ne.push(At,1-_t),ft.push(U++)}oe.push(ft)}for(Oe=0;Oe<i;Oe++)for(Fe=0;Fe<l;Fe++){var wt=oe[Fe][Oe],sn=oe[Fe+1][Oe],gn=oe[Fe+1][Oe+1],Jn=oe[Fe][Oe+1];F.push(wt,sn,Jn),F.push(sn,gn,Jn),et+=6}k.addGroup(pe,et,0),pe+=et})(),h===!1&&(0<e&&Te(!0),0<t&&Te(!1)),this.setIndex(F),this.setAttribute("position",new ln(K,3)),this.setAttribute("normal",new ln(Q,3)),this.setAttribute("uv",new ln(ne,2))}function Mu(e,t,n,i,l,h,g){Vl.call(this,0,e,t,n,i,l,h,g),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:l,thetaStart:h,thetaLength:g}}function wc(e,t,n,i,l,h,g){Cs.call(this,0,e,t,n,i,l,h,g),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:l,thetaStart:h,thetaLength:g}}function el(e,t,n,i){kn.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},this.fromBufferGeometry(new bc(e,t,n,i)),this.mergeVertices()}function bc(e,t,n,i){X.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},e=e||1,t=t!==void 0?Math.max(3,t):8,n=n!==void 0?n:0,i=i!==void 0?i:2*Math.PI;var l,h,g=[],b=[],k=[],F=[],K=new Se,Q=new Ve;for(b.push(0,0,0),k.push(0,0,1),F.push(.5,.5),h=0,l=3;h<=t;h++,l+=3){var ne=n+h/t*i;K.x=e*Math.cos(ne),K.y=e*Math.sin(ne),b.push(K.x,K.y,K.z),k.push(0,0,1),Q.x=(b[l]/e+1)/2,Q.y=(b[l+1]/e+1)/2,F.push(Q.x,Q.y)}for(l=1;l<=t;l++)g.push(l,l+1,0);this.setIndex(g),this.setAttribute("position",new ln(b,3)),this.setAttribute("normal",new ln(k,3)),this.setAttribute("uv",new ln(F,2))}(vu.prototype=Object.create(kn.prototype)).constructor=vu,(jl.prototype=Object.create(_s.prototype)).constructor=jl,(xu.prototype=Object.create(kn.prototype)).constructor=xu,(Ts.prototype=Object.create(X.prototype)).constructor=Ts,(wu.prototype=Object.create(kn.prototype)).constructor=wu,(yc.prototype=Object.create(X.prototype)).constructor=yc,(bu.prototype=Object.create(kn.prototype)).constructor=bu,(Qs.prototype=Object.create(X.prototype)).constructor=Qs,((Nl.prototype=Object.create(kn.prototype)).constructor=Nl).prototype.toJSON=function(){var e=kn.prototype.toJSON.call(this);return $h(this.parameters.shapes,e)},((vc.prototype=Object.create(X.prototype)).constructor=vc).prototype.toJSON=function(){var e=X.prototype.toJSON.call(this);return $h(this.parameters.shapes,e)},(xc.prototype=Object.create(X.prototype)).constructor=xc,(Vl.prototype=Object.create(kn.prototype)).constructor=Vl,(Cs.prototype=Object.create(X.prototype)).constructor=Cs,(Mu.prototype=Object.create(Vl.prototype)).constructor=Mu,(wc.prototype=Object.create(Cs.prototype)).constructor=wc,(el.prototype=Object.create(kn.prototype)).constructor=el,(bc.prototype=Object.create(X.prototype)).constructor=bc;var La=Object.freeze({__proto__:null,WireframeGeometry:Ys,ParametricGeometry:Al,ParametricBufferGeometry:ws,TetrahedronGeometry:Zs,TetrahedronBufferGeometry:Ks,OctahedronGeometry:ko,OctahedronBufferGeometry:bs,IcosahedronGeometry:hc,IcosahedronBufferGeometry:Ji,DodecahedronGeometry:pc,DodecahedronBufferGeometry:Pl,PolyhedronGeometry:ns,PolyhedronBufferGeometry:In,TubeGeometry:mu,TubeBufferGeometry:Ka,TorusKnotGeometry:sa,TorusKnotBufferGeometry:$s,TorusGeometry:Ol,TorusBufferGeometry:dc,TextGeometry:vu,TextBufferGeometry:jl,SphereGeometry:xu,SphereBufferGeometry:Ts,RingGeometry:wu,RingBufferGeometry:yc,PlaneGeometry:Zo,PlaneBufferGeometry:Va,LatheGeometry:bu,LatheBufferGeometry:Qs,ShapeGeometry:Nl,ShapeBufferGeometry:vc,ExtrudeGeometry:gc,ExtrudeBufferGeometry:_s,EdgesGeometry:xc,ConeGeometry:Mu,ConeBufferGeometry:wc,CylinderGeometry:Vl,CylinderBufferGeometry:Cs,CircleGeometry:el,CircleBufferGeometry:bc,BoxGeometry:Xo,BoxBufferGeometry:Aa});function Mc(e){rr.call(this),this.type="ShadowMaterial",this.color=new Cn(0),this.transparent=!0,this.setValues(e)}function tl(e){Fr.call(this,e),this.type="RawShaderMaterial"}function is(e){rr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Cn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Cn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Fl(e){is.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new Ve(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function Bl(e){rr.call(this),this.type="MeshPhongMaterial",this.color=new Cn(16777215),this.specular=new Cn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Cn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function _c(e){rr.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Cn(16777215),this.specular=new Cn(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Cn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Tc(e){rr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ss(e){rr.call(this),this.type="MeshLambertMaterial",this.color=new Cn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Cn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Cc(e){rr.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Cn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Sc(e){si.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}((Mc.prototype=Object.create(rr.prototype)).constructor=Mc).prototype.isShadowMaterial=!0,Mc.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.color.copy(e.color),this},((tl.prototype=Object.create(Fr.prototype)).constructor=tl).prototype.isRawShaderMaterial=!0,((is.prototype=Object.create(rr.prototype)).constructor=is).prototype.isMeshStandardMaterial=!0,is.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Fl.prototype=Object.create(is.prototype)).constructor=Fl).prototype.isMeshPhysicalMaterial=!0,Fl.prototype.copy=function(e){return is.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new Cn).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},((Bl.prototype=Object.create(rr.prototype)).constructor=Bl).prototype.isMeshPhongMaterial=!0,Bl.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((_c.prototype=Object.create(rr.prototype)).constructor=_c).prototype.isMeshToonMaterial=!0,_c.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Tc.prototype=Object.create(rr.prototype)).constructor=Tc).prototype.isMeshNormalMaterial=!0,Tc.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Ss.prototype=Object.create(rr.prototype)).constructor=Ss).prototype.isMeshLambertMaterial=!0,Ss.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Cc.prototype=Object.create(rr.prototype)).constructor=Cc).prototype.isMeshMatcapMaterial=!0,Cc.prototype.copy=function(e){return rr.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Sc.prototype=Object.create(si.prototype)).constructor=Sc).prototype.isLineDashedMaterial=!0,Sc.prototype.copy=function(e){return si.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var _u=Object.freeze({__proto__:null,ShadowMaterial:Mc,SpriteMaterial:Gs,RawShaderMaterial:tl,ShaderMaterial:Fr,PointsMaterial:Io,MeshPhysicalMaterial:Fl,MeshStandardMaterial:is,MeshPhongMaterial:Bl,MeshToonMaterial:_c,MeshNormalMaterial:Tc,MeshLambertMaterial:Ss,MeshDepthMaterial:Bs,MeshDistanceMaterial:$o,MeshBasicMaterial:Xa,MeshMatcapMaterial:Cc,LineDashedMaterial:Sc,LineBasicMaterial:si,Material:rr}),Ai={arraySlice:function(e,t,n){return Ai.isTypedArray(e)?new e.constructor(e.subarray(t,n!==void 0?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort(function(l,h){return e[l]-e[h]}),n},sortedArray:function(e,t,n){for(var i=e.length,l=new e.constructor(i),h=0,g=0;g!==i;++h)for(var b=n[h]*t,k=0;k!==t;++k)l[g++]=e[b+k];return l},flattenJSON:function(e,t,n,i){for(var l=1,h=e[0];h!==void 0&&h[i]===void 0;)h=e[l++];if(h!==void 0){var g=h[i];if(g!==void 0)if(Array.isArray(g))for(;(g=h[i])!==void 0&&(t.push(h.time),n.push.apply(n,g)),(h=e[l++])!==void 0;);else if(g.toArray!==void 0)for(;(g=h[i])!==void 0&&(t.push(h.time),g.toArray(n,n.length)),(h=e[l++])!==void 0;);else for(;(g=h[i])!==void 0&&(t.push(h.time),n.push(g)),(h=e[l++])!==void 0;);}},subclip:function(e,t,n,i,l){l=l||30;var h=e.clone();h.name=t;for(var g=[],b=0;b<h.tracks.length;++b){for(var k=h.tracks[b],F=k.getValueSize(),K=[],Q=[],ne=0;ne<k.times.length;++ne){var U=k.times[ne]*l;if(!(U<n||i<=U)){K.push(k.times[ne]);for(var oe=0;oe<F;++oe)Q.push(k.values[ne*F+oe])}}K.length!==0&&(k.times=Ai.convertArray(K,k.times.constructor),k.values=Ai.convertArray(Q,k.values.constructor),g.push(k))}h.tracks=g;var ue=1/0;for(b=0;b<h.tracks.length;++b)ue>h.tracks[b].times[0]&&(ue=h.tracks[b].times[0]);for(b=0;b<h.tracks.length;++b)h.tracks[b].shift(-1*ue);return h.resetDuration(),h}};function Ga(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function Gl(e,t,n,i){Ga.call(this,e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function zl(e,t,n,i){Ga.call(this,e,t,n,i)}function Dc(e,t,n,i){Ga.call(this,e,t,n,i)}function ga(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ai.convertArray(t,this.TimeBufferType),this.values=Ai.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function Tu(e,t,n){ga.call(this,e,t,n)}function nl(e,t,n,i){ga.call(this,e,t,n,i)}function as(e,t,n,i){ga.call(this,e,t,n,i)}function Cu(e,t,n,i){Ga.call(this,e,t,n,i)}function rl(e,t,n,i){ga.call(this,e,t,n,i)}function Ec(e,t,n,i){ga.call(this,e,t,n,i)}function Ul(e,t,n,i){ga.call(this,e,t,n,i)}function ki(e,t,n){this.name=e,this.tracks=n,this.duration=t!==void 0?t:-1,this.uuid=Qt.generateUUID(),this.duration<0&&this.resetDuration()}function gp(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(l){switch(l.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return as;case"vector":case"vector2":case"vector3":case"vector4":return Ul;case"color":return nl;case"quaternion":return rl;case"bool":case"boolean":return Tu;case"string":return Ec}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+l)}(e.type);if(e.times===void 0){var n=[],i=[];Ai.flattenJSON(e.keys,n,i,"value"),e.times=n,e.values=i}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Ga.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],l=t[n-1];e:{t:{var h;n:{a:if(!(e<i)){for(var g=n+2;;){if(i===void 0){if(e<l)break a;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,l)}if(n===g)break;if(l=i,e<(i=t[++n]))break t}h=t.length;break n}if(l<=e)break e;var b=t[1];for(e<b&&(n=2,l=b),g=n-2;;){if(l===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===g)break;if(i=l,(l=t[--n-1])<=e)break t}h=n,n=0}for(;n<h;){var k=n+h>>>1;e<t[k]?h=k:n=1+k}if(i=t[n],(l=t[n-1])===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(i===void 0)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,l,e)}this._cachedIndex=n,this.intervalChanged_(n,l,i)}return this.interpolate_(n,l,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,l=e*i,h=0;h!==i;++h)t[h]=n[l+h];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Ga.prototype,{beforeStart_:Ga.prototype.copySampleValue_,afterEnd_:Ga.prototype.copySampleValue_}),Gl.prototype=Object.assign(Object.create(Ga.prototype),{constructor:Gl,DefaultSettings_:{endingStart:Ie,endingEnd:Ie},intervalChanged_:function(e,t,n){var i=this.parameterPositions,l=e-2,h=e+1,g=i[l],b=i[h];if(g===void 0)switch(this.getSettings_().endingStart){case ze:l=e,g=2*t-n;break;case He:g=t+i[l=i.length-2]-i[l+1];break;default:l=e,g=n}if(b===void 0)switch(this.getSettings_().endingEnd){case ze:h=e,b=2*n-t;break;case He:b=n+i[h=1]-i[0];break;default:h=e-1,b=t}var k=.5*(n-t),F=this.valueSize;this._weightPrev=k/(t-g),this._weightNext=k/(b-n),this._offsetPrev=l*F,this._offsetNext=h*F},interpolate_:function(e,t,n,i){for(var l=this.resultBuffer,h=this.sampleValues,g=this.valueSize,b=e*g,k=b-g,F=this._offsetPrev,K=this._offsetNext,Q=this._weightPrev,ne=this._weightNext,U=(n-t)/(i-t),oe=U*U,ue=oe*U,pe=-Q*ue+2*Q*oe-Q*U,Te=(1+Q)*ue+(-1.5-2*Q)*oe+(-.5+Q)*U+1,Oe=(-1-ne)*ue+(1.5+ne)*oe+.5*U,Fe=ne*ue-ne*oe,Ze=0;Ze!==g;++Ze)l[Ze]=pe*h[F+Ze]+Te*h[k+Ze]+Oe*h[b+Ze]+Fe*h[K+Ze];return l}}),zl.prototype=Object.assign(Object.create(Ga.prototype),{constructor:zl,interpolate_:function(e,t,n,i){for(var l=this.resultBuffer,h=this.sampleValues,g=this.valueSize,b=e*g,k=b-g,F=(n-t)/(i-t),K=1-F,Q=0;Q!==g;++Q)l[Q]=h[k+Q]*K+h[b+Q]*F;return l}}),Dc.prototype=Object.assign(Object.create(Ga.prototype),{constructor:Dc,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(ga,{toJSON:function(e){var t,n=e.constructor;if(n.toJSON!==void 0)t=n.toJSON(e);else{t={name:e.name,times:Ai.convertArray(e.times,Array),values:Ai.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(ga.prototype,{constructor:ga,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:ve,InterpolantFactoryMethodDiscrete:function(e){return new Dc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new zl(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Gl(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case ae:t=this.InterpolantFactoryMethodDiscrete;break;case ve:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(t!==void 0)return this.createInterpolant=t,this;var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ae;case this.InterpolantFactoryMethodLinear:return ve;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(e!==0)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this},scale:function(e){if(e!==1)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,i=n.length,l=0,h=i-1;l!==i&&n[l]<e;)++l;for(;h!==-1&&n[h]>t;)--h;if(++h,l!==0||h!==i){h<=l&&(l=(h=Math.max(h,1))-1);var g=this.getValueSize();this.times=Ai.arraySlice(n,l,h),this.values=Ai.arraySlice(this.values,l*g,h*g)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,l=n.length;l===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var h=null,g=0;g!==l;g++){var b=n[g];if(typeof b=="number"&&isNaN(b)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,g,b),e=!1;break}if(h!==null&&b<h){console.error("THREE.KeyframeTrack: Out of order keys.",this,g,b,h),e=!1;break}h=b}if(i!==void 0&&Ai.isTypedArray(i)){g=0;for(var k=i.length;g!==k;++g){var F=i[g];if(isNaN(F)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,g,F),e=!1;break}}}return e},optimize:function(){for(var e=Ai.arraySlice(this.times),t=Ai.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===2302,l=1,h=e.length-1,g=1;g<h;++g){var b=!1,k=e[g];if(k!==e[g+1]&&(g!==1||k!==k[0]))if(i)b=!0;else for(var F=g*n,K=F-n,Q=F+n,ne=0;ne!==n;++ne){var U=t[F+ne];if(U!==t[K+ne]||U!==t[Q+ne]){b=!0;break}}if(b){if(g!==l){e[l]=e[g];var oe=g*n,ue=l*n;for(ne=0;ne!==n;++ne)t[ue+ne]=t[oe+ne]}++l}}if(0<h){for(e[l]=e[h],oe=h*n,ue=l*n,ne=0;ne!==n;++ne)t[ue+ne]=t[oe+ne];++l}return l!==e.length?(this.times=Ai.arraySlice(e,0,l),this.values=Ai.arraySlice(t,0,l*n)):(this.times=e,this.values=t),this},clone:function(){var e=Ai.arraySlice(this.times,0),t=Ai.arraySlice(this.values,0),n=new this.constructor(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),Tu.prototype=Object.assign(Object.create(ga.prototype),{constructor:Tu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:ae,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),nl.prototype=Object.assign(Object.create(ga.prototype),{constructor:nl,ValueTypeName:"color"}),as.prototype=Object.assign(Object.create(ga.prototype),{constructor:as,ValueTypeName:"number"}),Cu.prototype=Object.assign(Object.create(Ga.prototype),{constructor:Cu,interpolate_:function(e,t,n,i){for(var l=this.resultBuffer,h=this.sampleValues,g=this.valueSize,b=e*g,k=(n-t)/(i-t),F=b+g;b!==F;b+=4)bn.slerpFlat(l,0,h,b-g,h,b,k);return l}}),rl.prototype=Object.assign(Object.create(ga.prototype),{constructor:rl,ValueTypeName:"quaternion",DefaultInterpolation:ve,InterpolantFactoryMethodLinear:function(e){return new Cu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Ec.prototype=Object.assign(Object.create(ga.prototype),{constructor:Ec,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:ae,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ul.prototype=Object.assign(Object.create(ga.prototype),{constructor:Ul,ValueTypeName:"vector"}),Object.assign(ki,{parse:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),l=0,h=n.length;l!==h;++l)t.push(gp(n[l]).scale(i));return new ki(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},l=0,h=n.length;l!==h;++l)t.push(ga.toJSON(n[l]));return i},CreateFromMorphTargetSequence:function(e,t,n,i){for(var l=t.length,h=[],g=0;g<l;g++){var b=[],k=[];b.push((g+l-1)%l,g,(g+1)%l),k.push(0,1,0);var F=Ai.getKeyframeOrder(b);b=Ai.sortedArray(b,1,F),k=Ai.sortedArray(k,1,F),i||b[0]!==0||(b.push(l),k.push(k[0])),h.push(new as(".morphTargetInfluences["+t[g].name+"]",b,k).scale(1/n))}return new ki(e,-1,h)},findByName:function(e,t){var n=e;Array.isArray(e)||(n=e.geometry&&e.geometry.animations||e.animations);for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var i={},l=/^([\w-]*?)([\d]+)$/,h=0,g=e.length;h<g;h++){var b=e[h],k=b.name.match(l);if(k&&1<k.length){var F=i[Q=k[1]];F||(i[Q]=F=[]),F.push(b)}}var K=[];for(var Q in i)K.push(ki.CreateFromMorphTargetSequence(Q,i[Q],t,n));return K},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(Oe,Fe,Ze,Ge,et){if(Ze.length!==0){var We=[],ft=[];Ai.flattenJSON(Ze,We,ft,Ge),We.length!==0&&et.push(new Oe(Fe,We,ft))}},i=[],l=e.name||"default",h=e.length||-1,g=e.fps||30,b=e.hierarchy||[],k=0;k<b.length;k++){var F=b[k].keys;if(F&&F.length!==0)if(F[0].morphTargets){for(var K={},Q=0;Q<F.length;Q++)if(F[Q].morphTargets)for(var ne=0;ne<F[Q].morphTargets.length;ne++)K[F[Q].morphTargets[ne]]=-1;for(var U in K){var oe=[],ue=[];for(ne=0;ne!==F[Q].morphTargets.length;++ne){var pe=F[Q];oe.push(pe.time),ue.push(pe.morphTarget===U?1:0)}i.push(new as(".morphTargetInfluence["+U+"]",oe,ue))}h=K.length*(g||1)}else{var Te=".bones["+t[k].name+"]";n(Ul,Te+".position",F,"pos",i),n(rl,Te+".quaternion",F,"rot",i),n(Ul,Te+".scale",F,"scl",i)}}return i.length===0?null:new ki(l,h,i)}}),Object.assign(ki.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new ki(this.name,this.duration,e)}});var il={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function os(e,t,n){var i=this,l=!1,h=0,g=0,b=void 0,k=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(F){g++,l===!1&&i.onStart!==void 0&&i.onStart(F,h,g),l=!0},this.itemEnd=function(F){h++,i.onProgress!==void 0&&i.onProgress(F,h,g),h===g&&(l=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(F){i.onError!==void 0&&i.onError(F)},this.resolveURL=function(F){return b?b(F):F},this.setURLModifier=function(F){return b=F,this},this.addHandler=function(F,K){return k.push(F,K),this},this.removeHandler=function(F){var K=k.indexOf(F);return K!==-1&&k.splice(K,2),this},this.getHandler=function(F){for(var K=0,Q=k.length;K<Q;K+=2){var ne=k[K],U=k[K+1];if(ne.global&&(ne.lastIndex=0),ne.test(F))return U}return null}}var br=new os;function Kr(e){this.manager=e!==void 0?e:br,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(Kr.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var _i={};function Hr(e){Kr.call(this,e)}function No(e){Kr.call(this,e)}function mh(e){Kr.call(this,e)}function Hl(e){Kr.call(this,e)}function za(e){Kr.call(this,e)}function Ac(e){Kr.call(this,e)}function al(e){Kr.call(this,e)}function dn(){this.type="Curve",this.arcLengthDivisions=200}function Wr(e,t,n,i,l,h,g,b){dn.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=i||1,this.aStartAngle=l||0,this.aEndAngle=h||2*Math.PI,this.aClockwise=g||!1,this.aRotation=b||0}function Pc(e,t,n,i,l,h){Wr.call(this,e,t,n,n,i,l,h),this.type="ArcCurve"}function Su(){var e=0,t=0,n=0,i=0;function l(h,g,b,k){n=-3*(e=h)+3*g-2*(t=b)-k,i=2*h-2*g+b+k}return{initCatmullRom:function(h,g,b,k,F){l(g,b,F*(b-h),F*(k-g))},initNonuniformCatmullRom:function(h,g,b,k,F,K,Q){var ne=(g-h)/F-(b-h)/(F+K)+(b-g)/K,U=(b-g)/K-(k-g)/(K+Q)+(k-b)/Q;l(g,b,ne*=K,U*=K)},calc:function(h){var g=h*h;return e+t*h+n*g+i*(g*h)}}}Hr.prototype=Object.assign(Object.create(Kr.prototype),{constructor:Hr,load:function(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var l=this,h=il.get(e);if(h!==void 0)return l.manager.itemStart(e),setTimeout(function(){t&&t(h),l.manager.itemEnd(e)},0),h;if(_i[e]===void 0){var g=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(g){var b=g[1],k=!!g[2],F=g[3];F=decodeURIComponent(F),k&&(F=atob(F));try{var K,Q=(this.responseType||"").toLowerCase();switch(Q){case"arraybuffer":case"blob":for(var ne=new Uint8Array(F.length),U=0;U<F.length;U++)ne[U]=F.charCodeAt(U);K=Q==="blob"?new Blob([ne.buffer],{type:b}):ne.buffer;break;case"document":var oe=new DOMParser;K=oe.parseFromString(F,b);break;case"json":K=JSON.parse(F);break;default:K=F}setTimeout(function(){t&&t(K),l.manager.itemEnd(e)},0)}catch(Te){setTimeout(function(){i&&i(Te),l.manager.itemError(e),l.manager.itemEnd(e)},0)}}else{_i[e]=[],_i[e].push({onLoad:t,onProgress:n,onError:i});var ue=new XMLHttpRequest;for(var pe in ue.open("GET",e,!0),ue.addEventListener("load",function(Te){var Oe=this.response,Fe=_i[e];if(delete _i[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),il.add(e,Oe);for(var Ze=0,Ge=Fe.length;Ze<Ge;Ze++)(et=Fe[Ze]).onLoad&&et.onLoad(Oe);l.manager.itemEnd(e)}else{for(Ze=0,Ge=Fe.length;Ze<Ge;Ze++){var et;(et=Fe[Ze]).onError&&et.onError(Te)}l.manager.itemError(e),l.manager.itemEnd(e)}},!1),ue.addEventListener("progress",function(Te){for(var Oe=_i[e],Fe=0,Ze=Oe.length;Fe<Ze;Fe++){var Ge=Oe[Fe];Ge.onProgress&&Ge.onProgress(Te)}},!1),ue.addEventListener("error",function(Te){var Oe=_i[e];delete _i[e];for(var Fe=0,Ze=Oe.length;Fe<Ze;Fe++){var Ge=Oe[Fe];Ge.onError&&Ge.onError(Te)}l.manager.itemError(e),l.manager.itemEnd(e)},!1),ue.addEventListener("abort",function(Te){var Oe=_i[e];delete _i[e];for(var Fe=0,Ze=Oe.length;Fe<Ze;Fe++){var Ge=Oe[Fe];Ge.onError&&Ge.onError(Te)}l.manager.itemError(e),l.manager.itemEnd(e)},!1),this.responseType!==void 0&&(ue.responseType=this.responseType),this.withCredentials!==void 0&&(ue.withCredentials=this.withCredentials),ue.overrideMimeType&&ue.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain"),this.requestHeader)ue.setRequestHeader(pe,this.requestHeader[pe]);ue.send(null)}return l.manager.itemStart(e),ue}_i[e].push({onLoad:t,onProgress:n,onError:i})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),No.prototype=Object.assign(Object.create(Kr.prototype),{constructor:No,load:function(e,t,n,i){var l=this,h=new Hr(l.manager);h.setPath(l.path),h.load(e,function(g){t(l.parse(JSON.parse(g)))},n,i)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var i=ki.parse(e[n]);t.push(i)}return t}}),mh.prototype=Object.assign(Object.create(Kr.prototype),{constructor:mh,load:function(e,t,n,i){var l=this,h=[],g=new cc;g.image=h;var b=new Hr(this.manager);function k(ne){b.load(e[ne],function(U){var oe=l.parse(U,!0);h[ne]={width:oe.width,height:oe.height,format:oe.format,mipmaps:oe.mipmaps},(F+=1)===6&&(oe.mipmapCount===1&&(g.minFilter=q),g.format=oe.format,g.needsUpdate=!0,t&&t(g))},n,i)}if(b.setPath(this.path),b.setResponseType("arraybuffer"),Array.isArray(e))for(var F=0,K=0,Q=e.length;K<Q;++K)k(K);else b.load(e,function(ne){var U=l.parse(ne,!0);if(U.isCubemap)for(var oe=U.mipmaps.length/U.mipmapCount,ue=0;ue<oe;ue++){h[ue]={mipmaps:[]};for(var pe=0;pe<U.mipmapCount;pe++)h[ue].mipmaps.push(U.mipmaps[ue*U.mipmapCount+pe]),h[ue].format=U.format,h[ue].width=U.width,h[ue].height=U.height}else g.image.width=U.width,g.image.height=U.height,g.mipmaps=U.mipmaps;U.mipmapCount===1&&(g.minFilter=q),g.format=U.format,g.needsUpdate=!0,t&&t(g)},n,i);return g}}),Hl.prototype=Object.assign(Object.create(Kr.prototype),{constructor:Hl,load:function(e,t,n,i){var l=this,h=new jn,g=new Hr(this.manager);return g.setResponseType("arraybuffer"),g.setPath(this.path),g.load(e,function(b){var k=l.parse(b);k&&(k.image!==void 0?h.image=k.image:k.data!==void 0&&(h.image.width=k.width,h.image.height=k.height,h.image.data=k.data),h.wrapS=k.wrapS!==void 0?k.wrapS:C,h.wrapT=k.wrapT!==void 0?k.wrapT:C,h.magFilter=k.magFilter!==void 0?k.magFilter:q,h.minFilter=k.minFilter!==void 0?k.minFilter:q,h.anisotropy=k.anisotropy!==void 0?k.anisotropy:1,k.format!==void 0&&(h.format=k.format),k.type!==void 0&&(h.type=k.type),k.mipmaps!==void 0&&(h.mipmaps=k.mipmaps,h.minFilter=_),k.mipmapCount===1&&(h.minFilter=q),h.needsUpdate=!0,t&&t(h,k))},n,i),h}}),za.prototype=Object.assign(Object.create(Kr.prototype),{constructor:za,load:function(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var l=this,h=il.get(e);if(h!==void 0)return l.manager.itemStart(e),setTimeout(function(){t&&t(h),l.manager.itemEnd(e)},0),h;var g=document.createElementNS("http://www.w3.org/1999/xhtml","img");function b(){g.removeEventListener("load",b,!1),g.removeEventListener("error",k,!1),il.add(e,this),t&&t(this),l.manager.itemEnd(e)}function k(F){g.removeEventListener("load",b,!1),g.removeEventListener("error",k,!1),i&&i(F),l.manager.itemError(e),l.manager.itemEnd(e)}return g.addEventListener("load",b,!1),g.addEventListener("error",k,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(g.crossOrigin=this.crossOrigin),l.manager.itemStart(e),g.src=e,g}}),Ac.prototype=Object.assign(Object.create(Kr.prototype),{constructor:Ac,load:function(e,t,n,i){var l=new oo,h=new za(this.manager);h.setCrossOrigin(this.crossOrigin),h.setPath(this.path);var g=0;function b(F){h.load(e[F],function(K){l.images[F]=K,++g==6&&(l.needsUpdate=!0,t&&t(l))},void 0,i)}for(var k=0;k<e.length;++k)b(k);return l}}),al.prototype=Object.assign(Object.create(Kr.prototype),{constructor:al,load:function(e,t,n,i){var l=new nn,h=new za(this.manager);return h.setCrossOrigin(this.crossOrigin),h.setPath(this.path),h.load(e,function(g){l.image=g;var b=0<e.search(/\.jpe?g($|\?)/i)||e.search(/^data\:image\/jpeg/)===0;l.format=b?m:f,l.needsUpdate=!0,t!==void 0&&t(l)},n,i),l}}),Object.assign(dn.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){e===void 0&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){e===void 0&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e===void 0&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,i=[],l=this.getPoint(0),h=0;for(i.push(0),n=1;n<=e;n++)h+=(t=this.getPoint(n/e)).distanceTo(l),i.push(h),l=t;return this.cacheArcLengths=i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,i=this.getLengths(),l=0,h=i.length;n=t||e*i[h-1];for(var g,b=0,k=h-1;b<=k;)if((g=i[l=Math.floor(b+(k-b)/2)]-n)<0)b=l+1;else{if(!(0<g)){k=l;break}k=l-1}if(i[l=k]===n)return l/(h-1);var F=i[l];return(l+(n-F)/(i[l+1]-F))/(h-1)},getTangent:function(e){var t=e-1e-4,n=e+1e-4;t<0&&(t=0),1<n&&(n=1);var i=this.getPoint(t);return this.getPoint(n).clone().sub(i).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var n,i,l,h=new Se,g=[],b=[],k=[],F=new Se,K=new Lt;for(n=0;n<=e;n++)i=n/e,g[n]=this.getTangentAt(i),g[n].normalize();b[0]=new Se,k[0]=new Se;var Q=Number.MAX_VALUE,ne=Math.abs(g[0].x),U=Math.abs(g[0].y),oe=Math.abs(g[0].z);for(ne<=Q&&(Q=ne,h.set(1,0,0)),U<=Q&&(Q=U,h.set(0,1,0)),oe<=Q&&h.set(0,0,1),F.crossVectors(g[0],h).normalize(),b[0].crossVectors(g[0],F),k[0].crossVectors(g[0],b[0]),n=1;n<=e;n++)b[n]=b[n-1].clone(),k[n]=k[n-1].clone(),F.crossVectors(g[n-1],g[n]),F.length()>Number.EPSILON&&(F.normalize(),l=Math.acos(Qt.clamp(g[n-1].dot(g[n]),-1,1)),b[n].applyMatrix4(K.makeRotationAxis(F,l))),k[n].crossVectors(g[n],b[n]);if(t===!0)for(l=Math.acos(Qt.clamp(b[0].dot(b[e]),-1,1)),l/=e,0<g[0].dot(F.crossVectors(b[0],b[e]))&&(l=-l),n=1;n<=e;n++)b[n].applyMatrix4(K.makeRotationAxis(g[n],l*n)),k[n].crossVectors(g[n],b[n]);return{tangents:g,normals:b,binormals:k}},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),((Wr.prototype=Object.create(dn.prototype)).constructor=Wr).prototype.isEllipseCurve=!0,Wr.prototype.getPoint=function(e,t){for(var n=t||new Ve,i=2*Math.PI,l=this.aEndAngle-this.aStartAngle,h=Math.abs(l)<Number.EPSILON;l<0;)l+=i;for(;i<l;)l-=i;l<Number.EPSILON&&(l=h?0:i),this.aClockwise!==!0||h||(l===i?l=-i:l-=i);var g=this.aStartAngle+e*l,b=this.aX+this.xRadius*Math.cos(g),k=this.aY+this.yRadius*Math.sin(g);if(this.aRotation!==0){var F=Math.cos(this.aRotation),K=Math.sin(this.aRotation),Q=b-this.aX,ne=k-this.aY;b=Q*F-ne*K+this.aX,k=Q*K+ne*F+this.aY}return n.set(b,k)},Wr.prototype.copy=function(e){return dn.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Wr.prototype.toJSON=function(){var e=dn.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Wr.prototype.fromJSON=function(e){return dn.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},((Pc.prototype=Object.create(Wr.prototype)).constructor=Pc).prototype.isArcCurve=!0;var Ds=new Se,Oc=new Su,Du=new Su,Wl=new Su;function pi(e,t,n,i){dn.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=i||.5}function ol(e,t,n,i,l){var h=.5*(i-t),g=.5*(l-n),b=e*e;return(2*n-2*i+h+g)*(e*b)+(-3*n+3*i-2*h-g)*b+h*e+n}function Rc(e,t,n,i){return(g=1-e)*g*t+2*(1-(h=e))*h*n+(l=e)*l*i;var l,h,g}function Lc(e,t,n,i,l){return(F=1-e)*F*F*t+3*(k=1-(b=e))*k*b*n+3*(1-(g=e))*g*g*i+(h=e)*h*h*l;var h,g,b,k,F}function Vo(e,t,n,i){dn.call(this),this.type="CubicBezierCurve",this.v0=e||new Ve,this.v1=t||new Ve,this.v2=n||new Ve,this.v3=i||new Ve}function Ta(e,t,n,i){dn.call(this),this.type="CubicBezierCurve3",this.v0=e||new Se,this.v1=t||new Se,this.v2=n||new Se,this.v3=i||new Se}function er(e,t){dn.call(this),this.type="LineCurve",this.v1=e||new Ve,this.v2=t||new Ve}function Fo(e,t){dn.call(this),this.type="LineCurve3",this.v1=e||new Se,this.v2=t||new Se}function qi(e,t,n){dn.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Ve,this.v1=t||new Ve,this.v2=n||new Ve}function ss(e,t,n){dn.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Se,this.v1=t||new Se,this.v2=n||new Se}function Rr(e){dn.call(this),this.type="SplineCurve",this.points=e||[]}((pi.prototype=Object.create(dn.prototype)).constructor=pi).prototype.isCatmullRomCurve3=!0,pi.prototype.getPoint=function(e,t){var n,i,l,h,g=t||new Se,b=this.points,k=b.length,F=(k-(this.closed?0:1))*e,K=Math.floor(F),Q=F-K;if(this.closed?K+=0<K?0:(Math.floor(Math.abs(K)/k)+1)*k:Q===0&&K===k-1&&(K=k-2,Q=1),n=this.closed||0<K?b[(K-1)%k]:(Ds.subVectors(b[0],b[1]).add(b[0]),Ds),i=b[K%k],l=b[(K+1)%k],h=this.closed||K+2<k?b[(K+2)%k]:(Ds.subVectors(b[k-1],b[k-2]).add(b[k-1]),Ds),this.curveType==="centripetal"||this.curveType==="chordal"){var ne=this.curveType==="chordal"?.5:.25,U=Math.pow(n.distanceToSquared(i),ne),oe=Math.pow(i.distanceToSquared(l),ne),ue=Math.pow(l.distanceToSquared(h),ne);oe<1e-4&&(oe=1),U<1e-4&&(U=oe),ue<1e-4&&(ue=oe),Oc.initNonuniformCatmullRom(n.x,i.x,l.x,h.x,U,oe,ue),Du.initNonuniformCatmullRom(n.y,i.y,l.y,h.y,U,oe,ue),Wl.initNonuniformCatmullRom(n.z,i.z,l.z,h.z,U,oe,ue)}else this.curveType==="catmullrom"&&(Oc.initCatmullRom(n.x,i.x,l.x,h.x,this.tension),Du.initCatmullRom(n.y,i.y,l.y,h.y,this.tension),Wl.initCatmullRom(n.z,i.z,l.z,h.z,this.tension));return g.set(Oc.calc(Q),Du.calc(Q),Wl.calc(Q)),g},pi.prototype.copy=function(e){dn.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},pi.prototype.toJSON=function(){var e=dn.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},pi.prototype.fromJSON=function(e){dn.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(new Se().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},((Vo.prototype=Object.create(dn.prototype)).constructor=Vo).prototype.isCubicBezierCurve=!0,Vo.prototype.getPoint=function(e,t){var n=t||new Ve,i=this.v0,l=this.v1,h=this.v2,g=this.v3;return n.set(Lc(e,i.x,l.x,h.x,g.x),Lc(e,i.y,l.y,h.y,g.y)),n},Vo.prototype.copy=function(e){return dn.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Vo.prototype.toJSON=function(){var e=dn.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Vo.prototype.fromJSON=function(e){return dn.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},((Ta.prototype=Object.create(dn.prototype)).constructor=Ta).prototype.isCubicBezierCurve3=!0,Ta.prototype.getPoint=function(e,t){var n=t||new Se,i=this.v0,l=this.v1,h=this.v2,g=this.v3;return n.set(Lc(e,i.x,l.x,h.x,g.x),Lc(e,i.y,l.y,h.y,g.y),Lc(e,i.z,l.z,h.z,g.z)),n},Ta.prototype.copy=function(e){return dn.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ta.prototype.toJSON=function(){var e=dn.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ta.prototype.fromJSON=function(e){return dn.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},((er.prototype=Object.create(dn.prototype)).constructor=er).prototype.isLineCurve=!0,er.prototype.getPoint=function(e,t){var n=t||new Ve;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},er.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},er.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},er.prototype.copy=function(e){return dn.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},er.prototype.toJSON=function(){var e=dn.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},er.prototype.fromJSON=function(e){return dn.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((Fo.prototype=Object.create(dn.prototype)).constructor=Fo).prototype.isLineCurve3=!0,Fo.prototype.getPoint=function(e,t){var n=t||new Se;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Fo.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Fo.prototype.copy=function(e){return dn.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Fo.prototype.toJSON=function(){var e=dn.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Fo.prototype.fromJSON=function(e){return dn.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((qi.prototype=Object.create(dn.prototype)).constructor=qi).prototype.isQuadraticBezierCurve=!0,qi.prototype.getPoint=function(e,t){var n=t||new Ve,i=this.v0,l=this.v1,h=this.v2;return n.set(Rc(e,i.x,l.x,h.x),Rc(e,i.y,l.y,h.y)),n},qi.prototype.copy=function(e){return dn.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},qi.prototype.toJSON=function(){var e=dn.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},qi.prototype.fromJSON=function(e){return dn.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((ss.prototype=Object.create(dn.prototype)).constructor=ss).prototype.isQuadraticBezierCurve3=!0,ss.prototype.getPoint=function(e,t){var n=t||new Se,i=this.v0,l=this.v1,h=this.v2;return n.set(Rc(e,i.x,l.x,h.x),Rc(e,i.y,l.y,h.y),Rc(e,i.z,l.z,h.z)),n},ss.prototype.copy=function(e){return dn.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ss.prototype.toJSON=function(){var e=dn.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ss.prototype.fromJSON=function(e){return dn.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((Rr.prototype=Object.create(dn.prototype)).constructor=Rr).prototype.isSplineCurve=!0,Rr.prototype.getPoint=function(e,t){var n=t||new Ve,i=this.points,l=(i.length-1)*e,h=Math.floor(l),g=l-h,b=i[h===0?h:h-1],k=i[h],F=i[h>i.length-2?i.length-1:h+1],K=i[h>i.length-3?i.length-1:h+2];return n.set(ol(g,b.x,k.x,F.x,K.x),ol(g,b.y,k.y,F.y,K.y)),n},Rr.prototype.copy=function(e){dn.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this},Rr.prototype.toJSON=function(){var e=dn.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e},Rr.prototype.fromJSON=function(e){dn.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(new Ve().fromArray(i))}return this};var gh=Object.freeze({__proto__:null,ArcCurve:Pc,CatmullRomCurve3:pi,CubicBezierCurve:Vo,CubicBezierCurve3:Ta,EllipseCurve:Wr,LineCurve:er,LineCurve3:Fo,QuadraticBezierCurve:qi,QuadraticBezierCurve3:ss,SplineCurve:Rr});function Bo(){dn.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Ua(e){Bo.call(this),this.type="Path",this.currentPoint=new Ve,e&&this.setFromPoints(e)}function Es(e){Ua.call(this,e),this.uuid=Qt.generateUUID(),this.type="Shape",this.holes=[]}function di(e,t){mn.call(this),this.type="Light",this.color=new Cn(e),this.intensity=t!==void 0?t:1,this.receiveShadow=void 0}function Eu(e,t,n){di.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(mn.DefaultUp),this.updateMatrix(),this.groundColor=new Cn(t)}function Go(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Ve(512,512),this.map=null,this.mapPass=null,this.matrix=new Lt,this._frustum=new Pr,this._frameExtents=new Ve(1,1),this._viewportCount=1,this._viewports=[new ct(0,0,1,1)]}function Jl(){Go.call(this,new Dr(50,1,.5,500))}function ql(e,t,n,i,l,h){di.call(this,e,t),this.type="SpotLight",this.position.copy(mn.DefaultUp),this.updateMatrix(),this.target=new mn,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(g){this.intensity=g/Math.PI}}),this.distance=n!==void 0?n:0,this.angle=i!==void 0?i:Math.PI/3,this.penumbra=l!==void 0?l:0,this.decay=h!==void 0?h:1,this.shadow=new Jl}function yh(){Go.call(this,new Dr(90,1,.5,500)),this._frameExtents=new Ve(4,2),this._viewportCount=6,this._viewports=[new ct(2,1,1,1),new ct(0,1,1,1),new ct(3,1,1,1),new ct(1,1,1,1),new ct(3,0,1,1),new ct(1,0,1,1)],this._cubeDirections=[new Se(1,0,0),new Se(-1,0,0),new Se(0,0,1),new Se(0,0,-1),new Se(0,1,0),new Se(0,-1,0)],this._cubeUps=[new Se(0,1,0),new Se(0,1,0),new Se(0,1,0),new Se(0,1,0),new Se(0,0,1),new Se(0,0,-1)]}function Au(e,t,n,i){di.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(l){this.intensity=l/(4*Math.PI)}}),this.distance=n!==void 0?n:0,this.decay=i!==void 0?i:1,this.shadow=new yh}function Xl(e,t,n,i,l,h){Ur.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e!==void 0?e:-1,this.right=t!==void 0?t:1,this.top=n!==void 0?n:1,this.bottom=i!==void 0?i:-1,this.near=l!==void 0?l:.1,this.far=h!==void 0?h:2e3,this.updateProjectionMatrix()}function zi(){Go.call(this,new Xl(-5,5,5,-5,.5,500))}function ya(e,t){di.call(this,e,t),this.type="DirectionalLight",this.position.copy(mn.DefaultUp),this.updateMatrix(),this.target=new mn,this.shadow=new zi}function Pu(e,t){di.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Ic(e,t,n,i){di.call(this,e,t),this.type="RectAreaLight",this.width=n!==void 0?n:10,this.height=i!==void 0?i:10}function Ou(e){Kr.call(this,e),this.textures={}}Bo.prototype=Object.assign(Object.create(dn.prototype),{constructor:Bo,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new er(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),i=0;i<n.length;){if(n[i]>=t){var l=n[i]-t,h=this.curves[i],g=h.getLength(),b=g===0?0:1-l/g;return h.getPointAt(b)}i++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){e===void 0&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],i=0,l=this.curves;i<l.length;i++)for(var h=l[i],g=h&&h.isEllipseCurve?2*e:h&&(h.isLineCurve||h.isLineCurve3)?1:h&&h.isSplineCurve?e*h.points.length:e,b=h.getPoints(g),k=0;k<b.length;k++){var F=b[k];t&&t.equals(F)||(n.push(F),t=F)}return this.autoClose&&1<n.length&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){dn.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=dn.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){dn.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push(new gh[i.type]().fromJSON(i))}return this}}),Ua.prototype=Object.assign(Object.create(Bo.prototype),{constructor:Ua,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var n=new er(this.currentPoint.clone(),new Ve(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,i){var l=new qi(this.currentPoint.clone(),new Ve(e,t),new Ve(n,i));return this.curves.push(l),this.currentPoint.set(n,i),this},bezierCurveTo:function(e,t,n,i,l,h){var g=new Vo(this.currentPoint.clone(),new Ve(e,t),new Ve(n,i),new Ve(l,h));return this.curves.push(g),this.currentPoint.set(l,h),this},splineThru:function(e){var t=new Rr([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,i,l,h){var g=this.currentPoint.x,b=this.currentPoint.y;return this.absarc(e+g,t+b,n,i,l,h),this},absarc:function(e,t,n,i,l,h){return this.absellipse(e,t,n,n,i,l,h),this},ellipse:function(e,t,n,i,l,h,g,b){var k=this.currentPoint.x,F=this.currentPoint.y;return this.absellipse(e+k,t+F,n,i,l,h,g,b),this},absellipse:function(e,t,n,i,l,h,g,b){var k=new Wr(e,t,n,i,l,h,g,b);if(0<this.curves.length){var F=k.getPoint(0);F.equals(this.currentPoint)||this.lineTo(F.x,F.y)}this.curves.push(k);var K=k.getPoint(1);return this.currentPoint.copy(K),this},copy:function(e){return Bo.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Bo.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Bo.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Es.prototype=Object.assign(Object.create(Ua.prototype),{constructor:Es,getPointsHoles:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Ua.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){var e=Ua.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){Ua.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push(new Ua().fromJSON(i))}return this}}),di.prototype=Object.assign(Object.create(mn.prototype),{constructor:di,isLight:!0,copy:function(e){return mn.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=mn.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}),Eu.prototype=Object.assign(Object.create(di.prototype),{constructor:Eu,isHemisphereLight:!0,copy:function(e){return di.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Go.prototype,{_projScreenMatrix:new Lt,_lightPositionWorld:new Se,_lookTarget:new Se,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,n=this.matrix,i=this._projScreenMatrix,l=this._lookTarget,h=this._lightPositionWorld;h.setFromMatrixPosition(e.matrixWorld),t.position.copy(h),l.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(l),t.updateMatrixWorld(),i.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e={};return this.bias!==0&&(e.bias=this.bias),this.radius!==1&&(e.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Jl.prototype=Object.assign(Object.create(Go.prototype),{constructor:Jl,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,n=2*Qt.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,l=e.distance||t.far;n===t.fov&&i===t.aspect&&l===t.far||(t.fov=n,t.aspect=i,t.far=l,t.updateProjectionMatrix()),Go.prototype.updateMatrices.call(this,e)}}),ql.prototype=Object.assign(Object.create(di.prototype),{constructor:ql,isSpotLight:!0,copy:function(e){return di.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),yh.prototype=Object.assign(Object.create(Go.prototype),{constructor:yh,isPointLightShadow:!0,updateMatrices:function(e,t){t===void 0&&(t=0);var n=this.camera,i=this.matrix,l=this._lightPositionWorld,h=this._lookTarget,g=this._projScreenMatrix;l.setFromMatrixPosition(e.matrixWorld),n.position.copy(l),h.copy(n.position),h.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(h),n.updateMatrixWorld(),i.makeTranslation(-l.x,-l.y,-l.z),g.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(g)}}),Au.prototype=Object.assign(Object.create(di.prototype),{constructor:Au,isPointLight:!0,copy:function(e){return di.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Xl.prototype=Object.assign(Object.create(Ur.prototype),{constructor:Xl,isOrthographicCamera:!0,copy:function(e,t){return Ur.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,i,l,h){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=l,this.view.height=h,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,l=n-e,h=n+e,g=i+t,b=i-t;if(this.view!==null&&this.view.enabled){var k=(this.right-this.left)/this.view.fullWidth/this.zoom,F=(this.top-this.bottom)/this.view.fullHeight/this.zoom;h=(l+=k*this.view.offsetX)+k*this.view.width,b=(g-=F*this.view.offsetY)-F*this.view.height}this.projectionMatrix.makeOrthographic(l,h,g,b,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=mn.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}),zi.prototype=Object.assign(Object.create(Go.prototype),{constructor:zi,isDirectionalLightShadow:!0,updateMatrices:function(e){Go.prototype.updateMatrices.call(this,e)}}),ya.prototype=Object.assign(Object.create(di.prototype),{constructor:ya,isDirectionalLight:!0,copy:function(e){return di.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Pu.prototype=Object.assign(Object.create(di.prototype),{constructor:Pu,isAmbientLight:!0}),Ic.prototype=Object.assign(Object.create(di.prototype),{constructor:Ic,isRectAreaLight:!0,copy:function(e){return di.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=di.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Ou.prototype=Object.assign(Object.create(Kr.prototype),{constructor:Ou,load:function(e,t,n,i){var l=this,h=new Hr(l.manager);h.setPath(l.path),h.load(e,function(g){t(l.parse(JSON.parse(g)))},n,i)},parse:function(e){var t=this.textures;function n(k){return t[k]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",k),t[k]}var i=new _u[e.type];if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=new Cn().setHex(e.sheen)),e.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular.setHex(e.specular),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.vertexColors!==void 0&&(i.vertexColors=e.vertexColors),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==1&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.skinning!==void 0&&(i.skinning=e.skinning),e.morphTargets!==void 0&&(i.morphTargets=e.morphTargets),e.morphNormals!==void 0&&(i.morphNormals=e.morphNormals),e.dithering!==void 0&&(i.dithering=e.dithering),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.uniforms!==void 0)for(var l in e.uniforms){var h=e.uniforms[l];switch(i.uniforms[l]={},h.type){case"t":i.uniforms[l].value=n(h.value);break;case"c":i.uniforms[l].value=new Cn().setHex(h.value);break;case"v2":i.uniforms[l].value=new Ve().fromArray(h.value);break;case"v3":i.uniforms[l].value=new Se().fromArray(h.value);break;case"v4":i.uniforms[l].value=new ct().fromArray(h.value);break;case"m3":i.uniforms[l].value=new Be().fromArray(h.value);case"m4":i.uniforms[l].value=new Lt().fromArray(h.value);break;default:i.uniforms[l].value=h.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(var g in e.extensions)i.extensions[g]=e.extensions[g];if(e.shading!==void 0&&(i.flatShading=e.shading===1),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap),i.transparent=!0),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){var b=e.normalScale;Array.isArray(b)===!1&&(b=[b,b]),i.normalScale=new Ve().fromArray(b)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new Ve().fromArray(e.clearcoatNormalScale)),i},setTextures:function(e){return this.textures=e,this}});var vh={decodeText:function(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);for(var t="",n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}};function kc(){X.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function jc(e,t,n,i){typeof n=="number"&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),$n.call(this,e,t,n),this.meshPerAttribute=i||1}function Nc(e){Kr.call(this,e)}kc.prototype=Object.assign(Object.create(X.prototype),{constructor:kc,isInstancedBufferGeometry:!0,copy:function(e){return X.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e=X.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),jc.prototype=Object.assign(Object.create($n.prototype),{constructor:jc,isInstancedBufferAttribute:!0,copy:function(e){return $n.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=$n.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Nc.prototype=Object.assign(Object.create(Kr.prototype),{constructor:Nc,load:function(e,t,n,i){var l=this,h=new Hr(l.manager);h.setPath(l.path),h.load(e,function(g){t(l.parse(JSON.parse(g)))},n,i)},parse:function(e){var t=new(e.isInstancedBufferGeometry?kc:X),n=e.data.index;if(n!==void 0){var i=new As[n.type](n.array);t.setIndex(new $n(i,1))}var l=e.data.attributes;for(var h in l){var g=l[h],b=(i=new As[g.type](g.array),new(g.isInstancedBufferAttribute?jc:$n)(i,g.itemSize,g.normalized));g.name!==void 0&&(b.name=g.name),t.setAttribute(h,b)}var k=e.data.morphAttributes;if(k)for(var h in k){for(var F=k[h],K=[],Q=0,ne=F.length;Q<ne;Q++)g=F[Q],b=new $n(i=new As[g.type](g.array),g.itemSize,g.normalized),g.name!==void 0&&(b.name=g.name),K.push(b);t.morphAttributes[h]=K}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);var U=e.data.groups||e.data.drawcalls||e.data.offsets;if(U!==void 0){Q=0;for(var oe=U.length;Q!==oe;++Q){var ue=U[Q];t.addGroup(ue.start,ue.count,ue.materialIndex)}}var pe=e.data.boundingSphere;if(pe!==void 0){var Te=new Se;pe.center!==void 0&&Te.fromArray(pe.center),t.boundingSphere=new xa(Te,pe.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var As={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray<"u"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ru(e){Kr.call(this,e)}Ru.prototype=Object.assign(Object.create(Kr.prototype),{constructor:Ru,load:function(e,t,n,i){var l=this,h=this.path===""?vh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||h;var g=new Hr(l.manager);g.setPath(this.path),g.load(e,function(b){var k=null;try{k=JSON.parse(b)}catch(K){return i!==void 0&&i(K),void console.error("THREE:ObjectLoader: Can't parse "+e+".",K.message)}var F=k.metadata;F!==void 0&&F.type!==void 0&&F.type.toLowerCase()!=="geometry"?l.parse(k,t):console.error("THREE.ObjectLoader: Can't load "+e)},n,i)},parse:function(e,t){var n=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,n),l=this.parseImages(e.images,function(){t!==void 0&&t(b)}),h=this.parseTextures(e.textures,l),g=this.parseMaterials(e.materials,h),b=this.parseObject(e.object,i,g);return e.animations&&(b.animations=this.parseAnimations(e.animations)),e.images!==void 0&&e.images.length!==0||t!==void 0&&t(b),b},parseShape:function(e){var t={};if(e!==void 0)for(var n=0,i=e.length;n<i;n++){var l=new Es().fromJSON(e[n]);t[l.uuid]=l}return t},parseGeometries:function(e,t){var n={};if(e!==void 0)for(var i=new Nc,l=0,h=e.length;l<h;l++){var g,b=e[l];switch(b.type){case"PlaneGeometry":case"PlaneBufferGeometry":g=new La[b.type](b.width,b.height,b.widthSegments,b.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":g=new La[b.type](b.width,b.height,b.depth,b.widthSegments,b.heightSegments,b.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":g=new La[b.type](b.radius,b.segments,b.thetaStart,b.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":g=new La[b.type](b.radiusTop,b.radiusBottom,b.height,b.radialSegments,b.heightSegments,b.openEnded,b.thetaStart,b.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":g=new La[b.type](b.radius,b.height,b.radialSegments,b.heightSegments,b.openEnded,b.thetaStart,b.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":g=new La[b.type](b.radius,b.widthSegments,b.heightSegments,b.phiStart,b.phiLength,b.thetaStart,b.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":g=new La[b.type](b.radius,b.detail);break;case"RingGeometry":case"RingBufferGeometry":g=new La[b.type](b.innerRadius,b.outerRadius,b.thetaSegments,b.phiSegments,b.thetaStart,b.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":g=new La[b.type](b.radius,b.tube,b.radialSegments,b.tubularSegments,b.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":g=new La[b.type](b.radius,b.tube,b.tubularSegments,b.radialSegments,b.p,b.q);break;case"TubeGeometry":case"TubeBufferGeometry":g=new La[b.type](new gh[b.path.type]().fromJSON(b.path),b.tubularSegments,b.radius,b.radialSegments,b.closed);break;case"LatheGeometry":case"LatheBufferGeometry":g=new La[b.type](b.points,b.segments,b.phiStart,b.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":g=new La[b.type](b.vertices,b.indices,b.radius,b.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var k=[],F=0,K=b.shapes.length;F<K;F++){var Q=t[b.shapes[F]];k.push(Q)}g=new La[b.type](k,b.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(k=[],F=0,K=b.shapes.length;F<K;F++)Q=t[b.shapes[F]],k.push(Q);var ne=b.options.extrudePath;ne!==void 0&&(b.options.extrudePath=new gh[ne.type]().fromJSON(ne)),g=new La[b.type](k,b.options);break;case"BufferGeometry":case"InstancedBufferGeometry":g=i.parse(b);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?g=new THREE.LegacyJSONLoader().parse(b,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+b.type+'"');continue}g.uuid=b.uuid,b.name!==void 0&&(g.name=b.name),g.isBufferGeometry===!0&&b.userData!==void 0&&(g.userData=b.userData),n[b.uuid]=g}return n},parseMaterials:function(e,t){var n={},i={};if(e!==void 0){var l=new Ou;l.setTextures(t);for(var h=0,g=e.length;h<g;h++){var b=e[h];if(b.type==="MultiMaterial"){for(var k=[],F=0;F<b.materials.length;F++){var K=b.materials[F];n[K.uuid]===void 0&&(n[K.uuid]=l.parse(K)),k.push(n[K.uuid])}i[b.uuid]=k}else n[b.uuid]===void 0&&(n[b.uuid]=l.parse(b)),i[b.uuid]=n[b.uuid]}}return i},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],l=ki.parse(i);i.uuid!==void 0&&(l.uuid=i.uuid),t.push(l)}return t},parseImages:function(e,t){var n=this,i={};function l(oe){return n.manager.itemStart(oe),h.load(oe,function(){n.manager.itemEnd(oe)},void 0,function(){n.manager.itemError(oe),n.manager.itemEnd(oe)})}if(e!==void 0&&0<e.length){var h=new za(new os(t));h.setCrossOrigin(this.crossOrigin);for(var g=0,b=e.length;g<b;g++){var k=e[g],F=k.url;if(Array.isArray(F)){i[k.uuid]=[];for(var K=0,Q=F.length;K<Q;K++){var ne=F[K],U=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ne)?ne:n.resourcePath+ne;i[k.uuid].push(l(U))}}else U=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(k.url)?k.url:n.resourcePath+k.url,i[k.uuid]=l(U)}}return i},parseTextures:function(e,t){function n(k,F){return typeof k=="number"?k:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",k),F[k])}var i={};if(e!==void 0)for(var l=0,h=e.length;l<h;l++){var g,b=e[l];b.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',b.uuid),t[b.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",b.image),(g=new(Array.isArray(t[b.image])?oo:nn)(t[b.image])).needsUpdate=!0,g.uuid=b.uuid,b.name!==void 0&&(g.name=b.name),b.mapping!==void 0&&(g.mapping=n(b.mapping,Qh)),b.offset!==void 0&&g.offset.fromArray(b.offset),b.repeat!==void 0&&g.repeat.fromArray(b.repeat),b.center!==void 0&&g.center.fromArray(b.center),b.rotation!==void 0&&(g.rotation=b.rotation),b.wrap!==void 0&&(g.wrapS=n(b.wrap[0],ep),g.wrapT=n(b.wrap[1],ep)),b.format!==void 0&&(g.format=b.format),b.type!==void 0&&(g.type=b.type),b.encoding!==void 0&&(g.encoding=b.encoding),b.minFilter!==void 0&&(g.minFilter=n(b.minFilter,tp)),b.magFilter!==void 0&&(g.magFilter=n(b.magFilter,tp)),b.anisotropy!==void 0&&(g.anisotropy=b.anisotropy),b.flipY!==void 0&&(g.flipY=b.flipY),b.premultiplyAlpha!==void 0&&(g.premultiplyAlpha=b.premultiplyAlpha),b.unpackAlignment!==void 0&&(g.unpackAlignment=b.unpackAlignment),i[b.uuid]=g}return i},parseObject:function(e,t,n){var i;function l(pe){return t[pe]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",pe),t[pe]}function h(pe){if(pe!==void 0){if(Array.isArray(pe)){for(var Te=[],Oe=0,Fe=pe.length;Oe<Fe;Oe++){var Ze=pe[Oe];n[Ze]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Ze),Te.push(n[Ze])}return Te}return n[pe]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",pe),n[pe]}}switch(e.type){case"Scene":i=new Ca,e.background!==void 0&&Number.isInteger(e.background)&&(i.background=new Cn(e.background)),e.fog!==void 0&&(e.fog.type==="Fog"?i.fog=new Ra(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(i.fog=new uu(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new Dr(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(i.focus=e.focus),e.zoom!==void 0&&(i.zoom=e.zoom),e.filmGauge!==void 0&&(i.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(i.filmOffset=e.filmOffset),e.view!==void 0&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new Xl(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(i.zoom=e.zoom),e.view!==void 0&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new Pu(e.color,e.intensity);break;case"DirectionalLight":i=new ya(e.color,e.intensity);break;case"PointLight":i=new Au(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new Ic(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new ql(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new Eu(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var g=l(e.geometry),b=h(e.material);i=new(g.bones&&0<g.bones.length?Cl:Vr)(g,b);break;case"InstancedMesh":g=l(e.geometry),b=h(e.material);var k=e.count,F=e.instanceMatrix;(i=new oc(g,b,k)).instanceMatrix=new $n(new Float32Array(F.array),16);break;case"LOD":i=new Tl;break;case"Line":i=new Ma(l(e.geometry),h(e.material),e.mode);break;case"LineLoop":i=new qs(l(e.geometry),h(e.material));break;case"LineSegments":i=new Mi(l(e.geometry),h(e.material));break;case"PointCloud":case"Points":i=new Xs(l(e.geometry),h(e.material));break;case"Sprite":i=new co(h(e.material));break;case"Group":i=new wr;break;default:i=new mn}if(i.uuid=e.uuid,e.name!==void 0&&(i.name=e.name),e.matrix!==void 0?(i.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(e.position!==void 0&&i.position.fromArray(e.position),e.rotation!==void 0&&i.rotation.fromArray(e.rotation),e.quaternion!==void 0&&i.quaternion.fromArray(e.quaternion),e.scale!==void 0&&i.scale.fromArray(e.scale)),e.castShadow!==void 0&&(i.castShadow=e.castShadow),e.receiveShadow!==void 0&&(i.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(i.shadow.bias=e.shadow.bias),e.shadow.radius!==void 0&&(i.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&i.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(i.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(i.visible=e.visible),e.frustumCulled!==void 0&&(i.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(i.renderOrder=e.renderOrder),e.userData!==void 0&&(i.userData=e.userData),e.layers!==void 0&&(i.layers.mask=e.layers),e.children!==void 0)for(var K=e.children,Q=0;Q<K.length;Q++)i.add(this.parseObject(K[Q],t,n));if(e.type==="LOD"){e.autoUpdate!==void 0&&(i.autoUpdate=e.autoUpdate);for(var ne=e.levels,U=0;U<ne.length;U++){var oe=ne[U],ue=i.getObjectByProperty("uuid",oe.object);ue!==void 0&&i.addLevel(ue,oe.distance)}}return i}});var Vc,Qh={UVMapping:300,CubeReflectionMapping:I,CubeRefractionMapping:H,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:G,SphericalReflectionMapping:305,CubeUVReflectionMapping:L,CubeUVRefractionMapping:y},ep={RepeatWrapping:D,ClampToEdgeWrapping:C,MirroredRepeatWrapping:B},tp={NearestFilter:z,NearestMipmapNearestFilter:A,NearestMipmapLinearFilter:S,LinearFilter:q,LinearMipmapNearestFilter:W,LinearMipmapLinearFilter:_};function xh(e){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Kr.call(this,e),this.options=void 0}function wh(){this.type="ShapePath",this.color=new Cn,this.subPaths=[],this.currentPath=null}function bh(e){this.type="Font",this.data=e}function yp(e,t,n,i,l){var h=l.glyphs[e]||l.glyphs["?"];if(h){var g,b,k,F,K,Q,ne,U,oe=new wh;if(h.o)for(var ue=h._cachedOutline||(h._cachedOutline=h.o.split(" ")),pe=0,Te=ue.length;pe<Te;)switch(ue[pe++]){case"m":g=ue[pe++]*t+n,b=ue[pe++]*t+i,oe.moveTo(g,b);break;case"l":g=ue[pe++]*t+n,b=ue[pe++]*t+i,oe.lineTo(g,b);break;case"q":k=ue[pe++]*t+n,F=ue[pe++]*t+i,K=ue[pe++]*t+n,Q=ue[pe++]*t+i,oe.quadraticCurveTo(K,Q,k,F);break;case"b":k=ue[pe++]*t+n,F=ue[pe++]*t+i,K=ue[pe++]*t+n,Q=ue[pe++]*t+i,ne=ue[pe++]*t+n,U=ue[pe++]*t+i,oe.bezierCurveTo(K,Q,ne,U,k,F)}return{offsetX:h.ha*t,path:oe}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+l.familyName+".")}function Fc(e){Kr.call(this,e)}xh.prototype=Object.assign(Object.create(Kr.prototype),{constructor:xh,setOptions:function(e){return this.options=e,this},load:function(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var l=this,h=il.get(e);if(h!==void 0)return l.manager.itemStart(e),setTimeout(function(){t&&t(h),l.manager.itemEnd(e)},0),h;fetch(e).then(function(g){return g.blob()}).then(function(g){return l.options===void 0?createImageBitmap(g):createImageBitmap(g,l.options)}).then(function(g){il.add(e,g),t&&t(g),l.manager.itemEnd(e)}).catch(function(g){i&&i(g),l.manager.itemError(e),l.manager.itemEnd(e)}),l.manager.itemStart(e)}}),Object.assign(wh.prototype,{moveTo:function(e,t){return this.currentPath=new Ua,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this},bezierCurveTo:function(e,t,n,i,l,h){return this.currentPath.bezierCurveTo(e,t,n,i,l,h),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(wt){for(var sn=[],gn=0,Jn=wt.length;gn<Jn;gn++){var Gn=wt[gn],Nn=new Es;Nn.curves=Gn.curves,sn.push(Nn)}return sn}function i(wt,sn){for(var gn=sn.length,Jn=!1,Gn=gn-1,Nn=0;Nn<gn;Gn=Nn++){var sr=sn[Gn],Tn=sn[Nn],je=Tn.x-sr.x,nt=Tn.y-sr.y;if(Math.abs(nt)>Number.EPSILON){if(nt<0&&(sr=sn[Nn],je=-je,Tn=sn[Gn],nt=-nt),wt.y<sr.y||wt.y>Tn.y)continue;if(wt.y===sr.y){if(wt.x===sr.x)return 1}else{var Jt=nt*(wt.x-sr.x)-je*(wt.y-sr.y);if(Jt==0)return 1;if(Jt<0)continue;Jn=!Jn}}else{if(wt.y!==sr.y)continue;if(Tn.x<=wt.x&&wt.x<=sr.x||sr.x<=wt.x&&wt.x<=Tn.x)return 1}}return Jn}var l=jo.isClockWise,h=this.subPaths;if(h.length===0)return[];if(t===!0)return n(h);var g,b,k,F=[];if(h.length===1)return b=h[0],(k=new Es).curves=b.curves,F.push(k),F;var K=!l(h[0].getPoints());K=e?!K:K;var Q,ne,U=[],oe=[],ue=[],pe=0;oe[pe]=void 0,ue[pe]=[];for(var Te=0,Oe=h.length;Te<Oe;Te++)g=l(Q=(b=h[Te]).getPoints()),(g=e?!g:g)?(!K&&oe[pe]&&pe++,oe[pe]={s:new Es,p:Q},oe[pe].s.curves=b.curves,K&&pe++,ue[pe]=[]):ue[pe].push({h:b,p:Q[0]});if(!oe[0])return n(h);if(1<oe.length){for(var Fe=!1,Ze=[],Ge=0,et=oe.length;Ge<et;Ge++)U[Ge]=[];for(Ge=0,et=oe.length;Ge<et;Ge++)for(var We=ue[Ge],ft=0;ft<We.length;ft++){for(var _t=We[ft],Et=!0,At=0;At<oe.length;At++)i(_t.p,oe[At].p)&&(Ge!==At&&Ze.push({froms:Ge,tos:At,hole:ft}),Et?(Et=!1,U[At].push(_t)):Fe=!0);Et&&U[Ge].push(_t)}0<Ze.length&&(Fe||(ue=U))}Te=0;for(var Nt=oe.length;Te<Nt;Te++){k=oe[Te].s,F.push(k);for(var Xt=0,Tt=(ne=ue[Te]).length;Xt<Tt;Xt++)k.holes.push(ne[Xt].h)}return F}}),Object.assign(bh.prototype,{isFont:!0,generateShapes:function(e,t){t===void 0&&(t=100);for(var n=[],i=function(g,b,k){for(var F=Array.from?Array.from(g):String(g).split(""),K=b/k.resolution,Q=(k.boundingBox.yMax-k.boundingBox.yMin+k.underlineThickness)*K,ne=[],U=0,oe=0,ue=0;ue<F.length;ue++){var pe=F[ue];if(pe===`
`)U=0,oe-=Q;else{var Te=yp(pe,K,U,oe,k);U+=Te.offsetX,ne.push(Te.path)}}return ne}(e,t,this.data),l=0,h=i.length;l<h;l++)Array.prototype.push.apply(n,i[l].toShapes());return n}}),Fc.prototype=Object.assign(Object.create(Kr.prototype),{constructor:Fc,load:function(e,t,n,i){var l=this,h=new Hr(this.manager);h.setPath(this.path),h.load(e,function(g){var b;try{b=JSON.parse(g)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),b=JSON.parse(g.substring(65,g.length-2))}var k=l.parse(b);t&&t(k)},n,i)},parse:function(e){return new bh(e)}});var Lu={getContext:function(){return Vc===void 0&&(Vc=new(window.AudioContext||window.webkitAudioContext)),Vc},setContext:function(e){Vc=e}};function Bc(e){Kr.call(this,e)}function Iu(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new Se)}function Qa(e,t){di.call(this,void 0,t),this.sh=e!==void 0?e:new Iu}function Mh(e,t,n){Qa.call(this,void 0,n);var i=new Cn().set(e),l=new Cn().set(t),h=new Se(i.r,i.g,i.b),g=new Se(l.r,l.g,l.b),b=Math.sqrt(Math.PI),k=b*Math.sqrt(.75);this.sh.coefficients[0].copy(h).add(g).multiplyScalar(b),this.sh.coefficients[1].copy(h).sub(g).multiplyScalar(k)}function _h(e,t){Qa.call(this,void 0,t);var n=new Cn().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}Bc.prototype=Object.assign(Object.create(Kr.prototype),{constructor:Bc,load:function(e,t,n,i){var l=new Hr(this.manager);l.setResponseType("arraybuffer"),l.setPath(this.path),l.load(e,function(h){var g=h.slice(0);Lu.getContext().decodeAudioData(g,function(b){t(b)})},n,i)}}),Object.assign(Iu.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var n=e.x,i=e.y,l=e.z,h=this.coefficients;return t.copy(h[0]).multiplyScalar(.282095),t.addScale(h[1],.488603*i),t.addScale(h[2],.488603*l),t.addScale(h[3],.488603*n),t.addScale(h[4],n*i*1.092548),t.addScale(h[5],i*l*1.092548),t.addScale(h[6],.315392*(3*l*l-1)),t.addScale(h[7],n*l*1.092548),t.addScale(h[8],.546274*(n*n-i*i)),t},getIrradianceAt:function(e,t){var n=e.x,i=e.y,l=e.z,h=this.coefficients;return t.copy(h[0]).multiplyScalar(.886227),t.addScale(h[1],1.023328*i),t.addScale(h[2],1.023328*l),t.addScale(h[3],1.023328*n),t.addScale(h[4],.858086*n*i),t.addScale(h[5],.858086*i*l),t.addScale(h[6],.743125*l*l-.247708),t.addScale(h[7],.858086*n*l),t.addScale(h[8],.429043*(n*n-i*i)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return new this.constructor().copy(this)},fromArray:function(e,t){t===void 0&&(t=0);for(var n=this.coefficients,i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);for(var n=this.coefficients,i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}}),Object.assign(Iu,{getBasisAt:function(e,t){var n=e.x,i=e.y,l=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*l,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*l,t[6]=.315392*(3*l*l-1),t[7]=1.092548*n*l,t[8]=.546274*(n*n-i*i)}}),Qa.prototype=Object.assign(Object.create(di.prototype),{constructor:Qa,isLightProbe:!0,copy:function(e){return di.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return di.prototype.toJSON.call(this,e)}}),Mh.prototype=Object.assign(Object.create(Qa.prototype),{constructor:Mh,isHemisphereLightProbe:!0,copy:function(e){return Qa.prototype.copy.call(this,e),this},toJSON:function(e){return Qa.prototype.toJSON.call(this,e)}}),_h.prototype=Object.assign(Object.create(Qa.prototype),{constructor:_h,isAmbientLightProbe:!0,copy:function(e){return Qa.prototype.copy.call(this,e),this},toJSON:function(e){return Qa.prototype.toJSON.call(this,e)}});var Ia=new Lt,ku=new Lt;function np(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Dr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Dr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Th(e){this.autoStart=e===void 0||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(np.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n,i,l=e.projectionMatrix.clone(),h=t.eyeSep/2,g=h*t.near/t.focus,b=t.near*Math.tan(Qt.DEG2RAD*t.fov*.5)/t.zoom;ku.elements[12]=-h,Ia.elements[12]=h,n=-b*t.aspect+g,i=b*t.aspect+g,l.elements[0]=2*t.near/(i-n),l.elements[8]=(i+n)/(i-n),this.cameraL.projectionMatrix.copy(l),n=-b*t.aspect-g,i=b*t.aspect-g,l.elements[0]=2*t.near/(i-n),l.elements[8]=(i+n)/(i-n),this.cameraR.projectionMatrix.copy(l)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(ku),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Ia)}}),Object.assign(Th.prototype,{start:function(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=(typeof performance>"u"?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var ls=new Se,ju=new bn,vp=new Se,sl=new Se;function Ch(){mn.call(this),this.type="AudioListener",this.context=Lu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Th}function ll(e){mn.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}Ch.prototype=Object.assign(Object.create(mn.prototype),{constructor:Ch,getInput:function(){return this.gain},removeFilter:function(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){mn.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ls,ju,vp),sl.set(0,0,-1).applyQuaternion(ju),t.positionX){var i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(ls.x,i),t.positionY.linearRampToValueAtTime(ls.y,i),t.positionZ.linearRampToValueAtTime(ls.z,i),t.forwardX.linearRampToValueAtTime(sl.x,i),t.forwardY.linearRampToValueAtTime(sl.y,i),t.forwardZ.linearRampToValueAtTime(sl.z,i),t.upX.linearRampToValueAtTime(n.x,i),t.upY.linearRampToValueAtTime(n.y,i),t.upZ.linearRampToValueAtTime(n.z,i)}else t.setPosition(ls.x,ls.y,ls.z),t.setOrientation(sl.x,sl.y,sl.z,n.x,n.y,n.z)}}),ll.prototype=Object.assign(Object.create(mn.prototype),{constructor:ll,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(e===void 0&&(e=0),this.isPlaying!==!0){if(this.hasPlaybackControl!==!1){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(this.hasPlaybackControl!==!1)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e=e||[],this.isPlaying===!0?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var cl=new Se,rp=new bn,Sh=new Se,cs=new Se;function Gc(e){ll.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Dh(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t!==void 0?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Eh(e,t,n){this.binding=e,this.valueSize=n;var i,l=Float64Array;switch(t){case"quaternion":i=this._slerp;break;case"string":case"bool":l=Array,i=this._select;break;default:i=this._lerp}this.buffer=new l(4*n),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Gc.prototype=Object.assign(Object.create(ll.prototype),{constructor:Gc,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(e){if(mn.prototype.updateMatrixWorld.call(this,e),this.hasPlaybackControl!==!0||this.isPlaying!==!1){this.matrixWorld.decompose(cl,rp,Sh),cs.set(0,0,1).applyQuaternion(rp);var t=this.panner;if(t.positionX){var n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(cl.x,n),t.positionY.linearRampToValueAtTime(cl.y,n),t.positionZ.linearRampToValueAtTime(cl.z,n),t.orientationX.linearRampToValueAtTime(cs.x,n),t.orientationY.linearRampToValueAtTime(cs.y,n),t.orientationZ.linearRampToValueAtTime(cs.z,n)}else t.setPosition(cl.x,cl.y,cl.z),t.setOrientation(cs.x,cs.y,cs.z)}}}),Object.assign(Dh.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(Eh.prototype,{accumulate:function(e,t){var n=this.buffer,i=this.valueSize,l=e*i+i,h=this.cumulativeWeight;if(h===0){for(var g=0;g!==i;++g)n[l+g]=n[g];h=t}else{var b=t/(h+=t);this._mixBufferRegion(n,l,0,b,i)}this.cumulativeWeight=h},apply:function(e){var t=this.valueSize,n=this.buffer,i=e*t+t,l=this.cumulativeWeight,h=this.binding;if(this.cumulativeWeight=0,l<1){var g=3*t;this._mixBufferRegion(n,i,g,1-l,t)}for(var b=t,k=t+t;b!==k;++b)if(n[b]!==n[b+t]){h.setValue(n,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,i=3*n;e.getValue(t,i);for(var l=n,h=i;l!==h;++l)t[l]=t[i+l%n];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,n,i,l){if(.5<=i)for(var h=0;h!==l;++h)e[t+h]=e[n+h]},_slerp:function(e,t,n,i){bn.slerpFlat(e,t,e,t,e,n,i)},_lerp:function(e,t,n,i,l){for(var h=1-i,g=0;g!==l;++g){var b=t+g;e[b]=e[b]*h+e[n+g]*i}}});var Ah="\\[\\]\\.:\\/",xp=new RegExp("["+Ah+"]","g"),Ph="[^"+Ah+"]",wp="[^"+Ah.replace("\\.","")+"]",bp=/((?:WC+[\/:])*)/.source.replace("WC",Ph),s=/(WCOD+)?/.source.replace("WCOD",wp),d=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ph),j=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ph),ie=new RegExp("^"+bp+s+d+j+"$"),he=["material","materials","bones"];function Ee(e,t,n){var i=n||Ue.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function Ue(e,t,n){this.path=t,this.parsedPath=n||Ue.parseTrackName(t),this.node=Ue.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function it(){this.uuid=Qt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}function yt(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null;for(var i=t.tracks,l=i.length,h=new Array(l),g={endingStart:Ie,endingEnd:Ie},b=0;b!==l;++b){var k=i[b].createInterpolant(null);(h[b]=k).settings=g}this._interpolantSettings=g,this._interpolants=h,this._propertyBindings=new Array(l),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Vt(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Ft(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function $t(e,t,n){Qo.call(this,e,t),this.meshPerAttribute=n||1}function On(e,t,n,i){this.ray=new se(e,t),this.near=n||0,this.far=i||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Bn(e,t){return e.distance-t.distance}function Yn(e,t,n,i){if(e.visible!==!1&&(e.raycast(t,n),i===!0))for(var l=e.children,h=0,g=l.length;h<g;h++)Yn(l[h],t,n,!0)}function Ut(e,t,n){return this.radius=e!==void 0?e:1,this.phi=t!==void 0?t:0,this.theta=n!==void 0?n:0,this}function tn(e,t,n){return this.radius=e!==void 0?e:1,this.theta=t!==void 0?t:0,this.y=n!==void 0?n:0,this}Object.assign(Ee.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,l=n.length;i!==l;++i)n[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(Ue,{Composite:Ee,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new Ue.Composite(e,t,n):new Ue(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(xp,"")},parseTrackName:function(e){var t=ie.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){var l=n.nodeName.substring(i+1);he.indexOf(l)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=l)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||t===""||t==="root"||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){var i=function(h){for(var g=0;g<h.length;g++){var b=h[g];if(b.name===t||b.uuid===t)return b;var k=i(b.children);if(k)return k}return null},l=i(e.children);if(l)return l}return null}}),Object.assign(Ue.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,i=0,l=n.length;i!==l;++i)e[t++]=n[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,i=0,l=n.length;i!==l;++i)n[i]=e[t++]},function(e,t){for(var n=this.resolvedProperty,i=0,l=n.length;i!==l;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,i=0,l=n.length;i!==l;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,l=t.propertyIndex;if(e||(e=Ue.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var h=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var g=0;g<e.length;g++)if(e[g].name===h){h=g;break}break;default:if(e[n]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(h!==void 0){if(e[h]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[h]}}var b=e[i];if(b!==void 0){var k=this.Versioning.None;(this.targetObject=e).needsUpdate!==void 0?k=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(k=this.Versioning.MatrixWorldNeedsUpdate);var F=this.BindingType.Direct;if(l!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(g=0;g<this.node.geometry.morphAttributes.position.length;g++)if(e.geometry.morphAttributes.position[g].name===l){l=g;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(g=0;g<this.node.geometry.morphTargets.length;g++)if(e.geometry.morphTargets[g].name===l){l=g;break}}}F=this.BindingType.ArrayElement,this.resolvedProperty=b,this.propertyIndex=l}else b.fromArray!==void 0&&b.toArray!==void 0?(F=this.BindingType.HasFromToArray,this.resolvedProperty=b):Array.isArray(b)?(F=this.BindingType.EntireArray,this.resolvedProperty=b):this.propertyName=i;this.getValue=this.GetterByBindingType[F],this.setValue=this.SetterByBindingTypeAndVersioning[F][k]}else{var K=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+K+"."+i+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Ue.prototype,{_getValue_unbound:Ue.prototype.getValue,_setValue_unbound:Ue.prototype.setValue}),Object.assign(it.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,l=this._paths,h=this._parsedPaths,g=this._bindings,b=g.length,k=void 0,F=0,K=arguments.length;F!==K;++F){var Q=arguments[F],ne=Q.uuid,U=i[ne];if(U===void 0){U=t++,i[ne]=U,e.push(Q);for(var oe=0,ue=b;oe!==ue;++oe)g[oe].push(new Ue(Q,l[oe],h[oe]))}else if(U<n){k=e[U];var pe=--n,Te=e[pe];for(e[i[Te.uuid]=U]=Te,e[i[ne]=pe]=Q,oe=0,ue=b;oe!==ue;++oe){var Oe=g[oe],Fe=Oe[pe],Ze=Oe[U];Oe[U]=Fe,Ze===void 0&&(Ze=new Ue(Q,l[oe],h[oe])),Oe[pe]=Ze}}else e[U]!==k&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,l=i.length,h=0,g=arguments.length;h!==g;++h){var b=arguments[h],k=b.uuid,F=n[k];if(F!==void 0&&t<=F){var K=t++,Q=e[K];e[n[Q.uuid]=F]=Q,e[n[k]=K]=b;for(var ne=0,U=l;ne!==U;++ne){var oe=i[ne],ue=oe[K],pe=oe[F];oe[F]=ue,oe[K]=pe}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,l=this._bindings,h=l.length,g=0,b=arguments.length;g!==b;++g){var k=arguments[g].uuid,F=i[k];if(F!==void 0)if(delete i[k],F<n){var K=--n,Q=e[K],ne=e[Te=--t];e[i[Q.uuid]=F]=Q,e[i[ne.uuid]=K]=ne,e.pop();for(var U=0,oe=h;U!==oe;++U){var ue=(Oe=l[U])[K],pe=Oe[Te];Oe[F]=ue,Oe[K]=pe,Oe.pop()}}else{var Te;for(e[i[(ne=e[Te=--t]).uuid]=F]=ne,e.pop(),U=0,oe=h;U!==oe;++U){var Oe;(Oe=l[U])[F]=Oe[Te],Oe.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,i=n[e],l=this._bindings;if(i!==void 0)return l[i];var h=this._paths,g=this._parsedPaths,b=this._objects,k=b.length,F=this.nCachedObjects_,K=new Array(k);i=l.length,n[e]=i,h.push(e),g.push(t),l.push(K);for(var Q=F,ne=b.length;Q!==ne;++Q){var U=b[Q];K[Q]=new Ue(U,e,t)}return K},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){var i=this._paths,l=this._parsedPaths,h=this._bindings,g=h.length-1,b=h[g];h[t[e[g]]=n]=b,h.pop(),l[n]=l[g],l.pop(),i[n]=i[g],i.pop()}}}),Object.assign(yt.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var i=this._clip.duration,l=e._clip.duration,h=l/i,g=i/l;e.warp(1,h,t),this.warp(g,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var i=this._mixer,l=i.time,h=this._timeScaleInterpolant,g=this.timeScale;h===null&&(h=i._lendControlInterpolant(),this._timeScaleInterpolant=h);var b=h.parameterPositions,k=h.sampleValues;return b[0]=l,b[1]=l+n,k[0]=e/g,k[1]=t/g,this},stopWarping:function(){var e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,i){if(this.enabled){var l=this._startTime;if(l!==null){var h=(e-l)*n;if(h<0||n===0)return;this._startTime=null,t=n*h}t*=this._updateTimeScale(e);var g=this._updateTime(t),b=this._updateWeight(e);if(0<b)for(var k=this._interpolants,F=this._propertyBindings,K=0,Q=k.length;K!==Q;++K)k[K].evaluate(g),F[K].accumulate(i,b)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(n!==null){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;n!==null&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t},_updateTime:function(e){var t=this.time+e,n=this._clip.duration,i=this.loop,l=this._loopCount,h=i===2202;if(e===0)return l===-1||!h||1&~l?t:n-t;if(i===2200){l===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n<=t)t=n;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(l===-1&&(0<=e?(l=0,this._setEndings(!0,this.repetitions===0,h)):this._setEndings(this.repetitions===0,!0,h)),n<=t||t<0){var g=Math.floor(t/n);t-=n*g,l+=Math.abs(g);var b=this.repetitions-l;if(b<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=0<e?n:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1});else{if(b==1){var k=e<0;this._setEndings(k,!k,h)}else this._setEndings(!1,!1,h);this._loopCount=l,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:g})}}else this.time=t;if(h&&!(1&~l))return n-t}return t},_setEndings:function(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=ze,i.endingEnd=ze):(i.endingStart=e?this.zeroSlopeAtStart?ze:Ie:He,i.endingEnd=t?this.zeroSlopeAtEnd?ze:Ie:He)},_scheduleFading:function(e,t,n){var i=this._mixer,l=i.time,h=this._weightInterpolant;h===null&&(h=i._lendControlInterpolant(),this._weightInterpolant=h);var g=h.parameterPositions,b=h.sampleValues;return g[0]=l,b[0]=t,g[1]=l+e,b[1]=n,this}}),Vt.prototype=Object.assign(Object.create(bt.prototype),{constructor:Vt,_bindAction:function(e,t){var n=e._localRoot||this._root,i=e._clip.tracks,l=i.length,h=e._propertyBindings,g=e._interpolants,b=n.uuid,k=this._bindingsByRootAndName,F=k[b];F===void 0&&(F={},k[b]=F);for(var K=0;K!==l;++K){var Q=i[K],ne=Q.name,U=F[ne];if(U!==void 0)h[K]=U;else{if((U=h[K])!==void 0){U._cacheIndex===null&&(++U.referenceCount,this._addInactiveBinding(U,b,ne));continue}var oe=t&&t._propertyBindings[K].binding.parsedPath;++(U=new Eh(Ue.create(n,ne,oe),Q.ValueTypeName,Q.getValueSize())).referenceCount,this._addInactiveBinding(U,b,ne),h[K]=U}g[K].resultBuffer=U.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}for(var l=e._propertyBindings,h=0,g=l.length;h!==g;++h){var b=l[h];b.useCount++==0&&(this._lendBinding(b),b.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var l=t[n];--l.useCount==0&&(l.restoreOriginalState(),this._takeBackBinding(l))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return t!==null&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var i=this._actions,l=this._actionsByClip,h=l[t];if(h===void 0)h={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,l[t]=h;else{var g=h.knownActions;e._byClipCacheIndex=g.length,g.push(e)}e._cacheIndex=i.length,i.push(e),h.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex;t[n._cacheIndex=i]=n,t.pop(),e._cacheIndex=null;var l=e._clip.uuid,h=this._actionsByClip,g=h[l],b=g.knownActions,k=b[b.length-1],F=e._byClipCacheIndex;b[k._byClipCacheIndex=F]=k,b.pop(),e._byClipCacheIndex=null,delete g.actionByRoot[(e._localRoot||this._root).uuid],b.length===0&&delete h[l],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var l=t[n];--l.referenceCount==0&&this._removeInactiveBinding(l)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,l=t[i];t[e._cacheIndex=i]=e,t[l._cacheIndex=n]=l},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,l=t[i];t[e._cacheIndex=i]=e,t[l._cacheIndex=n]=l},_addInactiveBinding:function(e,t,n){var i=this._bindingsByRootAndName,l=i[t],h=this._bindings;l===void 0&&(l={},i[t]=l),(l[n]=e)._cacheIndex=h.length,h.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,l=n.path,h=this._bindingsByRootAndName,g=h[i],b=t[t.length-1],k=e._cacheIndex;t[b._cacheIndex=k]=b,t.pop(),delete g[l],Object.keys(g).length===0&&delete h[i]},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,l=t[i];t[e._cacheIndex=i]=e,t[l._cacheIndex=n]=l},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,l=t[i];t[e._cacheIndex=i]=e,t[l._cacheIndex=n]=l},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return n===void 0&&(e[(n=new zl(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,l=t[i];t[e.__cacheIndex=i]=e,t[l.__cacheIndex=n]=l},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var n=t||this._root,i=n.uuid,l=typeof e=="string"?ki.findByName(n,e):e,h=l!==null?l.uuid:e,g=this._actionsByClip[h],b=null;if(g!==void 0){var k=g.actionByRoot[i];if(k!==void 0)return k;b=g.knownActions[0],l===null&&(l=b._clip)}if(l===null)return null;var F=new yt(this,l,t);return this._bindAction(F,b),this._addInactiveAction(F,h,i),F},existingAction:function(e,t){var n=t||this._root,i=n.uuid,l=typeof e=="string"?ki.findByName(n,e):e,h=l?l.uuid:e,g=this._actionsByClip[h];return g!==void 0&&g.actionByRoot[i]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,n=this._bindings,i=this._nActiveBindings;this._nActiveActions=0;for(var l=this._nActiveBindings=0;l!==t;++l)e[l].reset();for(l=0;l!==i;++l)n[l].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,i=this.time+=e,l=Math.sign(e),h=this._accuIndex^=1,g=0;g!==n;++g)t[g]._update(i,e,l,h);var b=this._bindings,k=this._nActiveBindings;for(g=0;g!==k;++g)b[g].apply(h);return this},setTime:function(e){for(var t=this.time=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,i=this._actionsByClip,l=i[n];if(l!==void 0){for(var h=l.knownActions,g=0,b=h.length;g!==b;++g){var k=h[g];this._deactivateAction(k);var F=k._cacheIndex,K=t[t.length-1];k._cacheIndex=null,k._byClipCacheIndex=null,t[K._cacheIndex=F]=K,t.pop(),this._removeInactiveBindingsForAction(k)}delete i[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var i in n){var l=n[i].actionByRoot[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}var h=this._bindingsByRootAndName[t];if(h!==void 0)for(var g in h){var b=h[g];b.restoreOriginalState(),this._removeInactiveBinding(b)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),Ft.prototype.clone=function(){return new Ft(this.value.clone===void 0?this.value:this.value.clone())},$t.prototype=Object.assign(Object.create(Qo.prototype),{constructor:$t,isInstancedInterleavedBuffer:!0,copy:function(e){return Qo.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(On.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){var i=n||[];return Yn(e,this,i,t),i.sort(Bn),i},intersectObjects:function(e,t,n){var i=n||[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var l=0,h=e.length;l<h;l++)Yn(e[l],this,i,t);return i.sort(Bn),i}}),Object.assign(Ut.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Qt.clamp(t/this.radius,-1,1))),this}}),Object.assign(tn.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}});var ar=new Ve;function fn(e,t){this.min=e!==void 0?e:new Ve(1/0,1/0),this.max=t!==void 0?t:new Ve(-1/0,-1/0)}Object.assign(fn.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=ar.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Ve),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Ve),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Ve),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Ve),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return ar.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var mr=new Se,cr=new Se;function Gr(e,t){this.start=e!==void 0?e:new Se,this.end=t!==void 0?t:new Se}function Un(e){mn.call(this),this.material=e,this.render=function(){}}Object.assign(Gr.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return e===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Se),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return e===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Se),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return t===void 0&&(console.warn("THREE.Line3: .at() target is now required"),t=new Se),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){mr.subVectors(e,this.start),cr.subVectors(this.end,this.start);var n=cr.dot(cr),i=cr.dot(mr)/n;return t&&(i=Qt.clamp(i,0,1)),i},closestPointToPoint:function(e,t,n){var i=this.closestPointToPointParameter(e,t);return n===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Se),this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),((Un.prototype=Object.create(mn.prototype)).constructor=Un).prototype.isImmediateRenderObject=!0;var or=new Se;function ji(e,t){mn.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var n=new X,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],l=0,h=1;l<32;l++,h++){var g=l/32*Math.PI*2,b=h/32*Math.PI*2;i.push(Math.cos(g),Math.sin(g),1,Math.cos(b),Math.sin(b),1)}n.setAttribute("position",new ln(i,3));var k=new si({fog:!1});this.cone=new Mi(n,k),this.add(this.cone),this.update()}((ji.prototype=Object.create(mn.prototype)).constructor=ji).prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},ji.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),or.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(or),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var ri=new Se,ca=new Lt,li=new Lt;function ea(e){for(var t=function K(Q){var ne=[];Q&&Q.isBone&&ne.push(Q);for(var U=0;U<Q.children.length;U++)ne.push.apply(ne,K(Q.children[U]));return ne}(e),n=new X,i=[],l=[],h=new Cn(0,0,1),g=new Cn(0,1,0),b=0;b<t.length;b++){var k=t[b];k.parent&&k.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),l.push(h.r,h.g,h.b),l.push(g.r,g.g,g.b))}n.setAttribute("position",new ln(i,3)),n.setAttribute("color",new ln(l,3));var F=new si({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});Mi.call(this,n,F),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function eo(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;var i=new Ts(t,4,2),l=new Xa({wireframe:!0,fog:!1});Vr.call(this,i,l),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}((ea.prototype=Object.create(Mi.prototype)).constructor=ea).prototype.updateMatrixWorld=function(e){var t=this.bones,n=this.geometry,i=n.getAttribute("position");li.getInverse(this.root.matrixWorld);for(var l=0,h=0;l<t.length;l++){var g=t[l];g.parent&&g.parent.isBone&&(ca.multiplyMatrices(li,g.matrixWorld),ri.setFromMatrixPosition(ca),i.setXYZ(h,ri.x,ri.y,ri.z),ca.multiplyMatrices(li,g.parent.matrixWorld),ri.setFromMatrixPosition(ca),i.setXYZ(h+1,ri.x,ri.y,ri.z),h+=2)}n.getAttribute("position").needsUpdate=!0,mn.prototype.updateMatrixWorld.call(this,e)},((eo.prototype=Object.create(Vr.prototype)).constructor=eo).prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},eo.prototype.update=function(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var Ps=new Se,Os=new Cn,zo=new Cn;function zc(e,t,n){mn.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var i=new bs(t);i.rotateY(.5*Math.PI),this.material=new Xa({wireframe:!0,fog:!1}),this.color===void 0&&(this.material.vertexColors=2);var l=i.getAttribute("position"),h=new Float32Array(3*l.count);i.setAttribute("color",new $n(h,3)),this.add(new Vr(i,this.material)),this.update()}function Uc(e,t,n,i){e=e||10,t=t||10,n=new Cn(n!==void 0?n:4473924),i=new Cn(i!==void 0?i:8947848);for(var l=t/2,h=e/t,g=e/2,b=[],k=[],F=0,K=0,Q=-g;F<=t;F++,Q+=h){b.push(-g,0,Q,g,0,Q),b.push(Q,0,-g,Q,0,g);var ne=F===l?n:i;ne.toArray(k,K),K+=3,ne.toArray(k,K),K+=3,ne.toArray(k,K),K+=3,ne.toArray(k,K),K+=3}var U=new X;U.setAttribute("position",new ln(b,3)),U.setAttribute("color",new ln(k,3));var oe=new si({vertexColors:2});Mi.call(this,U,oe)}function Yl(e,t,n,i,l,h){e=e||10,t=t||16,n=n||8,i=i||64,l=new Cn(l!==void 0?l:4473924),h=new Cn(h!==void 0?h:8947848);var g,b,k,F,K,Q,ne,U=[],oe=[];for(F=0;F<=t;F++)k=F/t*(2*Math.PI),g=Math.sin(k)*e,b=Math.cos(k)*e,U.push(0,0,0),U.push(g,0,b),ne=1&F?l:h,oe.push(ne.r,ne.g,ne.b),oe.push(ne.r,ne.g,ne.b);for(F=0;F<=n;F++)for(ne=1&F?l:h,Q=e-e/n*F,K=0;K<i;K++)k=K/i*(2*Math.PI),g=Math.sin(k)*Q,b=Math.cos(k)*Q,U.push(g,0,b),oe.push(ne.r,ne.g,ne.b),k=(K+1)/i*(2*Math.PI),g=Math.sin(k)*Q,b=Math.cos(k)*Q,U.push(g,0,b),oe.push(ne.r,ne.g,ne.b);var ue=new X;ue.setAttribute("position",new ln(U,3)),ue.setAttribute("color",new ln(oe,3));var pe=new si({vertexColors:2});Mi.call(this,ue,pe)}((zc.prototype=Object.create(mn.prototype)).constructor=zc).prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},zc.prototype.update=function(){var e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");Os.copy(this.light.color),zo.copy(this.light.groundColor);for(var n=0,i=t.count;n<i;n++){var l=n<i/2?Os:zo;t.setXYZ(n,l.r,l.g,l.b)}t.needsUpdate=!0}e.lookAt(Ps.setFromMatrixPosition(this.light.matrixWorld).negate())},Uc.prototype=Object.assign(Object.create(Mi.prototype),{constructor:Uc,copy:function(e){return Mi.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return new this.constructor().copy(this)}}),(Yl.prototype=Object.create(Mi.prototype)).constructor=Yl;var Nu=new Se,ul=new Se,Hc=new Se;function Wc(e,t,n){mn.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t===void 0&&(t=1);var i=new X;i.setAttribute("position",new ln([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var l=new si({fog:!1});this.lightPlane=new Ma(i,l),this.add(this.lightPlane),(i=new X).setAttribute("position",new ln([0,0,0,0,0,1],3)),this.targetLine=new Ma(i,l),this.add(this.targetLine),this.update()}((Wc.prototype=Object.create(mn.prototype)).constructor=Wc).prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Wc.prototype.update=function(){Nu.setFromMatrixPosition(this.light.matrixWorld),ul.setFromMatrixPosition(this.light.target.matrixWorld),Hc.subVectors(ul,Nu),this.lightPlane.lookAt(ul),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ul),this.targetLine.scale.z=Hc.length()};var hl=new Se,yi=new Ur;function Mp(e){var t=new X,n=new si({color:16777215,vertexColors:1}),i=[],l=[],h={},g=new Cn(16755200),b=new Cn(16711680),k=new Cn(43775),F=new Cn(16777215),K=new Cn(3355443);function Q(U,oe,ue){ne(U,ue),ne(oe,ue)}function ne(U,oe){i.push(0,0,0),l.push(oe.r,oe.g,oe.b),h[U]===void 0&&(h[U]=[]),h[U].push(i.length/3-1)}Q("n1","n2",g),Q("n2","n4",g),Q("n4","n3",g),Q("n3","n1",g),Q("f1","f2",g),Q("f2","f4",g),Q("f4","f3",g),Q("f3","f1",g),Q("n1","f1",g),Q("n2","f2",g),Q("n3","f3",g),Q("n4","f4",g),Q("p","n1",b),Q("p","n2",b),Q("p","n3",b),Q("p","n4",b),Q("u1","u2",k),Q("u2","u3",k),Q("u3","u1",k),Q("c","t",F),Q("p","c",K),Q("cn1","cn2",K),Q("cn3","cn4",K),Q("cf1","cf2",K),Q("cf3","cf4",K),t.setAttribute("position",new ln(i,3)),t.setAttribute("color",new ln(l,3)),Mi.call(this,t,n),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=h,this.update()}function ta(e,t,n,i,l,h,g){hl.set(l,h,g).unproject(i);var b=t[e];if(b!==void 0)for(var k=n.getAttribute("position"),F=0,K=b.length;F<K;F++)k.setXYZ(b[F],hl.x,hl.y,hl.z)}((Mp.prototype=Object.create(Mi.prototype)).constructor=Mp).prototype.update=function(){var e=this.geometry,t=this.pointMap;yi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ta("c",t,e,yi,0,0,-1),ta("t",t,e,yi,0,0,1),ta("n1",t,e,yi,-1,-1,-1),ta("n2",t,e,yi,1,-1,-1),ta("n3",t,e,yi,-1,1,-1),ta("n4",t,e,yi,1,1,-1),ta("f1",t,e,yi,-1,-1,1),ta("f2",t,e,yi,1,-1,1),ta("f3",t,e,yi,-1,1,1),ta("f4",t,e,yi,1,1,1),ta("u1",t,e,yi,.7,1.1,-1),ta("u2",t,e,yi,-.7,1.1,-1),ta("u3",t,e,yi,0,2,-1),ta("cf1",t,e,yi,-1,0,1),ta("cf2",t,e,yi,1,0,1),ta("cf3",t,e,yi,0,-1,1),ta("cf4",t,e,yi,0,1,1),ta("cn1",t,e,yi,-1,0,-1),ta("cn2",t,e,yi,1,0,-1),ta("cn3",t,e,yi,0,-1,-1),ta("cn4",t,e,yi,0,1,-1),e.getAttribute("position").needsUpdate=!0};var ip=new Oi;function Jc(e,t){this.object=e,t===void 0&&(t=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),l=new X;l.setIndex(new $n(n,1)),l.setAttribute("position",new $n(i,3)),Mi.call(this,l,new si({color:t})),this.matrixAutoUpdate=!1,this.update()}function _p(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new X;i.setIndex(new $n(n,1)),i.setAttribute("position",new ln([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Mi.call(this,i,new si({color:t})),this.geometry.computeBoundingSphere()}function Tp(e,t,n){this.type="PlaneHelper",this.plane=e,this.size=t===void 0?1:t;var i=n!==void 0?n:16776960,l=new X;l.setAttribute("position",new ln([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),l.computeBoundingSphere(),Ma.call(this,l,new si({color:i}));var h=new X;h.setAttribute("position",new ln([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),h.computeBoundingSphere(),this.add(new Vr(h,new Xa({color:i,opacity:.2,transparent:!0,depthWrite:!1})))}((Jc.prototype=Object.create(Mi.prototype)).constructor=Jc).prototype.update=function(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&ip.setFromObject(this.object),!ip.isEmpty()){var t=ip.min,n=ip.max,i=this.geometry.attributes.position,l=i.array;l[0]=n.x,l[1]=n.y,l[2]=n.z,l[3]=t.x,l[4]=n.y,l[5]=n.z,l[6]=t.x,l[7]=t.y,l[8]=n.z,l[9]=n.x,l[10]=t.y,l[11]=n.z,l[12]=n.x,l[13]=n.y,l[14]=t.z,l[15]=t.x,l[16]=n.y,l[17]=t.z,l[18]=t.x,l[19]=t.y,l[20]=t.z,l[21]=n.x,l[22]=t.y,l[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}},Jc.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Jc.prototype.copy=function(e){return Mi.prototype.copy.call(this,e),this.object=e.object,this},Jc.prototype.clone=function(){return new this.constructor().copy(this)},((_p.prototype=Object.create(Mi.prototype)).constructor=_p).prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),mn.prototype.updateMatrixWorld.call(this,e))},((Tp.prototype=Object.create(Ma.prototype)).constructor=Tp).prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?1:0,this.lookAt(this.plane.normal),mn.prototype.updateMatrixWorld.call(this,e)};var Cp,Ip,kp=new Se;function qc(e,t,n,i,l,h){mn.call(this),e===void 0&&(e=new Se(0,0,1)),t===void 0&&(t=new Se(0,0,0)),n===void 0&&(n=1),i===void 0&&(i=16776960),l===void 0&&(l=.2*n),h===void 0&&(h=.2*l),Cp===void 0&&((Cp=new X).setAttribute("position",new ln([0,0,0,0,1,0],3)),(Ip=new Cs(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Ma(Cp,new si({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Vr(Ip,new Xa({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,l,h)}function ap(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new X;n.setAttribute("position",new ln(t,3)),n.setAttribute("color",new ln([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new si({vertexColors:2});Mi.call(this,n,i)}((qc.prototype=Object.create(mn.prototype)).constructor=qc).prototype.setDirection=function(e){if(.99999<e.y)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{kp.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(kp,t)}},qc.prototype.setLength=function(e,t,n){t===void 0&&(t=.2*e),n===void 0&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},qc.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},qc.prototype.copy=function(e){return mn.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},qc.prototype.clone=function(){return new this.constructor().copy(this)},(ap.prototype=Object.create(Mi.prototype)).constructor=ap;var jp,Rs=Math.pow(2,8),Np=[.125,.215,.35,.446,.526,.582],Vp=5+Np.length,op=20,Ls={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},Sp=new Xl,sp=((jp=new tl({defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(20)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new Se(0,1,0)},inputEncoding:{value:Ls[at]},outputEncoding:{value:Ls[at]}},vertexShader:`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx;
		direction.z *= -1.0;
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.z *= -1.0;
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.x *= -1.0;
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.y *= -1.0;
	} else if (face == 5.0) {
		direction.xz *= -1.0;
	}
	return direction;
}
void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`,fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform int samples;
uniform float weights[n];
uniform bool latitudinal;
uniform float dTheta;
uniform float mipInt;
uniform vec3 poleAxis;


uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	

#define ENVMAP_TYPE_CUBE_UV
#include <cube_uv_reflection_fragment>

void main() {
	gl_FragColor = vec4(0.0);
	for (int i = 0; i < n; i++) {
		if (i >= samples)
			break;
		for (int dir = -1; dir < 2; dir += 2) {
			if (i == 0 && dir == 1)
				continue;
			vec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);
			if (all(equal(axis, vec3(0.0))))
				axis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);
			axis = normalize(axis);
			float theta = dTheta * float(dir * i);
			float cosTheta = cos(theta);
			// Rodrigues' axis-angle rotation
			vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross(axis, vOutputDirection) * sin(theta)
					+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);
			gl_FragColor.rgb +=
					weights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);
		}
	}
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:0,depthTest:!1,depthWrite:!1})).type="SphericalGaussianBlur",jp),Xc=null,Yc=null,Dp=function(){for(var e=[],t=[],n=[],i=8,l=0;l<Vp;l++){var h=Math.pow(2,i);t.push(h);var g=1/h;4<l?g=Np[l-8+4-1]:l==0&&(g=0),n.push(g);for(var b=1/(h-1),k=-b/2,F=1+b/2,K=[k,k,F,k,F,F,k,k,F,F,k,F],Q=new Float32Array(108),ne=new Float32Array(72),U=new Float32Array(36),oe=0;oe<6;oe++){var ue=oe%3*2/3-1,pe=2<oe?0:-1,Te=[ue,pe,0,ue+2/3,pe,0,ue+2/3,1+pe,0,ue,pe,0,ue+2/3,1+pe,0,ue,1+pe,0];Q.set(Te,18*oe),ne.set(K,12*oe);var Oe=[oe,oe,oe,oe,oe,oe];U.set(Oe,6*oe)}var Fe=new X;Fe.setAttribute("position",new $n(Q,3)),Fe.setAttribute("uv",new $n(ne,2)),Fe.setAttribute("faceIndex",new $n(U,1)),e.push(Fe),4<i&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}(),Oh=Dp._lodPlanes,Fp=Dp._sizeLods,lp=Dp._sigmas,cp=null,vi=null,Ep=null,Zc=(1+Math.sqrt(5))/2,Vu=1/Zc,Bp=[new Se(1,1,1),new Se(-1,1,1),new Se(1,1,-1),new Se(-1,1,-1),new Se(0,Zc,Vu),new Se(0,Zc,-Vu),new Se(Vu,0,Zc),new Se(-Vu,0,Zc),new Se(Zc,Vu,0),new Se(-Zc,Vu,0)];function Ap(e){vi=e,Pp(sp)}function Gp(e){var t={magFilter:z,minFilter:z,generateMipmaps:!1,type:e?e.type:R,format:e?e.format:N,encoding:e?e.encoding:De,depthBuffer:!1,stencilBuffer:!1},n=Up(t);return n.depthBuffer=!e,cp=Up(t),n}function zp(e){cp.dispose(),vi.setRenderTarget(Ep),e.scissorTest=!1,e.setSize(e.width,e.height)}function Pp(e){var t=new Ca;t.add(new Vr(Oh[0],e)),vi.compile(t,Sp)}function Up(e){var t=new rt(3*Rs,3*Rs,e);return t.texture.mapping=L,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Op(e,t,n,i,l){e.viewport.set(t,n,i,l),e.scissor.set(t,n,i,l)}function Hp(e){var t=vi.autoClear;vi.autoClear=!1;for(var n=1;n<Vp;n++)Wp(e,n-1,n,Math.sqrt(lp[n]*lp[n]-lp[n-1]*lp[n-1]),Bp[(n-1)%Bp.length]);vi.autoClear=t}function Wp(e,t,n,i,l){Jp(e,cp,t,n,i,"latitudinal",l),Jp(cp,e,n,n,i,"longitudinal",l)}function Jp(e,t,n,i,l,h,g){h!=="latitudinal"&&h!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");var b=new Ca;b.add(new Vr(Oh[i],sp));var k=sp.uniforms,F=Fp[n]-1,K=isFinite(l)?Math.PI/(2*F):2*Math.PI/39,Q=l/K,ne=isFinite(l)?1+Math.floor(3*Q):op;op<ne&&console.warn("sigmaRadians, "+l+", is too large and will clip, as it requested "+ne+" samples when the maximum is set to "+op);for(var U=[],oe=0,ue=0;ue<op;++ue){var pe=ue/Q,Te=Math.exp(-pe*pe/2);U.push(Te),ue==0?oe+=Te:ue<ne&&(oe+=2*Te)}for(ue=0;ue<U.length;ue++)U[ue]=U[ue]/oe;k.envMap.value=e.texture,k.samples.value=ne,k.weights.value=U,k.latitudinal.value=h==="latitudinal",g&&(k.poleAxis.value=g),k.dTheta.value=K,k.mipInt.value=8-n,k.inputEncoding.value=Ls[e.texture.encoding],k.outputEncoding.value=Ls[e.texture.encoding];var Oe=Fp[i];Op(t,pe=3*Math.max(0,Rs-2*Oe),(i===0?0:2*Rs)+2*Oe*(4<i?i-8+4:0),3*Oe,2*Oe),vi.setRenderTarget(t),vi.render(b,Sp)}function qp(){var e=new tl({uniforms:{envMap:{value:null},texelSize:{value:new Ve(1,1)},inputEncoding:{value:Ls[at]},outputEncoding:{value:Ls[at]}},vertexShader:`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx;
		direction.z *= -1.0;
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.z *= -1.0;
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.x *= -1.0;
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.y *= -1.0;
	} else if (face == 5.0) {
		direction.xz *= -1.0;
	}
	return direction;
}
void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`,fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform vec2 texelSize;


uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	

#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494

void main() {
	gl_FragColor = vec4(0.0);
	vec3 outputDirection = normalize(vOutputDirection);
	vec2 uv;
	uv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;
	uv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;
	vec2 f = fract(uv / texelSize - 0.5);
	uv -= f * texelSize;
	vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x += texelSize.x;
	vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.y += texelSize.y;
	vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x -= texelSize.x;
	vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	vec3 tm = mix(tl, tr, f.x);
	vec3 bm = mix(bl, br, f.x);
	gl_FragColor.rgb = mix(tm, bm, f.y);
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:0,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function Xp(){var e=new tl({uniforms:{envMap:{value:null},inputEncoding:{value:Ls[at]},outputEncoding:{value:Ls[at]}},vertexShader:`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx;
		direction.z *= -1.0;
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.z *= -1.0;
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.x *= -1.0;
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.y *= -1.0;
	} else if (face == 5.0) {
		direction.xz *= -1.0;
	}
	return direction;
}
void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`,fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform samplerCube envMap;


uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	

void main() {
	gl_FragColor = vec4(0.0);
	gl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:0,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function Yp(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),pi.call(this,e),this.type="catmullrom",this.closed=!0}function Zp(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),pi.call(this,e),this.type="catmullrom"}function Rp(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),pi.call(this,e),this.type="catmullrom"}Ap.prototype={constructor:Ap,fromScene:function(e,t,n,i){t===void 0&&(t=0),n===void 0&&(n=.1),i===void 0&&(i=100),Ep=vi.getRenderTarget();var l=Gp();return function(h,g,b,k){var F=new Dr(90,1,g,b),K=[1,1,1,1,-1,1],Q=[1,1,-1,-1,-1,1],ne=vi.outputEncoding,U=vi.toneMapping,oe=vi.toneMappingExposure,ue=vi.getClearColor(),pe=vi.getClearAlpha();vi.toneMapping=1,vi.toneMappingExposure=1,vi.outputEncoding=at,h.scale.z*=-1;var Te=h.background;if(Te&&Te.isColor){Te.convertSRGBToLinear();var Oe=Math.max(Te.r,Te.g,Te.b),Fe=Math.min(Math.max(Math.ceil(Math.log2(Oe)),-128),127);Te=Te.multiplyScalar(Math.pow(2,-Fe));var Ze=(Fe+128)/255;vi.setClearColor(Te,Ze),h.background=null}for(var Ge=0;Ge<6;Ge++){var et=Ge%3;et==0?(F.up.set(0,K[Ge],0),F.lookAt(Q[Ge],0,0)):et==1?(F.up.set(0,0,K[Ge]),F.lookAt(0,Q[Ge],0)):(F.up.set(0,K[Ge],0),F.lookAt(0,0,Q[Ge])),Op(k,et*Rs,2<Ge?Rs:0,Rs,Rs),vi.setRenderTarget(k),vi.render(h,F)}vi.toneMapping=U,vi.toneMappingExposure=oe,vi.outputEncoding=ne,vi.setClearColor(ue,pe),h.scale.z*=-1}(e,n,i,l),0<t&&Wp(l,0,0,t),Hp(l),zp(l),l},fromEquirectangular:function(e){return e.magFilter=z,e.minFilter=z,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){Ep=vi.getRenderTarget();var t=Gp(e);return function(n,i){var l=new Ca;n.isCubeTexture?Yc==null&&(Yc=Xp()):Xc==null&&(Xc=qp());var h=n.isCubeTexture?Yc:Xc;l.add(new Vr(Oh[0],h));var g=h.uniforms;(g.envMap.value=n).isCubeTexture||g.texelSize.value.set(1/n.image.width,1/n.image.height),g.inputEncoding.value=Ls[n.encoding],g.outputEncoding.value=Ls[n.encoding],Op(i,0,0,3*Rs,2*Rs),vi.setRenderTarget(i),vi.render(l,Sp)}(e,t),Hp(t),zp(t),t},compileCubemapShader:function(){Yc==null&&Pp(Yc=Xp())},compileEquirectangularShader:function(){Xc==null&&Pp(Xc=qp())},dispose:function(){sp.dispose(),Yc!=null&&Yc.dispose(),Xc!=null&&Xc.dispose();for(var e=0;e<Oh.length;e++)Oh[e].dispose()}},dn.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(dn.prototype),(e.prototype.constructor=e).prototype.getPoint=t,e},Object.assign(Bo.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new kn,n=0,i=e.length;n<i;n++){var l=e[n];t.vertices.push(new Se(l.x,l.y,l.z||0))}return t}}),Object.assign(Ua.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Yp.prototype=Object.create(pi.prototype),Zp.prototype=Object.create(pi.prototype),Rp.prototype=Object.create(pi.prototype),Object.assign(Rp.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Uc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},ea.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Kr.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),vh.extractUrlBase(e)}}),Kr.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Ru.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(fn.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Oi.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Pr.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Gr.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Qt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Qt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Qt.ceilPowerOfTwo(e)}}),Object.assign(Be.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Lt.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new Se().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,i,l,h){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,l,h)}}),It.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},bn.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(se.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Di.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Di,{barycoordFromPoint:function(e,t,n,i,l){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Di.getBarycoord(e,t,n,i,l)},normal:function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Di.getNormal(e,t,n,i)}}),Object.assign(Es.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new gc(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Nl(this,e)}}),Object.assign(Ve.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Se.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(ct.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(kn.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(mn.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(mn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Vr.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Vr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Tl.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(ma.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Cl.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(dn.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Dr.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(di.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties($n.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Je},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Je)}}}),Object.assign($n.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?Je:Pt),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(X.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?e==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new $n(t,arguments[2])))},addDrawCall:function(e,t,n){n!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(X.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Qo.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Je},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(Qo.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?Je:Pt),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(_s.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Ft.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(rr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Cn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===1}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Bl.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Fr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(cu.prototype,{clearTarget:function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(cu.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=e===!0?tt:at}}}),Object.defineProperties(rh.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(rt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(ll.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return new Bc().load(e,function(n){t.setBuffer(n)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Dh.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Oa.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var Qp={merge:function(e,t,n){var i;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};Wt.crossOrigin=void 0,Wt.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var l=new al;l.setCrossOrigin(this.crossOrigin);var h=l.load(e,n,void 0,i);return t&&(h.mapping=t),h},Wt.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var l=new Ac;l.setCrossOrigin(this.crossOrigin);var h=l.load(e,n,void 0,i);return t&&(h.mapping=t),h},Wt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Wt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var ed={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"113"}})),u.ACESFilmicToneMapping=5,u.AddEquation=M,u.AddOperation=2,u.AdditiveBlending=2,u.AlphaFormat=1021,u.AlwaysDepth=1,u.AlwaysStencilFunc=519,u.AmbientLight=Pu,u.AmbientLightProbe=_h,u.AnimationClip=ki,u.AnimationLoader=No,u.AnimationMixer=Vt,u.AnimationObjectGroup=it,u.AnimationUtils=Ai,u.ArcCurve=Pc,u.ArrayCamera=vl,u.ArrowHelper=qc,u.Audio=ll,u.AudioAnalyser=Dh,u.AudioContext=Lu,u.AudioListener=Ch,u.AudioLoader=Bc,u.AxesHelper=ap,u.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new ap(e)},u.BackSide=1,u.BasicDepthPacking=3200,u.BasicShadowMap=0,u.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Hl(e)},u.Bone=uo,u.BooleanKeyframeTrack=Tu,u.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Jc(e,t)},u.Box2=fn,u.Box3=Oi,u.Box3Helper=_p,u.BoxBufferGeometry=Aa,u.BoxGeometry=Xo,u.BoxHelper=Jc,u.BufferAttribute=$n,u.BufferGeometry=X,u.BufferGeometryLoader=Nc,u.ByteType=1010,u.Cache=il,u.Camera=Ur,u.CameraHelper=Mp,u.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},u.CanvasTexture=wo,u.CatmullRomCurve3=pi,u.CineonToneMapping=4,u.CircleBufferGeometry=bc,u.CircleGeometry=el,u.ClampToEdgeWrapping=C,u.Clock=Th,u.ClosedSplineCurve3=Yp,u.Color=Cn,u.ColorKeyframeTrack=nl,u.CompressedTexture=cc,u.CompressedTextureLoader=mh,u.ConeBufferGeometry=wc,u.ConeGeometry=Mu,u.CubeCamera=Oa,u.CubeGeometry=Xo,u.CubeReflectionMapping=I,u.CubeRefractionMapping=H,u.CubeTexture=oo,u.CubeTextureLoader=Ac,u.CubeUVReflectionMapping=L,u.CubeUVRefractionMapping=y,u.CubicBezierCurve=Vo,u.CubicBezierCurve3=Ta,u.CubicInterpolant=Gl,u.CullFaceBack=1,u.CullFaceFront=2,u.CullFaceFrontBack=3,u.CullFaceNone=0,u.Curve=dn,u.CurvePath=Bo,u.CustomBlending=5,u.CylinderBufferGeometry=Cs,u.CylinderGeometry=Vl,u.Cylindrical=tn,u.DataTexture=jn,u.DataTexture2DArray=gs,u.DataTexture3D=oi,u.DataTextureLoader=Hl,u.DecrementStencilOp=7683,u.DecrementWrapStencilOp=34056,u.DefaultLoadingManager=br,u.DepthFormat=P,u.DepthStencilFormat=O,u.DepthTexture=uc,u.DirectionalLight=ya,u.DirectionalLightHelper=Wc,u.DirectionalLightShadow=zi,u.DiscreteInterpolant=Dc,u.DodecahedronBufferGeometry=Pl,u.DodecahedronGeometry=pc,u.DoubleSide=2,u.DstAlphaFactor=206,u.DstColorFactor=208,u.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new $n(e,t).setUsage(Je)},u.DynamicCopyUsage=35050,u.DynamicDrawUsage=Je,u.DynamicReadUsage=35049,u.EdgesGeometry=xc,u.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Mi(new xc(e.geometry),new si({color:t!==void 0?t:16777215}))},u.EllipseCurve=Wr,u.EqualDepth=4,u.EqualStencilFunc=514,u.EquirectangularReflectionMapping=303,u.EquirectangularRefractionMapping=G,u.Euler=pr,u.EventDispatcher=bt,u.ExtrudeBufferGeometry=_s,u.ExtrudeGeometry=gc,u.Face3=qa,u.Face4=function(e,t,n,i,l,h,g){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new qa(e,t,n,l,h,g)},u.FaceColors=1,u.FileLoader=Hr,u.FlatShading=1,u.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new ln(e,t)},u.Float32BufferAttribute=ln,u.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new ks(e,t)},u.Float64BufferAttribute=ks,u.FloatType=Y,u.Fog=Ra,u.FogExp2=uu,u.Font=bh,u.FontLoader=Fc,u.FrontFaceDirectionCCW=1,u.FrontFaceDirectionCW=0,u.FrontSide=0,u.Frustum=Pr,u.GammaEncoding=le,u.Geometry=kn,u.GeometryUtils=Qp,u.GreaterDepth=6,u.GreaterEqualDepth=5,u.GreaterEqualStencilFunc=518,u.GreaterStencilFunc=516,u.GridHelper=Uc,u.Group=wr,u.HalfFloatType=c,u.HemisphereLight=Eu,u.HemisphereLightHelper=zc,u.HemisphereLightProbe=Mh,u.IcosahedronBufferGeometry=Ji,u.IcosahedronGeometry=hc,u.ImageBitmapLoader=xh,u.ImageLoader=za,u.ImageUtils=Wt,u.ImmediateRenderObject=Un,u.IncrementStencilOp=7682,u.IncrementWrapStencilOp=34055,u.InstancedBufferAttribute=jc,u.InstancedBufferGeometry=kc,u.InstancedInterleavedBuffer=$t,u.InstancedMesh=oc,u.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Ho(e,t)},u.Int16BufferAttribute=Ho,u.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new $i(e,t)},u.Int32BufferAttribute=$i,u.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new fs(e,t)},u.Int8BufferAttribute=fs,u.IntType=1013,u.InterleavedBuffer=Qo,u.InterleavedBufferAttribute=wl,u.Interpolant=Ga,u.InterpolateDiscrete=ae,u.InterpolateLinear=ve,u.InterpolateSmooth=2302,u.InvertStencilOp=5386,u.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},u.KeepStencilOp=Rt,u.KeyframeTrack=ga,u.LOD=Tl,u.LatheBufferGeometry=Qs,u.LatheGeometry=bu,u.Layers=Mr,u.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},u.LessDepth=2,u.LessEqualDepth=3,u.LessEqualStencilFunc=515,u.LessStencilFunc=513,u.Light=di,u.LightProbe=Qa,u.LightShadow=Go,u.Line=Ma,u.Line3=Gr,u.LineBasicMaterial=si,u.LineCurve=er,u.LineCurve3=Fo,u.LineDashedMaterial=Sc,u.LineLoop=qs,u.LinePieces=1,u.LineSegments=Mi,u.LineStrip=0,u.LinearEncoding=at,u.LinearFilter=q,u.LinearInterpolant=zl,u.LinearMipMapLinearFilter=1008,u.LinearMipMapNearestFilter=1007,u.LinearMipmapLinearFilter=_,u.LinearMipmapNearestFilter=W,u.LinearToneMapping=1,u.Loader=Kr,u.LoaderUtils=vh,u.LoadingManager=os,u.LogLuvEncoding=3003,u.LoopOnce=2200,u.LoopPingPong=2202,u.LoopRepeat=2201,u.LuminanceAlphaFormat=1025,u.LuminanceFormat=1024,u.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},u.Material=rr,u.MaterialLoader=Ou,u.Math=Qt,u.MathUtils=Qt,u.Matrix3=Be,u.Matrix4=Lt,u.MaxEquation=104,u.Mesh=Vr,u.MeshBasicMaterial=Xa,u.MeshDepthMaterial=Bs,u.MeshDistanceMaterial=$o,u.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},u.MeshLambertMaterial=Ss,u.MeshMatcapMaterial=Cc,u.MeshNormalMaterial=Tc,u.MeshPhongMaterial=Bl,u.MeshPhysicalMaterial=Fl,u.MeshStandardMaterial=is,u.MeshToonMaterial=_c,u.MinEquation=103,u.MirroredRepeatWrapping=B,u.MixOperation=1,u.MultiMaterial=function(e){return e===void 0&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,(e.materials=e).clone=function(){return e.slice()},e},u.MultiplyBlending=4,u.MultiplyOperation=0,u.NearestFilter=z,u.NearestMipMapLinearFilter=1005,u.NearestMipMapNearestFilter=1004,u.NearestMipmapLinearFilter=S,u.NearestMipmapNearestFilter=A,u.NeverDepth=0,u.NeverStencilFunc=512,u.NoBlending=0,u.NoColors=0,u.NoToneMapping=0,u.NormalBlending=1,u.NotEqualDepth=7,u.NotEqualStencilFunc=517,u.NumberKeyframeTrack=as,u.Object3D=mn,u.ObjectLoader=Ru,u.ObjectSpaceNormalMap=1,u.OctahedronBufferGeometry=bs,u.OctahedronGeometry=ko,u.OneFactor=201,u.OneMinusDstAlphaFactor=207,u.OneMinusDstColorFactor=209,u.OneMinusSrcAlphaFactor=205,u.OneMinusSrcColorFactor=203,u.OrthographicCamera=Xl,u.PCFShadowMap=1,u.PCFSoftShadowMap=2,u.PMREMGenerator=Ap,u.ParametricBufferGeometry=ws,u.ParametricGeometry=Al,u.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new co(e)},u.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Io(e)},u.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Xs(e,t)},u.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Io(e)},u.Path=Ua,u.PerspectiveCamera=Dr,u.Plane=It,u.PlaneBufferGeometry=Va,u.PlaneGeometry=Zo,u.PlaneHelper=Tp,u.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Xs(e,t)},u.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Io(e)},u.PointLight=Au,u.PointLightHelper=eo,u.Points=Xs,u.PointsMaterial=Io,u.PolarGridHelper=Yl,u.PolyhedronBufferGeometry=In,u.PolyhedronGeometry=ns,u.PositionalAudio=Gc,u.PropertyBinding=Ue,u.PropertyMixer=Eh,u.QuadraticBezierCurve=qi,u.QuadraticBezierCurve3=ss,u.Quaternion=bn,u.QuaternionKeyframeTrack=rl,u.QuaternionLinearInterpolant=Cu,u.REVISION="113",u.RGBADepthPacking=3201,u.RGBAFormat=f,u.RGBAIntegerFormat=1033,u.RGBA_ASTC_10x10_Format=37819,u.RGBA_ASTC_10x5_Format=37816,u.RGBA_ASTC_10x6_Format=37817,u.RGBA_ASTC_10x8_Format=37818,u.RGBA_ASTC_12x10_Format=37820,u.RGBA_ASTC_12x12_Format=37821,u.RGBA_ASTC_4x4_Format=37808,u.RGBA_ASTC_5x4_Format=37809,u.RGBA_ASTC_5x5_Format=37810,u.RGBA_ASTC_6x5_Format=37811,u.RGBA_ASTC_6x6_Format=37812,u.RGBA_ASTC_8x5_Format=37813,u.RGBA_ASTC_8x6_Format=37814,u.RGBA_ASTC_8x8_Format=37815,u.RGBA_PVRTC_2BPPV1_Format=Pe,u.RGBA_PVRTC_4BPPV1_Format=Le,u.RGBA_S3TC_DXT1_Format=te,u.RGBA_S3TC_DXT3_Format=de,u.RGBA_S3TC_DXT5_Format=me,u.RGBDEncoding=St,u.RGBEEncoding=De,u.RGBEFormat=N,u.RGBFormat=m,u.RGBIntegerFormat=1032,u.RGBM16Encoding=gt,u.RGBM7Encoding=st,u.RGB_ETC1_Format=36196,u.RGB_PVRTC_2BPPV1_Format=ge,u.RGB_PVRTC_4BPPV1_Format=we,u.RGB_S3TC_DXT1_Format=Z,u.RGFormat=1030,u.RGIntegerFormat=1031,u.RawShaderMaterial=tl,u.Ray=se,u.Raycaster=On,u.RectAreaLight=Ic,u.RedFormat=1028,u.RedIntegerFormat=1029,u.ReinhardToneMapping=2,u.RepeatWrapping=D,u.ReplaceStencilOp=7681,u.ReverseSubtractEquation=102,u.RingBufferGeometry=yc,u.RingGeometry=wu,u.Scene=Ca,u.SceneUtils=ed,u.ShaderChunk=dr,u.ShaderLib=Li,u.ShaderMaterial=Fr,u.ShadowMaterial=Mc,u.Shape=Es,u.ShapeBufferGeometry=vc,u.ShapeGeometry=Nl,u.ShapePath=wh,u.ShapeUtils=jo,u.ShortType=1011,u.Skeleton=ma,u.SkeletonHelper=ea,u.SkinnedMesh=Cl,u.SmoothShading=2,u.Sphere=xa,u.SphereBufferGeometry=Ts,u.SphereGeometry=xu,u.Spherical=Ut,u.SphericalHarmonics3=Iu,u.SphericalReflectionMapping=305,u.Spline=Rp,u.SplineCurve=Rr,u.SplineCurve3=Zp,u.SpotLight=ql,u.SpotLightHelper=ji,u.SpotLightShadow=Jl,u.Sprite=co,u.SpriteMaterial=Gs,u.SrcAlphaFactor=204,u.SrcAlphaSaturateFactor=210,u.SrcColorFactor=202,u.StaticCopyUsage=35046,u.StaticDrawUsage=Pt,u.StaticReadUsage=35045,u.StereoCamera=np,u.StreamCopyUsage=35042,u.StreamDrawUsage=35040,u.StreamReadUsage=35041,u.StringKeyframeTrack=Ec,u.SubtractEquation=101,u.SubtractiveBlending=3,u.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},u.TangentSpaceNormalMap=0,u.TetrahedronBufferGeometry=Ks,u.TetrahedronGeometry=Zs,u.TextBufferGeometry=jl,u.TextGeometry=vu,u.Texture=nn,u.TextureLoader=al,u.TorusBufferGeometry=dc,u.TorusGeometry=Ol,u.TorusKnotBufferGeometry=$s,u.TorusKnotGeometry=sa,u.Triangle=Di,u.TriangleFanDrawMode=2,u.TriangleStripDrawMode=1,u.TrianglesDrawMode=0,u.TubeBufferGeometry=Ka,u.TubeGeometry=mu,u.UVMapping=300,u.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new yo(e,t)},u.Uint16BufferAttribute=yo,u.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new vo(e,t)},u.Uint32BufferAttribute=vo,u.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new ms(e,t)},u.Uint8BufferAttribute=ms,u.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Eo(e,t)},u.Uint8ClampedBufferAttribute=Eo,u.Uncharted2ToneMapping=3,u.Uniform=Ft,u.UniformsLib=en,u.UniformsUtils=Ri,u.UnsignedByteType=R,u.UnsignedInt248Type=p,u.UnsignedIntType=V,u.UnsignedShort4444Type=1017,u.UnsignedShort5551Type=1018,u.UnsignedShort565Type=1019,u.UnsignedShortType=v,u.VSMShadowMap=3,u.Vector2=Ve,u.Vector3=Se,u.Vector4=ct,u.VectorKeyframeTrack=Ul,u.Vertex=function(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Se(e,t,n)},u.VertexColors=2,u.VideoTexture=uh,u.WebGLCubeRenderTarget=Ei,u.WebGLMultisampleRenderTarget=Zt,u.WebGLRenderTarget=rt,u.WebGLRenderTargetCube=function(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Ei(e,n)},u.WebGLRenderer=cu,u.WebGLUtils=su,u.WireframeGeometry=Ys,u.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Mi(new Ys(e.geometry),new si({color:t!==void 0?t:16777215}))},u.WrapAroundEnding=He,u.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Hr(e)},u.ZeroCurvatureEnding=Ie,u.ZeroFactor=200,u.ZeroSlopeEnding=ze,u.ZeroStencilOp=0,u.sRGBEncoding=tt,Object.defineProperty(u,"__esModule",{value:!0})},typeof o=="object"&&r!==void 0?x(o):typeof define=="function"&&define.amd?define(["exports"],x):x((a=a||self).THREE={})},{}],20:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MrxDbgUtils=void 0;var a,x,u=T("three"),M=T("./Operate/MxEntSelJig"),I=T("./Operate/MxJigCmdManager"),H=T("./UI/MxUiVue"),G=T("./Operate/MrxDbgUiPrPoint"),L=T("./Operate/MrxDbgUiPrBase"),y=T("./MxThreeJS");(x=a||(o.MrxDbgUtils=a={})).findEntAtPoint=function(D,C,B,z,A){return B===void 0&&(B=null),z===void 0&&(z=!0),new Promise(function(S){for(var q=D.findMxEntityAtPoint(C,z,A),W=[],_=q.length,R=0;R<_;R++){var v=q[R];if(!B||!B.type||B.type==v.getTypeName()){var V=v.objectId();W.push(V)}}S(W)})},x.selectEnt=function(D,C){return C===void 0&&(C=null),new Promise(function(B){var z=new M.MxEntSelJig;z.disableAllTrace(),z.setDynamicInputType(I.MxJigCmdManager.DynamicInputType.kDynTip),D&&H.MxUiVue.acutPrintf(D),z.filter=C,z.callRet=function(A){B(A)},I.MxJigCmdManager.runCmd(z)})},x.getCorner=function(D,C,B,z,A){return B===void 0&&(B=!1),A===void 0&&(A=!1),new Promise(function(S){var q=new G.MrxDbgUiPrPoint;q.setMessage(C),B?(q.setDynamicInputType(I.MxJigCmdManager.DynamicInputType.kDynTip),q.disableAllTrace()):(q.setDynamicInputType(I.MxJigCmdManager.DynamicInputType.kXYCoordInput),A&&q.disableAllTrace());var W=new L.McEdGetPointWorldDrawObject;W.setDraw(function(_,R){var v=new u.Vector3(D.x,_.y,_.z),V=new u.Vector3(_.x,D.y,_.z),Y=[];Y.push(D),Y.push(v),Y.push(_),Y.push(V),Y.push(D);var c=null,p=65280;if(B){if(_.x>D.x)c=y.MxThreeJS.createLines(Y,16777215),p=255;else{var m=R.getMcEdJig().getMxObject().viewCoordLong2Cad(3);c=y.MxThreeJS.createDashedLines(Y,16777215,2*m,m)}var f=[];f.push(D),f.push(v),f.push(_),f.push(D),f.push(_),f.push(V);var N=y.MxThreeJS.createTriangle(f,p,.27);R.drawEntity(N,30),R.drawEntity(c,31)}else c=y.MxThreeJS.createLines(Y,16777215),R.drawEntity(c,31)}),q.setUserDraw(W),q.go(function(_){z&&z({status:_,detailedResult:q.getDetailedResult()}),_!=0?S(null):(q.clearLastInputPoint(),S(q.value()))})})}},{"./MxThreeJS":37,"./Operate/MrxDbgUiPrBase":45,"./Operate/MrxDbgUiPrPoint":47,"./Operate/MxEntSelJig":50,"./Operate/MxJigCmdManager":54,"./UI/MxUiVue":65,three:19}],21:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawCommands=void 0;var a,x=T("./MxFun"),u=T("./MxType"),M=T("./Operate/MxIntelliSelect"),I=T("./Operate/MxJigCmdManager");function H(B){B!=null&&B.grips!=null&&B.ids!=null&&x.MxFun.getCurrentMx().getMcObject().getGripManager().gripEditImp(B)}function G(B){if(B!=null&&B.pt!=null){var z=!1;B.shiftKey&&(z=B.shiftKey);var A=x.MxFun.getCurrentMx(),S=B.pt;if(!A.getMxDatabase().getGripManager().doPointSelect(S,z)){var q=!0;if(A.isValidMcObject()&&A.getMcObject().getGripManager().doPointSelect(S,z)&&(q=!1),x.MxFun.isPC()||(q=!1),q&&A.isMultipleSelect){var W=A.screenCoord2Current(S.x,S.y,0),_=new M.MxIntelliSelectJig(W,z);_.setDisableDynInput(!0),_.setDisableOsnap(!0),I.MxJigCmdManager.runCmd(_)}}}}function L(B){B!=null&&B.grips!=null&&B.ents!=null&&x.MxFun.getCurrentMx().getMxDatabase().getGripManager().gripEditImp(B)}function y(){x.MxFun.getCurrentMx().getMcObject().undo()}function D(){x.MxFun.getCurrentMx().getMcObject().redo()}function C(){x.MxFun.getCurrentMx().startPanCommand()}(a||(o.MxDrawCommands=a={})).registerCommand=function(){x.MxFun.addCommand("Mx_FrontEndWebpageIntelliSel",G,u.MxType.MxCommandFlag.MCRX_CMD_TRANSPARENT|u.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER|u.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT|u.MxType.MxCommandFlag.MCRX_CMD_NO_RECORD_PRVCMD),x.MxFun.addCommand("Mx_FrontEndWebpageGripEdit",L,u.MxType.MxCommandFlag.MCRX_CMD_TRANSPARENT|u.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER|u.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT|u.MxType.MxCommandFlag.MCRX_CMD_NO_RECORD_PRVCMD),x.MxFun.addCommand("McDraw_GripEdit",H,u.MxType.MxCommandFlag.MCRX_CMD_TRANSPARENT|u.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT|u.MxType.MxCommandFlag.MCRX_CMD_NO_RECORD_PRVCMD),x.MxFun.addCommand("Mx_Undo",y,u.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER),x.MxFun.addCommand("Mx_Redo",D,u.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER),x.MxFun.addCommand("Mx_Pan",C,u.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER)}},{"./MxFun":27,"./MxType":39,"./Operate/MxIntelliSelect":52,"./Operate/MxJigCmdManager":54}],22:[function(T,r,o){var a,x;Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawData=void 0,(x=a||(o.MxDrawData=a={})).m_dInputRectWidth=16,x.m_isEnableIntelliSelect=!0,x.m_isEnableGripEidt=!0,x.m_isEnableCADEntityGripEidt=1,x.m_isForbiddenDynInput=!1,x.m_isMultipleSelect=!1,x.m_iIntelliSelectType=1,x.m_isAutoResetRenderer=!1,x.m_isCorrectLargeCoordinates=!0,x.m_isRequestHeaderCacheControl=!1,x.m_gripPointColor=3355443455,x.m_isMapBox=!1,x.m_isEnableDrawingViewAngle=!0,x.m_isEnableCommandRightClickMenu=!1,x.m_isMobileCommandOperationSupportsMultipoint=!0,x.getIniSet=function(){return{EnableIntelliSelect:x.m_isEnableIntelliSelect,EnableGripEidt:x.m_isEnableGripEidt,EnableCADEntityGripEidt:x.m_isEnableCADEntityGripEidt,ForbiddenDynInput:x.m_isForbiddenDynInput,EnableDrawingViewAngle:x.m_isEnableDrawingViewAngle,gripPointColor:x.m_gripPointColor,multipleSelect:x.m_isMultipleSelect,EnableCommandRightClickMenu:x.m_isEnableCommandRightClickMenu}},x.setIniset=function(u){u.EnableIntelliSelect!==void 0&&typeof u.EnableIntelliSelect=="boolean"&&(x.m_isEnableIntelliSelect=u.EnableIntelliSelect),u.EnableGripEidt!==void 0&&typeof u.EnableGripEidt=="boolean"&&(x.m_isEnableGripEidt=u.EnableGripEidt),u.EnableGripEdit!==void 0&&typeof u.EnableGripEdit=="boolean"&&(x.m_isEnableGripEidt=u.EnableGripEdit),u.EnableCADEntityGripEidt!==void 0&&typeof u.EnableCADEntityGripEidt=="number"&&(x.m_isEnableCADEntityGripEidt=u.EnableCADEntityGripEidt),u.EnableCADEntityGripEdit!==void 0&&typeof u.EnableCADEntityGripEdit=="number"&&(x.m_isEnableCADEntityGripEidt=u.EnableCADEntityGripEdit),u.ForbiddenDynInput!==void 0&&typeof u.ForbiddenDynInput=="boolean"&&(x.m_isForbiddenDynInput=u.ForbiddenDynInput),u.multipleSelect!==void 0&&typeof u.multipleSelect=="boolean"&&(x.m_isMultipleSelect=u.multipleSelect),u.IntelliSelectType!==void 0&&typeof u.IntelliSelectType=="number"&&(x.m_iIntelliSelectType=u.IntelliSelectType),u.autoResetRenderer!==void 0&&typeof u.autoResetRenderer=="boolean"&&(x.m_isAutoResetRenderer=u.autoResetRenderer),u.correctLargeCoordinates!==void 0&&typeof u.correctLargeCoordinates=="boolean"&&(x.m_isCorrectLargeCoordinates=u.correctLargeCoordinates),u.requestHeaderCacheControl!==void 0&&typeof u.requestHeaderCacheControl=="boolean"&&(x.m_isRequestHeaderCacheControl=u.requestHeaderCacheControl),u.MapBox!==void 0&&typeof u.MapBox=="boolean"&&(x.m_isMapBox=u.MapBox),u.inputRectWidth!==void 0&&typeof u.inputRectWidth=="number"&&(x.m_dInputRectWidth=u.inputRectWidth),u.gripPointColor!==void 0&&typeof u.gripPointColor=="number"&&(x.m_gripPointColor=u.gripPointColor),u.EnableDrawingViewAngle!==void 0&&typeof u.EnableDrawingViewAngle=="boolean"&&(x.m_isEnableDrawingViewAngle=u.EnableDrawingViewAngle),u.EnableCommandRightClickMenu!==void 0&&typeof u.EnableCommandRightClickMenu=="boolean"&&(x.m_isEnableCommandRightClickMenu=u.EnableCommandRightClickMenu),u.MobileCommandOperationSupportsMultipoint!==void 0&&typeof u.MobileCommandOperationSupportsMultipoint=="boolean"&&(x.m_isMobileCommandOperationSupportsMultipoint=u.MobileCommandOperationSupportsMultipoint)}},{}],23:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawObject=o.IniSetName=o.MxRunMode=void 0;var a,x,u,M=T("three"),I=T("./MxFun"),H=T("./View/MxBrowseLayerData"),G=T("./View/MxBrowseDisplay"),L=T("./MxNetData"),y=T("./MxNetData"),D=T("./MxManager"),C=T("./MxSystemVariable"),B=T("./MxLocalFileLoad"),z=T("./Operate/MxDrawObjectOsnap"),A=T("./View/MxDbDatabase"),S=T("./View/MxDrawMapBox"),q=T("./MxDrawObjectEvent"),W=T("./View/MxDbEntityGrip"),_=T("./cpp/McDrawObject"),R=T("./UI/MxUiVue"),v=T("./MxDrawData"),V=T("./MxTempMarkDraw");(x=a||(o.MxRunMode=a={}))[x.kBrowse=1]="kBrowse",x[x.kCPPMxCAD=4]="kCPPMxCAD",(u||(o.IniSetName=u={})).kEnableOsnapFunction="EnableOsnapFunction";var Y=(c.prototype.getCurrentMousePostion=function(){return this.curMousePostion},c.prototype.isValidCurMousePostion=function(){return this.m_isValidCurMousePostion},c.prototype.setCurrentMousePostion=function(p,m){if(m===void 0&&(m=!1),m){if(0<p.touches.length){var f=p.target.getBoundingClientRect();this.curMousePostion.x=p.touches[0].clientX-f.left,this.curMousePostion.y=p.touches[0].clientY-f.top,this.m_isValidCurMousePostion=!0}}else this.curMousePostion.x=p.offsetX,this.curMousePostion.y=p.offsetY,this.m_isValidCurMousePostion=!0},c.prototype.mapBoxRender=function(p,m,f){this.mcObject.updateDisplayMapBox(m),f||(this.camera.projectionMatrix=m,this.renderer.autoClear=!1,this.renderer.state.reset(),this.secenView&&this.renderer.render(this.secenView,this.cameraView),this.renderer.render(this.scene,this.camera),this._callCreateCanvasImageData!=null&&(this._callCreateCanvasImageData(this.renderer.domElement.toDataURL("image/png")),this._callCreateCanvasImageData=void 0)),this.callEvent("render",this.renderer)},c.prototype.mapBoxInitThreeJSObject=function(p,m,f,N){this.scene=p,this.camera=m,this.renderer=f,this.controls=N},c.prototype.getMxDrawThreeJs=function(){return this.mxdrawThreeJS},c.prototype.setPointMultipleSelect=function(p){this.isPointMultipleSelect=p},c.prototype.pointMultipleSelect=function(){return this.isPointMultipleSelect},c.prototype.getMcObject=function(){return this.mcObject},c.prototype.is3DMode=function(){return this.mcObject.mxdraw3d.is3DMode()},c.prototype.getSysVarLong=function(p){return this.mcObject.isValid()?this.mcObject.getSysVarLong(p):this.m_sysVariable.getSysVarNumber(p)},c.prototype.getSysVarDouble=function(p){return this.mcObject.isValid()?this.mcObject.getSysVarDouble(p):this.m_sysVariable.getSysVarNumber(p)},c.prototype.getSysVarPoint=function(p){return this.mcObject.isValid()?this.mcObject.getSysVarPoint(p):this.m_sysVariable.getSysVarPoint(p)},c.prototype.getCAD2DocMatrix=function(){return this._cad2Doc},c.prototype.isValidMcObject=function(){return this.mcObject.isValid()},c.prototype.getId=function(){return this.id},c.prototype.getEventManager=function(){return this.eventManager},c.prototype.setCurrentLoadUrl=function(p){this._sCurrentLoadURL=p},c.prototype.getCurrentLoadUrl=function(){return this._sCurrentLoadURL},c.prototype.isWebgl2=function(){return!(!this._rendererParam||this._rendererParam.retver!="webgl2")},c.prototype.getMxDatabase=function(){return this.m_mxDatabase},c.prototype.updateCanvasSize=function(){this._onResizeFun&&this._onResizeFun(void 0,!1)},c.prototype.addMxEntity=function(p){return this.m_mxDatabase.addMxEntity(p)},c.prototype.getMxEntity=function(p){return this.m_mxDatabase.getEntity(p)},c.prototype.getMxEntityUserObject=function(p){var m=this.getMxEntity(p);return m?m.getUserObject():null},c.prototype.eraseAllMxEntity=function(){this.m_mxDatabase.eraseAllEntity()},c.prototype.eraseMxEntity=function(p){var m=this.m_mxDatabase.getEntity(p);return!!m&&m.erase()},c.prototype.getAllMxEntity=function(){var p=[];return this.m_mxDatabase.getAllEntity().forEach(function(m){m&&p.push(m.getUserObject())}),p},c.prototype.getMxAllSelect=function(){var p=this.m_mxDatabase.getSelectManager().getAllSelect(),m=this.m_mxDatabase.getGripManager().getAllSelect(),f=new Set;return p.forEach(function(N){f.add(N)}),m.forEach(function(N){f.has(N)||p.push(N)}),p},c.prototype.getPrvCommandSelect=function(){return this.m_mxDatabase.getSelectManager().getPrvCommandSelect()},c.prototype.getMxCADAllSelect=function(){return this.mcObject.isValid()?this.mcObject.getGripManager().getAllSelect():[]},c.prototype.getSelectPoints=function(){return this.mcObject.getGripManager().getSelectPoints()},c.prototype.getPrvCommandMxCADSelect=function(){return this.mcObject.isValid()?this.mcObject.getGripManager().getPrvCommandSelect():[]},c.prototype.addMxCurrentSelect=function(p,m,f){return m===void 0&&(m=!0),f===void 0&&(f=!0),this.m_mxDatabase.getGripManager().addSelect(p,m,f)},c.prototype.addMxCADCurrentSelect=function(p,m,f){return m===void 0&&(m=!0),f===void 0&&(f=!0),!!this.mcObject.isValid()&&this.mcObject.getGripManager().addSelect(p,m,f)},c.prototype.fireSelectChange=function(p){if(p){if(this.mcObject.isValid())return this.mcObject.getGripManager().fireSelectChange()}else this.m_mxDatabase.getGripManager().fireMxEntitySelectChange()},c.prototype.clearMxCurrentSelect=function(){var p=this.m_mxDatabase.clearMxCurrentSelect();return this.mcObject.isValid()&&this.mcObject.getGripManager().clearAll(),p},c.prototype.addViewObject=function(p){this.secenView?this.threejsselectObjectsView.add(p):console.log("this.secenView is null")},c.prototype.removeViewObject=function(p){I.MxFun.removeThreejsObject(p,this.threejsselectObjectsView)},c.prototype.setOtherRefFile=function(p){this._tzDwgStaticFile=p},c.prototype.setRequestHeader=function(p){this._requestHeader=p},c.prototype.initZoomW=function(p,m){this._initZoomwCoordPt1=p.clone(),this._initZoomWCoordPt2=m.clone()},c.prototype.setMouseRightRotate=function(p){this._mouseRightRotate=p,this.controls!=null&&(this.controls.mouseButtons.RIGHT=p?M.MOUSE.ROTATE:-1)},c.prototype.setZoomSpeed=function(p){var m=this.controls.zoomSpeed;return this.controls.zoomSpeed=p,m},c.prototype.resetRenderer=function(){this.renderer.info.reset()},c.prototype.getRenderer=function(){return this.renderer},c.prototype.isPaningCommand_call=function(){return this.bakControls!=null},c.prototype.startPanCommand_call=function(){this.bakControls={},this.bakControls.LEFT=this.controls.mouseButtons.LEFT,this.bakControls.RIGHT=this.controls.mouseButtons.RIGHT,this.bakControls.MIDDLE=this.controls.mouseButtons.MIDDLE,this.controls.mouseButtons.LEFT=M.MOUSE.PAN,this._mouseRightRotate?this.controls.mouseButtons.RIGHT=M.MOUSE.ROTATE:this.controls.mouseButtons.RIGHT=-1,this.controls.mouseButtons.MIDDLE=1,R.MxUiVue.setCursorType(R.MxUiVue.CursorType.kPan)},c.prototype.endPanCommand_call=function(){this.bakControls&&(this.controls.mouseButtons.LEFT=this.bakControls.LEFT,this.controls.mouseButtons.RIGHT=this.bakControls.RIGHT,this.controls.mouseButtons.MIDDLE=this.bakControls.MIDDLE,this.bakControls=void 0,R.MxUiVue.setCursorType(R.MxUiVue.CursorType.kNormal))},c.prototype.isPaningCommand=function(){return this.mxdrawThreeJS.isPaningCommand()},c.prototype.startPanCommand=function(){this.mxdrawThreeJS.startPanCommand()},c.prototype.endPanCommand=function(){this.mxdrawThreeJS.endPanCommand()},c.prototype.setMouseMiddlePan=function(p){this._isMouseMiddlePan=typeof p=="boolean"?p?1:0:p,this.controls!=null&&(this._isMouseMiddlePan==1?(this.controls.mouseButtons.LEFT=-1,this.controls.mouseButtons.RIGHT=-1,this.controls.mouseButtons.MIDDLE=M.MOUSE.PAN):this._isMouseMiddlePan==2?(this.controls.mouseButtons.LEFT=M.MOUSE.PAN,this.controls.mouseButtons.RIGHT=-1,this.controls.mouseButtons.MIDDLE=M.MOUSE.PAN):(this.controls.mouseButtons.LEFT=M.MOUSE.PAN,this._mouseRightRotate?this.controls.mouseButtons.RIGHT=M.MOUSE.ROTATE:this.controls.mouseButtons.RIGHT=-1,this.controls.mouseButtons.MIDDLE=1))},c.prototype.resetThreeJSControls=function(){this.controls&&(this.controls.saveState(),this.controls.reset())},c.prototype.enableZoom=function(p){this.controls!=null&&(this.controls.enableZoom=p)},c.prototype.enablePan=function(p){this.controls!=null&&(this.controls.enablePan=p)},c.prototype.getOrbitControls=function(){return this.controls},c.prototype.enableViewControls=function(p){this.controls.enabled=p},c.prototype.initRunMode=function(p){this._isCreate?console.log("iniRunMode failed,mxobject already created"):this._runMode=p},c.prototype.getRunMode=function(){return this._runMode},c.prototype.setStaticLocalLoad=function(p){this._isStaticLocalLoad=p},c.prototype.isStaticLocalLoad=function(){return this._isStaticLocalLoad},c.prototype.setStaticLocalLoadPath=function(p){this._staticLocalLoadPath=p},c.prototype.on=function(p,m){if(this._event[p])if(this._event[p]instanceof Array){var f=this._event[p];f.includes(m)||f.push(m)}else{var N=this._event[p];if(N==m)return;this._event[p]=[],this._event[p].push(N),this._event[p].push(m)}else this._event[p]=m},c.prototype.addEvent=function(p,m){this.on(p,m)},c.prototype.addControlsEvent=function(p,m,f){return f===void 0&&(f=!1),this.eventManager.addEventListener(p,m,f)},c.prototype.removeEvent=function(p){this._event[p]=void 0},c.prototype.removeEventFuction=function(p,m){if(this._event[p]){if(this._event[p]instanceof Array){var f=this._event[p].indexOf(m);if(f!=-1)return this._event[p].splice(f,1),this._event[p].length==0&&delete this._event[p],!0}else if(this._event[p]==m)return delete this._event[p],!0}return!1},c.prototype.sysVariable=function(){return this.m_sysVariable},c.prototype.setIniset=function(p){var m=this;Object.keys(p).forEach(function(f){m.m_iniSet[f]=p[f]}),v.MxDrawData.setIniset(p),p.multipleSelect!==void 0&&typeof p.multipleSelect=="boolean"&&(this.isMultipleSelect=p.multipleSelect),p.IntelliSelectType!==void 0&&typeof p.IntelliSelectType=="number"&&(p.IntelliSelectType==1?this.isPointMultipleSelect=!1:p.IntelliSelectType==2&&(this.isPointMultipleSelect=!0))},c.prototype.getInisetValue=function(p){return this.m_iniSet[p]},c.prototype.getViewColor=function(){return this._viewcolor},c.prototype.isWhiteViewColor=function(){return!!this.mcObject.isPaperSpaceDisplay()||this._viewcolor==16777215},c.prototype.initUserLoginData=function(p,m){this._userIdentitySign=p,this._userRandomToken=m},c.prototype.initRendererParam=function(p){this._rendererParam=p},c.prototype.getRendererParam=function(){return this._rendererParam},c.prototype.automaticInversionColor=function(p){return this._viewcolor!=16777215||p!=16777215?p:0},c.prototype.automaticInversionColor2=function(p){return this._viewcolor!=16777215||16777215&~p?p:4278190080&p},c.prototype.setViewColor=function(p){this._viewcolor=p,this._runMode!=a.kCPPMxCAD&&this.scene!=null&&(this.scene.background=new M.Color(p))},c.prototype.zoomScale=function(p,m){this.mxdrawThreeJS.zoomScale(p,m)},c.prototype.setViewAngle=function(p){this.mxdrawThreeJS.setViewAngle(p)},c.prototype.zoomW=function(p,m,f,N,P){P===void 0&&(P=!1),this.mxdrawThreeJS.zoomW(p,m,f,N,P)},c.prototype.zoomCenter=function(p,m,f){this.mxdrawThreeJS.zoomCenter(p,m,f)},c.prototype.getViewAngle=function(){return this._viewangle},c.prototype.callInitCompleteEvent=function(){this.callEvent("loadComplete")},c.prototype.callInitObjectEvent=function(){this.callEvent("initObject")},c.prototype.callInitSceneEvent=function(p,m,f){var N=this._event.initScene;if(!N)return 0;if(N instanceof Array){var P=0;return N.forEach(function(O){P=O(p,m,f)}),P}return N(p,m,f)},c.prototype.callOpenFileComplete=function(p,m){m===void 0&&(m=0);try{var f=this._event.openFileComplete;if(!f)return;f instanceof Array?f.forEach(function(N){N(p,m)}):f(p,m)}catch(N){throw console.log(N),N}},c.prototype.hasEvent=function(p){return this._event[p]!=null},c.prototype.regenAllMxDbEntity=function(){return this.m_mxDatabase.regenAllMxDbEntity()},c.prototype.callEvent=function(p,m){try{var f=this._event[p];if(!f)return!1;if(f instanceof Array){var N=!1;return f.forEach(function(P){N=P(m)}),N}return f(m)}catch(P){throw console.log(P),P}},c.prototype.callViewChange=function(){this.onViewChange(),this.callEvent("viewchange")},c.prototype.userLoginResult=function(p){this.callEvent("userLoginResult",p)},c.prototype.serverReturn=function(p){var m=JSON.parse(p);this.callEvent("serverReturn",m)},c.prototype.openFileResult=function(p){JSON.parse(p).linkServer||console.log("link mx serverobj error"),this.callEvent("openFileResult",p)},c.prototype.xzSize=function(p){var m=this._devicePixelRatio;if(m-1<=1e-4&&-1e-4<=m-1)return p;for(var f=9999999,N=p,P=0,O=p;P<100;P++){if((te=(Z=O*m)-Math.floor(Z))<=.001)return O;te<f&&(f=te,N=O),O+=1}for(O=p;P<100;P++){var Z,te;if((te=(Z=O*m)-Math.floor(Z))<=.001)return O;te<f&&(f=te,N=O),--O}return N},c.prototype.setSize=function(p,m){this._viewWidth=p,this._viewHeight=m,this._userCanvas!=null&&(this._userCanvas.width=p,this._userCanvas.height=m,this._userCanvas.style.width=p+"px",this._userCanvas.style.height=m+"px"),this.onResizeImp(),this.updateDisplay()},c.prototype.getCurrentColor=function(){return this._color},c.prototype.setCurrentColor=function(p){this._color=p},c.prototype.call=function(p,m,f){this._net.getSend().CallServerJS(p,m,f)},c.prototype.zoomAll=function(){this._is2d&&this.call("getDatabaseBoundHelp",'{"isBackground":1}',function(p){if(p.length!=0){var m=JSON.parse(p);this.zoomW(new M.Vector3(m[0],m[1],0),new M.Vector3(m[2],m[3],0))}})},c.prototype.getViewCenterDocCoord=function(){return this._userCanvas!=null?this.screenCoord2Current(.5*this._userCanvas.clientWidth,.5*this._userCanvas.clientHeight,0):this.screenCoord2Current(.5*this._viewWidth,.5*this._viewHeight,0)},c.prototype.closeWebSocket=function(){this._net.closeWebSocket()},c.prototype.findMxEntityAtPoint=function(p,m,f){!m&&m!==void 0||(p=this.currentCoord2Screen(p.x,p.y,0));var N=[],P=this.m_mxDatabase.getIntersectObjects(p);if(P.length==0)return N;var O=new Map;return P.forEach(function(Z){var te=(0,W.MxGetMxDbEntitForThreeJsObject)(Z.object);if(te){var de=te.objectId();if(!O.has(de)){if(f){var me=(0,W.MxGetWordDrawxDataForThreeJsObject)(Z.object);me&&f(de,me)}O.set(de,te.getUserObject())}}}),O.forEach(function(Z){N.push(Z)}),N},c.prototype.isCppMxCAD=function(){return this._runMode==a.kCPPMxCAD},c.prototype.loadMxCADImage=function(p,m,f){var N=this;f===void 0&&(f=""),this.mcObject.isValid()?(f.length==0&&(f=p).lastIndexOf("/")!=-1&&(f=f.substring(f.lastIndexOf("/")+1).toLowerCase()),this.mcObject.getTextureManager().loadImage(p,f,function(P,O){P?(N.mcObject.getTextureManager().createOpenGLTexture(p),m(O)):m(void 0)})):m(void 0)},c.prototype.onLoad=function(p){if(this._runMode==a.kCPPMxCAD)this.callInitCompleteEvent();else if(this._isStaticLocalLoad)this._net=new y.MxNet,this._net.init(this,!1),0<this._openFile.length&&(this._staticLocalNet=new B.MxLocalDwgFileLoad(this._net),this._staticLocalNet.load(encodeURIComponent(this._staticLocalLoadPath),encodeURIComponent(this._openFile)));else if(this._openFile.length==0)this.callInitCompleteEvent(),this.callOpenFileComplete(0);else if(this._net=new y.MxNet,this._net.init(this,!1),this._staticNet=new y.MxHFileLoad(this._net),this._staticNet.setRequestHeader(this._requestHeader),this._staticNet.setUrlParam(p),this._staticNet.load(this._openFile,this._staticLoadingOpenFiles),this._tzDwgStaticFile&&0<this._tzDwgStaticFile.length){var m=new y.MxNet;m.init(this,!1),this._extRefManager.createTzDwgExternalReferences(99999),m.setCurrentDatabaseId(99999),this._staticLoadTzNet=new y.MxHFileLoad(m),this._staticLoadTzNet.setShowloading(!1),this._staticLoadTzNet.setRequestHeader(this._requestHeader),this._staticLoadTzNet.load(this._tzDwgStaticFile,[])}},c.prototype.stopAllLoading=function(){this._staticNet&&this._staticNet.stopAllLoading()},c.prototype.getStaticNet=function(){return this._staticNet},c.prototype.isStaticFileNet=function(){return!this._isStaticLocalLoad&&this._staticNet!=null},c.prototype.getStaticLocalNet=function(){return this._staticLocalNet},c.prototype.getStaticLoadTzNet=function(){return this._staticLoadTzNet},c.prototype.getViewWidth=function(){return this._userCanvas!=null?this._userCanvas.clientWidth:this._viewWidth},c.prototype.getViewHeight=function(){return this._userCanvas!=null?this._userCanvas.clientHeight:this._viewHeight},c.prototype.makeCurrent=function(){D.MxManager.setCurrentMx(this),this.mcObject.makeCurrent()},c.prototype.createCanvasImageData=function(p,m){var f=0,N=0,P=!1,O=!1,Z=!1;m&&m.range_pt1&&m.range_pt2&&(Z=O=!0,this.saveZoom()),m&&m.width&&m.height&&(f=this.getViewWidth(),N=this.getViewHeight(),P=!0,this.setSize(m.width,m.height)),Z&&this.zoomW(m.range_pt1,m.range_pt2);var te=this;this._callCreateCanvasImageData=function(de){P&&te.setSize(f,N),O&&te.recoverZoom(),p(de)},this.updateDisplay()},c.prototype.getIntersectObjects=function(p){return this.getMxDrawThreeJs().createRaycaster(p).intersectObjects(this.threejsselectObjects.children,!0)},c.prototype.addObject=function(p){this.threejsselectObjects.add(p)},c.prototype.removeObject=function(p){this.threejsselectObjects.remove(p)},c.prototype.render=function(){this.secenView?(this.mcObject.updateDisplay()?(this.renderer.autoClear=!1,this.renderer.state.reset()):this.renderer.autoClear=!0,this.renderer.render(this.secenView,this.cameraView),this.renderer.autoClear=!1):this.mcObject.updateDisplay()?(this.renderer.autoClear=!1,this.renderer.state.reset()):this.renderer.autoClear=!0,this.renderer.render(this.scene,this.camera),this._callCreateCanvasImageData!=null&&(this._callCreateCanvasImageData(this.renderer.domElement.toDataURL("image/png")),this._callCreateCanvasImageData=void 0),this.callEvent("render",this.renderer)},c.prototype.updateDisplay=function(p){p===void 0&&(p=!1),this.mxdrawThreeJS.updateDisplay(p)},c.prototype.isRenderLoop=function(){return this._isAnimation},c.prototype.renderLoop=function(p){p===void 0&&(p=!0),this._isAnimation=p,this.updateDisplay()},c.prototype.updateDisplayImplement=function(p){p===void 0&&(p=!1);var m=this,f=function(){m.m_mxDatabase.upDirtyDisplay(),m._isAnimation?(m._isAnimationStarting=!0,requestAnimationFrame(f)):m._isWaiteCount=0,m.render()};p!==!0?this._isAnimationStarting||(this._isAnimation?requestAnimationFrame(f):((5<this._isWaiteCount||this._isWaiteCount<0)&&(this._isWaiteCount=0),this._isWaiteCount<=0&&requestAnimationFrame(f),this._isWaiteCount++)):f()},c.prototype.gotoLayoutOld=function(p){p=="Modle"&&(p="");var m=this._openFile;for(var f in this._iniParam)(Z=(O=this._iniParam[f])[0])=="srcname"&&(m=O[1]);var N={},P="";for(var f in this._iniParam){var O,Z;if(N[Z=(O=this._iniParam[f])[0]]==null){N[Z]=!0;var te=O[1];if(Z=="file"){if(te=m,0<p.length){var de=te.substring(te.lastIndexOf(".")+1);te=te.substring(0,te.lastIndexOf("."))+"%23"+p+"%23."+de}}else if(Z=="srcname")continue;P.length==0?P=Z+"="+te+"&srcname="+m:P+="&"+Z+"="+te}}var me=I.MxFun.getLocationPageUrl()+"?"+P;window.location.href=me},c.prototype.gotoLayout=function(p){var m=!1,f=!this.isStaticFileNet();for(var N in this._iniParam)if((me=this._iniParam[N])[0]=="dwgdir"){m=!0;break}if(m||f)this.gotoLayoutOld(p);else{p=="Model"&&(p="");var P=this._openFile;if(!P)return;var O=P.lastIndexOf(".dwg");if(O===void 0||O===-1)return;if((P=P.substring(0,O))[P.length-1]=="#"){var Z=P.substring(0,P.length-1),te=Z.lastIndexOf("#");te!==void 0&&te!==-1&&(P=Z.substring(0,te))}0<p.length?P=P+"#"+p+"#.dwg.mxb1.wgh":P+=".dwg.mxb1.wgh";var de={};for(var N in this._iniParam){var me,we=(me=this._iniParam[N])[0];if(de[we]==null){de[we]=!0;var ge=me[1];we!="file"&&we!="srcname"&&(P+="&"+we+"="+ge)}}var Le=I.MxFun.getLocationPageUrl()+"?file="+P;window.location.href=encodeURI(Le)}},c.prototype.addInitParam=function(p,m){var f=new Array;f.push(p),f.push(m),this._iniParam.push(f)},c.prototype.openFile=function(p,m){if(m===void 0&&(m=""),!this._isCreate)return console.log("mx: openFile Fialed mxasser(_isCreate == false)"),!1;if(this.stopAllLoading(),p.length==0)return!1;this.reInit(),this._devicePixelRatio=window.devicePixelRatio,p instanceof Array?(this._openFile=p[0],this._staticLoadingOpenFiles=p):this._openFile=p,this._openFileExtName=this._openFile.substring(this._openFile.lastIndexOf(".")+1),this._iniParam=[],this._initZoomwCoordPt1=null,this._initZoomWCoordPt2=null;var f=new Array;return f.push("file"),f.push(this._openFile),this._iniParam.push(f),this.onLoad(m),!0},c.prototype.updateCameraDisplayRange=function(p,m,f){this.mxdrawThreeJS.updateCameraDisplayRange(p,m,f)},c.prototype.updateCameraForm3dViewData=function(p){this.mxdrawThreeJS.updateCameraForm3dViewData(p)},c.prototype.clearAllObject=function(){this.reInit()},c.prototype.newFile=function(p,m,f,N){if(!this._isCreate)return console.log("mx: openFile Fialed mxasser(_isCreate == false)"),!1;var P,O;if(O=p instanceof Object&&m instanceof Object?(P=p,m):(P=new M.Vector3(p,m,0),new M.Vector3(f,N,0)),P.x>O.x){var Z=P.x;P.x=O.x,O.x=Z}if(P.y>O.y){var te=P.y;P.y=O.y,O.y=te}this.reInit(),this._devicePixelRatio=window.devicePixelRatio,this._openFile="",this._openFileExtName="dwg",this._iniParam=[],this._initZoomwCoordPt1=null,this._initZoomWCoordPt2=null;var de=new M.Matrix4;de.identity(),this.intiDoc2Wold(de),this.initCAD2Doc(de),this.initializingObjectMatrix(),this.mxdrawThreeJS.updateCameraDisplayRange(P,O,0),this.updateDisplay(!0);var me=I.MxFun.getUiObj();me!=null&&(me.SetLayoutData(this._allLayoutName),me.UpDisplayLayout())},c.prototype.calcViewsize=function(){if(this._userCanvas==null)return{viewWidth:window.innerWidth,viewHeight:window.innerHeight};var p=this._userCanvas.clientWidth,m=this._userCanvas.clientHeight;if(this._event.onResize!=null){var f=this._event.onResize;f instanceof Array&&(f=f[0]);var N=f();N!=null&&(p=parseInt(N.width),m=parseInt(N.height))}return{viewWidth:p,viewHeight:m}},c.prototype.initMxCpp=function(p){p&&p.getImp()?(this.mcObject.init(this,p),this.secenView!=null?this.secenView.background=null:this.scene.background=null):console.log("mxerror: mcppObjectImp is null")},c.prototype.create=function(p,m,f,N){if(this._is2d?this.mxdrawThreeJS=N?new S.MxDrawMapBoxThreeJS(N,this):new S.MxDrawObject2dThreeJS(this):this.mxdrawThreeJS=new S.MxDrawObject3dThreeJS(this),this._callCreateCanvasImageData=void 0,this._devicePixelRatio=window.devicePixelRatio,this._runMode==a.kCPPMxCAD)this._openFile="";else{if(m instanceof Array?(this._openFile=m[0],this._staticLoadingOpenFiles=m):this._openFile=m,this._iniParam=I.MxFun.getUrlParams(),this._openFileExtName=this._openFile.substring(this._openFile.lastIndexOf(".")+1),this._openFile!=""){var P=new Array;P.push("file"),P.push(this._openFile),this._iniParam.push(P)}this._userIdentitySign!=""&&(this.addInitParam("userIdentitySign",this._userIdentitySign),this.addInitParam("userRandomToken",this._userRandomToken)),this.addInitParam("runMode","browse")}this._userCanvas=p;var O=window.innerWidth,Z=window.innerHeight;if(p!=null&&(O=p.clientWidth,Z=p.clientHeight),this._viewWidth=O,this._viewHeight=Z,this.m_mxDatabase.getSelectManager().setCanvasSize(O,Z),this.mxdrawThreeJS.onInitThreejs(),this.eventManager.registEvent(this),this.onCreate(),this.m_mxDatabase.init(this),this._parentDocObject=new M.Object3D,this.scene.add(this._parentDocObject),this._parentDocObject_SmallCoord=new M.Object3D,this.scene.add(this._parentDocObject_SmallCoord),this.threejsselectObjects=new M.Object3D,this.scene.add(this.threejsselectObjects),this._objectsOsnap=new z.MxDrawObjectOsnap(this),this.tempMarkDraw.init(this),D.MxManager.add(this),D.MxManager.setCurrentMx(this),this.mxdrawThreeJS.addControlsChangeEvent(),N||this.updateDisplay(),this.mxdrawThreeJS.getType()!=S.MxThreeJSType.kMapBox){var te=this;if(p==null){var de=function(Ie,ze){ze===void 0&&(ze=!0),te._viewWidth=window.innerWidth,te._viewHeight=window.innerHeight,te.onResizeImp()&&te.updateDisplay(ze)};window.addEventListener("resize",de,!1),this._onResizeFun=de}else{var me=function(Ie,ze){ze===void 0&&(ze=!0),Ie&&Ie.viewWidth&&Ie.viewHeight||(Ie=te.calcViewsize()),te._viewWidth=Ie.viewWidth,te._viewHeight=Ie.viewHeight,te.onResizeImp(te._viewWidth,te._viewHeight)&&te.updateDisplay(ze)};if(this._onResizeFun=me,this._event.addResizeEvent!=null){var we=this._event.addResizeEvent;we instanceof Array&&(we=we[0]),we(me,p)}else window.addEventListener("resize",me,!1);if(window.setTimeout(function(){me(void 0,!1)},5),this._event.onResize!=null){var ge=te.calcViewsize();me(ge,!1);var Le=0,Pe=0,ae=!0,ve=window.setInterval(function(){Pe++;var Ie=te.calcViewsize();if(Ie.viewWidth==ge.viewWidth&&Ie.viewHeight==ge.viewHeight&&0<Ie.viewWidth&&0<Ie.viewHeight){if(8<++Le)return clearInterval(ve),void me(Ie,!1);1<=Le&&ae&&(me(Ie,!1),2<=Le&&(ae=!1))}else Le=0;ge=Ie,50<Pe&&(clearInterval(ve),0<Ie.viewWidth&&0<Ie.viewHeight?me(Ie,!1):console.log("mxassert(0) error view size"))},50)}}}this.callInitObjectEvent(),this.onLoad(f),this._isCreate=!0},c.prototype.initResize=function(){if(this._userCanvas==null)this._viewWidth=window.innerWidth,this._viewHeight=window.innerHeight,this.onResizeImp();else{if(this._viewWidth=this._userCanvas.clientWidth,this._viewHeight=this._userCanvas.clientHeight,this._event.onResize!=null){var p=this._event.onResize;p instanceof Array&&(p=p[0]);var m=p();m!=null&&(this._viewWidth=m.width,this._viewHeight=m.height)}this.onResizeImp(this._viewWidth,this._viewHeight)}this.updateDisplay()},c.prototype.is2D=function(){return this._is2d},c.prototype.getOpenFile=function(){return this._openFile},c.prototype.getFileTitle=function(){var p=this._openFile;if(this._openFile.substring(this._openFile.lastIndexOf(".")+1).toLowerCase()=="wgh"){var m=this._openFile.substring(0,this._openFile.indexOf(".mxb1.wgh")).split("/");(p=m.length==1?m[0]:m[m.length-1])[0]=="$"&&(p=p.substring(1))}return p},c.prototype.getIniParam=function(){return this._iniParam},c.prototype.getOpenFileExtName=function(){return this._openFileExtName},c.prototype.loadCodeToServer=function(p,m){this._net.getSend().CallLoadCodeToServer(p,m)},c.prototype.userLogin=function(p,m){this._net.getSend().UserLogin(p,m)},c.prototype.getUserCanvas=function(){return this._userCanvas},c.prototype.getCanvas=function(){return this._userCanvas!=null?this._userCanvas:this.renderer.domElement},c.prototype.getScene=function(){return this.scene},c.prototype.getCamera=function(){return this.camera},c.prototype.callCommand=function(p,m,f){m===void 0&&(m=""),this._net.getSend().DoCommand(p,m,f)},c.prototype.deleteAll=function(){this.removeAllEntity(),this.callCommand("Mx_ClearAll"),this.updateDisplay()},c.prototype.initAllLayoutName=function(p){this._allLayoutName=p},c.prototype.getAllLayoutName=function(){return this._allLayoutName},c.prototype.updataClipMaterial=function(){this._blocks.updataClipMaterial(this)},c.prototype.getExtRefManager=function(){return this._extRefManager},c.prototype.showLayer=function(p,m){typeof p=="string"&&(p=this._layers.getLayerIdForName(p)),this._blocks.showLayer(p,m),this.updateDisplay()},c.prototype.addLayerInfo=function(p,m,f){m=this.automaticInversionColor(16777215&m),this._layers.add(p,m,f)},c.prototype.setZeroLayerId=function(p){this._layers.setZeroLayerId(p)},c.prototype.addLayerInfoComplete=function(){this._layers.initComplete()},c.prototype.addEntity=function(p,m){var f=this._mapId2Entity.get(p);f==null&&(f=new Array,this._mapId2Entity.set(p,f)),f.push(m)},c.prototype.getEntity=function(p){return this._mapId2Entity.get(p)},c.prototype.clearThreejsScence=function(){this.m_mxDatabase.getGripManager().reInit(),this.isValidMcObject()&&this.mcObject.getGripManager().reInit(),I.MxFun.removeThreejsObject(this.threejsselectObjects,this.scene),this.threejsselectObjects=new M.Object3D,I.MxFun.removeThreejsObject(this._parentDocObject,this.scene),this._parentDocObject=new M.Object3D,I.MxFun.removeThreejsObject(this._parentDocObject_SmallCoord,this.scene),this._parentDocObject_SmallCoord=new M.Object3D,this.scene.remove(),this.scene.dispose(),this.scene=new M.Scene,this.scene.add(this.threejsselectObjects),this.scene.add(this._parentDocObject),this.scene.add(this._parentDocObject_SmallCoord),this._objectsOsnap=new z.MxDrawObjectOsnap(this),this.m_mxDatabase.reInit(),this.tempMarkDraw.init(this),this.mxdrawThreeJS.onInitScene(),I.MxFun.removeThreejsObject(this.threejsselectObjectsView,this.secenView),this.threejsselectObjectsView=null,this.secenView.remove(),this.secenView.dispose(),this.secenView=null,this.onInitViewScene(),this._runMode!=a.kCPPMxCAD&&this.mxdrawThreeJS.getType()!=S.MxThreeJSType.kMapBox||(this.secenView!=null?this.secenView.background=null:this.scene.background=null)},c.prototype.reInit=function(){this.clearThreejsScence(),this._openFile="",this._openFileExtName="",this._mapId2Entity=new Map,this._setAdyDelete=new Map,this._layers=new H.MxBrowseLayerData,this._blocks=new G.Blocks,this._extRefManager=new G.ExternalReferenceManager,this._doc2World=new M.Matrix4,this._word2doc=new M.Matrix4,this._allLayoutName=new Array,this._tzDwgStaticFile="",this._devicePixelRatio=window.devicePixelRatio,this._blocks.initRootBlockRef()},c.prototype.removeEntity=function(p){if(this._setAdyDelete[p]==null){this._setAdyDelete[p]=!0;var m=this._mapId2Entity.get(p);if(m!=null){for(var f in m)this.scene.remove(m[f]);this._mapId2Entity.delete(p)}}},c.prototype.removeEntityFromServer=function(p){for(var m=p.getInt32(4,!0),f=0;f<m;f++){var N=p.getInt32(4*(f+20),!0);this.removeEntity(N)}},c.prototype.removeAllEntity=function(){var p=this;this._mapId2Entity.forEach(function(m,f,N){for(var P in m)p.scene.remove(m[P])}),this._mapId2Entity.clear()},c.prototype.mxWebAddEntity=function(p){this._setAdyDelete.clear();var m=this.mxWebAddEntity_3DChild(p);this.mxWebAddEntity_Curve(p,m),this._setAdyDelete.clear()},c.prototype.getViewWorldCoord=function(){var p=new M.Vector3(-1,-1,1);p.unproject(this.camera);var m=new M.Vector3(-1,1,1);m.unproject(this.camera);var f=new M.Vector3(1,1,1);f.unproject(this.camera);var N=new M.Vector3(1,-1,1);return N.unproject(this.camera),{pt1:p,pt2:m,pt3:f,pt4:N}},c.prototype.getViewDocCoord=function(){var p=this.getViewWorldCoord();return p.pt1=this.docCoord2Cad2(this.worldCoord2Doc(p.pt1.x,p.pt1.y,0)),p.pt2=this.docCoord2Cad2(this.worldCoord2Doc(p.pt2.x,p.pt2.y,0)),p.pt3=this.docCoord2Cad2(this.worldCoord2Doc(p.pt3.x,p.pt3.y,0)),p.pt4=this.docCoord2Cad2(this.worldCoord2Doc(p.pt4.x,p.pt4.y,0)),p},c.prototype.screenCoord2World=function(p,m,f){return this.mxdrawThreeJS.screenCoord2World(p,m,f)},c.prototype.worldCoord2Screen=function(p,m,f){return this.mxdrawThreeJS.worldCoord2Screen(p,m,f)},c.prototype.screenCoord2World_mxdrawThreeJS_call=function(p,m,f){var N=this.getCanvas(),P=N.clientWidth,O=N.clientHeight;f=.5;var Z=this.camera;Z&&Z.isOrthographicCamera&&(f=(Z.near+Z.far)/(Z.near-Z.far));var te=new M.Vector3(p/P*2-1,-m/O*2+1,f);return te.unproject(this.camera),te.z=0,te},c.prototype.worldCoord2Screen_mxdrawThreeJS_call=function(p,m,f){var N=new M.Vector3(p,m,f).project(this.camera),P=this.getCanvas(),O=P.clientWidth/2,Z=P.clientHeight/2,te=Math.round(N.x*O+O),de=Math.round(-N.y*Z+Z);return new M.Vector3(te,de,0)},c.prototype.worldCoordLong2Doc=function(p){var m=this.worldCoord2Doc(0,0,0),f=this.worldCoord2Doc(p,0,0);return m.distanceTo(f)},c.prototype.docCoordLong2World=function(p){var m=this.docCoord2World(0,0,0),f=this.docCoord2World(p,0,0);return m.distanceTo(f)},c.prototype.getDoc2CADMatrix=function(){return this._doc2CAD},c.prototype.docCoord2Cad=function(p,m,f){var N=new M.Vector3(p,m,f);return N.applyMatrix4(this._doc2CAD),N},c.prototype.toSmallcoord=function(p){return this._runMode==a.kCPPMxCAD?this.cadCoord2Doc2(p):p},c.prototype.toSmallcoord2=function(p,m,f){return f===void 0&&(f=0),this._runMode==a.kCPPMxCAD?this.cadCoord2Doc(p,m,f):new M.Vector3(p,m,f)},c.prototype.docCoord2Cad2=function(p){return(p=p.clone()).applyMatrix4(this._doc2CAD),p},c.prototype.cadCoord2Doc=function(p,m,f){var N=new M.Vector3(p,m,f);return N.applyMatrix4(this._cad2Doc),N},c.prototype.cadCoord2Doc2=function(p){return(p=p.clone()).applyMatrix4(this._cad2Doc),p},c.prototype.docCoordLong2Cad=function(p){var m=this.docCoord2Cad(0,0,0),f=this.docCoord2Cad(p,0,0);return m.distanceTo(f)},c.prototype.cadCoordLong2Doc=function(p){var m=this.cadCoord2Doc(0,0,0),f=this.cadCoord2Doc(p,0,0);return m.distanceTo(f)},c.prototype.viewCoordLong2Cad=function(p){return this.docCoordLong2Cad(this.screenCoordLong2Doc(p))},c.prototype.cadCoordLong2View=function(p){return this.docCoordLong2Screen(this.cadCoordLong2Doc(p))},c.prototype.viewCoord2Cad=function(p,m,f){var N=this.screenCoord2Doc(p,m,f);return this.docCoord2Cad(N.x,N.y,N.z)},c.prototype.cadCoord2View=function(p,m,f){var N=this.cadCoord2Doc(p,m,f);return this.docCoord2Screen(N.x,N.y,N.z)},c.prototype.docCoord2World=function(p,m,f){var N=new M.Vector3(p,m,f);return N.applyMatrix4(this._doc2World),N},c.prototype.getDoc2World=function(){return this._doc2World},c.prototype.getWorldToDoc=function(){return this._word2doc},c.prototype.worldCoord2Doc=function(p,m,f){var N=new M.Vector3(p,m,f);return N.applyMatrix4(this._word2doc),N},c.prototype.screenCoord2Doc=function(p,m,f){var N=this.screenCoord2World(p,m,f);return this.worldCoord2Doc(N.x,N.y,0)},c.prototype.worldCoord2Currnet=function(p,m,f){var N=new M.Vector3(p,m,f);return N.applyMatrix4(this._word2Current),N},c.prototype.currentCoord2World=function(p,m,f){var N=new M.Vector3(p,m,f);return N.applyMatrix4(this._current2word),N},c.prototype.screenCoord2Current=function(p,m,f){var N=this.screenCoord2World(p,m,f);return N.applyMatrix4(this._word2Current),N},c.prototype.currentCoord2Screen=function(p,m,f){var N=new M.Vector3(p,m,f);return N.applyMatrix4(this._current2word),this.worldCoord2Screen(N.x,N.y,N.z)},c.prototype.docCoord2Screen=function(p,m,f){var N=this.docCoord2World(p,m,f);return this.worldCoord2Screen(N.x,N.y,N.z)},c.prototype.screenCoordLong2Doc=function(p){var m=this.screenCoord2Doc(0,0,0),f=this.screenCoord2Doc(p,0,0);return m.distanceTo(f)},c.prototype.screenCoordLong2DocScale=function(){var p=this.screenCoord2Doc(0,0,0),m=this.screenCoord2Doc(1,0,0);return p.distanceTo(m)},c.prototype.docCoordLong2Screen=function(p){var m=this.docCoord2Screen(0,0,0),f=this.docCoord2Screen(0<p?p:-p,0,0);return 0<=p?m.distanceTo(f):-m.distanceTo(f)},c.prototype.screenCoordLong2World=function(p){var m=this.screenCoord2World(0,0,0),f=this.screenCoord2World(0<p?p:-p,0,0);return 0<=p?m.distanceTo(f):-m.distanceTo(f)},c.prototype.worldCoordLong2Screen=function(p){var m=this.worldCoord2Screen(0,0,0),f=this.worldCoord2Screen(p,0,0);return m.distanceTo(f)},c.prototype.initCAD2Doc=function(p){p instanceof Array?this._cad2Doc.fromArray(p):this._cad2Doc=p,this._doc2CAD.getInverse(this._cad2Doc),this.mcObject.initCAD2Doc(this._cad2Doc,this._doc2CAD)},c.prototype.intiDoc2Wold=function(p){p instanceof Array?this._doc2World.fromArray(p):this._doc2World=p,this._word2doc.getInverse(this._doc2World)},c.prototype.intiword2Current=function(p){this._word2Current=p.clone(),this._current2word.getInverse(this._word2Current)},c.prototype.initializingObjectMatrix=function(){this.isNewObjectMatrix&&this._runMode==a.kCPPMxCAD?(this.m_mxDatabase.initObjectMatrix(this._cad2Doc),this._parentDocObject.matrix=this._cad2Doc,this._parentDocObject.matrixAutoUpdate=!1,this._parentDocObject_SmallCoord.matrix=new M.Matrix4,this._parentDocObject_SmallCoord.matrixAutoUpdate=!1,this.threejsselectObjects.matrix=this._cad2Doc,this.threejsselectObjects.matrixAutoUpdate=!1,this.intiword2Current(this._doc2CAD)):(this.m_mxDatabase.initObjectMatrix(this._doc2World),this._parentDocObject.matrix=this._doc2World,this._parentDocObject.matrixAutoUpdate=!1,this._parentDocObject_SmallCoord.matrix=this._doc2World,this._parentDocObject_SmallCoord.matrixAutoUpdate=!1,this.threejsselectObjects.matrix=this._doc2World,this.threejsselectObjects.matrixAutoUpdate=!1,this.intiword2Current(this._word2doc))},c.prototype.getDrawContainer=function(){return this.threejsselectObjects},c.prototype.getTheTempDrawContainer=function(){return this._parentDocObject},c.prototype.getTheTempDrawContainer_SmallCoord=function(){return this._parentDocObject_SmallCoord},c.prototype.getTempMarkDraw=function(){return this.tempMarkDraw},c.prototype.mxWebAddEntityFor2dPointMeshBuffers=function(p,m){var f=new L.MxNetData(p),N=f.getdPointMeshBuffersHead(),P=N.zeroLayerIdIndex,O=N.databaseIndex;m!=-1&&(O=m);for(var Z=N.datasize,te=0;te<N.datacount;te++){var de=f.getdPointMeshBufferDataHead(Z);Z=de.offset;var me=de.layerId,we=me==P,ge=de.blkId,Le=de.pointCount;if(!(Le<1)){for(var Pe=[],ae=[],ve=[],Ie=[],ze=[],He=0;He<Le;He++){var at=p.getFloat32(Z,!0);Z+=4;var tt=p.getFloat32(Z,!0);Z+=4;var le=p.getFloat32(Z,!0);Z+=4;var De=p.getFloat32(Z,!0);Z+=4;var st=p.getFloat32(Z,!0);Z+=4;var gt=p.getFloat32(Z,!0);Z+=4;var St=p.getInt32(Z,!0);Z+=4;var Rt=St>>24&255;Rt==2?(Ie.push(at,tt),Ie.push(le,De),Ie.push(st,gt)):Rt==1?ge!=0&&we?(ze.push(at,tt),ze.push(le,De),ze.push(st,gt)):(ve.push(at,tt),ve.push(le,De),ve.push(st,gt)):(St=this.automaticInversionColor(16777215&St),Pe.push(at,tt),Pe.push(le,De),Pe.push(st,gt),ae.push((255&St)/255,(St>>8&255)/255,(St>>16&255)/255),ae.push((255&St)/255,(St>>8&255)/255,(St>>16&255)/255),ae.push((255&St)/255,(St>>8&255)/255,(St>>16&255)/255))}var Pt=this._blocks,Je=this._layers;O!=0&&(Pt=this._extRefManager.getBlocks(O),Je=this._extRefManager.getLayers(O));var bt=Pt.crateBlock(ge);bt.addGeometryMesh(Pe,ae,me,Ie,ve,ze),Pt.createThreejsObj(bt,this,Je)}}},c.prototype.mxWebAddEntityForMemorySections=function(p,m){var f=new L.MxNetData(p),N=f.getMemorySectionsHead(),P=(N.zeroLayerIdIndex,N.databaseIndex);m!=-1&&(P=m);var O=N.nOffset,Z=this._blocks,te=this._layers;P!=0&&(Z=this._extRefManager.getBlocks(P),te=this._extRefManager.getLayers(P));for(var de=0;de<N.datacount;de++){var me=f.getMemorySectionHead(O);O=me.offset;var we=new G.MxNewDisplayMemorySection;we.layerId=me.layerId,we.blockId=me.blkId,we.id=me.memId,we.color=me.memColor,we.type=me.memType;var ge=!1;we.type==G.MxNewDisplayMemorySectionType.kLinesType_Float?(ge=!0,we.type=G.MxNewDisplayMemorySectionType.kLinesType):we.type==G.MxNewDisplayMemorySectionType.kTriangleType_Float?(ge=!0,we.type=G.MxNewDisplayMemorySectionType.kTriangleType):we.type==G.MxNewDisplayMemorySectionType.kPointType_Float&&(ge=!0,we.type=G.MxNewDisplayMemorySectionType.kPointType);var Le=me.pointCount;if(!(Le<1)){for(var Pe=[],ae=0;ae<Le;ae++)if(ge){var ve=p.getFloat32(O,!0);O+=4;var Ie=p.getFloat32(O,!0);O+=4,p.getFloat32(O,!0),O+=4,Pe.push(ve,Ie,0)}else ve=p.getFloat64(O,!0),O+=8,Ie=p.getFloat64(O,!0),O+=8,p.getFloat64(O,!0),O+=8,Pe.push(ve,Ie,0);we.points=Pe;var ze=Z.crateBlock(we.blockId);ze.addMemorySections(we),Z.createThreejsObj(ze,this,te)}}},c.prototype.convertBytesToUTF8=function(p,m){var f=0;m=Math.min(m||p.length,p.length),p[0]===239&&p[1]===187&&p[2]===191&&(f=3);for(var N=[],P=0;f<m;P++){var O,Z,te,de=p[f++];if(de===0)break;de<128?N[P]=String.fromCharCode(de):194<=de&&de<224?(O=p[f++],N[P]=String.fromCharCode(((31&de)<<6)+(63&O))):224<=de&&de<240?(O=p[f++],Z=p[f++],N[P]=String.fromCharCode(((15&de)<<12)+((63&O)<<6)+(63&Z))):240<=de&&de<245&&(te=((7&de)<<18)+((63&(O=p[f++]))<<12)+((63&(Z=p[f++]))<<6)+(63&p[f++])-65536,N[P]=String.fromCharCode(55296+(te>>10),56320+(1023&te)))}return N.join("")},c.prototype.mxWebAddEntityFor2dPointTextureBuffers=function(p,m){var f=new L.MxNetData(p),N=f.getdPointTextureBuffersHead(),P=N.ver,O=(N.zeroLayerIdIndex,N.databaseIndex);m!=-1&&(O=m);for(var Z=N.datasize,te=0;te<N.datacount;te++){var de=f.getdPointTextureBufferDataHead(Z);Z=de.offset;var me=de.layerId,we=de.blkId,ge=de.dataCount;if(!(ge<1)){var Le=0,Pe=this._blocks,ae=this._layers;O!=0&&(Pe=this._extRefManager.getBlocks(O),ae=this._extRefManager.getLayers(O));for(var ve=Pe.crateBlock(we);Le<ge;Le++){var Ie=p.getFloat64(Z,!0);Z+=8;var ze=p.getFloat64(Z,!0);Z+=8;var He=p.getFloat64(Z,!0);Z+=8;var at=p.getUint32(Z,!0);Z+=4;var tt=p.getUint32(Z,!0);Z+=4;var le=this.convertBytesToUTF8(new Uint8Array(p.buffer.slice(Z,Z+tt)),void 0);Z+=tt;var De=[],st=[],gt=[];if(!(at<1)){for(var St=0;St<at;St++){if(5<=P){var Rt=p.getFloat64(Z,!0);Z+=8;var Pt=p.getFloat64(Z,!0);Z+=8,p.getFloat64(Z,!0),Z+=8;var Je=p.getFloat64(Z,!0);Z+=8;var bt=p.getFloat64(Z,!0);Z+=8,p.getFloat64(Z,!0),Z+=8;var jt=p.getFloat64(Z,!0);Z+=8;var Ln=p.getFloat64(Z,!0);Z+=8,p.getFloat64(Z,!0),Z+=8,De.push(Rt,Pt),De.push(Je,bt),De.push(jt,Ln)}else Rt=p.getFloat32(Z,!0),Z+=4,Pt=p.getFloat32(Z,!0),Z+=4,Je=p.getFloat32(Z,!0),Z+=4,bt=p.getFloat32(Z,!0),Z+=4,jt=p.getFloat32(Z,!0),Z+=4,Ln=p.getFloat32(Z,!0),Z+=4,De.push(Rt,Pt),De.push(Je,bt),De.push(jt,Ln);var Yt=p.getInt32(Z,!0);Z+=4;var Qt=p.getFloat32(Z,!0);Z+=4;var Ve=p.getFloat32(Z,!0);Z+=4;var Be=p.getFloat32(Z,!0);Z+=4;var Wt=p.getFloat32(Z,!0);Z+=4;var Kn=p.getFloat32(Z,!0);Z+=4;var nn=p.getFloat32(Z,!0);Z+=4;var ct=Yt>>24&255;Yt=ct==2||ct==1?16777215:this.automaticInversionColor(16777215&Yt),gt.push(Qt,Ve),gt.push(Be,Wt),gt.push(Kn,nn),st.push((255&Yt)/255,(Yt>>8&255)/255,(Yt>>16&255)/255),st.push((255&Yt)/255,(Yt>>8&255)/255,(Yt>>16&255)/255),st.push((255&Yt)/255,(Yt>>8&255)/255,(Yt>>16&255)/255)}ve.addGeometryTexture(De,gt,st,me,le,Ie,ze,He)}}Pe.createThreejsObj(ve,this,ae)}}},c.prototype.mxWebAddEntityFor2dPointCurveBuffers=function(p,m){var f=new L.MxNetData(p),N=f.getdPointCurveBuffersHead(),P=N.zeroLayerIdIndex,O=N.databaseIndex;m!=-1&&(O=m);for(var Z=N.datasize,te=0;te<N.datacount;te++){var de=f.getdPointCurveBufferDataHead(Z);Z=de.offset;var me=de.layerId,we=me==P,ge=de.blkId,Le=de.pointCount;if(!(Le<1)){for(var Pe=[],ae=[],ve=[],Ie=[],ze=[],He=0;He<Le;He++){var at=p.getFloat32(Z,!0);Z+=4;var tt=p.getFloat32(Z,!0);Z+=4;var le=p.getFloat32(Z,!0);Z+=4;var De=p.getFloat32(Z,!0);Z+=4;var st=p.getInt32(Z,!0);Z+=4;var gt=st>>24&255;gt==2?(Ie.push(at,tt),Ie.push(le,De)):gt==1?ge!=0&&we?(ze.push(at,tt),ze.push(le,De)):(ve.push(at,tt),ve.push(le,De)):(Pe.push(at,tt),Pe.push(le,De),st=this.automaticInversionColor(16777215&st),ae.push((255&st)/255,(st>>8&255)/255,(st>>16&255)/255),ae.push((255&st)/255,(st>>8&255)/255,(st>>16&255)/255))}var St=this._blocks,Rt=this._layers;O!=0&&(St=this._extRefManager.getBlocks(O),Rt=this._extRefManager.getLayers(O));var Pt=St.crateBlock(ge);Pt.addGeometryCurve(Pe,ae,me,Ie,ve,ze),St.createThreejsObj(Pt,this,Rt)}}},c.prototype.mxWebAddEntityFor2dPointCurveBuffer=function(p,m){var f=new L.MxNetData(p);if(!f.getIsSketchEntity()){var N,P=f.getLayerId(),O=P==f.getZeroLayerId(),Z=f.getBlockId();if(!((N=p.getInt32(20,!0)/20)<1)){for(var te=80,de=[],me=[],we=[],ge=[],Le=[],Pe=0;Pe<N;Pe++){var ae=p.getFloat32(te,!0);te+=4;var ve=p.getFloat32(te,!0);te+=4;var Ie=p.getFloat32(te,!0);te+=4;var ze=p.getFloat32(te,!0);te+=4;var He=p.getInt32(te,!0);te+=4;var at=He>>24&255;at==2?(ge.push(ae,ve),ge.push(Ie,ze)):at==1?Z!=0&&O?(Le.push(ae,ve),Le.push(Ie,ze)):(we.push(ae,ve),we.push(Ie,ze)):(He=this.automaticInversionColor(16777215&He),de.push(ae,ve),de.push(Ie,ze),me.push((255&He)/255,(He>>8&255)/255,(He>>16&255)/255),me.push((255&He)/255,(He>>8&255)/255,(He>>16&255)/255))}var tt=f.getDatabaseIndex();m!=-1&&(tt=m);var le=this._blocks,De=this._layers;tt!=0&&(le=this._extRefManager.getBlocks(tt),De=this._extRefManager.getLayers(tt));var st=le.crateBlock(Z);st.addGeometryCurve(de,me,P,ge,we,Le),le.createThreejsObj(st,this,De)}}},c.prototype.mxWebAddEntityFor2dPointMeshBuffer=function(p,m){var f=new L.MxNetData(p);if(!f.getIsSketchEntity()){var N,P=f.getLayerId(),O=f.getBlockId(),Z=P==f.getZeroLayerId();if(!((N=p.getInt32(12,!0)/28)<1)){for(var te=80,de=[],me=[],we=[],ge=[],Le=[],Pe=0;Pe<N;Pe++){var ae=p.getFloat32(te,!0);te+=4;var ve=p.getFloat32(te,!0);te+=4;var Ie=p.getFloat32(te,!0);te+=4;var ze=p.getFloat32(te,!0);te+=4;var He=p.getFloat32(te,!0);te+=4;var at=p.getFloat32(te,!0);te+=4;var tt=p.getInt32(te,!0);te+=4;var le=tt>>24&255;le==2?(ge.push(ae,ve),ge.push(Ie,ze),ge.push(He,at)):le==1?O!=0&&Z?(Le.push(ae,ve),Le.push(Ie,ze),Le.push(He,at)):(we.push(ae,ve),we.push(Ie,ze),we.push(He,at)):(de.push(ae,ve),de.push(Ie,ze),de.push(He,at),tt=this.automaticInversionColor(16777215&tt),me.push((255&tt)/255,(tt>>8&255)/255,(tt>>16&255)/255),me.push((255&tt)/255,(tt>>8&255)/255,(tt>>16&255)/255),me.push((255&tt)/255,(tt>>8&255)/255,(tt>>16&255)/255))}var De=f.getDatabaseIndex();m!=-1&&(De=m);var st=this._blocks,gt=this._layers;De!=0&&(st=this._extRefManager.getBlocks(De),gt=this._extRefManager.getLayers(De));var St=st.crateBlock(O);St.addGeometryMesh(de,me,P,ge,we,Le),st.createThreejsObj(St,this,gt)}}},c.prototype.mxWebCreateAllBlocks=function(p,m){var f=new L.MxNetData(p).getDatabaseIndex();m!=-1&&(f=m);var N=this._blocks;f!=0&&(N=this._extRefManager.getBlocks(f)),N.createBlocks(p,this.scene)},c.prototype.mxWebEntitysData=function(p,m){m==-1&&this._objectsOsnap.mxWebEntitysData(p,m)},c.prototype.getObjectOsnap=function(){return this._objectsOsnap},c.prototype.saveMxEntityToJson=function(p){return this.m_mxDatabase.saveJson(p)},c.prototype.getDtabaseJsonString=function(){return JSON.stringify(this.m_mxDatabase.toJsonObject())},c.prototype.loadMxEntityFromJson=function(p){return this.m_mxDatabase.loadJson(p)},c);function c(p){this._is2d=!0,this._runMode=a.kBrowse,this._userCanvas=null,this._openFile="empty",this._staticLoadingOpenFiles=[],this._openFileExtName="",this._userIdentitySign="",this._rendererParam=void 0,this._userRandomToken="",this._isCreate=!1,this.m_iniSet={},this._net=null,this._staticNet=null,this._staticLoadTzNet=null,this._staticLocalNet=null,this._isStaticLocalLoad=!1,this._staticLocalLoadPath="",this._viewWidth=1,this._viewHeight=1,this.m_sysVariable=new C.MxSystemVariable,this._color="#FFFFFF",this._viewcolor=15790320,this._isAnimation=!1,this._isAnimationStarting=!1,this._isWaiteCount=0,this._callCreateCanvasImageData=void 0,this._event={},this.scene=null,this.camera=null,this.camera_recover=null,this.secenView=null,this.cameraView=null,this.renderer=null,this.controls=null,this.threejsselectObjectsView=null,this._mouseRightRotate=!1,this._isMouseMiddlePan=1,this._mapId2Entity=new Map,this._setAdyDelete=new Map,this._layers=new H.MxBrowseLayerData,this._blocks=new G.Blocks,this._extRefManager=new G.ExternalReferenceManager,this._doc2World=new M.Matrix4,this._word2doc=new M.Matrix4,this._cad2Doc=new M.Matrix4,this._doc2CAD=new M.Matrix4,this._word2Current=new M.Matrix4,this._current2word=new M.Matrix4,this._allLayoutName=new Array,this._devicePixelRatio=1,this._tzDwgStaticFile="",this._requestHeader="",this._objectsOsnap=null,this._initZoomwCoordPt1=null,this._initZoomWCoordPt2=null,this.m_mxDatabase=null,this._parentDocObject=null,this._parentDocObject_SmallCoord=null,this.threejsselectObjects=null,this.tempMarkDraw=new V.MxTempMarkDraw,this._onResizeFun=null,this._sCurrentLoadURL="",this.eventManager=new q.MxDrawObjectEvent,this._viewangle=0,this.id=0,this.mcObject=new _.McDrawObject,this.isPointMultipleSelect=!1,this.isNewObjectMatrix=!0,this.bakControls=void 0,this.isMultipleSelect=!1,this.mxdrawThreeJS=null,this.curMousePostion=new M.Vector2(0,0),this.m_isValidCurMousePostion=!1,this._is2d=p,this._blocks.initRootBlockRef(),this.m_iniSet[u.kEnableOsnapFunction]=!1,this.m_sysVariable.init(this),this.m_mxDatabase=new A.MxDbDatabase,this.id=D.MxManager.allocId(),v.MxDrawData.m_iIntelliSelectType==1?this.isPointMultipleSelect=!1:v.MxDrawData.m_iIntelliSelectType==2&&(this.isPointMultipleSelect=!0),this.isMultipleSelect=v.MxDrawData.m_isMultipleSelect,this.mcObject.initMxObject(this)}o.MxDrawObject=Y},{"./MxDrawData":22,"./MxDrawObjectEvent":26,"./MxFun":27,"./MxLocalFileLoad":28,"./MxManager":29,"./MxNetData":31,"./MxSystemVariable":35,"./MxTempMarkDraw":36,"./Operate/MxDrawObjectOsnap":49,"./UI/MxUiVue":65,"./View/MxBrowseDisplay":66,"./View/MxBrowseLayerData":67,"./View/MxDbDatabase":68,"./View/MxDbEntityGrip":70,"./View/MxDrawMapBox":75,"./cpp/McDrawObject":78,three:19}],24:[function(T,r,o){var a,x=this&&this.__extends||(a=function(A,S){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,W){q.__proto__=W}||function(q,W){for(var _ in W)Object.prototype.hasOwnProperty.call(W,_)&&(q[_]=W[_])})(A,S)},function(A,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function q(){this.constructor=A}a(A,S),A.prototype=S===null?Object.create(S):(q.prototype=S.prototype,new q)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawObject2d=void 0;var u,M=T("three"),I=T("./MxFun"),H=T("./MxDrawObject"),G=T("three-orbitcontrols"),L=T("./MxNetData"),y=T("./MxMaterial"),D=T("./MxDrawData"),C=T("./View/MxDrawMapBox"),B=(x(z,u=H.MxDrawObject),z.prototype.set3DDraw=function(A){this.is3DDraw=A},z.prototype.getOrthographicCamera=function(){return this.camera instanceof M.OrthographicCamera?this.camera:null},z.prototype.getFullDisplayRange=function(){return{minPt:this._initMinDisplayPoint,maxPt:this._initMaxDisplayPoint}},z.prototype.saveZoom=function(){this.camera_recover=this.camera.clone(!1),this.controls.saveState()},z.prototype.recoverZoom=function(){this.camera_recover&&(this.camera.copy(this.camera_recover,!1),this.camera_recover=null,this.getOrthographicCamera().updateProjectionMatrix(),this.controls.reset(),this.mcObject.updateDisplayMatrixData())},z.prototype.zoomW_call=function(A,S,q,W){if(A.distanceTo(S)<1e-7)console.log("Mx:ZoomW param invalid");else{if(q!=null&&q||(A=this.currentCoord2World(A.x,A.y,0),S=this.currentCoord2World(S.x,S.y,0)),A.x>S.x){var _=A.x;A.x=S.x,S.x=_}A.y>S.y&&(_=A.y,A.y=S.y,S.y=_);var R=this.getViewWidth(),v=this.getViewHeight();v<5&&(v=5),R<5&&(R=5);var V=Math.abs(A.x-S.x),Y=Math.abs(A.y-S.y);V<1e-5&&(V=1e-5),Y<1e-5&&(Y=1e-5);var c=this.getOrthographicCamera();if(V/Y<R/v){var p=.5*Y,m=R/v;c.left=-p*m,c.right=p*m,c.top=p,c.bottom=-p}else p=.5*V,m=v/R,c.left=-p,c.right=p,c.top=p*m,c.bottom=-p*m;var f=V,N=Y,P=f;P<N&&(P=N),this._runMode==H.MxRunMode.kCPPMxCAD?(c.far=10240,c.near=-10240):(c.far=1e3*P,c.far<9e4&&(c.far=9e4),c.near=1e3*-P,-9e4<c.near&&(c.near=-9e4));var O=A.x+.5*f,Z=A.y+.5*N;c.zoom=1,c.position.set(O,Z,100),c.lookAt(new M.Vector3(O,Z,0)),c.updateProjectionMatrix(),this.controls.target.x=O,this.controls.target.y=Z,this.controls.target.z=0,this.controls.update(),this.mcObject.updateDisplayMatrixData(W)}},z.prototype.zoomScale_call=function(A){var S=this.getOrthographicCamera();S.zoom=Math.max(this.controls.minZoom,Math.min(this.controls.maxZoom,S.zoom*A)),S.updateProjectionMatrix(),this.controls.update(),this.mcObject.updateDisplayMatrixData()},z.prototype.zoomCenter_call=function(A,S){var q=this.bakViewDocWidth,W=this.bakViewDocHeight;if(this.bakViewDocWidth){var _=new M.Vector3,R=new M.Vector3;_.x=A-.5*this.bakViewDocWidth,_.y=S-.5*this.bakViewDocHeight,R.x=A+.5*this.bakViewDocWidth,R.y=S+.5*this.bakViewDocHeight,this.zoomW(_,R)}else{var v=this.getViewWidth(),V=this.getViewHeight(),Y=this.screenCoord2World(0,0,0),c=this.screenCoord2World(v,V,0);q=c.x-Y.x,W=c.y-Y.y;var p=A-(Y.x+.5*(c.x-Y.x)),m=S-(Y.y+.5*(c.y-Y.y));Y.x+=p,Y.y+=m,c.x+=p,c.y+=m,this.zoomW(Y,c)}this.bakViewDocWidth=q,this.bakViewDocHeight=W},z.prototype.calcCameraUp=function(A){var S=new M.Vector3(0,1,0),q=new M.Matrix4;return q.makeRotationZ(A),S.applyMatrix4(q),S},z.prototype.updateCameraForm3dViewDataImp=function(A){A.updateCamera(this.getOrthographicCamera(),this.controls,this.getViewWidth(),this.getViewHeight()),this.mcObject.updateDisplayMatrixData(!1),this.controls.mouseButtons.LEFT=M.MOUSE.PAN,this.controls.mouseButtons.RIGHT=M.MOUSE.ROTATE,this.controls.mouseButtons.MIDDLE=M.MOUSE.PAN,this.controls.touches.ONE=M.TOUCH.ROTATE,this.controls.touches.TWO=M.TOUCH.PAN},z.prototype.updateCameraDisplayRangeImp=function(A,S,q){this._initZoomwCoordPt1!=null&&this._initZoomWCoordPt2!=null?(this._initMinDisplayPoint=this.docCoord2World(this._initZoomwCoordPt1.x,this._initZoomwCoordPt1.y,0),this._initMaxDisplayPoint=this.docCoord2World(this._initZoomWCoordPt2.x,this._initZoomWCoordPt2.y,0)):(this._initMinDisplayPoint=A,this._initMaxDisplayPoint=S),this._viewangle=q,this.camera.up=this.calcCameraUp(q),this.cameraView.up=this.calcCameraUp(q),this.cameraView.updateProjectionMatrix(),this.zoomW(this._initMinDisplayPoint,this._initMaxDisplayPoint,!0)},z.prototype.setViewAngle_call=function(A){this._viewangle=A;var S=this.getOrthographicCamera();S&&(S.up=this.calcCameraUp(A),S.updateProjectionMatrix()),this.cameraView.up=this.calcCameraUp(A),this.cameraView.updateProjectionMatrix(),this.controls.update(),this.mcObject.setViewAngle(A),this.mcObject.updateDisplayMatrixData()},z.prototype.zoomInitialStates=function(){this._initMinDisplayPoint!=null&&this._initMaxDisplayPoint!=null?(this.camera.up=this.calcCameraUp(this._viewangle),this.cameraView.up=this.calcCameraUp(this._viewangle),this.cameraView.updateProjectionMatrix(),this.zoomW(this._initMinDisplayPoint,this._initMaxDisplayPoint,!0)):console.log("mx assert(0)")},z.prototype.onInitScene=function(){if(this.callInitSceneEvent(this.scene,this.controls,!0)==0){var A=new M.AmbientLight(3355443,1);this.scene.add(A);var S=new M.DirectionalLight(16777215,1);S.position.set(-2,2,3).normalize(),this.scene.add(S)}},z.prototype.updataCameraView=function(A,S){var q=A,W=S;this.cameraView.left=0,this.cameraView.right=q,this.cameraView.top=W,this.cameraView.bottom=0,this.cameraView.updateProjectionMatrix()},z.prototype.onInitViewScene=function(){if(!this.secenView){this.secenView=new M.Scene,this._runMode!=H.MxRunMode.kCPPMxCAD&&this.mxdrawThreeJS.getType()!=C.MxThreeJSType.kMapBox&&(this.secenView.background=new M.Color(this._viewcolor));var A=this.getViewWidth(),S=this.getViewHeight();A=this.xzSize(A),S=this.xzSize(S),this.cameraView=new M.OrthographicCamera(0,A,S,0,1,2e3),this.cameraView.position.set(0,0,2e3),this.cameraView.lookAt(new M.Vector3(0,0,0)),this.cameraView.updateProjectionMatrix();var q=new M.AmbientLight(3355443,1);this.secenView.add(q);var W=new M.DirectionalLight(16777215,1);W.position.set(-2,2,3).normalize(),this.secenView.add(W),this.threejsselectObjectsView=new M.Object3D,this.secenView.add(this.threejsselectObjectsView)}},z.prototype.onInitThreejs=function(){var A=this.getViewWidth(),S=this.getViewHeight(),q=(A=this.xzSize(A))/(S=this.xzSize(S))*50;this.onInitViewScene(),this.camera=new M.OrthographicCamera(q/-2,q/2,25,-25,-10240,10240),this.camera.position.set(0,0,200),this.scene=new M.Scene;var W=this.getUserCanvas(),_=this._rendererParam;_=_||{},W==null?(_.antialias=!1,_.stencil=!0,this.renderer=new M.WebGLRenderer(_),this.renderer.setClearColor(0,1),this.renderer.setPixelRatio(this._devicePixelRatio),this.renderer.setSize(A,S),document.body.appendChild(this.renderer.domElement)):(_.canvas=W,_.stencil=!0,this.renderer=new M.WebGLRenderer(_),this.renderer.setClearColor(0,1),this.renderer.setPixelRatio(this._devicePixelRatio)),this.renderer.sortObjects=!0,this.renderer.info.autoReset=D.MxDrawData.m_isAutoResetRenderer,this.renderer.info.reset();var R=this.getUserCanvas();R==null&&(R=this.renderer.domElement),this.controls=new G.OrbitControls(this.camera,R),this.is3DDraw||(this.controls.enableZoom=!0),this.controls.enableRotate=!1,I.MxFun.isPC()?(this.controls.zoomSpeed=4,this.controls.screenSpacePanning=!0,this.controls.touches.ONE=M.TOUCH.PAN,this.setMouseMiddlePan(this._isMouseMiddlePan),this._mouseRightRotate&&(this.controls.mouseButtons.RIGHT=M.MOUSE.ROTATE)):(this.setMouseMiddlePan(this._isMouseMiddlePan),this.controls.zoomSpeed=1.5,this.controls.touches.ONE=M.TOUCH.PAN,this.controls.screenSpacePanning=!0)},z.prototype.onCreate=function(){this._is2d=!0,this.mxdrawThreeJS.onInitScene()},z.prototype.mxWebAddEntity_3DChild=function(A){var S=new L.MxNetData(A).getMesh();if(S.id==null)return S.size;var q=new M.Mesh(S.geometry,y.MxMaterial.GetBaseColorMaterial(S.nColorIndex));return this.removeEntity(S.id),this.scene.add(q),S.isSketchEntity&&this.addEntity(S.id,q),S.size},z.prototype.mxWebAddEntity_Curve=function(A,S){var q=new L.MxNetData(A).getCurve(S);if(q.id!=null){var W=y.MxMaterial.GetCurveColorMaterial(q.colorIndex),_=new M.LineSegments(q.geometry,W);this.removeEntity(q.id),this.scene.add(_),q.isSketchEntity&&this.addEntity(q.id,_)}},z.prototype.onViewChange=function(){this._onResizeImpCalling||(this._bakOnResizeViewWorldCoord=void 0),this.bakViewDocHeight=this.bakViewDocWidth=void 0},z.prototype.mapBox_onResizeImp=function(A,S){var q=A,W=S;this.mcObject.setSize(q,W),this.callEvent("viewsizechange",{width:q,height:W}),this.callEvent("viewchange"),this.m_mxDatabase.getSelectManager().setCanvasSize(q,W)},z.prototype.callOnResizeImp=function(A,S){var q;this._bakOnResizeViewWorldCoord?q=this._bakOnResizeViewWorldCoord:(q=this.getViewWorldCoord(),this._bakOnResizeViewWorldCoord=q);var W=q.pt1.x+.5*(q.pt3.x-q.pt1.x),_=q.pt1.y+.5*(q.pt3.y-q.pt1.y),R=new M.Matrix4;R.makeRotationZ(this._viewangle);var v=new M.Matrix4().makeTranslation(W,_,0).multiply(R).multiply(new M.Matrix4().makeTranslation(-W,-_,0)),V=q.pt1.clone(),Y=q.pt2.clone(),c=q.pt3.clone(),p=q.pt4.clone();V.applyMatrix4(v),Y.applyMatrix4(v),c.applyMatrix4(v),p.applyMatrix4(v);var m=V.clone();m.x>Y.x&&(m.x=Y.x),m.x>c.x&&(m.x=c.x),m.x>p.x&&(m.x=p.x),m.y>Y.y&&(m.y=Y.y),m.y>c.y&&(m.y=c.y),m.y>p.y&&(m.y=p.y);var f=V.clone();f.x<Y.x&&(f.x=Y.x),f.x<c.x&&(f.x=c.x),f.x<p.x&&(f.x=p.x),f.y<Y.y&&(f.y=Y.y),f.y<c.y&&(f.y=c.y),f.y<p.y&&(f.y=p.y);var N=new M.Vector2;if(this.renderer.getSize(N),N.x==A&&N.y==S)return!1;var P=this.getOrthographicCamera(),O=Math.abs(f.x-m.x),Z=Math.abs(f.y-m.y);if(O<1e-5&&(O=1e-5),Z<1e-5&&(Z=1e-5),O/Z<A/S){var te=.5*Z,de=A/S;P.left=-te*de,P.right=te*de,P.top=te,P.bottom=-te}else te=.5*O,de=S/A,P.left=-te,P.right=te,P.top=te*de,P.bottom=-te*de;var me=m.x+.5*O,we=m.y+.5*Z;P.zoom=1;var ge=P.position.z;return P.position.set(me,we,ge),P.lookAt(new M.Vector3(me,we,0)),P.updateProjectionMatrix(),this.controls.target.x=me,this.controls.target.y=we,this.controls.target.z=0,this.controls.update(),!0},z.prototype.onResizeImp=function(A,S){var q=this.getViewWidth();A!=null&&(q=A);var W=this.getViewHeight();if(S!=null&&(W=S),W<5||q<5)return!1;q=this.xzSize(q),W=this.xzSize(W),this._onResizeImpCalling=!0;var _=this.mcObject.mxdraw3d.onResize(this.getOrthographicCamera(),this.controls,q,W);return _&&(this.renderer.setSize(q,W),this.mcObject.setSize(q,W),this.updataClipMaterial(),this.updataCameraView(q,W),this.callEvent("viewsizechange",{width:q,height:W}),this.callEvent("viewchange"),this.m_mxDatabase.getSelectManager().setCanvasSize(q,W),this.m_mxDatabase.onViewChange()),this._onResizeImpCalling=!1,_},z);function z(){var A=u.call(this,!0)||this;return A._initMinDisplayPoint=null,A._initMaxDisplayPoint=null,A.is3DDraw=I.MxFun.is3DDwg(),A._bakOnResizeViewWorldCoord=void 0,A._onResizeImpCalling=!1,A.bakViewDocWidth=void 0,A.bakViewDocHeight=void 0,A}o.MxDrawObject2d=B},{"./MxDrawData":22,"./MxDrawObject":23,"./MxFun":27,"./MxMaterial":30,"./MxNetData":31,"./View/MxDrawMapBox":75,three:19,"three-orbitcontrols":17}],25:[function(T,r,o){var a,x=this&&this.__extends||(a=function(B,z){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,S){A.__proto__=S}||function(A,S){for(var q in S)Object.prototype.hasOwnProperty.call(S,q)&&(A[q]=S[q])})(B,z)},function(B,z){if(typeof z!="function"&&z!==null)throw new TypeError("Class extends value "+String(z)+" is not a constructor or null");function A(){this.constructor=B}a(B,z),B.prototype=z===null?Object.create(z):(A.prototype=z.prototype,new A)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawObject3d=void 0;var u,M=T("three"),I=T("./MxDrawObject"),H=T("three-orbitcontrols"),G=T("./MxNetData"),L=T("./MxMaterial"),y=T("./MxTools"),D=(x(C,u=I.MxDrawObject),C.prototype.mxWebAddEntity_Curve=function(B,z){var A,S=new G.MxNetData(B),q=B.getInt32(32,!0)==0,W=S.getIsSketchEntity();if(!((A=q?B.getInt32(20,!0)/4/3:B.getInt32(20,!0)/4/2)<2)){for(var _=new M.Geometry,R=z,v=0;v<A;v++){var V=B.getFloat32(R,!0);R+=4;var Y=B.getFloat32(R,!0);R+=4;var c=0;q&&(c=B.getFloat32(R,!0),R+=4),_.vertices.push(y.MxTools.AsThreeJsPoint(V,Y,c))}var p=B.getInt32(28,!0),m=L.MxMaterial.GetCurveColorMaterial(p),f=new M.LineSegments(_,m),N=B.getInt32(4,!0);this.removeEntity(N),this.scene.add(f),W&&this.addEntity(N,f)}},C.prototype.mxWebAddEntity_3DChild=function(B){var z=new G.MxNetData(B),A=z.getId(),S=(z.getColorIndex(),z.getBufferType()==0),q=z.getIsSketchEntity();this.removeEntity(A);var W=new M.Mesh(new M.Geometry),_=this.mxWebUpdateEntity_3DChild(W,B,S);return this.scene.add(W),q&&this.addEntity(A,W),W.geometry.computeBoundingBox(),W.geometry.computeBoundingSphere(),_},C.prototype.mxWebUpdateEntity_3DChild=function(B,z,A){var S=new G.MxNetData(z),q=S.getVertexBufferSize(),W=S.getIndexBufferSize(),_=S.getColorIndex();if(q===0||W===0)return S.getDrawDataOffset();var R=S.getMateria(),v=void 0,V=!0,Y=!1,c=!1;R.length!=0&&((v=JSON.parse(R)).computeFaceNonmal!=null&&(V=v.computeFaceNonmal),v.castShadow!=null&&(Y=v.castShadow),v.receiveShadow!=null&&(c=v.receiveShadow)),B.material=L.MxMaterial.createMaterial(v),B.material==null&&(B.material=L.MxMaterial.GetColorMaterial(_)),B.castShadow=Y,B.receiveShadow=c;var p,m=S.getDrawDataOffset();p=A?q/4/8:q/4/2;var f=B.geometry;f.vertices=[],f.faces=[];for(var N=0;N<p;N++){var P=z.getFloat32(m+0,!0),O=z.getFloat32(m+4,!0),Z=0,te=0,de=0,me=0,we=0,ge=0;A?(Z=z.getFloat32(m+8,!0),te=z.getFloat32(m+12,!0),de=z.getFloat32(m+16,!0),me=z.getFloat32(m+20,!0),we=z.getFloat32(m+24,!0),ge=z.getFloat32(m+28,!0),m+=32):m+=8;var Le=y.MxTools.AsThreeJsPoint(P,O,Z);f.vertices.push(Le),f.vertices[N].normal=y.MxTools.AsThreeJsPoint(te,de,me),f.vertices[N].uv=new M.Vector2(we,ge)}var Pe=W/4;for(N=0;N<Pe;N+=3){var ae=z.getInt32(m,!0);m+=4;var ve=z.getInt32(m,!0);m+=4;var Ie=z.getInt32(m,!0);m+=4;var ze=new M.Face3(ae,ve,Ie);V||ze.vertexNormals.push(f.vertices[ae].normal,f.vertices[ve].normal,f.vertices[Ie].normal),f.faces.push(ze),f.faceVertexUvs[0].push([f.vertices[ae].uv,f.vertices[ve].uv,f.vertices[Ie].uv])}return V&&f.computeFaceNormals(),m},C.prototype.updateUVs=function(B){B.faceVertexUvs[0]=[],B.faces.forEach(function(z){var A=["x","y","z"].sort(function(V,Y){return Math.abs(z.normal[V])-Math.abs(z.normal[Y])}),S=B.vertices[z.a],q=B.vertices[z.b],W=B.vertices[z.c],_=new M.Vector2(S[A[0]],S[A[1]]),R=new M.Vector2(q[A[0]],q[A[1]]),v=new M.Vector2(W[A[0]],W[A[1]]);B.faceVertexUvs[0].push([_,R,v])}),B.uvsNeedUpdate=!0},C.prototype.onInitThreejs=function(){var B=this.getViewWidth(),z=this.getViewHeight(),A=(B=this.xzSize(B))/(z=this.xzSize(z))*50;this.camera=new M.OrthographicCamera(A/-2,A/2,25,-25,1,1e3),this.camera.position.set(-200,200,200),this.scene=new M.Scene,this.scene.background=new M.Color(this._viewcolor);var S=this.getUserCanvas();S==null?(this.renderer=new M.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(this._devicePixelRatio),this.renderer.setSize(B,z),document.body.appendChild(this.renderer.domElement)):(this.renderer=new M.WebGLRenderer({canvas:S,antialias:!0,alpha:!0}),this.renderer.setPixelRatio(this._devicePixelRatio));var q=this.getUserCanvas();q==null&&(q=this.renderer.domElement),this.controls=new H.OrbitControls(this.camera,q)},C.prototype.onInitViewScene=function(){},C.prototype.onInitScene=function(){if(this.callInitSceneEvent(this.scene,this.controls,!1)==0){var B=new M.AmbientLight(2236962);B.integrity=1,this.scene.add(B);var z=new M.DirectionalLight(16777215,1);z.position.set(-2,2,3).normalize(),this.scene.add(z);var A=new M.GridHelper(2e3,100);A.position.y=-199,A.material.opacity=.25,A.material.transparent=!0,this.scene.add(A);var S=new M.AxesHelper(20);this.scene.add(S)}},C.prototype.onCreate=function(){this._is2d=!1,this.callEvent("initRenderer",this.renderer),this.mxdrawThreeJS.onInitScene()},C.prototype.getOrthographicCamera=function(){return this.camera instanceof M.OrthographicCamera?this.camera:null},C.prototype.onViewChange=function(){},C.prototype.callOnResizeImp=function(B,z){return!1},C.prototype.onResizeImp=function(B,z){var A=this.getViewWidth();B!=null&&(A=B);var S=this.getViewHeight();z!=null&&(S=z),A=this.xzSize(A),S=this.xzSize(S);var q=this.getOrthographicCamera(),W=A/S;return q.left=50*W/-2,q.right=50*W/2,q.top=25,q.bottom=-25,q.updateProjectionMatrix(),this.renderer.setSize(A,S),!0},C.prototype.zoomInitialStates=function(){},C.prototype.saveZoom=function(){},C.prototype.recoverZoom=function(){},C.prototype.zoomScale_call=function(B){},C.prototype.zoomW_call=function(B,z,A,S){},C.prototype.zoomCenter_call=function(B,z){},C.prototype.setViewAngle_call=function(B){this._viewangle=B},C.prototype.getFullDisplayRange=function(){return{}},C);function C(){var B=u.call(this,!1)||this;return B._viewcolor=15790320,B}o.MxDrawObject3d=D},{"./MxDrawObject":23,"./MxMaterial":30,"./MxNetData":31,"./MxTools":38,three:19,"three-orbitcontrols":17}],26:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawObjectEvent=o.MxDrawObjectEventDefautProc=void 0;var a=T("./MxFun"),x=T("./Operate/MxJigCmdManager"),u=T("three"),M=T("./UI/MxUiVue"),I=T("./MxDrawData"),H=(G.prototype.onMousemove=function(D){if(M.MxUiVue.isNull())return 0;var C=this.mxObj.screenCoord2Doc(D.offsetX,D.offsetY,0);return C=this.mxObj.docCoord2Cad(C.x,C.y,C.z),M.MxUiVue.setTipCoord(a.MxFun.formatString("{0},{1},0.000",C.x.toFixed(3),C.y.toFixed(3))),0},G.prototype.isEnableIntelliSelect=function(){return!!I.MxDrawData.m_isEnableIntelliSelect&&!this.mxObj.is3DMode()},G.prototype.onTouchStart=function(D){if(!this.isEnableIntelliSelect()||x.MxJigCmdManager.isRunning()||this.mxObj.isPaningCommand()||D.touches.length!=1)return 0;var C=D.target.getBoundingClientRect(),B=D.touches[0].clientX-C.left,z=D.touches[0].clientY-C.top,A=this.mxObj,S=A.screenCoord2Current(B,z,0);if(A.getMxDatabase().getGripManager().onMouseLBDown(S)||A.isValidMcObject()&&A.getMcObject().getGripManager().onMouseLBDown(S))return 1;var q=new u.Vector3(B,z,0);return a.MxFun.sendStringToExecute("Mx_FrontEndWebpageIntelliSel",{pt:q,shiftKey:!1}),1},G.prototype.onMousdown=function(D){if(D.button==x.MxJigCmdManager.MouseButton.kRight&&x.MxJigCmdManager.isRunning()&&!I.MxDrawData.m_isEnableCommandRightClickMenu&&!D.shiftKey)return x.MxJigCmdManager.OnEnter(-1),D.stopPropagation(),1;if(!this.isEnableIntelliSelect()||D.button!=x.MxJigCmdManager.MouseButton.kLeft||x.MxJigCmdManager.isRunning()||this.mxObj.isPaningCommand())return 0;var C=this.mxObj,B=C.screenCoord2Current(D.offsetX,D.offsetY,0);if(C.getMxDatabase().getGripManager().onMouseLBDown(B)||C.isValidMcObject()&&C.getMcObject().getGripManager().onMouseLBDown(B))return 1;var z=new u.Vector3(D.offsetX,D.offsetY,0);return a.MxFun.sendStringToExecute("Mx_FrontEndWebpageIntelliSel",{pt:z,shiftKey:D.shiftKey}),1},G.prototype.init=function(D,C){this.mxObj=D;var B=this;C.addEventListener("mousemove",function(z){return B.onMousemove(z)}),C.addEventListener("mousedown",function(z){return B.onMousdown(z)}),C.addEventListener("touchstart",function(z){return B.onTouchStart(z)})},G);function G(){}o.MxDrawObjectEventDefautProc=H;var L=(y.prototype.onMousedown=function(D,C){this.callEvent("mousedown",D,C)},y.prototype.onMousemove=function(D,C){this.callEvent("mousemove",D,C)},y.prototype.onMouseup=function(D,C){this.callEvent("mouseup",D,C)},y.prototype.registEvent=function(D){var C=D.getMxDrawThreeJs().getRegistEventObject();if(!C)return!1;var B=this;a.MxFun.isPC()?(C.addEventListener("mouseup",function(z){var A=D.getMxDrawThreeJs().getDomMousePos(z);B.onMouseup(z,A)},!0),C.addEventListener("mousemove",function(z){var A=D.getMxDrawThreeJs().getDomMousePos(z);D.setCurrentMousePostion(z),B.onMousemove(z,A)},!0),C.addEventListener("mousedown",function(z){var A=D.getMxDrawThreeJs().getDomMousePos(z);D.setCurrentMousePostion(z),B.onMousedown(z,A)},!0)):(C.addEventListener("touchstart",function(z){D.setCurrentMousePostion(z,!0),B.callEvent("touchstart",z)},!0),C.addEventListener("touchend",function(z){B.callEvent("touchend",z)},!0),C.addEventListener("touchmove",function(z){D.setCurrentMousePostion(z,!0),B.callEvent("touchmove",z)},!0)),this.defautProc.init(D,this)},y.prototype.getEventCall=function(D){var C;return D=="mousemove"?C=this.aryMousemoveEventCall:D=="mouseup"?C=this.aryMouseupEventCall:D=="mousedown"?C=this.aryMousedownEventCall:D=="touchstart"?C=this.aryTouchstartEventCall:D=="touchend"?C=this.aryTouchendEventCall:D=="touchmove"&&(C=this.aryTouchmoveEventCall),C},y.prototype.callEvent=function(D,C,B){var z=this.getEventCall(D);if(z){for(var A=z.slice(),S=0,q=A.length;S<q;S++){var W=A[S](C,B);if(W==1)return W}return 0}},y.prototype.addEventListener=function(D,C,B){B===void 0&&(B=!1);var z=this.getEventCall(D);return!!z&&(-1<z.indexOf(C)||(B?z.unshift(C):z.push(C)),!0)},y.prototype.removeEventListener=function(D,C){var B=this.getEventCall(D);if(!B)return!1;var z=B.indexOf(C);return-1<z&&(B.splice(z,1),!0)},y);function y(){this.aryMousedownEventCall=[],this.aryMouseupEventCall=[],this.aryMousemoveEventCall=[],this.aryTouchstartEventCall=[],this.aryTouchendEventCall=[],this.aryTouchmoveEventCall=[],this.defautProc=new H}o.MxDrawObjectEvent=L},{"./MxDrawData":22,"./MxFun":27,"./Operate/MxJigCmdManager":54,"./UI/MxUiVue":65,three:19}],27:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxFun=void 0;var a,x,u,M,I,H,G,L,y,D,C,B,z,A,S,q,W=T("three"),_=T("./MxManager"),R=T("./MxDrawObject"),v=T("./MxDrawObject2d"),V=T("./MxDrawObject3d"),Y=T("./UI/MxUiObjectMobile"),c=T("./UI/MxUiObjectPC"),p=T("./Operate/MxJigCmdManager"),m=T("./Operate/MxJigGetLine"),f=T("./Operate/MxCmdRunManager"),N=T("./UI/MxUiVue"),P=T("./MxThreeJS"),O=T("./MxWindowsEvent"),Z=T("./MxTools"),te=T("./MxDrawCommands"),de=T("./MxDrawData"),me=T("./MxLocalFileLoad"),we=T("./TempTest/MxTestJig"),ge=T("./MxVersion"),Le=T("./MrxDbgUtils");function Pe(le){le.cmd&&at(le.cmd)}function ae(le){var De=new RegExp("(^|&)"+le+"=([^&]*)(&|$)"),st=window.location.href,gt=st.indexOf("?"),St=(st=gt==-1?"":st.substring(gt)).substr(1).match(De);return St!=null?decodeURIComponent(St[2]):""}function ve(){return _.MxManager.currentMx()}function Ie(le,De){var st={};if(le!=null)if(le instanceof Array)st.is2d=!0;else{le.length==0&&(le="empty");var gt=le.substring(le.lastIndexOf(".")+1).toLowerCase();if(gt!="dwg"&&gt!="dxf"&&gt!="dwf"&&gt!="mwg"&&gt!="wgh"||(st.is2d=!0),De!=1&&De!=null&&gt!="wgh"){var St=void 0,Rt=le.split("/");(St=Rt.length==1?Rt[0]:Rt[Rt.length-1])[0]=="$"&&(St=St.substring(1));for(var Pt=void 0,Je=0;Je<Rt.length-1;Je++)Pt=Je==0?Rt[Je]:Pt+"/"+Rt[Je];le=Pt?Pt+"/$"+St+".mxb1.wgh":"$"+St+".mxb1.wgh"}}else le="empty_template.dwg";return st.sFileName=le,st}function ze(le){if(typeof le=="string"){var De=le.substring(le.lastIndexOf(".")+1).toLowerCase();if(De!="dwg"&&De!="wgh"){var st=le.lastIndexOf("?");if(st!=-1){var gt=le.substring(st,le.length);return{sFileName:le=le.substring(0,st),sUrlParam:gt}}}}return null}function He(){return p.MxJigCmdManager.stopCmd(p.MxJigCmdManager.DetailedResult.kUnknown)}function at(le,De){if(le.length!=0){var st=ve();return f.MxCmdRunManager.runCmd(st,le,De)}He()}function tt(le){le!=null&&(le.init(),N.MxUiVue.init(le)),B||(console.log("MxDraw Version:"+ge.MxBulid.getVersion()),B=!0,S=new me.MxLocalNodeJs,p.MxJigCmdManager.init(),O.MxWindowsEvent.registEvent(),te.MxDrawCommands.registerCommand(),window.mxConfig_isLoadTest&&we.MxTest.registerCommand(),A.sendStringToExecute=Pe)}x=a||(o.MxFun=a={}),u=".",C=null,B=!(D="ws://localhost:5090"),A={},S=z=y=G=M=void 0,q=L=H=I=-1,x.getUiObj=function(){return C},x.on=function(le,De){_.MxManager.on(le,De)},x.callEvent=function(le,De){return _.MxManager.callEvent(le,De)},x.getNodeJs=function(){return S},x.setMxServer=function(le){D=le},x.getMxServer=function(){return D},x.isPC=function(){return q==-1?function(){if(!/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)){var le=navigator.userAgent.toLowerCase();return 0<=le.indexOf("win64")||0<=le.indexOf("wow64")||0<=le.indexOf("win32")||0<=le.indexOf("wow32")||/macintosh|mac os x/i.test(navigator.userAgent)||!("ontouchstart"in window||0<navigator.maxTouchPoints)}}()?(q=1,!0):(q=0,!1):q==1},x.getClientPlatform=function(){return navigator.platform},x.getClientInfo=function(){return{width:document.body.clientWidth,height:document.body.clientHeight}},x.curPath=function(){return u},x.setCurPath=function(le){u=le},x.getQueryString=ae,x.getLocationPageUrl=function(){var le=window.location.href,De=le.lastIndexOf("?");return De==-1?le:le.substring(0,De)},x.getHostUrl=function(){var le=window.location.hostname;return le.substring(0,4)!="http"&&(le="http://"+le),le},x.isAbsoluteWebPath=function(le){return le.substring(0,4)=="http"},x.getUrlParams=function(){var le=window.location.search,De=le.substr(1,le.length).split("&"),st=new Array;if(De!=null)for(var gt=0;gt<De.length;gt++){var St=De[gt].replace(/[=|^==]/,"&").split("&");if(1<St.length){var Rt=new Array;Rt.push(decodeURIComponent(St[0])),Rt.push(decodeURIComponent(St[1])),st.push(Rt)}}return st},x.call=function(le,De,st){De==null?De="{}":typeof De=="string"?De.length==0?De="{}":De[0]=="["&&De[De.length-1]=="]"||De[0]=="{"&&De[De.length-1]=="}"||(De='"'+(De=De.replace(/"/g,"'"))+'"'):De=typeof De=="object"?JSON.stringify(De):"{}",_.MxManager.currentMx().call(le,De,st)},x.loadCodeToServer=function(le,De){_.MxManager.currentMx().loadCodeToServer(le,De)},x.getCurrentMx=function(){return _.MxManager.currentMx()},x.isEnableSelect=function(){if(I!=-1)return I==1;var le=ae("select");return I=0,le!=null&&le.toLowerCase()=="y"&&(I=1),I==1},x.is3DDwg=function(){if(L!=-1)return L==1;var le=ae("3ddwg");return L=0,le!=null&&le.toLowerCase()=="y"&&(L=1),L==1},x.isStaticLoad=function(){if(H!=-1)return H==1;var le=ae("static");return H=0,le!=null&&le.toLowerCase()=="y"&&(H=1),H==1},x.enableSelect=function(le){I=le?1:0},x.enablStaticLoad=function(le){H=le==null||le?1:0},x.dwgDir=function(){return G!=null||(G=ae("dwgdir"))==null&&(G=""),G},x.setDwgDir=function(le){G=le},x.getStaticServer=function(){return y!=null||(y=ae("staticServer"))==null&&(y=""),y},x.setStaticServer=function(le){y=le},x.is2dParam=function(){if(M!=null)return M;var le=ae("file");if(M=!1,le!=null){var De=le.substring(le.lastIndexOf(".")+1);De.toLowerCase()!="dwg"&&De.toLowerCase()!="dxf"&&De.toLowerCase()!="dwf"&&De.toLowerCase()!="mwg"||(M=!0)}return M},x.set2dParam=function(le){M=le},x.showLayer=function(le,De){return _.MxManager.currentMx().showLayer(le,De)},x.screenCoord2World=function(le,De,st){return le instanceof Object?_.MxManager.currentMx().screenCoord2World(le.x,le.y,le.z):_.MxManager.currentMx().screenCoord2World(le,De,st)},x.worldCoord2Screen=function(le,De,st){return le instanceof Object?_.MxManager.currentMx().worldCoord2Screen(le.x,le.y,le.z):_.MxManager.currentMx().worldCoord2Screen(le,De,st)},x.docCoord2Cad=function(le,De,st){return le instanceof Object?_.MxManager.currentMx().docCoord2Cad(le.x,le.y,le.z):_.MxManager.currentMx().docCoord2Cad(le,De,st)},x.cadCoord2Doc=function(le,De,st){return le instanceof Object?_.MxManager.currentMx().cadCoord2Doc(le.x,le.y,le.z):_.MxManager.currentMx().cadCoord2Doc(le,De,st)},x.docCoord2World=function(le,De,st){return le instanceof Object?_.MxManager.currentMx().docCoord2World(le.x,le.y,le.z):_.MxManager.currentMx().docCoord2World(le,De,st)},x.worldCoord2Doc=function(le,De,st){return le instanceof Object?_.MxManager.currentMx().worldCoord2Doc(le.x,le.y,le.z):_.MxManager.currentMx().worldCoord2Doc(le,De,st)},x.screenCoord2Doc=function(le,De,st){return le instanceof Object?_.MxManager.currentMx().screenCoord2Doc(le.x,le.y,le.z):_.MxManager.currentMx().screenCoord2Doc(le,De,st)},x.docCoord2Screen=function(le,De,st){return le instanceof Object?_.MxManager.currentMx().docCoord2Screen(le.x,le.y,le.z):_.MxManager.currentMx().docCoord2Screen(le,De,st)},x.docCoordLong2Cad=function(le){return _.MxManager.currentMx().docCoordLong2Cad(le)},x.cadCoordLong2Doc=function(le){return _.MxManager.currentMx().cadCoordLong2Doc(le)},x.viewCoordLong2Cad=function(le){return _.MxManager.currentMx().viewCoordLong2Cad(le)},x.cadCoordLong2View=function(le){return _.MxManager.currentMx().cadCoordLong2View(le)},x.zoomCenter=function(le,De){_.MxManager.currentMx().is2D()&&(_.MxManager.currentMx().zoomCenter(le,De),_.MxManager.currentMx().updateDisplay())},x.zoomW=function(le,De,st,gt,St){_.MxManager.currentMx().is2D()&&(_.MxManager.currentMx().zoomW(new W.Vector3(le,De,0),new W.Vector3(st,gt,0),St),_.MxManager.currentMx().updateDisplay())},x.zoomScale=function(le){_.MxManager.currentMx().is2D()&&(_.MxManager.currentMx().zoomScale(le),_.MxManager.currentMx().updateDisplay())},x.zoomAll=function(){_.MxManager.currentMx().is2D()&&(_.MxManager.currentMx().zoomAll(),_.MxManager.currentMx().updateDisplay())},x.deleteAll=function(){return _.MxManager.currentMx().deleteAll()},x.callCommand=function(le,De,st){_.MxManager.currentMx().callCommand(le,De,st)},x.getCurrentColor=function(){return _.MxManager.currentMx().getCurrentColor()},x.setCurrentColor=function(le){_.MxManager.currentMx().setCurrentColor(le)},x.showLoading=function(){C!=null&&C.ShowLoading()},x.hideLoading=function(){C!=null&&C.HideLoading()},x.showProp=function(le){C!=null&&C.ShowObjectProperty(le)},x.hideProp=function(){C!=null&&C.HideObjectProp()},x.getUiObject=function(){return C},x.getViewCenterDocCoord=function(){return _.MxManager.currentMx().is2D()?_.MxManager.currentMx().getViewCenterDocCoord():new W.Vector3(0,0,0)},x.screenCoordLong2Doc=function(le){return _.MxManager.currentMx().is2D()?_.MxManager.currentMx().screenCoordLong2Doc(le):le},x.docCoordLong2Screen=function(le){return _.MxManager.currentMx().is2D()?_.MxManager.currentMx().docCoordLong2Screen(le):le},x.worldCoordLong2Doc=function(le){return _.MxManager.currentMx().is2D()?_.MxManager.currentMx().worldCoordLong2Doc(le):le},x.docCoordLong2World=function(le){return _.MxManager.currentMx().is2D()?_.MxManager.currentMx().docCoordLong2World(le):le},x.screenCoordLong2World=function(le){return _.MxManager.currentMx().is2D()?_.MxManager.currentMx().screenCoordLong2World(le):le},x.worldCoordLong2Screen=function(le){return _.MxManager.currentMx().is2D()?_.MxManager.currentMx().worldCoordLong2Screen(le):le},x.addSelectEvent=function(le){_.MxManager.addSelectEvent(le)},x.clearSelectEvent=function(){_.MxManager.clearSelectEvent()},x.removeThreejsObject=function(le,De,st){le&&(le.traverse(function(gt){(gt instanceof W.Mesh||gt instanceof W.Line||gt instanceof W.LineLoop)&&(gt.geometry.dispose(),st&&(gt.material instanceof Array?gt.material.forEach(function(St){St.dispose()}):gt.material.dispose()))}),De.remove(le))},x.removeThreejsAllChildren=function le(De){for(;0<De.children.length;){var st=De.children[0];De.remove(st),0<st.children.length&&le(st),st.geometry&&st.geometry.dispose(),st.material instanceof Array?st.material.forEach(function(gt){gt.dispose()}):st.material.dispose(),st.texture&&st.texture.dispose()}},x.setOutServerDebugCall=function(le){_.MxManager.setOutDebugCall(le)},x.updateDisplay=function(){_.MxManager.updateDisplay()},x.getCurrentDraw=ve,x.formatString=function(le){for(var De=[],st=1;st<arguments.length;st++)De[st-1]=arguments[st];for(var gt=0;gt<De.length;gt++)le=le.replace("{".concat(gt,"}"),De[gt]);return le},x.createMxUiObject=function(le){var De;return De=this.isPC()?new c.MxUiObjectPC:new Y.MxUiObjectMobile,le(C=De),De.create(),De},x.openFile=function(le,De){var st="";if(typeof le=="string"){var gt=ze(le);gt&&(st=gt.sUrlParam,le=gt.sFileName)}De==null&&(De=!1);var St=Ie(le,De);return St.is2d&&(M=St.is2d),le=St.sFileName,_.MxManager.currentMx().openFile(le,st)},x.createMxObject=function(le,De,st,gt,St,Rt,Pt,Je){B||tt(),typeof le=="string"&&(le=le.length==0?void 0:document.getElementById(le));var bt=null,jt="";if(Je)De="",(bt=new v.MxDrawObject2d).initRunMode(R.MxRunMode.kCPPMxCAD),bt.setViewColor(0);else{if(De==null)De=x.getQueryString("file");else{var Ln=ze(De);Ln&&(jt=Ln.sUrlParam,De=Ln.sFileName)}var Yt=gt==null||gt;if(De===void 0||De.length==0||De=="empty")Yt=!0,De=De=="empty"?"":"empty_template.dwg";else{var Qt=Ie(De,Rt);Qt.is2d&&(Yt=Qt.is2d),De=Qt.sFileName}St==1&&(De=""),Yt?(bt=new v.MxDrawObject2d).setViewColor(0):(bt=new V.MxDrawObject3d).setViewColor(15790320)}return st!=null&&st(bt),bt.create(le,De,jt,Pt),bt},x.getMxObjectFormElement=function(le){return _.MxManager.getMxObject(le)},x.initMxCpp=function(le){_.MxManager.initMxCpp(le)},x.isRunningCommand=function(){return p.MxJigCmdManager.isRunning()},x.getRunningCommand=function(){return p.MxJigCmdManager.getCurCmd()},x.stopRunCommand=He,x.runCommand=function(le){return p.MxJigCmdManager.runCmd(le)},x.getTHREE=function(){return W},x.getLine=function(le){var De=new m.MxJigGetLine;De.setRetCall(le),p.MxJigCmdManager.runCmd(De)},x.addCommand=function(le,De,st){f.MxCmdRunManager.addCommand(le,De,st)},x.sendStringToExecute=at,x.getMxEntity=function(le){var De=ve();return De?De.getMxEntityUserObject(le):null},x.initUiDataObject=function(le){N.MxUiVue.isNull()&&(le.init(x),N.MxUiVue.init(le))},x.init=tt,x.addWindowsEvent=function(le){O.MxWindowsEvent.addEvent(le)},x.getCurrentMousePostion=function(){return ve().getCurrentMousePostion()},x.getMxThreeJS=function(){return P.MxThreeJS},x.getMxTools=function(){return Z.MxTools},x.getMxCmdRunManager=function(){return f.MxCmdRunManager},x.getMxJigCmdManager=function(){return p.MxJigCmdManager},x.initQuickCommand=function(le){f.MxCmdRunManager.InitQuickCommand(le)},x.InitLanguageString=function(le){f.MxCmdRunManager.InitLanguageString(le)},x.getLanguageString=function(le,De){return De===void 0&&(De=""),f.MxCmdRunManager.getLanguageString(le,De)},x.Assert=function(le){le||console.log("MxAssert error")},x.setIniset=function(le){de.MxDrawData.setIniset(le)},x.getIniSet=function(){return de.MxDrawData.getIniSet()},x.setPostMessageToParentFrameFunction=function(le){z=le},x.postMessageToParentFrame=function(le){return z!=null&&(z(le),!0)},x.onParentFrameMessage=function(le){le!=null&&le.type!=null&&A[le.type]&&A[le.type](le)},x.acutPrintf=function(le){for(var De=[],st=1;st<arguments.length;st++)De[st-1]=arguments[st];if(!N.MxUiVue.isNull()){for(var gt=arguments,St=gt[0],Rt=0;Rt<gt.length-1;Rt++){var Pt=new RegExp("\\{"+Rt+"\\}","gm");St=St.replace(Pt,gt[Rt+1])}N.MxUiVue.AcutPrintfNoFormat(St,!0)}},x.loadImageMaterial=function(le,De){_.MxManager.getMxDbTextureManager().loadImage(le,De)},x.loadSVG=function(le,De,st,gt){_.MxManager.getMxDbSvgManager().loadSVG(le,De,st,gt)},x.initMxDbEntityType=function(le){_.MxManager.getMxDbEntityClassHierarchy().init(le)},x.initDynamicCreate=function(le){_.MxManager.getMxDbEntityClassHierarchy().initDynamic(le)},x.ceneratecursor=function(le,De,st,gt){le===void 0&&(le=128),De===void 0&&(De=10),st===void 0&&(st=!0);var St=document.createElement("canvas");St.width=St.height=le,St.style.background="transparent";var Rt=St.getContext("2d"),Pt=le%2==0?-.5:0,Je=De%2==0?-.5:0;Rt.strokeStyle=gt||"#fff",st&&(Rt.beginPath(),Rt.moveTo(St.width/2+Pt,Pt),Rt.lineTo(St.width/2+Pt,St.height+Pt),Rt.stroke(),Rt.beginPath(),Rt.moveTo(Pt,St.height/2+Pt),Rt.lineTo(St.width+Pt,St.height/2+Pt),Rt.stroke()),Rt.beginPath(),Rt.strokeRect(le/2-De/2+Je,le/2-De/2+Je,De,De),Rt.stroke();var bt=new Image;return bt.src=St.toDataURL("image/png"),bt.src},x.getMrxDbgUtilsClass=function(){return Le.MrxDbgUtils},x.getNumberColor=function(le){return le instanceof Object?le.getHex&&(le=le.getHex()):typeof le=="string"&&(le=parseInt(le)),le},x.setloadImageFuction=function(le){_.MxManager.setloadImageFuction(le)}},{"./MrxDbgUtils":20,"./MxDrawCommands":21,"./MxDrawData":22,"./MxDrawObject":23,"./MxDrawObject2d":24,"./MxDrawObject3d":25,"./MxLocalFileLoad":28,"./MxManager":29,"./MxThreeJS":37,"./MxTools":38,"./MxVersion":40,"./MxWindowsEvent":41,"./Operate/MxCmdRunManager":48,"./Operate/MxJigCmdManager":54,"./Operate/MxJigGetLine":55,"./TempTest/MxTestJig":61,"./UI/MxUiObjectMobile":63,"./UI/MxUiObjectPC":64,"./UI/MxUiVue":65,three:19}],28:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxLocalDwgFileLoad=o.MxLocalFileLoad=o.MxLocalNodeJs=void 0;var a=T("./MxFun"),x=(u.prototype.init=function(L){this.loadFileCall=L.loadFileFun},u.prototype.loadFile=function(L,y,D,C,B){this.loadFileCall!=null?this.loadFileCall(L,y,D,C,B):B(void 0)},u);function u(){this.loadFileCall=null}o.MxLocalNodeJs=x;var M=(I.prototype.setPath=function(L){this.path=L},I.prototype.setBinary=function(L){this.isBinary=L},I.prototype.load=function(L,y,D,C){a.MxFun.getNodeJs().loadFile(this.path+L,this.isBinary,y,D,C)},I);function I(){this.path="",this.isBinary=!1}o.MxLocalFileLoad=M;var H=(G.prototype.setShowloading=function(L){this._isShowLoading=L},G.prototype.load=function(L,y){var D="$"+y+".mxb1.wgh";this._path=L,this._filename=y;var C=this;this.getFile(this._path,D,!1,function(B){typeof B=="string"?C.net.onStaticHeadMessage(B):console.log("mx error h1")},function(){console.log("mx get "+D+" faild")})},G.prototype.getDatas=function(){if(this._iGet>=this._dataNum)this._isShowLoading&&a.MxFun.hideLoading();else{var L=this._dataType[this._iGet];this._iGet++;var y=this,D=this._iGet+1,C="$"+this._filename+".mxb"+D+".wgh",B=L!=0;this.getFile(this._path,C,B,function(z){y.net.onStaticMessage(z),y.getDatas()},function(){y._dataNum=0,y._iGet=0,y._isShowLoading&&a.MxFun.hideLoading(),console.log("mx get "+C+" faild")})}},G.prototype.onRenderHead=function(L){var y=JSON.parse(L);this._dataType=y.type,this._dataNum=y.count,this._iGet=0,this._isShowLoading&&a.MxFun.showLoading(),this.getDatas()},G.prototype.getFile=function(L,y,D,C,B){var z=new M;z.setPath(L),z.setBinary(D),z.load(y,C,function(){},B)},G);function G(L){this.net=null,this._dataNum=0,this._iGet=0,this._dataType=[],this._path="",this._filename="",this._isShowLoading=!0,this.net=L}o.MxLocalDwgFileLoad=H},{"./MxFun":27}],29:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxManager=o.MxCpp=o.MxData=void 0;var a,x,u=T("./View/MxDbEntity"),M=T("./View/MxDbTextureManager"),I=T("./SVGLoader/MxSVGLoader");(x=a||(o.MxData=a={})).iSelectRenderOrder=5,x.iCADMeshRenderOrder=10,x.iCADCurveRenderOrder=20,x.iMxEntityRenderOrder=30,x.iGripRenderOrder=110,x.iDynJigRenderOrder=120;var H,G,L,y,D,C,B,z,A,S,q,W,_,R=(v.prototype.init=function(V){this.imp=V},v.prototype.getMxCAD_MxCpp=function(){return this.imp},v.prototype.getMxCAD_App=function(){return this.imp.App},v.prototype.newMcGePoint3d=function(V){return this.imp?this.imp.newMcGePoint3d(V):null},v.prototype.decodeFromGb2312=function(V){return this.imp.decodeFromGb2312(V)},v.prototype.encodeToGb2312=function(V){return this.imp.encodeToGb2312(V)},v.prototype.getMcDbCurve=function(V){if(this.imp.App.objectIdIsKindOf(V,"McDbCurve"))return this.imp.App.objectIdToObject(V)},v);function v(){}o.MxCpp=R,G=H||(o.MxManager=H={}),L=[],y=null,C=[],B=void(D=0),z=new M.MxDbTextureManager,A=new I.MxSvgManager,S=new u.MxDbEntityClassHierarchy,q=new R,W={},_=void 0,G.add=function(V){L.push(V)},G.setloadImageFuction=function(V){_=V},G.getLoadImageFuction=function(){return _},G.on=function(V,Y){W[V]||(W[V]=[]),W[V].push(Y)},G.callEvent=function(V,Y){var c;if(W[V])return W[V].forEach(function(p){var m=p(Y);c=c||m}),c},G.initMxCpp=function(V){q.init(V)},G.getMxCpp=function(){return q},G.allocId=function(){return++D},G.getMxDbEntityClassHierarchy=function(){return S},G.getMxDbTextureManager=function(){return z},G.getMxDbSvgManager=function(){return A},G.outDebugString=function(V){B==null?console.log(V):B(V)},G.setOutDebugCall=function(V){B=V},G.onLoad=function(){for(var V in L)L[V].onLoad("")},G.updateDisplay=function(){for(var V in L)L[V].updateDisplay()},G.currentMx=function(){return y},G.setCurrentMx=function(V){y=V},G.initResize=function(){for(var V in L)L[V].initResize()},G.addSelectEvent=function(V){C.push(V)},G.clearSelectEvent=function(){C=[]},G.callSelectObject=function(V){for(var Y in C)if(C[Y](V)==1)break},G.getMxObject=function(V){if(typeof V=="number"){for(var Y in L)if(L[Y].getId()===V)return L[Y]}else for(var Y in L)if(L[Y].getCanvas()===V)return L[Y];return null}},{"./SVGLoader/MxSVGLoader":59,"./View/MxDbEntity":69,"./View/MxDbTextureManager":74}],30:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxMaterial=void 0;var a,x=T("three");(function(u){u.shaderUniforms={crAmbient:{value:new x.Vector3(1,0,0)},crDiffuse:{value:new x.Vector3(1,0,0)},crSpecular:{value:new x.Vector3(1,0,0)}},u.m_arrSystemColors=new Array(0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10066176,10066252,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510272,8755532,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019904,7510348,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529536,6265164,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,39168,5019980,32512,4161343,19456,2509862,65343,8388511,52275,6737023,39206,5019999,32543,4161359,19475,2509871,65407,8388543,52326,6737049,39244,5020018,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39282,5020037,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39321,5020057,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29337,5014937,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19609,5010073,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9881,5005209,8063,4149119,4940,2502476,255,8355839,204,6710988,153,5000345,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490521,6245529,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980889,7490713,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471257,8735897,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,10027161,10046617,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,10027122,10046597,8323167,8339311,4980793,4990530,16711807,16744383,13369446,13395609,10027084,10046578,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,10027046,10046559,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215),u.m_arrDefUseMaterials=new Array(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null),u.m_arrDefUseCurveMaterials=new Array(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null),u.m_arrDefUseBasicMaterials=new Array(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null),u.m_selectMaterial=new x.MeshPhongMaterial({color:255,opacity:.2,transparent:!0,side:x.DoubleSide}),u.m_mouseMoveMaterial=new x.MeshPhongMaterial({color:16776960,side:x.DoubleSide}),u.m_lockedMaterial=new x.MeshPhongMaterial({color:197379,side:x.DoubleSide}),u.m_samplePoints=new x.PointsMaterial({color:255,depthTest:!1,size:8}),u.m_samplePointsMouseMove=new x.PointsMaterial({color:16711680,depthTest:!1,size:12});var M=new x.MeshBasicMaterial({color:16777215,transparent:!0,depthTest:!1,side:x.DoubleSide,opacity:1,stencilWrite:!1,colorWrite:!1});u.getStencilMaterial=function(){return M},u.GetColorByIndex=function(I){return u.m_arrSystemColors[I]},u.GetColorMaterial=function(I){var H=u.m_arrDefUseMaterials[I];return H===null&&(H=new x.MeshLambertMaterial({color:u.m_arrSystemColors[I],side:x.DoubleSide}),u.m_arrDefUseMaterials[I]=H),H},u.GetBaseColorMaterial=function(I){var H=u.m_arrDefUseBasicMaterials[I];return H===null&&(H=new x.MeshBasicMaterial({color:u.m_arrSystemColors[I],side:x.DoubleSide}),u.m_arrDefUseMaterials[I]=H),H},u.GetCurveColorMaterial=function(I){var H=u.m_arrDefUseCurveMaterials[I];return H===null&&(H=new x.LineBasicMaterial({color:u.m_arrSystemColors[I],linewidth:1}),u.m_arrDefUseCurveMaterials[I]=H),H},u.GetSelectMaterial=function(){return u.m_selectMaterial},u.GetMouseMoveMaterial=function(){return u.m_mouseMoveMaterial},u.GetLockedMaterial=function(){return u.m_lockedMaterial},u.GetSamplePointsMaterial=function(){return u.m_samplePoints},u.GetSamplePointsMouseMoveMaterial=function(){return u.m_samplePointsMouseMove},u.createMaterial=function(I){var H=void 0;if(I==null)return H;function G(L,y){if(y.map!=null){var D=y.map,C=new x.TextureLoader().load(D);C.wrapS=C.wrapT=x.RepeatWrapping,L.map=C,L.side=x.DoubleSide}}return I.transparent!=0?I.transparent=!0:I.transparent=!1,I.name=="MeshPhongMaterial"?G(H=new x.MeshPhongMaterial(I),I):I.name=="MeshBasicMaterial"?G(H=new x.MeshBasicMaterial(I),I):I.name=="MeshDepthMaterial"?G(H=new x.MeshDepthMaterial(I),I):I.name=="MeshNormalMaterial"?G(H=new x.MeshNormalMaterial(I),I):I.name=="MeshLambertMaterial"?G(H=new x.MeshLambertMaterial(I),I):I.name=="MeshStandardMaterial"&&G(H=new x.MeshStandardMaterial(I),I),H}})(a||(o.MxMaterial=a={}))},{three:19}],31:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxHFileLoad=o.MxNet=o.MxNetBinMessageType=o.MxNetSend=o.MxNetMessage=o.MxNetMessageType=o.MxNetData=void 0;var a,x,u=T("three"),M=T("./MxFun"),I=T("pako"),H=T("./MxManager"),G=T("./MxDrawData"),L=(y.prototype.getId=function(){return this._dataView.getInt32(4,!0)},y.prototype.getVersion_MwBlobHead=function(){return this._dataView.getInt32(60,!0)},y.prototype.getVersion_MwBlobHeadDynLen=function(){return this._dataView.getInt32(4,!0)},y.prototype.getdPointCurveBuffersHead=function(){var v={};return v.ver=this._dataView.getInt32(4,!0),v.databaseIndex=this._dataView.getInt32(8,!0),v.zeroLayerIdIndex=this._dataView.getInt32(16,!0),v.datacount=this._dataView.getInt32(20,!0),v.datasize=this._dataView.getInt32(24,!0),v},y.prototype.getdPointMeshBuffersHead=function(){var v={};return v.ver=this._dataView.getInt32(4,!0),v.databaseIndex=this._dataView.getInt32(8,!0),v.id=this._dataView.getInt32(12,!0),v.zeroLayerIdIndex=this._dataView.getInt32(16,!0),v.datacount=this._dataView.getInt32(20,!0),v.datasize=this._dataView.getInt32(24,!0),v},y.prototype.getdPointTextureBuffersHead=function(){var v={};return v.ver=this._dataView.getInt32(4,!0),v.databaseIndex=this._dataView.getInt32(8,!0),v.zeroLayerIdIndex=this._dataView.getInt32(16,!0),v.datacount=this._dataView.getInt32(20,!0),v.datasize=this._dataView.getInt32(24,!0),v},y.prototype.getBlobHeadForMemorySectionsHead=function(v){var V={};return V.type=this._dataView.getInt32(v,!0),v+=4,V.ver=this._dataView.getInt32(v,!0),v+=4,V.databaseIndex=this._dataView.getInt32(v,!0),v+=4,V.nOffset=v,V},y.prototype.getMemorySectionsHead=function(){var v=this.getBlobHeadForMemorySectionsHead(0);return v.zeroLayerIdIndex=this._dataView.getInt32(v.nOffset,!0),v.nOffset+=4,v.datacount=this._dataView.getInt32(v.nOffset,!0),v.nOffset+=4,v.datasize=this._dataView.getInt32(v.nOffset,!0),v.nOffset+=4,v.datasize!=v.nOffset&&console.log("mx: sectionshead size assert(0)"),v},y.prototype.getMemorySectionHead=function(v){var V=this.getBlobHeadForMemorySectionsHead(v);return v=V.nOffset,V.pointCount=this._dataView.getInt32(v,!0),v+=4,V.layerId=this._dataView.getInt32(v,!0),v+=4,V.blkId=this._dataView.getInt32(v,!0),v+=4,V.memColor=this._dataView.getInt32(v,!0),v+=4,V.memId=this._dataView.getInt32(v,!0),v+=4,V.memType=this._dataView.getInt32(v,!0),v+=4,V.offset=v,V},y.prototype.getdPointTextureBufferDataHead=function(v){v+=4,v+=4,v+=4;var V={};return V.dataCount=this._dataView.getInt32(v,!0),v+=4,V.layerId=this._dataView.getInt32(v,!0),v+=4,V.blkId=this._dataView.getInt32(v,!0),v+=4,V.offset=v,V},y.prototype.getdPointCurveBufferDataHead=function(v){v+=4,v+=4,v+=4;var V={};return V.pointCount=this._dataView.getInt32(v,!0),v+=4,V.layerId=this._dataView.getInt32(v,!0),v+=4,V.blkId=this._dataView.getInt32(v,!0),v+=4,V.offset=v,V},y.prototype.getdPointMeshBufferDataHead=function(v){v+=4,v+=4,v+=4;var V={};return V.pointCount=this._dataView.getInt32(v,!0),v+=4,V.layerId=this._dataView.getInt32(v,!0),v+=4,V.blkId=this._dataView.getInt32(v,!0),v+=4,V.offset=v,V},y.prototype.getDatabaseIndex=function(){return this._dataView.getInt32(8,!0)},y.prototype.getColorIndex=function(){return this._dataView.getInt32(24,!0)},y.prototype.getBufferType=function(){return this._dataView.getInt32(32,!0)},y.prototype.getIsSketchEntity=function(){return this._dataView.getInt32(40,!0)},y.prototype.getLayerId=function(){return this._dataView.getInt32(44,!0)},y.prototype.getBlockId=function(){return this._dataView.getInt32(48,!0)},y.prototype.getVertexBufferSize=function(){return this._dataView.getInt32(12,!0)},y.prototype.getIndexBufferSize=function(){return this._dataView.getInt32(16,!0)},y.prototype.getZeroLayerId=function(){return this._dataView.getInt32(52,!0)},y.prototype.getSelectMark=function(){return this._dataView.getInt32(56,!0)},y.prototype.getMateria=function(){var v=this._dataView.getInt32(36,!0);if(v==0)return"";for(var V=[],Y=0;Y<v;Y++){var c=String.fromCharCode(this._dataView.getUint8(80+Y));V.push(c)}return V.join("")},y.prototype.getDrawDataOffset=function(){return this._dataView.getInt32(36,!0)+80},y.prototype.getMesh=function(){var v=this._dataView.getInt32(4,!0),V=this._dataView.getInt32(32,!0)==0,Y={},c=this._dataView.getInt32(12,!0),p=this._dataView.getInt32(16,!0);if(c===0||p===0)return Y.size=80,Y;var m,f=new u.Geometry,N=80;m=V?c/4/8:c/4/2;for(var P=0;P<m;P++){var O=this._dataView.getFloat32(N+0,!0),Z=this._dataView.getFloat32(N+4,!0),te=0;V?(te=this._dataView.getFloat32(N+8,!0),this._dataView.getFloat32(N+12,!0),this._dataView.getFloat32(N+16,!0),this._dataView.getFloat32(N+20,!0),this._dataView.getFloat32(N+24,!0),this._dataView.getFloat32(N+28,!0),N+=32):N+=8;var de=new u.Vector3(O,Z,te);f.vertices.push(de)}var me=p/4;for(P=0;P<me;P+=3){var we=this._dataView.getInt32(N,!0);N+=4;var ge=this._dataView.getInt32(N,!0);N+=4;var Le=this._dataView.getInt32(N,!0);N+=4;var Pe=new u.Face3(we,ge,Le);f.faces.push(Pe)}var ae=this.getIsSketchEntity();return Y.size=N,Y.geometry=f,Y.id=v,Y.isSketchEntity=ae,Y.nColorIndex=this._dataView.getInt32(24,!0),Y},y.prototype.getCurve=function(v){var V,Y=this._dataView.getInt32(32,!0),c=this.getIsSketchEntity(),p=Y==0,m={};if((V=p?this._dataView.getInt32(20,!0)/4/3:this._dataView.getInt32(20,!0)/4/2)<2)return m;for(var f=new u.Geometry,N=v,P=0;P<V;P++){var O=this._dataView.getFloat32(N,!0);N+=4;var Z=this._dataView.getFloat32(N,!0);N+=4;var te=0;p&&(te=this._dataView.getFloat32(N,!0),N+=4),f.vertices.push(new u.Vector3(O,Z,te))}var de=this._dataView.getInt32(4,!0);return m.size=N,m.geometry=f,m.id=de,m.isSketchEntity=c,m.colorIndex=this._dataView.getInt32(28,!0),m},y);function y(v){this._dataView=v}o.MxNetData=L,(x=a||(o.MxNetMessageType=a={})).kAddLayer="00000007",x.kClearLayer="00000008",x.kHideLayer="00000009",x.kShowLayer="00000010",x.kUpdateDisplayRange="00000011",x.kCallJsReturn="00000012",x.kLayerData="00000013",x.kSendDebugString="00000014",x.kShowLoading="00000015",x.kHideLoading="00000016",x.kSelectObject="00000017",x.kGlRenderHead="00000018",x.kUserLoginResult="00000019",x.kOpenFileResult="00000020",x.kServerReturn="00000021",x.kMxCADLayerData="00000056",x.kMxCADSystemVariable="00000057";var D=(C.prototype.setJsRetCall=function(v,V,Y){this.serverJsRetCall.set(V+Y,v)},C.prototype.onSocketErrort=function(){this.serverJsRetCall.forEach(function(v){v(void 0)}),this.serverJsRetCall=new Map},C.prototype.Do=function(v){var V=this.net.getCurrentDatabaseId();if(V==-1){var Y=v.substring(0,4);V=parseInt(Y)}var c=v.substring(4,12),p=v.substring(12);return this.messageCall[c]!=null&&(this.messageCall[c](p,V),!0)},C);function C(v,V){this.messageCall=new Map,this.serverJsRetCall=new Map,this.net=null,this.net=V;var Y=this;this.messageCall[a.kUpdateDisplayRange]=function(c){if(!Y.net.isTzDwgStaticFile()){c=c.replace(/\\/g,"\\\\");try{var p=JSON.parse(c);if(p!=null&&v.is2D()){v.initCAD2Doc(new u.Matrix4),p.newbrownermode?p.DToSMat?G.MxDrawData.m_isCorrectLargeCoordinates?(v.intiDoc2Wold(new u.Matrix4),v.initCAD2Doc(p.DToSMat)):v.intiDoc2Wold(p.DToSMat):v.intiDoc2Wold(new u.Matrix4):v.intiDoc2Wold(p.DToWMat),v.initializingObjectMatrix(),v.updateCameraDisplayRange(new u.Vector3(+p.pt1[0],+p.pt1[1],+p.pt1[2]),new u.Vector3(+p.pt2[0],+p.pt2[1],+p.pt2[2]),+p.viewangle),v.initAllLayoutName(p.layout),v.updateDisplay(!0);var m=M.MxFun.getUiObj();m!=null&&(m.SetLayoutData(p.layout),m.UpDisplayLayout())}}catch{console.log("UpdateDisplayRange exception")}}},this.messageCall[a.kCallJsReturn]=function(c){if(c.length!=0){var p=JSON.parse(c);p.cmd.length==0&&(p.cmd="__mx_loadcode");var m=p.cmd+p.count,f=Y.serverJsRetCall.get(m);f&&(Y.serverJsRetCall.delete(m),typeof p.ret=="string"&&(p.ret=p.ret.replace(/\'/g,'"')),f(p.ret))}else console.log("assert(0),kCallJsReturn return empty")},this.messageCall[a.kSendDebugString]=function(c){H.MxManager.outDebugString(c)},this.messageCall[a.kUserLoginResult]=function(c){v.userLoginResult(c)},this.messageCall[a.kOpenFileResult]=function(c){v.openFileResult(c)},this.messageCall[a.kServerReturn]=function(c){v.serverReturn(c)},this.messageCall[a.kShowLoading]=function(c){Y.net.isTzDwgStaticFile()||M.MxFun.showLoading()},this.messageCall[a.kHideLoading]=function(c){Y.net.isTzDwgStaticFile()||(M.MxFun.hideLoading(),v.callInitCompleteEvent())},this.messageCall[a.kSelectObject]=function(c){var p=JSON.parse(c);H.MxManager.callSelectObject(parseInt(p.id))},this.messageCall[a.kGlRenderHead]=function(c){v.isStaticLocalLoad()?v.getStaticLocalNet().onRenderHead(c):(Y.net.isTzDwgStaticFile()?v.getStaticLoadTzNet():v.getStaticNet()).onRenderHead(c)},this.messageCall[a.kMxCADSystemVariable]=function(c,p){v.sysVariable().OnMessageMxCADSystemVariable(c)},this.messageCall[a.kLayerData]=function(c,p){if(p==0){if(v.addLayerInfoComplete(),(P=JSON.parse(c))!=null){if(!P.isSketch){var m=P.list;for(var f in m)v.addLayerInfo(m[f].id,m[f].colorvalue,m[f].name),m[f].zerolayer==1&&v.setZeroLayerId(m[f].id)}P.isSketch||v.callEvent("uiSetLayerData",P.list);var N=M.MxFun.getUiObj();N!=null&&(P.isSketch?N.SetSketchLayerData(P.list):N.SetLayerData(P.list),N.UpDisplayLayer())}}else{var P,O=v.getExtRefManager().getLayers(p);if(O.initComplete(),(P=JSON.parse(c))!=null)for(var f in m=P.list)O.add(m[f].id,m[f].colorvalue,m[f].name),m[f].zerolayer==1&&O.setZeroLayerId(m[f].id)}}}o.MxNetMessage=D;var B,z,A=(S.prototype.setWebSocket=function(v){this._webSocket=v},S.prototype.UndoMark=function(){this._webSocket!=null&&this._webSocket.send(this.SendType.kUndoMark+"")},S.prototype.DoCommand=function(v,V,Y){this._webSocket!=null&&(Y!=null?(this._callCount++,200<this._callCount&&(this._callCount=1),this._msg.setJsRetCall(Y,v,this._callCount),V==null&&(V=""),this._webSocket.send(this.SendType.kCmdEx+","+v+","+this._callCount+","+V)):V==null?this._webSocket.send(this.SendType.kCmd+","+v):this._webSocket.send(this.SendType.kCmd+","+v+","+V))},S.prototype.OpenFile=function(v){this._webSocket!=null&&this._webSocket.send(this.SendType.kOpenFile+","+v)},S.prototype.UserLogin=function(v,V,Y){if(this._webSocket!=null){var c={};c.IdentitySign=v,c.RandomToken=V??"",c.Init=Y??"",this._webSocket.send(this.SendType.kUserLogin+","+JSON.stringify(c))}},S.prototype.Init=function(v){this._webSocket!=null&&this._webSocket.send(this.SendType.kInit+","+v)},S.prototype.CallServerJS=function(v,V,Y){this._webSocket!=null&&(Y==null?V==null||V==null||V.length==0?this._webSocket.send(this.SendType.kCallJS+',{"command":"'+v+'","param":"{}"}'):this._webSocket.send(this.SendType.kCallJS+',{"command":"'+v+'","param":'+V+"}"):(this._callCount++,200<this._callCount&&(this._callCount=1),this._msg.setJsRetCall(Y,v,this._callCount),V==null||V==null||V.length==0?this._webSocket.send(this.SendType.kCallJS+',{"command":"'+v+'","param":"{}","count":"'+this._callCount+'"}'):this._webSocket.send(this.SendType.kCallJS+',{"command":"'+v+'","param":'+V+',"count":"'+this._callCount+'"}')))},S.prototype.CallLoadCodeToServer=function(v,V){this._webSocket!=null&&(this._msg.setJsRetCall(V,"__mx_loadcode",0),v!=null&&v!=null&&v.length!=0&&this._webSocket.send(this.SendType.kCallJS+","+v))},S.prototype.DeleteObject=function(v){this._webSocket!=null&&this._webSocket.send(this.SendType.kDelete+","+v)},S.prototype.SelectObject=function(v){this._webSocket!=null&&this._webSocket.send(this.SendType.kSelect+","+v)},S.prototype.QuitSelectObject=function(v){this._webSocket!=null&&this._webSocket.send(this.SendType.kQuitSelect+","+v)},S.prototype.SendDragDrawEntity=function(v){this._webSocket!=null&&this._webSocket.send(this.SendType.kAddDragDraw+","+v)},S.prototype.SendDragDrawRequest=function(){this._webSocket!=null&&(this.SendMousePickRay(),this._webSocket.send(this.SendType.kRequestDragDraw))},S.prototype.SendDragDrawDetermine=function(){this._webSocket!=null&&(this.SendMousePickRay(),this._webSocket.send(this.SendType.kDetermineDragDraw))},S.prototype.SendDragDrawCancel=function(){this._webSocket!=null&&this._webSocket.send(this.SendType.kCancelDragDraw)},S.prototype.SendMousePickRay=function(){this._webSocket},S);function S(v,V){this.SendType={},this._callCount=1,this._webSocket=v,this._msg=V,this.SendType.kCmd=0,this.SendType.kDelete=1,this.SendType.kSelect=2,this.SendType.kOpenFile=3,this.SendType.kGetDemoList=4,this.SendType.kCallJS=5,this.SendType.kAddDragDraw=6,this.SendType.kRequestDragDraw=7,this.SendType.kMousePickRay=8,this.SendType.kDetermineDragDraw=9,this.SendType.kCancelDragDraw=10,this.SendType.kQuitSelect=11,this.SendType.kInit=12,this.SendType.kCmdEx=13,this.SendType.kUserLogin=14,this.SendType.kUndoMark=15}o.MxNetSend=A,(z=B||(o.MxNetBinMessageType=B={})).eBlockRef=10,z.eEntitysData=14,z.eAddEntityFor2dPointTextureBuffers=15,z.eMxNewMemorySections=16,z.kMxCADBlockRef=56,z.kMxCADMemorySections=57,z.kMxCADMemorySectionsFromChange=59,z.kMxCADNotUseMemorySectionsForChage=61,z.kMxCADEntityDisplayDatas=62;var q=(W.prototype.setCurrentDatabaseId=function(v){this._iCurrentDatabaseId=v},W.prototype.getMxDrawObject=function(){return this._mx},W.prototype.getCurrentDatabaseId=function(){return this._iCurrentDatabaseId},W.prototype.isTzDwgStaticFile=function(){return this._iCurrentDatabaseId!=-1},W.prototype.onBinMessage=function(v){var V=this._mx,Y=I.inflate(v),c=new DataView(Y.buffer),p=c.getInt32(0,!0);this._binMessageCall.has(p)?this._binMessageCall.get(p)(c,this._iCurrentDatabaseId):(this._iCurrentDatabaseId==-1&&(p==0?V.mxWebAddEntity(c):p==6?V.removeEntityFromServer(c):p==11&&V.getExtRefManager().createExternalReferences(c)),p==12?V.mxWebAddEntityFor2dPointCurveBuffers(c,this._iCurrentDatabaseId):p==13?V.mxWebAddEntityFor2dPointMeshBuffers(c,this._iCurrentDatabaseId):p==8?V.mxWebAddEntityFor2dPointCurveBuffer(c,this._iCurrentDatabaseId):p==9?V.mxWebAddEntityFor2dPointMeshBuffer(c,this._iCurrentDatabaseId):p==B.eBlockRef&&V.mxWebCreateAllBlocks(c,this._iCurrentDatabaseId))},W.prototype.socket_onErrort=function(){this._msg.onSocketErrort()},W.prototype.socket_onMessageImp=function(v,V){if(V===void 0&&(V=!1),typeof v=="string")this._msg.Do(v);else if(V)this.onBinMessage(v);else{var Y=new FileReader;Y.readAsArrayBuffer(v);var c=this;Y.onload=function(p){c._mx.updateDisplay(),c.onBinMessage(Y.result)}}this._mx.updateDisplay()},W.prototype.initBinMessage=function(){var v=this._mx;this._binMessageCall.set(B.eEntitysData,function(V,Y){v.mxWebEntitysData(V,Y)}),this._binMessageCall.set(B.eAddEntityFor2dPointTextureBuffers,function(V,Y){v.mxWebAddEntityFor2dPointTextureBuffers(V,Y)}),this._binMessageCall.set(B.eMxNewMemorySections,function(V,Y){v.mxWebAddEntityForMemorySections(V,Y)})},W.prototype.init=function(v,V){var Y=this;this._mx=v,this._msg=new D(v,this),this.initBinMessage(),V&&(this._webSocket=new WebSocket(M.MxFun.getMxServer()),this._webSocket.onopen=function(){var c=Y._mx.getIniParam();if(c.length!=0){for(var p="{",m=c.length,f=0;f<m;f++)p=f==0?p+'"'+c[f][0]+'":"'+c[f][1]+'"':p+',"'+c[f][0]+'":"'+c[f][1]+'"';p+="}",Y._send.Init(p)}},this._webSocket.onmessage=function(c){Y.socket_onMessageImp(c.data)},this._webSocket.onerror=function(){console.log("mx: socket error"),Y.socket_onErrort()}),this._send=new A(this._webSocket,this._msg)},W.prototype.closeWebSocket=function(){this._webSocket&&(this._send.setWebSocket(null),this._webSocket.close(),this._webSocket=null)},W.prototype.getOnMessage=function(){return this._msg},W.prototype.getSend=function(){return this._send},W.prototype.onStaticMessage=function(v){try{return this.socket_onMessageImp(v,!0),!0}catch(V){return console.log("mx file data error!"),console.log(V),!1}},W.prototype.onStaticHeadMessage=function(v){return typeof v=="string"&&this._msg.Do(v)},W);function W(){this._webSocket=null,this._send=null,this._msg=null,this._mx=null,this._binMessageCall=new Map,this._iCurrentDatabaseId=-1}o.MxNet=q;var _=(R.prototype.stopAllLoading=function(){this._isStopLoading||(this._isStopLoading=!0,this._isShowLoading&&M.MxFun.hideLoading())},R.prototype.setShowloading=function(v){this._isShowLoading=v},R.prototype.showLoading=function(){this._isShowLoading&&M.MxFun.showLoading()},R.prototype.hideLoading=function(v){this._isStopLoading||(this._isShowLoading&&M.MxFun.hideLoading(),this.net.getMxDrawObject().callInitCompleteEvent(),this.net.getMxDrawObject().callOpenFileComplete(v))},R.prototype.setRequestHeader=function(v){this._requestHeader=v},R.prototype.setUrlParam=function(v){this._urlParam=v},R.prototype.load=function(v,V){var Y=M.MxFun.curPath(),c=M.MxFun.dwgDir(),p=M.MxFun.getStaticServer(),m="/buf/";if(v.substring(v.lastIndexOf(".")+1).toLowerCase()=="wgh"){m="/";var f=v.substring(0,v.indexOf(".mxb1.wgh")).split("/");(v=f.length==1?f[0]:(p=v.substring(0,v.lastIndexOf("/")),f[f.length-1]))[0]=="$"&&(v=v.substring(1))}var N="$"+(v=encodeURIComponent(v))+".mxb1.wgh";p.length!=0?Y=p+m:c.length!=0?Y=Y+"/"+c+m:Y+=m,this._path=Y,this._filename=v,1<(this._staticLoadingOpenFiles=V).length&&(N=V[0],this._path=void 0);var P=this;this.getFile(this._path,N,function(O){if(!P._isStopLoading)return typeof O!="string"?(console.log("mx error h1"),void P.hideLoading(4)):P.net.onStaticHeadMessage(O)?void 0:(console.log("mx error h1:"+O),void P.hideLoading(2))},function(){P.hideLoading(3),console.log("mx get "+N+" faild")})},R.prototype.getData=function(){if(this._isStopLoading)this.hideLoading(5);else if(this._iGet>=this._dataNum)this.hideLoading(0);else{var v=this._dataType[this._iGet];this._iGet++;var V=this,Y=this._iGet+1,c="$"+this._filename+".mxb"+Y+".wgh";if(1<this._staticLoadingOpenFiles.length){if(this._iGet>=this._staticLoadingOpenFiles.length)return console.log("Mx staticLoadingOpenFiles error!"),void this.hideLoading(7);c=this._staticLoadingOpenFiles[this._iGet]}var p=c;this._path&&(p=this._path+c);var m=p.substring(0,p.lastIndexOf("/")+1);if(this.net.getMxDrawObject().setCurrentLoadUrl(m),v==0)this.getFile(this._path,c,function(P){V._isStopLoading||(V.net.onStaticMessage(P)||(console.log(this._path),console.log(c)),V.getData())},function(){V._dataNum=0,V._iGet=0,V.hideLoading(8),console.log("mx get "+c+" faild")});else{var f=new XMLHttpRequest,N=c;this._path&&(N=this._path+c),this._urlParam.length!=0?f.open("GET",N+this._urlParam):f.open("GET",N),G.MxDrawData.m_isRequestHeaderCacheControl&&f.setRequestHeader("Cache-Control","max-age=7200"),this._requestHeader.length!=0&&f.setRequestHeader("usertoken",this._requestHeader),f.responseType="arraybuffer",f.onload=function(){V._isStopLoading||(V.net.onStaticMessage(f.response)||console.log(N),V.getData())},f.addEventListener("error",function(P){V._dataNum=0,V._iGet=0,V.hideLoading(9),console.log("mx get "+c+" faild")},!1),f.send()}}},R.prototype.onRenderHead=function(v){if(!this._isStopLoading){var V=JSON.parse(v);this._dataType=V.type,this._dataNum=V.count,this._iGet=0,this.showLoading(),this.getData()}},R.prototype.getFile=function(v,V,Y,c){var p=new u.FileLoader(this.manager);p.setPath(v);var m=V;this._urlParam.length!=0&&(m=V+this._urlParam),this._requestHeader.length!=0&&(p.requestHeader={usertoken:this._requestHeader}),p.load(m,Y,function(){},c)},R);function R(v,V){this.net=null,this.manager=null,this._dataNum=0,this._iGet=0,this._dataType=[],this._path="",this._filename="",this._staticLoadingOpenFiles=[],this._isShowLoading=!0,this._requestHeader="",this._isStopLoading=!1,this._urlParam="",this.net=v,this.manager=V!==void 0?V:u.DefaultLoadingManager}o.MxHFileLoad=_},{"./MxDrawData":22,"./MxFun":27,"./MxManager":29,pako:1,three:19}],32:[function(T,r,o){var a,x;Object.defineProperty(o,"__esModule",{value:!0}),o.MxShader=void 0,(x=a||(o.MxShader=a={})).VSHADER_COLOR_POINT=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
attribute vec2 position; 
attribute vec3 color; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,x.VSHADER_COLOR_POINT_BYLAYER=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec3 color; 
attribute vec2 position; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,x.FSHADER_COLOR_POINT=` precision highp float; 
varying vec4 vColor; 
void main() { 
gl_FragColor = vColor; 
} 
`,x.VSHADER_COLOR_POINT_TEXTURE=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
attribute vec2 position; 
attribute vec2 uv; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
varying vec2 vUv; 
void main(){ 
vUv = uv; 
mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,x.FSHADER_COLOR_POINT_TEXTURE=` precision highp float; 
varying vec2 vUv; 
uniform sampler2D texture; 
void main() { 
gl_FragColor = texture2D( texture, vUv ); 
} 
`,x.VSHADER_COLOR_POINT_CLIP=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec2 clippt1; 
uniform vec2 clippt2; 
uniform float vieww; 
uniform float viewh; 
attribute vec2 position; 
attribute vec3 color; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
vec4 pt1 = projectionMatrix * modelViewMatrix * vec4( clippt1.x,clippt1.y,0.0, 1.0 ); 
vec4 pt2 = projectionMatrix * modelViewMatrix * vec4( clippt2.x,clippt2.y,0.0, 1.0 ); 
vCp1 = vec2(pt1.x * vieww + vieww,pt1.y * viewh + viewh); 
vCp2 = vec2(pt2.x * vieww + vieww,pt2.y * viewh + viewh); 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,x.VSHADER_COLOR_POINT_BYLAYER_CLIP=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec3 color; 
uniform vec2 clippt1; 
uniform vec2 clippt2; 
uniform float vieww; 
uniform float viewh; 
attribute vec2 position; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
vec4 pt1 = projectionMatrix * modelViewMatrix * vec4( clippt1.x,clippt1.y,0.0, 1.0 ); 
vec4 pt2 = projectionMatrix * modelViewMatrix * vec4( clippt2.x,clippt2.y,0.0, 1.0 ); 
vCp1 = vec2(pt1.x * vieww + vieww,pt1.y * viewh + viewh); 
vCp2 = vec2(pt2.x * vieww + vieww,pt2.y * viewh + viewh); 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,x.FSHADER_COLOR_POINT_CLIP=`precision highp float; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main() { 
if(gl_FragCoord.x > vCp1.x && gl_FragCoord.x < vCp2.x && gl_FragCoord.y > vCp1.y && gl_FragCoord.y < vCp2.y) 
gl_FragColor = vColor; 
else 
discard; 
} 
`,x.VSHADER_COLOR_POINT_FORMXCAD=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec3 color; 
attribute vec2 position; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
gl_PointSize = 1.0;
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,x.FSHADER_COLOR_POINT_FORMXCAD=` precision highp float; 
varying vec4 vColor; 
void main() { 
gl_FragColor = vColor; 
} 
`,x.VSHADER_COLOR_POINT_CLIP_FORMXCAD=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec3 color; 
uniform vec2 clippt1; 
uniform vec2 clippt2; 
uniform float vieww; 
uniform float viewh; 
attribute vec2 position; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
vec4 pt1 = projectionMatrix * modelViewMatrix * vec4( clippt1.x,clippt1.y,0.0, 1.0 ); 
vec4 pt2 = projectionMatrix * modelViewMatrix * vec4( clippt2.x,clippt2.y,0.0, 1.0 ); 
vCp1 = vec2(pt1.x * vieww + vieww,pt1.y * viewh + viewh); 
vCp2 = vec2(pt2.x * vieww + vieww,pt2.y * viewh + viewh); 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,x.FSHADER_COLOR_POINT_CLIP_FORMXCAD=`precision highp float; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main() { 
if(gl_FragCoord.x > vCp1.x && gl_FragCoord.x < vCp2.x && gl_FragCoord.y > vCp1.y && gl_FragCoord.y < vCp2.y) 
gl_FragColor = vColor; 
else 
discard; 
} 
`},{}],33:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxStencilObject=void 0;var a=T("three"),x=T("./MxMaterial"),u=(M.prototype.object_onAfterRender=function(I){var H=this.aryMeshStencil;if(H&&0<H.length){I.getContext();var G=I.state.buffers;G.stencil.setLocked(!1),G.depth.setTest(!0),G.stencil.setTest(!1)}},M.prototype.object_onBeforeRender=function(I,H,G){var L=this.aryMeshStencil;if(L&&0<L.length){var y=I.getContext(),D=I.state.buffers;D.color.setMask(!1),D.color.setLocked(!0),D.depth.setTest(!1),D.stencil.setTest(!0),D.stencil.setMask(255),D.stencil.setClear(0),I.clearStencil(),D.stencil.setLocked(!0);var C=1,B=!0;L.forEach(function(z){B?(B=!1,D.stencil.setFunc(y.ALWAYS,C,255),D.stencil.setOp(y.KEEP,y.KEEP,y.REPLACE)):(D.stencil.setFunc(y.EQUAL,C,255),D.stencil.setOp(y.KEEP,y.KEEP,y.INCR),C++),I.mxRenderObject(z,H,G,z.material,null)}),D.color.setLocked(!1),D.color.setMask(!0),D.stencil.setMask(0),D.stencil.setFunc(y.EQUAL,C,255)}},M.prototype.associateObject=function(I,H){var G=this;H.forEach(function(y){if(3<=y.length){var D=new a.Shape(y),C=new a.ShapeGeometry(D),B=new a.Mesh(C,x.MxMaterial.getStencilMaterial());G.aryMeshStencil.push(B)}});var L=this;I.onBeforeRender=function(y,D,C){L.object_onBeforeRender(y,D,C)},I.onAfterRender=function(y){L.object_onAfterRender(y)}},M);function M(){this.aryMeshStencil=[]}o.MxStencilObject=u},{"./MxMaterial":30,three:19}],34:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxString=void 0;var a=(x.prototype.Find=function(u){return this.m_val.indexOf(u)},x.prototype.Left=function(u){return this.m_val.substring(0,u)},x.prototype.Right=function(u){return this.m_val.substring(this.m_val.length-u,this.m_val.length)},x.prototype.TrimLeft=function(u){for(;0<this.m_val.length&&this.m_val[0]==u;)this.m_val=this.m_val.slice(1)},x.prototype.TrimRight=function(u){for(;0<this.m_val.length&&this.m_val[this.m_val.length-1]==u;)this.m_val=this.m_val.slice(0,-1)},x.prototype.AnalyzeString=function(u){return this.m_val.split(u)},x.prototype.IsEmpty=function(){return this.m_val.length==0},x.prototype.MakeUpper=function(){this.m_val=this.m_val.toUpperCase()},x.prototype.MakeLower=function(){this.m_val=this.m_val.toLowerCase()},x.prototype.GetLength=function(){return this.m_val.length},x);function x(u){this.m_val="",u!=null&&(this.m_val=u)}o.MxString=a},{}],35:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxSystemVariable=void 0;var a=T("three"),x=T("./Operate/McEdJigOsnap"),u=(M.prototype.init=function(I){this.m_mxObj=I},M.prototype.getAllLinetypeName=function(){return this.m_vecLinetype},M.prototype.getSysVarBool=function(I){return this.m_data[I]!=null&&this.m_data[I]},M.prototype.setSysVarBool=function(I,H){this.m_data[I]=H},M.prototype.setSysVarPoint=function(I,H){this.m_data[I]=H},M.prototype.OnMessageMxCADSystemVariable=function(I){this.m_vecLinetype=[];var H=JSON.parse(I);if(H!=null){var G=H.vecLinetypeName;for(var L in G)this.m_vecLinetype.push(G[L]);this.m_data.CELTYPE=H.curLinetypeName,this.m_data.CLAYER=H.clayer,this.m_data.CECOLOR=H.cecolor,this.m_data.CECOLORINDEX=H.cecolorindex}this.m_mxObj.callEvent("loadSystmeVariableComplete")},M.prototype.getSysVarPoint=function(I){return this.m_data[I]==null?new a.Vector3(0,0,0):this.m_data[I]},M.prototype.setSysVarNumber=function(I,H){this.m_data[I]=H},M.prototype.getSysVarNumber=function(I){return this.m_data[I]==null?0:this.m_data[I]},M.prototype.getSysVar=function(I){return this.m_data[I]},M.prototype.setSysVar=function(I,H){this.m_data[I]=H},M);function M(){this.m_data={},this.m_mxObj=null,this.m_vecLinetype=[],this.m_data.GETPOINTSTATUS=0,this.m_data.LASTPOINT=void 0,this.m_data.LASTMOVEPOINT=void 0,this.m_data.CELTYPE="Continuous",this.m_data.CLAYER="0",this.m_data.CECOLOR=67108863,this.m_data.CECOLORINDEX=7,this.m_data.OSMODE=x.MxOsnapDefine.OsModeAll}o.MxSystemVariable=u},{"./Operate/McEdJigOsnap":43,three:19}],36:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxTempMarkDraw=void 0;var a=T("three"),x=T("./MxFun"),u=T("./MxThreeJS"),M=(I.prototype.init=function(H){this.threeObjectGroup=new a.Object3D,H.addObject(this.threeObjectGroup)},I.prototype.clear=function(H){H||x.MxFun.removeThreejsAllChildren(this.threeObjectGroup)},I.prototype.drawLine=function(H,G,L,y){L===void 0&&(L=16777215),y===void 0&&(y=1),this.threeObjectGroup.add(u.MxThreeJS.createLine(H,G,L,y))},I.prototype.drawCircle=function(H,G,L){this.threeObjectGroup.add(u.MxThreeJS.createCircle(H,G,L))},I.prototype.drawEntity=function(H){this.threeObjectGroup.add(H)},I.prototype.drawCircleMark=function(H,G,L){this.drawCircle(H,G,L);var y=new a.Vector3(.3*G,0,0);y.applyAxisAngle(new a.Vector3(0,0,1),60*Math.PI/180);var D=new a.Vector3(.3*G,0,0);D.applyAxisAngle(new a.Vector3(0,0,1),30*Math.PI/180);var C=new a.Vector3(G,0,0);C.applyAxisAngle(new a.Vector3(0,0,1),45*Math.PI/180);var B=H.clone().add(y),z=H.clone().add(D),A=H.clone().add(C);this.drawLine(H,B,L),this.drawLine(H,z,L),this.drawLine(H,A,L)},I);function I(){this.threeObjectGroup=null}o.MxTempMarkDraw=M},{"./MxFun":27,"./MxThreeJS":37,three:19}],37:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxThreeJS=void 0;var a,x,u=T("three"),M=T("./MxFun");function I(H){return Math.pow(2,Math.floor(Math.log(H)/Math.LN2))}(x=a||(o.MxThreeJS=a={})).createLine=function(H,G,L,y){var D,C=new u.Geometry;return D=y&&y!=1||y==0?new u.LineBasicMaterial({color:L,transparent:!0,depthTest:!1,opacity:y}):new u.LineBasicMaterial({color:L,transparent:!0,depthTest:!1}),C.vertices.push(H,G),new u.Line(C,D)},x.createSolid=function(H,G,L){if(H.length<3)return null;var y,D=new u.Shape(H.map(function(B){var z=B.x,A=B.y;return new u.Vector2(z,A)})),C=new u.ShapeGeometry(D);return y=L&&L!=1||L==0?new u.MeshPhongMaterial({color:G,side:u.DoubleSide,transparent:!0,depthTest:!1,opacity:L}):new u.MeshPhongMaterial({color:G,side:u.DoubleSide,transparent:!0,depthTest:!1}),new u.Mesh(C,y)},x.createPoint=function(H,G,L){L===void 0&&(L=3);var y=new u.Geometry;y.vertices.push(H);var D=new u.PointsMaterial({color:G,size:L});return new u.Points(y,D)},x.createDashedLine=function(H,G,L,y,D){var C=new u.Geometry;C.vertices.push(H,G);var B=new u.Line(C,new u.LineDashedMaterial({color:L,dashSize:y,gapSize:D,transparent:!0,depthTest:!1}));return B.computeLineDistances(),B},x.createCircle=function(H,G,L){var y=new u.CircleGeometry(G,64,3,2*Math.PI),D=new u.LineBasicMaterial({color:L,transparent:!0,depthTest:!1});y.vertices.shift();var C=new u.LineLoop(y,D);return C.position.x=H.x,C.position.y=H.y,C.position.z=H.z,C},x.createSolidCircle=function(H,G,L){var y=new u.MeshBasicMaterial({color:L,transparent:!0,depthTest:!1}),D=new u.CircleGeometry(G,64,3,2*Math.PI),C=new u.Mesh(D,y);return C.position.x=H.x,C.position.y=H.y,C.position.z=H.z,C},x.clacTextSize=function(H,G){var L=document.createElement("canvas").getContext("2d");if(L==null)return G;var y=M.MxFun.formatString("normal {0}px Arial","256");return L.font=y,L.measureText(H).width*G/256},x.clacTextSpriteSize=function(H,G,L){G<=1e-8&&(G=1);var y=document.createElement("canvas"),D=y.getContext("2d"),C=M.MxFun.formatString("normal {0}px Arial","256");D.font=C;var B=G/256,z=0,A=[],S=!0,q=0;if(L){z=L;for(var W=0,_=0,R=0;_<H.length;_++)(v=D.measureText(H.substring(W,_+1))).width*B>z&&(q+=(v.fontBoundingBoxAscent+v.fontBoundingBoxDescent)*B,A.push(H.substring(W,_)),W=_,R++);if(W<_){var v=D.measureText(H.substring(W,_));A.push(H.substring(W,_)),q+=(v.fontBoundingBoxAscent+v.fontBoundingBoxDescent)*B,R++}S=R<=1}else q=G,z=(v=D.measureText(H)).width*B,A.push(H),S=!1;var V=q/z*(y.width=1024);return y.height=I(V),y.height<V&&(y.height*=2),y.height==0&&(y.height=512),{spritewidth:z,spriteheight:z*y.height/y.width,textwidth:z,allTextHeight:q,singleline:S}},x.creatTextSprite=function(H,G,L,y,D,C,B){L<=1e-8&&(L=1);var z=document.createElement("canvas"),A=z.getContext("2d");B?(A.font=B(256),A.font.length==0&&(A.font=M.MxFun.formatString("normal {0}px Arial","256"))):A.font=M.MxFun.formatString("normal {0}px Arial","256");var S=L/256,q=0,W=[],_=[],R=0;if(C){q=C;for(var v=0,V=0;V<H.length;V++)(c=A.measureText(H.substring(v,V+1))).width*S>q&&(R+=Y=(c.fontBoundingBoxAscent+c.fontBoundingBoxDescent)*S,W.push(H.substring(v,V)),_.push(Y),v=V);if(v<V){var Y,c=A.measureText(H.substring(v,V));W.push(H.substring(v,V)),R+=Y=(c.fontBoundingBoxAscent+c.fontBoundingBoxDescent)*S,_.push(Y)}}else R=L,q=(c=A.measureText(H)).width*S,W.push(H),_.push(R);var p=R/q*(z.width=1024);z.height=I(p),z.height<p&&(z.height*=2),z.height==0&&(z.height=512);var m=1024/q,f=m*L;B?(A.font=B(f),A.font.length==0&&(A.font=M.MxFun.formatString("normal {0}px Arial",""+f))):A.font=M.MxFun.formatString("normal {0}px Arial",""+f);var N=M.MxFun.formatString("rgba({0}, {1}, {2}, 1.0)",(D>>16&255)+"",(D>>8&255)+"",(255&D)+"");A.fillStyle=N,A.textAlign="left",A.textBaseline="bottom";for(var P=0,O=0;P<W.length;P++)O+=m*_[P];for(P=0,O=.5*(z.height-O);P<W.length;P++)O+=m*_[P],A.fillText(W[P],0,O);var Z=new u.Texture(z);Z.needsUpdate=!0;var te=new u.SpriteMaterial({transparent:!0,depthTest:!1,map:Z});te.rotation=y;var de=new u.Sprite(te);return de.scale.set(q,q/z.width*z.height,1),de.position.set(G.x,G.y,G.z),de},x.createTriangle=function(H,G,L){if(!(H.length<3)){for(var y=H.length,D=new u.Geometry,C=0;C+2<y;C+=3){D.vertices.push(H[C]),D.vertices.push(H[C+1]),D.vertices.push(H[C+2]);var B=new u.Face3(C,C+1,C+2);D.faces.push(B)}D.computeFaceNormals(),D.computeVertexNormals(),L==null&&(L=1);var z=new u.MeshBasicMaterial({color:G,transparent:!0,depthTest:!1,side:u.DoubleSide,opacity:L});return new u.Mesh(D,z)}},x.createLines=function(H,G,L){var y,D=new u.Geometry;return D.vertices=H,y=L&&L!=1||L==0?new u.LineBasicMaterial({color:G,transparent:!0,depthTest:!1,opacity:L}):new u.LineBasicMaterial({color:G,transparent:!0,depthTest:!1}),new u.Line(D,y)},x.createDashedArc=function(H,G,L,y,D,C,B){var z=new u.CircleGeometry(G,64,L,y),A=new u.LineDashedMaterial({color:D,dashSize:C,gapSize:B,transparent:!0,depthTest:!1});z.vertices.shift();var S=new u.Line(z,A);return S.position.x=H.x,S.position.y=H.y,S.position.z=H.z,S},x.createDashedLines=function(H,G,L,y){var D=new u.Geometry;return D.vertices=H,new u.Line(D,new u.LineDashedMaterial({color:G,dashSize:L,gapSize:y,transparent:!0,depthTest:!1}))}},{"./MxFun":27,three:19}],38:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxPair=o.MxTools=void 0;var a,x,u=T("three");(x=a||(o.MxTools=a={})).AsMxWebPoint=function(M,I,H){return new u.Vector3(-M,H,I)},x.AsMxWebPoint_pt=function(M){return new u.Vector3(-M.x,M.z,M.y)},x.AsThreeJsPoint=function(M,I,H){return new u.Vector3(-M,H,I)},x.stringTrimLeftSpace=function(M){return M.replace(/^\s*/g,"")},x.stringDeleteAllSpace=function(M){return M.replace(/\s*/g,"")},x.stringTrimLeftRightSpace=function(M){return M.replace(/^\s*|\s*$/g,"")},x.stringTrimRightSpace=function(M){return M.replace(/(\s*$)/g,"")},x.IsNumerical=function(M){if(typeof M=="string"){var I=/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/;return!(!/^\d+(\.\d+)?$/.test(M)&&!I.test(M))}var H=M.m_val;return I=/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/,!(!/^\d+(\.\d+)?$/.test(H)&&!I.test(H))},x.formatString=function(M){for(var I=[],H=1;H<arguments.length;H++)I[H-1]=arguments[H];for(var G=0;G<I.length;G++)M=M.replace("{".concat(G,"}"),I[G]);return M},x._tstof=function(M){return parseFloat(M)},x._tstoi=function(M){return parseInt(M)},x.IsZero=function(M){return-1e-7<M&&M<1e-7},x.MillimeterToPixels=function(M){return 10*M},x.getXYPlanDistance=function(M,I){var H=new u.Vector2(M.x,M.y),G=new u.Vector2(I.x,I.y);return H.distanceTo(G)},x.MxASSERT=function(M,I){M||console.log("MxASSERT(0):"+I)},x.generateUUID=function(){return u.MathUtils.generateUUID()},x.MxMax=function(M,I){return I<M?M:I},x.getOpacity=function(M){var I=(4278190080&M)>>24&255;return I<=0&&(I=255),I/255},x.getColor=function(M){return 16777215&M},o.MxPair=function(M,I){this.first=M,this.second=I}},{three:19}],39:[function(T,r,o){var a,x,u,M;Object.defineProperty(o,"__esModule",{value:!0}),o.MxType=void 0,(u=(x=a||(o.MxType=a={})).MxCommandFlag||(x.MxCommandFlag={}))[u.MCRX_CMD_MODAL=0]="MCRX_CMD_MODAL",u[u.MCRX_CMD_TRANSPARENT=1]="MCRX_CMD_TRANSPARENT",u[u.MCRX_CMD_NO_UNDO_MARKER=2]="MCRX_CMD_NO_UNDO_MARKER",u[u.MCRX_CMD_NOPRV=4]="MCRX_CMD_NOPRV",u[u.MCRX_CMD_NO_RECORD_PRVCMD=8]="MCRX_CMD_NO_RECORD_PRVCMD",u[u.MCRX_CMD_NO_CLEAR_SELECT=16]="MCRX_CMD_NO_CLEAR_SELECT",(M=x.MxCloneType||(x.MxCloneType={}))[M.kClone=1]="kClone",M[M.kDragClone=2]="kDragClone",M[M.kMxFileClone=3]="kMxFileClone",M[M.kSaveDwgClone=4]="kSaveDwgClone"},{}],40:[function(T,r,o){var a;Object.defineProperty(o,"__esModule",{value:!0}),o.MxBulid=void 0,window.MxDrawVersion="1.0(2025-03-08 10:42)",(a||(o.MxBulid=a={})).getVersion=function(){return window.MxDrawVersion?window.MxDrawVersion:"inalid version"}},{}],41:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxWindowsEvent=void 0;var a,x,u,M,I=T("./MxFun"),H=T("./Operate/MxJigCmdManager"),G=T("./MxDrawData"),L=T("./UI/MxUiVue");function y(S,q){for(var W=0,_=M.length;W<_;W++){var R=M[W](S,q);if(R!=0)return R}}function D(S){y("mousemove",S)}function C(S){y("mouseup",S)}function B(S){y("dblclick",S)}function z(S){y("mousedown",S)}function A(S){var q=S||window.event||arguments.callee.caller.arguments[0];if(q&&q.keyCode==27){var W=I.MxFun.getCurrentMx();if(W.isPaningCommand())return void W.endPanCommand();if(H.MxJigCmdManager.isRunning()){if(H.MxJigCmdManager.getCurCmd().getDynImput().onKeyEcsDown()!=0)return;H.MxJigCmdManager.stopCmd(H.MxJigCmdManager.DetailedResult.kEcsIn)}else{var _=!1;if(G.MxDrawData.m_isEnableIntelliSelect){var R=!1;W.getMxDatabase().getGripManager().removeAllGrips()&&(R=!0),W.getMxDatabase().getSelectManager().removeAllEntity()&&(R=!0),W.isValidMcObject()&&W.getMcObject().getGripManager().clearAll()&&(R=!0),R&&(W.updateDisplay(),W.getMxDatabase().getGripManager().fireMxEntitySelectChange(),_=!0)}_||L.MxUiVue.acutPrintf(` *取消*
命令:`)}}}x=a||(o.MxWindowsEvent=a={}),u=!1,M=new Array,x.addEvent=function(S){M.push(S)},x.registEvent=function(){u||(u=!0,I.MxFun.isPC()&&(document.addEventListener("mousemove",D,!1),document.addEventListener("mouseup",C,!1),document.addEventListener("mousedown",z,!1),document.addEventListener("dblclick",B,!1),document.onkeydown=A))}},{"./MxDrawData":22,"./MxFun":27,"./Operate/MxJigCmdManager":54,"./UI/MxUiVue":65}],42:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.McEdJigDynamicTrace=void 0;var a=T("three"),x=T("./MxJigCmdManager"),u=T("../MxFun"),M=T("../MxDrawData"),I=T("../MxTools"),H=T("../MxManager"),G=T("../MxThreeJS"),L=T("./McEdJigOsnap"),y=(D.prototype.IsEqual=function(S){return this.m_snapObjectId==S.m_snapObjectId&&this.m_pt.distanceTo(S.m_pt)<1e-6},D.prototype.drawLine=function(S,q,W){var _=G.MxThreeJS.createLine(new a.Vector3(S.x,S.y,S.z),new a.Vector3(q.x,q.y,q.z),this.m_iColor);W.add(_),this.m_aryDynDrawObject.push(_)},D.prototype.clearDraw=function(S){for(var q=this.m_aryDynDrawObject.length,W=0;W<q;W++)u.MxFun.removeThreejsObject(this.m_aryDynDrawObject[W],S);this.m_aryDynDrawObject=[]},D.prototype.draw=function(S,q){var W=S.toSmallcoord(this.m_pt),_=new a.Vector3(W.x,W.y+this.m_iGripWidth,0),R=new a.Vector3(W.x,W.y-this.m_iGripWidth,0);this.drawLine(_,R,q);var v=new a.Vector3(W.x+this.m_iGripWidth,W.y,0),V=new a.Vector3(W.x-this.m_iGripWidth,W.y,0);this.drawLine(v,V,q)},D);function D(){this.m_snapObjectId=0,this.m_pt=new a.Vector3,this.m_osmode=0,this.m_iColor=16760703,this.m_iGripWidth=10,this.m_aryDynDrawObject=new Array}var C=(B.prototype.clearDraw=function(S){for(var q=this.m_aryDynDrawObject.length,W=0;W<q;W++)u.MxFun.removeThreejsObject(this.m_aryDynDrawObject[W],S);this.m_aryDynDrawObject=[]},B.prototype.draw=function(S,q){this.m_draw.setWidth(this.m_iGripWidth),this.m_draw.draw(S.toSmallcoord(this.m_pt),this.m_ostype,q)},B);function B(S,q){var W=this;this.m_aryDynDrawObject=new Array,this.m_iGripWidth=10,this.m_draw=new L.McEdJigOsnapDraw,this.m_pt=S,this.m_ostype=q,this.m_draw.setAddDynDrawObject_call(function(_){W.m_aryDynDrawObject.push(_)})}var z=(A.prototype.DynamicTraceTimeCall=function(S){if(!this.m_mxJig.isExit()&&this.m_iTimeCallId==S&&this.m_isDynTrace&&this.m_snapObjectId!=0){var q=new y;q.m_osmode=this.m_osmode,q.m_snapObjectId=this.m_snapObjectId,q.m_pt=this.m_ptSnapPoint,q.m_iGripWidth=.5*this.m_mxJig.getMxObject().screenCoordLong2Doc(M.MxDrawData.m_dInputRectWidth);for(var W=this.m_aryTraceObject.length,_=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),R=0;R<W;R++)if(this.m_aryTraceObject[R].IsEqual(q))return this.m_aryTraceObject[R].clearDraw(_),void this.m_aryTraceObject.splice(R,1);this.m_aryTraceObject.push(q),q.draw(this.m_mxJig.getMxObject(),_),this.m_mxJig.getMxObject().updateDisplay()}},A.prototype.OnDynamicTrace=function(S,q,W){if(this.m_isDynTrace)if(S==0)this.m_iTimeCallId++,this.m_snapObjectId=0;else{if(W==x.MxJigCmdManager.OsnapMode.kOsModeNear)return;var _=.5*this.m_mxJig.getMxObject().screenCoordLong2Doc(M.MxDrawData.m_dInputRectWidth);if(this.m_snapObjectId!=0&&this.m_ptSnapPoint.distanceTo(q)<_)return;var R=this.m_iTimeCallId,v=this;setTimeout(function(){v.DynamicTraceTimeCall(R)},400),this.m_snapObjectId=S,this.m_ptSnapPoint=q,this.m_osmode=W}},A.prototype.ClearOsmodeObjectDisplay=function(){for(var S=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),q=this.m_aryTraceOsmodeObject.length,W=0;W<q;W++)this.m_aryTraceOsmodeObject[W].clearDraw(S);this.m_aryTraceOsmodeObject=[]},A.prototype.ClearTraceObject=function(){for(var S=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),q=this.m_aryTraceObject.length,W=0;W<q;W++)this.m_aryTraceObject[W].clearDraw(S);this.m_aryTraceObject=[]},A.prototype.ClearDisplay=function(){this.ClearTraceObject(),this.ClearOsmodeObjectDisplay(),this.ClearDynDrawEntity()},A.prototype.GetTraceLine=function(S,q,W,_){var R=q.m_pt;if(R.distanceTo(S)<2*W)return[];var v={pt1:new a.Vector3(R.x-_,R.y),pt2:new a.Vector3(R.x+_,R.y)},V={pt1:new a.Vector3(R.x,R.y-_),pt2:new a.Vector3(R.x,R.y+_)},Y=[];Y.push(v),Y.push(V);for(var c=H.MxManager.getMxCpp().getMcDbCurve(q.m_snapObjectId);c;){var p=c.getFirstDeriv(H.MxManager.getMxCpp().newMcGePoint3d(R));if(p.ret!=0||p.val.isZeroLength())break;p.val.normalize(),p.val.mult(_);var m={pt1:new a.Vector3(R.x-p.val.x,R.y-p.val.y),pt2:new a.Vector3(R.x+p.val.x,R.y+p.val.y)};Y.push(m),p.val.rotateBy(Math.PI/2);var f={pt1:new a.Vector3(R.x-p.val.x,R.y-p.val.y),pt2:new a.Vector3(R.x+p.val.x,R.y+p.val.y)};Y.push(f);break}return Y},A.prototype.ClearDynDrawEntity=function(){for(var S=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),q=this.m_vecDynDrawEntity.length,W=0;W<q;W++)u.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[W],S);this.m_vecDynDrawEntity=[]},A.prototype.DoMouseMove=function(S){if(this.ClearDynDrawEntity(),this.ClearOsmodeObjectDisplay(),this.m_isValidTracePoint=!1,!this.m_isDynTrace)return[];if(this.m_aryTraceObject.length==0)return[];for(var q=[],W=this.m_mxJig.getMxObject(),_=W.viewCoordLong2Cad(M.MxDrawData.m_dInputRectWidth),R=2*_,v=W.viewCoordLong2Cad(W.getViewWidth()),V=W.viewCoordLong2Cad(W.getViewHeight()),Y=I.MxTools.MxMax(v,V),c=H.MxManager.getMxCpp().getMxCAD_App(),p=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),m=this.m_mxJig.getMxObject().viewCoordLong2Cad(this.m_dashedLineLen),f=0;f<this.m_aryTraceObject.length-1;f++){var N=this.m_aryTraceObject[f],P=N.m_pt,O=this.GetTraceLine(S,N,R,Y);if(O.length!=0)for(var Z=f+1;Z<this.m_aryTraceObject.length&&!this.m_isValidTracePoint;Z++){var te=this.m_aryTraceObject[f],de=te.m_pt,me=this.GetTraceLine(S,te,R,Y);if(O.length!=0)for(var we=0;we<me.length&&!this.m_isValidTracePoint;we++)for(var ge=me[we],Le=0;Le<O.length&&!this.m_isValidTracePoint;Le++){var Pe=O[Le],ae=c.MxCADAssist.IntersectWith(Pe.pt1.x,Pe.pt1.y,Pe.pt2.x,Pe.pt2.y,ge.pt1.x,ge.pt1.y,ge.pt2.x,ge.pt2.y,3);if(0<ae.length()){var ve=ae.at(0),Ie=new a.Vector3(ve.x,ve.y,ve.z);if(Ie.distanceTo(S)<R){var ze=G.MxThreeJS.createDashedLine(W.toSmallcoord(Pe.pt1),W.toSmallcoord(Pe.pt2),this.m_iDashedLineLenColor,m,m);p.add(ze),this.m_vecDynDrawEntity.push(ze);var He=G.MxThreeJS.createDashedLine(W.toSmallcoord(ge.pt1),W.toSmallcoord(ge.pt2),this.m_iDashedLineLenColor,m,m);p.add(He),this.m_vecDynDrawEntity.push(He),we=me.length,this.m_isValidTracePoint=!0,this.m_ptTracePoint=Ie,this.CreteTracePoint(Ie,_),q.push({pt:P,ostype:N.m_osmode}),q.push({pt:de,ostype:te.m_osmode});break}}}}}if(this.m_isValidTracePoint||this.TracekPerpLine(S,q,R,Y,_)||this.TracekTangLine(S,q,R,Y,_))return q;for(f=0;f<this.m_aryTraceObject.length;f++)if(P=this.m_aryTraceObject[f].m_pt,this.m_aryTraceObject[f].m_osmode!=x.MxJigCmdManager.OsnapMode.kOsModePerp&&!(P.distanceTo(S)<2*R)){var at={pt1:new a.Vector3(P.x-Y,P.y),pt2:new a.Vector3(P.x+Y,P.y)};if(0<(De=c.MxCADAssist.GetClosestPointTo(at.pt1.x,at.pt1.y,at.pt2.x,at.pt2.y,S.x,S.y,!0)).length()){var tt=De.at(0);if((st=new a.Vector3(tt.x,tt.y,tt.z)).distanceTo(S)<R){var le=G.MxThreeJS.createDashedLine(W.toSmallcoord(at.pt1),W.toSmallcoord(at.pt2),this.m_iDashedLineLenColor,m,m);p.add(le),this.m_vecDynDrawEntity.push(le),this.m_isValidTracePoint=!0,this.m_ptTracePoint=st,q.push({pt:P,ostype:this.m_aryTraceObject[f].m_osmode}),this.CreteTracePoint(st,_);break}}var De,st,gt={pt1:new a.Vector3(P.x,P.y-Y),pt2:new a.Vector3(P.x,P.y+Y)};if(0<(De=c.MxCADAssist.GetClosestPointTo(gt.pt1.x,gt.pt1.y,gt.pt2.x,gt.pt2.y,S.x,S.y,!0)).length()&&(tt=De.at(0),(st=new a.Vector3(tt.x,tt.y,tt.z)).distanceTo(S)<R)){le=G.MxThreeJS.createDashedLine(W.toSmallcoord(gt.pt1),W.toSmallcoord(gt.pt2),this.m_iDashedLineLenColor,m,m),p.add(le),this.m_vecDynDrawEntity.push(le),this.m_isValidTracePoint=!0,this.m_ptTracePoint=st,q.push({pt:P,ostype:this.m_aryTraceObject[f].m_osmode}),this.CreteTracePoint(st,_);break}}return q},A.prototype.MouseMove=function(S){var q=this.DoMouseMove(S);if(this.m_isValidTracePoint)for(var W=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),_=this.m_mxJig.getMxObject().screenCoordLong2Doc(M.MxDrawData.m_dInputRectWidth),R=0;R<q.length;R++){var v=new C(q[R].pt,q[R].ostype);v.m_iGripWidth=_,v.draw(this.m_mxJig.getMxObject(),W),this.m_aryTraceOsmodeObject.push(v)}},A.prototype.Init=function(){var S=this.m_mxJig.getMxObject();S.getMcObject().isValid()?(this.m_isDynTrace=S.getSysVarLong("DYNTRACE")!=0,S.sysVariable().getSysVarNumber("GETPOINTSTATUS")&x.MxJigCmdManager.GETPOINTSTATUS.OsModeDynTraceTempDisable&&(this.m_isDynTrace=!1),this.m_mxJig.isDisableDynamicTrace()&&(this.m_isDynTrace=!1),this.m_isDynTrace):this.m_isDynTrace=!1},A.prototype.GetTracePoint=function(){if(this.m_isDynTrace)return this.m_isValidTracePoint?this.m_ptTracePoint:void 0},A.prototype.ReSetTempDisplay=function(){this.ClearDynDrawEntity(),this.ClearOsmodeObjectDisplay(),this.m_isValidTracePoint=!1},A.prototype.CreteTracePoint=function(S,q){var W=this.m_mxJig.getMxObject(),_=W.getTheTempDrawContainer_SmallCoord();q/=2;var R=G.MxThreeJS.createLine(W.toSmallcoord2(S.x+q,S.y+q,0),W.toSmallcoord2(S.x-q,S.y-q,0),16711680);_.add(R),this.m_vecDynDrawEntity.push(R);var v=G.MxThreeJS.createLine(W.toSmallcoord2(S.x-q,S.y+q,0),W.toSmallcoord2(S.x+q,S.y-q,0),16711680);_.add(v),this.m_vecDynDrawEntity.push(v)},A.prototype.TracekPerpLine=function(S,q,W,_,R){for(var v=this.m_aryTraceObject,V=v.length,Y=H.MxManager.getMxCpp().getMxCAD_App(),c=this.m_mxJig.getMxObject(),p=c.getTheTempDrawContainer_SmallCoord(),m=c.viewCoordLong2Cad(this.m_dashedLineLen),f=0;f<V;f++){var N=v[f].m_pt;if(!(N.distanceTo(S)<2*W)){var P=H.MxManager.getMxCpp().getMcDbCurve(v[f].m_snapObjectId);if(P){var O=P.getFirstDeriv(H.MxManager.getMxCpp().newMcGePoint3d(N));if(O.ret==0&&!O.val.isZeroLength()){O.val.normalize(),O.val.rotateBy(Math.PI/2),O.val.mult(_);var Z={pt1:new a.Vector3(N.x-O.val.x,N.y-O.val.y),pt2:new a.Vector3(N.x+O.val.x,N.y+O.val.y)},te=Y.MxCADAssist.GetClosestPointTo(Z.pt1.x,Z.pt1.y,Z.pt2.x,Z.pt2.y,S.x,S.y,!0);if(0<te.length()){var de=te.at(0),me=new a.Vector3(de.x,de.y,de.z);if(me.distanceTo(S)<W){var we=G.MxThreeJS.createDashedLine(c.toSmallcoord2(N.x-O.val.x,N.y-O.val.y,0),c.toSmallcoord2(N.x+O.val.x,N.y+O.val.y,0),this.m_iDashedLineLenColor,m,m);p.add(we),this.m_vecDynDrawEntity.push(we),this.m_isValidTracePoint=!0,this.m_ptTracePoint=me,q.push({pt:N,ostype:v[f].m_osmode}),this.CreteTracePoint(me,R);break}}}}}}return this.m_isValidTracePoint},A.prototype.TracekTangLine=function(S,q,W,_,R){for(var v=this.m_aryTraceObject,V=v.length,Y=H.MxManager.getMxCpp().getMxCAD_App(),c=this.m_mxJig.getMxObject(),p=c.getTheTempDrawContainer_SmallCoord(),m=c.viewCoordLong2Cad(this.m_dashedLineLen),f=0;f<V;f++){var N=v[f].m_pt;if(!(N.distanceTo(S)<2*W)){var P=H.MxManager.getMxCpp().getMcDbCurve(v[f].m_snapObjectId);if(P){var O=P.getFirstDeriv(H.MxManager.getMxCpp().newMcGePoint3d(N));if(O.ret==0&&!O.val.isZeroLength()){O.val.normalize(),O.val.mult(_);var Z={pt1:new a.Vector3(N.x-O.val.x,N.y-O.val.y),pt2:new a.Vector3(N.x+O.val.x,N.y+O.val.y)},te=Y.MxCADAssist.GetClosestPointTo(Z.pt1.x,Z.pt1.y,Z.pt2.x,Z.pt2.y,S.x,S.y,!0);if(0<te.length()){var de=te.at(0),me=new a.Vector3(de.x,de.y,de.z);if(me.distanceTo(S)<W){var we=G.MxThreeJS.createDashedLine(c.toSmallcoord2(N.x-O.val.x,N.y-O.val.y),c.toSmallcoord2(N.x+O.val.x,N.y+O.val.y),this.m_iDashedLineLenColor,m,m);p.add(we),this.m_vecDynDrawEntity.push(we),this.m_isValidTracePoint=!0,this.m_ptTracePoint=me,q.push({pt:N,ostype:v[f].m_osmode}),this.CreteTracePoint(me,R);break}}}}}}return this.m_isValidTracePoint},A);function A(S){this.m_snapObjectId=0,this.m_ptSnapPoint=new a.Vector3,this.m_osmode=0,this.m_ptTracePoint=new a.Vector3,this.m_isValidTracePoint=!1,this.m_isDynTrace=!1,this.m_iTimeCallId=0,this.m_mxJig=null,this.m_aryTraceObject=[],this.m_aryTraceOsmodeObject=[],this.m_vecDynDrawEntity=[],this.m_dashedLineLen=1.5,this.m_iDashedLineLenColor=11184810,this.m_mxJig=S}o.McEdJigDynamicTrace=z},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxThreeJS":37,"../MxTools":38,"./McEdJigOsnap":43,"./MxJigCmdManager":54,three:19}],43:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.McEdJigOsnap=o.McEdJigOsnapDraw=o.McEdJigOrtho=o.McEdImpJigGlobalData=o.MxOsnapDefine=void 0;var a,x,u,M,I,H,G,L,y,D,C=T("three"),B=T("../MxDrawObject"),z=T("../MxFun"),A=T("./MxJigCmdManager"),S=T("../MxTools"),q=T("../MxDrawData");(x=a||(o.MxOsnapDefine=a={}))[x.OsModeInvalid=0]="OsModeInvalid",x[x.OsModeEnd=1]="OsModeEnd",x[x.OsModeMid=2]="OsModeMid",x[x.OsModeCen=4]="OsModeCen",x[x.OsModeNode=8]="OsModeNode",x[x.OsModeQuad=16]="OsModeQuad",x[x.OsModeInt=32]="OsModeInt",x[x.OsModeIns=64]="OsModeIns",x[x.OsModePerp=128]="OsModePerp",x[x.OsModeTan=256]="OsModeTan",x[x.OsModeNear=512]="OsModeNear",x[x.OsModeApp=2048]="OsModeApp",x[x.OsModeExt=4096]="OsModeExt",x[x.OsModePar=8192]="OsModePar",x[x.OsModeOff=16384]="OsModeOff",x[x.OsModeAll=16383]="OsModeAll",M=u||(o.McEdImpJigGlobalData=u={}),I=!1,H=new C.Vector3,G=new C.Vector3,y=L=!1,D=new Array,M.setPrvPoint=function(c){H=c,y=!0},M.isOsnapZValue=function(){return!1},M.setIsValidPrvpoint=function(c){y=c},M.isValidPrvpoint=function(){return y},M.getPrvPoint=function(){return H},M.setIsValidBasepoint=function(c){I=c},M.isValidBasepoint=function(){return I},M.setBasepoint=function(c){I=!0,G=c},M.getBasepoint=function(){return G},M.initStartCommand=function(){L=I=!1},M.setIsTmpDisableOsmode=function(c){L=c},M.isTmpDisableOsmode=function(){return L},M.addDynDrawObject=function(c){D.push(c)},M.clearDisplay=function(c){for(var p=D.length,m=0;m<p;m++)z.MxFun.removeThreejsObject(D[m],c);D=[]};var W=(_.prototype.Init=function(){this.m_isTrace=!this.m_mxJig.isDisableOrthoTrace(),this.m_isValid=!1},_.prototype.OnViewMouseMove=function(c){if(this.m_isTrace){var p=this.m_mxJig.getMxObject(),m=p.sysVariable().getSysVarNumber("GETPOINTSTATUS");if(!(p.getSysVarLong("ORTHOMODE")==0||m&A.MxJigCmdManager.GETPOINTSTATUS.OsModeOrthoTempDisable)&&m&A.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint){var f=p.sysVariable().getSysVarPoint("LASTPOINT");Math.abs(c.x-f.x)>Math.abs(c.y-f.y)?(this.m_ptOrtho.x=c.x,this.m_ptOrtho.y=f.y):(this.m_ptOrtho.x=f.x,this.m_ptOrtho.y=c.y),this.m_isValid=!0}else this.m_isValid=!1}},_.prototype.GetCurOrthoPoint=function(){return{pt:this.m_ptOrtho,isValid:this.m_isValid}},_);function _(c){this.m_mxJig=null,this.m_ptOrtho=new C.Vector3,this.m_isValid=!1,this.m_isTrace=!0,this.m_mxJig=c}o.McEdJigOrtho=W;var R=(v.prototype.setAddDynDrawObject_call=function(c){this.m_addDynDrawObject_call=c},v.prototype.addDynDrawObject=function(c){this.m_addDynDrawObject_call?this.m_addDynDrawObject_call(c):u.addDynDrawObject(c)},v.prototype.drawLine=function(c,p,m){var f=new C.Geometry,N=new C.LineBasicMaterial({color:this.m_iColor});f.vertices.push(new C.Vector3(c.x,c.y,c.z),new C.Vector3(p.x,p.y,p.z));var P=new C.Line(f,N);m.add(P),this.addDynDrawObject(P)},v.prototype.drawPolyline=function(c,p){for(var m=new C.Geometry,f=new C.LineBasicMaterial({color:this.m_iColor}),N=c.length,P=0;P<N;P++)m.vertices.push(new C.Vector3(c[P].x,c[P].y,c[P].z));var O=new C.Line(m,f);p.add(O),this.addDynDrawObject(O)},v.prototype.setWidth=function(c){this.m_dOsmodeWdith=c},v.prototype.GetDrawRect=function(){var c=.5*this.m_dOsmodeWdith,p={};return p.left=this.m_pt.x-c,p.right=this.m_pt.x+c,p.top=this.m_pt.y-c,p.bottom=this.m_pt.y+c,p},v.prototype.DrawNear=function(c){var p=this.GetDrawRect(),m=[new C.Vector3,new C.Vector3];m[0].x=p.left,m[0].y=p.top,m[1].x=p.right,m[1].y=p.top,this.drawLine(m[0],m[1],c),m[0].x=p.left,m[0].y=p.bottom,m[1].x=p.right,m[1].y=p.bottom,this.drawLine(m[0],m[1],c),m[0].x=p.right,m[0].y=p.top,m[1].x=p.left,m[1].y=p.bottom,this.drawLine(m[0],m[1],c),m[0].x=p.right,m[0].y=p.bottom,m[1].x=p.left,m[1].y=p.top,this.drawLine(m[0],m[1],c)},v.prototype.DrawEnd=function(c){var p=this.GetDrawRect(),m=[new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3];m[0].x=p.left,m[0].y=p.top,m[1].x=p.right,m[1].y=p.top,m[2].x=p.right,m[2].y=p.bottom,m[3].x=p.left,m[3].y=p.bottom,this.drawLine(m[0],m[1],c),this.drawLine(m[1],m[2],c),this.drawLine(m[2],m[3],c),this.drawLine(m[3],m[0],c)},v.prototype.DrawMid=function(c){var p=this.GetDrawRect(),m=1.2*(p.right-p.left),f=m/2/Math.sin(60*3.14159265/180),N=f*Math.sin(.5235987750000001),P=new C.Vector3(this.m_pt.x,this.m_pt.y,this.m_pt.z);P.y-=f;var O=new C.Vector3;O.x=this.m_pt.x+m/2,O.y=this.m_pt.y+N;var Z=new C.Vector3;Z.x=this.m_pt.x-m/2,Z.y=this.m_pt.y+N;var te=[new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3];te[0].x=P.x,te[0].y=P.y,te[1].x=O.x,te[1].y=O.y,te[2].x=Z.x,te[2].y=Z.y,te[3].x=P.x,te[3].y=P.y,this.drawLine(te[0],te[1],c),this.drawLine(te[1],te[2],c),this.drawLine(te[2],te[3],c)},v.prototype.DrawPerp=function(c){var p=this.GetDrawRect(),m=[new C.Vector3,new C.Vector3,new C.Vector3];m[0].x=p.left,m[0].y=p.top,m[1].x=p.left,m[1].y=p.bottom,m[2].x=p.right,m[2].y=p.bottom,this.drawPolyline(m,c),m[0].x=p.left,m[0].y=this.m_pt.y,m[1].x=this.m_pt.x,m[1].y=this.m_pt.y,m[2].x=this.m_pt.x,m[2].y=p.bottom,this.drawPolyline(m,c)},v.prototype.DrawCircle=function(c,p,m){m==null&&(m=.5*this.m_dOsmodeWdith);for(var f=[],N=0,P=3.14159265/180;N<=360;N+=15){var O=m*Math.cos(N*P)+c.x,Z=m*Math.sin(N*P)+c.y;f.push(new C.Vector3(O,Z))}this.drawPolyline(f,p)},v.prototype.DrawInt=function(c){var p=this.GetDrawRect(),m=[new C.Vector3,new C.Vector3];m[0].x=p.right,m[0].y=p.top,m[1].x=p.left,m[1].y=p.bottom,this.drawLine(m[0],m[1],c),m[0].x=p.right,m[0].y=p.bottom,m[1].x=p.left,m[1].y=p.top,this.drawLine(m[0],m[1],c)},v.prototype.DrawCen=function(c){this.DrawInt(c),this.DrawCircle(this.m_pt,c)},v.prototype.DrawTan=function(c){this.DrawEnd(c)},v.prototype.DrawIns=function(c){var p=this.GetDrawRect(),m={},f=(p.right-p.left)/1.5;m.left=this.m_pt.x-f,m.right=this.m_pt.x+f,m.top=this.m_pt.y-f,m.bottom=this.m_pt.y+f;var N=this.m_pt.x,P=this.m_pt.y,O=[new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3];O[0].x=m.left,O[0].y=m.top,O[1].x=m.left,O[1].y=P+2,O[2].x=N,O[2].y=P+2,O[3].x=N,O[3].y=m.bottom,O[4].x=m.right,O[4].y=m.bottom,O[5].x=m.right,O[5].y=P-2,O[6].x=N,O[6].y=P-2,O[7].x=N,O[7].y=m.top,O[8].x=m.left,O[8].y=m.top,this.drawPolyline(O,c)},v.prototype.DrawNode=function(c){var p=this.GetDrawRect(),m={},f=(p.right-p.left)/1.5;m.left=this.m_pt.x-f,m.right=this.m_pt.x+f,m.top=this.m_pt.y-f,m.bottom=this.m_pt.y+f;var N=this.m_dOsmodeWdith/1.3;this.m_pt.x,this.m_pt.x,this.m_pt.y,this.m_pt.y;var P=[new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3];P[0].x=m.left,P[0].y=m.top,P[1].x=m.right,P[1].y=m.bottom,P[2].x=m.left,P[2].y=m.bottom,P[3].x=m.right,P[3].y=m.top,this.drawLine(P[0],P[1],c),this.drawLine(P[2],P[3],c),this.DrawCircle(this.m_pt,c,N)},v.prototype.draw=function(c,p,m){this.m_pt=c,this.m_osmode=p;var f=.5*this.m_dOsmodeWdith;if(this.m_osmode!=A.MxJigCmdManager.OsnapMode.kOsModekInValid)if(this.m_osmode==A.MxJigCmdManager.OsnapMode.kOsModeNear)this.DrawNear(m);else if(this.m_osmode==A.MxJigCmdManager.OsnapMode.kOsModeEnd)this.DrawEnd(m);else if(this.m_osmode==A.MxJigCmdManager.OsnapMode.kOsModeMid)this.DrawMid(m);else if(this.m_osmode==A.MxJigCmdManager.OsnapMode.kOsModePerp)this.DrawPerp(m);else if(this.m_osmode==A.MxJigCmdManager.OsnapMode.kOsModeInt)this.DrawInt(m);else if(this.m_osmode==A.MxJigCmdManager.OsnapMode.kOsModeCen)this.DrawCen(m);else if(this.m_osmode==A.MxJigCmdManager.OsnapMode.kOsModeTan)this.DrawTan(m);else if(this.m_osmode==A.MxJigCmdManager.OsnapMode.kOsModeIns)this.DrawIns(m);else if(this.m_osmode==A.MxJigCmdManager.OsnapMode.kOsModeNode)this.DrawNode(m);else{var N=new C.Vector3(c.x-f,c.y-f,0),P=new C.Vector3(c.x+f,c.y+f,0);this.drawLine(N,P,m);var O=new C.Vector3(c.x-f,c.y+f,0),Z=new C.Vector3(c.x+f,c.y-f,0);this.drawLine(O,Z,m)}},v.prototype.upDisplay=function(c,p,m){this.clearDisplay(m);var f=m.getMxObject();this.setWidth(f.screenCoordLong2Doc(q.MxDrawData.m_dInputRectWidth)),c=f.toSmallcoord(c),this.draw(c,p,f.getTheTempDrawContainer_SmallCoord())},v.prototype.clearDisplay=function(c){var p=c.getMxObject().getTheTempDrawContainer_SmallCoord();u.clearDisplay(p)},v);function v(){this.m_iColor=16711935,this.m_addDynDrawObject_call=void 0,this.m_pt=new C.Vector3,this.m_osmode=A.MxJigCmdManager.OsnapMode.kOsModekInValid,this.m_dOsmodeWdith=10}o.McEdJigOsnapDraw=R;var V=(Y.prototype.setSpecificOsMode=function(c){this.m_lSpecificOsMode=c},Y.prototype.resetData=function(){this.m_osmode=A.MxJigCmdManager.OsnapMode.kOsModekInValid,this.m_isValidPrvInputPoint=!1,this.m_lOSmode=0,this.m_vecOffset.set(0,0,0),this.m_isValid=!1,this.m_iLongprogressStatus=-1,this.m_lSpecificOsMode=0,this.reComputeOffset()},Y.prototype.notifyOsnapToServer=function(){var c=this;if(this.m_isRuning){var p={ptx:this.m_pt.x,pty:this.m_pt.y,osmode:this.m_lOSmode,isValidPrvInputPoint:this.m_isValidPrvInputPoint};this.m_isValidPrvInputPoint&&(p.prvPtx=this.m_prvInputPoint.x,p.prvPty=this.m_prvInputPoint.y);var m=this.m_mxJig.getMxObject();if(m.getRunMode()==B.MxRunMode.kBrowse){var f=this,N=m.getCurrentMousePostion();m.getObjectOsnap().getOsnapData(N,function(Z,te){Z=m.worldCoord2Doc(Z.x,Z.y,Z.z),f.m_ptSnapPoint.x=Z.x,f.m_ptSnapPoint.y=Z.y,f.m_ptSnapPoint.z=0,f.m_ptSnapSrcPoint.x=f.m_pt.x,f.m_ptSnapSrcPoint.y=f.m_pt.y,f.m_ptSnapSrcPoint.z=0,f.m_osmode=te,f.m_draw.upDisplay(new C.Vector3(Z.x,Z.y,0),te,f.m_mxJig)})}else if(m.getRunMode()==B.MxRunMode.kCPPMxCAD){var P=this;p.SearchRnge=m.viewCoordLong2Cad(q.MxDrawData.m_dInputRectWidth),m.getMcObject().onNotifyOsnap(p,function(Z){P.m_ptSnapPoint.x=Z.ptsx,P.m_ptSnapPoint.y=Z.ptsy,P.m_ptSnapPoint.z=Z.ptsz,P.m_ptSnapSrcPoint.x=Z.ptx,P.m_ptSnapSrcPoint.y=Z.pty,P.m_ptSnapSrcPoint.z=0,P.m_osmode=Z.osmode,P.m_snapObjectId=Z.id,P.m_draw.upDisplay(new C.Vector3(Z.ptsx,Z.ptsy,Z.ptsz),Z.osmode,P.m_mxJig),P.m_mxJig.onGetOsnapData(Z)})}else{p.SearchRnge=m.viewCoordLong2Cad(q.MxDrawData.m_dInputRectWidth);var O=this;m.callCommand("MxCAD_NotifyOsnap",JSON.stringify(p),function(Z){if(!(typeof Z!="string"||Z.length<1)&&O.m_isRuning){var te=JSON.parse(Z);c.m_ptSnapPoint.x=te.ptsx,c.m_ptSnapPoint.y=te.ptsy,c.m_ptSnapPoint.z=te.ptsz,c.m_ptSnapSrcPoint.x=te.ptx,c.m_ptSnapSrcPoint.y=te.pty,c.m_ptSnapSrcPoint.z=0,c.m_osmode=te.osmode,O.m_draw.upDisplay(new C.Vector3(te.ptsx,te.ptsy,te.ptsz),te.osmode,O.m_mxJig)}})}}},Y.prototype.startDrag=function(c,p){this.m_mxJig=p;var m,f,N=this.m_mxJig.getMxObject();function P(){m.notifyOsnapToServer()}return p.isDisableOsnap()?this.m_isEnable=!1:this.m_isEnable=N.getInisetValue(B.IniSetName.kEnableOsnapFunction)===!0,this.m_isOffsetInputPostion=c,this.m_isRuning=!0,this.resetData(),this.m_notifyOsnap_delayCall=(m=this,f=null,function(){clearTimeout(f),f=setTimeout(P,20)}),!0},Y.prototype.endDrag=function(){return this.m_isRuning=!1,this.m_draw.clearDisplay(this.m_mxJig),!0},Y.prototype.reCompteCurrentPoint=function(c){return this.m_isOffsetInputPostion&&c.add(this.m_vecOffset),c},Y.prototype.getIsEnableVar=function(){return this.m_isEnable},Y.prototype.isEnable=function(){if(!this.isEnable||u.isTmpDisableOsmode())return!1;var c=this.m_mxJig.getMxObject().getSysVarLong("OSMODE");return this.m_lSpecificOsMode!=0&&(c=this.m_lSpecificOsMode),!(c==0||c&a.OsModeOff)},Y.prototype.notifyOsnap=function(c,p){this.m_lOSmode=c,p==null?this.m_isValidPrvInputPoint=!1:(this.m_isValidPrvInputPoint=!0,this.m_prvInputPoint=p),this.m_osmode==A.MxJigCmdManager.OsnapMode.kOsModekInValid&&this.m_draw.clearDisplay(this.m_mxJig),this.m_notifyOsnap_delayCall()},Y.prototype.setPoint=function(c,p){if(this.isEnable()){c==null?(this.m_isValid=!1,this.m_osmode=A.MxJigCmdManager.OsnapMode.kOsModekInValid):(this.m_iLongprogressStatus==-1||this.m_iLongprogressStatus,this.m_pt=c,this.m_inPoint=c,this.m_isValid=!0,(p==null||this.m_osmode!=A.MxJigCmdManager.OsnapMode.kOsModekInValid&&S.MxTools.getXYPlanDistance(this.m_ptSnapSrcPoint,c)>p)&&(this.m_osmode=A.MxJigCmdManager.OsnapMode.kOsModekInValid));var m=this.m_mxJig.getMxObject().getSysVarLong("OSMODE");this.m_lSpecificOsMode!=0&&(m=this.m_lSpecificOsMode);var f=u.getPrvPoint();this.notifyOsnap(m,u.isValidPrvpoint()?f:void 0)}},Y.prototype.seInValidPoint=function(){this.setPoint(void 0)},Y.prototype.getCurrentOSnapPoint=function(c){var p={isSnapPoint:!1};return this.isEnable()?(p.pt=c,p.osmode=this.m_osmode,this.m_osmode!=A.MxJigCmdManager.OsnapMode.kOsModekInValid?(p.isSnapPoint=!0,p.pt.x=this.m_ptSnapPoint.x,p.pt.y=this.m_ptSnapPoint.y,p.pt.z=this.m_ptSnapPoint.z,u.isOsnapZValue()||(c.z=0)):p.pt=c):(p.pt=c,p.osmode=A.MxJigCmdManager.OsnapMode.kOsModekInValid),p},Y.prototype.setLongprogressStatus=function(c){this.m_iLongprogressStatus=c},Y.prototype.reComputeOffset=function(){if(this.m_isOffsetInputPostion){var c=this.m_mxJig.getMxObject(),p=S.MxTools.MillimeterToPixels(8);p=c.screenCoordLong2Doc(p),this.m_vecOffset.set(0,p,0),this.m_vecOffset.applyAxisAngle(new C.Vector3(0,0,1),20*Math.PI/180)}},Y);function Y(c){this.m_inPoint=new C.Vector3,this.m_vecOffset=new C.Vector3,this.m_pt=new C.Vector3,this.m_isValid=!1,this.m_ptSnapPoint=new C.Vector3,this.m_ptSnapSrcPoint=new C.Vector3,this.m_snapObjectId=0,this.m_osmode=A.MxJigCmdManager.OsnapMode.kOsModekInValid,this.m_prvInputPoint=new C.Vector3,this.m_isValidPrvInputPoint=!1,this.m_lOSmode=0,this.m_iLongprogressStatus=-1,this.m_isOffsetInputPostion=!1,this.m_mxJig=null,this.m_notifyOsnap_delayCall=void 0,this.m_isRuning=!1,this.m_isEnable=!1,this.m_lSpecificOsMode=0,this.m_mxJig=c,this.m_draw=new R}o.McEdJigOsnap=V},{"../MxDrawData":22,"../MxDrawObject":23,"../MxFun":27,"../MxTools":38,"./MxJigCmdManager":54,three:19}],44:[function(T,r,o){var a,x=this&&this.__extends||(a=function(S,q){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(W,_){W.__proto__=_}||function(W,_){for(var R in _)Object.prototype.hasOwnProperty.call(_,R)&&(W[R]=_[R])})(S,q)},function(S,q){if(typeof q!="function"&&q!==null)throw new TypeError("Class extends value "+String(q)+" is not a constructor or null");function W(){this.constructor=S}a(S,q),S.prototype=q===null?Object.create(q):(W.prototype=q.prototype,new W)});Object.defineProperty(o,"__esModule",{value:!0}),o.McGiWorldDrawSelect=o.McGiWorldDraw=o.McGiWorldDrawType=void 0;var u,M,I=T("three"),H=T("../MxThreeJS"),G=T("../MxManager"),L=T("three.meshline"),y=T("../MxFun");(M=u||(o.McGiWorldDrawType=u={}))[M.kWorldDraw=1]="kWorldDraw",M[M.kDynDragDraw=2]="kDynDragDraw",M[M.kSelectDraw=3]="kSelectDraw";var D=(C.prototype.getType=function(){return this.worldDrawType},C.prototype.setXData=function(S){this.xData=S},C.prototype.setMatrix=function(S){this.matrix=S},C.prototype.getMatrix=function(){return this.matrix},C.prototype.setOpacity=function(S){this.opacity=S},C.prototype.getOpacity=function(){return this.opacity},C.prototype.setColor=function(S){S=y.MxFun.getNumberColor(S),this.iColor!=S&&(this.widthMaterial=null),this.iColor=S},C.prototype.setDash=function(S,q){this.dDashArray=S,this.dDashRatio=q},C.prototype.getDash=function(){return{dDashArray:this.dDashArray,dDashRatio:this.dDashRatio}},C.prototype.setDashLineDisplay=function(S){S?(this.dDashArray=.03,this.dDashRatio=.1,this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0)):(this.dDashArray=0,this.dDashRatio=0)},C.prototype.isDashLineDisplay=function(){return 0<this.dDashArray&&0<this.dDashRatio},C.prototype.getColor=function(){return this.iColor},C.prototype.setRenderOrder=function(S){this.iRenderOrder=S},C.prototype.getRenderOrder=function(){return this.iRenderOrder},C.prototype.setLineWidthByPixels=function(S){this.lineWidthByPixels!=S&&(this.widthMaterial=null),this.lineWidthByPixels=S},C.prototype.getLineWidthByPixels=function(){return this.lineWidthByPixels},C.prototype.setLineWidth=function(S){this.dLineWidth!=S&&(this.widthMaterial=null),this.dLineWidth=S},C.prototype.getLineWidth=function(){return this.dLineWidth},C.prototype.drawEntity=function(S){var q=this.iRenderOrder;S.type=="Group"?S.traverse(function(W){W.type!="Group"&&(W.renderOrder=q)}):S.renderOrder=q,this.matrix!=null&&S.applyMatrix4(this.matrix),this.aryEntity.push(S),this.xData&&(S.MxWordDrawXData=this.xData,this.xData=null)},C.prototype.getEntitys=function(){return this.aryEntity},C.prototype.getMxObject=function(){return this.mxObj},C.prototype.createWidthMaterial=function(){this.widthMaterial==null&&(0<this.dDashArray&&0<this.dDashRatio?this.widthMaterial=new L.MeshLineMaterial({useMap:!1,color:this.iColor,opacity:1,resolution:new I.Vector2(this.mxObj.getViewWidth(),this.mxObj.getViewHeight()),sizeAttenuation:!this.lineWidthByPixels,lineWidth:this.dLineWidth,transparent:!0,depthTest:!1,dashArray:this.dDashArray,dashRatio:this.dDashRatio}):this.widthMaterial=new L.MeshLineMaterial({useMap:!1,color:this.iColor,opacity:1,resolution:new I.Vector2(this.mxObj.getViewWidth(),this.mxObj.getViewHeight()),sizeAttenuation:!this.lineWidthByPixels,lineWidth:this.dLineWidth,transparent:!0,depthTest:!1}))},C.prototype.drawSolid=function(S){if(!(S.length<3)){var q=new I.Shape(S.map(function(R){var v=R.x,V=R.y;return new I.Vector2(v,V)})),W=new I.ShapeGeometry(q),_=new I.Mesh(W,new I.MeshPhongMaterial({color:this.getColor(),side:I.DoubleSide,transparent:!0,opacity:this.getOpacity()}));this.drawEntity(_)}},C.prototype.drawLines=function(S){if(!(S.length<2))if(this.dLineWidth!=0){this.createWidthMaterial();var q=new I.Geometry;q.vertices=S;var W=new L.MeshLine;W.setGeometry(q);var _=new I.Mesh(W.geometry,this.widthMaterial);this.drawEntity(_),this.drawEntity(H.MxThreeJS.createLines(S.slice(0),this.iColor,0))}else this.drawEntity(H.MxThreeJS.createLines(S.slice(0),this.iColor,this.opacity))},C.prototype.drawGeometryLines=function(S){if(!(S.vertices.length<2))if(this.dLineWidth!=0){this.createWidthMaterial();var q=new L.MeshLine;if(!(S instanceof I.Geometry)){var W=new I.Geometry;W.vertices=S.vertices,S=W}q.setGeometry(S);var _=new I.Mesh(q.geometry,this.widthMaterial);this.drawEntity(_);var R=new I.LineBasicMaterial({color:this.iColor,transparent:!0,depthTest:!1,opacity:0}),v=new I.Line(S,R);this.drawEntity(v)}else R=void 0,R=this.opacity&&this.opacity!=1||this.opacity==0?new I.LineBasicMaterial({color:this.iColor,transparent:!0,depthTest:!1,opacity:this.opacity}):new I.LineBasicMaterial({color:this.iColor,transparent:!0,depthTest:!1}),v=new I.Line(S,R),this.drawEntity(v)},C.prototype.drawSelectLine=function(S,q,W,_){S instanceof Object&&q instanceof Object?this.drawEntity(H.MxThreeJS.createLine(S,q,this.iColor,0)):typeof S=="number"&&typeof q=="number"&&this.drawEntity(H.MxThreeJS.createLine(new I.Vector3(S,q,0),new I.Vector3(W,_,0),this.iColor,0))},C.prototype.drawLine=function(S,q,W,_){var R,v;if(S instanceof Object&&q instanceof Object?(R=S,v=q):typeof S=="number"&&typeof q=="number"&&(R=new I.Vector3(S,q,0),v=new I.Vector3(W,_,0)),this.dLineWidth!=0){this.createWidthMaterial();var V=new Float32Array(6);V[0]=R.x,V[1]=R.y,V[2]=0,V[3]=v.x,V[4]=v.y,V[5]=0;var Y=new L.MeshLine;Y.setGeometry(V);var c=new I.Mesh(Y.geometry,this.widthMaterial);c.renderOrder=this.iRenderOrder,this.drawEntity(c),this.drawSelectLine(R,v)}else this.drawEntity(H.MxThreeJS.createLine(R,v,this.iColor,this.opacity))},C.prototype.drawCircle=function(S,q){this.drawEntity(H.MxThreeJS.createCircle(S,q,this.iColor))},C.prototype.drawText=function(S,q,W,_,R,v){var V=H.MxThreeJS.creatTextSprite(S,_,q,W,this.iColor,R,v);return this.drawEntity(V),V},C.prototype.setupForEntity=function(S){this.iColor=y.MxFun.getNumberColor(S.getColor()),this.iRenderOrder=S.getRenderOrder(),this.opacity=S.opacity,this.dLineWidth=S.getLineWidth(),this.lineWidthByPixels=S.getLineWidthByPixels(),this.dDashArray=S.getDash().dDashArray,this.dDashRatio=S.getDash().dDashRatio},C);function C(S,q){this.aryEntity=[],this.iColor=16777215,this.dLineWidth=0,this.lineWidthByPixels=!0,this.iRenderOrder=G.MxData.iMxEntityRenderOrder,this.worldDrawType=1,this.widthMaterial=null,this.dDashArray=0,this.dDashRatio=0,this.matrix=null,this.opacity=1,this.xData=null,this.mxObj=S,this.worldDrawType=q}o.McGiWorldDraw=D;var B,z=(x(A,B=D),A.prototype.setSmallCoordDraw=function(S){this.isSmallCorrdDraw=S},A.prototype.setCurEntityId=function(S){this.curEntityId=S},A.prototype.drawEntity=function(S){},A.prototype.drawText=function(S,q,W,_,R,v){return null},A.prototype.drawSelectLine=function(S,q,W,_){},A.prototype.isValid=function(){return this.curEntityId!=0||(console.log("this.curEntityId == 0"),!1)},A.prototype.drawLine=function(S,q,W,_){var R,v;this.isValid()&&(S instanceof Object&&q instanceof Object?(R=S,v=q):typeof S=="number"&&typeof q=="number"&&(R=new I.Vector3(S,q,0),v=new I.Vector3(W,_,0)),this.selectManager.addLineDisplay(this.curEntityId,R,v,this.isSmallCorrdDraw))},A.prototype.drawCircle=function(S,q){this.isValid()&&this.selectManager.addCircleDisplay(this.curEntityId,S,q,this.isSmallCorrdDraw)},A.prototype.drawLines=function(S){if(!(S.length<2))for(var q=S.length,W=0;W<q-1;W++)this.selectManager.addLineDisplay(this.curEntityId,S[W],S[W+1],this.isSmallCorrdDraw)},A);function A(S,q){var W=B.call(this,S,u.kSelectDraw)||this;return W.isSmallCorrdDraw=!1,W.selectManager=q,W.curEntityId=0,W.isSmallCorrdDraw=!1,W}o.McGiWorldDrawSelect=z},{"../MxFun":27,"../MxManager":29,"../MxThreeJS":37,three:19,"three.meshline":18}],45:[function(T,r,o){var a,x=this&&this.__extends||(a=function(V,Y){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,p){c.__proto__=p}||function(c,p){for(var m in p)Object.prototype.hasOwnProperty.call(p,m)&&(c[m]=p[m])})(V,Y)},function(V,Y){if(typeof Y!="function"&&Y!==null)throw new TypeError("Class extends value "+String(Y)+" is not a constructor or null");function c(){this.constructor=V}a(V,Y),V.prototype=Y===null?Object.create(Y):(c.prototype=Y.prototype,new c)});Object.defineProperty(o,"__esModule",{value:!0}),o.MrxDbgUiPrBase=o.MrxDbgUiPrBase_Return=o.McEdGetPointWorldDrawObject=o.McEdGetPointWorldDraw=void 0;var u=T("three"),M=T("./MxJig"),I=T("./MxJigCmdManager"),H=T("../MxThreeJS"),G=T("../UI/MxUiVue"),L=T("../MxString"),y=T("./McGiWorldDraw"),D=T("../MxManager"),C=(B.prototype.setMcEdJig=function(V){this.m_pJig=V},B.prototype.getMcEdJig=function(){return this.m_pJig},B.prototype.setColor=function(V){this.m_iColor=V},B.prototype.getColor=function(){return this.m_iColor},B.prototype.getDrawColor=function(){return this.m_pJig.getMxObject().automaticInversionColor(this.m_iColor)},B.prototype.drawLine=function(V,Y){this.m_pJig.drawEntity(H.MxThreeJS.createLine(V,Y,this.getDrawColor()))},B.prototype.drawRect=function(V,Y){var c=new u.Vector3(V.x,Y.y,0),p=new u.Vector3(Y.x,V.y,0);this.drawLine(V,c),this.drawLine(c,Y),this.drawLine(Y,p),this.drawLine(p,V)},B.prototype.drawMcDbEntity=function(V,Y){this.m_pJig.drawMcDbEntity(V,Y?0:this.getDrawColor(),Y)},B.prototype.drawMcDbLine=function(V,Y,c,p,m,f){this.m_pJig.drawMcDbLine(V,Y,c,p,m,f,this.getDrawColor())},B.prototype.drawCircle=function(V,Y){this.m_pJig.drawEntity(H.MxThreeJS.createCircle(V,Y,this.getDrawColor()))},B.prototype.drawEntity=function(V,Y,c){c===void 0&&(c=!1),this.m_pJig.drawEntity(V,Y,c)},B.prototype.drawText=function(V,Y,c,p){var m=H.MxThreeJS.creatTextSprite(V,p,Y,c,this.getDrawColor());this.drawEntity(m)},B.prototype.drawSolid=function(V,Y){var c=H.MxThreeJS.createSolid(V,this.getDrawColor(),Y);c&&this.drawEntity(c)},B.prototype.drawCustomEntity=function(V,Y){var c=new y.McGiWorldDraw(this.m_pJig.getMxObject(),y.McGiWorldDrawType.kDynDragDraw);c.setupForEntity(V),V.worldDraw(c);for(var p=c.getEntitys(),m=p.length,f=0;f<m;f++)this.drawEntity(p[f],Y,V.isUseSmallcoordDisplay())},B);function B(){this.m_pJig=null,this.m_iColor=16777215}o.McEdGetPointWorldDraw=C;var z,A,S,q=(x(W,z=C),W.prototype.setDraw=function(V){this.m_callDraw=V},W.prototype.worldDraw=function(V){this.m_callDraw!=null&&this.m_callDraw(V,this)},W);function W(){var V=z!==null&&z.apply(this,arguments)||this;return V.m_callDraw=void 0,V}o.McEdGetPointWorldDrawObject=q,(S=A||(o.MrxDbgUiPrBase_Return=A={}))[S.kCancel=-2]="kCancel",S[S.kNone=-1]="kNone",S[S.kOk=0]="kOk",S[S.kKeyWord=1]="kKeyWord";var _,R=(x(v,_=M.McEdJigCommand),v.prototype.procInKeyword=function(V){V.status>=I.MxJigCmdManager.DragStatus.kKW1&&0<V.sKeyValue.length?this.m_keyWordPicked=V.sKeyValue.toUpperCase():this.m_keyWordPicked=""},v.prototype.getReturnStatus=function(V){switch(V){case I.MxJigCmdManager.DragStatus.kNoChange:return A.kNone;case I.MxJigCmdManager.DragStatus.kCancel:return A.kCancel;case I.MxJigCmdManager.DragStatus.kNull:return A.kNone;case I.MxJigCmdManager.DragStatus.kNormal:return A.kOk}return 1<=V?A.kKeyWord:A.kCancel},v.prototype.SetLASTPOINT=function(V){var Y=this._mxObject;if((Y=Y||D.MxManager.currentMx()).sysVariable().setSysVarPoint("LASTPOINT",V),V){var c=Y.sysVariable().getSysVarNumber("GETPOINTSTATUS");c|=I.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint,Y.sysVariable().setSysVarNumber("GETPOINTSTATUS",c)}else c=Y.sysVariable().getSysVarNumber("GETPOINTSTATUS"),c&=~I.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint,Y.sysVariable().setSysVarNumber("GETPOINTSTATUS",c)},v.prototype.clearLastInputPoint=function(){this._mxObject||(this._mxObject=D.MxManager.currentMx()),this.SetLASTPOINT(void 0)},v.prototype.setCursorType=function(V){this.m_cursorType=V},v.prototype.getCursorType=function(){return this.m_cursorType},v.prototype.setInputToucheType=function(V){this.m_toucheType=V},v.prototype.getInputToucheType=function(){return this.m_toucheType},v.prototype.keyWords=function(){return this.m_keyWords},v.prototype.setKeyWords=function(V){this.m_keyWords=V},v.prototype.message=function(){return this.m_message},v.prototype.setMessage=function(V){this.m_message=V},v.prototype.keyWordPicked=function(){return this.m_keyWordPicked},v.prototype.isKeyWordPicked=function(V){return V=V.toUpperCase(),this.m_keyWordPicked==V},v.prototype.setUserDraw=function(V){V.setMcEdJig(this),this.m_pWorldDraw=V},v.prototype.printMessage=function(){var V=new L.MxString(this.m_message);V.TrimRight(":"),1<this.m_keyWords.length&&this.m_keyWords[0]=="["&&this.m_keyWords[this.m_keyWords.length-1]=="]"?V.m_val.indexOf(`
`)==-1?G.MxUiVue.acutPrintf(`
`+V.m_val+" 或"+this.m_keyWords+":"):G.MxUiVue.acutPrintf(V.m_val+" 或"+this.m_keyWords+":"):V.m_val.indexOf(`
`)==-1?G.MxUiVue.acutPrintf(`
`+V.m_val+":"):G.MxUiVue.acutPrintf(V.m_val+":")},v);function v(){var V=_!==null&&_.apply(this,arguments)||this;return V.m_keyWords="",V.m_message="",V.m_keyWordPicked="",V.m_pWorldDraw=null,V.m_toucheType=I.MxJigCmdManager.InType.kGetBegan,V.m_cursorType=G.MxUiVue.CursorType.kNormal,V}o.MrxDbgUiPrBase=R},{"../MxManager":29,"../MxString":34,"../MxThreeJS":37,"../UI/MxUiVue":65,"./McGiWorldDraw":44,"./MxJig":53,"./MxJigCmdManager":54,three:19}],46:[function(T,r,o){var a,x=this&&this.__extends||(a=function(m,f){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,P){N.__proto__=P}||function(N,P){for(var O in P)Object.prototype.hasOwnProperty.call(P,O)&&(N[O]=P[O])})(m,f)},function(m,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function N(){this.constructor=m}a(m,f),m.prototype=f===null?Object.create(f):(N.prototype=f.prototype,new N)});Object.defineProperty(o,"__esModule",{value:!0}),o.MrxDbgUiPrAngle=o.MrxDbgUiPrKeyWord=o.MrxDbgUiPrString=o.MrxDbgUiPrInt=o.MrxDbgUiPrDist=void 0;var u,M=T("three"),I=T("./MxJigCmdManager"),H=T("../MxFun"),G=T("./MrxDbgUiPrBase"),L=T("../UI/MxUiVue"),y=T("../MxThreeJS"),D=T("../MxString"),C=(x(B,u=G.MrxDbgUiPrBase),B.prototype.value=function(){return this.m_value},B.prototype.basePt=function(){return new M.Vector3(this.m_basePt.x,this.m_basePt.y,0)},B.prototype.setBasePt=function(m){this.m_basePt==null?this.m_basePt=new M.Vector3(m.x,m.y,0):(this.m_basePt.x=m.x,this.m_basePt.y=m.y),this.m_useBasePt=!0},B.prototype.setUseBasePt=function(m){this.m_useBasePt=m},B.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null,this.clearLastInputPoint(),this.getDynImput().setGetNumber(!0),this.m_useBasePt&&this.SetLASTPOINT(this.m_basePt)},B.prototype.go=function(m){this.initGo(),this.m_retcall=m,this.m_previousInPoint=null,this.m_currentInPoint=null,this.m_value=0,I.MxJigCmdManager.runCmd(this)},B.prototype.onExitCommand=function(){var m=this;L.MxUiVue.setCursorType(L.MxUiVue.CursorType.kNormal);var f=!1;this.m_retcall!=null&&(I.MxJigCmdManager.setRunCmdEvent(function(){u.prototype.onExitCommand.call(m,!1),f=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),I.MxJigCmdManager.setRunCmdEvent(void 0)),!f&&I.MxJigCmdManager.isWaitCmdNull()&&L.MxUiVue.restoreCmdStatus(),f||u.prototype.onExitCommand.call(this,!0)},B.prototype.onStartCommand=function(){L.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),I.MxJigCmdManager.setKeywordList(this.keyWords()),u.prototype.onStartCommand.call(this)},B.prototype.sampler=function(){var m,f=I.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);return f.status==I.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new M.Vector3(f.pt.x,f.pt.y,0):(this.m_currSamplerPoint.x=f.pt.x,this.m_currSamplerPoint.y=f.pt.y)),m=this.m_useBasePt?this.acquireDist(this.m_toucheType,this.m_basePt):this.acquireDist(this.m_toucheType,this.m_currentInPoint),this.procInKeyword(m),m.status==I.MxJigCmdManager.DragStatus.kNormal?(this.m_value=m.dist,m.status):m.status==I.MxJigCmdManager.DragStatus.kKW1?m.status:this.m_useBasePt||this.m_currentInPoint?f.status:((m=this.acquirePoint(this.m_toucheType,!1)).status==I.MxJigCmdManager.DragStatus.kNormal&&m.exit&&(this.m_previousInPoint==null?this.m_previousInPoint=new M.Vector3(m.pt.x,m.pt.y,0):(this.m_previousInPoint.x=m.pt.x,this.m_previousInPoint.y=m.pt.y)),m.status)},B.prototype.done=function(m){if(this.m_retcall!=null)return this.m_resultDragStatus=m,this.m_useBasePt||m!=I.MxJigCmdManager.DragStatus.kNormal||!this.m_previousInPoint||this.m_currentInPoint?I.MxJigCmdManager.DoneStatius.kExitCommand:(this.m_currentInPoint=this.m_previousInPoint,this.m_previousInPoint=null,I.MxJigCmdManager.DoneStatius.kContinueCommand);H.MxFun.Assert(0)},B.prototype.upDisplay=function(){this.m_currSamplerPoint&&(this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint)),this.m_useBasePt&&this.m_basePt?this.drawEntity(y.MxThreeJS.createLine(this.m_currSamplerPoint,this.m_basePt,16777215)):this.m_currentInPoint&&this.drawEntity(y.MxThreeJS.createLine(this.m_currSamplerPoint,this.m_currentInPoint,16777215)))},B);function B(){var m=u.call(this)||this;return m.m_useBasePt=!1,m.m_basePt=null,m.m_previousInPoint=null,m.m_currentInPoint=null,m.m_value=0,m.m_currSamplerPoint=null,m.m_retcall=null,m.m_resultDragStatus=I.MxJigCmdManager.DragStatus.kCancel,m.m_cursorType=L.MxUiVue.CursorType.kCross,m}o.MrxDbgUiPrDist=C;var z,A=(x(S,z=G.MrxDbgUiPrBase),S.prototype.value=function(){return this.m_value},S.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null,this.clearLastInputPoint()},S.prototype.go=function(m){this.initGo(),this.m_retcall=m,this.m_value=0,this.m_currSamplerPoint=null,this.getDynImput().setGetNumber(!0),I.MxJigCmdManager.runCmd(this)},S.prototype.onExitCommand=function(){var m=this;L.MxUiVue.setCursorType(L.MxUiVue.CursorType.kNormal);var f=!1;this.m_retcall!=null&&(I.MxJigCmdManager.setRunCmdEvent(function(){z.prototype.onExitCommand.call(m,!1),f=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),I.MxJigCmdManager.setRunCmdEvent(void 0)),!f&&I.MxJigCmdManager.isWaitCmdNull()&&L.MxUiVue.restoreCmdStatus(),f||z.prototype.onExitCommand.call(this,!0)},S.prototype.onStartCommand=function(){L.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),I.MxJigCmdManager.setKeywordList(this.keyWords()),z.prototype.onStartCommand.call(this)},S.prototype.sampler=function(){var m=I.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);m.status==I.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new M.Vector3(m.pt.x,m.pt.y,0):(this.m_currSamplerPoint.x=m.pt.x,this.m_currSamplerPoint.y=m.pt.y));var f=this.acquireInt();return this.procInKeyword(f),f.status==I.MxJigCmdManager.DragStatus.kNormal?this.m_value=f.iVal:(f.status,I.MxJigCmdManager.DragStatus.kKW1),f.status},S.prototype.done=function(m){if(this.m_retcall!=null)return this.m_resultDragStatus=m,I.MxJigCmdManager.DoneStatius.kExitCommand;H.MxFun.Assert(0)},S.prototype.upDisplay=function(){this.m_currSamplerPoint&&this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint))},S);function S(){var m=z.call(this)||this;return m.m_value=0,m.m_currSamplerPoint=null,m.m_retcall=null,m.m_resultDragStatus=I.MxJigCmdManager.DragStatus.kCancel,m.m_cursorType=L.MxUiVue.CursorType.kNormal,m.setDynamicInputType(I.MxJigCmdManager.DynamicInputType.kNoInput),m}o.MrxDbgUiPrInt=A;var q,W=(x(_,q=G.MrxDbgUiPrBase),_.prototype.value=function(){return this.m_value},_.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null},_.prototype.go=function(m){this.initGo(),this.m_retcall=m,this.m_value="",this.m_currSamplerPoint=null,I.MxJigCmdManager.runCmd(this)},_.prototype.onExitCommand=function(){var m=this;L.MxUiVue.setCursorType(L.MxUiVue.CursorType.kNormal);var f=!1;this.m_retcall!=null&&(I.MxJigCmdManager.setRunCmdEvent(function(){q.prototype.onExitCommand.call(m,!1),f=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),I.MxJigCmdManager.setRunCmdEvent(void 0)),!f&&I.MxJigCmdManager.isWaitCmdNull()&&L.MxUiVue.restoreCmdStatus(),f||q.prototype.onExitCommand.call(this,!0)},_.prototype.onStartCommand=function(){L.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),I.MxJigCmdManager.setKeywordList(this.keyWords()),q.prototype.onStartCommand.call(this)},_.prototype.sampler=function(){var m=I.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);m.status==I.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new M.Vector3(m.pt.x,m.pt.y,0):(this.m_currSamplerPoint.x=m.pt.x,this.m_currSamplerPoint.y=m.pt.y));var f=this.acquireString();return this.procInKeyword(f),f.status==I.MxJigCmdManager.DragStatus.kNormal?this.m_value=f.sValue:(f.status,I.MxJigCmdManager.DragStatus.kKW1),f.status},_.prototype.done=function(m){if(this.m_retcall!=null)return this.m_resultDragStatus=m,I.MxJigCmdManager.DoneStatius.kExitCommand;H.MxFun.Assert(0)},_.prototype.upDisplay=function(){this.m_currSamplerPoint&&this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint))},_);function _(){var m=q.call(this)||this;return m.m_value="",m.m_currSamplerPoint=null,m.m_retcall=null,m.m_resultDragStatus=I.MxJigCmdManager.DragStatus.kCancel,m.m_cursorType=L.MxUiVue.CursorType.kCross,m}o.MrxDbgUiPrString=W;var R,v=(x(V,R=G.MrxDbgUiPrBase),V.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null},V.prototype.printMessage=function(){var m=new D.MxString(this.m_message);m.TrimRight(":"),1<this.m_keyWords.length&&this.m_keyWords[0]=="["&&this.m_keyWords[this.m_keyWords.length-1]=="]"?m.m_val.indexOf(`
`)==-1?L.MxUiVue.acutPrintf(`
`+m.m_val+" "+this.m_keyWords+":"):L.MxUiVue.acutPrintf(m.m_val+" "+this.m_keyWords+":"):m.m_val.indexOf(`
`)==-1?L.MxUiVue.acutPrintf(`
`+m.m_val+":"):L.MxUiVue.acutPrintf(m.m_val+":")},V.prototype.go=function(m){this.initGo(),this.m_retcall=m,this.m_currSamplerPoint=null,I.MxJigCmdManager.runCmd(this)},V.prototype.onExitCommand=function(){var m=this;L.MxUiVue.setCursorType(L.MxUiVue.CursorType.kNormal);var f=!1;this.m_retcall!=null&&(I.MxJigCmdManager.setRunCmdEvent(function(){R.prototype.onExitCommand.call(m,!1),f=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),I.MxJigCmdManager.setRunCmdEvent(void 0)),!f&&I.MxJigCmdManager.isWaitCmdNull()&&L.MxUiVue.restoreCmdStatus(),f||R.prototype.onExitCommand.call(this,!0)},V.prototype.onStartCommand=function(){L.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),I.MxJigCmdManager.setKeywordList(this.keyWords()),R.prototype.onStartCommand.call(this)},V.prototype.sampler=function(){var m=I.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);m.status==I.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new M.Vector3(m.pt.x,m.pt.y,0):(this.m_currSamplerPoint.x=m.pt.x,this.m_currSamplerPoint.y=m.pt.y));var f=this.acquireKeyword();return this.procInKeyword(f),f.status,I.MxJigCmdManager.DragStatus.kKW1,f.status},V.prototype.done=function(m){if(this.m_retcall!=null)return m>=I.MxJigCmdManager.DragStatus.kKW1&&(m=I.MxJigCmdManager.DragStatus.kNormal),this.m_resultDragStatus=m,I.MxJigCmdManager.DoneStatius.kExitCommand;H.MxFun.Assert(0)},V.prototype.upDisplay=function(){this.m_currSamplerPoint&&this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint))},V);function V(){var m=R.call(this)||this;return m.m_currSamplerPoint=null,m.m_retcall=null,m.m_resultDragStatus=I.MxJigCmdManager.DragStatus.kCancel,m.m_cursorType=L.MxUiVue.CursorType.kCross,m.setUserInputControls(0),m.setDisableDynInput(!0),m}o.MrxDbgUiPrKeyWord=v;var Y,c=(x(p,Y=G.MrxDbgUiPrBase),p.prototype.value=function(){return this.m_value},p.prototype.basePt=function(){return new M.Vector3(this.m_basePt.x,this.m_basePt.y,0)},p.prototype.setBasePt=function(m){this.m_basePt==null?this.m_basePt=new M.Vector3(m.x,m.y,0):(this.m_basePt.x=m.x,this.m_basePt.y=m.y),this.m_useBasePt=!0},p.prototype.setUseBasePt=function(m){this.m_useBasePt=m},p.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null,this.getDynImput().setGetNumber(!0),this.clearLastInputPoint(),this.m_useBasePt&&this.SetLASTPOINT(this.m_basePt)},p.prototype.go=function(m){this.initGo(),this.m_retcall=m,this.m_previousInPoint=null,this.m_currentInPoint=null,this.m_value=0,I.MxJigCmdManager.runCmd(this)},p.prototype.onExitCommand=function(){var m=this;L.MxUiVue.setCursorType(L.MxUiVue.CursorType.kNormal);var f=!1;this.m_retcall!=null&&(I.MxJigCmdManager.setRunCmdEvent(function(){Y.prototype.onExitCommand.call(m,!1),f=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),I.MxJigCmdManager.setRunCmdEvent(void 0)),!f&&I.MxJigCmdManager.isWaitCmdNull()&&L.MxUiVue.restoreCmdStatus(),f||Y.prototype.onExitCommand.call(this,!0)},p.prototype.onStartCommand=function(){L.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),I.MxJigCmdManager.setKeywordList(this.keyWords()),Y.prototype.onStartCommand.call(this)},p.prototype.sampler=function(){var m,f=I.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);return f.status==I.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new M.Vector3(f.pt.x,f.pt.y,0):(this.m_currSamplerPoint.x=f.pt.x,this.m_currSamplerPoint.y=f.pt.y)),m=this.m_useBasePt?this.acquireAngle(this.m_toucheType,this.m_basePt):this.acquireAngle(this.m_toucheType,this.m_currentInPoint),this.procInKeyword(m),m.status==I.MxJigCmdManager.DragStatus.kNormal?(this.m_value=m.ang,m.status):m.status==I.MxJigCmdManager.DragStatus.kKW1?m.status:this.m_useBasePt||this.m_currentInPoint?f.status:((m=this.acquirePoint(this.m_toucheType,!1)).status==I.MxJigCmdManager.DragStatus.kNormal&&m.exit&&(this.m_previousInPoint==null?this.m_previousInPoint=new M.Vector3(m.pt.x,m.pt.y,0):(this.m_previousInPoint.x=m.pt.x,this.m_previousInPoint.y=m.pt.y)),m.status)},p.prototype.done=function(m){if(this.m_retcall!=null)return this.m_resultDragStatus=m,this.m_useBasePt||m!=I.MxJigCmdManager.DragStatus.kNormal||!this.m_previousInPoint||this.m_currentInPoint?I.MxJigCmdManager.DoneStatius.kExitCommand:(this.m_currentInPoint=this.m_previousInPoint,this.m_previousInPoint=null,I.MxJigCmdManager.DoneStatius.kContinueCommand);H.MxFun.Assert(0)},p.prototype.upDisplay=function(){this.m_currSamplerPoint&&(this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint)),this.m_useBasePt&&this.m_basePt?this.drawEntity(y.MxThreeJS.createLine(this.m_currSamplerPoint,this.m_basePt,16777215)):this.m_currentInPoint&&this.drawEntity(y.MxThreeJS.createLine(this.m_currSamplerPoint,this.m_currentInPoint,16777215)))},p);function p(){var m=Y.call(this)||this;return m.m_useBasePt=!1,m.m_basePt=null,m.m_previousInPoint=null,m.m_currentInPoint=null,m.m_value=0,m.m_currSamplerPoint=null,m.m_retcall=null,m.m_resultDragStatus=I.MxJigCmdManager.DragStatus.kCancel,m.m_cursorType=L.MxUiVue.CursorType.kCross,m}o.MrxDbgUiPrAngle=c},{"../MxFun":27,"../MxString":34,"../MxThreeJS":37,"../UI/MxUiVue":65,"./MrxDbgUiPrBase":45,"./MxJigCmdManager":54,three:19}],47:[function(T,r,o){var a,x=this&&this.__extends||(a=function(z,A){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,q){S.__proto__=q}||function(S,q){for(var W in q)Object.prototype.hasOwnProperty.call(q,W)&&(S[W]=q[W])})(z,A)},function(z,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function S(){this.constructor=z}a(z,A),z.prototype=A===null?Object.create(A):(S.prototype=A.prototype,new S)});Object.defineProperty(o,"__esModule",{value:!0}),o.MrxDbgUiPrPoint=void 0;var u,M=T("three"),I=T("./MxJigCmdManager"),H=T("../MxFun"),G=T("./MrxDbgUiPrBase"),L=T("../UI/MxUiVue"),y=T("../MxThreeJS"),D=T("../MxManager"),C=(x(B,u=G.MrxDbgUiPrBase),B.prototype.value=function(){return new M.Vector3(this.m_value.x,this.m_value.y,0)},B.prototype.getCADValue=function(){return D.MxManager.getMxCpp().newMcGePoint3d(new M.Vector3(this.m_value.x,this.m_value.y,0))},B.prototype.basePt=function(){return new M.Vector3(this.m_basePt.x,this.m_basePt.y,0)},B.prototype.setBasePt=function(z){this.m_basePt==null?this.m_basePt=new M.Vector3(z.x,z.y,0):(this.m_basePt.x=z.x,this.m_basePt.y=z.y),this.m_useBasePt=!0},B.prototype.setUseBasePt=function(z){this.m_useBasePt=z},B.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null,this.m_retWhileCall=null,this.m_exitCall=null,this.m_useBasePt&&this.SetLASTPOINT(this.m_basePt)},B.prototype.go=function(z){this.initGo(),this.m_retcall=z,I.MxJigCmdManager.runCmd(this)},B.prototype.goWhile=function(z,A){this.initGo(),this.m_retWhileCall=z,A&&(this.m_exitCall=A),I.MxJigCmdManager.runCmd(this)},B.prototype.onExitCommand=function(){var z=this;L.MxUiVue.setCursorType(L.MxUiVue.CursorType.kNormal);var A=!1;this.m_retcall!=null&&(I.MxJigCmdManager.setRunCmdEvent(function(){u.prototype.onExitCommand.call(z,!1),A=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),I.MxJigCmdManager.setRunCmdEvent(void 0)),!A&&I.MxJigCmdManager.isWaitCmdNull()&&L.MxUiVue.restoreCmdStatus(),A||u.prototype.onExitCommand.call(this,!0)},B.prototype.onStartCommand=function(){L.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),I.MxJigCmdManager.setKeywordList(this.keyWords()),this.m_useBasePt&&this.SetLASTPOINT(this.m_basePt),u.prototype.onStartCommand.call(this)},B.prototype.sampler=function(){var z=this.acquirePoint(this.m_toucheType);return this.procInKeyword(z),z.status==I.MxJigCmdManager.DragStatus.kNormal&&(this.m_value==null?this.m_value=new M.Vector3(z.pt.x,z.pt.y,0):(this.m_value.x=z.pt.x,this.m_value.y=z.pt.y)),z.status},B.prototype.done=function(z){if(this.m_retcall!=null)return this.m_resultDragStatus=z,this.m_exitCall&&this.m_exitCall(this.getReturnStatus(this.m_resultDragStatus)),I.MxJigCmdManager.DoneStatius.kExitCommand;if(this.m_retWhileCall!=null){if((this.m_resultDragStatus=z)==I.MxJigCmdManager.DragStatus.kCancel)return this.m_exitCall&&this.m_exitCall(this.getReturnStatus(this.m_resultDragStatus)),I.MxJigCmdManager.DoneStatius.kExitCommand;var A=!1;z==I.MxJigCmdManager.DragStatus.kNull&&(A=!0);var S=this.m_retWhileCall(this.getReturnStatus(this.m_resultDragStatus));return S!=null&&S.exit!=null&&(A=S.exit),A?(this.m_exitCall&&this.m_exitCall(this.getReturnStatus(this.m_resultDragStatus)),I.MxJigCmdManager.DoneStatius.kExitCommand):(I.MxJigCmdManager.setKeywordList(this.keyWords()),this.printMessage(),I.MxJigCmdManager.DoneStatius.kContinueCommand)}H.MxFun.Assert(0)},B.prototype.upDisplay=function(){if(this.m_value&&(this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(0,this.m_value),this.m_pWorldDraw.worldDraw(this.m_value)),this.m_useBasePt&&this.m_basePt)){var z=16777215;this._mxObject.isWhiteViewColor()&&(z=0);var A=this._mxObject;this.drawEntity(y.MxThreeJS.createLine(A.toSmallcoord(this.m_value),A.toSmallcoord(this.m_basePt),z),void 0,!0)}},B);function B(){var z=u.call(this)||this;return z.m_useBasePt=!1,z.m_basePt=null,z.m_value=null,z.m_retcall=null,z.m_retWhileCall=null,z.m_exitCall=null,z.m_resultDragStatus=I.MxJigCmdManager.DragStatus.kCancel,z.m_cursorType=L.MxUiVue.CursorType.kCross,z}o.MrxDbgUiPrPoint=C},{"../MxFun":27,"../MxManager":29,"../MxThreeJS":37,"../UI/MxUiVue":65,"./MrxDbgUiPrBase":45,"./MxJigCmdManager":54,three:19}],48:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxCmdRunManager=void 0;var a,x,u,M,I,H,G,L,y,D=T("../MxFun"),C=T("../MxType"),B=T("./MxJigCmdManager"),z=T("../UI/MxUiVue"),A=T("../MxDrawData");x=a||(o.MxCmdRunManager=a={}),u={},M=new Array,I=0,H=!1,G="",L={},y={},x.InitQuickCommand=function(S){if(S)if(S instanceof Array)for(var q=S.length,W=0;W<q;W++){var _=S[W];if(!(_.length<2)){var R=_[0];if(R.length!=0)for(var v=_.length,V=1;V<v;V++)_[V].length!=0&&(L[_[V].toUpperCase()]=R)}}else console.log("Mx:QuickCommand data error,Not an array");else console.log("Mx:QuickCommand data error")},x.InitLanguageString=function(S){this.m_mapLanguageString=S},x.getLanguageString=function(S,q){var W=y[S];return W===void 0&&(W=q),W},x.MoveUpKey=function(){return H?++I>=M.length&&(I=0):H=!0,!0},x.MoveDownKey=function(){return!!H&&(--I<0&&(I=M.length-1),!0)},x.GetListCommad=function(){return I<0||I>=M.length?"":M[I]},x.ClearPrvCmd=function(){G=""},x.GetPrvCmd=function(){return G},x.SetPrvCmd=function(S){G=S},x.runCmd=function(S,q,W){var _=q.toUpperCase(),R=u[_];if(S&&R==null){var v=L[_];if(v!=null&&(R=u[v.toUpperCase()]),R==null)return z.MxUiVue.isNull()?console.log(D.MxFun.formatString('未知命令"{0}"',q)):z.MxUiVue.acutPrintf(`未知命令"{0}"。
命令:`,q),!1}if(!R)return!1;S.endPanCommand(),S.getTempMarkDraw().clear(!1);var V=M.indexOf(R.cmd);-1<V&&M.splice(V,1),H=!(I=0),M.push(R.cmd),!(R.flag&C.MxType.MxCommandFlag.MCRX_CMD_NO_RECORD_PRVCMD)&&(G=R.cmd);var Y=R.fun;S&&!(R.flag&C.MxType.MxCommandFlag.MCRX_CMD_TRANSPARENT)&&z.MxUiVue.acutPrintf(`{0}
`,R.cmd),B.MxJigCmdManager.stopCmd(B.MxJigCmdManager.DetailedResult.kNewCommadIn),S.callEvent("commandWillStart",{cmd:R.cmd}),S.getMcObject().fireStartRunCommand(R.cmd,R.flag);var c=S.sysVariable().getSysVarNumber("GETPOINTSTATUS");if(c&=~B.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint,c&=~B.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastMovePoint,S.sysVariable().setSysVarNumber("GETPOINTSTATUS",c),S&&!(R.flag&C.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT)){var p=!1,m=S.getMxAllSelect();if(S.getMxDatabase().getGripManager().removeAllGrips()&&(p=!0),S.getMxDatabase().getSelectManager().removeAllEntity()&&(p=!0),S.isValidMcObject()){var f=S.getMcObject().getGripManager().getAllSelect();S.getMcObject().getGripManager().setPrvCommandSelect(f),S.getMcObject().getGripManager().clearAll()&&(p=!0)}S.getMxDatabase().getSelectManager().setPrvCommandSelect(m),p&&(S.getMxDatabase().getGripManager().fireMxEntitySelectChange(),S.updateDisplay())}try{Y(W)}catch(N){console.log("mx: run cmd error"),console.log(N)}return S.getMcObject().fireEndRunCommand(R.cmd,R.flag),S&&(B.MxJigCmdManager.isRunning()||z.MxUiVue.restoreCmdStatus(),S.updateDisplay(),A.MxDrawData.m_isAutoResetRenderer||S.resetRenderer()),!0},x.addCommand=function(S,q,W){W==null&&(W=C.MxType.MxCommandFlag.MCRX_CMD_MODAL);var _=S.toUpperCase();u[_]={fun:q,cmd:S,flag:W}}},{"../MxDrawData":22,"../MxFun":27,"../MxType":39,"../UI/MxUiVue":65,"./MxJigCmdManager":54}],49:[function(T,r,o){var a,x=this&&this.__extends||(a=function(v,V){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Y,c){Y.__proto__=c}||function(Y,c){for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(Y[p]=c[p])})(v,V)},function(v,V){if(typeof V!="function"&&V!==null)throw new TypeError("Class extends value "+String(V)+" is not a constructor or null");function Y(){this.constructor=v}a(v,V),v.prototype=V===null?Object.create(V):(Y.prototype=V.prototype,new Y)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawObjectOsnap=o.McDbLine=o.McDbCurve=o.McDbEntity=o.McDbType=void 0;var u,M,I=T("three"),H=T("../MxThreeJS"),G=T("../MxDrawData"),L=T("./MxJigCmdManager"),y=T("./McEdJigOsnap");(M=u||(o.McDbType=u={}))[M.kInValid=0]="kInValid",M[M.kLine=1]="kLine";var D=(C.prototype.getType=function(){return this.m_type},C);function C(){this.m_type=u.kInValid}o.McDbEntity=D;var B,z=(x(A,B=D),A);function A(){return B!==null&&B.apply(this,arguments)||this}o.McDbCurve=z;var S,q=(x(W,S=z),W);function W(){var v=S.call(this)||this;return v.m_type=u.kLine,v}o.McDbLine=q;var _=(R.prototype.getBlobHead=function(v,V){var Y={};return Y.type=v.getInt32(V,!0),V+=4,Y.ver=v.getInt32(V,!0),V+=4,Y.databaseIndex=v.getInt32(V,!0),V+=4,Y.nOffset=V,Y},R.prototype.clearData=function(){this.threejsObjects=new I.Object3D},R.prototype.calculateDistance=function(v,V,Y){var c=new I.Vector3().subVectors(V,v),p=new I.Vector3().subVectors(Y,v),m=c.clone().normalize(),f=p.clone().normalize(),N=m.dot(f),P=new I.Vector3().subVectors(Y,V),O=new I.Vector3().subVectors(v,V),Z=P.clone().normalize(),te=O.clone().normalize();if(0<Z.dot(te)&&0<N){var de=Math.sqrt(1-N*N),me=v.distanceTo(Y),we=me*de,ge=me*N,Le=c.clone().normalize().multiplyScalar(ge),Pe=v.clone().add(Le),ae=c.clone().normalize().multiplyScalar(200+ge);return{pt1:v,pt2:V,pt:Y,distance:we,targetPt:Pe,warningPt:v.clone().add(ae)}}return null},R.prototype.getOsnapData=function(v,V){if(this.threejsObjects){var Y=new I.Raycaster,c=G.MxDrawData.m_dInputRectWidth;Y.linePrecision=this.mxObj.screenCoordLong2World(c);var p=this.mxObj.getCanvas(),m=p.clientWidth,f=p.clientHeight,N=this.mxObj.screenCoord2World(v.x,v.y);N.z=0,v=new I.Vector2(v.x/m*2-1,-v.y/f*2+1),Y.setFromCamera(v,this.mxObj.getCamera());var P=Y.intersectObjects(this.threejsObjects.children,!0),O=this.mxObj.getSysVarLong("OSMODE"),Z=new Map;if(P.length)for(var te=0;te<P.length;te++){var de=P[te];if(de.object.userData&&de.object.userData.obj.getType()==u.kLine){var me=de.object.userData.obj;if(O&y.MxOsnapDefine.OsModeEnd){var we=N.distanceTo(me.pt1);me.pt1.type=L.MxJigCmdManager.OsnapMode.kOsModeEnd,Z.set(we,me.pt1);var ge=N.distanceTo(me.pt2);me.pt2.type=L.MxJigCmdManager.OsnapMode.kOsModeEnd,Z.set(ge,me.pt2)}if(O&y.MxOsnapDefine.OsModeNear&&(!me.bulge||me.bulge==0)){var Le=this.calculateDistance(me.pt1,me.pt2,N);Le&&(Le.targetPt.type=L.MxJigCmdManager.OsnapMode.kOsModeNear,Z.set(Le.distance,Le.targetPt))}}}if(Z.size){var Pe=this.mxObj.screenCoordLong2World(c),ae=Array.from(Z);ae.sort(function(ve,Ie){return ve[0]-Ie[0]}),ae[0][0]<Pe&&V(ae[0][1],ae[0][1].type)}}},R.prototype.mxWebEntitysData=function(v,V){var Y=this.getBlobHead(v,0);v.getInt32(Y.nOffset,!0),Y.nOffset+=4;var c=v.getInt32(Y.nOffset,!0);Y.nOffset+=4;var p=v.getInt32(Y.nOffset,!0);if(Y.nOffset+=4,1<p)console.log("mx:error mxfun.js version is old!");else{var m=v.getInt32(Y.nOffset,!0);if(Y.nOffset+=4,m==Y.nOffset){this.threejsObjects=new I.Object3D;for(var f=0;f<c;f++){var N=v.getInt8(Y.nOffset);Y.nOffset+=1;var P=v.getInt32(Y.nOffset,!0);if(Y.nOffset+=4,N==1){var O=v.getFloat32(Y.nOffset,!0);Y.nOffset+=4;var Z=v.getFloat32(Y.nOffset,!0);Y.nOffset+=4;var te=v.getFloat32(Y.nOffset,!0);Y.nOffset+=4;var de=v.getFloat32(Y.nOffset,!0);Y.nOffset+=4,(Ie=new q).pt1=new I.Vector3(O,Z,0),Ie.pt2=new I.Vector3(te,de,0),(ze=H.MxThreeJS.createLine(Ie.pt1,Ie.pt2,16777215)).userData.obj=Ie,this.threejsObjects.add(ze)}else if(N==2){var me=v.getInt8(Y.nOffset);Y.nOffset+=1;var we=v.getInt32(Y.nOffset,!0);Y.nOffset+=4;for(var ge=new I.Vector3,Le=0,Pe=null,ae=0;ae<we;ae++){var ve=new I.Vector3;ve.x=v.getFloat32(Y.nOffset,!0),Y.nOffset+=4,ve.y=v.getFloat32(Y.nOffset,!0),Y.nOffset+=4;var Ie,ze,He=v.getFloat32(Y.nOffset,!0);Y.nOffset+=4,0<ae&&((Ie=new q).pt1=ge.clone(),Ie.pt2=ve.clone(),Ie.bulge=He,(ze=H.MxThreeJS.createLine(Ie.pt1,Ie.pt2,16777215)).userData.obj=Ie,this.threejsObjects.add(ze)),ge=ve,Le=He,ae==0&&(Pe=ve)}me&&2<we&&((Ie=new q).pt1=Pe.clone(),Ie.pt2=ge.clone(),Ie.bulge=Le,(ze=H.MxThreeJS.createLine(Ie.pt1,Ie.pt2,16777215)).userData.obj=Ie,this.threejsObjects.add(ze))}else console.log("mx:error mxWebEntitysData type"),Y.nOffset=Y.nOffset-5+P}}else console.log("mx: mxWebEntitysData size assert(0)")}},R);function R(v){this.threejsObjects=null,this.mxObj=null,this.mxObj=v}o.MxDrawObjectOsnap=_},{"../MxDrawData":22,"../MxThreeJS":37,"./McEdJigOsnap":43,"./MxJigCmdManager":54,three:19}],50:[function(T,r,o){var a,x=this&&this.__extends||(a=function(D,C){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(B,z){B.__proto__=z}||function(B,z){for(var A in z)Object.prototype.hasOwnProperty.call(z,A)&&(B[A]=z[A])})(D,C)},function(D,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function B(){this.constructor=D}a(D,C),D.prototype=C===null?Object.create(C):(B.prototype=C.prototype,new B)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxEntSelJig=void 0;var u,M=T("./MxJig"),I=T("./MxJigCmdManager"),H=T("../UI/MxUiVue"),G=T("../MrxDbgUtils"),L=(x(y,u=M.McEdJigCommand),y.prototype.sampler=function(){var D=I.MxJigCmdManager.InType.kGetBegan,C=this.acquirePoint(D);return C.status==I.MxJigCmdManager.DragStatus.kNormal&&(this.point=C.pt),C.status},y.prototype.done=function(D){if(D==I.MxJigCmdManager.DragStatus.kNormal){var C=this;G.MrxDbgUtils.findEntAtPoint(this.getMxObject(),this.point,this.filter).then(function(B){C.callRet(B)})}else this.callRet([]);return I.MxJigCmdManager.DoneStatius.kExitCommand},y.prototype.onStartCommand=function(){H.MxUiVue.setCursorType(H.MxUiVue.CursorType.kRect),u.prototype.onStartCommand.call(this)},y.prototype.onExitCommand=function(){H.MxUiVue.setCursorType(H.MxUiVue.CursorType.kNormal),I.MxJigCmdManager.isWaitCmdNull()&&H.MxUiVue.restoreCmdStatus(),u.prototype.onExitCommand.call(this,!0)},y.prototype.upDisplay=function(){},y);function y(){return u!==null&&u.apply(this,arguments)||this}o.MxEntSelJig=L},{"../MrxDbgUtils":20,"../UI/MxUiVue":65,"./MxJig":53,"./MxJigCmdManager":54}],51:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxGridTrace=void 0;var a=T("three"),x=T("./MxJigCmdManager"),u=T("../MxFun"),M=T("../MxDrawData"),I=T("../MxThreeJS"),H=(G.prototype.ClearDynDrawEntity=function(){for(var L=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),y=this.m_vecDynDrawEntity.length,D=0;D<y;D++)u.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[D],L);this.m_vecDynDrawEntity=[]},G.prototype.GetSanpValue=function(L,y){var D=L%y;return 0<=D?y/2<D?L+=y-D:L-=D:y/2<(D=Math.abs(D))?L-=y-D:L+=D,L},G.prototype.CreteTracePoint=function(L,y){var D=this.m_mxJig.getMxObject(),C=D.getTheTempDrawContainer_SmallCoord();y/=2;var B=I.MxThreeJS.createLine(D.toSmallcoord2(L.x+y,L.y+y,0),D.toSmallcoord2(L.x-y,L.y-y,0),16711680);C.add(B),this.m_vecDynDrawEntity.push(B);var z=I.MxThreeJS.createLine(D.toSmallcoord2(L.x-y,L.y+y,0),D.toSmallcoord2(L.x+y,L.y-y,0),16711680);C.add(z),this.m_vecDynDrawEntity.push(z)},G.prototype.MouseMove=function(L){var y=this.m_mxJig.getMxObject();if(y.getMcObject().isValid()){if(this.ClearDynDrawEntity(),this.m_isValidTracePoint=!1,this.m_isTrace){var D=y.getSysVarPoint("SNAPUNIT");if(!(D.x<1e-6||D.y<1e-6)){L.z=0;var C=new a.Vector3;C.x=this.GetSanpValue(L.x,D.x),C.y=this.GetSanpValue(L.y,D.y);var B=y.viewCoordLong2Cad(M.MxDrawData.m_dInputRectWidth),z=2*B;C.distanceTo(L)<z&&(this.m_isValidTracePoint=!0,this.m_ptTracePoint=C,this.CreteTracePoint(C,B))}}}else this.m_isTrace=!1},G.prototype.Init=function(){var L=this.m_mxJig.getMxObject();L.getMcObject().isValid()?(this.m_isValidTracePoint=!1,this.m_isTrace=!1,L.getSysVarLong("GRIDMODE")!=0&&(this.m_isTrace=!0),L.sysVariable().getSysVarNumber("GETPOINTSTATUS")&x.MxJigCmdManager.GETPOINTSTATUS.OsModeGridSnapTempDisable&&(this.m_isTrace=!1),this.m_mxJig.isDisableGridTrace()&&(this.m_isTrace=!1),this.m_isTrace):this.m_isTrace=!1},G.prototype.GetTracePoint=function(){if(this.m_isTrace)return this.m_isValidTracePoint?this.m_ptTracePoint:void 0},G.prototype.ClearDisplay=function(){this.ClearDynDrawEntity()},G.prototype.ReSetTempDisplay=function(){this.ClearDynDrawEntity(),this.m_isValidTracePoint=!1},G);function G(L){this.m_vecDynDrawEntity=[],this.m_ptTracePoint=new a.Vector3,this.m_isValidTracePoint=!1,this.m_isTrace=!1,this.m_mxJig=null,this.m_mxJig=L}o.MxGridTrace=H},{"../MxDrawData":22,"../MxFun":27,"../MxThreeJS":37,"./MxJigCmdManager":54,three:19}],52:[function(T,r,o){var a,x=this&&this.__extends||(a=function(C,B){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(z,A){z.__proto__=A}||function(z,A){for(var S in A)Object.prototype.hasOwnProperty.call(A,S)&&(z[S]=A[S])})(C,B)},function(C,B){if(typeof B!="function"&&B!==null)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function z(){this.constructor=C}a(C,B),C.prototype=B===null?Object.create(B):(z.prototype=B.prototype,new z)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxIntelliSelectJig=void 0;var u,M=T("three"),I=T("./MxJig"),H=T("./MxJigCmdManager"),G=T("../MxThreeJS"),L=T("../MxTools"),y=(x(D,u=I.McEdJigCommand),D.prototype.sampler=function(){var C=H.MxJigCmdManager.InType.kGetBegan,B=this.acquirePoint(C);return B.status==H.MxJigCmdManager.DragStatus.kNormal&&(this.m_pt2=B.pt),B.status},D.prototype.getTypeName=function(){return"MxIntelliSelect"},D.prototype.done=function(C){if(C==H.MxJigCmdManager.DragStatus.kNormal){var B=this.getMxObject();B.getMxDatabase().getGripManager().doWindowsSelect(this.m_pt1,this.m_pt2,this.m_isRemoveSelect),B.getMcObject().getGripManager().doRangeSelect(this.m_pt1,this.m_pt2,this.m_isRemoveSelect)}return H.MxJigCmdManager.DoneStatius.kExitCommand},D.prototype.upDisplay=function(){var C=this.getMxObject(),B=this.m_pt1.clone(),z=this.m_pt2.clone(),A=new M.Vector3(this.m_pt1.x,this.m_pt2.y,this.m_pt2.z),S=new M.Vector3(this.m_pt2.x,this.m_pt1.y,this.m_pt2.z);if(!L.MxTools.IsZero(C.getViewAngle())){var q=new M.Matrix4;q.makeRotationZ(C.getViewAngle());var W=new M.Matrix4().makeTranslation(B.x,B.y,0).multiply(q).multiply(new M.Matrix4().makeTranslation(-B.x,-B.y,0));B.applyMatrix4(W),z.applyMatrix4(W),A=new M.Vector3(B.x,z.y,z.z),S=new M.Vector3(z.x,B.y,z.z);var _=new M.Matrix4;_.getInverse(W),B.applyMatrix4(_),z.applyMatrix4(_),A.applyMatrix4(_),S.applyMatrix4(_)}var R=[];R.push(B),R.push(A),R.push(z),R.push(S),R.push(B);var v=null,V=65280;if(z.x>B.x)v=G.MxThreeJS.createLines(R,16777215),V=255;else{var Y=this.getMxObject().viewCoordLong2Cad(3);v=G.MxThreeJS.createDashedLines(R,16777215,2*Y,Y)}var c=[];c.push(B),c.push(A),c.push(z),c.push(B),c.push(z),c.push(S);var p=G.MxThreeJS.createTriangle(c,V,.27);this.drawEntity(p,30),this.drawEntity(v,31)},D);function D(C,B){B===void 0&&(B=!1);var z=u.call(this)||this;return z.m_isRemoveSelect=!1,z.m_pt1=C,z.m_pt2=C,z.m_isRemoveSelect=B,z}o.MxIntelliSelectJig=y},{"../MxThreeJS":37,"../MxTools":38,"./MxJig":53,"./MxJigCmdManager":54,three:19}],53:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.McEdJigCommand=o.MxDynamicInput=void 0;var a=T("three"),x=T("../MxFun"),u=T("./MxJigCmdManager"),M=T("../MxManager"),I=T("../MxTools"),H=T("../UI/MxUiVue"),G=T("./McEdJigOsnap"),L=T("./McEdJigDynamicTrace"),y=T("./MxPolarAxisTrace"),D=T("./MxGridTrace"),C=T("../MxThreeJS"),B=T("../MxDrawData"),z=T("./MxOffsetArrow"),A=(S.prototype.getLockValuesMap=function(){return this.m_isShowDynInput?H.MxUiVue.DynamicInput_getLockValuesMap():new Map},S.prototype.getFocusIndex=function(){return this.m_isShowDynInput?this.m_iFocusIndex:-1},S.prototype.ClearDynDrawEntity=function(){for(var _=this.m_jig.getMxObject().getTheTempDrawContainer_SmallCoord(),R=this.m_vecDynDrawEntity.length,v=0;v<R;v++)x.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[v],_);this.m_vecDynDrawEntity=[]},S.prototype.setGetNumber=function(_){this.m_isGetNumber=_},S.prototype.ClearDisplay=function(){this.ClearDynDrawEntity()},S.prototype.onKeyEcsDown=function(){return this.m_isShowDynInput&&this.m_isInputStatus?(this.m_isInputStatus=!1,H.MxUiVue.OnMxEvent({name:"dynInputReSet"}),1):0},S.prototype.getCurrentInputPointCoordinates=function(_){if(!this.m_isShowDynInput)return!1;var R=H.MxUiVue.DynamicInput_getLockValuesMap();if(R.size==0)return!1;var v,V=_.clone(),Y=this.m_jig.getMxObject();if(H.MxUiVue.DynamicInput_getType()!=u.MxJigCmdManager.DynamicInputType.kDistanceInput)return H.MxUiVue.DynamicInput_getType()==u.MxJigCmdManager.DynamicInputType.kXYCoordInput&&(R.size!=1?R.size==2&&R.has(0)&&R.has(1)?(V.x=I.MxTools._tstof(R.get(0)),V.y=I.MxTools._tstof(R.get(1)),V):(console.log("Mx:error index:",R),!1):(p=(v=R.entries().next().value)[0],m=I.MxTools._tstof(v[1]),p==0?(V.x=m,V):p==1?(V.y=m,V):(console.log("Mx:error index:",p),!1)));if(!(Y.sysVariable().getSysVarNumber("GETPOINTSTATUS")&u.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint))return!1;var c=Y.sysVariable().getSysVarPoint("LASTPOINT");if(R.size==1){var p=(v=R.entries().next().value)[0],m=I.MxTools._tstof(v[1]);if(p==0)return!((te=V.clone().sub(c)).length()<1e-7)&&(te.normalize(),te.multiplyScalar(m),c.clone().add(te));if(p!=1)return console.log("Mx:error index:",p),!1;var f=m;if(!(Y.sysVariable().getSysVarNumber("GETPOINTSTATUS")&u.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint))return!1;var N=Y.sysVariable().getSysVarPoint("LASTPOINT");return!((te=V.clone().sub(N)).length()<1e-7)&&(f=f*Math.PI/180,te.dot(new a.Vector3(0,1,0))<0&&(f=-f),(P=new a.Vector3(te.length(),0,0)).applyAxisAngle(new a.Vector3(0,0,1),f),N.clone().add(P))}if(R.size!=2||!R.has(0)||!R.has(1))return console.log("Mx:error index:",R),!1;if(!(Y.sysVariable().getSysVarNumber("GETPOINTSTATUS")&u.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint))return!1;var P,O=I.MxTools._tstof(R.get(0)),Z=(f=I.MxTools._tstof(R.get(1)),Y.sysVariable().getSysVarPoint("LASTPOINT")),te=V.clone().sub(Z);return f=f*Math.PI/180,te.dot(new a.Vector3(0,1,0))<0&&(f=-f),(P=new a.Vector3(O,0,0)).applyAxisAngle(new a.Vector3(0,0,1),f),Z.clone().add(P)},S.prototype.onKeyDonw=function(_){if(!this.m_isShowDynInput||_==27||_==16||_==17||_==18)return 0;if(_==9)return this.m_isInputStatus=!1,0;if(_!=32&&_!=13)return this.m_isInputStatus=!0,0;if(this.m_isInputStatus&&H.MxUiVue.DynamicInput_isShow()){if(this.m_isGetNumber||H.MxUiVue.DynamicInput_getType()==u.MxJigCmdManager.DynamicInputType.kDistanceInput){var R=H.MxUiVue.DynamicInput_getFocusValue();this.m_iFocusIndex=H.MxUiVue.DynamicInput_getFocusIndex(),H.MxUiVue.setCmdText(R)}else if(H.MxUiVue.DynamicInput_getType()==u.MxJigCmdManager.DynamicInputType.kXYCoordInput){var v=H.MxUiVue.DynamicInput_getValue1(),V=H.MxUiVue.DynamicInput_getValue2(),Y=H.MxUiVue.DynamicInput_getLockValuesMap();Y.has(0)&&(v=Y.get(0)),Y.has(1)&&(V=Y.get(1)),R=H.MxUiVue.DynamicInput_getFocusValue();var c=H.MxUiVue.DynamicInput_getFocusIndex(),p="";R.length!=0?p=I.MxTools.IsNumerical(R)?c==0?x.MxFun.formatString("{0},{1}",R,V):x.MxFun.formatString("{0},{1}",v,R):R:I.MxTools.IsNumerical(v)&&I.MxTools.IsNumerical(V)&&(p=x.MxFun.formatString("{0},{1}",v,V)),this.m_iFocusIndex=c,H.MxUiVue.setCmdText(p)}}return this.m_isInputStatus=!1,0},S.prototype.isInputStatus=function(){return this.m_isInputStatus},S.prototype.isTruncatedInput=function(){return this.m_isShowDynInput&&this.m_isInputStatus},S.prototype.initDynInput=function(_){this.m_jig=_;var R=this.m_jig.getMxObject();if(this.m_iFocusIndex=-1,this.m_isShowDynInput=!1,!H.MxUiVue.isNull()){H.MxUiVue.DynamicInput_clearLockValuesMap(),H.MxUiVue.DynamicInput_setType(this.m_dynType);var v=R.sysVariable().getSysVarNumber("GETPOINTSTATUS");v&u.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint&&H.MxUiVue.SetLasetPoint(R.sysVariable().getSysVarPoint("LASTPOINT")),this.m_dynType==u.MxJigCmdManager.DynamicInputType.kAutoInput&&(v&u.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint?H.MxUiVue.DynamicInput_setType(u.MxJigCmdManager.DynamicInputType.kDistanceInput):H.MxUiVue.DynamicInput_setType(u.MxJigCmdManager.DynamicInputType.kXYCoordInput))}},S.prototype.setFocus=function(_){H.MxUiVue.OnMxEvent({name:"dynInputSetFocus",param:{isFocus:_}})},S.prototype.exitDynInput=function(){H.MxUiVue.DynamicInput_setShow(!1),H.MxUiVue.DynamicInput_upDisplay()},S.prototype.isShow=function(){return H.MxUiVue.DynamicInput_isShow()},S.prototype.drawSolidPoint=function(_,R,v,V){var Y=C.MxThreeJS.createPoint(V.toSmallcoord(_),this.m_iDashedLineLenColor,R);v.add(Y),this.m_vecDynDrawEntity.push(Y)},S.prototype.drawDashedLine=function(_,R,v,V,Y,c){var p=C.MxThreeJS.createDashedLine(c.toSmallcoord2(_.x,_.y,_.z),c.toSmallcoord2(R.x,R.y,R.z),this.m_iDashedLineLenColor,V,V);v.add(p),this.m_vecDynDrawEntity.push(p)},S.prototype.worldDrawDistanceInput=function(_,R){var v=this.m_jig.getMxObject();if(v.getMcObject().isValid()&&((_=_.clone()).z=0,(R=R.clone()).z=0,!(v.docCoordLong2Screen(_.distanceTo(R))<20))){var V=v.getTheTempDrawContainer_SmallCoord(),Y=v.viewCoordLong2Cad(this.m_dashedLineLen),c=_.clone().sub(R),p=c.clone();p.applyAxisAngle(new a.Vector3(0,0,1),.5*Math.PI),p.normalize(),p.multiplyScalar(v.viewCoordLong2Cad(50));var m=new a.Vector3(0,1,0),f=new a.Vector3(1,0,0);p.dot(m)<0&&p.multiplyScalar(-1),c.dot(m)<0&&p.multiplyScalar(-1),c.dot(f)<0&&p.multiplyScalar(-1);var N=R.clone().add(p),P=_.clone().add(p),O=R.distanceTo(_),Z=new a.Vector3(R.x+O,R.y,R.z);this.drawSolidPoint(R.clone().add(p),3,V,v),this.drawSolidPoint(_.clone().add(p),3,V,v),this.drawSolidPoint(Z,3,V,v),this.drawDashedLine(N,P,V,Y,Y,v),this.drawDashedLine(R,N,V,Y,Y,v),this.drawDashedLine(_,P,V,Y,Y,v),this.drawDashedLine(R,Z,V,Y,Y,v);var te=_.clone().sub(R),de=0;1e-6<te.length()&&(de=te.angleTo(new a.Vector3(1,0,0)));var me=0,we=de;te.dot(m)<0&&(me=2*Math.PI-de,we=de);var ge=C.MxThreeJS.createDashedArc(v.toSmallcoord(R),O,me,we,this.m_iDashedLineLenColor,Y,Y);V.add(ge),this.m_vecDynDrawEntity.push(ge)}},S.prototype.upDynInput=function(){if(!H.MxUiVue.isNull()){var _=this.m_jig.getMxObject(),R=!1;if(R=!this.m_jig.isDisableDynInput()&&_.getSysVarLong("DYNINPUT")==1,B.MxDrawData.m_isForbiddenDynInput&&(R=!1),x.MxFun.isPC()||(R=!1),H.MxUiVue.DynamicInput_setShow(R),this.m_isShowDynInput=R){if(H.MxUiVue.DynamicInput_setTip(H.MxUiVue.getCmdTip()),u.MxJigCmdManager.getAcquireStatus()==u.MxJigCmdManager.AcquireStatus.kMove){var v=u.MxJigCmdManager.getAcquirePoint();if(H.MxUiVue.DynamicInput_setPos(_.currentCoord2Screen(v.x,v.y,v.z)),H.MxUiVue.DynamicInput_getType()==u.MxJigCmdManager.DynamicInputType.kXYCoordInput)H.MxUiVue.DynamicInput_setValue1(v.x.toFixed(3)),H.MxUiVue.DynamicInput_setValue2(v.y.toFixed(3));else if(H.MxUiVue.DynamicInput_getType()==u.MxJigCmdManager.DynamicInputType.kDistanceInput){var V=u.MxJigCmdManager.getAcquirePoint(),Y=H.MxUiVue.GetLasetPoint();this.worldDrawDistanceInput(V,Y);var c=new a.Vector3(Y.x+.5*(V.x-Y.x),Y.y+.5*(V.y-Y.y),Y.z+.5*(V.z-Y.z)),p=V.clone().sub(Y);p.length()<1e-8&&(p=new a.Vector3(1,0,0));var m=p.clone();m.applyAxisAngle(new a.Vector3(0,0,1),.5*Math.PI),m.normalize(),m.multiplyScalar(_.viewCoordLong2Cad(50));var f=new a.Vector3(0,1,0),N=new a.Vector3(1,0,0);m.dot(f)<0&&m.multiplyScalar(-1),p.dot(f)<0&&m.multiplyScalar(-1),p.dot(N)<0&&m.multiplyScalar(-1),c.add(m);var P=Y.distanceTo(V);H.MxUiVue.DynamicInput_setValue1(P.toFixed(3)),H.MxUiVue.DynamicInput_setValue1Pos(_.currentCoord2Screen(c.x,c.y,v.z)),P=Y.distanceTo(V);var O=Y.clone();O.x+=P;var Z=(c=new a.Vector3(O.x+.5*(V.x-O.x),O.y+.5*(V.y-O.y),O.z+.5*(V.z-O.z))).clone().sub(Y);Z.normalize(),Z.multiplyScalar(P),c=Y.clone().add(Z);var te=V.clone().sub(Y),de=0;1e-6<te.length()&&(de=te.angleTo(new a.Vector3(1,0,0))),de=180*de/Math.PI,H.MxUiVue.DynamicInput_setValue2(de.toFixed(3)+"°"),H.MxUiVue.DynamicInput_setValue2Pos(_.currentCoord2Screen(c.x,c.y,v.z))}}H.MxUiVue.DynamicInput_upDisplay()}}},S.prototype.setDynamicInputType=function(_){this.m_dynType=_},S.prototype.getDynamicInputType=function(){return this.m_dynType},S);function S(_){this.m_dynType=u.MxJigCmdManager.DynamicInputType.kAutoInput,this.m_isInputStatus=!1,this.m_vecDynDrawEntity=[],this.m_dashedLineLen=1.5,this.m_iDashedLineLenColor=8421504,this.m_iFocusIndex=-1,this.m_isShowDynInput=!1,this.m_isGetNumber=!1,this.m_jig=_}o.MxDynamicInput=A;var q=(W.prototype.getTypeName=function(){return""},W.prototype.isExit=function(){return this._isExit},W.prototype.isEnableOsnap=function(){return this.getOsnap().getIsEnableVar()&&!G.McEdImpJigGlobalData.isTmpDisableOsmode()},W.prototype.getDetailedResult=function(){return this.m_DetailedResult},W.prototype.clearGroup=function(){this.drawGroup&&(this._mxObject.getTheTempDrawContainer().remove(this.drawGroup),this.drawGroup=null),this.drawGroup_smallCoord&&(this._mxObject.getTheTempDrawContainer().remove(this.drawGroup_smallCoord),this.drawGroup_smallCoord=null)},W.prototype.getParentGroup=function(){return this.drawGroup||(this.drawGroup=new a.Group,this.drawGroup.renderOrder=M.MxData.iGripRenderOrder,this._mxObject.getTheTempDrawContainer().add(this.drawGroup)),this.drawGroup},W.prototype.getParentGroup_smallCoord=function(){return this.drawGroup_smallCoord||(this.drawGroup_smallCoord=new a.Group,this.drawGroup_smallCoord.renderOrder=M.MxData.iGripRenderOrder,this._mxObject.getTheTempDrawContainer_SmallCoord().add(this.drawGroup_smallCoord)),this.drawGroup_smallCoord},W.prototype.onExitCommand=function(_){_&&this.m_dynInput.exitDynInput(),this.m_osnap.endDrag(),this.m_dynamicTrace.ClearDisplay(),this.m_polarAxisTrace.ClearDisplay(),this.m_offsetArrow.ClearDisplay(),this.m_gridTrace.ClearDisplay(),this.m_dynInput.ClearDisplay(),this.clearGroup(),this._mxObject.getMcObject().onJigCommandEnd()},W.prototype.getOsnap=function(){return this.m_osnap},W.prototype.getOrtho=function(){return this.m_ortho},W.prototype.getDynamicTrace=function(){return this.m_dynamicTrace},W.prototype.getPolarAxisTrace=function(){return this.m_polarAxisTrace},W.prototype.getOffsetArrow=function(){return this.m_offsetArrow},W.prototype.getGridTrace=function(){return this.m_gridTrace},W.prototype.onGetOsnapData=function(_){this.m_dynamicTrace.OnDynamicTrace(_.id,new a.Vector3(_.ptsx,_.ptsy,_.ptsz),_.osmode)},W.prototype.isDisableDynInput=function(){return this.m_isDisableDynInput},W.prototype.setDisableDynInput=function(_){this.m_isDisableDynInput=_},W.prototype.setDisableOsnap=function(_){this.m_isDisableOsnap=_},W.prototype.setOffsetInputPostion=function(_){this.m_isOffsetInputPostion=_},W.prototype.isOffsetInputPostion=function(){return this.m_isOffsetInputPostion},W.prototype.isDisableOsnap=function(){return this.m_isDisableOsnap},W.prototype.setDisableDynamicTrace=function(_){this.m_isDisableDynamicTrace=_},W.prototype.isDisableDynamicTrace=function(){return this.m_isDisableDynamicTrace},W.prototype.setDisablePolarAxisTrace=function(_){this.m_isDisablePolarAxisTrace=_},W.prototype.isDisablePolarAxisTrace=function(){return this.m_isDisablePolarAxisTrace},W.prototype.setDisableGridTrace=function(_){this.m_isDisableGridTrace=_},W.prototype.isDisableGridTrace=function(){return this.m_isDisableGridTrace},W.prototype.setDisableOrthoTrace=function(_){this.m_isDisableOrtho=_},W.prototype.isDisableOrthoTrace=function(){return this.m_isDisableOrtho},W.prototype.disableAllTrace=function(_){_===void 0&&(_=!0),this.m_isDisableOsnap=_,this.m_isDisableDynamicTrace=_,this.m_isDisablePolarAxisTrace=_,this.m_isDisableGridTrace=_,this.m_isDisableOrtho=_},W.prototype.onStartCommand=function(){this._isCancle=!1,this._isExit=!1,this.m_DetailedResult=u.MxJigCmdManager.DetailedResult.kUnknown,this.m_dynInput.initDynInput(this),this.m_osnap.startDrag(this.m_isOffsetInputPostion,this);var _=this._mxObject.getCurrentMousePostion();this._mxObject.isValidCurMousePostion()||(_.x=.5*this._mxObject.getViewWidth(),_.y=.5*this._mxObject.getViewHeight());var R=this._mxObject.screenCoord2Current(_.x,_.y,0);this.m_osnap.setPoint(R),this.m_dynamicTrace.Init(),this.m_polarAxisTrace.Init(),this.m_offsetArrow.Init(),this.m_gridTrace.Init(),this.m_ortho.Init(),u.MxJigCmdManager.doMouseMoveImp(),this.m_dynInput.setFocus(!0)},W.prototype.getDynImput=function(){return this.m_dynInput},W.prototype.setMxObject=function(_){this._mxObject=_},W.prototype.getMxObject=function(){return this._mxObject},W.prototype.setColor=function(_){this._iColor=_},W.prototype.getColor=function(){return this._iColor},W.prototype.setDynamicInputType=function(_){this.m_dynInput.setDynamicInputType(_)},W.prototype.getDynamicInputType=function(){return this.m_dynInput.getDynamicInputType()},W.prototype.createTriangle=function(_,R,v){var V=new a.MeshBasicMaterial({color:this._iColor,side:a.DoubleSide}),Y=new a.Geometry;Y.vertices.push(_),Y.vertices.push(R),Y.vertices.push(v);var c=new a.Vector3(1,1,1),p=new a.Color(this._iColor),m=new a.Face3(0,1,2,c,p,0);return Y.faces.push(m),Y.computeFaceNormals(),Y.computeVertexNormals(),new a.Mesh(Y,V)},W.prototype.createPoint=function(_){var R=new a.Geometry;R.vertices.push(_);var v=new a.PointsMaterial({color:this._iColor,size:3});return new a.Points(R,v)},W.prototype.createLine=function(_,R){var v=new a.Geometry,V=new a.LineBasicMaterial({color:this._iColor});return v.vertices.push(_,R),new a.Line(v,V)},W.prototype.drawReserve=function(_){this.m_isReserveDrawStatus=!0,this.m_callReserveDrawAddEntity=_,this.upDisplay(),this.m_isReserveDrawStatus=!1,this.m_callReserveDrawAddEntity=null},W.prototype.drawMcDbEntity=function(_,R,v){var V=_.getImp(),Y=V.GetObjectID();Y==0&&_.tempRelationObject(),this.m_isReserveDrawStatus?this._mxObject.getMcObject().DrawEntity(V,R,v):this._mxObject.getMcObject().onJigDrawEntityDisplay(V,R,v),Y==0&&_.freeTempRelationObject()},W.prototype.drawMcDbLine=function(_,R,v,V,Y,c,p){this.m_isReserveDrawStatus?this._mxObject.getMcObject().DrawLine(_,R,v,V,Y,c,p):this._mxObject.getMcObject().onJigDrawEntityDisplay_line(_,R,v,V,Y,c,p)},W.prototype.drawEntity=function(_,R,v){if(v===void 0&&(v=!1),_!=null)if(this.m_isReserveDrawStatus)_.renderOrder=R??M.MxData.iDynJigRenderOrder,this._mxObject.addObject(_),this.m_callReserveDrawAddEntity&&this.m_callReserveDrawAddEntity(_);else{var V="MxDynDraw_"+this._DynNameId.toString();_.name=V,_.renderOrder=R??M.MxData.iDynJigRenderOrder,this._aryDynDrawObjectNamesId==null&&(this._aryDynDrawObjectNamesId=new Array),this._aryDynDrawObjectNamesId.push(this._DynNameId),this._DynNameId++,v?this.getParentGroup_smallCoord().add(_):this.getParentGroup().add(_)}},W.prototype.floorPowerOfTwo=function(_){return Math.pow(2,Math.floor(Math.log(_)/Math.LN2))},W.prototype.makeTextSprite=function(_,R,v,V,Y){var c,p=document.createElement("canvas"),m=p.getContext("2d"),f=x.MxFun.formatString("normal {0}px Arial","256");m.font=f;var N=m.measureText(_);c=2*this.floorPowerOfTwo(N.width),p.width=c,p.height=256,m.font=f,m.textAlign="center",m.textBaseline="middle";var P=x.MxFun.formatString("#{0}",Y.toString(16));m.fillStyle=P,m.fillText(_,c/2,128);var O=new a.Texture(p);O.needsUpdate=!0;var Z=new a.SpriteMaterial({map:O});Z.transparent=!1,Z.rotation=V;var te=new a.Sprite(Z);return te.scale.set(c/256*v,v,1),te.position.set(R.x,R.y,0),te},W.prototype.drawText=function(_,R,v,V){var Y=this.makeTextSprite(_,V,R,v,this._iColor);this.drawEntity(Y)},W.prototype.drawPoints=function(_){for(var R=0;R<_.length;R++){var v=new a.Geometry;v.vertices.push(_[R]);var V=new a.PointsMaterial({color:this._iColor,size:3}),Y=new a.Points(v,V);this.drawEntity(Y)}},W.prototype.drawPoint=function(_){var R=new a.Geometry;R.vertices.push(_);var v=new a.PointsMaterial({color:this._iColor,size:3}),V=new a.Points(R,v);this.drawEntity(V)},W.prototype.drawPolyline=function(_){for(var R=new a.Geometry,v=0;v<_.length;v++)R.vertices.push(_[v]);var V=new a.LineBasicMaterial({color:this._iColor}),Y=new a.Line(R,V);this.drawEntity(Y)},W.prototype.drawSpline=function(_){},W.prototype.drawCircle=function(_,R){var v=new a.CircleGeometry(R,64,3,2*Math.PI),V=new a.LineBasicMaterial({color:this._iColor});v.vertices.shift();var Y=new a.LineLoop(v,V);Y.position.x=_.x,Y.position.y=_.y,Y.position.z=_.z,this.drawEntity(Y)},W.prototype.drawArc=function(_,R,v,V){var Y=new a.CircleGeometry(R,64,v,V),c=new a.LineBasicMaterial({color:this._iColor});Y.vertices.shift();var p=new a.Line(Y,c);p.position.x=_.x,p.position.y=_.y,p.position.z=_.z,this.drawEntity(p)},W.prototype.drawLine=function(_,R){var v=new a.Geometry,V=new a.LineBasicMaterial({color:this._iColor});v.vertices.push(_,R);var Y=new a.Line(v,V);this.drawEntity(Y)},W.prototype.removeDynDrawObject=function(){if(this._aryDynDrawObjectNamesId!=null){for(var _=0;_<this._aryDynDrawObjectNamesId.length;_++){var R,v="MxDynDraw_"+this._aryDynDrawObjectNamesId[_].toString();(R=this.getParentGroup().getObjectByName(v))?x.MxFun.removeThreejsObject(R,this.getParentGroup()):(R=this.getParentGroup_smallCoord().getObjectByName(v))&&x.MxFun.removeThreejsObject(R,this.getParentGroup_smallCoord())}this._aryDynDrawObjectNamesId=[],this._mxObject.getMcObject().onJigClearDisplay()}},W.prototype.acquirePoint=function(_,R){R===void 0&&(R=!0);var v=u.MxJigCmdManager.acquirePoint(_,R);return this._isExit=v.exit,this._isExit&&(this.m_DetailedResult=v.DetailedResult),v},W.prototype.acquireDist=function(_,R){var v=u.MxJigCmdManager.acquireDist(_,R);return this._isExit=v.exit,this._isExit&&(this.m_DetailedResult=v.DetailedResult),v},W.prototype.acquireAngle=function(_,R){var v=u.MxJigCmdManager.acquireAngle(_,R);return this._isExit=v.exit,this._isExit&&(this.m_DetailedResult=v.DetailedResult),v},W.prototype.acquireInt=function(){var _=u.MxJigCmdManager.acquireInt();return this._isExit=_.exit,this._isExit&&(this.m_DetailedResult=_.DetailedResult),_},W.prototype.acquireString=function(){var _=u.MxJigCmdManager.acquireString();return this._isExit=_.exit,this._isExit&&(this.m_DetailedResult=_.DetailedResult),_},W.prototype.acquireKeyword=function(){var _=u.MxJigCmdManager.acquireKeyword();return this._isExit=_.exit,this._isExit&&(this.m_DetailedResult=_.DetailedResult),_},W.prototype.notifyCancleExit=function(_){this.m_DetailedResult=_,this._isCancle=!0,this.removeDynDrawObject(),this.done(u.MxJigCmdManager.DragStatus.kCancel),this.onExitCommand(!0),u.MxJigCmdManager.commandRunComplete(this)},W.prototype.notifySampler=function(){var _=this.sampler();if(this.m_dynInput.upDynInput(),_==u.MxJigCmdManager.DragStatus.kNormal&&(this.removeDynDrawObject(),this.upDisplay()),this._isExit){var R=this.done(_);this._isCancle||(R==u.MxJigCmdManager.DoneStatius.kContinueCommand?(this._isExit=!1,u.MxJigCmdManager.doMouseMoveImp(),H.MxUiVue.OnMxEvent({name:"dynInputReSet"})):(this.removeDynDrawObject(),u.MxJigCmdManager.commandRunComplete(this),this.onExitCommand(!0)))}this._mxObject.updateDisplay()},W.prototype.getCurrentMouseButton=function(){return u.MxJigCmdManager.getCurrentMouseButton()},W.prototype.userInputControls=function(){return this._userInputContros},W.prototype.setUserInputControls=function(_){this._userInputContros=_},W.prototype.abort=function(_){u.MxJigCmdManager.stopCmd(_)},W);function W(){this._isExit=!1,this._aryDynDrawObjectNamesId=void 0,this._DynNameId=1,this._iColor=16777215,this._isCancle=!1,this.m_isDisableDynInput=!1,this.m_isDisableOsnap=!1,this.m_isDisableDynamicTrace=!1,this.m_isDisablePolarAxisTrace=!1,this.m_isDisableGridTrace=!1,this.m_isDisableOrtho=!1,this.m_dynInput=new A(this),this.m_dynamicTrace=new L.McEdJigDynamicTrace(this),this.m_polarAxisTrace=new y.MxPolarAxisTrace(this),this.m_offsetArrow=new z.MxOffsetArrow(this),this.m_gridTrace=new D.MxGridTrace(this),this.m_osnap=new G.McEdJigOsnap(this),this.m_ortho=new G.McEdJigOrtho(this),this._userInputContros=u.MxJigCmdManager.UserInputControls.kNullResponseAccepted,this.m_isOffsetInputPostion=!1,this.m_isReserveDrawStatus=!1,this.m_callReserveDrawAddEntity=null,this.drawGroup=null,this.drawGroup_smallCoord=null,this._mxObject=null,this.m_DetailedResult=u.MxJigCmdManager.DetailedResult.kUnknown}o.McEdJigCommand=q},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxThreeJS":37,"../MxTools":38,"../UI/MxUiVue":65,"./McEdJigDynamicTrace":42,"./McEdJigOsnap":43,"./MxGridTrace":51,"./MxJigCmdManager":54,"./MxOffsetArrow":56,"./MxPolarAxisTrace":57,three:19}],54:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxJigCmdManager=o.AcquireReturn=void 0;var a,x=T("three"),u=T("../MxFun"),M=T("./MxJig"),I=T("../MxManager"),H=T("./MrxDbgUiPrPoint"),G=T("./MrxDbgUiPrBase"),L=T("../UI/MxUiVue"),y=T("../MxTools"),D=T("../MxString"),C=T("./McEdJigOsnap"),B=T("../MxDrawData"),z=T("./MrxDbgUiPrDist"),A=function(){this.status=a.DragStatus.kNoChange,this.exit=!0,this.DetailedResult=a.DetailedResult.kUnknown,this.sKeyValue="",this.dist=0,this.iVal=0,this.sValue="",this.ang=0};o.AcquireReturn=A,function(S){var q,W,_,R,v,V,Y,c,p,m,f,N,P,O,Z,te,de,me,we,ge;(W=q=S.UserInputControls||(S.UserInputControls={}))[W.kGovernedByOrthoMode=1]="kGovernedByOrthoMode",W[W.kNullResponseAccepted=2]="kNullResponseAccepted",W[W.kDontEchoCancelForCtrlC=4]="kDontEchoCancelForCtrlC",W[W.kDontUpdateLastPoint=8]="kDontUpdateLastPoint",W[W.kNoDwgLimitsChecking=16]="kNoDwgLimitsChecking",W[W.kNoZeroResponseAccepted=32]="kNoZeroResponseAccepted",W[W.kNoNegativeResponseAccepted=64]="kNoNegativeResponseAccepted",W[W.kAccept3dCoordinates=128]="kAccept3dCoordinates",W[W.kAcceptMouseUpAsPoint=256]="kAcceptMouseUpAsPoint",W[W.kAnyBlankTerminatesInput=512]="kAnyBlankTerminatesInput",W[W.kInitialBlankTerminatesInput=1024]="kInitialBlankTerminatesInput",W[W.kAcceptOtherInputString=2048]="kAcceptOtherInputString",W[W.kGovernedByUCSDetect=4096]="kGovernedByUCSDetect",W[W.kNoZDirectionOrtho=8192]="kNoZDirectionOrtho",W[W.kSpacesInAccepted=16384]="kSpacesInAccepted",(R=_=S.AcquireStatus||(S.AcquireStatus={}))[R.kNoChange=0]="kNoChange",R[R.kMove=1]="kMove",R[R.kBegan=2]="kBegan",R[R.kEnd=3]="kEnd",R[R.kMouseUp=4]="kMouseUp",R[R.kMouseDown=5]="kMouseDown",R[R.kCancle=6]="kCancle",(V=v=S.DragStatus||(S.DragStatus={}))[V.kNoChange=-6]="kNoChange",V[V.kCancel=-4]="kCancel",V[V.kOther=-3]="kOther",V[V.kNull=-1]="kNull",V[V.kNormal=0]="kNormal",V[V.kKW1=1]="kKW1",(c=Y=S.DetailedResult||(S.DetailedResult={}))[c.kUnknown=1]="kUnknown",c[c.kTouchDownIn=2]="kTouchDownIn",c[c.kTouchUpIn=3]="kTouchUpIn",c[c.kMouseLeftIn=4]="kMouseLeftIn",c[c.kMouseLeftUpIn=5]="kMouseLeftUpIn",c[c.kMouseRightIn=6]="kMouseRightIn",c[c.kKeyIn=7]="kKeyIn",c[c.kCoordIn=8]="kCoordIn",c[c.kNullEnterIn=9]="kNullEnterIn",c[c.kNullSpaceIn=10]="kNullSpaceIn",c[c.kEcsIn=11]="kEcsIn",c[c.kNewCommadIn=12]="kNewCommadIn",(p=S.DoneStatius||(S.DoneStatius={}))[p.kContinueCommand=0]="kContinueCommand",p[p.kExitCommand=1]="kExitCommand",(f=m=S.InType||(S.InType={}))[f.kGetBegan=1]="kGetBegan",f[f.kGetEnd=2]="kGetEnd",(P=N=S.MouseButton||(S.MouseButton={}))[P.kInvalid=-1]="kInvalid",P[P.kLeft=0]="kLeft",P[P.kMid=1]="kMid",P[P.kRight=2]="kRight",(Z=O=S.COMMAND_IN||(S.COMMAND_IN={}))[Z.COMMAND_IN_NO_ENTITY=0]="COMMAND_IN_NO_ENTITY",Z[Z.COMMAND_IN_EMTPY=1]="COMMAND_IN_EMTPY",Z[Z.COMMAND_IN_KEY=2]="COMMAND_IN_KEY",Z[Z.COMMAND_IN_STRING=3]="COMMAND_IN_STRING",Z[Z.COMMAND_IN_COORD=5]="COMMAND_IN_COORD",Z[Z.COMMAND_IN_DIST=6]="COMMAND_IN_DIST",Z[Z.COMMAND_IN_INVALID=7]="COMMAND_IN_INVALID",Z[Z.COMMAND_IN_INVALID_ZERO=8]="COMMAND_IN_INVALID_ZERO",Z[Z.COMMAND_IN_INVALID_NEG=9]="COMMAND_IN_INVALID_NEG",Z[Z.COMMAND_IN_INT=10]="COMMAND_IN_INT",(de=te=S.COMMAND_GET||(S.COMMAND_GET={}))[de.COMMAND_GET_STRING=1]="COMMAND_GET_STRING",de[de.COMMAND_GET_KEY=2]="COMMAND_GET_KEY",de[de.COMMAND_GET_DIST=4]="COMMAND_GET_DIST",de[de.COMMAND_GET_COORD=8]="COMMAND_GET_COORD",de[de.COMMAND_GET_INT=16]="COMMAND_GET_INT",(me=S.DynamicInputType||(S.DynamicInputType={}))[me.kNoInput=0]="kNoInput",me[me.kXYCoordInput=1]="kXYCoordInput",me[me.kDistanceInput=2]="kDistanceInput",me[me.kDynTip=3]="kDynTip",me[me.kAutoInput=4]="kAutoInput",(we=S.GETPOINTSTATUS||(S.GETPOINTSTATUS={}))[we.OsModeSValidLastPoint=1]="OsModeSValidLastPoint",we[we.OsModeSTempDisable=2]="OsModeSTempDisable",we[we.OsModeOrthoTempDisable=4]="OsModeOrthoTempDisable",we[we.OsModeSValidLastMovePoint=8]="OsModeSValidLastMovePoint",we[we.OsModePoloarTempDisable=16]="OsModePoloarTempDisable",we[we.OsModeDynTraceTempDisable=32]="OsModeDynTraceTempDisable",we[we.OsModeGridSnapTempDisable=64]="OsModeGridSnapTempDisable",(ge=S.OsnapMode||(S.OsnapMode={}))[ge.kOsModekInValid=0]="kOsModekInValid",ge[ge.kOsModeEnd=1]="kOsModeEnd",ge[ge.kOsModeMid=2]="kOsModeMid",ge[ge.kOsModeCen=3]="kOsModeCen",ge[ge.kOsModeNode=4]="kOsModeNode",ge[ge.kOsModeQuad=5]="kOsModeQuad",ge[ge.kOsModeIns=7]="kOsModeIns",ge[ge.kOsModePerp=8]="kOsModePerp",ge[ge.kOsModeTan=9]="kOsModeTan",ge[ge.kOsModeNear=10]="kOsModeNear",ge[ge.kOsModeInt=11]="kOsModeInt";var Le,Pe=void 0,ae=void 0,ve=_.kNoChange,Ie=N.kInvalid,ze=-9999999,He=new x.Vector2(ze,ze),at=!1,tt=void 0,le=!1,De=0,st=new Map,gt=new Array,St=new D.MxString,Rt=void 0,Pt=-2;function Je(){Pe!=null&&Pe.notifySampler()}function bt(Xe,qe){var ut=Xe.srcElement;if(ut&&(B.MxDrawData.m_isMapBox||ut.tagName=="CANVAS")){if(Pe==null||Pe.getDynImput().isTruncatedInput())return 0;He.x=Xe.offsetX,He.y=Xe.offsetY,qe&&(He.x=qe.x,He.y=qe.y),Kn(He)}return 0}function jt(Xe,qe){if(Xe.button!=N.kLeft)return 0;var ut=Xe.srcElement;if(!ut||!B.MxDrawData.m_isMapBox&&ut.tagName!="CANVAS"||Pe==null||Pe.getDynImput().isTruncatedInput())return 0;He.x=Xe.offsetX,He.y=Xe.offsetY,qe&&(He.x=qe.x,He.y=qe.y),Le=Pe.getMxObject().screenCoord2Current(Xe.offsetX,Xe.offsetY,0);var Re=Pe.getOsnap();return Le=Re.reCompteCurrentPoint(Le),ve=_.kMouseUp,Ie=Xe.button,Je(),Xe.stopPropagation(),1}function Ln(Xe,qe,ut){var Re=Pe.getMxObject().screenCoord2Current(Xe,qe,ut),xt=Pe.getOsnap();Re=xt.reCompteCurrentPoint(Re);var qt,Lt=!1,En=Pe.getDynImput().getCurrentInputPointCoordinates(Re);if(En instanceof x.Vector3&&(Lt=!0,Re.x=En.x,Re.y=En.y),!Lt){var yr=xt.getCurrentOSnapPoint(Re);Re=yr.pt,yr.isSnapPoint&&(Lt=!0)}if(Lt||(qt=Pe.getDynamicTrace().GetTracePoint())&&(Re.copy(qt),Lt=!0),Lt||(qt=Pe.getPolarAxisTrace().GetTracePoint())&&(Re.copy(qt),Lt=!0),!Lt){var pr=Pe.getOrtho();pr.OnViewMouseMove(Re);var Mr=pr.GetCurOrthoPoint();Mr.isValid&&(Re.copy(Mr.pt),Lt=!0)}return Lt||(qt=Pe.getGridTrace().GetTracePoint())&&(Re.copy(qt),Lt=!0),Re}function Yt(Xe,qe){if(Xe.button!=N.kLeft)return 0;Pe!=null&&Pe.getDynImput().isShow()&&Pe.getDynImput().setFocus(!0);var ut=Xe.srcElement;if(!ut||!B.MxDrawData.m_isMapBox&&ut.tagName!="CANVAS"||Pe==null||Pe.getDynImput().isTruncatedInput())return 0;He.x=Xe.offsetX,He.y=Xe.offsetY,qe&&(He.x=qe.x,He.y=qe.y);var Re=Ln(Xe.offsetX,Xe.offsetY,0);return C.McEdImpJigGlobalData.setPrvPoint(Re),Pe.getOsnap().seInValidPoint(),Le=Re,ve=_.kMouseDown,Ie=Xe.button,Je(),Xe.stopPropagation(),1}function Qt(Xe,qe){qe===void 0&&(qe=!0);var ut=void 0,Re=Xe.touches;qe&&(Re=Xe.changedTouches);for(var xt=0;xt<Re.length;xt++)if(Re[xt].identifier==0){ut=Re[xt];break}return ut}function Ve(Xe){var qe;if(B.MxDrawData.m_isMobileCommandOperationSupportsMultipoint){if(!(qe=Qt(Xe,!0)))return;Xe.stopPropagation(),Xe.preventDefault()}else{if(Xe.stopPropagation(),Xe.preventDefault(),Xe.touches.length==0)return;qe=Xe.touches[0]}Pe!=null&&Pe.getDynImput().isShow()&&Pe.getDynImput().setFocus(!0);var ut=Xe.srcElement;if(ut&&(B.MxDrawData.m_isMapBox||ut.tagName=="CANVAS")){if(Pe==null)return;var Re=Xe.target.getBoundingClientRect();He.x=qe.clientX-Re.left,He.y=qe.clientY-Re.top;var xt=Ln(He.x,He.y,0);return C.McEdImpJigGlobalData.setPrvPoint(xt),Pe.getOsnap().seInValidPoint(),Le=xt,ve=_.kBegan,Ie=N.kInvalid,Je(),1}}function Be(Xe){var qe;if(B.MxDrawData.m_isMobileCommandOperationSupportsMultipoint){if(!(qe=Qt(Xe)))return;Xe.stopPropagation(),Xe.preventDefault()}else Xe.stopPropagation(),Xe.preventDefault(),0<Xe.touches.length&&(qe=Xe.touches[0]);var ut=Xe.srcElement;if(ut&&(B.MxDrawData.m_isMapBox||ut.tagName=="CANVAS")){if(Pe==null||He.x==ze||He.y==ze)return;if(qe){var Re=Xe.target.getBoundingClientRect();He.x=qe.clientX-Re.left,He.y=qe.clientY-Re.top}var xt=Ln(He.x,He.y,0);return C.McEdImpJigGlobalData.setPrvPoint(xt),Pe.getOsnap().seInValidPoint(),Le=xt,ve=_.kEnd,Ie=N.kInvalid,Je(),1}}function Wt(Xe){var qe;if(B.MxDrawData.m_isMobileCommandOperationSupportsMultipoint){if(Xe.touches.length==1&&(qe=Qt(Xe)),!qe)return;Xe.stopPropagation(),Xe.preventDefault()}else{if(Xe.stopPropagation(),Xe.preventDefault(),Xe.touches.length==0)return;qe=Xe.touches[0]}var ut=Xe.srcElement;if(ut&&(B.MxDrawData.m_isMapBox||ut.tagName=="CANVAS")){if(Pe==null)return;var Re=Xe.target.getBoundingClientRect();He.x=qe.clientX-Re.left,He.y=qe.clientY-Re.top,Kn(He)}}function Kn(Xe){if(le=!1,Xe==null){if(He.x==ze||He.y==ze)return;Xe=He}Pe.getDynImput().ClearDisplay();var qe=Pe.getMxObject().screenCoord2Current(Xe.x,Xe.y,0),ut=Pe.getOffsetArrow();ut.ReSetTempDisplay(),ut.MouseMove(qe);var Re=Pe.getOsnap();qe=Re.reCompteCurrentPoint(qe);var xt=Pe.getMxObject().viewCoordLong2Cad(.5*B.MxDrawData.m_dInputRectWidth);Re.setPoint(qe,xt);var qt=Pe.getDynamicTrace();qt.ReSetTempDisplay(),qt.OnDynamicTrace(0,qe,S.OsnapMode.kOsModekInValid),qt.MouseMove(qe);var Lt,En=!1,yr=Pe.getDynImput().getCurrentInputPointCoordinates(qe);yr instanceof x.Vector3&&(En=!0,qe.x=yr.x,qe.y=yr.y,qe.z=yr.z),En||(Lt=qt.GetTracePoint())&&(qe.x=Lt.x,qe.y=Lt.y,qe.z=Lt.z,En=!0);var pr=Pe.getPolarAxisTrace();if(pr.ReSetTempDisplay(),En||(pr.MouseMove(qe),(Lt=pr.GetTracePoint())&&(qe.x=Lt.x,qe.y=Lt.y,qe.z=Lt.z,En=!0)),!En){var Mr=Pe.getOrtho();Mr.OnViewMouseMove(qe);var Si=Mr.GetCurOrthoPoint();Si.isValid&&qe.copy(Si.pt)}var ci=Pe.getGridTrace();ci.ReSetTempDisplay(),En||(ci.MouseMove(qe),(Lt=ci.GetTracePoint())&&(qe.x=Lt.x,qe.y=Lt.y,qe.z=Lt.z,En=!0)),Le=qe,ve=_.kMove;var Ni=Pe.getMxObject();Ni.sysVariable().setSysVarPoint("LASTMOVEPOINT",qe);var Jr=Ni.sysVariable().getSysVarNumber("GETPOINTSTATUS");Jr|=S.GETPOINTSTATUS.OsModeSValidLastMovePoint,Ni.sysVariable().setSysVarNumber("GETPOINTSTATUS",Jr),Je.call(this)}function nn(){Pe&&(Rt=Pe.getMxObject().getEventManager(),u.MxFun.isPC()?(Rt.addEventListener("mouseup",jt,!0),Rt.addEventListener("mousemove",bt,!0),Rt.addEventListener("mousedown",Yt,!0)):(Rt.addEventListener("touchstart",Ve,!0),Rt.addEventListener("touchend",Be,!0),Rt.addEventListener("touchmove",Wt,!0)))}function ct(){Rt&&(u.MxFun.isPC()?(Rt.removeEventListener("mouseup",jt,!0),Rt.removeEventListener("mousemove",bt,!0),Rt.removeEventListener("mousedown",Yt,!0)):(Rt.removeEventListener("touchstart",Ve,!0),Rt.removeEventListener("touchend",Be,!0),Rt.removeEventListener("touchmove",Wt,!0)),Rt=void 0)}function rt(Xe){var qe=Xe.getOrbitControls();u.MxFun.isPC()?(Pt=qe.mouseButtons.LEFT,qe.mouseButtons.LEFT=-1):B.MxDrawData.m_isMobileCommandOperationSupportsMultipoint||(qe.enabled=!1),qe.resetStatusValue(),Xe.callEvent("dragWillStart"),Xe.updateDisplay()}function Zt(Xe){var qe=new x.Vector3,ut=!1,Re=new D.MxString(Xe),xt=Re.AnalyzeString(",");if(xt.length<2)for(;;){var qt=Pe.getDynImput().getFocusIndex();if(qt==-1||Re.IsEmpty()||!y.MxTools.IsNumerical(Re))break;var Lt=Pe.getDynImput().getLockValuesMap();if(qt==0){var En=y.MxTools._tstof(Re.m_val);if(y.MxTools.IsZero(En)||!((hr=(xi=Pe.getMxObject()).sysVariable().getSysVarNumber("GETPOINTSTATUS"))&S.GETPOINTSTATUS.OsModeSValidLastPoint)||!(hr&S.GETPOINTSTATUS.OsModeSValidLastMovePoint))break;var yr=void 0;Lt.has(1)&&(yr=y.MxTools._tstof(Lt.get(1)));var pr=xi.sysVariable().getSysVarPoint("LASTPOINT"),Mr=xi.sysVariable().getSysVarPoint("LASTMOVEPOINT").clone().sub(pr);if(yr===void 0){if(Mr.length()<1e-7)break;Mr.normalize()}else yr=yr*Math.PI/180,Mr.dot(new x.Vector3(0,1,0))<0&&(yr=-yr),(Mr=new x.Vector3(1,0,0)).applyAxisAngle(new x.Vector3(0,0,1),yr);Mr.multiplyScalar(En);var Si=(qe=pr.clone().add(Mr)).clone().add(Mr.multiplyScalar(10));xi.sysVariable().setSysVarPoint("LASTMOVEPOINT",Si),ut=!0}else if(qt==1){var ci=y.MxTools._tstof(Re.m_val);if(!((hr=(xi=Pe.getMxObject()).sysVariable().getSysVarNumber("GETPOINTSTATUS"))&S.GETPOINTSTATUS.OsModeSValidLastPoint)||!(hr&S.GETPOINTSTATUS.OsModeSValidLastMovePoint))break;var Ni=void 0;Lt.has(0)&&(Ni=y.MxTools._tstof(Lt.get(0))),pr=xi.sysVariable().getSysVarPoint("LASTPOINT"),Mr=xi.sysVariable().getSysVarPoint("LASTMOVEPOINT").clone().sub(pr);var Jr=0;if(Ni===void 0){if(Mr.length()<1e-7)break;Jr=Mr.length()}else Jr=Ni;ci=ci*Math.PI/180,Mr.dot(new x.Vector3(0,1,0))<0&&(ci=-ci);var ai=new x.Vector3(Jr,0,0);ai.applyAxisAngle(new x.Vector3(0,0,1),ci),Si=(qe=pr.clone().add(ai)).clone().add(ai.multiplyScalar(2)),xi.sysVariable().setSysVarPoint("LASTMOVEPOINT",Si),ut=!0}break}else{var hr,xi=Pe.getMxObject(),J=new D.MxString(xt[0]),Lr=new D.MxString(xt[1]),Pi=new D.MxString("0");if(2<xt.length&&(Pi.m_val=xt[2]),J.IsEmpty()||J.Left(1)!="@")y.MxTools.IsNumerical(J)&&y.MxTools.IsNumerical(Lr)&&y.MxTools.IsNumerical(Pi)?(ut=!0,qe.x=y.MxTools._tstof(J.m_val),qe.y=y.MxTools._tstof(Lr.m_val),qe.z=y.MxTools._tstof(Pi.m_val)):ut=!1;else if(J.m_val=J.m_val.substring(1,J.m_val.length),y.MxTools.IsNumerical(J)&&y.MxTools.IsNumerical(Lr)&&y.MxTools.IsNumerical(Pi))if((hr=xi.sysVariable().getSysVarNumber("GETPOINTSTATUS"))&S.GETPOINTSTATUS.OsModeSValidLastPoint){ut=!0;var zn=y.MxTools._tstof(J.m_val),Zi=y.MxTools._tstof(Lr.m_val),mo=y.MxTools._tstof(Pi.m_val);pr=xi.sysVariable().getSysVarPoint("LASTPOINT"),qe.x=pr.x+zn,qe.y=pr.y+Zi,qe.z=pr.z+mo}else ut=!1;else ut=!1}return ut?qe:null}function bn(Xe,qe){qe===void 0&&(qe=!1),L.MxUiVue.AcutPrintfNoFormat(Xe,qe)}function Kt(Xe,qe){if(Xe==O.COMMAND_IN_INVALID){var ut=L.MxUiVue.getCmdTip();return bn(qe),bn(ut),v.kNoChange}return Xe==O.COMMAND_IN_INVALID_ZERO?(ut=L.MxUiVue.getCmdTip(),Pe.userInputControls()&q.kNoNegativeResponseAccepted?bn(`
 值必须为正 且非零。 
`):bn(`
 值必不能为零。 
`),bn(ut),v.kOther):Xe!=O.COMMAND_IN_INVALID_NEG?v.kNoChange:(ut=L.MxUiVue.getCmdTip(),Pe.userInputControls()&q.kNoZeroResponseAccepted?bn(`
 值必须为正 且非零。 
`):bn(`
 值必不能为负。 
`),bn(ut),v.kOther)}function Zn(Xe){var qe={iRet:O.COMMAND_IN_NO_ENTITY,sValue:"",iKey:v.kNull,dDist:0,iVal:0,pt:null,cmdText:""};if(!le)return qe;var ut=Pe.userInputControls(),Re=L.MxUiVue.getCmdText();if((qe.cmdText=Re).length==0)return ut&q.kNullResponseAccepted?qe.iRet=O.COMMAND_IN_EMTPY:qe.iRet=O.COMMAND_IN_INVALID,qe;if(Xe&te.COMMAND_GET_KEY&&0<st.size){var xt=new D.MxString(Re);xt.MakeUpper(),xt.TrimLeft(" "),xt.TrimRight(" ");var qt=st.get(xt.m_val);if(qt!=null)return qe.iRet=O.COMMAND_IN_KEY,qe.iKey=qt,qe.sValue=xt.m_val,qe}if(Xe&te.COMMAND_GET_DIST&&y.MxTools.IsNumerical(Re))return qe.dDist=y.MxTools._tstof(Re),ut&q.kNoZeroResponseAccepted&&y.MxTools.IsZero(qe.dDist)?qe.iRet=O.COMMAND_IN_INVALID_ZERO:ut&q.kNoNegativeResponseAccepted&&qe.dDist<0?qe.iRet=O.COMMAND_IN_INVALID_NEG:(qe.sValue=Re,qe.iRet=O.COMMAND_IN_DIST),qe;if(Xe&te.COMMAND_GET_INT&&y.MxTools.IsNumerical(Re))return qe.iVal=y.MxTools._tstoi(Re),ut&q.kNoZeroResponseAccepted&&qe.iVal==0?qe.iRet=O.COMMAND_IN_INVALID_ZERO:ut&q.kNoNegativeResponseAccepted&&qe.iVal<0?qe.iRet=O.COMMAND_IN_INVALID_NEG:(qe.sValue=Re,qe.iRet=O.COMMAND_IN_INT),qe;if(Xe&te.COMMAND_GET_COORD){var Lt=Zt(Re);if(Lt!=null)return qe.sValue=Re,qe.iRet=O.COMMAND_IN_COORD,qe.pt=Lt,qe}return Xe&te.COMMAND_GET_STRING?(qe.sValue=Re,qe.iRet=O.COMMAND_IN_STRING):qe.iRet=O.COMMAND_IN_INVALID,qe}function Se(Xe){var qe=Pe.getMxObject();if(qe.sysVariable().setSysVarPoint("LASTPOINT",Xe),Xe){var ut=qe.sysVariable().getSysVarNumber("GETPOINTSTATUS");ut|=S.GETPOINTSTATUS.OsModeSValidLastPoint,qe.sysVariable().setSysVarNumber("GETPOINTSTATUS",ut)}else ut=qe.sysVariable().getSysVarNumber("GETPOINTSTATUS"),ut&=~S.GETPOINTSTATUS.OsModeSValidLastPoint,qe.sysVariable().setSysVarNumber("GETPOINTSTATUS",ut)}function Cr(Xe){var qe=new A;return ve==_.kMove?(qe.status=v.kNormal,qe.pt=Le,qe.exit=!1):ve==_.kEnd?Xe&m.kGetEnd?(qe.status=v.kNormal,qe.pt=Le,qe.exit=!0,qe.DetailedResult=Y.kTouchUpIn,Se(qe.pt)):(qe.status=v.kNormal,qe.pt=Le,qe.exit=!1):ve==_.kCancle?(qe.status=v.kCancel,qe.pt=Le,qe.exit=!0):ve==_.kBegan?Xe&m.kGetBegan?(qe.status=v.kNormal,qe.pt=Le,qe.exit=!0,qe.DetailedResult=Y.kTouchDownIn,Se(qe.pt)):(qe.status=v.kNormal,qe.pt=Le,qe.exit=!1):ve==_.kMouseDown?(qe.status=v.kNormal,qe.pt=Le,qe.exit=!0,qe.DetailedResult=Y.kMouseLeftIn,Se(qe.pt)):(qe.status=v.kNoChange,qe.pt=void 0,qe.exit=!1),qe}S.getInputKeyword=function(Xe){if(Xe<1)return"";for(var qe,ut=st.entries();!(qe=ut.next()).done;)if(qe.value==Xe)return qe.key;return""},S.GetKeyWordToString=function(){return gt},S.keywordList=function(){return St.m_val},S.setKeywordList=function(Xe){if(St.m_val=Xe,st.clear(),gt.length=0,!St.IsEmpty())if(St.TrimLeft(" "),St.TrimRight(" "),St.m_val[0]=="["&&St.m_val[St.m_val.length-1]=="]"){St.TrimLeft("["),St.TrimRight("]");for(var qe=St.AnalyzeString("/"),ut=1,Re=0;Re<qe.length;Re++){var xt=(En=new D.MxString(qe[Re])).Find("(");if(xt!=-1){var qt=new D.MxString(En.Left(xt)),Lt=new D.MxString(En.Right(En.GetLength()-xt-1));Lt.TrimRight(")"),qt.IsEmpty()||Lt.IsEmpty()||(Lt.MakeUpper(),st.set(Lt.m_val,ut),ut++,gt.push(new y.MxPair(Lt.m_val,qt.m_val)))}}}else for(qe=St.AnalyzeString(" "),ut=1,Re=0;Re<qe.length;Re++){var En;(En=new D.MxString(qe[Re])).IsEmpty()||(En.MakeUpper(),st.set(En.m_val,ut),ut++)}},S.getAcquirePoint=function(){return Le},S.getAcquireStatus=function(){return ve},S.doMouseMoveImp=Kn,S.OnThreeControlsChage=function(){if(Pe!=null)return Pe.getOsnap().reComputeOffset(),void(He.x!=ze&&He.y!=ze&&Kn(He))},S.OnEnter=function(Xe){De=Xe,le=!0,ve=_.kNoChange,Je(),le=!1},S.Test=function(){le=!0},S.registEvent=nn,S.unRegistEvent=ct,S.getCurrentMouseButton=function(){return Ie},S.isRunning=function(){return Pe!=null},S.getCurCmd=function(){return Pe},S.commandRunComplete=function(Xe){Pe!=Xe&&console.log("aseert:_curCmd == cmd");var qe,ut,Re=I.MxManager.currentMx();Pe!=null&&(Re=Pe.getMxObject()),ae!=null?(Pe=ae,ae=void 0,Ie=N.kInvalid,nn(),Pe.onStartCommand(),rt(Re)):(ct(),Pe=void 0,ut=(qe=Re).getOrbitControls(),u.MxFun.isPC()?Pt!=-2&&(ut.mouseButtons.LEFT=Pt,Pt=-2,ut.resetStatusValue()):(B.MxDrawData.m_isMobileCommandOperationSupportsMultipoint||(ut.enabled=!0),ut.resetStatusValue()),qe.callEvent("dragWillEnd"),qe.updateDisplay(),B.MxDrawData.m_isAutoResetRenderer||qe.resetRenderer())},S.isWaitCmdNull=function(){return ae==null},S.stopCmd=function(Xe){I.MxManager.currentMx().endPanCommand(),Pe!=null&&(at=!0,Pe.notifyCancleExit(Xe),at=!1)},S.setRunCmdEvent=function(Xe){tt=Xe},S.runCmd=function(Xe){if(!at){var qe=I.MxManager.currentMx();Xe.setMxObject(qe),qe.isValidCurMousePostion()?He=qe.getCurrentMousePostion():u.MxFun.isPC()?(He.x=ze,He.y=ze):(He.x=.5*qe.getViewWidth(),He.y=.5*qe.getViewHeight()),tt&&tt(),Pe==null?(Pe=Xe,Ie=N.kInvalid,nn(),Pe.onStartCommand(),rt(qe)):(ae=Xe,at=!0,Pe.notifyCancleExit(Y.kNewCommadIn),at=!1)}},S.GetAcqurePointFromStringTo=Zt,S.ProcCommandRetResult=Kt,S.GetCommandLineContent=Zn,S.acquireKeyword=function(){var Xe=new A;if(Pe==null)return Xe.status=v.kCancel,Xe.exit=!0,Xe;var qe=Zn(te.COMMAND_GET_STRING|te.COMMAND_GET_KEY);return qe.iRet==O.COMMAND_IN_EMTPY?(Xe.status=v.kNull,Xe.exit=!0,De==13?Xe.DetailedResult=Y.kNullEnterIn:De==32?Xe.DetailedResult=Y.kNullSpaceIn:De==-1&&(Xe.DetailedResult=Y.kMouseRightIn)):qe.iRet==O.COMMAND_IN_KEY?(Xe.status=qe.iKey,Xe.exit=!0,Xe.sKeyValue=qe.sValue,Xe.DetailedResult=Y.kKeyIn):(qe.cmdText.length==0?Xe.status=v.kNoChange:Xe.status=Kt(qe.iRet,`
需要输入关键字。 
`),Xe.exit=!1),Xe},S.acquireString=function(){var Xe=new A;if(Pe==null)return Xe.status=v.kCancel,Xe.exit=!0,Xe;var qe=Zn(te.COMMAND_GET_STRING|te.COMMAND_GET_KEY);return qe.iRet==O.COMMAND_IN_EMTPY?(Xe.status=v.kNull,Xe.exit=!0,De==13?Xe.DetailedResult=Y.kNullEnterIn:De==32?Xe.DetailedResult=Y.kNullSpaceIn:De==-1&&(Xe.DetailedResult=Y.kMouseRightIn)):qe.iRet==O.COMMAND_IN_KEY?(Xe.status=qe.iKey,Xe.exit=!0,Xe.sKeyValue=qe.sValue,Xe.DetailedResult=Y.kKeyIn):qe.iRet==O.COMMAND_IN_STRING?(Xe.status=v.kNormal,Xe.sValue=qe.sValue,Xe.exit=!0,Xe.DetailedResult=Y.kKeyIn):(Xe.status=Kt(qe.iRet,`
需要输入非空字符串。 
`),Xe.exit=!1),Xe},S.acquireInt=function(){var Xe=new A;if(Pe==null)return Xe.status=v.kCancel,Xe.exit=!0,Xe;var qe=Zn(te.COMMAND_GET_INT|te.COMMAND_GET_KEY);return qe.iRet==O.COMMAND_IN_EMTPY?(Xe.status=v.kNull,Xe.exit=!0,De==13?Xe.DetailedResult=Y.kNullEnterIn:De==32?Xe.DetailedResult=Y.kNullSpaceIn:De==-1&&(Xe.DetailedResult=Y.kMouseRightIn)):qe.iRet==O.COMMAND_IN_KEY?(Xe.status=qe.iKey,Xe.exit=!0,Xe.sKeyValue=qe.sValue,Xe.DetailedResult=Y.kKeyIn):qe.iRet==O.COMMAND_IN_INT?(Xe.status=v.kNormal,Xe.iVal=qe.iVal,Xe.exit=!0,Xe.DetailedResult=Y.kKeyIn):(Xe.status=Kt(qe.iRet,`
 需要整数或选项关键字。 
`),Xe.exit=!1),Xe},S.acquireDist=function(Xe,qe){var ut=new A;if(Pe==null)return ut.status=v.kCancel,ut.exit=!0,ut;var Re=Zn(te.COMMAND_GET_DIST|te.COMMAND_GET_KEY);if(Re.iRet==O.COMMAND_IN_EMTPY)return ut.status=v.kNull,ut.exit=!0,De==13?ut.DetailedResult=Y.kNullEnterIn:De==32?ut.DetailedResult=Y.kNullSpaceIn:De==-1&&(ut.DetailedResult=Y.kMouseRightIn),ut;if(Re.iRet==O.COMMAND_IN_KEY)return ut.status=Re.iKey,ut.exit=!0,ut.sKeyValue=Re.sValue,ut.DetailedResult=Y.kKeyIn,ut;if(Re.iRet==O.COMMAND_IN_DIST)return ut.status=v.kNormal,ut.dist=Re.dDist,ut.exit=!0,ut.DetailedResult=Y.kCoordIn,ut;if(ut.status=Kt(Re.iRet,`
 需要点或选项关键字。 
`),!qe||Re.iRet==O.COMMAND_IN_INVALID_ZERO||Re.iRet==O.COMMAND_IN_INVALID_NEG)return ut.exit=!1,ut;var xt=Cr(Xe);if(xt.status==v.kNormal&&xt.exit){var qt=xt.pt.clone(),Lt=qe.clone();qt.z=Lt.z=0;var En=qt.distanceTo(Lt);return Pe.userInputControls()&q.kNoZeroResponseAccepted&&y.MxTools.IsZero(En)?(Kt(O.COMMAND_IN_INVALID_ZERO,`
 需要点或选项关键字。 
`),ut.status=v.kOther,ut.exit=!1,ut):(ut.status=v.kNormal,ut.dist=En,ut.exit=!0,ut.DetailedResult=xt.DetailedResult,ut)}return ut.exit=!1,ut.status=v.kNoChange,ut},S.acquirePoint=function(Xe,qe){qe===void 0&&(qe=!0);var ut=new A;if(Pe==null)return ut.status=v.kCancel,ut;var Re=Zn(te.COMMAND_GET_COORD|te.COMMAND_GET_KEY);return Re.iRet==O.COMMAND_IN_EMTPY?(ut.status=v.kNull,ut.exit=!0,De==13?ut.DetailedResult=Y.kNullEnterIn:De==32?ut.DetailedResult=Y.kNullSpaceIn:De==-1&&(ut.DetailedResult=Y.kMouseRightIn),ut):Re.iRet==O.COMMAND_IN_KEY?(ut.status=Re.iKey,ut.exit=!0,ut.sKeyValue=Re.sValue,ut.DetailedResult=Y.kKeyIn,ut):Re.iRet==O.COMMAND_IN_COORD?(ut.status=v.kNormal,ut.pt=new x.Vector3(Re.pt.x,Re.pt.y,Re.pt.z),ut.exit=!0,ut.DetailedResult=Y.kCoordIn,ut):(qe&&Kt(Re.iRet,`
 需要点或选项关键字。 
`),Cr(Xe))},S.acquireAngle=function(Xe,qe){var ut=new A;if(Pe==null)return ut.status=v.kCancel,ut.exit=!0,ut;var Re=Zn(te.COMMAND_GET_DIST|te.COMMAND_GET_KEY);if(Re.iRet==O.COMMAND_IN_EMTPY)return ut.status=v.kNull,ut.exit=!0,De==13?ut.DetailedResult=Y.kNullEnterIn:De==32?ut.DetailedResult=Y.kNullSpaceIn:De==-1&&(ut.DetailedResult=Y.kMouseRightIn),ut;if(Re.iRet==O.COMMAND_IN_KEY)return ut.status=Re.iKey,ut.exit=!0,ut.sKeyValue=Re.sValue,ut.DetailedResult=Y.kKeyIn,ut;if(Re.iRet==O.COMMAND_IN_DIST)return ut.status=v.kNormal,ut.ang=3.14159265*Re.dDist/180,ut.exit=!0,ut.DetailedResult=Y.kCoordIn,ut;if(ut.status=Kt(Re.iRet,`
 需要点或选项关键字。 
`),!qe||Re.iRet==O.COMMAND_IN_INVALID_ZERO||Re.iRet==O.COMMAND_IN_INVALID_NEG)return ut.exit=!1,ut;var xt=Cr(Xe);if(xt.status==v.kNormal&&xt.exit){var qt=new x.Vector3(xt.pt.x-qe.x,xt.pt.y-qe.y,0),Lt=qt.angleTo(new x.Vector3(1,0,0));qt.dot(new x.Vector3(0,1,0))<-1e-11&&(Lt=2*Math.PI-Lt);var En=Pe.userInputControls();return En&q.kNoZeroResponseAccepted&&y.MxTools.IsZero(Lt)?(Kt(O.COMMAND_IN_INVALID_ZERO,`
 需要点或选项关键字。 
`),ut.status=v.kOther,ut.exit=!1,ut):(En&q.kNoNegativeResponseAccepted&&Lt<0?(Kt(O.COMMAND_IN_INVALID_NEG,`
 需要点或选项关键字。 
`),ut.status=v.kOther,ut.exit=!1):(ut.status=v.kNormal,ut.ang=Lt,ut.exit=!0,ut.DetailedResult=xt.DetailedResult),ut)}return ut.exit=!1,ut.status=v.kNoChange,ut},S.getMcEdJigCommandClass=function(){return M.McEdJigCommand},S.getMrxDbgUiPrPointClass=function(){return H.MrxDbgUiPrPoint},S.getMrxDbgUiPrDistClass=function(){return z.MrxDbgUiPrDist},S.getMrxDbgUiPrIntClass=function(){return z.MrxDbgUiPrInt},S.getMrxDbgUiPrStringClass=function(){return z.MrxDbgUiPrString},S.getMrxDbgUiPrKeyWordClass=function(){return z.MrxDbgUiPrKeyWord},S.getMrxDbgUiPrAngleClass=function(){return z.MrxDbgUiPrAngle},S.getMcEdGetPointWorldDrawClass=function(){return G.McEdGetPointWorldDraw},S.McEdGetPointWorldDrawObjectClass=function(){return G.McEdGetPointWorldDrawObject},S.init=function(){this._curCmd=void 0}}(a||(o.MxJigCmdManager=a={}))},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxString":34,"../MxTools":38,"../UI/MxUiVue":65,"./McEdJigOsnap":43,"./MrxDbgUiPrBase":45,"./MrxDbgUiPrDist":46,"./MrxDbgUiPrPoint":47,"./MxJig":53,three:19}],55:[function(T,r,o){var a,x=this&&this.__extends||(a=function(L,y){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,C){D.__proto__=C}||function(D,C){for(var B in C)Object.prototype.hasOwnProperty.call(C,B)&&(D[B]=C[B])})(L,y)},function(L,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function D(){this.constructor=L}a(L,y),L.prototype=y===null?Object.create(y):(D.prototype=y.prototype,new D)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxJigGetLine=void 0;var u,M=T("./MxJig"),I=T("./MxJigCmdManager"),H=(x(G,u=M.McEdJigCommand),G.prototype.sampler=function(){var L=I.MxJigCmdManager.InType.kGetBegan;this._isGetPt1||(L=I.MxJigCmdManager.InType.kGetEnd);var y=this.acquirePoint(L);return y.status==I.MxJigCmdManager.DragStatus.kNormal&&(this._isGetPt1?this._pt1=y.pt:this._pt2=y.pt),y.status},G.prototype.setRetCall=function(L){this._retCall=L},G.prototype.done=function(L){if(this._isGetPt1)return this._isGetPt1=!1,I.MxJigCmdManager.DoneStatius.kContinueCommand;var y={};return y.pt1=this.getMxObject().worldCoord2Currnet(this._pt1.x,this._pt1.y,this._pt1.z),y.pt2=this.getMxObject().worldCoord2Currnet(this._pt2.x,this._pt2.y,this._pt2.z),this._retCall(y),I.MxJigCmdManager.DoneStatius.kExitCommand},G.prototype.upDisplay=function(){this._isGetPt1||this._pt1==null||this._pt2==null||this.drawLine(this._pt1,this._pt2)},G);function G(){var L=u!==null&&u.apply(this,arguments)||this;return L._isGetPt1=!0,L}o.MxJigGetLine=H},{"./MxJig":53,"./MxJigCmdManager":54}],56:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxOffsetArrow=void 0;var a=T("three"),x=T("../MxFun"),u=T("../MxThreeJS"),M=T("../MxTools"),I=(H.prototype.ClearDynDrawEntity=function(){var G=this.m_vecDynDrawEntity.length;if(G!=0){for(var L=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),y=0;y<G;y++)x.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[y],L);this.m_vecDynDrawEntity=[]}},H.prototype.MouseMove=function(G){var L=this.m_mxJig.getMxObject();if(L.getMcObject().isValid()&&(this.ClearDynDrawEntity(),this.m_mxJig.isOffsetInputPostion())){var y=G.clone(),D=this.m_mxJig.getOsnap().reCompteCurrentPoint(y.clone()),C=u.MxThreeJS.createLine(L.toSmallcoord(y),L.toSmallcoord(D),16777215),B=L.getTheTempDrawContainer_SmallCoord();B.add(C),this.m_vecDynDrawEntity.push(C);var z=M.MxTools.MillimeterToPixels(2.9);z=L.screenCoordLong2Doc(z);var A=u.MxThreeJS.createSolidCircle(L.toSmallcoord(y),.85*z,16777215);B.add(A),this.m_vecDynDrawEntity.push(A);var S=u.MxThreeJS.createCircle(L.toSmallcoord(y),z,16777215);B.add(S),this.m_vecDynDrawEntity.push(S);var q=y.sub(D);q.normalize().multiplyScalar(.8*z);var W=q.clone().applyAxisAngle(new a.Vector3(0,0,1),15*Math.PI/180),_=q.clone().applyAxisAngle(new a.Vector3(0,0,1),15*-Math.PI/180),R=D.clone().add(W),v=D.clone().add(_),V=u.MxThreeJS.createLine(L.toSmallcoord(R),L.toSmallcoord(D),16777215);L.getTheTempDrawContainer_SmallCoord().add(V),this.m_vecDynDrawEntity.push(V);var Y=u.MxThreeJS.createLine(L.toSmallcoord(v),L.toSmallcoord(D),16777215);L.getTheTempDrawContainer_SmallCoord().add(Y),this.m_vecDynDrawEntity.push(Y)}},H.prototype.ClearDisplay=function(){this.ClearDynDrawEntity()},H.prototype.ReSetTempDisplay=function(){this.ClearDynDrawEntity()},H.prototype.Init=function(){},H);function H(G){this.m_vecDynDrawEntity=[],this.m_mxJig=null,this.m_mxJig=G}o.MxOffsetArrow=I},{"../MxFun":27,"../MxThreeJS":37,"../MxTools":38,three:19}],57:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxPolarAxisTrace=void 0;var a=T("three"),x=T("./MxJigCmdManager"),u=T("../MxFun"),M=T("../MxDrawData"),I=T("../MxTools"),H=T("../MxManager"),G=T("../MxThreeJS"),L=(y.prototype.ClearDynDrawEntity=function(){for(var D=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),C=this.m_vecDynDrawEntity.length,B=0;B<C;B++)u.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[B],D);this.m_vecDynDrawEntity=[]},y.prototype.CreteTracePoint=function(D,C){var B=this.m_mxJig.getMxObject(),z=B.getTheTempDrawContainer_SmallCoord();C/=2;var A=G.MxThreeJS.createLine(B.toSmallcoord2(D.x+C,D.y+C,0),B.toSmallcoord2(D.x-C,D.y-C,0),16711680);z.add(A),this.m_vecDynDrawEntity.push(A);var S=G.MxThreeJS.createLine(B.toSmallcoord2(D.x-C,D.y+C,0),B.toSmallcoord2(D.x+C,D.y-C,0),16711680);z.add(S),this.m_vecDynDrawEntity.push(S)},y.prototype.MouseMove=function(D){var C=this.m_mxJig.getMxObject();if(C.getMcObject().isValid()){if(this.ClearDynDrawEntity(),this.m_isValidTracePoint=!1,this.m_isTrace&&C.sysVariable().getSysVarNumber("GETPOINTSTATUS")&x.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint){var B=C.sysVariable().getSysVarPoint("LASTPOINT"),z=C.getSysVarDouble("POLARANG");if(z=180*z/Math.PI,!((z=Math.abs(z))<.001)){var A=C.viewCoordLong2Cad(M.MxDrawData.m_dInputRectWidth),S=2*A,q=D.clone().sub(B);if(!(q.length()<S)){q.normalize();var W=H.MxManager.getMxCpp().getMxCAD_MxCpp(),_=H.MxManager.getMxCpp().getMxCAD_App(),R=C.getTheTempDrawContainer_SmallCoord(),v=C.viewCoordLong2Cad(this.m_dashedLineLen);q=W.newMcGeVector3d(q);var V=W.newMcGeVector3d(new a.Vector3(1,0,0)),Y=q.angleTo2(V),c=(Y=180*Y/Math.PI)%z;c<z/2?Y-=c:Y+=z-c;var p=C.viewCoordLong2Cad(C.getViewWidth()),m=C.viewCoordLong2Cad(C.getViewHeight()),f=I.MxTools.MxMax(p,m);(q=V.clone()).rotateBy(Y*Math.PI/180),q.mult(f);var N=new a.Vector3(B.x+q.x,B.y+q.y,B.z+q.z),P={pt1:N,pt2:B},O=_.MxCADAssist.GetClosestPointTo(P.pt1.x,P.pt1.y,P.pt2.x,P.pt2.y,D.x,D.y,!0);if(0<O.length()){var Z=O.at(0),te=new a.Vector3(Z.x,Z.y,Z.z);if(te.distanceTo(D)<S){var de=G.MxThreeJS.createDashedLine(C.toSmallcoord2(B.x-q.x,B.y-q.y,B.z-q.z),C.toSmallcoord(N),this.m_iDashedLineLenColor,v,v);R.add(de),this.m_vecDynDrawEntity.push(de),this.m_isValidTracePoint=!0,this.m_ptTracePoint=te,this.CreteTracePoint(te,A)}}}}}}else this.m_isTrace=!1},y.prototype.Init=function(){var D=this.m_mxJig.getMxObject();D.getMcObject().isValid()?(this.m_isValidTracePoint=!1,this.m_isTrace=!1,8&D.getSysVarLong("AUTOSNAP")&&(this.m_isTrace=!0),D.sysVariable().getSysVarNumber("GETPOINTSTATUS")&x.MxJigCmdManager.GETPOINTSTATUS.OsModePoloarTempDisable&&(this.m_isTrace=!1),this.m_mxJig.isDisablePolarAxisTrace()&&(this.m_isTrace=!1),this.m_isTrace):this.m_isTrace=!1},y.prototype.GetTracePoint=function(){if(this.m_isTrace)return this.m_isValidTracePoint?this.m_ptTracePoint:void 0},y.prototype.ClearDisplay=function(){this.ClearDynDrawEntity()},y.prototype.ReSetTempDisplay=function(){this.ClearDynDrawEntity(),this.m_isValidTracePoint=!1},y);function y(D){this.m_vecDynDrawEntity=[],this.m_ptTracePoint=new a.Vector3,this.m_isValidTracePoint=!1,this.m_isTrace=!1,this.m_mxJig=null,this.m_dashedLineLen=1.5,this.m_iDashedLineLenColor=11184810,this.m_mxJig=D}o.MxPolarAxisTrace=L},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxThreeJS":37,"../MxTools":38,"./MxJigCmdManager":54,three:19}],58:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0});var a=T("./MxFun");window.MXFUN_THREE=a.MxFun.getTHREE();var x=T("./MxManager");function u(){}(u.CreateMx=function(){a.MxFun.init(),typeof MxMain<"u"&&MxMain(T)==0||a.MxFun.createMxObject(),x.MxManager.callEvent("init");var M=a.MxFun.getUiObject();M!=null&&(M.sTitle=a.MxFun.getCurrentDraw().getFileTitle(),setTimeout(function(){M.init()},400))},u.Main=function(){if(typeof MxUiMain<"u"){MxUiMain(T);var M=a.MxFun.getUiObject();M!=null&&M.writeUICSS()}typeof MxDocumentReady>"u"?$(document).ready(function(){u.CreateMx()}):MxDocumentReady(T,u.CreateMx)},u).Main()},{"./MxFun":27,"./MxManager":29}],59:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxSvgManager=void 0;var a=T("three"),x=T("three"),u=T("./SVGLoader"),M=function(){this.svg=new a.Group,this.aryMeterial=[],this.boxSize=new x.Vector3(1,1,1)},I=(H.prototype.loadSVGImp=function(y,D,C,B){new u.SVGLoader().load(y,function(z){if(z.paths.length){var A=[],S=z.paths,q=new a.Group,W=!0,_=!0,R=!1,v=!1;B&&(B.drawStrokes&&(W=B.drawStrokes),B.drawFillShapes&&(_=B.drawFillShapes),B.fillShapesWireframe&&(R=B.fillShapesWireframe),B.strokesWireframe&&(v=B.strokesWireframe));for(var V=0;V<S.length;V++){var Y=S[V],c=Y.userData.style.fill;if(_&&c!==void 0&&c!=="none"){for(var p=new a.MeshBasicMaterial({color:D||new a.Color().setStyle(c),opacity:Y.userData.style.fillOpacity,transparent:Y.userData.style.fillOpacity<1,side:a.DoubleSide,depthWrite:!1,wireframe:R}),m=u.SVGLoader.createShapes(Y),f=0;f<m.length;f++){var N=m[f],P=new a.ShapeBufferGeometry(N),O=new a.Mesh(P,p);q.add(O)}A.push(p)}var Z=Y.userData.style.stroke;if(W&&Z!==void 0&&Z!=="none"){p=new a.MeshBasicMaterial({color:D||new a.Color().setStyle(Z),opacity:Y.userData.style.strokeOpacity,transparent:Y.userData.style.strokeOpacity<1,side:a.DoubleSide,depthWrite:!1,wireframe:v}),f=0;for(var te=Y.subPaths.length;f<te;f++){var de=Y.subPaths[f];(P=u.SVGLoader.pointsToStroke(de.getPoints(),Y.userData.style,12,.001))&&(O=new a.Mesh(P,p),q.add(O))}A.push(p)}}C&&C(q,A)}else console.log("mx svg:"+y+" data.paths.length == 0"),C&&C(null,null)},void 0,function(){C&&C(null,null)})},H.prototype.loadSVG=function(y,D,C,B){var z=this,A=this.mapSvgUrlToData.get(y),S=!B||!B.useBuffer||B.useBuffer;if(A&&S){if(C)if(A==null)C(null,null);else{var q=A.svg.clone();q.boxSize=A.boxSize,C(q,A.aryMeterial)}}else this.loadSVGImp(y,D,function(W,_){if(W&&_){var R=new M;R.svg=W,R.aryMeterial=_;var v=new x.Box3().setFromObject(W);R.boxSize.x=v.max.x-v.min.x,R.boxSize.y=v.max.y-v.min.y,R.boxSize.x!==-1/0&&R.boxSize.y!==-1/0||console.log("mx svg:"+y+" boxSize invalid"),z.mapSvgUrlToData.set(y,R);var V=R.svg.clone();V.boxSize=R.boxSize,C&&C(V,R.aryMeterial)}else z.mapSvgUrlToData.set(y,null),C&&C(null,null)},B)},H);function H(){this.mapSvgUrlToData=new Map}var G=(L.prototype.loadSVG=function(y,D,C,B){C&&this.mxThreeJsBuffer.loadSVG(y,D,C,B)},L);function L(){this.mxThreeJsBuffer=new I}o.MxSvgManager=G},{"./SVGLoader":60,three:19}],60:[function(T,r,o){var a,x=this&&this.__extends||(a=function(G,L){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,D){y.__proto__=D}||function(y,D){for(var C in D)Object.prototype.hasOwnProperty.call(D,C)&&(y[C]=D[C])})(G,L)},function(G,L){if(typeof L!="function"&&L!==null)throw new TypeError("Class extends value "+String(L)+" is not a constructor or null");function y(){this.constructor=G}a(G,L),G.prototype=L===null?Object.create(L):(y.prototype=L.prototype,new y)});Object.defineProperty(o,"__esModule",{value:!0}),o.SVGLoader=void 0;var u,M=T("three"),I=(x(H,u=M.Loader),H.prototype.load=function(G,L,y,D){var C=this,B=new M.FileLoader(C.manager);B.setPath(C.path),B.setRequestHeader(C.requestHeader),B.setWithCredentials(C.withCredentials),B.load(G,function(z){try{L(C.parse(z))}catch(A){D?D(A):console.error(A),C.manager.itemError(G)}},y,D)},H.prototype.parse=function(G){var L=this;function y(P,O,Z,te,de,me,we,ge){if(O!=0&&Z!=0){te=te*Math.PI/180,O=Math.abs(O),Z=Math.abs(Z);var Le=(we.x-ge.x)/2,Pe=(we.y-ge.y)/2,ae=Math.cos(te)*Le+Math.sin(te)*Pe,ve=-Math.sin(te)*Le+Math.cos(te)*Pe,Ie=O*O,ze=Z*Z,He=ae*ae,at=ve*ve,tt=He/Ie+at/ze;if(1<tt){var le=Math.sqrt(tt);Ie=(O*=le)*O,ze=(Z*=le)*Z}var De=Ie*at+ze*He,st=(Ie*ze-De)/De,gt=Math.sqrt(Math.max(0,st));de===me&&(gt=-gt);var St=gt*O*ve/Z,Rt=-gt*Z*ae/O,Pt=Math.cos(te)*St-Math.sin(te)*Rt+(we.x+ge.x)/2,Je=Math.sin(te)*St+Math.cos(te)*Rt+(we.y+ge.y)/2,bt=D(1,0,(ae-St)/O,(ve-Rt)/Z),jt=D((ae-St)/O,(ve-Rt)/Z,(-ae-St)/O,(-ve-Rt)/Z)%(2*Math.PI);P.currentPath.absellipse(Pt,Je,O,Z,bt,bt+jt,me===0,te)}else P.lineTo(ge.x,ge.y)}function D(P,O,Z,te){var de=P*Z+O*te,me=Math.sqrt(P*P+O*O)*Math.sqrt(Z*Z+te*te),we=Math.acos(Math.max(-1,Math.min(1,de/me)));return P*te-O*Z<0&&(we=-we),we}function C(P,O){O=Object.assign({},O);var Z={};if(P.hasAttribute("class"))for(var te=P.getAttribute("class").split(/\s/).filter(Boolean).map(function(Le){return Le.trim()}),de=0;de<te.length;de++)Z=Object.assign(Z,_["."+te[de]]);function me(Le,Pe,ae){ae===void 0&&(ae=function(ve){return ve.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),ve}),P.hasAttribute(Le)&&(O[Pe]=ae(P.getAttribute(Le))),Z[Le]&&(O[Pe]=ae(Z[Le])),P.style&&P.style[Le]!==""&&(O[Pe]=ae(P.style[Le]))}function we(Le){return Math.max(0,Math.min(1,q(Le)))}function ge(Le){return Math.max(0,q(Le))}return P.hasAttribute("id")&&(Z=Object.assign(Z,_["#"+P.getAttribute("id")])),me("fill","fill"),me("fill-opacity","fillOpacity",we),me("fill-rule","fillRule"),me("opacity","opacity",we),me("stroke","stroke"),me("stroke-opacity","strokeOpacity",we),me("stroke-width","strokeWidth",ge),me("stroke-linejoin","strokeLineJoin"),me("stroke-linecap","strokeLineCap"),me("stroke-miterlimit","strokeMiterLimit",ge),me("visibility","visibility"),O}function B(P,O){return P-(O-P)}function z(P,O,Z){if(typeof P!="string")throw new TypeError("Invalid input: "+typeof P);var te,de={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},me=0,we=!0,ge="",Le="",Pe=[];function ae(He,at,tt){var le=new SyntaxError('Unexpected character "'+He+'" at index '+at+".");throw le.partial=tt,le}function ve(){ge!==""&&(Le===""?Pe.push(Number(ge)):Pe.push(Number(ge)*Math.pow(10,Number(Le)))),Le=ge=""}for(var Ie=P.length,ze=0;ze<Ie;ze++)if(te=P[ze],Array.isArray(O)&&O.includes(Pe.length%Z)&&de.FLAGS.test(te))me=1,ge=te,ve();else{if(me===0){if(de.WHITESPACE.test(te))continue;if(de.DIGIT.test(te)||de.SIGN.test(te)){me=1,ge=te;continue}if(de.POINT.test(te)){me=2,ge=te;continue}de.COMMA.test(te)&&(we&&ae(te,ze,Pe),we=!0)}if(me===1){if(de.DIGIT.test(te)){ge+=te;continue}if(de.POINT.test(te)){ge+=te,me=2;continue}if(de.EXP.test(te)){me=3;continue}de.SIGN.test(te)&&ge.length===1&&de.SIGN.test(ge[0])&&ae(te,ze,Pe)}if(me===2){if(de.DIGIT.test(te)){ge+=te;continue}if(de.EXP.test(te)){me=3;continue}de.POINT.test(te)&&ge[ge.length-1]==="."&&ae(te,ze,Pe)}if(me===3){if(de.DIGIT.test(te)){Le+=te;continue}if(de.SIGN.test(te)){if(Le===""){Le+=te;continue}Le.length===1&&de.SIGN.test(Le)&&ae(te,ze,Pe)}}de.WHITESPACE.test(te)?(ve(),me=0,we=!1):de.COMMA.test(te)?(ve(),we=!(me=0)):de.SIGN.test(te)?(ve(),me=1,ge=te):de.POINT.test(te)?(ve(),me=2,ge=te):ae(te,ze,Pe)}return ve(),Pe}var A=["mm","cm","in","pt","pc","px"],S={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function q(P){var O="px";if(typeof P=="string"||P instanceof String)for(var Z=0,te=A.length;Z<te;Z++){var de=A[Z];if(P.endsWith(de)){O=de,P=P.substring(0,P.length-de.length);break}}var me=void 0;return O==="px"&&L.defaultUnit!=="px"?me=S.in[L.defaultUnit]/L.defaultDPI:(me=S[O][L.defaultUnit])<0&&(me=S[O].in*L.defaultDPI),me*parseFloat(P)}var W=[],_={},R=[],v=new M.Matrix3,V=new M.Matrix3,Y=new M.Matrix3,c=new M.Matrix3,p=new M.Vector2,m=new M.Vector3,f=new M.Matrix3,N=new DOMParser().parseFromString(G,"image/svg+xml");return function P(O,Z){if(O.nodeType===1){var te,de,me,we,ge,Le,Pe,ae,ve,Ie,ze,He,at=function(Rt){if(!(Rt.hasAttribute("transform")||Rt.nodeName==="use"&&(Rt.hasAttribute("x")||Rt.hasAttribute("y"))))return null;var Pt=function(Je){var bt=new M.Matrix3,jt=v;if(Je.nodeName==="use"&&(Je.hasAttribute("x")||Je.hasAttribute("y"))){var Ln=q(Je.getAttribute("x")),Yt=q(Je.getAttribute("y"));bt.translate(Ln,Yt)}if(Je.hasAttribute("transform"))for(var Qt=Je.getAttribute("transform").split(")"),Ve=Qt.length-1;0<=Ve;Ve--){var Be=Qt[Ve].trim();if(Be!==""){var Wt=Be.indexOf("("),Kn=Be.length;if(0<Wt&&Wt<Kn){var nn=Be.substr(0,Wt),ct=z(Be.substr(Wt+1,Kn-Wt-1));switch(jt.identity(),nn){case"translate":1<=ct.length&&(Yt=Ln=ct[0],2<=ct.length&&(Yt=ct[1]),jt.translate(Ln,Yt));break;case"rotate":if(1<=ct.length){var rt,Zt=0,bn=0;rt=-ct[0]*Math.PI/180,3<=ct.length&&(Zt=ct[1],bn=ct[2]),V.identity().translate(-Zt,-bn),Y.identity().rotate(rt),c.multiplyMatrices(Y,V),V.identity().translate(Zt,bn),jt.multiplyMatrices(V,c)}break;case"scale":if(1<=ct.length){var Kt=ct[0],Zn=Kt;2<=ct.length&&(Zn=ct[1]),jt.scale(Kt,Zn)}break;case"skewX":ct.length===1&&jt.set(1,Math.tan(ct[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":ct.length===1&&jt.set(1,0,0,Math.tan(ct[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":ct.length===6&&jt.set(ct[0],ct[2],ct[4],ct[1],ct[3],ct[5],0,0,1)}}bt.premultiply(jt)}}return bt}(Rt);return 0<R.length&&Pt.premultiply(R[R.length-1]),f.copy(Pt),R.push(Pt),Pt}(O),tt=!0,le=null;switch(O.nodeName){case"svg":break;case"style":(function(Rt){if(Rt.sheet&&Rt.sheet.cssRules&&Rt.sheet.cssRules.length)for(var Pt=0;Pt<Rt.sheet.cssRules.length;Pt++){var Je=Rt.sheet.cssRules[Pt];if(Je.type===1)for(var bt=Je.selectorText.split(/,/gm).filter(Boolean).map(function(Ln){return Ln.trim()}),jt=0;jt<bt.length;jt++)_[bt[jt]]=Object.assign(_[bt[jt]]||{},Je.style)}})(O);break;case"g":Z=C(O,Z);break;case"path":Z=C(O,Z),O.hasAttribute("d")&&(le=function(Rt){for(var Pt=new M.ShapePath,Je=new M.Vector2,bt=new M.Vector2,jt=new M.Vector2,Ln=!0,Yt=!1,Qt=Rt.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),Ve=0,Be=Qt.length;Ve<Be;Ve++){var Wt=Qt[Ve],Kn=Wt.charAt(0),nn=Wt.substr(1).trim();Ln===!0&&(Ln=!(Yt=!0));var ct=void 0;switch(Kn){case"M":for(var rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt+=2)Je.x=ct[rt+0],Je.y=ct[rt+1],bt.x=Je.x,bt.y=Je.y,rt===0?Pt.moveTo(Je.x,Je.y):Pt.lineTo(Je.x,Je.y),rt===0&&jt.copy(Je);break;case"H":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt++)Je.x=ct[rt],bt.x=Je.x,bt.y=Je.y,Pt.lineTo(Je.x,Je.y),rt===0&&Yt===!0&&jt.copy(Je);break;case"V":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt++)Je.y=ct[rt],bt.x=Je.x,bt.y=Je.y,Pt.lineTo(Je.x,Je.y),rt===0&&Yt===!0&&jt.copy(Je);break;case"L":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt+=2)Je.x=ct[rt+0],Je.y=ct[rt+1],bt.x=Je.x,bt.y=Je.y,Pt.lineTo(Je.x,Je.y),rt===0&&Yt===!0&&jt.copy(Je);break;case"C":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt+=6)Pt.bezierCurveTo(ct[rt+0],ct[rt+1],ct[rt+2],ct[rt+3],ct[rt+4],ct[rt+5]),bt.x=ct[rt+2],bt.y=ct[rt+3],Je.x=ct[rt+4],Je.y=ct[rt+5],rt===0&&Yt===!0&&jt.copy(Je);break;case"S":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt+=4)Pt.bezierCurveTo(B(Je.x,bt.x),B(Je.y,bt.y),ct[rt+0],ct[rt+1],ct[rt+2],ct[rt+3]),bt.x=ct[rt+0],bt.y=ct[rt+1],Je.x=ct[rt+2],Je.y=ct[rt+3],rt===0&&Yt===!0&&jt.copy(Je);break;case"Q":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt+=4)Pt.quadraticCurveTo(ct[rt+0],ct[rt+1],ct[rt+2],ct[rt+3]),bt.x=ct[rt+0],bt.y=ct[rt+1],Je.x=ct[rt+2],Je.y=ct[rt+3],rt===0&&Yt===!0&&jt.copy(Je);break;case"T":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt+=2){var bn=B(Je.x,bt.x),Kt=B(Je.y,bt.y);Pt.quadraticCurveTo(bn,Kt,ct[rt+0],ct[rt+1]),bt.x=bn,bt.y=Kt,Je.x=ct[rt+0],Je.y=ct[rt+1],rt===0&&Yt===!0&&jt.copy(Je)}break;case"A":for(rt=0,Zt=(ct=z(nn,[3,4],7)).length;rt<Zt;rt+=7)if(ct[rt+5]!=Je.x||ct[rt+6]!=Je.y){var Zn=Je.clone();Je.x=ct[rt+5],Je.y=ct[rt+6],bt.x=Je.x,bt.y=Je.y,y(Pt,ct[rt],ct[rt+1],ct[rt+2],ct[rt+3],ct[rt+4],Zn,Je),rt===0&&Yt===!0&&jt.copy(Je)}break;case"m":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt+=2)Je.x+=ct[rt+0],Je.y+=ct[rt+1],bt.x=Je.x,bt.y=Je.y,rt===0?Pt.moveTo(Je.x,Je.y):Pt.lineTo(Je.x,Je.y),rt===0&&jt.copy(Je);break;case"h":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt++)Je.x+=ct[rt],bt.x=Je.x,bt.y=Je.y,Pt.lineTo(Je.x,Je.y),rt===0&&Yt===!0&&jt.copy(Je);break;case"v":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt++)Je.y+=ct[rt],bt.x=Je.x,bt.y=Je.y,Pt.lineTo(Je.x,Je.y),rt===0&&Yt===!0&&jt.copy(Je);break;case"l":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt+=2)Je.x+=ct[rt+0],Je.y+=ct[rt+1],bt.x=Je.x,bt.y=Je.y,Pt.lineTo(Je.x,Je.y),rt===0&&Yt===!0&&jt.copy(Je);break;case"c":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt+=6)Pt.bezierCurveTo(Je.x+ct[rt+0],Je.y+ct[rt+1],Je.x+ct[rt+2],Je.y+ct[rt+3],Je.x+ct[rt+4],Je.y+ct[rt+5]),bt.x=Je.x+ct[rt+2],bt.y=Je.y+ct[rt+3],Je.x+=ct[rt+4],Je.y+=ct[rt+5],rt===0&&Yt===!0&&jt.copy(Je);break;case"s":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt+=4)Pt.bezierCurveTo(B(Je.x,bt.x),B(Je.y,bt.y),Je.x+ct[rt+0],Je.y+ct[rt+1],Je.x+ct[rt+2],Je.y+ct[rt+3]),bt.x=Je.x+ct[rt+0],bt.y=Je.y+ct[rt+1],Je.x+=ct[rt+2],Je.y+=ct[rt+3],rt===0&&Yt===!0&&jt.copy(Je);break;case"q":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt+=4)Pt.quadraticCurveTo(Je.x+ct[rt+0],Je.y+ct[rt+1],Je.x+ct[rt+2],Je.y+ct[rt+3]),bt.x=Je.x+ct[rt+0],bt.y=Je.y+ct[rt+1],Je.x+=ct[rt+2],Je.y+=ct[rt+3],rt===0&&Yt===!0&&jt.copy(Je);break;case"t":for(rt=0,Zt=(ct=z(nn)).length;rt<Zt;rt+=2)bn=B(Je.x,bt.x),Kt=B(Je.y,bt.y),Pt.quadraticCurveTo(bn,Kt,Je.x+ct[rt+0],Je.y+ct[rt+1]),bt.x=bn,bt.y=Kt,Je.x=Je.x+ct[rt+0],Je.y=Je.y+ct[rt+1],rt===0&&Yt===!0&&jt.copy(Je);break;case"a":for(rt=0,Zt=(ct=z(nn,[3,4],7)).length;rt<Zt;rt+=7)ct[rt+5]==0&&ct[rt+6]==0||(Zn=Je.clone(),Je.x+=ct[rt+5],Je.y+=ct[rt+6],bt.x=Je.x,bt.y=Je.y,y(Pt,ct[rt],ct[rt+1],ct[rt+2],ct[rt+3],ct[rt+4],Zn,Je),rt===0&&Yt===!0&&jt.copy(Je));break;case"Z":case"z":Pt.currentPath.autoClose=!0,0<Pt.currentPath.curves.length&&(Je.copy(jt),Pt.currentPath.currentPoint.copy(Je),Ln=!0);break;default:console.warn(Wt)}Yt=!1}return Pt}(O));break;case"rect":Z=C(O,Z),le=function(Rt){var Pt=q(Rt.getAttribute("x")||0),Je=q(Rt.getAttribute("y")||0),bt=q(Rt.getAttribute("rx")||Rt.getAttribute("ry")||0),jt=q(Rt.getAttribute("ry")||Rt.getAttribute("rx")||0),Ln=q(Rt.getAttribute("width")),Yt=q(Rt.getAttribute("height")),Qt=.448084975506,Ve=new M.ShapePath;return Ve.moveTo(Pt+bt,Je),Ve.lineTo(Pt+Ln-bt,Je),bt===0&&jt===0||Ve.bezierCurveTo(Pt+Ln-bt*Qt,Je,Pt+Ln,Je+jt*Qt,Pt+Ln,Je+jt),Ve.lineTo(Pt+Ln,Je+Yt-jt),bt===0&&jt===0||Ve.bezierCurveTo(Pt+Ln,Je+Yt-jt*Qt,Pt+Ln-bt*Qt,Je+Yt,Pt+Ln-bt,Je+Yt),Ve.lineTo(Pt+bt,Je+Yt),bt===0&&jt===0||Ve.bezierCurveTo(Pt+bt*Qt,Je+Yt,Pt,Je+Yt-jt*Qt,Pt,Je+Yt-jt),Ve.lineTo(Pt,Je+jt),bt===0&&jt===0||Ve.bezierCurveTo(Pt,Je+jt*Qt,Pt+bt*Qt,Je,Pt+bt,Je),Ve}(O);break;case"polygon":Z=C(O,Z),Ie=O,ze=new M.ShapePath,He=0,Ie.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,function(Rt,Pt,Je){var bt=q(Pt),jt=q(Je);He===0?ze.moveTo(bt,jt):ze.lineTo(bt,jt),He++}),ze.currentPath.autoClose=!0,le=ze;break;case"polyline":Z=C(O,Z),Pe=O,ae=new M.ShapePath,ve=0,Pe.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,function(Rt,Pt,Je){var bt=q(Pt),jt=q(Je);ve===0?ae.moveTo(bt,jt):ae.lineTo(bt,jt),ve++}),ae.currentPath.autoClose=!1,le=ae;break;case"circle":Z=C(O,Z),le=function(Rt){var Pt=q(Rt.getAttribute("cx")||0),Je=q(Rt.getAttribute("cy")||0),bt=q(Rt.getAttribute("r")||0),jt=new M.Path;jt.absarc(Pt,Je,bt,0,2*Math.PI,!1);var Ln=new M.ShapePath;return Ln.subPaths.push(jt),Ln}(O);break;case"ellipse":Z=C(O,Z),le=function(Rt){var Pt=q(Rt.getAttribute("cx")||0),Je=q(Rt.getAttribute("cy")||0),bt=q(Rt.getAttribute("rx")||0),jt=q(Rt.getAttribute("ry")||0),Ln=new M.Path;Ln.absellipse(Pt,Je,bt,jt,0,2*Math.PI,void 0,void 0);var Yt=new M.ShapePath;return Yt.subPaths.push(Ln),Yt}(O);break;case"line":Z=C(O,Z),de=q((te=O).getAttribute("x1")||0),me=q(te.getAttribute("y1")||0),we=q(te.getAttribute("x2")||0),ge=q(te.getAttribute("y2")||0),(Le=new M.ShapePath).moveTo(de,me),Le.lineTo(we,ge),Le.currentPath.autoClose=!1,le=Le;break;case"defs":tt=!1;break;case"use":Z=C(O,Z);var De=O.href.baseVal.substring(1),st=O.viewportElement.getElementById(De);st?P(st,Z):console.warn("SVGLoader: 'use node' references non-existent node id: "+De)}if(le&&(Z.fill!==void 0&&Z.fill!=="none"&&le.color.setStyle(Z.fill),function(Rt,Pt){function Je(nn){m.set(nn.x,nn.y,1).applyMatrix3(Pt),nn.set(m.x,m.y)}for(var bt=function(nn){return nn.elements[1]!==0||nn.elements[3]!==0}(Pt),jt=Rt.subPaths,Ln=0,Yt=jt.length;Ln<Yt;Ln++)for(var Qt=jt[Ln].curves,Ve=0;Ve<Qt.length;Ve++){var Be=Qt[Ve];Be.isLineCurve?(Je(Be.v1),Je(Be.v2)):Be.isCubicBezierCurve?(Je(Be.v0),Je(Be.v1),Je(Be.v2),Je(Be.v3)):Be.isQuadraticBezierCurve?(Je(Be.v0),Je(Be.v1),Je(Be.v2)):Be.isEllipseCurve&&(bt&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),p.set(Be.aX,Be.aY),Je(p),Be.aX=p.x,Be.aY=p.y,Be.xRadius*=(Kn=Pt.elements,Math.sqrt(Kn[0]*Kn[0]+Kn[1]*Kn[1])),Be.yRadius*=(Wt=Pt.elements,Math.sqrt(Wt[3]*Wt[3]+Wt[4]*Wt[4])))}var Wt,Kn}(le,f),W.push(le),le.userData={node:O,style:Z}),tt)for(var gt=O.childNodes,St=0;St<gt.length;St++)P(gt[St],Z);at&&(R.pop(),0<R.length?f.copy(R[R.length-1]):f.identity())}}(N.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:W,xml:N.documentElement}},H.createShapes=function(G){var L=999999999,y=0,D=1,C=2,B=3,z=4,A=5,S=6,q={loc:y,t:0};function W(f,N,P,O){var Z=f.x,te=N.x,de=P.x,me=O.x,we=f.y,ge=N.y,Le=P.y,Pe=O.y,ae=(me-de)*(we-Le)-(Pe-Le)*(Z-de),ve=(Pe-Le)*(te-Z)-(me-de)*(ge-we),Ie=ae/ve,ze=((te-Z)*(we-Le)-(ge-we)*(Z-de))/ve;if(ve==0&&ae!=0||Ie<=0||1<=Ie||ze<0||1<ze)return null;if(ae==0&&ve==0){for(var He=0;He<2;He++){if(_(He===0?P:O,f,N),q.loc==y)return{x:(at=He===0?P:O).x,y:at.y,t:q.t};if(q.loc==C)return{x:+(Z+q.t*(te-Z)).toPrecision(10),y:+(we+q.t*(ge-we)).toPrecision(10),t:q.t}}return null}for(He=0;He<2;He++){var at;if(_(He===0?P:O,f,N),q.loc==y)return{x:(at=He===0?P:O).x,y:at.y,t:q.t}}return{x:+(Z+Ie*(te-Z)).toPrecision(10),y:+(we+Ie*(ge-we)).toPrecision(10),t:Ie}}function _(f,N,P){var O,Z=P.x-N.x,te=P.y-N.y,de=f.x-N.x,me=f.y-N.y,we=Z*me-de*te;return f.x===N.x&&f.y===N.y?(q.loc=y,q.t=0):f.x===P.x&&f.y===P.y?(q.loc=D,q.t=1,0):void(we<-Number.EPSILON?q.loc=B:we>Number.EPSILON?q.loc=z:Z*de<0||te*me<0?q.loc=A:Math.sqrt(Z*Z+te*te)<Math.sqrt(de*de+me*me)?q.loc=S:(O=Z!=0?de/Z:me/te,q.loc=C,q.t=O))}function R(f,N,P){var O=new M.Vector2;N.getCenter(O);var Z=[];return P.forEach(function(te){te.boundingBox.containsPoint(O)&&function(de,me){for(var we=[],ge=[],Le=1;Le<de.length;Le++)for(var Pe=de[Le-1],ae=de[Le],ve=function(ze){var He=me[ze-1],at=me[ze],tt=W(Pe,ae,He,at);tt!==null&&we.find(function(le){return le.t<=tt.t+Number.EPSILON&&le.t>=tt.t-Number.EPSILON})===void 0&&(we.push(tt),ge.push(new M.Vector2(tt.x,tt.y)))},Ie=1;Ie<me.length;Ie++)ve(Ie);return ge}(f,te.points).forEach(function(de){Z.push({identifier:te.identifier,isCW:te.isCW,point:de})})}),Z.sort(function(te,de){return te.point.x-de.point.x}),Z}var v=0,V=L,Y=-L,c=G.subPaths.map(function(f){for(var N=f.getPoints(),P=-L,O=L,Z=-L,te=L,de=0;de<N.length;de++){var me=N[de];me.y>P&&(P=me.y),me.y<O&&(O=me.y),me.x>Z&&(Z=me.x),me.x<te&&(te=me.x)}return Y<=Z&&(Y=Z+1),te<=V&&(V=te-1),{curves:f.curves,points:N,isCW:M.ShapeUtils.isClockWise(N),identifier:v++,boundingBox:new M.Box2(new M.Vector2(te,O),new M.Vector2(Z,P))}});c=c.filter(function(f){return 1<f.points.length}),v=0;var p=(c=c.map(function(f){return f.identifier=v,v++,f})).map(function(f){return function(N,P,O,Z,te){te!=null&&te!==""||(te="nonzero");var de=new M.Vector2;N.boundingBox.getCenter(de);var me=R([new M.Vector2(O,de.y),new M.Vector2(Z,de.y)],N.boundingBox,P);me.sort(function(tt,le){return tt.point.x-le.point.x});var we=[],ge=[];me.forEach(function(tt){tt.identifier===N.identifier?we.push(tt):ge.push(tt)});for(var Le=we[0].point.x,Pe=[],ae=0;ae<ge.length&&ge[ae].point.x<Le;)0<Pe.length&&Pe[Pe.length-1]===ge[ae].identifier?Pe.pop():Pe.push(ge[ae].identifier),ae++;if(Pe.push(N.identifier),te==="evenodd"){var ve=Pe.length%2==0,Ie=Pe[Pe.length-2];return{identifier:N.identifier,isHole:ve,for:Ie}}if(te==="nonzero"){ve=!0;for(var ze=Ie=null,He=0;He<Pe.length;He++){var at=Pe[He];ve?(ze=P[at].isCW,ve=!1,Ie=at):ze!==P[at].isCW&&(ze=P[at].isCW,ve=!0)}return{identifier:N.identifier,isHole:ve,for:Ie}}console.warn('fill-rule: "'+te+'" is currently not implemented.')}(f,c,V,Y,G.userData.style.fillRule)}),m=[];return c.forEach(function(f){if(!p[f.identifier].isHole){var N=new M.Shape;N.curves=f.curves,p.filter(function(P){return P.isHole&&P.for===f.identifier}).forEach(function(P){var O=c[P.identifier],Z=new M.Path;Z.curves=O.curves,N.holes.push(Z)}),m.push(N)}}),m},H.getStrokeStyle=function(G,L,y,D,C){return{strokeColor:L=L!==void 0?L:"#000",strokeWidth:G=G!==void 0?G:1,strokeLineJoin:y=y!==void 0?y:"miter",strokeLineCap:D=D!==void 0?D:"butt",strokeMiterLimit:C=C!==void 0?C:4}},H.pointsToStroke=function(G,L,y,D){var C=[],B=[],z=[];if(H.pointsToStrokeWithBuffers(G,L,y,D,C,B,z)===0)return null;var A=new M.BufferGeometry;return A.setAttribute("position",new M.Float32BufferAttribute(C,3)),A.setAttribute("normal",new M.Float32BufferAttribute(B,3)),A.setAttribute("uv",new M.Float32BufferAttribute(z,2)),A},H.pointsToStrokeWithBuffers=function(G,L,y,D,C,B,z,A){var S=new M.Vector2,q=new M.Vector2,W=new M.Vector2,_=new M.Vector2,R=new M.Vector2,v=new M.Vector2,V=new M.Vector2,Y=new M.Vector2,c=new M.Vector2,p=new M.Vector2,m=new M.Vector2,f=new M.Vector2,N=new M.Vector2,P=new M.Vector2,O=new M.Vector2,Z=new M.Vector2,te=new M.Vector2;y=y!==void 0?y:12,D=D!==void 0?D:.001,A=A!==void 0?A:0;var de=(G=function(Zt){for(var bn=!1,Kt=1,Zn=Zt.length-1;Kt<Zn;Kt++)if(Zt[Kt].distanceTo(Zt[Kt+1])<D){bn=!0;break}if(!bn)return Zt;var Se=[];for(Se.push(Zt[0]),Kt=1,Zn=Zt.length-1;Kt<Zn;Kt++)Zt[Kt].distanceTo(Zt[Kt+1])>=D&&Se.push(Zt[Kt]);return Se.push(Zt[Zt.length-1]),Se}(G)).length;if(de<2)return 0;var me,we,ge,Le,Pe,ae,ve=G[0].equals(G[de-1]),Ie=G[0],ze=L.strokeWidth/2,He=1/(de-1),at=0,tt=!1,le=0,De=3*A,st=2*A;Ve(G[0],G[1],S).multiplyScalar(ze),Y.copy(G[0]).sub(S),c.copy(G[0]).add(S),p.copy(Y),m.copy(c);for(var gt=1;gt<de;gt++){me=G[gt],we=gt===de-1?ve?G[1]:void 0:G[gt+1];var St=S;if(Ve(Ie,me,St),W.copy(St).multiplyScalar(ze),f.copy(me).sub(W),N.copy(me).add(W),ge=at+He,Le=!1,we!==void 0){Ve(me,we,q),W.copy(q).multiplyScalar(ze),P.copy(me).sub(W),O.copy(me).add(W),Pe=!0,W.subVectors(we,Ie),St.dot(W)<0&&(Pe=!1),gt===1&&(tt=Pe),W.subVectors(we,me),W.normalize();var Rt=Math.abs(St.dot(W));if(Rt!==0){var Pt=ze/Rt;W.multiplyScalar(-Pt),_.subVectors(me,Ie),R.copy(_).setLength(Pt).add(W),Z.copy(R).negate();var Je=R.length(),bt=_.length();_.divideScalar(bt),v.subVectors(we,me);var jt=v.length();switch(v.divideScalar(jt),_.dot(Z)<bt&&v.dot(Z)<jt&&(Le=!0),te.copy(R).add(me),Z.add(me),ae=!1,Le?Pe?(O.copy(Z),N.copy(Z)):(P.copy(Z),f.copy(Z)):Kn(),L.strokeLineJoin){case"bevel":nn(Pe,Le,ge);break;case"round":ct(Pe,Le),Pe?Wt(me,f,P,ge,0):Wt(me,O,N,ge,1);break;default:var Ln=ze*L.strokeMiterLimit/Je;if(Ln<1){if(L.strokeLineJoin!=="miter-clip"){nn(Pe,Le,ge);break}ct(Pe,Le),Pe?(v.subVectors(te,f).multiplyScalar(Ln).add(f),V.subVectors(te,P).multiplyScalar(Ln).add(P),Be(f,ge,0),Be(v,ge,0),Be(me,ge,.5),Be(me,ge,.5),Be(v,ge,0),Be(V,ge,0),Be(me,ge,.5),Be(V,ge,0),Be(P,ge,0)):(v.subVectors(te,N).multiplyScalar(Ln).add(N),V.subVectors(te,O).multiplyScalar(Ln).add(O),Be(N,ge,1),Be(v,ge,1),Be(me,ge,.5),Be(me,ge,.5),Be(v,ge,1),Be(V,ge,1),Be(me,ge,.5),Be(V,ge,1),Be(O,ge,1))}else Le?(Pe?(Be(c,at,1),Be(Y,at,0),Be(te,ge,0),Be(c,at,1),Be(te,ge,0),Be(Z,ge,1)):(Be(c,at,1),Be(Y,at,0),Be(te,ge,1),Be(Y,at,0),Be(Z,ge,0),Be(te,ge,1)),Pe?P.copy(te):O.copy(te)):Pe?(Be(f,ge,0),Be(te,ge,0),Be(me,ge,.5),Be(me,ge,.5),Be(te,ge,0),Be(P,ge,0)):(Be(N,ge,1),Be(te,ge,1),Be(me,ge,.5),Be(me,ge,.5),Be(te,ge,1),Be(O,ge,1)),ae=!0}}else Kn()}else Kn();ve||gt!==de-1||rt(G[0],p,m,Pe,!0,at),at=ge,Ie=me,Y.copy(P),c.copy(O)}if(ve){if(Le&&C){var Yt=te,Qt=Z;tt!==Pe&&(Yt=Z,Qt=te),Pe?(ae||tt)&&(Qt.toArray(C,0),Qt.toArray(C,9),ae&&Yt.toArray(C,3)):!ae&&tt||(Qt.toArray(C,3),Qt.toArray(C,9),ae&&Yt.toArray(C,0))}}else rt(me,f,N,Pe,!1,ge);return le;function Ve(Zt,bn,Kt){return Kt.subVectors(bn,Zt),Kt.set(-Kt.y,Kt.x).normalize()}function Be(Zt,bn,Kt){C&&(C[De]=Zt.x,C[De+1]=Zt.y,C[De+2]=0,B&&(B[De]=0,B[De+1]=0,B[De+2]=1),De+=3,z&&(z[st]=bn,z[st+1]=Kt,st+=2)),le+=3}function Wt(Zt,bn,Kt,Zn,Se){S.copy(bn).sub(Zt).normalize(),q.copy(Kt).sub(Zt).normalize();var Cr=Math.PI,Xe=S.dot(q);Math.abs(Xe)<1&&(Cr=Math.abs(Math.acos(Xe))),Cr/=y,W.copy(bn);for(var qe=0,ut=y-1;qe<ut;qe++)_.copy(W).rotateAround(Zt,Cr),Be(W,Zn,Se),Be(_,Zn,Se),Be(Zt,Zn,.5),W.copy(_);Be(_,Zn,Se),Be(Kt,Zn,Se),Be(Zt,Zn,.5)}function Kn(){Be(c,at,1),Be(Y,at,0),Be(f,ge,0),Be(c,at,1),Be(f,ge,1),Be(N,ge,0)}function nn(Zt,bn,Kt){bn?(Zt?(Be(c,at,1),Be(Y,at,0),Be(f,ge,0),Be(c,at,1),Be(f,ge,0),Be(Z,ge,1),Be(f,Kt,0),Be(P,Kt,0)):(Be(c,at,1),Be(Y,at,0),Be(N,ge,1),Be(Y,at,0),Be(Z,ge,0),Be(N,ge,1),Be(N,Kt,1),Be(O,Kt,0)),Be(Z,Kt,.5)):(Zt?(Be(f,Kt,0),Be(P,Kt,0)):(Be(N,Kt,1),Be(O,Kt,0)),Be(me,Kt,.5))}function ct(Zt,bn){bn&&(Zt?(Be(c,at,1),Be(Y,at,0),Be(f,ge,0),Be(c,at,1),Be(f,ge,0),Be(Z,ge,1),Be(f,at,0),Be(me,ge,.5),Be(Z,ge,1),Be(me,ge,.5),Be(P,at,0),Be(Z,ge,1)):(Be(c,at,1),Be(Y,at,0),Be(N,ge,1),Be(Y,at,0),Be(Z,ge,0),Be(N,ge,1),Be(N,at,1),Be(Z,ge,0),Be(me,ge,.5),Be(me,ge,.5),Be(Z,ge,0),Be(O,at,1)))}function rt(Zt,bn,Kt,Zn,Se,Cr){switch(L.strokeLineCap){case"round":Se?Wt(Zt,Kt,bn,Cr,.5):Wt(Zt,bn,Kt,Cr,.5);break;case"square":if(Se)S.subVectors(bn,Zt),q.set(S.y,-S.x),W.addVectors(S,q).add(Zt),_.subVectors(q,S).add(Zt),Zn?(W.toArray(C,3),_.toArray(C,0),_.toArray(C,9)):(W.toArray(C,3),W.toArray(C,9),_.toArray(C,0));else{S.subVectors(Kt,Zt),q.set(S.y,-S.x),W.addVectors(S,q).add(Zt),_.subVectors(q,S).add(Zt);var Xe=C.length;Zn?(W.toArray(C,Xe-3),_.toArray(C,Xe-6)):(W.toArray(C,Xe-6),_.toArray(C,Xe-3)),_.toArray(C,Xe-12)}}}},H);function H(G){var L=u.call(this,G)||this;return L.defaultDPI=90,L.defaultUnit="px",L}o.SVGLoader=I},{three:19}],61:[function(T,r,o){var a,x=this&&this.__extends||(a=function(c,p){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,f){m.__proto__=f}||function(m,f){for(var N in f)Object.prototype.hasOwnProperty.call(f,N)&&(m[N]=f[N])})(c,p)},function(c,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");function m(){this.constructor=c}a(c,p),c.prototype=p===null?Object.create(p):(m.prototype=p.prototype,new m)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxTest=void 0;var u,M,I,H=T("../Operate/MrxDbgUiPrBase"),G=T("../Operate/MrxDbgUiPrPoint"),L=T("../MxThreeJS"),y=T("three"),D=T("../MxFun"),C=T("../View/MxDbEntity"),B=T("../MrxDbgUtils"),z=T("../Operate/MrxDbgUiPrDist"),A=(T("../MxString"),x(S,u=C.MxDbEntityUserObject),S.prototype.worldDraw=function(c){var p=new y.Vector3(this.pt.x-this.r,this.pt.y-this.r,0),m=new y.Vector3(this.pt.x+this.r,this.pt.y+this.r,0);new y.Vector3(p.x,m.y);var f=new y.Vector3(m.x,p.y);c.setDashLineDisplay(!0),c.setDash(.1,.2),c.drawLine(f,p)},S.prototype.setPoint=function(c){this.pt=c},S.prototype.setR=function(c){this.r=c},S.prototype.getTypeName=function(){return"MxDbTest"},S.prototype.getGripPoints=function(){var c=[];return c.push(this.pt),c},S.prototype.moveGripPointsAt=function(c,p){return c==0&&this.pt.add(p),!0},S.prototype.dwgIn=function(c){return u.prototype.dwgIn.call(this,c),this.pt.copy(c.pt),this.r=c.r,!0},S.prototype.dwgOut=function(c){return u.prototype.dwgOut.call(this,c),c.pt=this.pt,c.r=this.r,c},S.prototype.create=function(){return new S},S);function S(){var c=u!==null&&u.apply(this,arguments)||this;return c.pt=new y.Vector3,c.r=100,c}function q(c){var p=new G.MrxDbgUiPrPoint;p.setMessage(`
指定第一点:`),p.go(function(m){if(m==0){var f=p.value(),N=new y.Vector3;N.x=f.x,N.y=f.y;var P=new H.McEdGetPointWorldDrawObject;P.setDraw(function(O,Z){Z.setColor(255),Z.drawLine(O,N)}),p.setUserDraw(P),p.setMessage(`
指定下一点:`),p.go(function(O){if(O==0){var Z=p.value(),te=D.MxFun.getCurrentDraw(),de=L.MxThreeJS.createLine(f,Z,16777215);te.addObject(de)}})}})}function W(){var c=new G.MrxDbgUiPrPoint;c.setMessage(`
指定第一点:`),c.go(function(p){if(p==0){var m=D.MxFun.getCurrentDraw(),f=new A;f.setColor(16711680),f.setPoint(c.value()),f.setR(m.viewCoordLong2Cad(100)),m.addMxEntity(f),m.addMxCurrentSelect(f.objectId())}})}function _(){B.MrxDbgUtils.selectEnt("Test").then(function(c){console.log(c)})}function R(){var c=D.MxFun.getCurrentDraw();I?(c.eraseAllMxEntity(),c.loadMxEntityFromJson(I)):(I=c.saveMxEntityToJson(),console.log(I))}function v(){D.MxFun.openFile("demo/buf/hhhh.dwg?token=123456")}function V(){var c=new G.MrxDbgUiPrPoint;c.setMessage(`
指定第一点:`),c.go(function(p){if(p==0){var m=c.value();B.MrxDbgUtils.getCorner(m,"Test",!0).then(function(f){console.log("xxxdddd"),console.log(f)})}})}function Y(){var c=new z.MrxDbgUiPrDist;c.setMessage(`
输入距离:`),c.go(function(p){if(p==0){var m=c.value();console.log(m)}})}(M||(o.MxTest=M={})).registerCommand=function(){console.log("regist mx test"),new A().init(),D.MxFun.addCommand("MxTest_GetPoint",q),D.MxFun.addCommand("MxTest_GetDist",Y),D.MxFun.addCommand("MxTest_DrawCustomEntity",W),D.MxFun.addCommand("MxTest_EntSel",_),D.MxFun.addCommand("MxTest_SaveMxDbEntityToJson",R),D.MxFun.addCommand("MxTest_OpenFile",v),D.MxFun.addCommand("MxTest_GetCorner",V),D.MxFun.addWindowsEvent(function(c,p){if(c=="mouseup"){if(D.MxFun.isRunningCommand()||p.button!=0)return 0;var m=p.srcElement;if(m&&m.tagName=="CANVAS"){var f=D.MxFun.getCurrentDraw(),N=new y.Vector3(p.offsetX,p.offsetY,0);f.findMxEntityAtPoint(N,!1).length&&p.preventDefault()}return 0}})}},{"../MrxDbgUtils":20,"../MxFun":27,"../MxString":34,"../MxThreeJS":37,"../Operate/MrxDbgUiPrBase":45,"../Operate/MrxDbgUiPrDist":46,"../Operate/MrxDbgUiPrPoint":47,"../View/MxDbEntity":69,three:19}],62:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.MxUiObject=exports.MxToolBarItem=exports.MxMenuItem=void 0;var MxFun_1=require("../MxFun"),MxMenuItem=function(){this.id=-1,this.text="",this.evalString="",this.parentId=-1};exports.MxMenuItem=MxMenuItem;var MxToolBarItem=function(){this.isMxCommand=!1,this.itemid=""};exports.MxToolBarItem=MxToolBarItem;var MxUiObject=function(){function MxUiObject(){this.vecMenuItem=new Array,this.vecToolBarItem=new Array,this.uiPath="./ui",this.idMenuItemCount=100,this.isShowTitle=!1,this.isShowStructTree=!1,this.isEnableLoading=!0,this.isShowLayer=!1,this.isShowTakeColor=!1,this.isShowLayout=!1,this.isEnableObjectProperty=!1,this.isShowToolbar=!1,this.isShowMainMenu=!1,this.sTitle="",this.sLanguageTable={layout:"布局",layer:"图层",visible:"可见",color:"颜色",name:"名字",status:"状态",openComplete:"提示：打开图纸完成"}}return MxUiObject.prototype.SetLayoutData=function(T){this.vecLayoutData=T},MxUiObject.prototype.CallMxCommand=function(T){MxFun_1.MxFun.callCommand(T,"")},MxUiObject.prototype.EvalJs=function(value){eval(value)},MxUiObject.prototype.SetLayerData=function(T){this.vecLayerData=T},MxUiObject.prototype.SetSketchLayerData=function(T){this.vecSketchLayerData=T},MxUiObject.prototype.init=function(){this.onInit()},MxUiObject.prototype.addMenuItem=function(T,r,o,a){r===void 0&&(r=""),o===void 0&&(o=-1),a===void 0&&(a=-1);var x=new MxMenuItem;x.text=T,x.evalString=r,a==-1&&(a=this.idMenuItemCount,this.idMenuItemCount++),x.id=a,x.parentId=o,this.vecMenuItem.push(x)},MxUiObject.prototype.addToolBarItem=function(T,r,o,a,x){r===void 0&&(r=""),o===void 0&&(o=""),a===void 0&&(a=!1),x===void 0&&(x="");var u=new MxToolBarItem;u.image=T,u.evalString=o,u.text=r,u.isMxCommand=a,u.itemid=x,this.vecToolBarItem.push(u)},MxUiObject.prototype.setPath=function(T){this.uiPath=T},MxUiObject.prototype.getPath=function(){return this.uiPath},MxUiObject.prototype.create=function(){this.onCreate()},MxUiObject.prototype.writeUICSS=function(){var T=this.uiPath;MxFun_1.MxFun.isPC()?(document.write("<link rel='stylesheet' href='"+T+"/css/mxbimpcm.css'>"),this.isShowMainMenu&&(document.write("<link rel='stylesheet' href='"+T+"/css/rightfacefonts2.css'>"),document.write("<link rel='stylesheet' href='"+T+"/css/rightmnu.css'>"),document.write("<script type='text/javascript' src='"+T+"/hc-mobile-nav.js'><\/script>"))):(document.write("<link rel='stylesheet' href='"+T+"/css/mxmobile.css'>"),this.isShowMainMenu&&(document.write("<link href='"+T+"/css/font-awesome.min.css' rel='stylesheet'>"),document.write("<link rel='stylesheet' href='"+T+"/css/rightfacefonts1.css'>"),document.write("<link rel='stylesheet' href='"+T+"/css/rightfacefonts2.css'>"),document.write("<link rel='stylesheet' href='"+T+"/css/rightmnu.css'>"),document.write("<script type='text/javascript' src='"+T+"/hc-mobile-nav.js'><\/script>")))},MxUiObject}();exports.MxUiObject=MxUiObject},{"../MxFun":27}],63:[function(T,r,o){var a,x=this&&this.__extends||(a=function(L,y){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,C){D.__proto__=C}||function(D,C){for(var B in C)Object.prototype.hasOwnProperty.call(C,B)&&(D[B]=C[B])})(L,y)},function(L,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function D(){this.constructor=L}a(L,y),L.prototype=y===null?Object.create(y):(D.prototype=y.prototype,new D)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxUiObjectMobile=void 0;var u,M=T("./MxUiObject"),I=T("../MxFun"),H=(x(G,u=M.MxUiObject),G.prototype.onCreate=function(){this.isShowTitle&&this.WriteTitle(),this.WriteStructTree(),this.isEnableLoading&&this.WriteLoading(),this.WriteLayer(),this.WriteTakeColor(),this.WriteLayout(),this.isEnableObjectProperty&&this.WriteObjectProperty(),this.isShowToolbar&&this.WriteToolbar()},G.prototype.onInit=function(){this.InitEvent()},G.prototype.ShowLoading=function(){this.isEnableLoading&&($(".Prompt").css("background","rgba(0, 0, 0, 0)"),$(".Prompt").fadeIn(100),$(".Prompt span").css("display","none"))},G.prototype.HideLoading=function(){this.isEnableLoading&&($(".Prompt").css("background","rgba(0, 0, 0, 0.8)"),$(".Prompt div").fadeOut(100),$(".Prompt span").fadeIn(200),setTimeout(function(){$(".Prompt").fadeOut(1e3)},1e3))},G.prototype.ShowObjectProperty=function(L){if(L.length!=0){var y;y=typeof L=="string"?JSON.parse(L):L;var D="";for(var C in y){var B=y[C];for(var z in D+='<tbody class="bf-group undefined bf-collapse">',D+='<tr class="bf-group-title">',D+='<td colspan="2"><i class="bf-icon" style=" padding: 12px;"></i>'+B.name+"</td>",D+="</tr>",B.datas){var A=B.datas[z];D+="<tr class='bf-group-content'>",D+="<td class='bf-key'>"+A.name+"</td>",D+="<td class='bf-value'>"+A.value+"</td>",D+="</tr>"}D+="</tbody>"}document.getElementById("ComponentContent").innerHTML=D,$(".bf-group").click(function(){$(this).hasClass("bf-collapse")?$(this).removeClass("bf-collapse"):$(this).addClass("bf-collapse")})}},G.prototype.HideObjectProp=function(){},G.prototype.SwitchShowLayer=function(){var L=document.getElementById("LayerInterface");L.style.display=="none"?(L.style.display="block",L.style.left="80px",L.style.top="50px"):L.style.display="none"},G.prototype.SwitchShowStructTree=function(){},G.prototype.Chosecolor=function(){document.getElementById("color-picker").click()},G.prototype.ColorChange=function(L){document.getElementById("colorbox").style.backgroundColor=L,I.MxFun.setCurrentColor(L)},G.prototype.SwitchShowLayout=function(){var L=document.getElementById("LayerOutInterface");L.style.display=="none"?L.style.display="block":L.style.display="none"},G.prototype.WriteTitle=function(){var L=this.uiPath;document.write("<div class='bar1'>"),document.write("<img src='"+L+"/image/mxcad.png' style='height: 50%;position: absolute;top: 12px;left: 10px;'>"),document.write("<span  class='barspan'  style='position: absolute;left: 45px;'>"),document.write("</span>"),document.write("<div id='container'>"),this.isShowMainMenu&&(document.write("<header>"),document.write("<div class='wrapper cf'style='z-index: 999'>"),document.write("<nav id='main-nav' >"),document.write("</nav>"),document.write("<a class='toggle'>"),document.write("<span></span>"),document.write("</a>"),document.write("</div>"),document.write("</header>")),document.write("</div>"),document.write("</div>")},G.prototype.WriteToolbar=function(){document.write("<div id='MainMenuContent' class='bf-toolbar bf-toolbar-bottom'>"),document.write("</div>")},G.prototype.WriteLoading=function(){var L=this.uiPath;document.write("<div class='Prompt' style='width: 100px;height:30px;position:"),document.write("absolute;top: 60px;left: 50%;margin-left: -50px;color: #fff;text-align: center;'>"),document.write("<div style='text-align: center;'>"),document.write("<img src='"+L+"/image/loading.gif' alt='' style='width:30px;height:30px;float: left'>"),document.write("<p style='color:black;vertical-align: middle;float: left;  margin-top: 5px;margin-left: 5px;'>加载中.....</p>"),document.write("</div>"),document.write("<span style='vertical-align: middle;display: none'>图纸加载完毕</span>"),document.write("</div>")},G.prototype.WriteLayer=function(){var L=this.uiPath;this.isShowLayer&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' title='ModelTree' style='position: absolute; top:111px;left: 0px;' onclick='uiObj.SwitchShowLayer()'>"),document.write("<div class='bf-button mxbim-bf-tree' title='图层'>"),document.write("<img src='"+L+"/image/layer.png.gif' alt='' style='width: 24px;'>"),document.write("</div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='LayerInterface' title='图层'"),document.write("style='left: 0px;"),document.write("top: 0px;"),document.write("width: 100%;"),document.write("height: 100%;"),document.write("display: none;'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowLayer()' style='text-align: center;'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;'>图层</div>"),document.write("<div>"),document.write("<div class='layer-title' style='width: 12.5%;'>可见</div>"),document.write("<div class='layer-title' style='width: 12.5%;'>颜色</div>"),document.write("<div class='layer-title' style='width: 62.5%'>名字</div>"),document.write("<div class='layer-title' style='width: 12.5%'>状态</div>"),document.write("</div>"),document.write("<div id='Layer-Info'  style='margin-top: 26px;height: 79%;width: 100%; position: absolute;overflow-y: auto;'>"),document.write("</div>"),document.write("</div>")},G.prototype.WriteStructTree=function(){this.isShowStructTree&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='Fmj' title='ModelTree'"),document.write("style='position: absolute; top:60px;left: 0px;' onclick='uiObj.SwitchShowStructTree()'>"),document.write("<div class='bf-button mxbim-bf-tree' title='构件树'><i class='fa fa-sitemap' aria-hidden='true' style='font-size: 24px;'></i></div>"),document.write("</div>")),document.write("<div class='bf-panel  bf-has-title bf-sizable tree-panel' id='dv' title='目录树' style='left: 0px; top: 0px; width: 100%; height: 100%; display: none;'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowStructTree()'><i class='fa fa-times fa-2x' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;'>目录树</div>"),document.write("<div class='bf-panel-body' style='padding-top: 57px;overflow-y: scroll;'>"),document.write("<div class='bf-panel-header'>"),document.write("<div class='bf-panel-header'>"),document.write("<div class='bf-tree-header' style='margin-top: -57px;'>"),document.write("<div class='bf-tabs bf-tabs-tree'>"),document.write("<ul class='bf-tabs-list'>"),document.write("<li class='bf-tabs-option my-option undefined active' id='component'>构件</li>"),document.write("<li class='bf-tabs-option my-option undefined' id='area'>空间</li>"),document.write("<li class='bf-tabs-option my-option undefined' id='drawing'>图纸</li>"),document.write("</ul>"),document.write("</div>"),document.write("</div>"),document.write("</div>"),document.write("</div>"),document.write("<div class='' style='margin-bottom: 100px;' id='DirectoryContent'>"),document.write("</div>"),document.write("</div>"),document.write("</div>")},G.prototype.WriteTakeColor=function(){var L=this.uiPath;this.isShowTakeColor&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='TakeColor'"),document.write("style='position: absolute;left: 0px; top: 162px;width: 45px; '>"),document.write("<div class='bf-button' onclick='uiObj.Chosecolor()' style='opacity: 1;width: 45px;'>"),document.write("<div  style='position: relative;margin-left: 10px;margin-top: -5px;'>"),document.write("<img src='"+L+"/image/color.png' alt='' style='width: 40px;margin-left: -21px;'>"),document.write("</div>"),document.write("<div id='colorbox' style='width: 30px;height: 5px;background-color: #cccccc;margin-left: -3px;margin-top: -5px;'>"),document.write("</div>"),document.write("<div style='width: 18px;height: 40px;float: right;margin-top: -38px;margin-left: 14px;position: absolute;'>"),document.write("<img src='"+L+"/image/daojiao.png' alt='' style='width: 15px;margin-top: 10px;z-index: 999;position: relative'>"),document.write("<input id='color-picker' type='color' value='#c0c0c0'   style='display: none' onchange='colorChange(value)'>"),document.write("</div>"),document.write("</div>"),document.write("</div>"))},G.prototype.WriteLayout=function(){var L=this.uiPath;this.isShowLayout&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='LayerOut'"),document.write("style='position: absolute;left: 0px; top: 213px; ' onclick='uiObj.SwitchShowLayout()'>"),document.write("<div class='bf-button'>"),document.write("<img src='"+L+"/image/layout.png' alt='' style='width: 24px;'>"),document.write("</div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='LayerOutInterface'"),document.write("style='left: 0; top: 0; width: 100%;display:none'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowLayout()'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' id='buju' style='cursor: move; user-select: none;'>布局</div>"),document.write("<div>"),document.write("</div>"),document.write("<div id=''>"),document.write("<div>"),document.write("<table  class='bf-table'>"),document.write("<tbody class='bf-group'>"),document.write("<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>"),document.write("<td class='bf_layerout_td'  style='width: 60px' >"),document.write("<div class='bf_layer_div layer_on'></div>"),document.write("</td>"),document.write("<td  style='width: 238px' >"),document.write("<span  style='color: white;cursor: pointer;'>LayerOut</span>"),document.write("</td>"),document.write("</tr>"),document.write("<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>"),document.write("<td class='bf_layerout_td'  style='width: 60px' >"),document.write("<div class='bf_layer_div' ></div>"),document.write("</td>"),document.write("<td  style='width: 238px' >"),document.write("<span  style='color: white;cursor: pointer;'>LayerOut</span>"),document.write("</td>"),document.write("</tr>"),document.write("<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>"),document.write("<td class='bf_layerout_td'  style='width: 60px' >"),document.write("<div class='bf_layer_div' ></div>"),document.write("</td>"),document.write("<td  style='width: 238px' >"),document.write("<span  style='color: white;cursor: pointer;'>LayerOut</span>"),document.write("</td>"),document.write("</tr>"),document.write("<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>"),document.write("<td class='bf_layerout_td'  style='width: 60px' >"),document.write("<div class='bf_layer_div'></div>"),document.write("</td>"),document.write("<td  style='width: 238px' >"),document.write("<span  style='color: white;cursor: pointer;'>LayerOut</span>"),document.write("</td>"),document.write("</tr>"),document.write("</tbody>"),document.write("</table>"),document.write("</div>"),document.write("</div>"),document.write("</div>")},G.prototype.WriteObjectProperty=function(){document.write("<div class='bf-panel bf-has-title bf-sizable property-panel' id='fmj2' title='构件详情' style='left: 0px; top: 0px; width: 100%; height: 100%;display: none;'>"),document.write("<div class='bf-close' id='close2' style='top:4.0em;'><i class='fa fa-times fa-2x' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;'>构件详情</div>"),document.write("<div class='bf-panel-body' style='padding-top: 41px;'>"),document.write("<div class='bf-panel-container bf-scroll-bar' style='top:0;width: 100%;height: 100%;overflow-y: auto;position: relative;'>"),document.write("<table class='bf-table' id='ComponentContent'>"),document.write("</table>"),document.write("</div>"),document.write("</div>"),document.write("</div>")},G.prototype.UpDisplayLayout=function(){},G.prototype.UpDisplayLayer=function(){var L=this.uiPath,y=this.vecLayerData,D=this.vecSketchLayerData,C="";if(D!=null){var B=D;for(var z in B){C+="<div>";var A="hide.png";B[z].off==0&&(A="show.png");var S="unlock.png";C+="<table class='bf-table'>",C+="<tbody class='bf-group'>",C+="<tr class='bf-group-title'>",C+='<td><img class="layer-enable" sketch=1 id='+B[z].id+' src="'+L+"/image/"+A+'"/></td>',C+='<td><span class="layer-color" style="background-color:'+B[z].color+'"></span></td>',C+='<td><span class="layer-text">草图_'+B[z].name+"</span></td>",C+='<td><img class="layer-state" src="'+L+"/image/"+S+'"/></td>',C+="</tr>",C+="</tbody>",C+="</table>",C+="</div>"}}if(y!=null)for(var z in B=y)C+="<div>",A="hide.png",B[z].off==0&&(A="show.png"),S="lock.png",C+="<table class='bf-table'>",C+="<tbody class='bf-group'>",C+="<tr class='bf-group-title'>",C+='<td><img class="layer-enable" sketch=0 id='+B[z].id+' src="'+L+"/image/"+A+'"/></td>',C+='<td><span class="layer-color" style="background-color:'+B[z].color+'"></span></td>',C+='<td><span class="layer-text">'+B[z].name+"</span></td>",C+='<td><img class="layer-state" src="'+L+"/image/"+S+'"/></td>',C+="</tr>",C+="</tbody>",C+="</table>",C+="</div>";var q=document.getElementById("Layer-Info");q!=null&&(q.innerHTML=C)},G.prototype.WriteFooter=function(){document.write("<div class='footer' style='background: rgba(0, 0, 0, 0.7);min-width: auto;position: fixed;left: 0;bottom: 0;width: 100%;'>"),document.write("<div style='line-height: 40px;font-size: 12px;color: #999;padding: 0 10px;'>"),document.write("<p style='float: right;line-height: 15px;font-size: 12px;color: #999;display: block;'>"),document.write("<a style='color: #4a90e2;text-decoration: none;outline: none;' href='http://www.mxdraw.com/' target='_blank'>梦想CAD</a>旗下产品"),document.write("</p>"),document.write("<a style='color: #4a90e2;text-decoration: none;outline: none;' href='http://www.mxdraw.com' target='_blank'>MX3D</a> 蜀ICP备15011727号"),document.write("</div>"),document.write("</div>")},G.prototype.CreateToolBar=function(L){if(this.isShowToolbar){var y="";for(var D in L){var C=L[D],B="uiObj.CallMxCommand";C.isMxCommand||(B="uiObj.EvalJs"),0<C.itemid.length?y+='<div class="bf-button" onclick="'+B+"('"+L[D].evalString+`')"><img class="mainimage-bf-butto" id="`+C.itemid+'" src="'+this.uiPath+"\\image\\"+C.image+'" title="'+L[D].text+'"></div>':y+='<div class="bf-button" onclick="'+B+"('"+L[D].evalString+`')"><img class="mainimage-bf-butto" src="`+this.uiPath+"\\image\\"+C.image+'" title="'+L[D].text+'"></div>'}document.getElementById("MainMenuContent").innerHTML=y}},G.prototype.InitEvent=function(){var L=document.getElementById("LayerInterface");this.CreateToolBar(this.vecToolBarItem),L.style.display="none";var y=this.vecMenuItem;this.isShowMainMenu&&function(A){var S="";(function V(Y,c){var p=function(f,N){var P=new Array;for(var O in N)N[O].parentId==f&&P.push(N[O]);return P}(Y,c);if(0<p.length){for(var m in S+="<ul>",p)p[m].evalString.length!=0?(S+='<li><p class="li_option" ',S+=`onclick="uiObj.EvalJs('`+p[m].evalString+`')"`,S+=">"+p[m].text+"</p>"):(S+="<li><a ",S+=">"+p[m].text+"</a>"),V(p[m].id,c),S+="</li>";S+="</br>",S+="</br>",S+="</br>",S+="</ul>"}})(-1,y),A("#main-nav").append(S);var q=A("#main-nav"),W=A(".toggle"),_={maxWidth:!1,customToggle:W,levelTitles:!0},R=null,v={};R&&R.remove(),W.off("click"),R=q.clone(),A.extend(v,{side:"right"}),R.hcMobileNav(A.extend({},_,v))}(jQuery);var D=window.location.href,C=D.length,B=D.indexOf("?"),z=D.substr(B,C).split("=")[1];$(".barspan").html(decodeURIComponent(z)),$("#close2").click(function(){$(this).parent("div").fadeOut(200)}),$(".bf-select-current").click(function(){$(this).hasClass("bf-open")?$(this).removeClass("bf-open"):$(this).addClass("bf-open")}),$(".my-option").click(function(){var A=$(this);$(".my-option").each(function(){$(this).removeClass("active")}),A.addClass("active")}),$(".bf-select-option").click(function(){$(this).parent("ul").prev("span").html($(this).text()),$(this).parent("ul").prev("span").removeClass("bf-open")}),$(document).on("click",".layer-enable",function(){var A=I.MxFun.getUiObj().getPath(),S=parseInt($(this).attr("id")),q=!0;$(this).attr("src")==A+"/image/show.png"?($(this).attr("src",A+"/image/hide.png"),q=!1):$(this).attr("src",A+"/image/show.png"),I.MxFun.showLayer(S,q)})},G.prototype.Fullscreen=function(){var L=document.documentElement;L.requestFullscreen?L.requestFullscreen():L.mozRequestFullScreen?L.mozRequestFullScreen():L.webkitRequestFullScreen&&L.webkitRequestFullScreen(),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),this.IsFullStatus()?($("img[title='取消全屏']").attr("src",this.uiPath+"/image\\fullscreen1.gif"),$("img[title='取消全屏']").attr("title","全屏")):($("img[title='全屏']").attr("src",this.uiPath+"/image\\escscreen1.gif"),$("img[title='全屏']").attr("title","取消全屏"))},G.prototype.IsFullStatus=function(){return(document.fullscreenEnabled||document.mozFullscreenElement||document.webkitFullscreenElement)!=null},G);function G(){return u!==null&&u.apply(this,arguments)||this}o.MxUiObjectMobile=H},{"../MxFun":27,"./MxUiObject":62}],64:[function(T,r,o){var a,x=this&&this.__extends||(a=function(L,y){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,C){D.__proto__=C}||function(D,C){for(var B in C)Object.prototype.hasOwnProperty.call(C,B)&&(D[B]=C[B])})(L,y)},function(L,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function D(){this.constructor=L}a(L,y),L.prototype=y===null?Object.create(y):(D.prototype=y.prototype,new D)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxUiObjectPC=void 0;var u,M=T("./MxUiObject"),I=T("../MxFun"),H=(x(G,u=M.MxUiObject),G.prototype.onCreate=function(){this.isShowTitle&&this.WriteTitle(),this.WriteStructTree(),this.isEnableLoading&&this.WriteLoading(),this.WriteLayer(),this.WriteTakeColor(),this.WriteLayout(),this.isEnableObjectProperty&&this.WriteObjectProperty(),this.isShowToolbar&&this.WriteToolbar()},G.prototype.onInit=function(){this.InitEvent()},G.prototype.WriteTitle=function(){var L=this.uiPath;document.write("<div id='all'>"),document.write("   <div class='bar1'>"),document.write("   <img src="+L+"/image/mxcad.png style='height: 50%;position: absolute;top: 12px;left: 10px;'>"),document.write("   <span  class='barspan' style='position: absolute;left: 45px;'>"),document.write("   </span>"),document.write("   <div id='container'>"),this.isShowMainMenu&&(document.write("   <header>"),document.write("    <div class='wrapper cf'style='z-index: 999'>"),document.write("   <nav id='main-nav' >"),document.write("    </nav>"),document.write("    <a class='toggle'>"),document.write("   <span></span>"),document.write("    </a>"),document.write("    </div>"),document.write("    </header>")),document.write("    </div>"),document.write("    </div>")},G.prototype.WriteStructTree=function(){this.isShowStructTree&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='ModelTreeThumbnail' title='目录树'"),document.write("style='position: absolute;left: 10px; top: 97px; ' onclick='uiObj.SwitchShowStructTree()'>"),document.write("<div class='bf-button mxbim-bf-tree' title='目录树'><i class='fa fa-sitemap' aria-hidden='true'></i></div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='ModelTreeInterface' title='目录树'"),document.write("style='left:0px; top: 0px; width: 300px; height: 416px;display: none'>"),document.write("   <div class='bf-close' onclick='uiObj.SwitchShowStructTree()'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;' id='mulushu'>目录树</div>"),document.write("<div class='bf-panel-body' style='padding-top: 36px;'>"),document.write("<div class='bf-panel-header'>"),document.write("<div class='bf-tree-header' style='margin-top: -36px;'>"),document.write("<div class='bf-select bf-select-tree'>"),document.write("<span class='bf-select-current'>构件</span>"),document.write("<ul class='bf-select-list'>"),document.write("<li class='bf-select-option' id='type'>构件</li>"),document.write("<li class='bf-select-option' id='file'>文件</li>"),document.write("<li class='bf-select-option' id='area'>空间</li>"),document.write("<li class='bf-select-option' id='drawing'>图纸</li>"),document.write("</ul>"),document.write("</div>"),document.write("</div>"),document.write("</div>"),document.write("<div id='DirectoryContent' class='bf-panel-container TreeInfo'>"),document.write("</div>"),document.write("</div>"),document.write("</div>")},G.prototype.WriteLoading=function(){var L=this.uiPath;document.write("<div class='Prompt'>"),document.write("<div style='text-align: center;'>"),document.write("<img src='"+L+"/image/loading.gif' alt='' style='width:30px;height:30px;float: left'>"),document.write("<p  style='color:black;vertical-align: middle;float: left; margin-top: 5px;margin-left: 5px;'>加载中.....</p>"),document.write("</div>"),document.write("<span style='display: none'>"+this.sLanguageTable.openComplete+"</span>"),document.write("</div>")},G.prototype.WriteLayer=function(){var L=this.uiPath;this.isShowLayer&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='LayerThumbnail' title='"+this.sLanguageTable.layer+"'"),document.write("style='position: absolute;left: 10px; top: 45px; ' onclick='uiObj.SwitchShowLayer()'>"),document.write("<div class='bf-button'>"),document.write("<img src='"+L+"/image/layer.png.gif' alt='' style='width: 32px;'>"),document.write("</div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='LayerInterface'"),document.write("style='left: 10px; top: 50px; width: 300px; height: 416px;display: none'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowLayer(false)'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' id='tuceng' style='cursor: move; user-select: none;'>"+this.sLanguageTable.layer+"</div>"),document.write("<div>"),document.write("<div class='layer-title' style='width: 50px;font-size: 14px'>"+this.sLanguageTable.visible+"</div>"),document.write("<div class='layer-title' style='width: 50px;font-size: 14px'>"+this.sLanguageTable.color+"</div>"),document.write("<div class='layer-title' style='width: 148px;font-size: 14px'>"+this.sLanguageTable.name+"</div>"),document.write("<div class='layer-title' style='width: 50px;font-size: 14px'>"+this.sLanguageTable.status+"</div>"),document.write("</div>"),document.write("<div id='Layer-Info' style='margin-top: 25px;height: 349px;position: absolute;overflow-y: auto;'>"),document.write("</div>"),document.write("</div>")},G.prototype.WriteTakeColor=function(){var L=this.uiPath;this.isShowTakeColor&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='TakeColor' title='选择颜色'"),document.write("style='position: absolute;left: 10px; top: 149px; '>"),document.write("<div class='bf-button' onclick='uiObj.Chosecolor()' style='opacity: 1;'>"),document.write("<img src='"+L+"/image/color.png' alt='' style='width: 40px;margin-left: -10px;'>"),document.write("<div id='colorbox' style='width: 35px;height: 5px;background-color: #cccccc;margin-left: -3px'>"),document.write("</div>"),document.write("<div style='width: 18px;height: 40px;float: right;margin-top: -42px;margin-left: 14px;'>"),document.write("<img src='"+L+"/image/daojiao.png' alt='' style='width: 15px;margin-top: 10px;z-index: 999;position: relative'>"),document.write("<input id='color-picker' type='color' value='#c0c0c0'   style='display: none' onchange='uiObj.ColorChange(value)'>"),document.write("</div>"),document.write("</div>"),document.write("</div>"))},G.prototype.WriteLayout=function(){var L=this.uiPath;this.isShowLayout&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='LayerOut' title='"+this.sLanguageTable.layout+"'"),document.write("style='position: absolute;left: 10px; top: 97px; ' onclick='uiObj.SwitchShowLayout()'>"),document.write("<div class='bf-button'>"),document.write("<img src='"+L+"/image/layout.png' alt='' style='width: 32px;'>"),document.write("</div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='LayerOutInterface'"),document.write("style='left: 10px; top: 50px; width: 300px;display:none'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowLayout()'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' id='buju' style='cursor: move; user-select: none;'>"+this.sLanguageTable.layout+"</div>"),document.write("<div>"),document.write("</div>"),document.write("<div id='layout-Info'>"),document.write("</div>"),document.write("</div>")},G.prototype.WriteObjectProperty=function(){document.write("<div class='bf-panel bf-has-title bf-sizable' id='StrcutInfoBase' title='属性'"),document.write("style='right: 10px; top: 45px; width: 300px; height: 416px;display: none'>"),document.write("<div class='bf-close' id='close2'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;'>属性</div>"),document.write("<div id='ComponentContent' class='bf-panel-body StructInfo'></div>"),document.write("<div class='bf-resize'></div>"),document.write("</div>")},G.prototype.WriteToolbar=function(){document.write("<div id='MainMenuContent' class='bf-toolbar bf-toolbar-bottom' style='position: fixed'></div>")},G.prototype.CreateToolBar=function(L){if(this.isShowToolbar){var y="";for(var D in L){var C=L[D],B="uiObj.CallMxCommand";C.isMxCommand||(B="uiObj.EvalJs"),0<C.itemid.length?y+='<div class="bf-button" onclick="'+B+"('"+L[D].evalString+`')"><img class="mainimage-bf-butto" id="`+C.itemid+'" src="'+this.uiPath+"\\image\\"+C.image+'" title="'+L[D].text+'"></div>':y+='<div class="bf-button" onclick="'+B+"('"+L[D].evalString+`')"><img class="mainimage-bf-butto" src="`+this.uiPath+"\\image\\"+C.image+'" title="'+L[D].text+'"></div>'}document.getElementById("MainMenuContent").innerHTML=y}},G.prototype.UpDisplayLayer=function(){var L=this.uiPath,y=this.vecLayerData,D=this.vecSketchLayerData,C="";if(D!=null){var B=D;for(var z in B){C+="<div>";var A="hide.png";B[z].off==0&&(A="show.png");var S="unlock.png";C+="<table class='bf-table'>",C+="<tbody class='bf-group'>",C+="<tr class='bf-group-title'>",C+='<td><img class="layer-enable" sketch=1 id='+B[z].id+' src="'+L+"/image/"+A+'"/></td>',C+='<td><span class="layer-color" style="background-color:'+B[z].color+'"></span></td>',C+='<td><span class="layer-text">草图_'+B[z].name+"</span></td>",C+='<td><img class="layer-state" src="'+L+"/image/"+S+'"/></td>',C+="</tr>",C+="</tbody>",C+="</table>",C+="</div>"}}if(y!=null)for(var z in B=y)C+="<div>",A="hide.png",B[z].off==0&&(A="show.png"),S="lock.png",C+="<table class='bf-table'>",C+="<tbody class='bf-group'>",C+="<tr class='bf-group-title'>",C+='<td><img class="layer-enable" sketch=0 id='+B[z].id+' src="'+L+"/image/"+A+'"/></td>',C+='<td><span class="layer-color" style="background-color:'+B[z].color+'"></span></td>',C+='<td><span class="layer-text">'+B[z].name+"</span></td>",C+='<td><img class="layer-state" src="'+L+"/image/"+S+'"/></td>',C+="</tr>",C+="</tbody>",C+="</table>",C+="</div>";var q=document.getElementById("Layer-Info");q!=null&&(q.innerHTML=C)},G.prototype.UpDisplayLayout=function(){var L=this.vecLayoutData,y="";if(y+="<div>",y+="<table  class='bf-table'>",y+="<tbody class='bf-group'>",y+="<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>",y+="<td class='bf_layerout_td'  style='width: 60px' >",y+="<div class='bf_layer_div layer_on'></div>",y+="</td>",y+="<td  style='width: 238px' >",y+="<span  class='layout-name' name='Model' style='color: white;cursor: pointer;'>Model</span>",y+="</td>",y+="</tr>",L!=null){var D=L;for(var C in D)y+="<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>",y+="<td class='bf_layerout_td'  style='width: 60px' >",y+="<div class='bf_layer_div layer_on'></div>",y+="</td>",y+="<td style='width: 238px' >",y+="<span class='layout-name' name='"+D[C]+"' style='color: white;cursor: pointer;'>"+D[C]+"</span>",y+="</td>",y+="</tr>"}y+="</tbody>",y+="</table>",y+="</div>";var B=document.getElementById("layout-Info");B!=null&&(B.innerHTML=y)},G.prototype.InitEvent=function(){var L=document.getElementById("ModelTreeInterface"),y=document.getElementById("LayerInterface"),D=document.getElementById("LayerOutInterface"),C=document.getElementById("tuceng"),B=document.getElementById("mulushu"),z=document.getElementById("buju"),A=0,S=0,q=0,W=0,_=!1;B.onmousedown=function(m){A=m.clientX,S=m.clientY,q=L.offsetLeft,W=L.offsetTop,_=!0,L.style.cursor="move"},C.onmousedown=function(m){A=m.clientX,S=m.clientY,q=y.offsetLeft,W=y.offsetTop,_=!0,y.style.cursor="move"},z.onmousedown=function(m){A=m.clientX,S=m.clientY,q=D.offsetLeft,W=D.offsetTop,_=!0,D.style.cursor="move"},window.onmousemove=function(m){if(_!=0){var f=m.clientX,N=m.clientY,P=f-(A-q),O=N-(S-W);L.style.left=P+"px",L.style.top=O+"px",y.style.left=P+"px",y.style.top=O+"px",D.style.left=P+"px",D.style.top=O+"px"}},B.onmouseup=function(){_=!1,L.style.cursor="default"},C.onmouseup=function(){_=!1,y.style.cursor="default"},z.onmouseup=function(){_=!1,D.style.cursor="default"},$("#close2").click(function(){$(this).parent("div").fadeOut(200)}),$("#menu4").click(function(){$("#StrcutInfoBase").hasClass("hide")?($("#StrcutInfoBase").fadeIn(200),$("#StrcutInfoBase").removeClass("hide")):($("#StrcutInfoBase").fadeOut(200),$("#StrcutInfoBase").addClass("hide"))}),$(".bf-select-current").click(function(){$(this).hasClass("bf-open")?$(this).removeClass("bf-open"):$(this).addClass("bf-open")}),$(".bf-select-option").click(function(){$(this).parent("ul").prev("span").html($(this).text()),$(this).parent("ul").prev("span").removeClass("bf-open")});var R=$("#StrcutInfoBase");R.bind("mousedown",function(m){var f=$(this)[0].offsetLeft,N=$(this)[0].offsetTop,P=m.pageX,O=m.pageY;$(document).bind("mousemove",function(Z){var te=Z.pageX-P,de=Z.pageY-O,me=f+te+"px",we=N+de+"px";R.css({top:we,left:me})})}),$(document).bind("mouseup",function(){$(this).unbind("mousemove")}),this.CreateToolBar(this.vecToolBarItem);var v=this.vecMenuItem;if(this.isShowMainMenu&&function(m){var f="";(function de(me,we){var ge=function(Pe,ae){var ve=new Array;for(var Ie in ae)ae[Ie].parentId==Pe&&ve.push(ae[Ie]);return ve}(me,we);if(0<ge.length){for(var Le in f+="<ul>",ge)ge[Le].evalString.length!=0?(f+='<li><p class="li_option" ',f+=`onclick="uiObj.EvalJs('`+ge[Le].evalString+`')"`,f+=">"+ge[Le].text+"</p>"):(f+="<li><a ",f+=">"+ge[Le].text+"</a>"),de(ge[Le].id,we),f+="</li>";f+="</br>",f+="</br>",f+="</br>",f+="</ul>"}})(-1,v),m("#main-nav").append(f);var N=m("#main-nav"),P=m(".toggle"),O={maxWidth:!1,customToggle:P,levelTitles:!0},Z=null,te={};Z&&Z.remove(),P.off("click"),Z=N.clone(),m.extend(te,{side:"right"}),Z.hcMobileNav(m.extend({},O,te))}(jQuery),$(".li_option").click(function(){var m=$(this);$(".li_option").each(function(){$(this).removeClass("active")}),m.addClass("active")}),this.sTitle==""){var V=window.location.href,Y=V.length,c=V.indexOf("?"),p=V.substr(c,Y).split("=")[1];p!=null&&(this.sTitle=p)}$(".barspan").html(decodeURIComponent(this.sTitle)),$(document).on("click",".layer-enable",function(){var m=I.MxFun.getUiObj().getPath(),f=parseInt($(this).attr("id")),N=(parseInt($(this).attr("sketch")),!0);$(this).attr("src")==m+"/image/show.png"?($(this).attr("src",m+"/image/hide.png"),N=!1):$(this).attr("src",m+"/image/show.png"),I.MxFun.showLayer(f,N)}),$(document).on("click",".layout-name",function(){var m=$(this).attr("name");m=="Model"&&(m=""),I.MxFun.getCurrentDraw().gotoLayout(m)})},G.prototype.WriteFooter=function(){document.write("<div class='footer' style='background: rgba(0, 0, 0, 0.7);position: fixed;left: 0;bottom: 0;width: 100%;'>"),document.write("   <div style='line-height: 40px;font-size: 12px;color: #999;padding: 0 10px;'>"),document.write("    <p style='float: right;line-height: 15px;font-size: 12px;color: #999;display: block;'>"),document.write("    <a style='color: #4a90e2;text-decoration: none;outline: none;' href='http://www.mxdraw.com/' target='_blank'>MxDraw </a>旗下产品"),document.write("    </p>"),document.write("    <a style='color: #4a90e2;text-decoration: none;outline: none;' href='http://www.mxdraw.com' target='_blank'>MX3D </a> 蜀ICP备15011727号"),document.write("    </div>"),document.write("   </div>")},G.prototype.ShowLoading=function(){this.isEnableLoading&&($(".Prompt").css("background","rgba(0, 0, 0, 0)"),$(".Prompt").fadeIn(100),$(".Prompt span").css("display","none"))},G.prototype.HideLoading=function(){this.isEnableLoading&&($(".Prompt").css("background","rgba(0, 0, 0, 0.8)"),$(".Prompt div").fadeOut(100),$(".Prompt span").fadeIn(200),setTimeout(function(){$(".Prompt").fadeOut(1e3)},1e3))},G.prototype.ShowObjectProperty=function(L){if(L.length!=0){var y;y=typeof L=="string"?JSON.parse(L):L;var D="";for(var C in y){var B=y[C];for(var z in D+="<table class='bf-table'>",D+="<tbody class='bf-group'>",D+="<tr class='bf-group-title'>",D+="<td colspan='2'><i class='bf-icon'></i>"+B.name+"</td>",D+="</tr>",B.datas){var A=B.datas[z];D+="<tr class='bf-group-content'>",D+="<td class='bf-key'>"+A.name+"</td>",D+="<td class='bf-value'>"+A.value+"</td>",D+="</tr>"}D+="</tbody>",D+="</table>"}document.getElementById("ComponentContent").innerHTML=D,$(".bf-group").click(function(){$(this).hasClass("bf-collapse")?$(this).removeClass("bf-collapse"):$(this).addClass("bf-collapse")}),$("#StrcutInfoBase").fadeIn(200),$("#StrcutInfoBase").removeClass("hide")}},G.prototype.HideObjectProp=function(){$("#StrcutInfoBase").hasClass("hide")||($("#StrcutInfoBase").fadeOut(200),$("#StrcutInfoBase").addClass("hide"))},G.prototype.SwitchShowLayer=function(){var L=document.getElementById("ModelTreeInterface"),y=document.getElementById("ModelTreeThumbnail"),D=document.getElementById("LayerThumbnail"),C=document.getElementById("LayerInterface"),B=document.getElementById("LayerOut"),z=document.getElementById("LayerOutInterface");L.style.display="none",(z.style.display="none")==C.style.display?(D.style.display="block",C.style.display="block",C.style.left="80px",C.style.top="50px",y!=null&&(y.style.display="block"),B!=null&&(B.style.display="block"),L.style.display="none",z.style.display="none"):(C.style.display="none",y!=null&&(y.style.display="block"),D.style.display="block",B!=null&&(B.style.display="block"))},G.prototype.SwitchShowStructTree=function(){var L=document.getElementById("ModelTreeInterface"),y=document.getElementById("ModelTreeThumbnail"),D=document.getElementById("LayerThumbnail"),C=document.getElementById("LayerInterface"),B=document.getElementById("LayerOut"),z=document.getElementById("LayerOutInterface");C.style.display="none",(z.style.display="none")==L.style.display?(y!=null&&(y.style.display="block"),L.style.display="block",L.style.left="80px",L.style.top="50px",D.style.display="block",B!=null&&(B.style.display="block"),C.style.display="none",z.style.display="none"):(L.style.display="none",y!=null&&(y.style.display="block"),D.style.display="block",B!=null&&(B.style.display="block"))},G.prototype.Chosecolor=function(){document.getElementById("color-picker").click()},G.prototype.ColorChange=function(L){document.getElementById("colorbox").style.backgroundColor=L,I.MxFun.setCurrentColor(L)},G.prototype.SwitchShowLayout=function(){var L=document.getElementById("ModelTreeInterface"),y=document.getElementById("ModelTreeThumbnail"),D=document.getElementById("LayerThumbnail"),C=document.getElementById("LayerInterface"),B=document.getElementById("LayerOut"),z=document.getElementById("LayerOutInterface");L.style.display="none",C.style.display="none",z&&z.style.display=="none"?(B&&(B.style.display="block"),z.style.display="block",z.style.left="80px",z.style.top="120px",y!=null&&(y.style.display="block"),D&&(D.style.display="block"),L.style.display="none",C.style.display="none"):(z&&(z.style.display="none"),y!=null&&(y.style.display="block"),D&&(D.style.display="block"),B&&(B.style.display="block"))},G.prototype.Fullscreen=function(){var L=document.documentElement;L.requestFullscreen?L.requestFullscreen():L.mozRequestFullScreen?L.mozRequestFullScreen():L.webkitRequestFullScreen&&L.webkitRequestFullScreen(),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),this.IsFullStatus()?($("img[title='取消全屏']").attr("src",this.uiPath+"/image\\fullscreen1.gif"),$("img[title='取消全屏']").attr("title","全屏")):($("img[title='全屏']").attr("src",this.uiPath+"/image\\escscreen1.gif"),$("img[title='全屏']").attr("title","取消全屏"))},G.prototype.IsFullStatus=function(){return(document.fullscreenEnabled||document.mozFullscreenElement||document.webkitFullscreenElement)!=null},G);function G(){return u!==null&&u.apply(this,arguments)||this}o.MxUiObjectPC=H},{"../MxFun":27,"./MxUiObject":62}],65:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxUiVue=o.MxUiOperations=void 0;var a,x,u,M,I,H=T("three"),G=T("../MxFun"),L=T("../Operate/MxJigCmdManager"),y=T("../MxTools"),D=T("../Operate/MxCmdRunManager");function C(R){var v=L.MxJigCmdManager.getCurCmd();v!=null&&v.getOsnap().setSpecificOsMode(R)}function B(R){if(R==32||R==13){if(L.MxJigCmdManager.isRunning())L.MxJigCmdManager.OnEnter(R);else{var v=q(),V="";V=v.length==0?D.MxCmdRunManager.GetPrvCmd():v,W(""),V=y.MxTools.stringTrimLeftSpace(V),G.MxFun.sendStringToExecute(V)}return 1}if(R==38)L.MxJigCmdManager.isRunning()||(D.MxCmdRunManager.MoveUpKey(),(Y=D.MxCmdRunManager.GetListCommad()).length!=0&&(W(Y),S()));else if(R==40){var Y;L.MxJigCmdManager.isRunning()||(D.MxCmdRunManager.MoveDownKey(),(Y=D.MxCmdRunManager.GetListCommad()).length!=0&&(W(Y),S()))}return 0}function z(R,v){v===void 0&&(v=!0);var V=R.length;if(!(V<1)){for(var Y=M.getCmdLine(),c=Y.getCmdTip(),p=Y.getCmdText(),m=R.indexOf(`
`),f=0,N=!0;m!=-1&&(N?(Y.addCmdDisplay(`
`+c+p+R.substring(f,m-f)),p=c="",N=!1):Y.addCmdDisplay(`
`+R.substring(f,m-f)),(f=m+1)<V);)m=R.indexOf(`
`,f);if(N){var P=R.substring(f,V-f),O=P.indexOf("\r"),Z=P.length;c=O==-1?c+p+P:O+1<Z?P.substring(O+1,Z-O-1):""}else f<V&&(c=R.substring(f,V));p="",v&&(c+=" "),Y.setCmdTip(c),Y.setCmdText(p),Y.upDisplay()}}function A(R){for(var v=[],V=1;V<arguments.length;V++)v[V-1]=arguments[V];if(M!=null){for(var Y=arguments,c=Y[0],p=0;p<Y.length-1;p++){var m=new RegExp("\\{"+p+"\\}","gm");c=c.replace(m,Y[p+1])}z(c,!0)}}function S(){M!=null&&M.getCmdLine().upDisplay()}function q(){if(M==null)return"";var R=M.getCmdLine();return y.MxTools.stringTrimLeftRightSpace(R.getCmdText())}function W(R){if(M!=null)return M.getCmdLine().setCmdText(R)}function _(R){var v=L.MxJigCmdManager.getCurCmd();return v==null?0:v.getDynImput().onKeyDonw(R)?1:B(R)}o.MxUiOperations={kOkCommand:1,kCancaleCommand:2},x=a||(o.MxUiVue=a={}),M=void 0,I=new H.Vector3,x.SetLasetPoint=function(R){I=R},x.GetLasetPoint=function(){return I},(u=x.CursorType||(x.CursorType={}))[u.kNormal=0]="kNormal",u[u.kRect=1]="kRect",u[u.kCross=2]="kCross",u[u.kPan=3]="kPan",x.isNull=function(){return M==null},x.init=function(R){(M=R).mountKeydownEvent(B),M.getDynamicInput().mountKeydownEvent(_),M.mountsetRightMenuSnapTypeFun&&M.mountsetRightMenuSnapTypeFun(C),M.mountTsWeb_MxUiVue&&M.mountTsWeb_MxUiVue(this)},x.executeOperations=function(R){R==o.MxUiOperations.kOkCommand?L.MxJigCmdManager.getCurCmd()&&L.MxJigCmdManager.OnEnter(-1):R==o.MxUiOperations.kCancaleCommand&&L.MxJigCmdManager.getCurCmd()&&L.MxJigCmdManager.stopCmd(L.MxJigCmdManager.DetailedResult.kEcsIn)},x.setTipCoord=function(R){M!=null&&M.setTipCoord(R)},x.setCursorType=function(R){M!=null&&M.setCursorType(R)},x.AcutPrintfNoFormat=z,x.acutPrintf=A,x.cmdLineUpDisplay=S,x.getCmdText=q,x.setCmdText=W,x.getCmdDisplay=function(){return M==null?"":M.getCmdLine().getCmdDisplay()},x.setCmdDisplay=function(R){if(M!=null)return M.getCmdLine().setCmdDisplay(R)},x.getCmdTip=function(){return M==null?"":M.getCmdLine().getCmdTip()},x.setCmdTip=function(R){if(M!=null)return M.getCmdLine().setCmdTip(R)},x.restoreCmdStatus=function(){if(M!=null){var R=M.getCmdLine();R.getCmdTip()==" "&&R.getCmdText().length==0?(R.setCmdTip(""),A("{0}:","命令")):A(`
{0}:`,"命令")}},x.DynamicInput_upDisplay=function(){M!=null&&x.OnMxEvent({name:"dynInputUpDisplay"})},x.DynamicInput_setType=function(R){M!=null&&M.getDynamicInput().setType(R)},x.DynamicInput_getType=function(){return M==null?L.MxJigCmdManager.DynamicInputType.kNoInput:M.getDynamicInput().getType()},x.DynamicInput_setPos=function(R){M!=null&&M.getDynamicInput().setPos([R.x,R.y])},x.DynamicInput_setTip=function(R){M!=null&&M.getDynamicInput().setTip(R)},x.DynamicInput_setValue1=function(R){M!=null&&M.getDynamicInput().setValue1(R)},x.DynamicInput_getValue1=function(){return M==null?"":M.getDynamicInput().getValue1()},x.DynamicInput_setValue1Pos=function(R){M!=null&&M.getDynamicInput().setValue1Pos([R.x,R.y])},x.DynamicInput_setValue2=function(R){M!=null&&M.getDynamicInput().setValue2(R)},x.DynamicInput_getValue2=function(){return M==null?"":M.getDynamicInput().getValue2()},x.DynamicInput_getFocusValue=function(){return M==null?"":M.getDynamicInput().getFocusValue()},x.DynamicInput_getFocusIndex=function(){return M==null?0:M.getDynamicInput().getFocusIndex()},x.DynamicInput_setValue2Pos=function(R){M!=null&&M.getDynamicInput().setValue2Pos([R.x,R.y])},x.DynamicInput_setShow=function(R){M!=null&&M.getDynamicInput().setShow(R)},x.DynamicInput_isShow=function(){return M!=null&&M.getDynamicInput().isShow()},x.OnMxEvent=function(R){if(M==null)return!1;M.OnMxEvent(R)},x.DynamicInput_getLockValuesMap=function(){return M==null?new Map:M.getDynamicInput().getLockValuesMap()},x.DynamicInput_clearLockValuesMap=function(){M!=null&&M.getDynamicInput().clearLockValuesMap()}},{"../MxFun":27,"../MxTools":38,"../Operate/MxCmdRunManager":48,"../Operate/MxJigCmdManager":54,three:19}],66:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.ExternalReferenceManager=o.ExternalReferenceDatabase=o.Blocks=o.Block=o.Layer=o.MxNewDisplayMemorySection=o.MxNewDisplayMemorySectionType=o.TextureData=o.BlockInstance=o.BlockRef=o.ClipPlans=o.ClipPlan=void 0;var a=T("three"),x=T("../MxShader"),u=T("./MxBrowseLayerData"),M=T("../MxManager"),I=T("../MxNetData"),H=T("../MxStencilObject"),G=T("../MxFun"),L=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0};o.ClipPlan=L;var y=function(){this.ver=4,this.id=1,this.clipPlanArray=new Array,this.clipPoints=[],this.instansClipePoints=[]};o.ClipPlans=y;var D=function(){this.ver=4,this.mat=new a.Matrix4,this.blkRecId=-1,this.blkOwnerId=0,this.layerId=-1,this.color=16777215,this.clipPlans=new y};o.BlockRef=D;var C=function(){this.mat=new a.Matrix4,this.color=new Array,this.topLayerColor=new Array,this.clipPlans=new y,this.clipMat=new a.Matrix4};o.BlockInstance=C;var B,z,A=function(){};o.TextureData=A,(z=B||(o.MxNewDisplayMemorySectionType=B={}))[z.kLinesType=1]="kLinesType",z[z.kTriangleType=2]="kTriangleType",z[z.kLinesType_Float=3]="kLinesType_Float",z[z.kTriangleType_Float=4]="kTriangleType_Float",z[z.kPointType_Float=5]="kPointType_Float",z[z.kPointType=6]="kPointType",o.MxNewDisplayMemorySection=function(){this.id=0,this.type=B.kLinesType,this.blockId=0,this.layerId=0,this.color=0,this.points=[]};var S=(q.prototype.Show=function(p){for(var m=0,f=this._entitys.length;m<f;m++)this._entitys[m].visible=p},q.prototype.updataClipMaterial=function(p){for(var m=this._material_clip.length,f=.5*p.width,N=.5*p.height,P=0;P<m;P++)this._material_clip[P].uniforms.vieww.value=f,this._material_clip[P].uniforms.viewh.value=N},q.prototype.createThreejsObjForMesh_Clip=function(p,m,f){p.size!=0&&p.forEach(function(N){var P=N;if(P.length!=0){var O=[],Z=[],te=P[0].clipPlans;te.ver<=3&&(O.push(te.clipPlanArray[0].x1,te.clipPlanArray[0].y1),Z.push(te.clipPlanArray[0].x2,te.clipPlanArray[0].y2));for(var de=[],me=[],we=[],ge=[],Le=[],Pe=[],ae=[],ve=0;ve<P.length;ve++){var Ie=P[ve];de=de.concat(Ie.mat.elements.slice(0,4)),me=me.concat(Ie.mat.elements.slice(4,8)),we=we.concat(Ie.mat.elements.slice(8,12)),ge=ge.concat(Ie.mat.elements.slice(12,16)),Le.push(0),Pe=Pe.concat(P[ve].color)}if(0<this._geometryMeshPositionsByBlock.length)for(ve=0;ve<P.length;ve++)Pe=Pe.concat(P[ve].color);if(0<this._geometryMeshPositionsByBlock_ZeroLayer.length)for(ve=0;ve<P.length;ve++)ae=ae.concat(P[ve].topLayerColor);var ze,He=.5*f.width,at=.5*f.height;te.ver<=3?(ze=new a.RawShaderMaterial({uniforms:{clippt1:{value:O},clippt2:{value:Z},vieww:{value:He},viewh:{value:at}},vertexShader:x.MxShader.VSHADER_COLOR_POINT_CLIP,fragmentShader:x.MxShader.FSHADER_COLOR_POINT_CLIP,linewidth:1,transparent:!0,side:a.DoubleSide}),this._material_clip.push(ze)):ze=new a.RawShaderMaterial({vertexShader:x.MxShader.VSHADER_COLOR_POINT,fragmentShader:x.MxShader.FSHADER_COLOR_POINT,linewidth:1,transparent:!0,side:a.DoubleSide});for(var tt=0;tt<this._geometryMeshPostion.length;tt++)(De=new a.InstancedBufferGeometry).maxInstancedCount=P.length,De.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPostion[tt],2)),De.setAttribute("color",new a.Float32BufferAttribute(this._geometryMeshColor[tt],3)),De.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(de),4)),De.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(me),4)),De.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(we),4)),De.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(ge),4)),De.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Le),1)),(st=new a.Mesh(De,ze)).frustumCulled=!1,st.renderOrder=M.MxData.iCADMeshRenderOrder,m.add(st),this._entitys.push(st),4<=te.ver&&0<te.instansClipePoints.length&&new H.MxStencilObject().associateObject(st,te.instansClipePoints);for(tt=0;tt<this._geometryMeshPositionsByBlock.length;tt++)(De=new a.InstancedBufferGeometry).maxInstancedCount=P.length,De.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPositionsByBlock[tt],2)),De.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(Pe),3)),De.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(de),4)),De.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(me),4)),De.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(we),4)),De.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(ge),4)),De.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Le),1)),(st=new a.Mesh(De,ze)).frustumCulled=!1,st.renderOrder=M.MxData.iCADMeshRenderOrder,m.add(st),this._entitys.push(st),4<=te.ver&&0<te.instansClipePoints.length&&new H.MxStencilObject().associateObject(st,te.instansClipePoints);for(tt=0;tt<this._geometryMeshPositionsByBlock_ZeroLayer.length;tt++)(De=new a.InstancedBufferGeometry).maxInstancedCount=P.length,De.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPositionsByBlock_ZeroLayer[tt],2)),De.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(ae),3)),De.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(de),4)),De.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(me),4)),De.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(we),4)),De.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(ge),4)),De.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Le),1)),(st=new a.Mesh(De,ze)).frustumCulled=!1,st.renderOrder=M.MxData.iCADMeshRenderOrder,m.add(st),this._entitys.push(st),4<=te.ver&&0<te.instansClipePoints.length&&new H.MxStencilObject().associateObject(st,te.instansClipePoints);var le=new a.RawShaderMaterial({uniforms:{color:{value:this._color},clippt1:{value:O},clippt2:{value:Z},vieww:{value:He},viewh:{value:at}},vertexShader:x.MxShader.VSHADER_COLOR_POINT_BYLAYER_CLIP,fragmentShader:x.MxShader.FSHADER_COLOR_POINT_CLIP,linewidth:1,transparent:!0,side:a.DoubleSide});for(this._material_clip.push(le),tt=0;tt<this._geometryMeshPositionsByLayer.length;tt++){var De,st;(De=new a.InstancedBufferGeometry).maxInstancedCount=P.length,De.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPositionsByLayer[tt],2)),De.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(de),4)),De.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(me),4)),De.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(we),4)),De.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(ge),4)),De.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Le),1)),(st=new a.Mesh(De,le)).frustumCulled=!1,st.renderOrder=M.MxData.iCADMeshRenderOrder,m.add(st),this._entitys.push(st),4<=te.ver&&0<te.instansClipePoints.length&&new H.MxStencilObject().associateObject(st,te.instansClipePoints)}}},this)},q.prototype.createThreejsObjForCurve_Clip=function(p,m,f){p.size!=0&&p.forEach(function(N,P,O){var Z=N;if(Z.length!=0){var te=[],de=[],me=Z[0].clipPlans;me.ver<=3&&(te.push(me.clipPlanArray[0].x1,me.clipPlanArray[0].y1),de.push(me.clipPlanArray[0].x2,me.clipPlanArray[0].y2));for(var we=[],ge=[],Le=[],Pe=[],ae=[],ve=[],Ie=[],ze=0;ze<Z.length;ze++){var He=Z[ze];we=we.concat(He.mat.elements.slice(0,4)),ge=ge.concat(He.mat.elements.slice(4,8)),Le=Le.concat(He.mat.elements.slice(8,12)),Pe=Pe.concat(He.mat.elements.slice(12,16)),ae.push(0)}if(0<this._geometryCurvePositionsByBlock.length)for(ze=0;ze<Z.length;ze++)ve=ve.concat(Z[ze].color);if(0<this._geometryCurvePositionsByBlock_ZeroLayer.length)for(ze=0;ze<Z.length;ze++)Ie=Ie.concat(Z[ze].topLayerColor);var at,tt=.5*f.width,le=.5*f.height;me.ver<=3?(at=new a.RawShaderMaterial({uniforms:{clippt1:{value:te},clippt2:{value:de},vieww:{value:tt},viewh:{value:le}},vertexShader:x.MxShader.VSHADER_COLOR_POINT_CLIP,fragmentShader:x.MxShader.FSHADER_COLOR_POINT_CLIP,linewidth:1,transparent:!0,side:a.DoubleSide}),this._material_clip.push(at)):at=new a.RawShaderMaterial({vertexShader:x.MxShader.VSHADER_COLOR_POINT,fragmentShader:x.MxShader.FSHADER_COLOR_POINT,linewidth:1,transparent:!0,side:a.DoubleSide});for(var De=0;De<this._geometryCurvePostion.length;De++)(gt=new a.InstancedBufferGeometry).maxInstancedCount=Z.length,gt.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePostion[De],2)),gt.setAttribute("color",new a.Float32BufferAttribute(this._geometryCurveColor[De],3)),gt.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(we),4)),gt.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(ge),4)),gt.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(Le),4)),gt.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(Pe),4)),gt.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(ae),1)),(St=new a.LineSegments(gt,at)).frustumCulled=!1,St.renderOrder=M.MxData.iCADCurveRenderOrder,m.add(St),this._entitys.push(St),4<=me.ver&&0<me.instansClipePoints.length&&new H.MxStencilObject().associateObject(St,me.instansClipePoints);for(De=0;De<this._geometryCurvePositionsByBlock.length;De++)(gt=new a.InstancedBufferGeometry).maxInstancedCount=Z.length,gt.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePositionsByBlock[De],2)),gt.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(ve),3)),gt.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(we),4)),gt.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(ge),4)),gt.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(Le),4)),gt.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(Pe),4)),gt.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(ae),1)),(St=new a.LineSegments(gt,at)).frustumCulled=!1,St.renderOrder=M.MxData.iCADCurveRenderOrder,m.add(St),this._entitys.push(St),4<=me.ver&&0<me.instansClipePoints.length&&new H.MxStencilObject().associateObject(St,me.instansClipePoints);for(De=0;De<this._geometryCurvePositionsByBlock_ZeroLayer.length;De++)(gt=new a.InstancedBufferGeometry).maxInstancedCount=Z.length,gt.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePositionsByBlock_ZeroLayer[De],2)),gt.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(Ie),3)),gt.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(we),4)),gt.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(ge),4)),gt.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(Le),4)),gt.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(Pe),4)),gt.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(ae),1)),(St=new a.LineSegments(gt,at)).frustumCulled=!1,St.renderOrder=M.MxData.iCADCurveRenderOrder,m.add(St),this._entitys.push(St),4<=me.ver&&0<me.instansClipePoints.length&&new H.MxStencilObject().associateObject(St,me.instansClipePoints);var st=new a.RawShaderMaterial({uniforms:{color:{value:this._color},clippt1:{value:te},clippt2:{value:de},vieww:{value:tt},viewh:{value:le}},vertexShader:x.MxShader.VSHADER_COLOR_POINT_BYLAYER_CLIP,fragmentShader:x.MxShader.FSHADER_COLOR_POINT_CLIP,linewidth:1,transparent:!0,side:a.DoubleSide});for(this._material_clip.push(st),De=0;De<this._geometryCurvePositionsByLayer.length;De++){var gt,St;(gt=new a.InstancedBufferGeometry).maxInstancedCount=Z.length,gt.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePositionsByLayer[De],2)),gt.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(we),4)),gt.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(ge),4)),gt.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(Le),4)),gt.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(Pe),4)),gt.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(ae),1)),(St=new a.LineSegments(gt,st)).frustumCulled=!1,St.renderOrder=M.MxData.iCADCurveRenderOrder,m.add(St),this._entitys.push(St),4<=me.ver&&0<me.instansClipePoints.length&&new H.MxStencilObject().associateObject(St,me.instansClipePoints)}}},this)},q.prototype.createThreejsObjForCurve=function(p,m){if(p.length!=0){for(var f=[],N=[],P=[],O=[],Z=[],te=[],de=[],me=0;me<p.length;me++){var we=p[me];f=f.concat(we.mat.elements.slice(0,4)),N=N.concat(we.mat.elements.slice(4,8)),P=P.concat(we.mat.elements.slice(8,12)),O=O.concat(we.mat.elements.slice(12,16)),Z.push(0)}if(0<this._geometryCurvePositionsByBlock.length)for(me=0;me<p.length;me++)te=te.concat(p[me].color);if(0<this._geometryCurvePositionsByBlock_ZeroLayer.length)for(me=0;me<p.length;me++)de=de.concat(p[me].topLayerColor);for(var ge=new a.RawShaderMaterial({vertexShader:x.MxShader.VSHADER_COLOR_POINT,fragmentShader:x.MxShader.FSHADER_COLOR_POINT,linewidth:1,transparent:!0,side:a.DoubleSide}),Le=0;Le<this._geometryCurvePostion.length;Le++)(ae=new a.InstancedBufferGeometry).maxInstancedCount=p.length,ae.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePostion[Le],2)),ae.setAttribute("color",new a.Float32BufferAttribute(this._geometryCurveColor[Le],3)),ae.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(f),4)),ae.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(N),4)),ae.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(P),4)),ae.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(O),4)),ae.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Z),1)),(ve=new a.LineSegments(ae,ge)).frustumCulled=!1,ve.renderOrder=M.MxData.iCADCurveRenderOrder,m.add(ve),this._entitys.push(ve);for(Le=0;Le<this._geometryCurvePositionsByBlock.length;Le++)(ae=new a.InstancedBufferGeometry).maxInstancedCount=p.length,ae.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePositionsByBlock[Le],2)),ae.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(te),3)),ae.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(f),4)),ae.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(N),4)),ae.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(P),4)),ae.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(O),4)),ae.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Z),1)),(ve=new a.LineSegments(ae,ge)).frustumCulled=!1,ve.renderOrder=M.MxData.iCADCurveRenderOrder,m.add(ve),this._entitys.push(ve);for(Le=0;Le<this._geometryCurvePositionsByBlock_ZeroLayer.length;Le++)(ae=new a.InstancedBufferGeometry).maxInstancedCount=p.length,ae.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePositionsByBlock_ZeroLayer[Le],2)),ae.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(de),3)),ae.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(f),4)),ae.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(N),4)),ae.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(P),4)),ae.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(O),4)),ae.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Z),1)),(ve=new a.LineSegments(ae,ge)).frustumCulled=!1,ve.renderOrder=M.MxData.iCADCurveRenderOrder,m.add(ve),this._entitys.push(ve);var Pe=new a.RawShaderMaterial({uniforms:{color:{value:this._color}},vertexShader:x.MxShader.VSHADER_COLOR_POINT_BYLAYER,fragmentShader:x.MxShader.FSHADER_COLOR_POINT,linewidth:1,transparent:!0,side:a.DoubleSide});for(Le=0;Le<this._geometryCurvePositionsByLayer.length;Le++){var ae,ve;(ae=new a.InstancedBufferGeometry).maxInstancedCount=p.length,ae.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePositionsByLayer[Le],2)),ae.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(f),4)),ae.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(N),4)),ae.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(P),4)),ae.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(O),4)),ae.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Z),1)),(ve=new a.LineSegments(ae,Pe)).frustumCulled=!1,ve.renderOrder=M.MxData.iCADCurveRenderOrder,m.add(ve),this._entitys.push(ve)}}},q.prototype.createThreejsObjForMemorySections_clip=function(p,m,f){p.size!=0&&p.forEach(function(N){var P=N;if(P.length!=0){for(var O=P[0].clipPlans,Z=[],te=[],de=[],me=[],we=[],ge=0;ge<P.length;ge++){var Le=P[ge];Z.push.apply(Z,Le.mat.elements.slice(0,4)),te.push.apply(te,Le.mat.elements.slice(4,8)),de.push.apply(de,Le.mat.elements.slice(8,12)),me.push.apply(me,Le.mat.elements.slice(12,16)),we.push(0)}for(var Pe=this._MemorySections.length,ae=0;ae<Pe;ae++){var ve=this._MemorySections[ae],Ie=f.automaticInversionColor2(ve.color),ze=[];if((4278190080&Ie)==16777216?ze=this._color:ze.push((255&Ie)/255,(Ie>>8&255)/255,(Ie>>16&255)/255),ve.type==B.kLinesType){var He=new a.RawShaderMaterial({uniforms:{color:{value:ze}},vertexShader:x.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:x.MxShader.FSHADER_COLOR_POINT_FORMXCAD,linewidth:1,transparent:!0,side:a.DoubleSide});(tt=new a.InstancedBufferGeometry).maxInstancedCount=P.length,tt.setAttribute("position",new a.Float32BufferAttribute(ve.points,3)),tt.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(Z),4)),tt.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(te),4)),tt.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(de),4)),tt.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(me),4)),tt.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(we),1)),(le=new a.LineSegments(tt,He)).frustumCulled=!1,le.renderOrder=M.MxData.iCADCurveRenderOrder,4<=O.ver&&0<O.instansClipePoints.length&&new H.MxStencilObject().associateObject(le,O.instansClipePoints),m.add(le),this._entitys.push(le)}else if(ve.type==B.kTriangleType){He=new a.RawShaderMaterial({uniforms:{color:{value:ze}},vertexShader:x.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:x.MxShader.FSHADER_COLOR_POINT_FORMXCAD,transparent:!0,side:a.DoubleSide}),(tt=new a.InstancedBufferGeometry).maxInstancedCount=P.length,tt.setAttribute("position",new a.Float32BufferAttribute(ve.points,3)),tt.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(Z),4)),tt.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(te),4)),tt.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(de),4)),tt.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(me),4)),tt.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(we),1));var at=new a.Mesh(tt,He);at.frustumCulled=!1,at.renderOrder=M.MxData.iCADMeshRenderOrder,4<=O.ver&&0<O.instansClipePoints.length&&new H.MxStencilObject().associateObject(at,O.instansClipePoints),m.add(at),this._entitys.push(at)}else if(ve.type==B.kPointType){var tt,le;He=new a.RawShaderMaterial({uniforms:{color:{value:ze}},vertexShader:x.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:x.MxShader.FSHADER_COLOR_POINT_FORMXCAD,transparent:!0,side:a.DoubleSide}),(tt=new a.InstancedBufferGeometry).maxInstancedCount=P.length,tt.setAttribute("position",new a.Float32BufferAttribute(ve.points,3)),tt.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(Z),4)),tt.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(te),4)),tt.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(de),4)),tt.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(me),4)),tt.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(we),1)),(le=new a.Points(tt,He)).frustumCulled=!1,le.renderOrder=M.MxData.iCADCurveRenderOrder,4<=O.ver&&0<O.instansClipePoints.length&&new H.MxStencilObject().associateObject(le,O.instansClipePoints),m.add(le),this._entitys.push(le)}}}},this)},q.prototype.createThreejsObjForMemorySections=function(p,m,f){if(p.length!=0){for(var N=[],P=[],O=[],Z=[],te=[],de=0;de<p.length;de++){var me=p[de];N.push.apply(N,me.mat.elements.slice(0,4)),P.push.apply(P,me.mat.elements.slice(4,8)),O.push.apply(O,me.mat.elements.slice(8,12)),Z.push.apply(Z,me.mat.elements.slice(12,16)),te.push(0)}for(var we=this._MemorySections.length,ge=0;ge<we;ge++){var Le=this._MemorySections[ge],Pe=f.automaticInversionColor2(Le.color),ae=[];if((4278190080&Pe)==16777216?(ae=this._color,this._colorValue):ae.push((255&Pe)/255,(Pe>>8&255)/255,(Pe>>16&255)/255),Le.type==B.kLinesType){var ve=new a.RawShaderMaterial({uniforms:{color:{value:ae}},vertexShader:x.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:x.MxShader.FSHADER_COLOR_POINT_FORMXCAD,linewidth:1,transparent:!0,side:a.DoubleSide});(ze=new a.InstancedBufferGeometry).maxInstancedCount=p.length,ze.setAttribute("position",new a.Float32BufferAttribute(Le.points,3)),ze.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(N),4)),ze.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(P),4)),ze.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(O),4)),ze.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(Z),4)),ze.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(te),1)),(He=new a.LineSegments(ze,ve)).frustumCulled=!1,He.renderOrder=M.MxData.iCADCurveRenderOrder,m.add(He),this._entitys.push(He)}else if(Le.type==B.kTriangleType){ve=new a.RawShaderMaterial({uniforms:{color:{value:ae}},vertexShader:x.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:x.MxShader.FSHADER_COLOR_POINT_FORMXCAD,transparent:!0,side:a.DoubleSide}),(ze=new a.InstancedBufferGeometry).maxInstancedCount=p.length,ze.setAttribute("position",new a.Float32BufferAttribute(Le.points,3)),ze.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(N),4)),ze.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(P),4)),ze.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(O),4)),ze.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(Z),4)),ze.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(te),1));var Ie=new a.Mesh(ze,ve);Ie.frustumCulled=!1,Ie.renderOrder=M.MxData.iCADMeshRenderOrder,m.add(Ie),this._entitys.push(Ie)}else if(Le.type==B.kPointType){var ze,He;ve=new a.RawShaderMaterial({uniforms:{color:{value:ae},size:1},vertexShader:x.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:x.MxShader.FSHADER_COLOR_POINT_FORMXCAD,transparent:!0,side:a.DoubleSide}),(ze=new a.InstancedBufferGeometry).maxInstancedCount=p.length,ze.setAttribute("position",new a.Float32BufferAttribute(Le.points,3)),ze.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(N),4)),ze.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(P),4)),ze.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(O),4)),ze.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(Z),4)),ze.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(te),1)),(He=new a.Points(ze,ve)).frustumCulled=!1,He.renderOrder=M.MxData.iCADCurveRenderOrder,m.add(He),this._entitys.push(He)}}}},q.prototype.createThreejsObjForTexture=function(p,m,f){if(p.length!=0){var N=[],P=[],O=[],Z=[],te=[],de=f.getCurrentLoadUrl(),me=G.MxFun.dwgDir();me.length!=0&&de.substring(de.lastIndexOf("/buf/")).toLowerCase()!="/buf/"&&(de=de+me+"/buf/");for(var we=0;we<p.length;we++){var ge=p[we];N=N.concat(ge.mat.elements.slice(0,4)),P=P.concat(ge.mat.elements.slice(4,8)),O=O.concat(ge.mat.elements.slice(8,12)),Z=Z.concat(ge.mat.elements.slice(12,16)),te.push(0)}for(var Le=0;Le<this._TextureData.length;Le++){var Pe=this._TextureData[Le],ae=new a.InstancedBufferGeometry;ae.maxInstancedCount=p.length,ae.setAttribute("position",new a.Float32BufferAttribute(Pe.pos,2)),ae.setAttribute("uv",new a.Float32BufferAttribute(Pe.textureCoord,2)),ae.setAttribute("color",new a.Float32BufferAttribute(Pe.color,3)),ae.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(N),4)),ae.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(P),4)),ae.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(O),4)),ae.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(Z),4)),ae.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(te),1));var ve=de+Pe.sFileName,Ie={texture:{value:new a.TextureLoader().load(ve,function(at){at&&f.updateDisplay()})}};Ie.texture.value.wrapS=Ie.texture.value.wrapT=a.RepeatWrapping;var ze=new a.RawShaderMaterial({uniforms:Ie,vertexShader:x.MxShader.VSHADER_COLOR_POINT_TEXTURE,fragmentShader:x.MxShader.FSHADER_COLOR_POINT_TEXTURE,transparent:!0,side:a.DoubleSide}),He=new a.Mesh(ae,ze);He.renderOrder=M.MxData.iCADMeshRenderOrder,He.frustumCulled=!1,m.add(He),this._entitys.push(He)}}},q.prototype.createThreejsObjForTexture_Clip=function(p,m,f){if(p.size!=0){var N=f.getCurrentLoadUrl(),P=G.MxFun.dwgDir();P.length!=0&&N.substring(N.lastIndexOf("/buf/")).toLowerCase()!="/buf/"&&(N=N+P+"/buf/"),p.forEach(function(O){var Z=O;if(Z.length!=0){for(var te=Z[0].clipPlans,de=[],me=[],we=[],ge=[],Le=[],Pe=0;Pe<Z.length;Pe++){var ae=Z[Pe];de=de.concat(ae.mat.elements.slice(0,4)),me=me.concat(ae.mat.elements.slice(4,8)),we=we.concat(ae.mat.elements.slice(8,12)),ge=ge.concat(ae.mat.elements.slice(12,16)),Le.push(0)}for(var ve=0;ve<this._TextureData.length;ve++){var Ie=this._TextureData[ve],ze=new a.InstancedBufferGeometry;ze.maxInstancedCount=Z.length,ze.setAttribute("position",new a.Float32BufferAttribute(Ie.pos,2)),ze.setAttribute("uv",new a.Float32BufferAttribute(Ie.textureCoord,2)),ze.setAttribute("color",new a.Float32BufferAttribute(Ie.color,3)),ze.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(de),4)),ze.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(me),4)),ze.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(we),4)),ze.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(ge),4)),ze.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Le),1));var He=N+Ie.sFileName,at={texture:{value:new a.TextureLoader().load(He,function(De){De&&f.updateDisplay()})}};at.texture.value.wrapS=at.texture.value.wrapT=a.RepeatWrapping;var tt=new a.RawShaderMaterial({uniforms:at,vertexShader:x.MxShader.VSHADER_COLOR_POINT_TEXTURE,fragmentShader:x.MxShader.FSHADER_COLOR_POINT_TEXTURE,transparent:!0,side:a.DoubleSide}),le=new a.Mesh(ze,tt);le.renderOrder=M.MxData.iCADMeshRenderOrder,le.frustumCulled=!1,4<=te.ver&&0<te.instansClipePoints.length&&new H.MxStencilObject().associateObject(le,te.instansClipePoints),m.add(le),this._entitys.push(le)}}},this)}},q.prototype.createThreejsObjForMesh=function(p,m){if(p.length!=0){for(var f=[],N=[],P=[],O=[],Z=[],te=[],de=[],me=0;me<p.length;me++){var we=p[me];f=f.concat(we.mat.elements.slice(0,4)),N=N.concat(we.mat.elements.slice(4,8)),P=P.concat(we.mat.elements.slice(8,12)),O=O.concat(we.mat.elements.slice(12,16)),Z.push(0),te=te.concat(p[me].color)}if(0<this._geometryMeshPositionsByBlock.length)for(me=0;me<p.length;me++)te=te.concat(p[me].color);if(0<this._geometryMeshPositionsByBlock_ZeroLayer.length)for(me=0;me<p.length;me++)de=de.concat(p[me].topLayerColor);for(var ge=new a.RawShaderMaterial({vertexShader:x.MxShader.VSHADER_COLOR_POINT,fragmentShader:x.MxShader.FSHADER_COLOR_POINT,transparent:!0,side:a.DoubleSide}),Le=0;Le<this._geometryMeshPostion.length;Le++)(ae=new a.InstancedBufferGeometry).maxInstancedCount=p.length,ae.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPostion[Le],2)),ae.setAttribute("color",new a.Float32BufferAttribute(this._geometryMeshColor[Le],3)),ae.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(f),4)),ae.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(N),4)),ae.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(P),4)),ae.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(O),4)),ae.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Z),1)),(ve=new a.Mesh(ae,ge)).frustumCulled=!1,ve.renderOrder=M.MxData.iCADMeshRenderOrder,m.add(ve),this._entitys.push(ve);for(Le=0;Le<this._geometryMeshPositionsByBlock.length;Le++)(ae=new a.InstancedBufferGeometry).maxInstancedCount=p.length,ae.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPositionsByBlock[Le],2)),ae.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(te),3)),ae.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(f),4)),ae.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(N),4)),ae.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(P),4)),ae.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(O),4)),ae.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Z),1)),(ve=new a.Mesh(ae,ge)).frustumCulled=!1,ve.renderOrder=M.MxData.iCADMeshRenderOrder,m.add(ve),this._entitys.push(ve);for(Le=0;Le<this._geometryMeshPositionsByBlock_ZeroLayer.length;Le++)(ae=new a.InstancedBufferGeometry).maxInstancedCount=p.length,ae.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPositionsByBlock_ZeroLayer[Le],2)),ae.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(de),3)),ae.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(f),4)),ae.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(N),4)),ae.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(P),4)),ae.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(O),4)),ae.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Z),1)),(ve=new a.Mesh(ae,ge)).frustumCulled=!1,ve.renderOrder=M.MxData.iCADMeshRenderOrder,m.add(ve),this._entitys.push(ve);var Pe=new a.RawShaderMaterial({uniforms:{color:{value:this._color}},vertexShader:x.MxShader.VSHADER_COLOR_POINT,fragmentShader:x.MxShader.FSHADER_COLOR_POINT,transparent:!0,side:a.DoubleSide});for(Le=0;Le<this._geometryMeshPositionsByLayer.length;Le++){var ae,ve;(ae=new a.InstancedBufferGeometry).maxInstancedCount=p.length,ae.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPositionsByLayer[Le],2)),ae.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(f),4)),ae.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(N),4)),ae.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(P),4)),ae.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(O),4)),ae.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Z),1)),(ve=new a.Mesh(ae,Pe)).frustumCulled=!1,ve.renderOrder=M.MxData.iCADMeshRenderOrder,m.add(ve),this._entitys.push(ve)}}},q.prototype.addGeometryCurve=function(p,m,f,N,P){0<p.length&&(this._geometryCurvePostion.push(p),this._geometryCurveColor.push(m)),0<f.length&&this._geometryCurvePositionsByBlock.push(f),0<N.length&&this._geometryCurvePositionsByLayer.push(N),0<P.length&&this._geometryCurvePositionsByBlock_ZeroLayer.push(P)},q.prototype.addGeometryMesh=function(p,m,f,N,P){0<p.length&&(this._geometryMeshPostion.push(p),this._geometryMeshColor.push(m)),0<f.length&&this._geometryMeshPositionsByBlock.push(f),0<N.length&&this._geometryMeshPositionsByLayer.push(N),0<P.length&&this._geometryMeshPositionsByBlock_ZeroLayer.push(P)},q.prototype.addGeometryTexture=function(p,m,f,N,P,O,Z){var te=new A;te.pos=p,te.textureCoord=m,te.color=f,te.sFileName=N,te.dAngel=P,te.ptRotationPostionX=O,te.ptRotationPostionY=Z,this._TextureData.push(te)},q.prototype.addMemorySections=function(p){this._MemorySections.push(p)},q.prototype.createThreejsObj=function(p,m,f,N,P){var O=f.getScene(),Z=f.getCanvas();if(p.length!=0){if(this._color==null){var te=N.getColor(P);this._color=[],this._color.push((255&te)/255,(te>>8&255)/255,(te>>16&255)/255),this._colorValue=16777215&te}this._geometryCurvePostion.length==0&&this._geometryCurvePositionsByBlock.length==0&&this._geometryCurvePositionsByLayer.length==0&&this._geometryCurvePositionsByBlock_ZeroLayer.length==0||this.createThreejsObjForCurve(p,O),this._geometryMeshPostion.length==0&&this._geometryMeshPositionsByBlock.length==0&&this._geometryMeshPositionsByLayer.length==0&&this._geometryMeshPositionsByBlock_ZeroLayer.length==0||this.createThreejsObjForMesh(p,O),this._TextureData.length!=0&&this.createThreejsObjForTexture(p,O,f),this._MemorySections.length!=0&&this.createThreejsObjForMemorySections(p,O,f)}m.size!=0&&(this._color==null&&(te=N.getColor(P),this._color=[],this._color.push((255&te)/255,(te>>8&255)/255,(te>>16&255)/255),this._colorValue=16777215&te),this._geometryCurvePostion.length==0&&this._geometryCurvePositionsByBlock.length==0&&this._geometryCurvePositionsByLayer.length==0&&this._geometryCurvePositionsByBlock_ZeroLayer.length==0||this.createThreejsObjForCurve_Clip(m,O,Z),this._geometryMeshPostion.length==0&&this._geometryMeshPositionsByBlock.length==0&&this._geometryMeshPositionsByLayer.length==0&&this._geometryMeshPositionsByBlock_ZeroLayer.length==0||this.createThreejsObjForMesh_Clip(m,O,Z),this._TextureData.length!=0&&this.createThreejsObjForTexture_Clip(m,O,f),this._MemorySections.length!=0&&this.createThreejsObjForMemorySections_clip(m,O,f)),this._geometryCurvePostion=[],this._geometryCurvePositionsByBlock=[],this._geometryCurvePositionsByLayer=[],this._geometryCurvePositionsByBlock_ZeroLayer=[],this._geometryCurveColor=[],this._geometryMeshPostion=[],this._geometryMeshPositionsByBlock=[],this._geometryMeshPositionsByLayer=[],this._geometryMeshPositionsByBlock_ZeroLayer=[],this._geometryMeshColor=[],this._TextureData=[],this._MemorySections=[]},q);function q(p){this._blockRecId=0,this._TextureData=[],this._MemorySections=[],this._geometryCurvePostion=new Array,this._geometryCurveColor=new Array,this._geometryMeshPostion=new Array,this._geometryMeshColor=new Array,this._geometryCurvePositionsByBlock=new Array,this._geometryMeshPositionsByBlock=new Array,this._geometryCurvePositionsByLayer=new Array,this._geometryMeshPositionsByLayer=new Array,this._geometryCurvePositionsByBlock_ZeroLayer=new Array,this._geometryMeshPositionsByBlock_ZeroLayer=new Array,this._entitys=new Array,this._color=void 0,this._colorValue=16777215,this._material_clip=[],this._blockRecId=p}o.Layer=S;var W=(_.prototype.showLayer=function(p,m){var f=this._layerTogeometry.get(p);f!=null&&f.Show(m)},_.prototype.updataClipMaterial=function(p){var m=p.getCanvas();this._layerTogeometry.forEach(function(f,N,P){f.updataClipMaterial(m)})},_.prototype.getId=function(){return this._id},_.prototype.getBlkRef=function(){return this._blkRef},_.prototype.createThreejsObj=function(p,m){var f=this;this._layerTogeometry.forEach(function(N,P,O){N.createThreejsObj(f._instance,f._instance_clip,p,m,P)})},_.prototype.addGeometryCurve=function(p,m,f,N,P,O){var Z=this._layerTogeometry.get(f);Z==null&&(Z=new S(this._id),this._layerTogeometry.set(f,Z)),Z.addGeometryCurve(p,m,N,P,O)},_.prototype.addMemorySections=function(p){var m=this._layerTogeometry.get(p.layerId);m==null&&(m=new S(this._id),this._layerTogeometry.set(p.layerId,m)),m.addMemorySections(p)},_.prototype.addGeometryTexture=function(p,m,f,N,P,O,Z,te){var de=this._layerTogeometry.get(N);de==null&&(de=new S(this._id),this._layerTogeometry.set(N,de)),de.addGeometryTexture(p,m,f,P,O,Z,te)},_.prototype.addGeometryMesh=function(p,m,f,N,P,O){var Z=this._layerTogeometry.get(f);Z==null&&(Z=new S(this._id),this._layerTogeometry.set(f,Z)),Z.addGeometryMesh(p,m,N,P,O)},_.prototype.addInstance=function(p){var m;p.clipPlans.ver<=3?p.clipPlans.clipPlanArray.length==0?this._instance.length<5e4&&this._instance.push(p):((m=this._instance_clip.get(p.clipPlans.id))==null&&(m=[],this._instance_clip.set(p.clipPlans.id,m)),m.push(p)):p.clipPlans.instansClipePoints.length==0||100<this._instance_clip.size?this._instance.length<5e4&&this._instance.push(p):((m=this._instance_clip.get(p.clipPlans.id))==null&&(m=[],this._instance_clip.set(p.clipPlans.id,m)),m.push(p))},_.prototype.addBlkRef=function(p){this._blkRef.push(p)},_);function _(p){this._id=0,this._layerTogeometry=new Map,this._blkRef=[],this._instance=[],this._instance_clip=new Map,this._id=p}o.Block=W;var R=(v.prototype.crateBlock=function(p){var m=this._mapBlock.get(p);return m==null&&(m=new W(p),this._mapBlock.set(p,m)),m},v.prototype.getBlock=function(p){return this._mapBlock.get(p)},v.prototype.addBlockRef=function(p){this.crateBlock(p.blkOwnerId).addBlkRef(p)},v.prototype.showLayer=function(p,m){this._mapBlock.forEach(function(f,N){var P=f,O=N;return function(Z,te,de){Z.showLayer(P,O)}}.call(this,p,m))},v.prototype.createBlocks_30=function(p,m){if(!this._isCreate){this.crateBlock(0);for(var f=1,N=p.getInt32(12,!0),P=80,O=0;O<N;O++){var Z=p.getInt32(P,!0);P+=4;var te=p.getInt32(P,!0);P+=4;var de=p.getInt32(P,!0);P+=4;var me=p.getInt32(P,!0);P+=4;for(var we=new Array,ge=0;ge<16;ge++){var Le=p.getFloat32(P,!0);P+=4,we.push(Le)}var Pe=p.getInt32(P,!0);P+=4;var ae=new y;ae.id=f,ae.ver=3,f++,ae.clipPlanArray=[];for(var ve=0;ve<Pe;ve++){var Ie=p.getFloat32(P,!0);P+=4;var ze=p.getFloat32(P,!0);P+=4;var He=p.getFloat32(P,!0);P+=4;var at=p.getFloat32(P,!0);P+=4;var tt=new L;tt.x1=Ie,tt.y1=ze,tt.x2=He,tt.y2=at,ae.clipPlanArray.push(tt)}var le=new D;le.ver=3,le.mat=new a.Matrix4,le.mat.fromArray(we),le.blkRecId=de,le.blkOwnerId=Z,le.layerId=te,le.color=me,le.clipPlans=ae,this.crateBlock(de),this.addBlockRef(le)}this._isGetAllBlocks=!0,this._isCreate=!0}},v.prototype.createBlocks_40=function(p,m){if(!this._isCreate){this.crateBlock(0);for(var f=1,N=p.getInt32(12,!0),P=80,O=0;O<N;O++){var Z=p.getInt32(P,!0);P+=4;var te=p.getInt32(P,!0);P+=4;var de=p.getInt32(P,!0);P+=4;var me=p.getInt32(P,!0);P+=4;for(var we=new Array,ge=0;ge<16;ge++){var Le=p.getFloat32(P,!0);P+=4,we.push(Le)}var Pe=p.getInt32(P,!0);P+=4;var ae=new y;ae.id=f,ae.ver=4,f++,ae.clipPoints=[];for(var ve=0;ve<Pe;ve++){var Ie=new a.Vector2;Ie.x=p.getFloat32(P,!0),P+=4,Ie.y=p.getFloat32(P,!0),P+=4,ae.clipPoints.push(Ie)}var ze=new D;ze.ver=4,ze.mat=new a.Matrix4,ze.mat.fromArray(we),ze.blkRecId=de,ze.blkOwnerId=Z,ze.layerId=te,ze.color=me,ze.clipPlans=ae,this.crateBlock(de),this.addBlockRef(ze)}this._isGetAllBlocks=!0,this._isCreate=!0}},v.prototype.createBlocks=function(p,m){this._isCreate||(new I.MxNetData(p).getVersion_MwBlobHead()<=3?this.createBlocks_30(p,m):this.createBlocks_40(p,m))},v.prototype.updataClipMaterial=function(p){this._mapBlock.forEach(function(m,f,N){m.updataClipMaterial(p)})},v.prototype.createAllInstance=function(p){var m=this.getBlock(0);if(m==null||this._rootBlockRef==null)return!1;var f=new a.Matrix4,N=new Map,P=new y;return this._iClipIdCount=1,P.id=this._iClipIdCount,this._iClipIdCount++,this.createAllInstanceCall(m,this._rootBlockRef,f,N,16777215,p,void 0,P),!0},v.prototype.createThreejsObj=function(p,m,f){this._mapNeedCreateThreejsObj.get(p.getId())==null&&this._mapNeedCreateThreejsObj.set(p.getId(),p),this._isCreateAllInstance||this._isGetAllBlocks&&f.isInitComplete()&&(this._isCreateAllInstance=this.createAllInstance(f)),this._isCreateAllInstance&&(this._mapNeedCreateThreejsObj.forEach(function(N,P,O){N.createThreejsObj(m,f)}),this._mapNeedCreateThreejsObj.clear())},v.prototype.createAllInstanceCall=function(p,m,f,N,P,O,Z,te){if(N[p.getId()]!=1){N[p.getId()]=!0;var de=new C;if(de.mat=new a.Matrix4,de.mat.copy(f),de.mat.multiply(m.mat),m.ver<=3)if(m.clipPlans.clipPlanArray.length==0)de.clipPlans=te;else{de.clipPlans=m.clipPlans,de.clipPlans.ver=3;for(var me,we,ge,Le,Pe=de.clipPlans.clipPlanArray.length,ae=function(){me=new a.Vector3(de.clipPlans.clipPlanArray[ve].x1,de.clipPlans.clipPlanArray[ve].y1,0),we=new a.Vector3(de.clipPlans.clipPlanArray[ve].x2,de.clipPlans.clipPlanArray[ve].y2,0),ge=new a.Vector3(de.clipPlans.clipPlanArray[ve].x1,de.clipPlans.clipPlanArray[ve].y2,0),Le=new a.Vector3(de.clipPlans.clipPlanArray[ve].x2,de.clipPlans.clipPlanArray[ve].y1,0),me.applyMatrix4(de.mat),we.applyMatrix4(de.mat),ge.applyMatrix4(de.mat),Le.applyMatrix4(de.mat);var St=me.x,Rt=me.x,Pt=me.y,Je=me.y,bt=[];bt.push(we),bt.push(ge),bt.push(Le),bt.forEach(function(jt){St>jt.x&&(St=jt.x),Rt<jt.x&&(Rt=jt.x),Pt>jt.y&&(Pt=jt.y),Je<jt.y&&(Je=jt.y)}),de.clipPlans.clipPlanArray[ve].x1=St,de.clipPlans.clipPlanArray[ve].y1=Pt,de.clipPlans.clipPlanArray[ve].x2=Rt,de.clipPlans.clipPlanArray[ve].y2=Je},ve=0;ve<Pe;ve++)ae()}else if(m.clipPlans.clipPoints.length==0)de.clipPlans=te;else{de.clipPlans=new y,de.clipPlans.ver=4,de.clipPlans.id=this._iClipIdCount,this._iClipIdCount++,de.clipPlans.instansClipePoints=te.instansClipePoints.slice(0);var Ie=[],ze=m.clipPlans.clipPoints;for(Pe=ze.length,ve=0;ve<Pe;ve++){var He=new a.Vector3(ze[ve].x,ze[ve].y,0);He.applyMatrix4(de.mat),Ie.push(new a.Vector2(He.x,He.y))}de.clipPlans.instansClipePoints.push(Ie)}Z==null?de.topLayerColor.push(1,1,1):de.topLayerColor.push(Z[0],Z[1],Z[2]);var at=m.color>>24&255;if(at==2)de.color.push((255&P)/255,(P>>8&255)/255,(P>>16&255)/255);else if(at==1){var tt=O.getColor(m.layerId);de.color.push((255&tt)/255,(tt>>8&255)/255,(tt>>16&255)/255),P=tt}else de.color.push((255&m.color)/255,(m.color>>8&255)/255,(m.color>>16&255)/255),P=m.color;p.addInstance(de);for(var le=p.getBlkRef(),De=Z==null,st=0;st<le.length;st++)if(le[st].blkRecId!=0){var gt=this.getBlock(le[st].blkRecId);if(gt==null)return;De&&(Z=[],tt=O.getColor(le[st].layerId),Z.push((255&tt)/255,(tt>>8&255)/255,(tt>>16&255)/255)),this.createAllInstanceCall(gt,le[st],de.mat,N,P,O,Z,de.clipPlans)}N[p.getId()]=!1}},v.prototype.initRootBlockRef=function(p){p==null&&((p=new D).mat=new a.Matrix4,p.blkRecId=0,p.blkOwnerId=-1,p.layerId=-1,p.color=16777215),this._rootBlockRef=p},v);function v(){this._mapBlock=new Map,this._mapNeedCreateThreejsObj=new Map,this._isCreate=!1,this._isGetAllBlocks=!1,this._isCreateAllInstance=!1,this._rootBlockRef=void 0,this._iClipIdCount=1}o.Blocks=R;var V=function(){this.blocks=new R,this.layers=new u.MxBrowseLayerData};o.ExternalReferenceDatabase=V;var Y=(c.prototype.createTzDwgExternalReferences=function(p){this._mapId2ExternalDatabase.get(p)||this.getBlocks(p).initRootBlockRef()},c.prototype.createExternalReferences=function(p){for(var m=p.getInt32(12,!0),f=80,N=0;N<m;N++){for(var P=new Array,O=0;O<16;O++){var Z=p.getFloat32(f,!0);f+=4,P.push(Z)}var te=p.getInt32(f,!0);f+=4;var de=p.getInt32(f,!0);if(f+=4,p.getInt32(f,!0),f+=4,te!=0){var me=this.getBlocks(te),we=new D;we.mat=new a.Matrix4,we.mat.fromArray(P),we.blkRecId=0,we.blkOwnerId=-1,we.layerId=-1,we.color=de,me.initRootBlockRef(we)}else console.log("mx error iDatabaseIndex")}},c.prototype.getBlocks=function(p){if(p!=0){var m=this._mapId2ExternalDatabase.get(p);return m==null&&(m=new V,this._mapId2ExternalDatabase.set(p,m)),m.blocks}console.log("mx error iDatabaseIndex")},c.prototype.getLayers=function(p){if(p!=0){var m=this._mapId2ExternalDatabase.get(p);return m==null&&(m=new V,this._mapId2ExternalDatabase.set(p,m)),m.layers}console.log("mx error iDatabaseIndex")},c);function c(){this._mapId2ExternalDatabase=new Map}o.ExternalReferenceManager=Y},{"../MxFun":27,"../MxManager":29,"../MxNetData":31,"../MxShader":32,"../MxStencilObject":33,"./MxBrowseLayerData":67,three:19}],67:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxBrowseLayerData=void 0;var a=(x.prototype.add=function(u,M,I){this._layerColor[u]=M,this._nametoId[I]=u},x.prototype.setZeroLayerId=function(u){this._zeroLayerId=u},x.prototype.getZeroLayerId=function(){return this._zeroLayerId},x.prototype.getLayerIdForName=function(u){return this._nametoId[u]==null?0:this._nametoId[u]},x.prototype.getColor=function(u){return this._layerColor[u]==null?16777215:this._layerColor[u]},x.prototype.initComplete=function(){this._isSetInstanceComplete=!0},x.prototype.isInitComplete=function(){return this._isSetInstanceComplete},x);function x(){this._isSetInstanceComplete=!1,this._layerColor=new Map,this._nametoId=new Map,this._zeroLayerId=0}o.MxBrowseLayerData=a},{}],68:[function(T,r,o){var a=this&&this.__awaiter||function(S,q,W,_){return new(W=W||Promise)(function(R,v){function V(p){try{c(_.next(p))}catch(m){v(m)}}function Y(p){try{c(_.throw(p))}catch(m){v(m)}}function c(p){var m;p.done?R(p.value):((m=p.value)instanceof W?m:new W(function(f){f(m)})).then(V,Y)}c((_=_.apply(S,q||[])).next())})},x=this&&this.__generator||function(S,q){var W,_,R,v={label:0,sent:function(){if(1&R[0])throw R[1];return R[1]},trys:[],ops:[]},V=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return V.next=Y(0),V.throw=Y(1),V.return=Y(2),typeof Symbol=="function"&&(V[Symbol.iterator]=function(){return this}),V;function Y(c){return function(p){return function(m){if(W)throw new TypeError("Generator is already executing.");for(;V&&m[V=0]&&(v=0),v;)try{if(W=1,_&&(R=2&m[0]?_.return:m[0]?_.throw||((R=_.return)&&R.call(_),0):_.next)&&!(R=R.call(_,m[1])).done)return R;switch(_=0,R&&(m=[2&m[0],R.value]),m[0]){case 0:case 1:R=m;break;case 4:return v.label++,{value:m[1],done:!1};case 5:v.label++,_=m[1],m=[0];continue;case 7:m=v.ops.pop(),v.trys.pop();continue;default:if(!(R=0<(R=v.trys).length&&R[R.length-1])&&(m[0]===6||m[0]===2)){v=0;continue}if(m[0]===3&&(!R||m[1]>R[0]&&m[1]<R[3])){v.label=m[1];break}if(m[0]===6&&v.label<R[1]){v.label=R[1],R=m;break}if(R&&v.label<R[2]){v.label=R[2],v.ops.push(m);break}R[2]&&v.ops.pop(),v.trys.pop();continue}m=q.call(S,v)}catch(f){m=[6,f],_=0}finally{W=R=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([c,p])}}};Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbDatabase=void 0;var u=T("three"),M=T("../MxFun"),I=T("./MxDbEntity"),H=T("./MxDbEntityGrip"),G=T("./MxDbEntitySelect"),L=T("../MxManager"),y=T("../MxType"),D=T("./MxDbLayerTable"),C=T("./MxDbGroup"),B=T("../MxTools"),z=(A.prototype.getAllEntity=function(){return this.mapIdToEntity},A.prototype.getGroupDictionary=function(){return this.groupDictionary},A.prototype.regenAllMxDbEntity=function(){return this.mapIdToEntity.forEach(function(S){S.upDisplay(),S.setDirtyDisplay(!1)}),!0},A.prototype.upDirtyDisplay=function(){var S=!1;return this.mapIdToEntity.forEach(function(q){q.getDirtyDisplay()&&(q.upDisplay(),q.setDirtyDisplay(!1),S=!0)}),S},A.prototype.onViewChange=function(){var S=!1;return this.mapIdToEntity.forEach(function(q){q.onViewChange()&&(S=!0)}),S},A.prototype.toJsonObject=function(S){var q={ver:1},W=new u.Vector3(0,0,0),_=new u.Vector3(this.mxObj.getViewWidth(),this.mxObj.getViewHeight(),0),R=y.MxType.MxCloneType.kMxFileClone;S&&(R=y.MxType.MxCloneType.kSaveDwgClone);var v=this.mxObj.screenCoord2Current(W.x,W.y,0),V=this.mxObj.screenCoord2Current(_.x,_.y,0);q.view={ptView1:v,ptView2:V};var Y=[];return this.mapNameToLayer.forEach(function(c){var p={type:R};c.dwgOut(p),p.TypeName="MxDbLayerTableRecord",Y.push(p)}),q.layers=Y,this.groupDictionary.dwgOut(q),q},A.prototype.saveJson=function(S){var q=this,W=this.toJsonObject(S),_=y.MxType.MxCloneType.kMxFileClone;S&&(_=y.MxType.MxCloneType.kSaveDwgClone);var R=[];return this.mapIdToEntity.forEach(function(v){var V=v.getUserObject(),Y={type:_};V.dwgOut(Y),Y.TypeName=V.getTypeName(),Y.group=q.groupDictionary.getEntityInGroupName(v.objectId()),R.push(Y)}),W.entitys=R,W},A.prototype.reInit=function(){this.eraseAllEntity(),this.groupDictionary=new C.MxDbGroupDictionary;var S=this.parentObject.matrix;this.init(this.mxObj),this.initObjectMatrix(S)},A.prototype.init=function(S){this.mxObj=S,this.scene=S.getScene(),M.MxFun.removeThreejsObject(this.parentObject,this.scene),M.MxFun.removeThreejsObject(this.parentObject_SmallCoord,this.scene),this.parentObject=new u.Object3D,this.parentObject.renderOrder=L.MxData.iMxEntityRenderOrder,this.scene.add(this.parentObject),this.parentObject_SmallCoord=new u.Object3D,this.parentObject_SmallCoord.renderOrder=L.MxData.iMxEntityRenderOrder,this.scene.add(this.parentObject_SmallCoord),this.initLayerTable()},A.prototype.loadJson=function(S){return a(this,void 0,void 0,function(){var q,W,_,R,v,V,Y,c,p,m,f=this;return x(this,function(N){switch(N.label){case 0:if(this.reInit(),(q=S).view&&(W=q.view,this.mxObj.zoomW(new u.Vector3(W.ptView1.x,W.ptView1.y,0),new u.Vector3(W.ptView2.x,W.ptView2.y,0),!1)),_=q.layers)for(R=_.length,m=0;m<R;m++)v=_[m],this.addLayer(v.name).dwgIn(v);this.groupDictionary.dwgIn(q),V=q.entitys,Y=V.length,c=function(P){var O,Z,te,de;return x(this,function(me){switch(me.label){case 0:return O=V[P],[4,L.MxManager.getMxDbEntityClassHierarchy().createMxEntity(O.TypeName)];case 1:return(Z=me.sent())?(Z.dwgIn(O),(te=new I.MxDbEntity).initUserObject(Z),p.addEntityImp(te),(de=O.group)&&0<de.length&&de.forEach(function(we){f.groupDictionary.add(we).append(te.objectId())}),[2]):[2,"continue"]}})},p=this,m=0,N.label=1;case 1:return m<Y?[5,c(m)]:[3,4];case 2:N.sent(),N.label=3;case 3:return m++,[3,1];case 4:return[2,new Promise(function(P){P(!0)})]}})})},A.prototype.getMxObject=function(){return this.mxObj},A.prototype.getGripManager=function(){return this.gripManager},A.prototype.getSelectManager=function(){return this.selectManager},A.prototype.clearMxCurrentSelect=function(){var S=!1;return this.gripManager.removeAllGrips()&&(S=!0),this.selectManager.removeAllEntity()&&(S=!0),S},A.prototype.eraseAllEntity=function(){this.mapIdToEntity.forEach(function(S){S.clearDisplayImp()}),this.mapIdToEntity=new Map,this.clearMxCurrentSelect()},A.prototype.initObjectMatrix=function(S){this.parentObject.matrix=S,this.parentObject.matrixAutoUpdate=!1,this.parentObject_SmallCoord.matrix=new u.Matrix4,this.parentObject_SmallCoord.matrixAutoUpdate=!1},A.prototype.initLayerTable=function(){this.mapNameToLayer=new Map,this.curLayer="0";var S=new D.MxDbLayerTableRecord;S.init(this.curLayer,this.parentObject,this.parentObject_SmallCoord),this.mapNameToLayer.set(this.curLayer,S)},A.prototype.getEntity=function(S){return this.mapIdToEntity.get(S)},A.prototype.isValidId=function(S){return this.mapIdToEntity.has(S)},A.prototype.setRenderOrder=function(S){var q=this.parentObject.renderOrder;return this.parentObject.renderOrder=S,this.parentObject_SmallCoord.renderOrder=S,q},A.prototype.eraseEntity=function(S){this.gripManager.deleteGripData(S),this.selectManager.deleteSelect(S),this.mapIdToEntity.delete(S)},A.prototype.showLayer=function(S,q){var W=this.getLayer(S);W&&W.setVisible(q)},A.prototype.setCurrentLayer=function(S){if(S.length!=0)return this.curLayer=S,this.addLayer(S)},A.prototype.addLayer=function(S){var q=this.mapNameToLayer.get(S);return q||((q=new D.MxDbLayerTableRecord).init(S,this.parentObject,this.parentObject_SmallCoord),this.mapNameToLayer.set(S,q),q)},A.prototype.getLayer=function(S){return this.mapNameToLayer.get(S)},A.prototype.addMxEntity=function(S){if(S.getImp())return S.objectId();var q=new I.MxDbEntity;return q.initUserObject(S),S.initGuid(B.MxTools.generateUUID()),this.addEntityImp(q)},A.prototype.addEntityImp=function(S){return this.mapIdToEntity.set(this.idCount,S),S.setMxDatabase(this),S.setObjectId(this.idCount),S.getLayer().length==0&&S.setLayer(this.curLayer),S.upDisplay(),this.idCount++},A.prototype.getThreeJSParentObject=function(){return this.parentObject},A.prototype.getThreeJSParentObject_SmallCoord=function(){return this.parentObject_SmallCoord},A.prototype.getIntersectObjects=function(S){var q=this.getIntersectObjects_imp(S),W=this.getIntersectObjects_SmallCoord_imp(S);return q.concat(W)},A.prototype.getIntersectObjects_imp=function(S){return this.mxObj.getMxDrawThreeJs().createRaycaster(S).intersectObjects(this.parentObject.children,!0)},A.prototype.getIntersectObjects_SmallCoord_imp=function(S){return this.mxObj.getMxDrawThreeJs().createRaycaster(S).intersectObjects(this.parentObject_SmallCoord.children,!0)},A);function A(){this.mapIdToEntity=new Map,this.mxObj=null,this.scene=null,this.idCount=1,this.parentObject=null,this.parentObject_SmallCoord=null,this.mapNameToLayer=new Map,this.curLayer="0",this.gripManager=new H.MxDbEntityGrip(this),this.selectManager=new G.MxDbEntitySelect(this),this.groupDictionary=new C.MxDbGroupDictionary}o.MxDbDatabase=z},{"../MxFun":27,"../MxManager":29,"../MxTools":38,"../MxType":39,"./MxDbEntity":69,"./MxDbEntityGrip":70,"./MxDbEntitySelect":71,"./MxDbGroup":72,"./MxDbLayerTable":73,three:19}],69:[function(T,r,o){var a=this&&this.__awaiter||function(A,S,q,W){return new(q=q||Promise)(function(_,R){function v(c){try{Y(W.next(c))}catch(p){R(p)}}function V(c){try{Y(W.throw(c))}catch(p){R(p)}}function Y(c){var p;c.done?_(c.value):((p=c.value)instanceof q?p:new q(function(m){m(p)})).then(v,V)}Y((W=W.apply(A,S||[])).next())})},x=this&&this.__generator||function(A,S){var q,W,_,R={label:0,sent:function(){if(1&_[0])throw _[1];return _[1]},trys:[],ops:[]},v=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return v.next=V(0),v.throw=V(1),v.return=V(2),typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function V(Y){return function(c){return function(p){if(q)throw new TypeError("Generator is already executing.");for(;v&&p[v=0]&&(R=0),R;)try{if(q=1,W&&(_=2&p[0]?W.return:p[0]?W.throw||((_=W.return)&&_.call(W),0):W.next)&&!(_=_.call(W,p[1])).done)return _;switch(W=0,_&&(p=[2&p[0],_.value]),p[0]){case 0:case 1:_=p;break;case 4:return R.label++,{value:p[1],done:!1};case 5:R.label++,W=p[1],p=[0];continue;case 7:p=R.ops.pop(),R.trys.pop();continue;default:if(!(_=0<(_=R.trys).length&&_[_.length-1])&&(p[0]===6||p[0]===2)){R=0;continue}if(p[0]===3&&(!_||p[1]>_[0]&&p[1]<_[3])){R.label=p[1];break}if(p[0]===6&&R.label<_[1]){R.label=_[1],_=p;break}if(_&&R.label<_[2]){R.label=_[2],R.ops.push(p);break}_[2]&&R.ops.pop(),R.trys.pop();continue}p=S.call(A,R)}catch(m){p=[6,m],W=0}finally{q=_=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}([Y,c])}}};Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbEntity=o.MxDbEntityClassHierarchy=o.MxDbEntityUserObject=void 0;var u=T("three"),M=T("../Operate/McGiWorldDraw"),I=T("../MxManager"),H=T("../MxTools"),G=T("../MxType"),L=(y.prototype.getClosestPointTo=function(A,S){return null},y.prototype.getTypeName=function(){return""},y.prototype.isUseSmallcoordDisplay=function(){return this.use_smallcoord_display},y.prototype.toSmallcoord=function(A,S){return this.use_smallcoord_display?A.toSmallcoord(S):S},y.prototype.initGuid=function(A){0<this.sGuid.length?console.log("mx: init guid error"):this.sGuid=A},y.prototype.guid=function(){return this.sGuid},y.prototype.setGuid=function(A){this.sGuid=A},y.prototype.setLayer=function(A){var S=this.getImp();S&&S.nodifySetLayer(),this.layer=A},y.prototype.getLayer=function(){return this.layer},y.prototype.setDash=function(A,S){this.dDashArray=A,this.dDashRatio=S,this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0)},y.prototype.getDash=function(){return{dDashArray:this.dDashArray,dDashRatio:this.dDashRatio}},y.prototype.setDashLineDisplay=function(A){A?(this.dDashArray=.03,this.dDashRatio=.1,this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0)):(this.dDashArray=0,this.dDashRatio=0)},y.prototype.isDashLineDisplay=function(){return 0<this.dDashArray&&0<this.dDashRatio},y.prototype.setLineWidthByPixels=function(A){this.lineWidthByPixels=A},y.prototype.getLineWidthByPixels=function(){return this.lineWidthByPixels},y.prototype.setLineWidth=function(A){this.dLineWidth=A},y.prototype.getLineWidth=function(){return this.dLineWidth},y.prototype.getMxObject=function(){var A=this.getImp();return A?A.getMxObject():null},y.prototype.onViewChange=function(){return!1},y.prototype.getImp=function(){return this.MxDbEntityImp},y.prototype.upDisplay=function(){var A=this.getImp();return!!A&&A.upDisplay()},y.prototype.erase=function(){var A=this.getImp();return!!A&&A.erase()},y.prototype.setColor=function(A){this.iColor=A},y.prototype.getColor=function(){return this.iColor},y.prototype.setRenderOrder=function(A){this.iRenderOrder=A},y.prototype.getRenderOrder=function(){return this.iRenderOrder},y.prototype.onEndGripEidt=function(){},y.prototype.onStartGripEidt=function(){},y.prototype.dwgIn=function(A){return this.iColor=A.iColor,this.iRenderOrder=A.iRenderOrder,this.opacity=A.opacity,this.visible=A.visible,this.dLineWidth=A.lineWidth,this.lineWidthByPixels=A.lineWidthByPixels,this.dDashArray=A.dashArray,this.dDashRatio=A.dashRatio,this.layer=A.layer,A.guid&&(this.sGuid=A.guid),!0},y.prototype.dwgOut=function(A){return A.iColor=this.iColor,A.iRenderOrder=this.iRenderOrder,A.opacity=this.opacity,A.visible=this.visible,A.lineWidth=this.dLineWidth,A.lineWidthByPixels=this.lineWidthByPixels,A.dashArray=this.dDashArray,A.dashRatio=this.dDashRatio,A.layer=this.layer,A.guid=this.sGuid,A},y.prototype.clone=function(A){var S=this.create(),q={type:A||G.MxType.MxCloneType.kClone};return this.dwgOut(q),S.dwgIn(q),S.sGuid="",S},y.prototype.init=function(){I.MxManager.getMxDbEntityClassHierarchy().init(this)},y.prototype.transformBy=function(A){},y.prototype.objectId=function(){var A=this.getImp();return A?A.objectId():0},y);function y(){this.iColor=16777215,this.iRenderOrder=I.MxData.iMxEntityRenderOrder,this.opacity=1,this.visible=!0,this.dLineWidth=0,this.lineWidthByPixels=!0,this.dDashArray=0,this.dDashRatio=0,this.layer="",this.sGuid="",this.use_smallcoord_display=!1}o.MxDbEntityUserObject=L;var D=(C.prototype.init=function(A){var S=A.getTypeName();this.mapType2Create.get(S)&&console.log("MxError:already has this class name "+S),this.mapType2Create.set(S,{type:0,createfun:A})},C.prototype.initDynamic=function(A){this.dynmaicCreate=A},C.prototype.createMxEntity=function(A){return a(this,void 0,void 0,function(){var S,q;return x(this,function(W){switch(W.label){case 0:return(S=this.mapType2Create.get(A))?[3,3]:this.dynmaicCreate?[4,this.dynmaicCreate(A)]:[3,2];case 1:return(q=W.sent())?(this.mapType2Create.set(A,{type:1,createfun:q}),[2,new Promise(function(_,R){_(new q)})]):[2,new Promise(function(_,R){_(null)})];case 2:return[2,new Promise(function(_,R){_(null)})];case 3:return S.type==0?[2,new Promise(function(_,R){_(S.createfun.create())})]:S.type==1?[2,new Promise(function(_,R){_(new S.createfun)})]:[2,new Promise(function(_,R){_(null)})]}})})},C);function C(){this.mapType2Create=new Map,this.dynmaicCreate=null}o.MxDbEntityClassHierarchy=D;var B=(z.prototype.setObjectId=function(A){this.id=A},z.prototype.nodifySetLayer=function(){this.layerObjectGroup&&this.clearDisplayImp()},z.prototype.setLayer=function(A){this.userObject.setLayer(A)},z.prototype.getLayer=function(){return this.userObject.getLayer()},z.prototype.setDirtyDisplay=function(A){this.isDirtyDisplay=A},z.prototype.getDirtyDisplay=function(){return this.isDirtyDisplay},z.prototype.setMxDatabase=function(A){this.mxDatabase=A},z.prototype.objectId=function(){return this.id},z.prototype.initUserObject=function(A){(this.userObject=A).MxDbEntityImp=this},z.prototype.upDisplay=function(){if(!this.mxDatabase)return console.log("mxassert(0) this.mxDatabase is null"),!1;this.updateDisplayImp(this.mxDatabase.getMxObject())},z.prototype.erase=function(){if(this.id==0)return!1;this.clearDisplayImp(),this.userObject=null,this.mxDatabase.eraseEntity(this.id),this.id=0,this.mxDatabase=null},z.prototype.clearDisplayImp=function(){this.layerObjectGroup&&(this.threeObjectGroup&&(this.threeObjectGroup.traverse(function(A){A.type==="Mesh"&&(A.geometry.dispose(),A.material.dispose())}),this.layerObjectGroup.remove(this.threeObjectGroup)),this.threeObjectGroup=null,this.layerObjectGroup=null)},z.prototype.updateDisplayImp=function(A){if(this.clearDisplayImp(),this.userObject){if(this.userObject.visible){var S=this.mxDatabase.addLayer(this.userObject.getLayer());if(!S)return console.log("mxassert(0) this.layerRecord is null"),!1;this.threeObjectGroup=new u.Object3D;var q=new M.McGiWorldDraw(A,M.McGiWorldDrawType.kWorldDraw);q.setupForEntity(this.userObject),this.worldDraw(q);for(var W=q.getEntitys(),_=W.length,R=0;R<_;R++){var v=W[R];(v.MxDbEntity=this).threeObjectGroup.add(v)}this.userObject.isUseSmallcoordDisplay()?this.layerObjectGroup=S.getGroup_SmallCoord():this.layerObjectGroup=S.getGroup(),this.layerObjectGroup.add(this.threeObjectGroup)}}else H.MxTools.MxASSERT(!1,"this.userObject == null")},z.prototype.worldDraw=function(A){this.userObject.worldDraw(A)},z.prototype.getGripPoints=function(){return this.userObject.getGripPoints()},z.prototype.getClosestPointTo=function(A,S){return this.userObject.getClosestPointTo(A,S)},z.prototype.getUserObject=function(){return this.userObject},z.prototype.clone=function(A){var S=new z;return S.initUserObject(this.userObject.clone(A)),S},z.prototype.transformBy=function(A){this.userObject.transformBy(A)},z.prototype.setColor=function(A){this.userObject.setColor(A)},z.prototype.onEndGripEidt=function(){this.userObject.onEndGripEidt()},z.prototype.onStartGripEidt=function(){return this.userObject.onStartGripEidt()},z.prototype.getColor=function(){return this.userObject.getColor()},z.prototype.getMxObject=function(){return this.mxDatabase?this.mxDatabase.getMxObject():null},z.prototype.onViewChange=function(){return!!this.userObject&&this.userObject.onViewChange()},z);function z(){this.threeObjectGroup=null,this.userObject=null,this.mxDatabase=null,this.isDirtyDisplay=!1,this.layerObjectGroup=null,this.id=0}o.MxDbEntity=B},{"../MxManager":29,"../MxTools":38,"../MxType":39,"../Operate/McGiWorldDraw":44,three:19}],70:[function(T,r,o){var a,x=this&&this.__extends||(a=function(_,R){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,V){v.__proto__=V}||function(v,V){for(var Y in V)Object.prototype.hasOwnProperty.call(V,Y)&&(v[Y]=V[Y])})(_,R)},function(_,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");function v(){this.constructor=_}a(_,R),_.prototype=R===null?Object.create(R):(v.prototype=R.prototype,new v)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbEntityGrip=o.MxDbEntityGripJig=o.MxDbEntityGripData=void 0,o.MxGetMxDbEntitForThreeJsObject=B,o.MxGetWordDrawxDataForThreeJsObject=function(_){for(var R=null;_&&!(R=_.MxWordDrawXData)&&_.parent;)_=_.parent;return R};var u=T("three"),M=T("../MxFun"),I=T("../MxDrawData"),H=T("../Operate/MxJig"),G=T("../Operate/MxJigCmdManager"),L=T("../Operate/McGiWorldDraw"),y=T("../MxManager"),D=T("../MxType"),C=function(){this.threeObject=null};function B(_){for(var R=null;_&&!(R=_.MxDbEntity)&&_.parent;)_=_.parent;return R}o.MxDbEntityGripData=C;var z,A=(x(S,z=H.McEdJigCommand),S.prototype.sampler=function(){var _=G.MxJigCmdManager.InType.kGetBegan|G.MxJigCmdManager.InType.kGetEnd,R=this.acquirePoint(_);return R.status==G.MxJigCmdManager.DragStatus.kNormal&&(this.currPt=R.pt),R.status},S.prototype.getTypeName=function(){return"MxGripEdit"},S.prototype.onStartCommand=function(){this.iscallOnStartCommand=!0,z.prototype.onStartCommand.call(this)},S.prototype.done=function(_){if(_==G.MxJigCmdManager.DragStatus.kNormal){var R=this.currPt.clone();R.sub(this.dragBasePt);for(var v=this.getMxObject(),V=v.getMxDatabase(),Y=v.getMxDatabase().getGripManager(),c=this.grips.length,p=new Set,m=[],f=0;f<c;f++){var N=this.grips[f],P=this.ents[f];Y.deleteGripData(P.objectId()),P.getUserObject().moveGripPointsAt(N.iIndex,R),Y.addGripFromEntity(P),P.upDisplay(),p.add(P.objectId());var O={type:"mxdraw",id:P.objectId(),index:N.iIndex,curentPoint:this.currPt,point:N.point,offset_x:R.x,offset_y:R.y};m.push(O)}v.updateDisplay(),0<m.length&&v.callEvent("objectGripEdit",m),V.getSelectManager().upSelectDilsplay(p)}var Z=this.ents.length;for(f=0;f<Z;f++)(P=this.ents[f]).onEndGripEidt(),_!=G.MxJigCmdManager.DragStatus.kNormal&&P.upDisplay();return G.MxJigCmdManager.DoneStatius.kExitCommand},S.prototype.upDisplay=function(){var _=this.currPt.clone();if(_.sub(this.dragBasePt),!(_.length()<.001)){if(this.iscallOnStartCommand){for(var R=this.ents.length,v=0;v<R;v++){var V=this.ents[v];this.aryParam.push(V.onStartGripEidt())}this.iscallOnStartCommand=!1}var Y=this.getMxObject(),c=this.grips.length;for(v=0;v<c;v++){var p=this.grips[v],m=(V=this.ents[v],this.aryParam[v]),f=V.clone(D.MxType.MxCloneType.kDragClone);f.getUserObject().moveGripPointsAt(p.iIndex,_);var N=new L.McGiWorldDraw(Y,L.McGiWorldDrawType.kDynDragDraw);N.setupForEntity(f.getUserObject()),f.worldDraw(N);var P=N.getEntitys(),O=P.length,Z=31;m&&m.renderOrder&&(Z=m.renderOrder);for(var te=0;te<O;te++)this.drawEntity(P[te],Z,f.getUserObject().isUseSmallcoordDisplay())}}},S);function S(_,R,v){var V=z.call(this)||this;return V.aryParam=[],V.iscallOnStartCommand=!0,V.dragBasePt=_,V.grips=R,V.ents=v,V.currPt=_,V.iscallOnStartCommand=!0,V}o.MxDbEntityGripJig=A;var q=(W.prototype.getAllSelect=function(){var _=[];return this.mapGrips.forEach(function(R,v){_.push(v)}),_},W.prototype.getParentGroup=function(){return this.drawGroup||(this.drawGroup=new u.Group,this.drawGroup.renderOrder=y.MxData.iGripRenderOrder,this.database.getMxObject().getTheTempDrawContainer_SmallCoord().add(this.drawGroup)),this.drawGroup},W.prototype.reInit=function(){this.removeAllGrips(),this.drawGroup&&M.MxFun.removeThreejsObject(this.drawGroup,this.database.getMxObject().getTheTempDrawContainer_SmallCoord()),this.drawGroup=null},W.prototype.removeAllGrips=function(){if(this.mapGrips.size==0)return!1;var _=this.getParentGroup();return this.mapGrips.forEach(function(R,v,V){for(var Y=R.length,c=0;c<Y;c++){var p=R[c];M.MxFun.removeThreejsObject(p.threeObject,_)}}),this.mapGrips=new Map,!0},W.prototype.deleteGripData=function(_){var R=this.getParentGroup(),v=this.mapGrips.get(_);if(v)for(var V=v.length,Y=0;Y<V;Y++){var c=v[Y];M.MxFun.removeThreejsObject(c.threeObject,R)}this.mapGrips.delete(_)},W.prototype.createGripDisplayObject=function(_){var R=this.database.getMxObject(),v=this.getParentGroup();_.geometry=new u.Geometry;var V=R.toSmallcoord2(_.point.x,_.point.y,_.point.z),Y=R.screenCoordLong2World(I.MxDrawData.m_dInputRectWidth/2);_.geometry.vertices.push(new u.Vector3(V.x-Y,V.y-Y,0)),_.geometry.vertices.push(new u.Vector3(V.x-Y,V.y+Y,0)),_.geometry.vertices.push(new u.Vector3(V.x+Y,V.y+Y,0)),_.geometry.vertices.push(new u.Vector3(V.x+Y,V.y-Y,0)),_.geometry.faces.push(new u.Face3(0,1,2)),_.geometry.faces.push(new u.Face3(2,3,0)),_.geometry.computeFaceNormals(),_.geometry.computeVertexNormals();var c=new u.MeshBasicMaterial({color:255,transparent:!0,depthTest:!1,side:u.DoubleSide,opacity:.9}),p=new u.Mesh(_.geometry,c);v.add(p),_.threeObject=p},W.prototype.addGripData=function(_,R,v){var V=this.mapGrips.get(_);V==null&&(V=new Array,this.mapGrips.set(_,V));var Y=new C;return Y.iIndex=R,Y.point=new u.Vector3(v.x,v.y,0),V.push(Y),Y},W.prototype.hitTest=function(_){var R=this,v={grips:new Array,ents:new Array,pt:_},V=new u.Vector3(_.x,_.y,0),Y=this.database.getMxObject(),c=Y.viewCoordLong2Cad(I.MxDrawData.m_dInputRectWidth/2);return this.mapGrips.forEach(function(p,m){for(var f=p.length,N=0;N<f;N++){var P=p[N];if(P.point.distanceTo(V)<=c){var O=R.database.getEntity(m),Z=!0;Y.hasEvent("whetherEditTheGripPoint")&&(Z=Y.callEvent("whetherEditTheGripPoint",{entity:O.getUserObject(),index:P.iIndex})),Z&&(v.grips.push(P),v.ents.push(O));break}}}),v},W.prototype.onMouseLBDown=function(_){if(!I.MxDrawData.m_isEnableGripEidt)return!1;var R=this.hitTest(_);return R.grips.length!=0&&(M.MxFun.sendStringToExecute("Mx_FrontEndWebpageGripEdit",R),!0)},W.prototype.gripEditImp=function(_){var R=_.grips,v=_.ents,V=_.pt,Y=new A(V,R,v);Y.setDisableDynInput(!0),Y.setDisableOsnap(!0),G.MxJigCmdManager.runCmd(Y)},W.prototype.doWindowsSelect=function(_,R,v){},W.prototype.addGripFromEntity=function(_){if(I.MxDrawData.m_isEnableGripEidt){var R=_.getGripPoints(),v=_.objectId();this.deleteGripData(v);for(var V=0;V<R.length;V++){var Y=this.addGripData(v,V,R[V]);this.createGripDisplayObject(Y)}}},W.prototype.addSelect=function(_,R,v){v===void 0&&(v=!0);var V=this.database.getSelectManager(),Y=!1;if(this.getAllSelect().forEach(function(m){m==_&&(Y=!0)}),Y)return!1;var c=this.database.getMxObject().getMxEntity(_);if(!c)return!1;var p=new Set;return p.add(_),v&&this.addGripFromEntity(c),V.upSelectDilsplay(p),R&&this.fireMxEntitySelectChange(),!0},W.prototype.fireMxEntitySelectChange=function(){var _=this.database.getMxObject();this.isCallingMxEntitySelectChange||(this.isCallingMxEntitySelectChange=!0,_.callEvent("mxdrawSelectChange",this.getAllSelect()),this.isCallingMxEntitySelectChange=!1)},W.prototype.doPointSelect=function(_,R){R===void 0&&(R=!1);for(var v=!1,V=this.database.getSelectManager(),Y=this.database.getMxObject(),c=V.isEmptySelect(),p=!1,m=Y.viewCoordLong2Cad(.5*I.MxDrawData.m_dInputRectWidth),f=function(){Y.pointMultipleSelect()||(N.removeAllGrips()&&(p=!0),V.removeAllEntity()&&(p=!0),Y.getMcObject().isValid()&&(p=Y.getMcObject().getGripManager().clearAll()),R=!1);var P=N.database.getIntersectObjects(_);if(P.length==0)return Y.updateDisplay(),"break";var O=Y.screenCoord2Current(_.x,_.y,_.z),Z=N,te=new Set;if(P.forEach(function(we){var ge=B(we.object);if(ge){var Le=ge.objectId();if(Z.database.isValidId(Le)&&!te.has(Le)){var Pe=ge.getClosestPointTo(O,1),ae=!1;(!Pe||Pe.distanceTo(O)<m)&&(ae=!0),ae&&(te.add(Le),R?Z.deleteGripData(ge.objectId()):Z.addGripFromEntity(ge))}}}),R)te.forEach(function(we){V.deleteSelect(we)});else{var de=new Set,me=N.database.getGroupDictionary();te.forEach(function(we){de.add(we),me.getEntityInGroup(we).forEach(function(ge){ge.getAll().forEach(function(Le){Z.database.isValidId(Le)&&de.add(Le)})})}),V.upSelectDilsplay(de)}return p=!0,Y.updateDisplay(),v=!0,"break"},N=this;f()!=="break";);return!p&&c==V.isEmptySelect()||this.fireMxEntitySelectChange(),v},W);function W(_){this.database=null,this.mapGrips=new Map,this.isCallingMxEntitySelectChange=!1,this.drawGroup=null,this.database=_}o.MxDbEntityGrip=q},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxType":39,"../Operate/McGiWorldDraw":44,"../Operate/MxJig":53,"../Operate/MxJigCmdManager":54,three:19}],71:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbEntitySelect=void 0;var a=T("three"),x=T("../MxFun"),u=T("three.meshline"),M=T("../Operate/McGiWorldDraw"),I=T("../MxManager"),H=(G.prototype.setRenderOrder=function(L){this.iRenderOrder=L},G.prototype.getRenderOrder=function(){return this.iRenderOrder},G.prototype.setCanvasSize=function(L,y){this.canvasWidth==L&&this.canvasHeight==y||(this.canvasWidth=L,this.canvasHeight=y,this.material.resolution=new a.Vector2(this.canvasWidth,this.canvasHeight),this.material.needsUpdate=!0)},G.prototype.removeAllEntity=function(){return this.mapIdToThreeObject.size!=0&&(this.mapIdToThreeObject.forEach(function(L){for(var y=L.length,D=0;D<y;D++){var C=L[D];x.MxFun.removeThreejsObject(C,C.parentObject)}}),this.mapIdToThreeObject.clear(),!0)},G.prototype.isEmptySelect=function(){return this.mapIdToThreeObject.size==0},G.prototype.getParentObject=function(L){return L?this.mxDatabase.getMxObject().getTheTempDrawContainer_SmallCoord():this.mxDatabase.getMxObject().getTheTempDrawContainer()},G.prototype.getAllSelect=function(){var L=[];return this.mapIdToThreeObject.forEach(function(y,D){L.push(D)}),L},G.prototype.setPrvCommandSelect=function(L){this.aryPrvCommandSelect=L},G.prototype.getPrvCommandSelect=function(){return this.aryPrvCommandSelect},G.prototype.deleteSelect=function(L){var y=this.mapIdToThreeObject.get(L);if(y){for(var D=y.length,C=0;C<D;C++){var B=y[C];x.MxFun.removeThreejsObject(B,B.parentObject)}this.mapIdToThreeObject.delete(L)}},G.prototype.upSelectDilsplayFromId=function(L){var y=new Set;y.add(L),this.upSelectDilsplay(y)},G.prototype.upSelectDilsplay=function(L){var y=this,D=new M.McGiWorldDrawSelect(this.mxDatabase.getMxObject(),this);L.forEach(function(C){y.deleteSelect(C);var B=y.mxDatabase.getEntity(C);B&&(D.setSmallCoordDraw(B.getUserObject().isUseSmallcoordDisplay()),D.setCurEntityId(C),B.worldDraw(D))})},G.prototype.addCircleDisplay=function(L,y,D,C){var B=new a.CircleGeometry(D,64,3,2*Math.PI);if(B.vertices.shift(),B.vertices.length!=0){B.vertices.push(B.vertices[0]);var z=3*B.vertices.length;if(z!=0){for(var A=this.getParentObject(C),S=new Float32Array(z),q=0,W=0;q+2<z;q+=3,W++)S[q]=B.vertices[W].x+y.x,S[q+1]=B.vertices[W].y+y.y,S[q+2]=y.z;var _=new u.MeshLine;_.setGeometry(S);var R=new a.Mesh(_.geometry,this.material);R.renderOrder=this.iRenderOrder,(R.parentObject=A).add(R);var v=this.mapIdToThreeObject.get(L);v||(v=new Array,this.mapIdToThreeObject.set(L,v)),v.push(R)}}},G.prototype.addLineDisplay=function(L,y,D,C){var B=this.getParentObject(C),z=new Float32Array(6);z[0]=y.x,z[1]=y.y,z[2]=0,z[3]=D.x,z[4]=D.y,z[5]=0;var A=new u.MeshLine;A.setGeometry(z);var S=new a.Mesh(A.geometry,this.material);S.renderOrder=this.iRenderOrder,(S.parentObject=B).add(S);var q=this.mapIdToThreeObject.get(L);q||(q=new Array,this.mapIdToThreeObject.set(L,q)),q.push(S)},G);function G(L){this.mapIdToThreeObject=new Map,this.canvasWidth=800,this.canvasHeight=500,this.mxDatabase=null,this.material=new u.MeshLineMaterial({useMap:!1,color:new a.Color(2641557),opacity:.8,resolution:new a.Vector2(800,500),sizeAttenuation:!1,lineWidth:10,transparent:!0,depthTest:!1}),this.iRenderOrder=I.MxData.iSelectRenderOrder,this.aryPrvCommandSelect=[],this.mxDatabase=L}o.MxDbEntitySelect=H},{"../MxFun":27,"../MxManager":29,"../Operate/McGiWorldDraw":44,three:19,"three.meshline":18}],72:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbGroupDictionary=o.MxDbGroup=void 0;var a=(x.prototype.name=function(){return this.sName},x.prototype.append=function(I){this.has(I)||this.setId.add(I)},x.prototype.clear=function(){this.setId=new Set},x.prototype.getAll=function(){var I=[];return this.setId.forEach(function(H){I.push(H)}),I},x.prototype.has=function(I){return this.setId.has(I)},x.prototype.delete=function(I){return this.setId.delete(I)},x);function x(I){this.setId=new Set,this.sName="",this.sName=I}o.MxDbGroup=a;var u=(M.prototype.getAt=function(I){return this.mapNameToGroup.get(I)},M.prototype.delete=function(I){return!!this.mapNameToGroup.has(I)&&this.mapNameToGroup.delete(I)},M.prototype.add=function(I){var H=this.mapNameToGroup.get(I);return H||(H=new a(I),this.mapNameToGroup.set(I,H),H)},M.prototype.dwgOut=function(I){var H=[];return this.mapNameToGroup.forEach(function(G,L){H.push(L)}),I.groups=H,I},M.prototype.dwgIn=function(I){var H=this;return I.groups.forEach(function(G){var L=new a(G);H.mapNameToGroup.set(G,L)}),!0},M.prototype.getEntityInGroup=function(I){var H=[];return this.mapNameToGroup.forEach(function(G){G.has(I)&&H.push(G)}),H},M.prototype.getEntityInGroupName=function(I){var H=[];return this.mapNameToGroup.forEach(function(G,L){G.has(I)&&H.push(L)}),H},M);function M(){this.mapNameToGroup=new Map}o.MxDbGroupDictionary=u},{}],73:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbLayerTableRecord=void 0;var a=T("three"),x=(u.prototype.getGroup=function(){return this.group},u.prototype.getGroup_SmallCoord=function(){return this.group_SmallCoord},u.prototype.getName=function(){return this.name},u.prototype.setName=function(M){this.name=M},u.prototype.setVisible=function(M){this.visible=M,this.group.visible=M,this.group_SmallCoord.visible=M},u.prototype.getVisible=function(){return this.visible},u.prototype.init=function(M,I,H){return this.name=M,I.add(this.group),H.add(this.group_SmallCoord),!0},u.prototype.dwgIn=function(M){return this.visible=M.visible,this.name=M.name,this.group.visible=this.visible,this.group_SmallCoord.visible=this.visible,!0},u.prototype.dwgOut=function(M){return M.visible=this.visible,M.name=this.name,M},u);function u(){this.group=new a.Group,this.group_SmallCoord=new a.Group,this.name="",this.visible=!0}o.MxDbLayerTableRecord=x},{three:19}],74:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbTextureManager=void 0;var a=T("three"),x=(u.prototype.loadImage=function(M,I){var H=this.mapImageUrlToMaterialTexture.get(M);if(H)I(H);else{var G=this;new a.TextureLoader().load(M,function(L){var y=new a.MeshLambertMaterial({map:L,transparent:!0,side:a.DoubleSide});y.map&&(y.map.needsUpdate=!0),G.mapImageUrlToMaterialTexture.set(M,y),I&&I(y)},void 0,function(L){console.log(L),I&&I(null)})}},u);function u(){this.mapImageUrlToMaterialTexture=new Map}o.MxDbTextureManager=x},{three:19}],75:[function(T,r,o){var a,x=this&&this.__extends||(a=function(c,p){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,f){m.__proto__=f}||function(m,f){for(var N in f)Object.prototype.hasOwnProperty.call(f,N)&&(m[N]=f[N])})(c,p)},function(c,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");function m(){this.constructor=c}a(c,p),c.prototype=p===null?Object.create(p):(m.prototype=p.prototype,new m)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawObject3dThreeJS=o.MxDrawMapBoxThreeJS=o.MxDrawObject2dThreeJS=o.MxDrawThreeJS=o.MxThreeJSType=void 0;var u,M,I,H=T("three"),G=T("../Operate/MxJigCmdManager"),L=T("three-orbitcontrols"),y=T("../UI/MxUiVue"),D=(x(C,u=L.OrbitControls),C.prototype.update=function(){},C);function C(c,p){return u.call(this,c,p)||this}(I=M||(o.MxThreeJSType=M={}))[I.k2d=0]="k2d",I[I.k3d=1]="k3d",I[I.kMapBox=2]="kMapBox";var B=(z.prototype.screenCoord2World=function(c,p,m){return this.mxObject.screenCoord2World_mxdrawThreeJS_call(c,p,m)},z.prototype.worldCoord2Screen=function(c,p,m){return this.mxObject.worldCoord2Screen_mxdrawThreeJS_call(c,p,m)},z.prototype.getDomMousePos=function(c){},z.prototype.createRaycaster=function(c){var p=new H.Raycaster;p.linePrecision=this.mxObject.screenCoordLong2World(10);var m=this.mxObject.getCanvas(),f=m.clientWidth,N=m.clientHeight,P=new H.Vector2(c.x/f*2-1,-c.y/N*2+1);return p.setFromCamera(P,this.mxObject.getCamera()),p},z.prototype.zoomW=function(c,p,m,f,N){return this.mxObject.zoomW_call(c,p,m,N)},z.prototype.zoomCenter=function(c,p,m){return this.mxObject.zoomCenter_call(c,p)},z.prototype.zoomScale=function(c,p){return this.mxObject.zoomScale_call(c)},z.prototype.setViewAngle=function(c){return this.mxObject.setViewAngle_call(c)},z.prototype.startPanCommand=function(){return this.mxObject.startPanCommand_call()},z.prototype.endPanCommand=function(){return this.mxObject.endPanCommand_call()},z.prototype.isPaningCommand=function(){return this.mxObject.isPaningCommand_call()},z);function z(c){this.mxObject=c}o.MxDrawThreeJS=B;var A,S=(x(q,A=B),q.prototype.onInitThreejs=function(){this.proxyObj.onInitThreejs()},q.prototype.onInitScene=function(){this.proxyObj.onInitScene()},q.prototype.getType=function(){return M.k2d},q.prototype.updateCameraDisplayRange=function(c,p,m){this.proxyObj.updateCameraDisplayRangeImp(c,p,m)},q.prototype.updateCameraForm3dViewData=function(c){this.proxyObj.updateCameraForm3dViewDataImp(c)},q.prototype.addControlsChangeEvent=function(){var c=this.mxObject;this.mxObject.getOrbitControls().addEventListener("change",function(){G.MxJigCmdManager.OnThreeControlsChage(),c.callViewChange(),c.getMxDatabase().onViewChange(),c.getMcObject().isValid()&&c.getMcObject().getGripManager().onControlsChage(),c.getTempMarkDraw().clear(!0),c.updateDisplay()})},q.prototype.updateDisplay=function(c){c===void 0&&(c=!1),this.mxObject.updateDisplayImplement(c)},q.prototype.getRegistEventObject=function(){return this.mxObject.getCanvas()},q);function q(c){var p=A.call(this,c)||this;return p.proxyObj=c,p}o.MxDrawObject2dThreeJS=S;var W,_=(x(R,W=B),R.prototype.startPanCommand=function(){this.mapBox.map&&(this.isPaning=!0,this.bakPan=this.mapBox.map.dragPan.useMouseMiddle(!1),y.MxUiVue.setCursorType(y.MxUiVue.CursorType.kPan))},R.prototype.endPanCommand=function(){this.mapBox.map&&this.isPaning&&(this.isPaning=!1,this.mapBox.map.dragPan.useMouseMiddle(this.bakPan),y.MxUiVue.setCursorType(y.MxUiVue.CursorType.kNormal))},R.prototype.isPaningCommand=function(){return this.mapBox.map,this.isPaning},R.prototype.mercatorCoord2CAD=function(c,p){var m=new H.Vector3(c,p,0);return m.applyMatrix4(this.mapBox.matMapToCad),m},R.prototype.cadToMercatorCoord=function(c){return c.applyMatrix4(this.mapBox.matCadToMap),c},R.prototype.setViewAngle=function(c){this.mapBox.map&&this.mapBox.map.setBearing(180*c/Math.PI)},R.prototype.zoomCenter=function(c,p,m){if(this.mapBox.map){var f=this.cadToMercatorCoord(new H.Vector3(c,p,0)),N=this.mapBox.map.mercator_to_lnglat(f.x,f.y,0),P=this.mapBox.map.getBounds(),O=.5*(P._ne.wrap().lng-P._sw.wrap().lng),Z=.5*(P._ne.wrap().lat-P._sw.wrap().lat);this.mapBox.map.fitBounds([[N.lng-O,N.lat-Z],[N.lng+O,N.lat+Z]],{animate:!!m})}},R.prototype.zoomScale=function(c,p){if(this.mapBox.map){var m=this.mapBox.map.getBounds(),f=.5*(m._ne.wrap().lng-m._sw.wrap().lng),N=.5*(m._ne.wrap().lat-m._sw.wrap().lat),P=m._sw.wrap().lng+f,O=m._sw.wrap().lat+N;f*=c,N*=c,this.mapBox.map.fitBounds([[P-f,O-N],[P+f,O+N]],{animate:!!p})}},R.prototype.zoomW=function(c,p,m,f,N){if(this.mapBox.map)if(c.distanceTo(p)<1e-7)console.log("Mx:ZoomW param invalid");else{m!==void 0&&m&&(c=this.mxObject2d.docCoord2Cad(c.x,c.y,0),p=this.mxObject2d.docCoord2Cad(p.x,p.y,0));var P=this.cadToMercatorCoord(c),O=this.cadToMercatorCoord(p),Z=this.mapBox.map.mercator_to_lnglat(P.x,P.y,0),te=this.mapBox.map.mercator_to_lnglat(O.x,O.y,0),de=Math.min(Z.lng,te.lng),me=Math.max(Z.lng,te.lng),we=Math.min(Z.lat,te.lat),ge=Math.max(Z.lat,te.lat);this.mapBox.map.fitBounds([[de,we],[me,ge]],{animate:!!f})}},R.prototype.onInitScene=function(){},R.prototype.addControlsChangeEvent=function(){},R.prototype.updateDisplay=function(c){this.mapBox.map&&(this.mapBox.map.repaint=!0)},R.prototype.createRaycaster=function(c){if(this.mapBox.map){var p=c.x/this.mapBox.map.transform.width*2-1,m=-c.y/this.mapBox.map.transform.height*2+1,f=this.mxObject2d.getCamera(),N=new H.Raycaster;N.linePrecision=this.mxObject2d.screenCoordLong2World(10);var P=new H.Matrix4().getInverse(f.projectionMatrix),O=new H.Vector3().applyMatrix4(P),Z=new H.Vector3(p,m,1).applyMatrix4(P).clone().sub(O).normalize();return N.setFromCamera(new H.Vector2(p,m),f),N.set(O,Z),N}return W.prototype.createRaycaster.call(this,c)},R.prototype.getRegistEventObject=function(){return this.mapBox.canvasContainer},R.prototype.getType=function(){return M.kMapBox},R.prototype.getDomMousePos=function(c){return this.mapBox.map?this.mapBox.map.dom_mousePos(c):void 0},R.prototype.screenCoord2World=function(c,p,m){if(this.mapBox.map){var f=this.mapBox.map.unproject({x:c,y:p}),N=this.mapBox.map.lnglat_to_mercator(f.lng,f.lat),P=new H.Vector3(N.x,N.y,0);return P.applyMatrix4(this.mapBox.matMapToCADDrawCoord),P}return W.prototype.screenCoord2World.call(this,c,p,m)},R.prototype.worldCoord2Screen=function(c,p,m){if(this.mapBox.map){var f=new H.Vector3(c,p,m);f.applyMatrix4(this.mapBox.matCADDrawCoordToMap);var N=this.mapBox.map.mercator_to_lnglat(f.x,f.y,0),P=this.mapBox.map.project([N.lng,N.lat]);return new H.Vector3(P.x,P.y,0)}W.prototype.worldCoord2Screen.call(this,c,p,m)},R.prototype.onInitThreejs=function(){var c=this,p=this.mapBox.threebox;if(p){var m=p.camera,f=p.scene,N=this.mapBox.canvas,P=p.renderer;this.canvas=N,P.autoClear=!1;var O=new D(m,N);this.mxObject2d.mapBoxInitThreeJSObject(f,m,P,O)}else{this.mxObject2d.onInitViewScene(),f=new H.Scene;var Z=(N=this.mapBox.canvas).clientHeight,te=N.clientWidth;m=new H.OrthographicCamera(te/-2,te/2,Z/2,Z/-2,.1,1e21),this.canvas=N;var de=new H.DirectionalLight(16777215);de.position.set(0,-70,100).normalize(),f.add(de);var me=new H.DirectionalLight(16777215);me.position.set(0,70,100).normalize(),f.add(me);var we=this.mxObject2d.getRendererParam();(we=we||{}).canvas=N,we.context=this.mapBox.gl,(P=new H.WebGLRenderer(we)).autoClear=!1,(O=new D(new H.Camera,N)).enabled=!1,this.mxObject2d.mapBoxInitThreeJSObject(f,m,P,O)}this.mxObject2d.initRendererParam({retver:"webgl2",webgl2:!0});var ge=this;this.mapBox.render=function(Le,Pe){var ae=new H.Matrix4().fromArray(Pe);ae.multiply(c.matCADDrawCoordToMap);var ve=new H.Vector3(0,0,0);if(ve.applyMatrix4(ae),1<ve.z){var Ie=1-ve.z-1e-5;ae=new H.Matrix4().makeTranslation(0,0,Ie).multiply(ae)}ge.mxObject2d.mapBoxRender(Le,ae,!!ge.mapBox.threebox),ge.mxObject2d.isRenderLoop()&&c.mapBox.map&&(c.mapBox.map.repaint=!0)},this.mapBox.onResize=function(){ge.mxObject2d.mapBox_onResizeImp(ge.canvas.clientWidth,ge.canvas.clientHeight)}},R.prototype.updateCameraForm3dViewData=function(c){console.log("assert(0) map does not support 3ddwg")},R.prototype.updateCameraDisplayRange=function(c,p,m){if(this.mxObject2d.isCppMxCAD()){(P=new H.Matrix4).makeTranslation(-this.mapBox.cadOrigin.x,-this.mapBox.cadOrigin.y,-this.mapBox.cadOrigin.z),(O=new H.Matrix4).makeTranslation(this.mapBox.mapOrigin.x,this.mapBox.mapOrigin.y,this.mapBox.elevation),(Z=new H.Matrix4).makeScale(this.mapBox.mapLenInCADUnits,-this.mapBox.mapLenInCADUnits,this.mapBox.mapLenInCADUnits);var f=O.multiply(Z).multiply(P),N=this.mxObject2d.getDoc2CADMatrix();this.matCADDrawCoordToMap=f.clone().multiply(N),this.mapBox.matcadtsmall=new H.Matrix4,this.mapBox.matcadtsmall.getInverse(N),this.mapBox.matCADDrawCoordToMap=this.matCADDrawCoordToMap,this.mapBox.matMapToCADDrawCoord=new H.Matrix4,this.mapBox.matMapToCADDrawCoord.getInverse(this.matCADDrawCoordToMap),this.mapBox.matCadToMap=f,this.mapBox.matMapToCad=new H.Matrix4,this.mapBox.matMapToCad.getInverse(f),1e-5<Math.abs(m)&&this.setViewAngle(m),this.zoomW(c,p,!0,!1)}else{var P,O,Z;(P=new H.Matrix4).makeTranslation(-this.mapBox.cadOrigin.x,-this.mapBox.cadOrigin.y,-this.mapBox.cadOrigin.z),(O=new H.Matrix4).makeTranslation(this.mapBox.mapOrigin.x,this.mapBox.mapOrigin.y,this.mapBox.elevation),(Z=new H.Matrix4).makeScale(this.mapBox.mapLenInCADUnits,-this.mapBox.mapLenInCADUnits,this.mapBox.mapLenInCADUnits);var te=O.multiply(Z).multiply(P),de=this.mxObject2d.getWorldToDoc();this.matCADDrawCoordToMap=te.clone().multiply(de),this.mapBox.matcadtsmall=new H.Matrix4,this.mapBox.matcadtsmall.getInverse(de),this.mapBox.matCADDrawCoordToMap=this.matCADDrawCoordToMap,this.mapBox.matMapToCADDrawCoord=new H.Matrix4,this.mapBox.matMapToCADDrawCoord.getInverse(this.matCADDrawCoordToMap),this.mapBox.matCadToMap=te,this.mapBox.matMapToCad=new H.Matrix4,this.mapBox.matMapToCad.getInverse(te)}},R);function R(c,p){var m=W.call(this,p)||this;return m.matCADDrawCoordToMap=new H.Matrix4,m.isPaning=!1,m.bakPan=!0,m.mapBox=c,m.mxObject2d=p,m.mapBox.matMapToCad=m.mapBox.matCadToMap=m.mapBox.matCADDrawCoordToMap=m.mapBox.matMapToCADDrawCoord=new H.Matrix4,m}o.MxDrawMapBoxThreeJS=_;var v,V=(x(Y,v=B),Y.prototype.onInitThreejs=function(){this.proxyObj.onInitThreejs()},Y.prototype.onInitScene=function(){this.proxyObj.onInitScene()},Y.prototype.getType=function(){return M.k3d},Y.prototype.updateCameraDisplayRange=function(c,p,m){},Y.prototype.updateCameraForm3dViewData=function(c){},Y.prototype.addControlsChangeEvent=function(){var c=this.mxObject;this.mxObject.getOrbitControls().addEventListener("change",function(){G.MxJigCmdManager.OnThreeControlsChage(),c.callViewChange(),c.getMxDatabase().onViewChange(),c.getMcObject().isValid()&&c.getMcObject().getGripManager().onControlsChage(),c.getTempMarkDraw().clear(!0),c.updateDisplay()})},Y.prototype.updateDisplay=function(c){c===void 0&&(c=!1),this.mxObject.updateDisplayImplement(c)},Y.prototype.getRegistEventObject=function(){return this.mxObject.getCanvas()},Y);function Y(c){var p=v.call(this,c)||this;return p.proxyObj=c,p}o.MxDrawObject3dThreeJS=V},{"../Operate/MxJigCmdManager":54,"../UI/MxUiVue":65,three:19,"three-orbitcontrols":17}],76:[function(T,r,o){var a,x=this&&this.__extends||(a=function(A,S){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,W){q.__proto__=W}||function(q,W){for(var _ in W)Object.prototype.hasOwnProperty.call(W,_)&&(q[_]=W[_])})(A,S)},function(A,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function q(){this.constructor=A}a(A,S),A.prototype=S===null?Object.create(S):(q.prototype=S.prototype,new q)});function u(){}Object.defineProperty(o,"__esModule",{value:!0}),o.McDraw2d=o.McDraw3d=o.McDraw3dViewData=o.McDraw3dBase=void 0;var M=T("three"),I=T("../MxDrawData");o.McDraw3dBase=u;var H=(G.prototype.updateCamera=function(A,S,q,W){var _=this.width,R=this.height;_<1e-5&&(_=1e-5),R<1e-5&&(R=1e-5);var v=q/W,V=v*R;_<V?_=V:R=_/v,A.left=.5*-_,A.right=.5*_,A.top=.5*R,A.bottom=.5*-R,A.far=this.frontClip,A.near=this.backClip,A.up=this.up,A.zoom=1;var Y=this.target.clone().add(this.dir);A.position.set(Y.x,Y.y,Y.z),A.lookAt(this.target),A.updateProjectionMatrix(),S.target.x=this.target.x,S.target.y=this.target.y,S.target.z=this.target.z,S.update()},G);function G(){}o.McDraw3dViewData=H;var L,y=(x(D,L=u),D.prototype.is3DMode=function(){return!0},D.prototype.onResize=function(A,S,q,W){var _=A.right-A.left,R=A.top-A.bottom;_<1e-5&&(_=1e-5),R<1e-5&&(R=1e-5);var v=q/W,V=v*R;return _<V?_=V:R=_/v,A.left=.5*-_,A.right=.5*_,A.top=.5*R,A.bottom=.5*-R,A.updateProjectionMatrix(),S.update(),!0},D.prototype.initDisplayRange=function(A){var S=this.mcObject.mxObject;S.intiDoc2Wold(new M.Matrix4),S.initCAD2Doc(JSON.parse(A.DToSMat)),S.initializingObjectMatrix();var q=new H;q.dir=new M.Vector3(A.vecDirectionx,A.vecDirectiony,A.vecDirectionz),q.up=new M.Vector3(A.vecUpx,A.vecUpy,A.vecUpz),q.target=new M.Vector3(A.targetx,A.targety,A.targetz),q.height=A.height,q.width=A.width,q.backClip=A.backClip,q.frontClip=A.frontClip,S.updateCameraForm3dViewData(q)},D);function D(){return L!==null&&L.apply(this,arguments)||this}o.McDraw3d=y;var C,B=(x(z,C=u),z.prototype.is3DMode=function(){return!1},z.prototype.initDisplayRange=function(A){var S=this.mcObject.mxObject;S.intiDoc2Wold(new M.Matrix4),S.initCAD2Doc(JSON.parse(A.DToSMat)),S.initializingObjectMatrix(),S.updateCameraDisplayRange(new M.Vector3(A.pt1x,A.pt1y,0),new M.Vector3(A.pt2x,A.pt2y,0),I.MxDrawData.m_isEnableDrawingViewAngle?A.viewangle:0)},z.prototype.onResize=function(A,S,q,W){return this.mcObject.mxObject.callOnResizeImp(q,W)},z);function z(){return C!==null&&C.apply(this,arguments)||this}o.McDraw2d=B},{"../MxDrawData":22,three:19}],77:[function(T,r,o){var a,x=this&&this.__extends||(a=function(_,R){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,V){v.__proto__=V}||function(v,V){for(var Y in V)Object.prototype.hasOwnProperty.call(V,Y)&&(v[Y]=V[Y])})(_,R)},function(_,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");function v(){this.constructor=_}a(_,R),_.prototype=R===null?Object.create(R):(v.prototype=R.prototype,new v)});Object.defineProperty(o,"__esModule",{value:!0}),o.McDrawGripJig=o.McDrawGrip=o.McDrawSlect=o.McDrawGripData=void 0;var u=T("three"),M=T("../MxFun"),I=T("../Operate/MxJig"),H=T("../Operate/MxJigCmdManager"),G=T("../MxManager"),L=T("../MxDrawData"),y=T("../MxTools"),D=function(){this.threeObject=null};o.McDrawGripData=D;var C=(B.prototype.add=function(_){return!this.setId.has(_)&&(this.setId.add(_),this.mcObj.HighlightEntity(_,!0),!0)},B.prototype.remove=function(_){this.setId.has(_)&&(this.setId.delete(_),this.mcObj.HighlightEntity(_,!1))},B.prototype.removeAll=function(){var _=this;this.setId.forEach(function(R){_.mcObj.HighlightEntity(R,!1)}),this.setId.clear()},B.prototype.getAllSelect=function(){var _=[];return this.setId.forEach(function(R,v){_.push(v)}),_},B.prototype.getSelectCount=function(){return this.setId.size},B.prototype.isEmpty=function(){return this.setId.size==0},B);function B(_){this.mcObj=null,this.setId=new Set,this.mcObj=_}o.McDrawSlect=C;var z=(A.prototype.fireSelectChange=function(){this.isCallingSelectChange||(this.isCallingSelectChange=!0,this.mxObj.callEvent("selectChange",this.getAllSelect()),this.isCallingSelectChange=!1)},A.prototype.getParentGroup=function(){return this.drawGroup||(this.drawGroup=new u.Group,this.drawGroup.renderOrder=G.MxData.iGripRenderOrder,this.mxObj.getTheTempDrawContainer_SmallCoord().add(this.drawGroup)),this.drawGroup},A.prototype.reInit=function(){this.clearAll(),this.drawGroup&&M.MxFun.removeThreejsObject(this.drawGroup,this.mxObj.getTheTempDrawContainer_SmallCoord()),this.drawGroup=null,this.selectPoint1=null,this.selectPoint2=null},A.prototype.removeAllEntity=function(){var _=this.getParentGroup();this.mapGrips.forEach(function(R,v,V){for(var Y=R.length,c=0;c<Y;c++){var p=R[c];M.MxFun.removeThreejsObject(p.threeObject,_)}}),this.mapGrips=new Map},A.prototype.deleteGripData=function(_){var R=this.getParentGroup(),v=this.mapGrips.get(_);if(v)for(var V=v.length,Y=0;Y<V;Y++){var c=v[Y];M.MxFun.removeThreejsObject(c.threeObject,R)}this.mapGrips.delete(_)},A.prototype.addGripData=function(_,R,v,V){var Y=this.mapGrips.get(_);Y==null&&(Y=new Array,this.mapGrips.set(_,Y));var c=new D;return c.iIndex=R,c.point=new u.Vector3(v,V),Y.push(c),c},A.prototype.createGripDisplayObject=function(_){var R=this.getParentGroup();_.geometry=new u.Geometry;var v=this.mxObj.toSmallcoord2(_.point.x,_.point.y,_.point.z),V=this.mxObj.screenCoordLong2World(.5*L.MxDrawData.m_dInputRectWidth);_.geometry.vertices.push(new u.Vector3(v.x-V,v.y-V,0)),_.geometry.vertices.push(new u.Vector3(v.x-V,v.y+V,0)),_.geometry.vertices.push(new u.Vector3(v.x+V,v.y+V,0)),_.geometry.vertices.push(new u.Vector3(v.x+V,v.y-V,0)),_.geometry.faces.push(new u.Face3(0,1,2)),_.geometry.faces.push(new u.Face3(2,3,0)),_.geometry.computeFaceNormals(),_.geometry.computeVertexNormals();var Y=y.MxTools.getColor(L.MxDrawData.m_gripPointColor),c=y.MxTools.getOpacity(L.MxDrawData.m_gripPointColor),p=new u.MeshBasicMaterial({color:Y,transparent:!0,depthTest:!1,side:u.DoubleSide,opacity:c}),m=new u.Mesh(_.geometry,p);R.add(m),_.threeObject=m},A.prototype.setPrvCommandSelect=function(_){this.aryPrvCommandSelect=_},A.prototype.getPrvCommandSelect=function(){return this.aryPrvCommandSelect},A.prototype.getAllSelect=function(){return this.mcSelect.getAllSelect()},A.prototype.getSelectPoints=function(){var _=this.selectPoint1!==null;return _&&this.mcSelect.getSelectCount()==0&&this.aryPrvCommandSelect.length==0&&(_=!1),{point1:this.selectPoint1,point2:this.selectPoint2,isvalid:_}},A.prototype.clearAll=function(){var _=this.mcSelect.isEmpty();return this.mcSelect.removeAll(),this.mapGrips.size==0?!_:(this.removeAllEntity(),!0)},A.prototype.clearGripDisplay=function(){this.removeAllEntity()},A.prototype.onControlsChage=function(){var _=this;if(this.mapGrips.size!=0){var R=this.mxObj.screenCoordLong2World(.5*L.MxDrawData.m_dInputRectWidth),v=!1;this.mapGrips.forEach(function(V,Y,c){for(var p=V.length,m=0;m<p;m++){var f=V[m];if(f.geometry.vertices.length==4){var N=_.mxObj.cadCoord2Doc(f.point.x,f.point.y,f.point.z);f.geometry.vertices[0].x=N.x-R,f.geometry.vertices[0].y=N.y-R,f.geometry.vertices[1].x=N.x-R,f.geometry.vertices[1].y=N.y+R,f.geometry.vertices[2].x=N.x+R,f.geometry.vertices[2].y=N.y+R,f.geometry.vertices[3].x=N.x+R,f.geometry.vertices[3].y=N.y-R,f.geometry.computeFaceNormals(),f.geometry.computeVertexNormals(),f.geometry.verticesNeedUpdate=!0,v=!0}}}),v&&this.mxObj.resetRenderer()}},A.prototype.getGripNum=function(_){for(var R=new Set,v=_.length(),V=0;V<v;V++)R.add(_.at(V));var Y=0;return this.mapGrips.forEach(function(c,p){R.has(p)||(Y+=c.length)}),Y},A.prototype.hitTest=function(_){var R={grips:new Array,ids:new Array,pt:_},v=new u.Vector3(_.x,_.y,0),V=this.mxObj.viewCoordLong2Cad(32);return this.mapGrips.forEach(function(Y,c){for(var p=Y.length,m=0;m<p;m++){var f=Y[m];if(f.point.distanceTo(v)<=V){R.grips.push(f),R.ids.push(c),R.pt=f.point;break}}}),R},A.prototype.onMouseLBDown=function(_){if(L.MxDrawData.m_isEnableCADEntityGripEidt==1){if(!L.MxDrawData.m_isEnableGripEidt)return!1}else if(L.MxDrawData.m_isEnableCADEntityGripEidt==0)return!1;var R=this.hitTest(_);return R.grips.length!=0&&(M.MxFun.sendStringToExecute("McDraw_GripEdit",R),!0)},A.prototype.gripEditImp=function(_){var R=_.grips,v=_.ids,V=_.pt,Y=new q(V,R,v,this.mcObj);H.MxJigCmdManager.runCmd(Y)},A.prototype.addGridDisplay=function(_,R){var v=this;_&&_.length()!=0&&(this.deleteGripData(R),_.forEach(function(V,Y){var c=v.addGripData(R,Y,V.x,V.y);v.createGripDisplayObject(c)}))},A.prototype.upEntityGridDisplay=function(_){if(!L.MxDrawData.m_isEnableGripEidt||_==0)return 0;var R=this.mcObj.ObjectIdToObject(_);if(!R)return 0;var v=R.getGripPoints();return this.addGridDisplay(v,_),v.length()},A.prototype.doPointSelect=function(_,R){if(R===void 0&&(R=!1),!this.mcObj.mcObjectImp)return!1;var v=this.mxObj.docCoordLong2Cad(this.mxObj.screenCoordLong2Doc(10)),V=this.mxObj.screenCoord2Doc(_.x,_.y,0),Y=this.mxObj.docCoord2Cad(V.x,V.y,V.z),c=this.mcObj.mcObjectImp.IntelliSelect_PointSelect(Y.x,Y.y,v),p=c.length();if(p==0)return this.mcObj.mxappimp.DestroyMdGeLongArray(c),!1;if(this.mxObj.pointMultipleSelect()||(this.mxObj.getMxDatabase().clearMxCurrentSelect(),this.clearAll(),R=!1),R)for(var m=0;m<p;m++){var f=c.at(m);this.mcSelect.remove(f),this.deleteGripData(f)}else{var N=p+this.mcSelect.getSelectCount(),P=!1;for(m=0;m<p;m++)f=c.at(m),this.mcSelect.add(f),N<2e3?this.upEntityGridDisplay(f):P=!0;P&&this.clearGripDisplay()}return this.selectPoint1=Y,this.selectPoint2=Y,this.fireSelectChange(),this.mcObj.mxappimp.DestroyMdGeLongArray(c),!0},A.prototype.doRangeSelect=function(_,R,v){if(v===void 0&&(v=!1),this.mcObj.mcObjectImp){var V,Y=_.clone(),c=R.clone();V=R.x<_.x?0:1;var p=this.mcObj.mcObjectImp.IntelliSelect_RangeSelect(Y.x,Y.y,c.x,c.y,V),m=p.length();if(this.mxObj.pointMultipleSelect()||(v=!1),v)for(var f=0;f<m;f++){var N=p.at(f);this.mcSelect.remove(N),this.deleteGripData(N)}else{var P=m+this.mcSelect.getSelectCount(),O=this.getGripNum(p),Z=!1;for(f=0;f<m;f++)N=p.at(f),this.mcSelect.add(N),P<500&&O<2e3?O+=this.upEntityGridDisplay(N):Z=!0;Z&&this.clearGripDisplay()}0<m&&(this.selectPoint1=Y,this.selectPoint2=c,this.fireSelectChange()),this.mcObj.mxappimp.DestroyMdGeLongArray(p)}},A.prototype.addSelect=function(_,R,v){if(v===void 0&&(v=!0),_==0)return!1;var V=this.mcSelect.add(_);return v&&this.upEntityGridDisplay(_),R&&this.fireSelectChange(),V},A);function A(_,R){this.mxObj=null,this.mcObj=null,this.mcSelect=null,this.mapGrips=new Map,this.aryPrvCommandSelect=[],this.drawGroup=null,this.isCallingSelectChange=!1,this.selectPoint1=null,this.selectPoint2=null,this.mxObj=_,this.mcObj=R,this.mcSelect=new C(R)}o.McDrawGrip=z;var S,q=(x(W,S=I.McEdJigCommand),W.prototype.onExitCommand=function(_){this.tempEntity=null,this.tempEntityWordDraw=null,S.prototype.onExitCommand.call(this,_)},W.prototype.sampler=function(){var _=H.MxJigCmdManager.InType.kGetBegan|H.MxJigCmdManager.InType.kGetEnd,R=this.acquirePoint(_);if(R.status==H.MxJigCmdManager.DragStatus.kNormal&&(this.currPt=R.pt,this.tempEntity)){var v=new u.Vector3(R.pt.x,R.pt.y,R.pt.z),V=new u.Vector3(this.pt.x,this.pt.y,this.pt.z);this.tempEntityWordDraw=this.tempEntity.clone(),this.tempEntityWordDraw&&this.tempEntityWordDraw.moveGripPointsAt(this.grips[0].iIndex,v.x-V.x,v.y-V.y,v.z-V.z)}return R.status},W.prototype.getTypeName=function(){return"McDrawGripEdit"},W.prototype.done=function(_){if(_==H.MxJigCmdManager.DragStatus.kNormal){for(var R=new u.Vector3(this.pt.x,this.pt.y,this.pt.z),v=new u.Vector3(this.currPt.x,this.currPt.y,this.currPt.z),V=v.x-R.x,Y=v.y-R.y,c=this.getMxObject().getMcObject().getGripManager(),p=this.grips.length,m=[],f=0;f<p;f++){var N=this.grips[f],P=this.ids[f],O=this.mcObj.ObjectIdToObject(P);O&&O.moveGripPointsAt(N.iIndex,V,Y,0),c.upEntityGridDisplay(P),m.push({type:"mxcad",id:P,index:N.iIndex,curentPoint:this.currPt,point:N.point,offset_x:V,offset_y:Y})}0<m.length&&this._mxObject.callEvent("objectGripEdit",m)}return H.MxJigCmdManager.DoneStatius.kExitCommand},W.prototype.upDisplay=function(){this.mcObj.onReadyJigUpdateDispla(1,this.currPt),this.tempEntityWordDraw.tempRelationObject(),this.mcObj.onJigDrawEntityDisplay(this.tempEntityWordDraw.getImp()),this.tempEntityWordDraw.freeTempRelationObject()},W);function W(_,R,v,V){var Y=S.call(this)||this;return Y.pt=_,Y.grips=R,Y.ids=v,Y.currPt=_,Y.mcObj=V,Y.ids.length&&(Y.tempEntity=V.ObjectIdToObject(Y.ids[0])),Y}o.McDrawGripJig=q},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxTools":38,"../Operate/MxJig":53,"../Operate/MxJigCmdManager":54,three:19}],78:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.McDrawObject=void 0;var a=T("../MxManager"),x=T("three"),u=T("../MxFun"),M=T("./McDrawGrip"),I=T("./McTextureManager"),H=T("./McDraw3D"),G=window;G.McDrawObjectEvent_openFileComplete=function(D,C,B){var z=a.MxManager.getMxObject(C);z&&z.getMcObject().openFileComplete(D,B)},G.McDrawObjectEvent_objectModified=function(D,C){var B=a.MxManager.getMxObject(D);if(B){var z=B.getMcObject(),A=new z.mxcppImp.McDrawResbuf;A.Connect(C,!1);for(var S=A.AtString(0,!1),q=A.GetCount(),W=[],_=1;_+1<q;_+=2){var R=A.AtObjectId(_),v=A.Atlong(_+1)==1,V=z.mxapp.newMcObjectId(R,0);W.push({id:V,erase:v})}B.callEvent("objectModified",{cmd:S,entitys:W})}},G.McDrawObjectEvent_call=function(D,C,B){if(C=="mxpost")try{var z=JSON.parse(B);if(z&&z.url&&z.data){var A=new XMLHttpRequest;A.open("POST",z.url,!0),A.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),A.onreadystatechange=function(){A.readyState===4&&A.status},A.send(z.data)}}catch{}else if(C=="regen_complete"){if(!(S=a.MxManager.getMxObject(D)))return;S.regenAllMxDbEntity()}else{var S;if(!(S=a.MxManager.getMxObject(D)))return;S.callEvent(C,B)}},G.McDrawObjectEvent_synchronizeuUdateDisplayRange=function(D,C){var B=a.MxManager.getMxObject(D);B&&B.getMcObject().updateDisplayRange(C==1)},G.McDrawObjectEvent_osnapComplete=function(D,C){var B=a.MxManager.getMxObject(D);B&&B.getMcObject().callOsnapComplete(C)},G.McDrawObjectEvent_mcutPrintf=function(D){u.MxFun.acutPrintf(D)},G.McDrawObjectEvent_updateDisplay=function(D){var C=a.MxManager.getMxObject(D);C&&C.updateDisplay()},G.McDrawObjectEvent_loadImages=function(D,C,B,z){var A=a.MxManager.getMxObject(D);if(A){A.getMcObject().getTextureManager().clear();var S=0,q=[];z.substring(0,5)=="blob:"&&(z=z.substring(5)),C.forEach(function(W){var _=a.MxManager.getMxCpp().decodeFromGb2312(W),R=_;_.lastIndexOf("/")==-1?(B&&0<B.length&&(R=B+"/"+R),z&&0<z.length&&(R=z+"/"+R)):_=_.substring(_.lastIndexOf("/")+1).toLowerCase(),q.push(R),A.getMcObject().getTextureManager().loadImage(R,_,function(){++S==C.length&&(q.forEach(function(v){A.getMcObject().getTextureManager().createOpenGLTexture(v)}),A.updateDisplay(!1))})})}},G.McDrawObjectEvent_loadImagesBase64=function(D,C){var B=a.MxManager.getMxObject(D);if(B){var z=C.indexOf("data:image/png;base64");if(z!=-1){var A=C.substring(0,z);C=C.substring(z),B.getMcObject().getTextureManager().loadImageBase64(A,C,function(){B.getMcObject().getTextureManager().createOpenGLTexture(A),B.updateDisplay(!1)})}}};var L=(y.prototype.getTextureManager=function(){return this.textureManager},y.prototype.isValid=function(){return this.mcObjectImp!==null},y.prototype.isPaperSpaceDisplay=function(){return!!this.mcObjectImp&&this.mcObjectImp.isPaperSpaceDisplay()},y.prototype.fireStartRunCommand=function(D,C){this.mcObjectImp&&this.mcObjectImp.fireStartRunCommand(D,C)},y.prototype.fireEndRunCommand=function(D,C){this.mcObjectImp&&this.mcObjectImp.fireEndRunCommand(D,C)},y.prototype.undo=function(){this.mcObjectImp&&this.mcObjectImp.undo()},y.prototype.redo=function(){this.mcObjectImp&&this.mcObjectImp.redo()},y.prototype.initCAD2Doc=function(D,C){this.matCad2doc=D,this.matDoc2cad=C},y.prototype.getSysVarLong=function(D){return this.mcObjectImp.GetSysVarLong(D)},y.prototype.getSysVarDouble=function(D){return this.mcObjectImp.GetSysVarDouble(D)},y.prototype.getSysVarPoint=function(D){var C=this.mcObjectImp.GetSysVarPoint(D);return new x.Vector3(C.x,C.y,C.z)},y.prototype.ObjectIdToMdObjectImp=function(D){return this.mcObjectImp?this.mxcpp.App.getImp().ObjectIdToMdObject(D):null},y.prototype.DestroyObject=function(D){if(!this.mcObjectImp)return null;this.mcObject.destroyObject(D)},y.prototype.onJigCommandEnd=function(){this.mcObjectImp&&this.mcObjectImp.EntityTempWordDraw_onJigCommandEnd()},y.prototype.callOsnapComplete=function(D){if(this.m_retCall&&D)try{var C=D;if(typeof D=="string"&&(C=JSON.parse(D)),C.callId!=this.m_lOsnapCallCount)return;this.m_retCall(C)}catch{}},y.prototype.doc2cad1=function(D){return D},y.prototype.doc2cad2=function(D,C){return new x.Vector3(D,C,0)},y.prototype.cad2doc1=function(D){return D},y.prototype.cad2doc2=function(D,C){return new x.Vector3(D,C,0)},y.prototype.onNotifyOsnap=function(D,C){if(this.mcObjectImp){this.m_lOsnapCallCount++,this.m_retCall=C,1e5<this.m_lOsnapCallCount&&(this.m_lOsnapCallCount=1);var B,z=this.doc2cad2(D.ptx,D.pty);D.isValidPrvInputPoint&&(B=this.doc2cad2(D.prvPtx,D.prvPty)),this.mcObjectImp.Osnap_NotifyOsnap(z.x,z.y,D.isValidPrvInputPoint,D.isValidPrvInputPoint?B.x:0,D.isValidPrvInputPoint?B.y:0,D.osmode,D.SearchRnge,this.m_lOsnapCallCount)}},y.prototype.DrawEntity=function(D,C,B){D&&this.mcObjectImp&&(C&&D.SetTrueColor(this.THREEColor2MdCmColor(C)),this.mcObjectImp.DrawEntity(D,B))},y.prototype.onJigDrawEntityDisplay=function(D,C,B){D&&this.mcObjectImp&&(C&&D.SetTrueColor(this.THREEColor2MdCmColor(C)),this.mcObjectImp.EntityTempWordDraw_onJigDrawEntityDisplay(D,B===!0))},y.prototype.THREEColor2MdCmColor=function(D){var C=new x.Color(D),B=new this.mxcppImp.MdCmColor;return B.setRGB(255*C.r,255*C.g,255*C.b),B},y.prototype.onJigDrawEntityDisplay_line=function(D,C,B,z,A,S,q){if(this.mcObjectImp){var W=new this.mxcppImp.MdDbLine,_=new this.mxcppImp.MdGePoint3d;_.x=D,_.y=C,_.z=B,W.setStartPoint(_);var R=new this.mxcppImp.MdGePoint3d;R.x=z,R.y=A,R.z=S,W.setEndPoint(R),W.SetTrueColor(this.THREEColor2MdCmColor(q)),this.mcObjectImp.EntityTempWordDraw_onJigDrawEntityDisplay(W,!1)}},y.prototype.DrawLine=function(D,C,B,z,A,S,q){if(this.mcObjectImp){var W=new this.mxcppImp.MdDbLine,_=new this.mxcppImp.MdGePoint3d;_.x=D,_.y=C,_.z=B,W.setStartPoint(_);var R=new this.mxcppImp.MdGePoint3d;R.x=z,R.y=A,R.z=S,W.setEndPoint(R),W.SetTrueColor(this.THREEColor2MdCmColor(q)),this.mcObjectImp.DrawEntity(W,!1)}},y.prototype.HighlightEntity=function(D,C){if(!this.mcDrawUtility)return!1;this.mcDrawUtility.highlightEntity(D,C)},y.prototype.onReadyJigUpdateDispla=function(D,C){D===void 0&&(D=0),C===void 0&&(C=void 0),this.mcObjectImp&&this.mcObjectImp.EntityTempWordDraw_onReadyJigUpdateDispla(D,C?C.x:0,C?C.y:0)},y.prototype.onJigClearDisplay=function(){this.mcObjectImp&&this.mcObjectImp.EntityTempWordDraw_onJigClearDisplay()},y.prototype.ObjectIdToObject=function(D){return this.mcObject?this.mxcpp.App.objectIdToObject(D):null},y.prototype.initMxObject=function(D){this.mxObject=D},y.prototype.init=function(D,C){C.initMxObject(D),this.mxObject=D,this.mcObject=C,this.mcObjectImp=C.getImp(),this.mxcpp=C.getMxCpp(),this.mxcppImp=this.mxcpp.mxcadassemblyimp,this.mxapp=this.mxcpp.App,this.mxappimp=this.mxapp.getImp(),this.grip=new M.McDrawGrip(D,this),this.mcDrawUtility=new this.mxcppImp.McDrawUtility,this.textureManager=new I.McTextureManager(this,D.getRenderer().getContext());var B=this;this.mxObject.addEvent("dragWillEnd",function(){B.mcObjectImp.fireEventDragWillEnd()})},y.prototype.setSize=function(D,C){if(!this.mcObjectImp)return!1;this.mcObjectImp.fireEventWindowSize(D,C)},y.prototype.getGripManager=function(){return this.grip},y.prototype.updateDisplayRange=function(D){if(D===void 0&&(D=!1),this.mcObjectImp){var C=this.mcObjectImp.getViewDataJsonParam(D);C=C.replace(/\\/g,"\\\\");try{var B=JSON.parse(C),z=this.mxObject;if(B!=null){B.is3d?this.mxdraw3d.is3DMode()||(this.mxdraw3d=new H.McDraw3d,this.mxdraw3d.mcObject=this):this.mxdraw3d.is3DMode()&&(this.mxdraw3d=new H.McDraw2d,this.mxdraw3d.mcObject=this),this.mxdraw3d.initDisplayRange(B),z.initAllLayoutName(JSON.parse(B.layout)),z.updateDisplay(!0);var A=u.MxFun.getUiObj();A!=null&&(A.SetLayoutData(B.layout),A.UpDisplayLayout())}}catch{console.log("getViewDataJsonParam exception")}}},y.prototype.openFileComplete=function(D,C){this.updateDisplayRange(),this.mxObject.callOpenFileComplete(D,C)},y.prototype.updateDisplayMapBox=function(D){return!!this.mcObjectImp&&(this.mxObject.getScene().background!==null&&console.log("mxerror: background must be empty"),this.mcObjectImp_updateDisplay(new x.Matrix4().elements,D.elements))},y.prototype.mcObjectImp_updateDisplay=function(D,C){if(this.m_isCallingUpDisplay)return!0;var B=!(this.m_isCallingUpDisplay=!0);try{B=this.mcObjectImp.updateDisplay(D,C),this.m_isCallingUpDisplay=!1}catch(z){this.m_isCallingUpDisplay=!1,console.log(z)}return B},y.prototype.updateDisplay=function(){if(!this.mcObjectImp)return!1;var D=this.mxObject.getCamera();this.mxObject.getScene().background!==null&&console.log("mxerror: background must be empty");var C=new x.Matrix4;C.multiplyMatrices(D.matrixWorldInverse,this.mxObject.getDoc2World());var B=D.projectionMatrix;return this.mcObjectImp_updateDisplay(C.elements,B.elements)},y.prototype.updateDisplayMatrixData=function(D){if(this.mcObjectImp){var C=this.mxObject.getCamera(),B=new x.Matrix4;B.multiplyMatrices(C.matrixWorldInverse,this.mxObject.getDoc2World());var z=C.projectionMatrix;return this.mcObjectImp.updateDisplayMatrixData(B.elements,z.elements,!!D)}},y.prototype.setViewAngle=function(D){this.mcObjectImp&&this.mcObjectImp.fireViewAngleChange(D)},y.prototype.createTexture=function(){return this.mcObjectImp.createTexture()},y.prototype.deleteTexture=function(D){return this.mcObjectImp.deleteTexture(D)},y.prototype.bindTexture=function(D,C){return this.mcObjectImp.bindTexture(D,C)},y.prototype.allocTextureHandle=function(D){return this.mcObjectImp.allocTextureHandle(D)},y.prototype.registTexture=function(D,C){return this.mcObjectImp.registTexture(D,C)},y.prototype.makeCurrent=function(){this.mcObjectImp&&this.mcObjectImp.makeCurrent()},y);function y(){this.grip=null,this.mcObjectImp=null,this.mxcppImp=null,this.mxcpp=null,this.mcObject=null,this.mxapp=null,this.mxappimp=null,this.mcDrawUtility=null,this.m_lOsnapCallCount=1,this.m_retCall=null,this.matCad2doc=new x.Matrix4,this.matDoc2cad=new x.Matrix4,this.m_isCallingUpDisplay=!1,this.mxdraw3d=new H.McDraw2d,this.mxdraw3d.mcObject=this}o.McDrawObject=L},{"../MxFun":27,"../MxManager":29,"./McDraw3D":76,"./McDrawGrip":77,"./McTextureManager":79,three:19}],79:[function(T,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.McTextureManager=void 0;var a=T("three"),x=T("../MxManager"),u=(M.prototype.get=function(G){if(this.extensions[G]!==void 0)return this.extensions[G];var L;switch(G){case"WEBGL_depth_texture":L=this.gl.getExtension("WEBGL_depth_texture")||this.gl.getExtension("MOZ_WEBGL_depth_texture")||this.gl.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":L=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":L=this.gl.getExtension("WEBGL_compressed_texture_s3tc")||this.gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||this.gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":L=this.gl.getExtension("WEBGL_compressed_texture_pvrtc")||this.gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:L=this.gl.getExtension(G)}return L===null&&console.warn("THREE.WebGLRenderer: "+G+" extension not supported."),this.extensions[G]=L},M);function M(G){this.extensions={},this.gl=G}var I=(H.prototype.allocHandle=function(G){return this.mcObject.allocTextureHandle(x.MxManager.getMxCpp().encodeToGb2312(G))},H.prototype.convert=function(G){var L;if(G===a.UnsignedByteType)return 5121;if(G===a.UnsignedShort4444Type)return 32819;if(G===a.UnsignedShort5551Type)return 32820;if(G===a.UnsignedShort565Type)return 33635;if(G===a.ByteType)return 5120;if(G===a.ShortType)return 5122;if(G===a.UnsignedShortType)return 5123;if(G===a.IntType)return 5124;if(G===a.UnsignedIntType)return 5125;if(G===a.FloatType)return 5126;if(G===a.HalfFloatType)return this.isWebGL2?5131:(L=this.extensions.get("OES_texture_half_float"))!==null?L.HALF_FLOAT_OES:null;if(G===a.AlphaFormat)return 6406;if(G===a.RGBFormat)return 6407;if(G===a.RGBAFormat)return 6408;if(G===a.LuminanceFormat)return 6409;if(G===a.LuminanceAlphaFormat)return 6410;if(G===a.DepthFormat)return 6402;if(G===a.DepthStencilFormat)return 34041;if(G===a.RedFormat)return 6403;if(G===a.RedIntegerFormat)return 36244;if(G===a.RGFormat)return 33319;if(G===a.RGIntegerFormat)return 33320;if(G===a.RGBIntegerFormat)return 36248;if(G===a.RGBAIntegerFormat)return 36249;if(G===a.RGB_S3TC_DXT1_Format||G===a.RGBA_S3TC_DXT1_Format||G===a.RGBA_S3TC_DXT3_Format||G===a.RGBA_S3TC_DXT5_Format){if((L=this.extensions.get("WEBGL_compressed_texture_s3tc"))===null)return null;if(G===a.RGB_S3TC_DXT1_Format)return L.COMPRESSED_RGB_S3TC_DXT1_EXT;if(G===a.RGBA_S3TC_DXT1_Format)return L.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(G===a.RGBA_S3TC_DXT3_Format)return L.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(G===a.RGBA_S3TC_DXT5_Format)return L.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(G===a.RGB_PVRTC_4BPPV1_Format||G===a.RGB_PVRTC_2BPPV1_Format||G===a.RGBA_PVRTC_4BPPV1_Format||G===a.RGBA_PVRTC_2BPPV1_Format){if((L=this.extensions.get("WEBGL_compressed_texture_pvrtc"))===null)return null;if(G===a.RGB_PVRTC_4BPPV1_Format)return L.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(G===a.RGB_PVRTC_2BPPV1_Format)return L.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(G===a.RGBA_PVRTC_4BPPV1_Format)return L.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(G===a.RGBA_PVRTC_2BPPV1_Format)return L.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return G===a.RGB_ETC1_Format?(L=this.extensions.get("WEBGL_compressed_texture_etc1"))!==null?L.COMPRESSED_RGB_ETC1_WEBGL:null:G===a.RGBA_ASTC_4x4_Format||G===a.RGBA_ASTC_5x4_Format||G===a.RGBA_ASTC_5x5_Format||G===a.RGBA_ASTC_6x5_Format||G===a.RGBA_ASTC_6x6_Format||G===a.RGBA_ASTC_8x5_Format||G===a.RGBA_ASTC_8x6_Format||G===a.RGBA_ASTC_8x8_Format||G===a.RGBA_ASTC_10x5_Format||G===a.RGBA_ASTC_10x6_Format||G===a.RGBA_ASTC_10x8_Format||G===a.RGBA_ASTC_10x10_Format||G===a.RGBA_ASTC_12x10_Format||G===a.RGBA_ASTC_12x12_Format?(L=this.extensions.get("WEBGL_compressed_texture_astc"))!==null?G:null:G===a.UnsignedInt248Type?this.isWebGL2?34042:(L=this.extensions.get("WEBGL_depth_texture"))!==null?L.UNSIGNED_INT_24_8_WEBGL:null:void 0},H.prototype.textureNeedsPowerOfTwo=function(G){return G.wrapS!==1001||G.wrapT!==1001||G.minFilter!==1003&&G.minFilter!==1006},H.prototype.createCanvas=function(G,L){return document.createElementNS("http://www.w3.org/1999/xhtml","canvas")},H.prototype.floorPowerOfTwo=function(G){return Math.pow(2,Math.floor(Math.log(G)/Math.LN2))},H.prototype.resizeImage=function(G,L,y,D){var C=1;if((G.width>D||G.height>D)&&(C=D/Math.max(G.width,G.height)),C<1||L===!0){if(typeof HTMLImageElement<"u"&&G instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&G instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&G instanceof ImageBitmap){var B=L?this.floorPowerOfTwo:Math.floor,z=B(C*G.width),A=B(C*G.height);this._canvas===void 0&&(this._canvas=this.createCanvas(z,A));var S=y?this.createCanvas(z,A):this._canvas;return S.width=z,S.height=A,S.getContext("2d").drawImage(G,0,0,z,A),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+G.width+"x"+G.height+") to ("+z+"x"+A+")."),S}return"data"in G&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+G.width+"x"+G.height+")."),G}return G},H.prototype.mathIsPowerOfTwo=function(G){return!(G&G-1)&&G!==0},H.prototype.isPowerOfTwo=function(G){return this.mathIsPowerOfTwo(G.width)&&this.mathIsPowerOfTwo(G.height)},H.prototype.getInternalFormat=function(G,L,y){if(this.isWebGL2===!1)return L;if(G!==null){if(this._gl[G]!==void 0)return this._gl[G];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+G+"'")}var D=L;return L===6403&&(y===5126&&(D=33326),y===5131&&(D=33325),y===5121&&(D=33321)),L===6407&&(y===5126&&(D=34837),y===5131&&(D=34843),y===5121&&(D=32849)),L===6408&&(y===5126&&(D=34836),y===5131&&(D=34842),y===5121&&(D=32856)),D===33325||D===33326||D===34842||D===34836?this.extensions.get("EXT_color_buffer_float"):D!==34843&&D!==34837||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),D},H.prototype.filterFallback=function(G){return G===a.NearestFilter||G===a.NearestMipmapNearestFilter||G===a.NearestMipmapLinearFilter?9728:9729},H.prototype.setTextureParameters=function(G,L,y){var D={};D[a.RepeatWrapping]=10497,D[a.ClampToEdgeWrapping]=33071,D[a.MirroredRepeatWrapping]=33648;var C={};C[a.NearestFilter]=9728,C[a.NearestMipmapNearestFilter]=9984,C[a.NearestMipmapLinearFilter]=9986,C[a.LinearFilter]=9729,C[a.LinearMipmapNearestFilter]=9985,C[a.LinearMipmapLinearFilter]=9987,y?(this._gl.texParameteri(G,10242,D[L.wrapS]),this._gl.texParameteri(G,10243,D[L.wrapT]),G!==32879&&G!==35866||this._gl.texParameteri(G,32882,D[L.wrapR]),this._gl.texParameteri(G,10240,C[L.magFilter]),this._gl.texParameteri(G,10241,C[L.minFilter])):(this._gl.texParameteri(G,10242,33071),this._gl.texParameteri(G,10243,33071),G!==32879&&G!==35866||this._gl.texParameteri(G,32882,33071),L.wrapS===a.ClampToEdgeWrapping&&L.wrapT===a.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),this._gl.texParameteri(G,10240,this.filterFallback(L.magFilter)),this._gl.texParameteri(G,10241,this.filterFallback(L.minFilter)),L.minFilter!==a.NearestFilter&&L.minFilter!==a.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."))},H.prototype.textureNeedsGenerateMipmaps=function(G,L){return G.generateMipmaps&&L&&G.minFilter!==a.NearestFilter&&G.minFilter!==a.LinearFilter},H.prototype.generateMipmap=function(G,L,y,D,C){this._gl.generateMipmap(L)},H.prototype.clear=function(){var G=this;Object.keys(this.mapImagePathToTexture).forEach(function(L){var y=G.mapImagePathToTexture[L];y&&y.webglTexture&&G.mcObject.deleteTexture(y.webglTexture)}),this.mapImagePathToTexture={}},H.prototype.loadImage=function(G,L,y){if(this.mapImagePathToTexture[G]){var D=this.mapImagePathToTexture[G];return D&&D.isload&&D.texture?y(!0,D.texture.image):y(!1,void 0),0}var C={isload:!1,texture:null,handle:this.allocHandle(L),webglTexture:void 0};this.mapImagePathToTexture[G]=C;var B=x.MxManager.getLoadImageFuction();return B&&B(G,function(z){C.isload=!0,C.texture=z,y(!0,z.image)},function(z){C.isload=!1,y(!1,void 0)})!=0||new a.TextureLoader().load(G,function(z){C.isload=!0,C.texture=z,y(!0,z.image)},void 0,function(z){C.isload=!1,y(!1,void 0)}),C.handle},H.prototype.loadImageBase64=function(G,L,y){if(this.mapImagePathToTexture[G]){var D=this.mapImagePathToTexture[G];return D&&D.isload&&D.texture?y(!0,D.texture.image):y(!1,void 0),0}var C={isload:!1,texture:null,handle:this.allocHandle(G),webglTexture:void 0};return this.mapImagePathToTexture[G]=C,new a.TextureLoader().load(L,function(B){C.isload=!0,C.texture=B,y(!0,B.image)},void 0,function(B){C.isload=!1,y(!1,void 0)}),C.handle},H.prototype.createOpenGLTexture=function(G){var L=this.mapImagePathToTexture[G];if(!L||!L.isload||L.webglTexture)return!1;var y=L.texture;L.webglTexture=this.mcObject.createTexture(),this._gl.activeTexture(33984),this.mcObject.bindTexture(3553,L.webglTexture),this._gl.pixelStorei(37440,y.flipY),this._gl.pixelStorei(37441,y.premultiplyAlpha),this._gl.pixelStorei(3317,y.unpackAlignment);var D=this._gl.getParameter(3379),C=this.textureNeedsPowerOfTwo(y)&&this.isPowerOfTwo(y.image)===!1,B=this.resizeImage(y.image,C,!1,D),z=this.isPowerOfTwo(B)||this.isWebGL2,A=this.convert(y.format),S=this.convert(y.type),q=this.getInternalFormat(y.internalFormat,A,S);this.setTextureParameters(3553,y,z);var W,_=y.mipmaps;if(y.isDataTexture){var R=!0;if(this._gl.texStorage2D||(R=!1),0<_.length&&z){for(var v=0,V=_.length;v<V;v++)W=_[v],this._gl.texImage2D(3553,v,q,W.width,W.height,0,A,S,W.data);y.generateMipmaps=!1}else R?(this._gl.texStorage2D(3553,1,q,B.width,B.height),this._gl.texSubImage2D(3553,0,0,0,B.width,B.height,A,S,B.data)):this._gl.texImage2D(3553,0,q,B.width,B.height,0,A,S,B.data)}else if(0<_.length&&z){for(v=0,V=_.length;v<V;v++)W=_[v],this._gl.texImage2D(3553,v,q,A,S,W);y.generateMipmaps=!1}else this._gl.texImage2D(3553,0,q,A,S,B);this.textureNeedsGenerateMipmaps(y,z)&&this.generateMipmap(L,3553,y,B.width,B.height),this.mcObject.registTexture(L.handle,L.webglTexture)},H);function H(G,L){this.mapImagePathToTexture={},this.mcObject=G,this._gl=L,this.extensions=new u(L),this.isWebGL2=typeof WebGL2RenderingContext<"u"&&L instanceof WebGL2RenderingContext}o.McTextureManager=I},{"../MxManager":29,three:19}]},{},[58])}function registerMxDbEntity(){store.events.emit("MxDbEntityRegister")}let registerList=[];function addRegisterMxDbEntity(T){T.isRegister=!1;const r=()=>{!T.isRegister&&T.register&&T.register(),store.events.off("stateChange",r)};registerList.push(r)}const callRegisterMxDbEntityLists=()=>{registerList.forEach(T=>{T&&T()}),registerList=[]};store.events.on("MxDbEntityRegister",callRegisterMxDbEntityLists);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function unwrapExports(T){return T&&T.__esModule&&Object.prototype.hasOwnProperty.call(T,"default")?T.default:T}function createCommonjsModule(T,r){return T(r={exports:{}},r.exports),r.exports}var jquery=createCommonjsModule(function(T){var r,o;r=typeof window<"u"?window:commonjsGlobal,o=function(a,x){var u=[],M=Object.getPrototypeOf,I=u.slice,H=u.flat?function(w){return u.flat.call(w)}:function(w){return u.concat.apply([],w)},G=u.push,L=u.indexOf,y={},D=y.toString,C=y.hasOwnProperty,B=C.toString,z=B.call(Object),A={},S=function(w){return typeof w=="function"&&typeof w.nodeType!="number"&&typeof w.item!="function"},q=function(w){return w!=null&&w===w.window},W=a.document,_={type:!0,src:!0,nonce:!0,noModule:!0};function R(w,E,X){var re,ce,fe=(X=X||W).createElement("script");if(fe.text=w,E)for(re in _)(ce=E[re]||E.getAttribute&&E.getAttribute(re))&&fe.setAttribute(re,ce);X.head.appendChild(fe).parentNode.removeChild(fe)}function v(w){return w==null?w+"":typeof w=="object"||typeof w=="function"?y[D.call(w)]||"object":typeof w}var V="3.7.1",Y=/HTML$/i,c=function(w,E){return new c.fn.init(w,E)};function p(w){var E=!!w&&"length"in w&&w.length,X=v(w);return!S(w)&&!q(w)&&(X==="array"||E===0||typeof E=="number"&&E>0&&E-1 in w)}function m(w,E){return w.nodeName&&w.nodeName.toLowerCase()===E.toLowerCase()}c.fn=c.prototype={jquery:V,constructor:c,length:0,toArray:function(){return I.call(this)},get:function(w){return w==null?I.call(this):w<0?this[w+this.length]:this[w]},pushStack:function(w){var E=c.merge(this.constructor(),w);return E.prevObject=this,E},each:function(w){return c.each(this,w)},map:function(w){return this.pushStack(c.map(this,function(E,X){return w.call(E,X,E)}))},slice:function(){return this.pushStack(I.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(c.grep(this,function(w,E){return(E+1)%2}))},odd:function(){return this.pushStack(c.grep(this,function(w,E){return E%2}))},eq:function(w){var E=this.length,X=+w+(w<0?E:0);return this.pushStack(X>=0&&X<E?[this[X]]:[])},end:function(){return this.prevObject||this.constructor()},push:G,sort:u.sort,splice:u.splice},c.extend=c.fn.extend=function(){var w,E,X,re,ce,fe,be=arguments[0]||{},xe=1,Me=arguments.length,Ne=!1;for(typeof be=="boolean"&&(Ne=be,be=arguments[xe]||{},xe++),typeof be=="object"||S(be)||(be={}),xe===Me&&(be=this,xe--);xe<Me;xe++)if((w=arguments[xe])!=null)for(E in w)re=w[E],E!=="__proto__"&&be!==re&&(Ne&&re&&(c.isPlainObject(re)||(ce=Array.isArray(re)))?(X=be[E],fe=ce&&!Array.isArray(X)?[]:ce||c.isPlainObject(X)?X:{},ce=!1,be[E]=c.extend(Ne,fe,re)):re!==void 0&&(be[E]=re));return be},c.extend({expando:"jQuery"+(V+Math.random()).replace(/\D/g,""),isReady:!0,error:function(w){throw new Error(w)},noop:function(){},isPlainObject:function(w){var E,X;return!(!w||D.call(w)!=="[object Object]"||(E=M(w))&&(typeof(X=C.call(E,"constructor")&&E.constructor)!="function"||B.call(X)!==z))},isEmptyObject:function(w){var E;for(E in w)return!1;return!0},globalEval:function(w,E,X){R(w,{nonce:E&&E.nonce},X)},each:function(w,E){var X,re=0;if(p(w))for(X=w.length;re<X&&E.call(w[re],re,w[re])!==!1;re++);else for(re in w)if(E.call(w[re],re,w[re])===!1)break;return w},text:function(w){var E,X="",re=0,ce=w.nodeType;if(!ce)for(;E=w[re++];)X+=c.text(E);return ce===1||ce===11?w.textContent:ce===9?w.documentElement.textContent:ce===3||ce===4?w.nodeValue:X},makeArray:function(w,E){var X=E||[];return w!=null&&(p(Object(w))?c.merge(X,typeof w=="string"?[w]:w):G.call(X,w)),X},inArray:function(w,E,X){return E==null?-1:L.call(E,w,X)},isXMLDoc:function(w){var E=w&&w.namespaceURI,X=w&&(w.ownerDocument||w).documentElement;return!Y.test(E||X&&X.nodeName||"HTML")},merge:function(w,E){for(var X=+E.length,re=0,ce=w.length;re<X;re++)w[ce++]=E[re];return w.length=ce,w},grep:function(w,E,X){for(var re=[],ce=0,fe=w.length,be=!X;ce<fe;ce++)!E(w[ce],ce)!==be&&re.push(w[ce]);return re},map:function(w,E,X){var re,ce,fe=0,be=[];if(p(w))for(re=w.length;fe<re;fe++)(ce=E(w[fe],fe,X))!=null&&be.push(ce);else for(fe in w)(ce=E(w[fe],fe,X))!=null&&be.push(ce);return H(be)},guid:1,support:A}),typeof Symbol=="function"&&(c.fn[Symbol.iterator]=u[Symbol.iterator]),c.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(w,E){y["[object "+E+"]"]=E.toLowerCase()});var f=u.pop,N=u.sort,P=u.splice,O="[\\x20\\t\\r\\n\\f]",Z=new RegExp("^"+O+"+|((?:^|[^\\\\])(?:\\\\.)*)"+O+"+$","g");c.contains=function(w,E){var X=E&&E.parentNode;return w===X||!(!X||X.nodeType!==1||!(w.contains?w.contains(X):w.compareDocumentPosition&&16&w.compareDocumentPosition(X)))};var te=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function de(w,E){return E?w==="\0"?"�":w.slice(0,-1)+"\\"+w.charCodeAt(w.length-1).toString(16)+" ":"\\"+w}c.escapeSelector=function(w){return(w+"").replace(te,de)};var me=W,we=G;(function(){var w,E,X,re,ce,fe,be,xe,Me,Ne,Qe=we,ht=c.expando,lt=0,Ot=0,Pn=ei(),_n=ei(),Xn=ei(),ni=ei(),Nr=function(ke,ot){return ke===ot&&(ce=!0),0},oa="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",Vr="(?:\\\\[\\da-fA-F]{1,6}"+O+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",vr="\\["+O+"*("+Vr+")(?:"+O+"*([*^$|!~]?=)"+O+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+Vr+"))|)"+O+"*\\]",Ea=":("+Vr+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+vr+")*)|.*)\\)|)",Ar=new RegExp(O+"+","g"),Fn=new RegExp("^"+O+"*,"+O+"*"),Jo=new RegExp("^"+O+"*([>+~]|"+O+")"+O+"*"),qo=new RegExp(O+"|>"),kn=new RegExp(Ea),Xo=new RegExp("^"+Vr+"$"),Aa={ID:new RegExp("^#("+Vr+")"),CLASS:new RegExp("^\\.("+Vr+")"),TAG:new RegExp("^("+Vr+"|[*])"),ATTR:new RegExp("^"+vr),PSEUDO:new RegExp("^"+Ea),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+O+"*(even|odd|(([+-]|)(\\d*)n|)"+O+"*(?:([+-]|)"+O+"*(\\d+)|))"+O+"*\\)|)","i"),bool:new RegExp("^(?:"+oa+")$","i"),needsContext:new RegExp("^"+O+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+O+"*((?:-\\d)?\\d*)"+O+"*\\)|)(?=[^-]|$)","i")},Pa=/^(?:input|select|textarea|button)$/i,hi=/^h\d$/i,Ri=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Fr=/[+~]/,Ur=new RegExp("\\\\[\\da-fA-F]{1,6}"+O+"?|\\\\([^\\r\\n\\f])","g"),Dr=function(ke,ot){var vt="0x"+ke.slice(1)-65536;return ot||(vt<0?String.fromCharCode(vt+65536):String.fromCharCode(vt>>10|55296,1023&vt|56320))},Oa=function(){Li()},Ei=oo(function(ke){return ke.disabled===!0&&m(ke,"fieldset")},{dir:"parentNode",next:"legend"});try{Qe.apply(u=I.call(me.childNodes),me.childNodes),u[me.childNodes.length].nodeType}catch{Qe={apply:function(ot,vt){we.apply(ot,I.call(vt))},call:function(ot){we.apply(ot,I.call(arguments,1))}}}function jn(ke,ot,vt,Dt){var kt,on,rn,pn,un,Br,_r,fr=ot&&ot.ownerDocument,jr=ot?ot.nodeType:9;if(vt=vt||[],typeof ke!="string"||!ke||jr!==1&&jr!==9&&jr!==11)return vt;if(!Dt&&(Li(ot),ot=ot||fe,xe)){if(jr!==11&&(un=Ri.exec(ke)))if(kt=un[1]){if(jr===9){if(!(rn=ot.getElementById(kt)))return vt;if(rn.id===kt)return Qe.call(vt,rn),vt}else if(fr&&(rn=fr.getElementById(kt))&&jn.contains(ot,rn)&&rn.id===kt)return Qe.call(vt,rn),vt}else{if(un[2])return Qe.apply(vt,ot.getElementsByTagName(ke)),vt;if((kt=un[3])&&ot.getElementsByClassName)return Qe.apply(vt,ot.getElementsByClassName(kt)),vt}if(!(ni[ke+" "]||Me&&Me.test(ke))){if(_r=ke,fr=ot,jr===1&&(qo.test(ke)||Jo.test(ke))){for((fr=Fr.test(ke)&&dr(ot.parentNode)||ot)==ot&&A.scope||((pn=ot.getAttribute("id"))?pn=c.escapeSelector(pn):ot.setAttribute("id",pn=ht)),on=(Br=js(ke)).length;on--;)Br[on]=(pn?"#"+pn:":scope")+" "+Ns(Br[on]);_r=Br.join(",")}try{return Qe.apply(vt,fr.querySelectorAll(_r)),vt}catch{ni(ke,!0)}finally{pn===ht&&ot.removeAttribute("id")}}}return ml(ke.replace(Z,"$1"),ot,vt,Dt)}function ei(){var ke=[];return function ot(vt,Dt){return ke.push(vt+" ")>E.cacheLength&&delete ot[ke.shift()],ot[vt+" "]=Dt}}function Zr(ke){return ke[ht]=!0,ke}function Pr(ke){var ot=fe.createElement("fieldset");try{return!!ke(ot)}catch{return!1}finally{ot.parentNode&&ot.parentNode.removeChild(ot),ot=null}}function en(ke){return function(ot){return m(ot,"input")&&ot.type===ke}}function Yo(ke){return function(ot){return(m(ot,"input")||m(ot,"button"))&&ot.type===ke}}function Zo(ke){return function(ot){return"form"in ot?ot.parentNode&&ot.disabled===!1?"label"in ot?"label"in ot.parentNode?ot.parentNode.disabled===ke:ot.disabled===ke:ot.isDisabled===ke||ot.isDisabled!==!ke&&Ei(ot)===ke:ot.disabled===ke:"label"in ot&&ot.disabled===ke}}function Va(ke){return Zr(function(ot){return ot=+ot,Zr(function(vt,Dt){for(var kt,on=ke([],vt.length,ot),rn=on.length;rn--;)vt[kt=on[rn]]&&(vt[kt]=!(Dt[kt]=vt[kt]))})})}function dr(ke){return ke&&ke.getElementsByTagName!==void 0&&ke}function Li(ke){var ot,vt=ke?ke.ownerDocument||ke:me;return vt!=fe&&vt.nodeType===9&&vt.documentElement&&(be=(fe=vt).documentElement,xe=!c.isXMLDoc(fe),Ne=be.matches||be.webkitMatchesSelector||be.msMatchesSelector,be.msMatchesSelector&&me!=fe&&(ot=fe.defaultView)&&ot.top!==ot&&ot.addEventListener("unload",Oa),A.getById=Pr(function(Dt){return be.appendChild(Dt).id=c.expando,!fe.getElementsByName||!fe.getElementsByName(c.expando).length}),A.disconnectedMatch=Pr(function(Dt){return Ne.call(Dt,"*")}),A.scope=Pr(function(){return fe.querySelectorAll(":scope")}),A.cssHas=Pr(function(){try{return fe.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),A.getById?(E.filter.ID=function(Dt){var kt=Dt.replace(Ur,Dr);return function(on){return on.getAttribute("id")===kt}},E.find.ID=function(Dt,kt){if(kt.getElementById!==void 0&&xe){var on=kt.getElementById(Dt);return on?[on]:[]}}):(E.filter.ID=function(Dt){var kt=Dt.replace(Ur,Dr);return function(on){var rn=on.getAttributeNode!==void 0&&on.getAttributeNode("id");return rn&&rn.value===kt}},E.find.ID=function(Dt,kt){if(kt.getElementById!==void 0&&xe){var on,rn,pn,un=kt.getElementById(Dt);if(un){if((on=un.getAttributeNode("id"))&&on.value===Dt)return[un];for(pn=kt.getElementsByName(Dt),rn=0;un=pn[rn++];)if((on=un.getAttributeNode("id"))&&on.value===Dt)return[un]}return[]}}),E.find.TAG=function(Dt,kt){return kt.getElementsByTagName!==void 0?kt.getElementsByTagName(Dt):kt.querySelectorAll(Dt)},E.find.CLASS=function(Dt,kt){if(kt.getElementsByClassName!==void 0&&xe)return kt.getElementsByClassName(Dt)},Me=[],Pr(function(Dt){var kt;be.appendChild(Dt).innerHTML="<a id='"+ht+"' href='' disabled='disabled'></a><select id='"+ht+"-\r\\' disabled='disabled'><option selected=''></option></select>",Dt.querySelectorAll("[selected]").length||Me.push("\\["+O+"*(?:value|"+oa+")"),Dt.querySelectorAll("[id~="+ht+"-]").length||Me.push("~="),Dt.querySelectorAll("a#"+ht+"+*").length||Me.push(".#.+[+~]"),Dt.querySelectorAll(":checked").length||Me.push(":checked"),(kt=fe.createElement("input")).setAttribute("type","hidden"),Dt.appendChild(kt).setAttribute("name","D"),be.appendChild(Dt).disabled=!0,Dt.querySelectorAll(":disabled").length!==2&&Me.push(":enabled",":disabled"),(kt=fe.createElement("input")).setAttribute("name",""),Dt.appendChild(kt),Dt.querySelectorAll("[name='']").length||Me.push("\\["+O+"*name"+O+"*="+O+`*(?:''|"")`)}),A.cssHas||Me.push(":has"),Me=Me.length&&new RegExp(Me.join("|")),Nr=function(Dt,kt){if(Dt===kt)return ce=!0,0;var on=!Dt.compareDocumentPosition-!kt.compareDocumentPosition;return on||(1&(on=(Dt.ownerDocument||Dt)==(kt.ownerDocument||kt)?Dt.compareDocumentPosition(kt):1)||!A.sortDetached&&kt.compareDocumentPosition(Dt)===on?Dt===fe||Dt.ownerDocument==me&&jn.contains(me,Dt)?-1:kt===fe||kt.ownerDocument==me&&jn.contains(me,kt)?1:re?L.call(re,Dt)-L.call(re,kt):0:4&on?-1:1)}),fe}for(w in jn.matches=function(ke,ot){return jn(ke,null,null,ot)},jn.matchesSelector=function(ke,ot){if(Li(ke),xe&&!ni[ot+" "]&&(!Me||!Me.test(ot)))try{var vt=Ne.call(ke,ot);if(vt||A.disconnectedMatch||ke.document&&ke.document.nodeType!==11)return vt}catch{ni(ot,!0)}return jn(ot,fe,null,[ke]).length>0},jn.contains=function(ke,ot){return(ke.ownerDocument||ke)!=fe&&Li(ke),c.contains(ke,ot)},jn.attr=function(ke,ot){(ke.ownerDocument||ke)!=fe&&Li(ke);var vt=E.attrHandle[ot.toLowerCase()],Dt=vt&&C.call(E.attrHandle,ot.toLowerCase())?vt(ke,ot,!xe):void 0;return Dt!==void 0?Dt:ke.getAttribute(ot)},jn.error=function(ke){throw new Error("Syntax error, unrecognized expression: "+ke)},c.uniqueSort=function(ke){var ot,vt=[],Dt=0,kt=0;if(ce=!A.sortStable,re=!A.sortStable&&I.call(ke,0),N.call(ke,Nr),ce){for(;ot=ke[kt++];)ot===ke[kt]&&(Dt=vt.push(kt));for(;Dt--;)P.call(ke,vt[Dt],1)}return re=null,ke},c.fn.uniqueSort=function(){return this.pushStack(c.uniqueSort(I.apply(this)))},(E=c.expr={cacheLength:50,createPseudo:Zr,match:Aa,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(ke){return ke[1]=ke[1].replace(Ur,Dr),ke[3]=(ke[3]||ke[4]||ke[5]||"").replace(Ur,Dr),ke[2]==="~="&&(ke[3]=" "+ke[3]+" "),ke.slice(0,4)},CHILD:function(ke){return ke[1]=ke[1].toLowerCase(),ke[1].slice(0,3)==="nth"?(ke[3]||jn.error(ke[0]),ke[4]=+(ke[4]?ke[5]+(ke[6]||1):2*(ke[3]==="even"||ke[3]==="odd")),ke[5]=+(ke[7]+ke[8]||ke[3]==="odd")):ke[3]&&jn.error(ke[0]),ke},PSEUDO:function(ke){var ot,vt=!ke[6]&&ke[2];return Aa.CHILD.test(ke[0])?null:(ke[3]?ke[2]=ke[4]||ke[5]||"":vt&&kn.test(vt)&&(ot=js(vt,!0))&&(ot=vt.indexOf(")",vt.length-ot)-vt.length)&&(ke[0]=ke[0].slice(0,ot),ke[2]=vt.slice(0,ot)),ke.slice(0,3))}},filter:{TAG:function(ke){var ot=ke.replace(Ur,Dr).toLowerCase();return ke==="*"?function(){return!0}:function(vt){return m(vt,ot)}},CLASS:function(ke){var ot=Pn[ke+" "];return ot||(ot=new RegExp("(^|"+O+")"+ke+"("+O+"|$)"))&&Pn(ke,function(vt){return ot.test(typeof vt.className=="string"&&vt.className||vt.getAttribute!==void 0&&vt.getAttribute("class")||"")})},ATTR:function(ke,ot,vt){return function(Dt){var kt=jn.attr(Dt,ke);return kt==null?ot==="!=":!ot||(kt+="",ot==="="?kt===vt:ot==="!="?kt!==vt:ot==="^="?vt&&kt.indexOf(vt)===0:ot==="*="?vt&&kt.indexOf(vt)>-1:ot==="$="?vt&&kt.slice(-vt.length)===vt:ot==="~="?(" "+kt.replace(Ar," ")+" ").indexOf(vt)>-1:ot==="|="&&(kt===vt||kt.slice(0,vt.length+1)===vt+"-"))}},CHILD:function(ke,ot,vt,Dt,kt){var on=ke.slice(0,3)!=="nth",rn=ke.slice(-4)!=="last",pn=ot==="of-type";return Dt===1&&kt===0?function(un){return!!un.parentNode}:function(un,Br,_r){var fr,jr,ir,bi,Ii,Gi=on!==rn?"nextSibling":"previousSibling",ye=un.parentNode,Wi=pn&&un.nodeName.toLowerCase(),ba=!_r&&!pn,Or=!1;if(ye){if(on){for(;Gi;){for(ir=un;ir=ir[Gi];)if(pn?m(ir,Wi):ir.nodeType===1)return!1;Ii=Gi=ke==="only"&&!Ii&&"nextSibling"}return!0}if(Ii=[rn?ye.firstChild:ye.lastChild],rn&&ba){for(Or=(bi=(fr=(jr=ye[ht]||(ye[ht]={}))[ke]||[])[0]===lt&&fr[1])&&fr[2],ir=bi&&ye.childNodes[bi];ir=++bi&&ir&&ir[Gi]||(Or=bi=0)||Ii.pop();)if(ir.nodeType===1&&++Or&&ir===un){jr[ke]=[lt,bi,Or];break}}else if(ba&&(Or=bi=(fr=(jr=un[ht]||(un[ht]={}))[ke]||[])[0]===lt&&fr[1]),Or===!1)for(;(ir=++bi&&ir&&ir[Gi]||(Or=bi=0)||Ii.pop())&&(!(pn?m(ir,Wi):ir.nodeType===1)||!++Or||(ba&&((jr=ir[ht]||(ir[ht]={}))[ke]=[lt,Or]),ir!==un)););return(Or-=kt)===Dt||Or%Dt==0&&Or/Dt>=0}}},PSEUDO:function(ke,ot){var vt,Dt=E.pseudos[ke]||E.setFilters[ke.toLowerCase()]||jn.error("unsupported pseudo: "+ke);return Dt[ht]?Dt(ot):Dt.length>1?(vt=[ke,ke,"",ot],E.setFilters.hasOwnProperty(ke.toLowerCase())?Zr(function(kt,on){for(var rn,pn=Dt(kt,ot),un=pn.length;un--;)kt[rn=L.call(kt,pn[un])]=!(on[rn]=pn[un])}):function(kt){return Dt(kt,0,vt)}):Dt}},pseudos:{not:Zr(function(ke){var ot=[],vt=[],Dt=Ql(ke.replace(Z,"$1"));return Dt[ht]?Zr(function(kt,on,rn,pn){for(var un,Br=Dt(kt,null,pn,[]),_r=kt.length;_r--;)(un=Br[_r])&&(kt[_r]=!(on[_r]=un))}):function(kt,on,rn){return ot[0]=kt,Dt(ot,null,rn,vt),ot[0]=null,!vt.pop()}}),has:Zr(function(ke){return function(ot){return jn(ke,ot).length>0}}),contains:Zr(function(ke){return ke=ke.replace(Ur,Dr),function(ot){return(ot.textContent||c.text(ot)).indexOf(ke)>-1}}),lang:Zr(function(ke){return Xo.test(ke||"")||jn.error("unsupported lang: "+ke),ke=ke.replace(Ur,Dr).toLowerCase(),function(ot){var vt;do if(vt=xe?ot.lang:ot.getAttribute("xml:lang")||ot.getAttribute("lang"))return(vt=vt.toLowerCase())===ke||vt.indexOf(ke+"-")===0;while((ot=ot.parentNode)&&ot.nodeType===1);return!1}}),target:function(ke){var ot=a.location&&a.location.hash;return ot&&ot.slice(1)===ke.id},root:function(ke){return ke===be},focus:function(ke){return ke===function(){try{return fe.activeElement}catch{}}()&&fe.hasFocus()&&!!(ke.type||ke.href||~ke.tabIndex)},enabled:Zo(!1),disabled:Zo(!0),checked:function(ke){return m(ke,"input")&&!!ke.checked||m(ke,"option")&&!!ke.selected},selected:function(ke){return ke.parentNode&&ke.parentNode.selectedIndex,ke.selected===!0},empty:function(ke){for(ke=ke.firstChild;ke;ke=ke.nextSibling)if(ke.nodeType<6)return!1;return!0},parent:function(ke){return!E.pseudos.empty(ke)},header:function(ke){return hi.test(ke.nodeName)},input:function(ke){return Pa.test(ke.nodeName)},button:function(ke){return m(ke,"input")&&ke.type==="button"||m(ke,"button")},text:function(ke){var ot;return m(ke,"input")&&ke.type==="text"&&((ot=ke.getAttribute("type"))==null||ot.toLowerCase()==="text")},first:Va(function(){return[0]}),last:Va(function(ke,ot){return[ot-1]}),eq:Va(function(ke,ot,vt){return[vt<0?vt+ot:vt]}),even:Va(function(ke,ot){for(var vt=0;vt<ot;vt+=2)ke.push(vt);return ke}),odd:Va(function(ke,ot){for(var vt=1;vt<ot;vt+=2)ke.push(vt);return ke}),lt:Va(function(ke,ot,vt){var Dt;for(Dt=vt<0?vt+ot:vt>ot?ot:vt;--Dt>=0;)ke.push(Dt);return ke}),gt:Va(function(ke,ot,vt){for(var Dt=vt<0?vt+ot:vt;++Dt<ot;)ke.push(Dt);return ke})}}).pseudos.nth=E.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})E.pseudos[w]=en(w);for(w in{submit:!0,reset:!0})E.pseudos[w]=Yo(w);function fl(){}function js(ke,ot){var vt,Dt,kt,on,rn,pn,un,Br=_n[ke+" "];if(Br)return ot?0:Br.slice(0);for(rn=ke,pn=[],un=E.preFilter;rn;){for(on in vt&&!(Dt=Fn.exec(rn))||(Dt&&(rn=rn.slice(Dt[0].length)||rn),pn.push(kt=[])),vt=!1,(Dt=Jo.exec(rn))&&(vt=Dt.shift(),kt.push({value:vt,type:Dt[0].replace(Z," ")}),rn=rn.slice(vt.length)),E.filter)!(Dt=Aa[on].exec(rn))||un[on]&&!(Dt=un[on](Dt))||(vt=Dt.shift(),kt.push({value:vt,type:on,matches:Dt}),rn=rn.slice(vt.length));if(!vt)break}return ot?rn.length:rn?jn.error(ke):_n(ke,pn).slice(0)}function Ns(ke){for(var ot=0,vt=ke.length,Dt="";ot<vt;ot++)Dt+=ke[ot].value;return Dt}function oo(ke,ot,vt){var Dt=ot.dir,kt=ot.next,on=kt||Dt,rn=vt&&on==="parentNode",pn=Ot++;return ot.first?function(un,Br,_r){for(;un=un[Dt];)if(un.nodeType===1||rn)return ke(un,Br,_r);return!1}:function(un,Br,_r){var fr,jr,ir=[lt,pn];if(_r){for(;un=un[Dt];)if((un.nodeType===1||rn)&&ke(un,Br,_r))return!0}else for(;un=un[Dt];)if(un.nodeType===1||rn)if(jr=un[ht]||(un[ht]={}),kt&&m(un,kt))un=un[Dt]||un;else{if((fr=jr[on])&&fr[0]===lt&&fr[1]===pn)return ir[2]=fr[2];if(jr[on]=ir,ir[2]=ke(un,Br,_r))return!0}return!1}}function gs(ke){return ke.length>1?function(ot,vt,Dt){for(var kt=ke.length;kt--;)if(!ke[kt](ot,vt,Dt))return!1;return!0}:ke[0]}function oi(ke,ot,vt,Dt,kt){for(var on,rn=[],pn=0,un=ke.length,Br=ot!=null;pn<un;pn++)(on=ke[pn])&&(vt&&!vt(on,Dt,kt)||(rn.push(on),Br&&ot.push(pn)));return rn}function Bi(ke,ot,vt,Dt,kt,on){return Dt&&!Dt[ht]&&(Dt=Bi(Dt)),kt&&!kt[ht]&&(kt=Bi(kt,on)),Zr(function(rn,pn,un,Br){var _r,fr,jr,ir,bi=[],Ii=[],Gi=pn.length,ye=rn||function(ba,Or,xr){for(var Qi=0,Fa=Or.length;Qi<Fa;Qi++)jn(ba,Or[Qi],xr);return xr}(ot||"*",un.nodeType?[un]:un,[]),Wi=!ke||!rn&&ot?ye:oi(ye,bi,ke,un,Br);if(vt?vt(Wi,ir=kt||(rn?ke:Gi||Dt)?[]:pn,un,Br):ir=Wi,Dt)for(_r=oi(ir,Ii),Dt(_r,[],un,Br),fr=_r.length;fr--;)(jr=_r[fr])&&(ir[Ii[fr]]=!(Wi[Ii[fr]]=jr));if(rn){if(kt||ke){if(kt){for(_r=[],fr=ir.length;fr--;)(jr=ir[fr])&&_r.push(Wi[fr]=jr);kt(null,ir=[],_r,Br)}for(fr=ir.length;fr--;)(jr=ir[fr])&&(_r=kt?L.call(rn,jr):bi[fr])>-1&&(rn[_r]=!(pn[_r]=jr))}}else ir=oi(ir===pn?ir.splice(Gi,ir.length):ir),kt?kt(null,pn,ir,Br):Qe.apply(pn,ir)})}function $l(ke){for(var ot,vt,Dt,kt=ke.length,on=E.relative[ke[0].type],rn=on||E.relative[" "],pn=on?1:0,un=oo(function(fr){return fr===ot},rn,!0),Br=oo(function(fr){return L.call(ot,fr)>-1},rn,!0),_r=[function(fr,jr,ir){var bi=!on&&(ir||jr!=X)||((ot=jr).nodeType?un(fr,jr,ir):Br(fr,jr,ir));return ot=null,bi}];pn<kt;pn++)if(vt=E.relative[ke[pn].type])_r=[oo(gs(_r),vt)];else{if((vt=E.filter[ke[pn].type].apply(null,ke[pn].matches))[ht]){for(Dt=++pn;Dt<kt&&!E.relative[ke[Dt].type];Dt++);return Bi(pn>1&&gs(_r),pn>1&&Ns(ke.slice(0,pn-1).concat({value:ke[pn-2].type===" "?"*":""})).replace(Z,"$1"),vt,pn<Dt&&$l(ke.slice(pn,Dt)),Dt<kt&&$l(ke=ke.slice(Dt)),Dt<kt&&Ns(ke))}_r.push(vt)}return gs(_r)}function Ql(ke,ot){var vt,Dt=[],kt=[],on=Xn[ke+" "];if(!on){for(ot||(ot=js(ke)),vt=ot.length;vt--;)(on=$l(ot[vt]))[ht]?Dt.push(on):kt.push(on);(on=Xn(ke,function(rn,pn){var un=pn.length>0,Br=rn.length>0,_r=function(fr,jr,ir,bi,Ii){var Gi,ye,Wi,ba=0,Or="0",xr=fr&&[],Qi=[],Fa=X,so=fr||Br&&E.find.TAG("*",Ii),Oo=lt+=Fa==null?1:Math.random()||.1,Ya=so.length;for(Ii&&(X=jr==fe||jr||Ii);Or!==Ya&&(Gi=so[Or])!=null;Or++){if(Br&&Gi){for(ye=0,jr||Gi.ownerDocument==fe||(Li(Gi),ir=!xe);Wi=rn[ye++];)if(Wi(Gi,jr||fe,ir)){Qe.call(bi,Gi);break}Ii&&(lt=Oo)}un&&((Gi=!Wi&&Gi)&&ba--,fr&&xr.push(Gi))}if(ba+=Or,un&&Or!==ba){for(ye=0;Wi=pn[ye++];)Wi(xr,Qi,jr,ir);if(fr){if(ba>0)for(;Or--;)xr[Or]||Qi[Or]||(Qi[Or]=f.call(bi));Qi=oi(Qi)}Qe.apply(bi,Qi),Ii&&!fr&&Qi.length>0&&ba+pn.length>1&&c.uniqueSort(bi)}return Ii&&(lt=Oo,X=Fa),xr};return un?Zr(_r):_r}(kt,Dt))).selector=ke}return on}function ml(ke,ot,vt,Dt){var kt,on,rn,pn,un,Br=typeof ke=="function"&&ke,_r=!Dt&&js(ke=Br.selector||ke);if(vt=vt||[],_r.length===1){if((on=_r[0]=_r[0].slice(0)).length>2&&(rn=on[0]).type==="ID"&&ot.nodeType===9&&xe&&E.relative[on[1].type]){if(!(ot=(E.find.ID(rn.matches[0].replace(Ur,Dr),ot)||[])[0]))return vt;Br&&(ot=ot.parentNode),ke=ke.slice(on.shift().value.length)}for(kt=Aa.needsContext.test(ke)?0:on.length;kt--&&(rn=on[kt],!E.relative[pn=rn.type]);)if((un=E.find[pn])&&(Dt=un(rn.matches[0].replace(Ur,Dr),Fr.test(on[0].type)&&dr(ot.parentNode)||ot))){if(on.splice(kt,1),!(ke=Dt.length&&Ns(on)))return Qe.apply(vt,Dt),vt;break}}return(Br||Ql(ke,_r))(Dt,ot,!xe,vt,!ot||Fr.test(ke)&&dr(ot.parentNode)||ot),vt}fl.prototype=E.filters=E.pseudos,E.setFilters=new fl,A.sortStable=ht.split("").sort(Nr).join("")===ht,Li(),A.sortDetached=Pr(function(ke){return 1&ke.compareDocumentPosition(fe.createElement("fieldset"))}),c.find=jn,c.expr[":"]=c.expr.pseudos,c.unique=c.uniqueSort,jn.compile=Ql,jn.select=ml,jn.setDocument=Li,jn.tokenize=js,jn.escape=c.escapeSelector,jn.getText=c.text,jn.isXML=c.isXMLDoc,jn.selectors=c.expr,jn.support=c.support,jn.uniqueSort=c.uniqueSort})();var ge=function(w,E,X){for(var re=[],ce=X!==void 0;(w=w[E])&&w.nodeType!==9;)if(w.nodeType===1){if(ce&&c(w).is(X))break;re.push(w)}return re},Le=function(w,E){for(var X=[];w;w=w.nextSibling)w.nodeType===1&&w!==E&&X.push(w);return X},Pe=c.expr.match.needsContext,ae=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function ve(w,E,X){return S(E)?c.grep(w,function(re,ce){return!!E.call(re,ce,re)!==X}):E.nodeType?c.grep(w,function(re){return re===E!==X}):typeof E!="string"?c.grep(w,function(re){return L.call(E,re)>-1!==X}):c.filter(E,w,X)}c.filter=function(w,E,X){var re=E[0];return X&&(w=":not("+w+")"),E.length===1&&re.nodeType===1?c.find.matchesSelector(re,w)?[re]:[]:c.find.matches(w,c.grep(E,function(ce){return ce.nodeType===1}))},c.fn.extend({find:function(w){var E,X,re=this.length,ce=this;if(typeof w!="string")return this.pushStack(c(w).filter(function(){for(E=0;E<re;E++)if(c.contains(ce[E],this))return!0}));for(X=this.pushStack([]),E=0;E<re;E++)c.find(w,ce[E],X);return re>1?c.uniqueSort(X):X},filter:function(w){return this.pushStack(ve(this,w||[],!1))},not:function(w){return this.pushStack(ve(this,w||[],!0))},is:function(w){return!!ve(this,typeof w=="string"&&Pe.test(w)?c(w):w||[],!1).length}});var Ie,ze=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(c.fn.init=function(w,E,X){var re,ce;if(!w)return this;if(X=X||Ie,typeof w=="string"){if(!(re=w[0]==="<"&&w[w.length-1]===">"&&w.length>=3?[null,w,null]:ze.exec(w))||!re[1]&&E)return!E||E.jquery?(E||X).find(w):this.constructor(E).find(w);if(re[1]){if(E=E instanceof c?E[0]:E,c.merge(this,c.parseHTML(re[1],E&&E.nodeType?E.ownerDocument||E:W,!0)),ae.test(re[1])&&c.isPlainObject(E))for(re in E)S(this[re])?this[re](E[re]):this.attr(re,E[re]);return this}return(ce=W.getElementById(re[2]))&&(this[0]=ce,this.length=1),this}return w.nodeType?(this[0]=w,this.length=1,this):S(w)?X.ready!==void 0?X.ready(w):w(c):c.makeArray(w,this)}).prototype=c.fn,Ie=c(W);var He=/^(?:parents|prev(?:Until|All))/,at={children:!0,contents:!0,next:!0,prev:!0};function tt(w,E){for(;(w=w[E])&&w.nodeType!==1;);return w}c.fn.extend({has:function(w){var E=c(w,this),X=E.length;return this.filter(function(){for(var re=0;re<X;re++)if(c.contains(this,E[re]))return!0})},closest:function(w,E){var X,re=0,ce=this.length,fe=[],be=typeof w!="string"&&c(w);if(!Pe.test(w)){for(;re<ce;re++)for(X=this[re];X&&X!==E;X=X.parentNode)if(X.nodeType<11&&(be?be.index(X)>-1:X.nodeType===1&&c.find.matchesSelector(X,w))){fe.push(X);break}}return this.pushStack(fe.length>1?c.uniqueSort(fe):fe)},index:function(w){return w?typeof w=="string"?L.call(c(w),this[0]):L.call(this,w.jquery?w[0]:w):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(w,E){return this.pushStack(c.uniqueSort(c.merge(this.get(),c(w,E))))},addBack:function(w){return this.add(w==null?this.prevObject:this.prevObject.filter(w))}}),c.each({parent:function(w){var E=w.parentNode;return E&&E.nodeType!==11?E:null},parents:function(w){return ge(w,"parentNode")},parentsUntil:function(w,E,X){return ge(w,"parentNode",X)},next:function(w){return tt(w,"nextSibling")},prev:function(w){return tt(w,"previousSibling")},nextAll:function(w){return ge(w,"nextSibling")},prevAll:function(w){return ge(w,"previousSibling")},nextUntil:function(w,E,X){return ge(w,"nextSibling",X)},prevUntil:function(w,E,X){return ge(w,"previousSibling",X)},siblings:function(w){return Le((w.parentNode||{}).firstChild,w)},children:function(w){return Le(w.firstChild)},contents:function(w){return w.contentDocument!=null&&M(w.contentDocument)?w.contentDocument:(m(w,"template")&&(w=w.content||w),c.merge([],w.childNodes))}},function(w,E){c.fn[w]=function(X,re){var ce=c.map(this,E,X);return w.slice(-5)!=="Until"&&(re=X),re&&typeof re=="string"&&(ce=c.filter(re,ce)),this.length>1&&(at[w]||c.uniqueSort(ce),He.test(w)&&ce.reverse()),this.pushStack(ce)}});var le=/[^\x20\t\r\n\f]+/g;function De(w){return w}function st(w){throw w}function gt(w,E,X,re){var ce;try{w&&S(ce=w.promise)?ce.call(w).done(E).fail(X):w&&S(ce=w.then)?ce.call(w,E,X):E.apply(void 0,[w].slice(re))}catch(fe){X.apply(void 0,[fe])}}c.Callbacks=function(w){w=typeof w=="string"?function(Qe){var ht={};return c.each(Qe.match(le)||[],function(lt,Ot){ht[Ot]=!0}),ht}(w):c.extend({},w);var E,X,re,ce,fe=[],be=[],xe=-1,Me=function(){for(ce=ce||w.once,re=E=!0;be.length;xe=-1)for(X=be.shift();++xe<fe.length;)fe[xe].apply(X[0],X[1])===!1&&w.stopOnFalse&&(xe=fe.length,X=!1);w.memory||(X=!1),E=!1,ce&&(fe=X?[]:"")},Ne={add:function(){return fe&&(X&&!E&&(xe=fe.length-1,be.push(X)),function Qe(ht){c.each(ht,function(lt,Ot){S(Ot)?w.unique&&Ne.has(Ot)||fe.push(Ot):Ot&&Ot.length&&v(Ot)!=="string"&&Qe(Ot)})}(arguments),X&&!E&&Me()),this},remove:function(){return c.each(arguments,function(Qe,ht){for(var lt;(lt=c.inArray(ht,fe,lt))>-1;)fe.splice(lt,1),lt<=xe&&xe--}),this},has:function(Qe){return Qe?c.inArray(Qe,fe)>-1:fe.length>0},empty:function(){return fe&&(fe=[]),this},disable:function(){return ce=be=[],fe=X="",this},disabled:function(){return!fe},lock:function(){return ce=be=[],X||E||(fe=X=""),this},locked:function(){return!!ce},fireWith:function(Qe,ht){return ce||(ht=[Qe,(ht=ht||[]).slice?ht.slice():ht],be.push(ht),E||Me()),this},fire:function(){return Ne.fireWith(this,arguments),this},fired:function(){return!!re}};return Ne},c.extend({Deferred:function(w){var E=[["notify","progress",c.Callbacks("memory"),c.Callbacks("memory"),2],["resolve","done",c.Callbacks("once memory"),c.Callbacks("once memory"),0,"resolved"],["reject","fail",c.Callbacks("once memory"),c.Callbacks("once memory"),1,"rejected"]],X="pending",re={state:function(){return X},always:function(){return ce.done(arguments).fail(arguments),this},catch:function(fe){return re.then(null,fe)},pipe:function(){var fe=arguments;return c.Deferred(function(be){c.each(E,function(xe,Me){var Ne=S(fe[Me[4]])&&fe[Me[4]];ce[Me[1]](function(){var Qe=Ne&&Ne.apply(this,arguments);Qe&&S(Qe.promise)?Qe.promise().progress(be.notify).done(be.resolve).fail(be.reject):be[Me[0]+"With"](this,Ne?[Qe]:arguments)})}),fe=null}).promise()},then:function(fe,be,xe){var Me=0;function Ne(Qe,ht,lt,Ot){return function(){var Pn=this,_n=arguments,Xn=function(){var Nr,oa;if(!(Qe<Me)){if((Nr=lt.apply(Pn,_n))===ht.promise())throw new TypeError("Thenable self-resolution");oa=Nr&&(typeof Nr=="object"||typeof Nr=="function")&&Nr.then,S(oa)?Ot?oa.call(Nr,Ne(Me,ht,De,Ot),Ne(Me,ht,st,Ot)):(Me++,oa.call(Nr,Ne(Me,ht,De,Ot),Ne(Me,ht,st,Ot),Ne(Me,ht,De,ht.notifyWith))):(lt!==De&&(Pn=void 0,_n=[Nr]),(Ot||ht.resolveWith)(Pn,_n))}},ni=Ot?Xn:function(){try{Xn()}catch(Nr){c.Deferred.exceptionHook&&c.Deferred.exceptionHook(Nr,ni.error),Qe+1>=Me&&(lt!==st&&(Pn=void 0,_n=[Nr]),ht.rejectWith(Pn,_n))}};Qe?ni():(c.Deferred.getErrorHook?ni.error=c.Deferred.getErrorHook():c.Deferred.getStackHook&&(ni.error=c.Deferred.getStackHook()),a.setTimeout(ni))}}return c.Deferred(function(Qe){E[0][3].add(Ne(0,Qe,S(xe)?xe:De,Qe.notifyWith)),E[1][3].add(Ne(0,Qe,S(fe)?fe:De)),E[2][3].add(Ne(0,Qe,S(be)?be:st))}).promise()},promise:function(fe){return fe!=null?c.extend(fe,re):re}},ce={};return c.each(E,function(fe,be){var xe=be[2],Me=be[5];re[be[1]]=xe.add,Me&&xe.add(function(){X=Me},E[3-fe][2].disable,E[3-fe][3].disable,E[0][2].lock,E[0][3].lock),xe.add(be[3].fire),ce[be[0]]=function(){return ce[be[0]+"With"](this===ce?void 0:this,arguments),this},ce[be[0]+"With"]=xe.fireWith}),re.promise(ce),w&&w.call(ce,ce),ce},when:function(w){var E=arguments.length,X=E,re=Array(X),ce=I.call(arguments),fe=c.Deferred(),be=function(xe){return function(Me){re[xe]=this,ce[xe]=arguments.length>1?I.call(arguments):Me,--E||fe.resolveWith(re,ce)}};if(E<=1&&(gt(w,fe.done(be(X)).resolve,fe.reject,!E),fe.state()==="pending"||S(ce[X]&&ce[X].then)))return fe.then();for(;X--;)gt(ce[X],be(X),fe.reject);return fe.promise()}});var St=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;c.Deferred.exceptionHook=function(w,E){a.console&&a.console.warn&&w&&St.test(w.name)&&a.console.warn("jQuery.Deferred exception: "+w.message,w.stack,E)},c.readyException=function(w){a.setTimeout(function(){throw w})};var Rt=c.Deferred();function Pt(){W.removeEventListener("DOMContentLoaded",Pt),a.removeEventListener("load",Pt),c.ready()}c.fn.ready=function(w){return Rt.then(w).catch(function(E){c.readyException(E)}),this},c.extend({isReady:!1,readyWait:1,ready:function(w){(w===!0?--c.readyWait:c.isReady)||(c.isReady=!0,w!==!0&&--c.readyWait>0||Rt.resolveWith(W,[c]))}}),c.ready.then=Rt.then,W.readyState==="complete"||W.readyState!=="loading"&&!W.documentElement.doScroll?a.setTimeout(c.ready):(W.addEventListener("DOMContentLoaded",Pt),a.addEventListener("load",Pt));var Je=function(w,E,X,re,ce,fe,be){var xe=0,Me=w.length,Ne=X==null;if(v(X)==="object")for(xe in ce=!0,X)Je(w,E,xe,X[xe],!0,fe,be);else if(re!==void 0&&(ce=!0,S(re)||(be=!0),Ne&&(be?(E.call(w,re),E=null):(Ne=E,E=function(Qe,ht,lt){return Ne.call(c(Qe),lt)})),E))for(;xe<Me;xe++)E(w[xe],X,be?re:re.call(w[xe],xe,E(w[xe],X)));return ce?w:Ne?E.call(w):Me?E(w[0],X):fe},bt=/^-ms-/,jt=/-([a-z])/g;function Ln(w,E){return E.toUpperCase()}function Yt(w){return w.replace(bt,"ms-").replace(jt,Ln)}var Qt=function(w){return w.nodeType===1||w.nodeType===9||!+w.nodeType};function Ve(){this.expando=c.expando+Ve.uid++}Ve.uid=1,Ve.prototype={cache:function(w){var E=w[this.expando];return E||(E={},Qt(w)&&(w.nodeType?w[this.expando]=E:Object.defineProperty(w,this.expando,{value:E,configurable:!0}))),E},set:function(w,E,X){var re,ce=this.cache(w);if(typeof E=="string")ce[Yt(E)]=X;else for(re in E)ce[Yt(re)]=E[re];return ce},get:function(w,E){return E===void 0?this.cache(w):w[this.expando]&&w[this.expando][Yt(E)]},access:function(w,E,X){return E===void 0||E&&typeof E=="string"&&X===void 0?this.get(w,E):(this.set(w,E,X),X!==void 0?X:E)},remove:function(w,E){var X,re=w[this.expando];if(re!==void 0){if(E!==void 0)for(X=(E=Array.isArray(E)?E.map(Yt):(E=Yt(E))in re?[E]:E.match(le)||[]).length;X--;)delete re[E[X]];(E===void 0||c.isEmptyObject(re))&&(w.nodeType?w[this.expando]=void 0:delete w[this.expando])}},hasData:function(w){var E=w[this.expando];return E!==void 0&&!c.isEmptyObject(E)}};var Be=new Ve,Wt=new Ve,Kn=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,nn=/[A-Z]/g;function ct(w,E,X){var re;if(X===void 0&&w.nodeType===1)if(re="data-"+E.replace(nn,"-$&").toLowerCase(),typeof(X=w.getAttribute(re))=="string"){try{X=function(ce){return ce==="true"||ce!=="false"&&(ce==="null"?null:ce===+ce+""?+ce:Kn.test(ce)?JSON.parse(ce):ce)}(X)}catch{}Wt.set(w,E,X)}else X=void 0;return X}c.extend({hasData:function(w){return Wt.hasData(w)||Be.hasData(w)},data:function(w,E,X){return Wt.access(w,E,X)},removeData:function(w,E){Wt.remove(w,E)},_data:function(w,E,X){return Be.access(w,E,X)},_removeData:function(w,E){Be.remove(w,E)}}),c.fn.extend({data:function(w,E){var X,re,ce,fe=this[0],be=fe&&fe.attributes;if(w===void 0){if(this.length&&(ce=Wt.get(fe),fe.nodeType===1&&!Be.get(fe,"hasDataAttrs"))){for(X=be.length;X--;)be[X]&&(re=be[X].name).indexOf("data-")===0&&(re=Yt(re.slice(5)),ct(fe,re,ce[re]));Be.set(fe,"hasDataAttrs",!0)}return ce}return typeof w=="object"?this.each(function(){Wt.set(this,w)}):Je(this,function(xe){var Me;if(fe&&xe===void 0)return(Me=Wt.get(fe,w))!==void 0||(Me=ct(fe,w))!==void 0?Me:void 0;this.each(function(){Wt.set(this,w,xe)})},null,E,arguments.length>1,null,!0)},removeData:function(w){return this.each(function(){Wt.remove(this,w)})}}),c.extend({queue:function(w,E,X){var re;if(w)return E=(E||"fx")+"queue",re=Be.get(w,E),X&&(!re||Array.isArray(X)?re=Be.access(w,E,c.makeArray(X)):re.push(X)),re||[]},dequeue:function(w,E){E=E||"fx";var X=c.queue(w,E),re=X.length,ce=X.shift(),fe=c._queueHooks(w,E);ce==="inprogress"&&(ce=X.shift(),re--),ce&&(E==="fx"&&X.unshift("inprogress"),delete fe.stop,ce.call(w,function(){c.dequeue(w,E)},fe)),!re&&fe&&fe.empty.fire()},_queueHooks:function(w,E){var X=E+"queueHooks";return Be.get(w,X)||Be.access(w,X,{empty:c.Callbacks("once memory").add(function(){Be.remove(w,[E+"queue",X])})})}}),c.fn.extend({queue:function(w,E){var X=2;return typeof w!="string"&&(E=w,w="fx",X--),arguments.length<X?c.queue(this[0],w):E===void 0?this:this.each(function(){var re=c.queue(this,w,E);c._queueHooks(this,w),w==="fx"&&re[0]!=="inprogress"&&c.dequeue(this,w)})},dequeue:function(w){return this.each(function(){c.dequeue(this,w)})},clearQueue:function(w){return this.queue(w||"fx",[])},promise:function(w,E){var X,re=1,ce=c.Deferred(),fe=this,be=this.length,xe=function(){--re||ce.resolveWith(fe,[fe])};for(typeof w!="string"&&(E=w,w=void 0),w=w||"fx";be--;)(X=Be.get(fe[be],w+"queueHooks"))&&X.empty&&(re++,X.empty.add(xe));return xe(),ce.promise(E)}});var rt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Zt=new RegExp("^(?:([+-])=|)("+rt+")([a-z%]*)$","i"),bn=["Top","Right","Bottom","Left"],Kt=W.documentElement,Zn=function(w){return c.contains(w.ownerDocument,w)},Se={composed:!0};Kt.getRootNode&&(Zn=function(w){return c.contains(w.ownerDocument,w)||w.getRootNode(Se)===w.ownerDocument});var Cr=function(w,E){return(w=E||w).style.display==="none"||w.style.display===""&&Zn(w)&&c.css(w,"display")==="none"};function Xe(w,E,X,re){var ce,fe,be=20,xe=re?function(){return re.cur()}:function(){return c.css(w,E,"")},Me=xe(),Ne=X&&X[3]||(c.cssNumber[E]?"":"px"),Qe=w.nodeType&&(c.cssNumber[E]||Ne!=="px"&&+Me)&&Zt.exec(c.css(w,E));if(Qe&&Qe[3]!==Ne){for(Me/=2,Ne=Ne||Qe[3],Qe=+Me||1;be--;)c.style(w,E,Qe+Ne),(1-fe)*(1-(fe=xe()/Me||.5))<=0&&(be=0),Qe/=fe;Qe*=2,c.style(w,E,Qe+Ne),X=X||[]}return X&&(Qe=+Qe||+Me||0,ce=X[1]?Qe+(X[1]+1)*X[2]:+X[2],re&&(re.unit=Ne,re.start=Qe,re.end=ce)),ce}var qe={};function ut(w){var E,X=w.ownerDocument,re=w.nodeName,ce=qe[re];return ce||(E=X.body.appendChild(X.createElement(re)),ce=c.css(E,"display"),E.parentNode.removeChild(E),ce==="none"&&(ce="block"),qe[re]=ce,ce)}function Re(w,E){for(var X,re,ce=[],fe=0,be=w.length;fe<be;fe++)(re=w[fe]).style&&(X=re.style.display,E?(X==="none"&&(ce[fe]=Be.get(re,"display")||null,ce[fe]||(re.style.display="")),re.style.display===""&&Cr(re)&&(ce[fe]=ut(re))):X!=="none"&&(ce[fe]="none",Be.set(re,"display",X)));for(fe=0;fe<be;fe++)ce[fe]!=null&&(w[fe].style.display=ce[fe]);return w}c.fn.extend({show:function(){return Re(this,!0)},hide:function(){return Re(this)},toggle:function(w){return typeof w=="boolean"?w?this.show():this.hide():this.each(function(){Cr(this)?c(this).show():c(this).hide()})}});var xt,qt,Lt=/^(?:checkbox|radio)$/i,En=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,yr=/^$|^module$|\/(?:java|ecma)script/i;xt=W.createDocumentFragment().appendChild(W.createElement("div")),(qt=W.createElement("input")).setAttribute("type","radio"),qt.setAttribute("checked","checked"),qt.setAttribute("name","t"),xt.appendChild(qt),A.checkClone=xt.cloneNode(!0).cloneNode(!0).lastChild.checked,xt.innerHTML="<textarea>x</textarea>",A.noCloneChecked=!!xt.cloneNode(!0).lastChild.defaultValue,xt.innerHTML="<option></option>",A.option=!!xt.lastChild;var pr={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Mr(w,E){var X;return X=w.getElementsByTagName!==void 0?w.getElementsByTagName(E||"*"):w.querySelectorAll!==void 0?w.querySelectorAll(E||"*"):[],E===void 0||E&&m(w,E)?c.merge([w],X):X}function Si(w,E){for(var X=0,re=w.length;X<re;X++)Be.set(w[X],"globalEval",!E||Be.get(E[X],"globalEval"))}pr.tbody=pr.tfoot=pr.colgroup=pr.caption=pr.thead,pr.th=pr.td,A.option||(pr.optgroup=pr.option=[1,"<select multiple='multiple'>","</select>"]);var ci=/<|&#?\w+;/;function Ni(w,E,X,re,ce){for(var fe,be,xe,Me,Ne,Qe,ht=E.createDocumentFragment(),lt=[],Ot=0,Pn=w.length;Ot<Pn;Ot++)if((fe=w[Ot])||fe===0)if(v(fe)==="object")c.merge(lt,fe.nodeType?[fe]:fe);else if(ci.test(fe)){for(be=be||ht.appendChild(E.createElement("div")),xe=(En.exec(fe)||["",""])[1].toLowerCase(),Me=pr[xe]||pr._default,be.innerHTML=Me[1]+c.htmlPrefilter(fe)+Me[2],Qe=Me[0];Qe--;)be=be.lastChild;c.merge(lt,be.childNodes),(be=ht.firstChild).textContent=""}else lt.push(E.createTextNode(fe));for(ht.textContent="",Ot=0;fe=lt[Ot++];)if(re&&c.inArray(fe,re)>-1)ce&&ce.push(fe);else if(Ne=Zn(fe),be=Mr(ht.appendChild(fe),"script"),Ne&&Si(be),X)for(Qe=0;fe=be[Qe++];)yr.test(fe.type||"")&&X.push(fe);return ht}var Jr=/^([^.]*)(?:\.(.+)|)/;function ai(){return!0}function hr(){return!1}function xi(w,E,X,re,ce,fe){var be,xe;if(typeof E=="object"){for(xe in typeof X!="string"&&(re=re||X,X=void 0),E)xi(w,xe,X,re,E[xe],fe);return w}if(re==null&&ce==null?(ce=X,re=X=void 0):ce==null&&(typeof X=="string"?(ce=re,re=void 0):(ce=re,re=X,X=void 0)),ce===!1)ce=hr;else if(!ce)return w;return fe===1&&(be=ce,(ce=function(Me){return c().off(Me),be.apply(this,arguments)}).guid=be.guid||(be.guid=c.guid++)),w.each(function(){c.event.add(this,E,ce,re,X)})}function J(w,E,X){X?(Be.set(w,E,!1),c.event.add(w,E,{namespace:!1,handler:function(re){var ce,fe=Be.get(this,E);if(1&re.isTrigger&&this[E]){if(fe)(c.event.special[E]||{}).delegateType&&re.stopPropagation();else if(fe=I.call(arguments),Be.set(this,E,fe),this[E](),ce=Be.get(this,E),Be.set(this,E,!1),fe!==ce)return re.stopImmediatePropagation(),re.preventDefault(),ce}else fe&&(Be.set(this,E,c.event.trigger(fe[0],fe.slice(1),this)),re.stopPropagation(),re.isImmediatePropagationStopped=ai)}})):Be.get(w,E)===void 0&&c.event.add(w,E,ai)}c.event={global:{},add:function(w,E,X,re,ce){var fe,be,xe,Me,Ne,Qe,ht,lt,Ot,Pn,_n,Xn=Be.get(w);if(Qt(w))for(X.handler&&(X=(fe=X).handler,ce=fe.selector),ce&&c.find.matchesSelector(Kt,ce),X.guid||(X.guid=c.guid++),(Me=Xn.events)||(Me=Xn.events=Object.create(null)),(be=Xn.handle)||(be=Xn.handle=function(ni){return c!==void 0&&c.event.triggered!==ni.type?c.event.dispatch.apply(w,arguments):void 0}),Ne=(E=(E||"").match(le)||[""]).length;Ne--;)Ot=_n=(xe=Jr.exec(E[Ne])||[])[1],Pn=(xe[2]||"").split(".").sort(),Ot&&(ht=c.event.special[Ot]||{},Ot=(ce?ht.delegateType:ht.bindType)||Ot,ht=c.event.special[Ot]||{},Qe=c.extend({type:Ot,origType:_n,data:re,handler:X,guid:X.guid,selector:ce,needsContext:ce&&c.expr.match.needsContext.test(ce),namespace:Pn.join(".")},fe),(lt=Me[Ot])||((lt=Me[Ot]=[]).delegateCount=0,ht.setup&&ht.setup.call(w,re,Pn,be)!==!1||w.addEventListener&&w.addEventListener(Ot,be)),ht.add&&(ht.add.call(w,Qe),Qe.handler.guid||(Qe.handler.guid=X.guid)),ce?lt.splice(lt.delegateCount++,0,Qe):lt.push(Qe),c.event.global[Ot]=!0)},remove:function(w,E,X,re,ce){var fe,be,xe,Me,Ne,Qe,ht,lt,Ot,Pn,_n,Xn=Be.hasData(w)&&Be.get(w);if(Xn&&(Me=Xn.events)){for(Ne=(E=(E||"").match(le)||[""]).length;Ne--;)if(Ot=_n=(xe=Jr.exec(E[Ne])||[])[1],Pn=(xe[2]||"").split(".").sort(),Ot){for(ht=c.event.special[Ot]||{},lt=Me[Ot=(re?ht.delegateType:ht.bindType)||Ot]||[],xe=xe[2]&&new RegExp("(^|\\.)"+Pn.join("\\.(?:.*\\.|)")+"(\\.|$)"),be=fe=lt.length;fe--;)Qe=lt[fe],!ce&&_n!==Qe.origType||X&&X.guid!==Qe.guid||xe&&!xe.test(Qe.namespace)||re&&re!==Qe.selector&&(re!=="**"||!Qe.selector)||(lt.splice(fe,1),Qe.selector&&lt.delegateCount--,ht.remove&&ht.remove.call(w,Qe));be&&!lt.length&&(ht.teardown&&ht.teardown.call(w,Pn,Xn.handle)!==!1||c.removeEvent(w,Ot,Xn.handle),delete Me[Ot])}else for(Ot in Me)c.event.remove(w,Ot+E[Ne],X,re,!0);c.isEmptyObject(Me)&&Be.remove(w,"handle events")}},dispatch:function(w){var E,X,re,ce,fe,be,xe=new Array(arguments.length),Me=c.event.fix(w),Ne=(Be.get(this,"events")||Object.create(null))[Me.type]||[],Qe=c.event.special[Me.type]||{};for(xe[0]=Me,E=1;E<arguments.length;E++)xe[E]=arguments[E];if(Me.delegateTarget=this,!Qe.preDispatch||Qe.preDispatch.call(this,Me)!==!1){for(be=c.event.handlers.call(this,Me,Ne),E=0;(ce=be[E++])&&!Me.isPropagationStopped();)for(Me.currentTarget=ce.elem,X=0;(fe=ce.handlers[X++])&&!Me.isImmediatePropagationStopped();)Me.rnamespace&&fe.namespace!==!1&&!Me.rnamespace.test(fe.namespace)||(Me.handleObj=fe,Me.data=fe.data,(re=((c.event.special[fe.origType]||{}).handle||fe.handler).apply(ce.elem,xe))!==void 0&&(Me.result=re)===!1&&(Me.preventDefault(),Me.stopPropagation()));return Qe.postDispatch&&Qe.postDispatch.call(this,Me),Me.result}},handlers:function(w,E){var X,re,ce,fe,be,xe=[],Me=E.delegateCount,Ne=w.target;if(Me&&Ne.nodeType&&!(w.type==="click"&&w.button>=1)){for(;Ne!==this;Ne=Ne.parentNode||this)if(Ne.nodeType===1&&(w.type!=="click"||Ne.disabled!==!0)){for(fe=[],be={},X=0;X<Me;X++)be[ce=(re=E[X]).selector+" "]===void 0&&(be[ce]=re.needsContext?c(ce,this).index(Ne)>-1:c.find(ce,this,null,[Ne]).length),be[ce]&&fe.push(re);fe.length&&xe.push({elem:Ne,handlers:fe})}}return Ne=this,Me<E.length&&xe.push({elem:Ne,handlers:E.slice(Me)}),xe},addProp:function(w,E){Object.defineProperty(c.Event.prototype,w,{enumerable:!0,configurable:!0,get:S(E)?function(){if(this.originalEvent)return E(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[w]},set:function(X){Object.defineProperty(this,w,{enumerable:!0,configurable:!0,writable:!0,value:X})}})},fix:function(w){return w[c.expando]?w:new c.Event(w)},special:{load:{noBubble:!0},click:{setup:function(w){var E=this||w;return Lt.test(E.type)&&E.click&&m(E,"input")&&J(E,"click",!0),!1},trigger:function(w){var E=this||w;return Lt.test(E.type)&&E.click&&m(E,"input")&&J(E,"click"),!0},_default:function(w){var E=w.target;return Lt.test(E.type)&&E.click&&m(E,"input")&&Be.get(E,"click")||m(E,"a")}},beforeunload:{postDispatch:function(w){w.result!==void 0&&w.originalEvent&&(w.originalEvent.returnValue=w.result)}}}},c.removeEvent=function(w,E,X){w.removeEventListener&&w.removeEventListener(E,X)},c.Event=function(w,E){if(!(this instanceof c.Event))return new c.Event(w,E);w&&w.type?(this.originalEvent=w,this.type=w.type,this.isDefaultPrevented=w.defaultPrevented||w.defaultPrevented===void 0&&w.returnValue===!1?ai:hr,this.target=w.target&&w.target.nodeType===3?w.target.parentNode:w.target,this.currentTarget=w.currentTarget,this.relatedTarget=w.relatedTarget):this.type=w,E&&c.extend(this,E),this.timeStamp=w&&w.timeStamp||Date.now(),this[c.expando]=!0},c.Event.prototype={constructor:c.Event,isDefaultPrevented:hr,isPropagationStopped:hr,isImmediatePropagationStopped:hr,isSimulated:!1,preventDefault:function(){var w=this.originalEvent;this.isDefaultPrevented=ai,w&&!this.isSimulated&&w.preventDefault()},stopPropagation:function(){var w=this.originalEvent;this.isPropagationStopped=ai,w&&!this.isSimulated&&w.stopPropagation()},stopImmediatePropagation:function(){var w=this.originalEvent;this.isImmediatePropagationStopped=ai,w&&!this.isSimulated&&w.stopImmediatePropagation(),this.stopPropagation()}},c.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},c.event.addProp),c.each({focus:"focusin",blur:"focusout"},function(w,E){function X(re){if(W.documentMode){var ce=Be.get(this,"handle"),fe=c.event.fix(re);fe.type=re.type==="focusin"?"focus":"blur",fe.isSimulated=!0,ce(re),fe.target===fe.currentTarget&&ce(fe)}else c.event.simulate(E,re.target,c.event.fix(re))}c.event.special[w]={setup:function(){var re;if(J(this,w,!0),!W.documentMode)return!1;(re=Be.get(this,E))||this.addEventListener(E,X),Be.set(this,E,(re||0)+1)},trigger:function(){return J(this,w),!0},teardown:function(){var re;if(!W.documentMode)return!1;(re=Be.get(this,E)-1)?Be.set(this,E,re):(this.removeEventListener(E,X),Be.remove(this,E))},_default:function(re){return Be.get(re.target,w)},delegateType:E},c.event.special[E]={setup:function(){var re=this.ownerDocument||this.document||this,ce=W.documentMode?this:re,fe=Be.get(ce,E);fe||(W.documentMode?this.addEventListener(E,X):re.addEventListener(w,X,!0)),Be.set(ce,E,(fe||0)+1)},teardown:function(){var re=this.ownerDocument||this.document||this,ce=W.documentMode?this:re,fe=Be.get(ce,E)-1;fe?Be.set(ce,E,fe):(W.documentMode?this.removeEventListener(E,X):re.removeEventListener(w,X,!0),Be.remove(ce,E))}}}),c.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(w,E){c.event.special[w]={delegateType:E,bindType:E,handle:function(X){var re,ce=X.relatedTarget,fe=X.handleObj;return ce&&(ce===this||c.contains(this,ce))||(X.type=fe.origType,re=fe.handler.apply(this,arguments),X.type=E),re}}}),c.fn.extend({on:function(w,E,X,re){return xi(this,w,E,X,re)},one:function(w,E,X,re){return xi(this,w,E,X,re,1)},off:function(w,E,X){var re,ce;if(w&&w.preventDefault&&w.handleObj)return re=w.handleObj,c(w.delegateTarget).off(re.namespace?re.origType+"."+re.namespace:re.origType,re.selector,re.handler),this;if(typeof w=="object"){for(ce in w)this.off(ce,E,w[ce]);return this}return E!==!1&&typeof E!="function"||(X=E,E=void 0),X===!1&&(X=hr),this.each(function(){c.event.remove(this,w,X,E)})}});var Lr=/<script|<style|<link/i,Pi=/checked\s*(?:[^=]|=\s*.checked.)/i,zn=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Zi(w,E){return m(w,"table")&&m(E.nodeType!==11?E:E.firstChild,"tr")&&c(w).children("tbody")[0]||w}function mo(w){return w.type=(w.getAttribute("type")!==null)+"/"+w.type,w}function mn(w){return(w.type||"").slice(0,5)==="true/"?w.type=w.type.slice(5):w.removeAttribute("type"),w}function Ca(w,E){var X,re,ce,fe,be,xe;if(E.nodeType===1){if(Be.hasData(w)&&(xe=Be.get(w).events))for(ce in Be.remove(E,"handle events"),xe)for(X=0,re=xe[ce].length;X<re;X++)c.event.add(E,ce,xe[ce][X]);Wt.hasData(w)&&(fe=Wt.access(w),be=c.extend({},fe),Wt.set(E,be))}}function ka(w,E){var X=E.nodeName.toLowerCase();X==="input"&&Lt.test(w.type)?E.checked=w.checked:X!=="input"&&X!=="textarea"||(E.defaultValue=w.defaultValue)}function Sa(w,E,X,re){E=H(E);var ce,fe,be,xe,Me,Ne,Qe=0,ht=w.length,lt=ht-1,Ot=E[0],Pn=S(Ot);if(Pn||ht>1&&typeof Ot=="string"&&!A.checkClone&&Pi.test(Ot))return w.each(function(_n){var Xn=w.eq(_n);Pn&&(E[0]=Ot.call(this,_n,Xn.html())),Sa(Xn,E,X,re)});if(ht&&(fe=(ce=Ni(E,w[0].ownerDocument,!1,w,re)).firstChild,ce.childNodes.length===1&&(ce=fe),fe||re)){for(xe=(be=c.map(Mr(ce,"script"),mo)).length;Qe<ht;Qe++)Me=ce,Qe!==lt&&(Me=c.clone(Me,!0,!0),xe&&c.merge(be,Mr(Me,"script"))),X.call(w[Qe],Me,Qe);if(xe)for(Ne=be[be.length-1].ownerDocument,c.map(be,mn),Qe=0;Qe<xe;Qe++)Me=be[Qe],yr.test(Me.type||"")&&!Be.access(Me,"globalEval")&&c.contains(Ne,Me)&&(Me.src&&(Me.type||"").toLowerCase()!=="module"?c._evalUrl&&!Me.noModule&&c._evalUrl(Me.src,{nonce:Me.nonce||Me.getAttribute("nonce")},Ne):R(Me.textContent.replace(zn,""),Me,Ne))}return w}function Co(w,E,X){for(var re,ce=E?c.filter(E,w):w,fe=0;(re=ce[fe])!=null;fe++)X||re.nodeType!==1||c.cleanData(Mr(re)),re.parentNode&&(X&&Zn(re)&&Si(Mr(re,"script")),re.parentNode.removeChild(re));return w}c.extend({htmlPrefilter:function(w){return w},clone:function(w,E,X){var re,ce,fe,be,xe=w.cloneNode(!0),Me=Zn(w);if(!(A.noCloneChecked||w.nodeType!==1&&w.nodeType!==11||c.isXMLDoc(w)))for(be=Mr(xe),re=0,ce=(fe=Mr(w)).length;re<ce;re++)ka(fe[re],be[re]);if(E)if(X)for(fe=fe||Mr(w),be=be||Mr(xe),re=0,ce=fe.length;re<ce;re++)Ca(fe[re],be[re]);else Ca(w,xe);return(be=Mr(xe,"script")).length>0&&Si(be,!Me&&Mr(w,"script")),xe},cleanData:function(w){for(var E,X,re,ce=c.event.special,fe=0;(X=w[fe])!==void 0;fe++)if(Qt(X)){if(E=X[Be.expando]){if(E.events)for(re in E.events)ce[re]?c.event.remove(X,re):c.removeEvent(X,re,E.handle);X[Be.expando]=void 0}X[Wt.expando]&&(X[Wt.expando]=void 0)}}}),c.fn.extend({detach:function(w){return Co(this,w,!0)},remove:function(w){return Co(this,w)},text:function(w){return Je(this,function(E){return E===void 0?c.text(this):this.empty().each(function(){this.nodeType!==1&&this.nodeType!==11&&this.nodeType!==9||(this.textContent=E)})},null,w,arguments.length)},append:function(){return Sa(this,arguments,function(w){this.nodeType!==1&&this.nodeType!==11&&this.nodeType!==9||Zi(this,w).appendChild(w)})},prepend:function(){return Sa(this,arguments,function(w){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var E=Zi(this,w);E.insertBefore(w,E.firstChild)}})},before:function(){return Sa(this,arguments,function(w){this.parentNode&&this.parentNode.insertBefore(w,this)})},after:function(){return Sa(this,arguments,function(w){this.parentNode&&this.parentNode.insertBefore(w,this.nextSibling)})},empty:function(){for(var w,E=0;(w=this[E])!=null;E++)w.nodeType===1&&(c.cleanData(Mr(w,!1)),w.textContent="");return this},clone:function(w,E){return w=w!=null&&w,E=E??w,this.map(function(){return c.clone(this,w,E)})},html:function(w){return Je(this,function(E){var X=this[0]||{},re=0,ce=this.length;if(E===void 0&&X.nodeType===1)return X.innerHTML;if(typeof E=="string"&&!Lr.test(E)&&!pr[(En.exec(E)||["",""])[1].toLowerCase()]){E=c.htmlPrefilter(E);try{for(;re<ce;re++)(X=this[re]||{}).nodeType===1&&(c.cleanData(Mr(X,!1)),X.innerHTML=E);X=0}catch{}}X&&this.empty().append(E)},null,w,arguments.length)},replaceWith:function(){var w=[];return Sa(this,arguments,function(E){var X=this.parentNode;c.inArray(this,w)<0&&(c.cleanData(Mr(this)),X&&X.replaceChild(E,this))},w)}}),c.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(w,E){c.fn[w]=function(X){for(var re,ce=[],fe=c(X),be=fe.length-1,xe=0;xe<=be;xe++)re=xe===be?this:this.clone(!0),c(fe[xe])[E](re),G.apply(ce,re.get());return this.pushStack(ce)}});var Vi=new RegExp("^("+rt+")(?!px)[a-z%]+$","i"),Wa=/^--/,Ki=function(w){var E=w.ownerDocument.defaultView;return E&&E.opener||(E=a),E.getComputedStyle(w)},ja=function(w,E,X){var re,ce,fe={};for(ce in E)fe[ce]=w.style[ce],w.style[ce]=E[ce];for(ce in re=X.call(w),E)w.style[ce]=fe[ce];return re},Ja=new RegExp(bn.join("|"),"i");function ra(w,E,X){var re,ce,fe,be,xe=Wa.test(E),Me=w.style;return(X=X||Ki(w))&&(be=X.getPropertyValue(E)||X[E],xe&&be&&(be=be.replace(Z,"$1")||void 0),be!==""||Zn(w)||(be=c.style(w,E)),!A.pixelBoxStyles()&&Vi.test(be)&&Ja.test(E)&&(re=Me.width,ce=Me.minWidth,fe=Me.maxWidth,Me.minWidth=Me.maxWidth=Me.width=be,be=X.width,Me.width=re,Me.minWidth=ce,Me.maxWidth=fe)),be!==void 0?be+"":be}function go(w,E){return{get:function(){if(!w())return(this.get=E).apply(this,arguments);delete this.get}}}(function(){function w(){if(Ne){Me.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",Ne.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Kt.appendChild(Me).appendChild(Ne);var Qe=a.getComputedStyle(Ne);X=Qe.top!=="1%",xe=E(Qe.marginLeft)===12,Ne.style.right="60%",fe=E(Qe.right)===36,re=E(Qe.width)===36,Ne.style.position="absolute",ce=E(Ne.offsetWidth/3)===12,Kt.removeChild(Me),Ne=null}}function E(Qe){return Math.round(parseFloat(Qe))}var X,re,ce,fe,be,xe,Me=W.createElement("div"),Ne=W.createElement("div");Ne.style&&(Ne.style.backgroundClip="content-box",Ne.cloneNode(!0).style.backgroundClip="",A.clearCloneStyle=Ne.style.backgroundClip==="content-box",c.extend(A,{boxSizingReliable:function(){return w(),re},pixelBoxStyles:function(){return w(),fe},pixelPosition:function(){return w(),X},reliableMarginLeft:function(){return w(),xe},scrollboxSize:function(){return w(),ce},reliableTrDimensions:function(){var Qe,ht,lt,Ot;return be==null&&(Qe=W.createElement("table"),ht=W.createElement("tr"),lt=W.createElement("div"),Qe.style.cssText="position:absolute;left:-11111px;border-collapse:separate",ht.style.cssText="box-sizing:content-box;border:1px solid",ht.style.height="1px",lt.style.height="9px",lt.style.display="block",Kt.appendChild(Qe).appendChild(ht).appendChild(lt),Ot=a.getComputedStyle(ht),be=parseInt(Ot.height,10)+parseInt(Ot.borderTopWidth,10)+parseInt(Ot.borderBottomWidth,10)===ht.offsetHeight,Kt.removeChild(Qe)),be}}))})();var ia=["Webkit","Moz","ms"],So=W.createElement("div").style,aa={};function Oi(w){return c.cssProps[w]||aa[w]||(w in So?w:aa[w]=function(E){for(var X=E[0].toUpperCase()+E.slice(1),re=ia.length;re--;)if((E=ia[re]+X)in So)return E}(w)||w)}var zr=/^(none|table(?!-c[ea]).+)/,Sr={position:"absolute",visibility:"hidden",display:"block"},xa={letterSpacing:"0",fontWeight:"400"};function Da(w,E,X){var re=Zt.exec(E);return re?Math.max(0,re[2]-(X||0))+(re[3]||"px"):E}function Do(w,E,X,re,ce,fe){var be=E==="width"?1:0,xe=0,Me=0,Ne=0;if(X===(re?"border":"content"))return 0;for(;be<4;be+=2)X==="margin"&&(Ne+=c.css(w,X+bn[be],!0,ce)),re?(X==="content"&&(Me-=c.css(w,"padding"+bn[be],!0,ce)),X!=="margin"&&(Me-=c.css(w,"border"+bn[be]+"Width",!0,ce))):(Me+=c.css(w,"padding"+bn[be],!0,ce),X!=="padding"?Me+=c.css(w,"border"+bn[be]+"Width",!0,ce):xe+=c.css(w,"border"+bn[be]+"Width",!0,ce));return!re&&fe>=0&&(Me+=Math.max(0,Math.ceil(w["offset"+E[0].toUpperCase()+E.slice(1)]-fe-Me-xe-.5))||0),Me+Ne}function ro(w,E,X){var re=Ki(w),ce=(!A.boxSizingReliable()||X)&&c.css(w,"boxSizing",!1,re)==="border-box",fe=ce,be=ra(w,E,re),xe="offset"+E[0].toUpperCase()+E.slice(1);if(Vi.test(be)){if(!X)return be;be="auto"}return(!A.boxSizingReliable()&&ce||!A.reliableTrDimensions()&&m(w,"tr")||be==="auto"||!parseFloat(be)&&c.css(w,"display",!1,re)==="inline")&&w.getClientRects().length&&(ce=c.css(w,"boxSizing",!1,re)==="border-box",(fe=xe in w)&&(be=w[xe])),(be=parseFloat(be)||0)+Do(w,E,X||(ce?"border":"content"),fe,re,be)+"px"}function ui(w,E,X,re,ce){return new ui.prototype.init(w,E,X,re,ce)}c.extend({cssHooks:{opacity:{get:function(w,E){if(E){var X=ra(w,"opacity");return X===""?"1":X}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(w,E,X,re){if(w&&w.nodeType!==3&&w.nodeType!==8&&w.style){var ce,fe,be,xe=Yt(E),Me=Wa.test(E),Ne=w.style;if(Me||(E=Oi(xe)),be=c.cssHooks[E]||c.cssHooks[xe],X===void 0)return be&&"get"in be&&(ce=be.get(w,!1,re))!==void 0?ce:Ne[E];(fe=typeof X)=="string"&&(ce=Zt.exec(X))&&ce[1]&&(X=Xe(w,E,ce),fe="number"),X!=null&&X==X&&(fe!=="number"||Me||(X+=ce&&ce[3]||(c.cssNumber[xe]?"":"px")),A.clearCloneStyle||X!==""||E.indexOf("background")!==0||(Ne[E]="inherit"),be&&"set"in be&&(X=be.set(w,X,re))===void 0||(Me?Ne.setProperty(E,X):Ne[E]=X))}},css:function(w,E,X,re){var ce,fe,be,xe=Yt(E);return Wa.test(E)||(E=Oi(xe)),(be=c.cssHooks[E]||c.cssHooks[xe])&&"get"in be&&(ce=be.get(w,!0,X)),ce===void 0&&(ce=ra(w,E,re)),ce==="normal"&&E in xa&&(ce=xa[E]),X===""||X?(fe=parseFloat(ce),X===!0||isFinite(fe)?fe||0:ce):ce}}),c.each(["height","width"],function(w,E){c.cssHooks[E]={get:function(X,re,ce){if(re)return!zr.test(c.css(X,"display"))||X.getClientRects().length&&X.getBoundingClientRect().width?ro(X,E,ce):ja(X,Sr,function(){return ro(X,E,ce)})},set:function(X,re,ce){var fe,be=Ki(X),xe=!A.scrollboxSize()&&be.position==="absolute",Me=(xe||ce)&&c.css(X,"boxSizing",!1,be)==="border-box",Ne=ce?Do(X,E,ce,Me,be):0;return Me&&xe&&(Ne-=Math.ceil(X["offset"+E[0].toUpperCase()+E.slice(1)]-parseFloat(be[E])-Do(X,E,"border",!1,be)-.5)),Ne&&(fe=Zt.exec(re))&&(fe[3]||"px")!=="px"&&(X.style[E]=re,re=c.css(X,E)),Da(0,re,Ne)}}}),c.cssHooks.marginLeft=go(A.reliableMarginLeft,function(w,E){if(E)return(parseFloat(ra(w,"marginLeft"))||w.getBoundingClientRect().left-ja(w,{marginLeft:0},function(){return w.getBoundingClientRect().left}))+"px"}),c.each({margin:"",padding:"",border:"Width"},function(w,E){c.cssHooks[w+E]={expand:function(X){for(var re=0,ce={},fe=typeof X=="string"?X.split(" "):[X];re<4;re++)ce[w+bn[re]+E]=fe[re]||fe[re-2]||fe[0];return ce}},w!=="margin"&&(c.cssHooks[w+E].set=Da)}),c.fn.extend({css:function(w,E){return Je(this,function(X,re,ce){var fe,be,xe={},Me=0;if(Array.isArray(re)){for(fe=Ki(X),be=re.length;Me<be;Me++)xe[re[Me]]=c.css(X,re[Me],!1,fe);return xe}return ce!==void 0?c.style(X,re,ce):c.css(X,re)},w,E,arguments.length>1)}}),c.Tween=ui,ui.prototype={constructor:ui,init:function(w,E,X,re,ce,fe){this.elem=w,this.prop=X,this.easing=ce||c.easing._default,this.options=E,this.start=this.now=this.cur(),this.end=re,this.unit=fe||(c.cssNumber[X]?"":"px")},cur:function(){var w=ui.propHooks[this.prop];return w&&w.get?w.get(this):ui.propHooks._default.get(this)},run:function(w){var E,X=ui.propHooks[this.prop];return this.options.duration?this.pos=E=c.easing[this.easing](w,this.options.duration*w,0,1,this.options.duration):this.pos=E=w,this.now=(this.end-this.start)*E+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),X&&X.set?X.set(this):ui.propHooks._default.set(this),this}},ui.prototype.init.prototype=ui.prototype,ui.propHooks={_default:{get:function(w){var E;return w.elem.nodeType!==1||w.elem[w.prop]!=null&&w.elem.style[w.prop]==null?w.elem[w.prop]:(E=c.css(w.elem,w.prop,""))&&E!=="auto"?E:0},set:function(w){c.fx.step[w.prop]?c.fx.step[w.prop](w):w.elem.nodeType!==1||!c.cssHooks[w.prop]&&w.elem.style[Oi(w.prop)]==null?w.elem[w.prop]=w.now:c.style(w.elem,w.prop,w.now+w.unit)}}},ui.propHooks.scrollTop=ui.propHooks.scrollLeft={set:function(w){w.elem.nodeType&&w.elem.parentNode&&(w.elem[w.prop]=w.now)}},c.easing={linear:function(w){return w},swing:function(w){return .5-Math.cos(w*Math.PI)/2},_default:"swing"},c.fx=ui.prototype.init,c.fx.step={};var kr,ee,Ce=/^(?:toggle|show|hide)$/,se=/queueHooks$/;function _e(){ee&&(W.hidden===!1&&a.requestAnimationFrame?a.requestAnimationFrame(_e):a.setTimeout(_e,c.fx.interval),c.fx.tick())}function Ke(){return a.setTimeout(function(){kr=void 0}),kr=Date.now()}function mt(w,E){var X,re=0,ce={height:w};for(E=E?1:0;re<4;re+=2-E)ce["margin"+(X=bn[re])]=ce["padding"+X]=w;return E&&(ce.opacity=ce.width=w),ce}function It(w,E,X){for(var re,ce=(Gt.tweeners[E]||[]).concat(Gt.tweeners["*"]),fe=0,be=ce.length;fe<be;fe++)if(re=ce[fe].call(X,E,w))return re}function Gt(w,E,X){var re,ce,fe=0,be=Gt.prefilters.length,xe=c.Deferred().always(function(){delete Me.elem}),Me=function(){if(ce)return!1;for(var ht=kr||Ke(),lt=Math.max(0,Ne.startTime+Ne.duration-ht),Ot=1-(lt/Ne.duration||0),Pn=0,_n=Ne.tweens.length;Pn<_n;Pn++)Ne.tweens[Pn].run(Ot);return xe.notifyWith(w,[Ne,Ot,lt]),Ot<1&&_n?lt:(_n||xe.notifyWith(w,[Ne,1,0]),xe.resolveWith(w,[Ne]),!1)},Ne=xe.promise({elem:w,props:c.extend({},E),opts:c.extend(!0,{specialEasing:{},easing:c.easing._default},X),originalProperties:E,originalOptions:X,startTime:kr||Ke(),duration:X.duration,tweens:[],createTween:function(ht,lt){var Ot=c.Tween(w,Ne.opts,ht,lt,Ne.opts.specialEasing[ht]||Ne.opts.easing);return Ne.tweens.push(Ot),Ot},stop:function(ht){var lt=0,Ot=ht?Ne.tweens.length:0;if(ce)return this;for(ce=!0;lt<Ot;lt++)Ne.tweens[lt].run(1);return ht?(xe.notifyWith(w,[Ne,1,0]),xe.resolveWith(w,[Ne,ht])):xe.rejectWith(w,[Ne,ht]),this}}),Qe=Ne.props;for(function(ht,lt){var Ot,Pn,_n,Xn,ni;for(Ot in ht)if(_n=lt[Pn=Yt(Ot)],Xn=ht[Ot],Array.isArray(Xn)&&(_n=Xn[1],Xn=ht[Ot]=Xn[0]),Ot!==Pn&&(ht[Pn]=Xn,delete ht[Ot]),(ni=c.cssHooks[Pn])&&"expand"in ni)for(Ot in Xn=ni.expand(Xn),delete ht[Pn],Xn)Ot in ht||(ht[Ot]=Xn[Ot],lt[Ot]=_n);else lt[Pn]=_n}(Qe,Ne.opts.specialEasing);fe<be;fe++)if(re=Gt.prefilters[fe].call(Ne,w,Qe,Ne.opts))return S(re.stop)&&(c._queueHooks(Ne.elem,Ne.opts.queue).stop=re.stop.bind(re)),re;return c.map(Qe,It,Ne),S(Ne.opts.start)&&Ne.opts.start.call(w,Ne),Ne.progress(Ne.opts.progress).done(Ne.opts.done,Ne.opts.complete).fail(Ne.opts.fail).always(Ne.opts.always),c.fx.timer(c.extend(Me,{elem:w,anim:Ne,queue:Ne.opts.queue})),Ne}c.Animation=c.extend(Gt,{tweeners:{"*":[function(w,E){var X=this.createTween(w,E);return Xe(X.elem,w,Zt.exec(E),X),X}]},tweener:function(w,E){S(w)?(E=w,w=["*"]):w=w.match(le);for(var X,re=0,ce=w.length;re<ce;re++)X=w[re],Gt.tweeners[X]=Gt.tweeners[X]||[],Gt.tweeners[X].unshift(E)},prefilters:[function(w,E,X){var re,ce,fe,be,xe,Me,Ne,Qe,ht="width"in E||"height"in E,lt=this,Ot={},Pn=w.style,_n=w.nodeType&&Cr(w),Xn=Be.get(w,"fxshow");for(re in X.queue||((be=c._queueHooks(w,"fx")).unqueued==null&&(be.unqueued=0,xe=be.empty.fire,be.empty.fire=function(){be.unqueued||xe()}),be.unqueued++,lt.always(function(){lt.always(function(){be.unqueued--,c.queue(w,"fx").length||be.empty.fire()})})),E)if(ce=E[re],Ce.test(ce)){if(delete E[re],fe=fe||ce==="toggle",ce===(_n?"hide":"show")){if(ce!=="show"||!Xn||Xn[re]===void 0)continue;_n=!0}Ot[re]=Xn&&Xn[re]||c.style(w,re)}if((Me=!c.isEmptyObject(E))||!c.isEmptyObject(Ot))for(re in ht&&w.nodeType===1&&(X.overflow=[Pn.overflow,Pn.overflowX,Pn.overflowY],(Ne=Xn&&Xn.display)==null&&(Ne=Be.get(w,"display")),(Qe=c.css(w,"display"))==="none"&&(Ne?Qe=Ne:(Re([w],!0),Ne=w.style.display||Ne,Qe=c.css(w,"display"),Re([w]))),(Qe==="inline"||Qe==="inline-block"&&Ne!=null)&&c.css(w,"float")==="none"&&(Me||(lt.done(function(){Pn.display=Ne}),Ne==null&&(Qe=Pn.display,Ne=Qe==="none"?"":Qe)),Pn.display="inline-block")),X.overflow&&(Pn.overflow="hidden",lt.always(function(){Pn.overflow=X.overflow[0],Pn.overflowX=X.overflow[1],Pn.overflowY=X.overflow[2]})),Me=!1,Ot)Me||(Xn?"hidden"in Xn&&(_n=Xn.hidden):Xn=Be.access(w,"fxshow",{display:Ne}),fe&&(Xn.hidden=!_n),_n&&Re([w],!0),lt.done(function(){for(re in _n||Re([w]),Be.remove(w,"fxshow"),Ot)c.style(w,re,Ot[re])})),Me=It(_n?Xn[re]:0,re,lt),re in Xn||(Xn[re]=Me.start,_n&&(Me.end=Me.start,Me.start=0))}],prefilter:function(w,E){E?Gt.prefilters.unshift(w):Gt.prefilters.push(w)}}),c.speed=function(w,E,X){var re=w&&typeof w=="object"?c.extend({},w):{complete:X||!X&&E||S(w)&&w,duration:w,easing:X&&E||E&&!S(E)&&E};return c.fx.off?re.duration=0:typeof re.duration!="number"&&(re.duration in c.fx.speeds?re.duration=c.fx.speeds[re.duration]:re.duration=c.fx.speeds._default),re.queue!=null&&re.queue!==!0||(re.queue="fx"),re.old=re.complete,re.complete=function(){S(re.old)&&re.old.call(this),re.queue&&c.dequeue(this,re.queue)},re},c.fn.extend({fadeTo:function(w,E,X,re){return this.filter(Cr).css("opacity",0).show().end().animate({opacity:E},w,X,re)},animate:function(w,E,X,re){var ce=c.isEmptyObject(w),fe=c.speed(E,X,re),be=function(){var xe=Gt(this,c.extend({},w),fe);(ce||Be.get(this,"finish"))&&xe.stop(!0)};return be.finish=be,ce||fe.queue===!1?this.each(be):this.queue(fe.queue,be)},stop:function(w,E,X){var re=function(ce){var fe=ce.stop;delete ce.stop,fe(X)};return typeof w!="string"&&(X=E,E=w,w=void 0),E&&this.queue(w||"fx",[]),this.each(function(){var ce=!0,fe=w!=null&&w+"queueHooks",be=c.timers,xe=Be.get(this);if(fe)xe[fe]&&xe[fe].stop&&re(xe[fe]);else for(fe in xe)xe[fe]&&xe[fe].stop&&se.test(fe)&&re(xe[fe]);for(fe=be.length;fe--;)be[fe].elem!==this||w!=null&&be[fe].queue!==w||(be[fe].anim.stop(X),ce=!1,be.splice(fe,1));!ce&&X||c.dequeue(this,w)})},finish:function(w){return w!==!1&&(w=w||"fx"),this.each(function(){var E,X=Be.get(this),re=X[w+"queue"],ce=X[w+"queueHooks"],fe=c.timers,be=re?re.length:0;for(X.finish=!0,c.queue(this,w,[]),ce&&ce.stop&&ce.stop.call(this,!0),E=fe.length;E--;)fe[E].elem===this&&fe[E].queue===w&&(fe[E].anim.stop(!0),fe.splice(E,1));for(E=0;E<be;E++)re[E]&&re[E].finish&&re[E].finish.call(this);delete X.finish})}}),c.each(["toggle","show","hide"],function(w,E){var X=c.fn[E];c.fn[E]=function(re,ce,fe){return re==null||typeof re=="boolean"?X.apply(this,arguments):this.animate(mt(E,!0),re,ce,fe)}}),c.each({slideDown:mt("show"),slideUp:mt("hide"),slideToggle:mt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(w,E){c.fn[w]=function(X,re,ce){return this.animate(E,X,re,ce)}}),c.timers=[],c.fx.tick=function(){var w,E=0,X=c.timers;for(kr=Date.now();E<X.length;E++)(w=X[E])()||X[E]!==w||X.splice(E--,1);X.length||c.fx.stop(),kr=void 0},c.fx.timer=function(w){c.timers.push(w),c.fx.start()},c.fx.interval=13,c.fx.start=function(){ee||(ee=!0,_e())},c.fx.stop=function(){ee=null},c.fx.speeds={slow:600,fast:200,_default:400},c.fn.delay=function(w,E){return w=c.fx&&c.fx.speeds[w]||w,E=E||"fx",this.queue(E,function(X,re){var ce=a.setTimeout(X,w);re.stop=function(){a.clearTimeout(ce)}})},function(){var w=W.createElement("input"),E=W.createElement("select").appendChild(W.createElement("option"));w.type="checkbox",A.checkOn=w.value!=="",A.optSelected=E.selected,(w=W.createElement("input")).value="t",w.type="radio",A.radioValue=w.value==="t"}();var Mn,Vn=c.expr.attrHandle;c.fn.extend({attr:function(w,E){return Je(this,c.attr,w,E,arguments.length>1)},removeAttr:function(w){return this.each(function(){c.removeAttr(this,w)})}}),c.extend({attr:function(w,E,X){var re,ce,fe=w.nodeType;if(fe!==3&&fe!==8&&fe!==2)return w.getAttribute===void 0?c.prop(w,E,X):(fe===1&&c.isXMLDoc(w)||(ce=c.attrHooks[E.toLowerCase()]||(c.expr.match.bool.test(E)?Mn:void 0)),X!==void 0?X===null?void c.removeAttr(w,E):ce&&"set"in ce&&(re=ce.set(w,X,E))!==void 0?re:(w.setAttribute(E,X+""),X):ce&&"get"in ce&&(re=ce.get(w,E))!==null?re:(re=c.find.attr(w,E))==null?void 0:re)},attrHooks:{type:{set:function(w,E){if(!A.radioValue&&E==="radio"&&m(w,"input")){var X=w.value;return w.setAttribute("type",E),X&&(w.value=X),E}}}},removeAttr:function(w,E){var X,re=0,ce=E&&E.match(le);if(ce&&w.nodeType===1)for(;X=ce[re++];)w.removeAttribute(X)}}),Mn={set:function(w,E,X){return E===!1?c.removeAttr(w,X):w.setAttribute(X,X),X}},c.each(c.expr.match.bool.source.match(/\w+/g),function(w,E){var X=Vn[E]||c.find.attr;Vn[E]=function(re,ce,fe){var be,xe,Me=ce.toLowerCase();return fe||(xe=Vn[Me],Vn[Me]=be,be=X(re,ce,fe)!=null?Me:null,Vn[Me]=xe),be}});var qn=/^(?:input|select|textarea|button)$/i,$r=/^(?:a|area)$/i;function ha(w){return(w.match(le)||[]).join(" ")}function wi(w){return w.getAttribute&&w.getAttribute("class")||""}function hs(w){return Array.isArray(w)?w:typeof w=="string"&&w.match(le)||[]}c.fn.extend({prop:function(w,E){return Je(this,c.prop,w,E,arguments.length>1)},removeProp:function(w){return this.each(function(){delete this[c.propFix[w]||w]})}}),c.extend({prop:function(w,E,X){var re,ce,fe=w.nodeType;if(fe!==3&&fe!==8&&fe!==2)return fe===1&&c.isXMLDoc(w)||(E=c.propFix[E]||E,ce=c.propHooks[E]),X!==void 0?ce&&"set"in ce&&(re=ce.set(w,X,E))!==void 0?re:w[E]=X:ce&&"get"in ce&&(re=ce.get(w,E))!==null?re:w[E]},propHooks:{tabIndex:{get:function(w){var E=c.find.attr(w,"tabindex");return E?parseInt(E,10):qn.test(w.nodeName)||$r.test(w.nodeName)&&w.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),A.optSelected||(c.propHooks.selected={get:function(w){var E=w.parentNode;return E&&E.parentNode&&E.parentNode.selectedIndex,null},set:function(w){var E=w.parentNode;E&&(E.selectedIndex,E.parentNode&&E.parentNode.selectedIndex)}}),c.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){c.propFix[this.toLowerCase()]=this}),c.fn.extend({addClass:function(w){var E,X,re,ce,fe,be;return S(w)?this.each(function(xe){c(this).addClass(w.call(this,xe,wi(this)))}):(E=hs(w)).length?this.each(function(){if(re=wi(this),X=this.nodeType===1&&" "+ha(re)+" "){for(fe=0;fe<E.length;fe++)ce=E[fe],X.indexOf(" "+ce+" ")<0&&(X+=ce+" ");be=ha(X),re!==be&&this.setAttribute("class",be)}}):this},removeClass:function(w){var E,X,re,ce,fe,be;return S(w)?this.each(function(xe){c(this).removeClass(w.call(this,xe,wi(this)))}):arguments.length?(E=hs(w)).length?this.each(function(){if(re=wi(this),X=this.nodeType===1&&" "+ha(re)+" "){for(fe=0;fe<E.length;fe++)for(ce=E[fe];X.indexOf(" "+ce+" ")>-1;)X=X.replace(" "+ce+" "," ");be=ha(X),re!==be&&this.setAttribute("class",be)}}):this:this.attr("class","")},toggleClass:function(w,E){var X,re,ce,fe,be=typeof w,xe=be==="string"||Array.isArray(w);return S(w)?this.each(function(Me){c(this).toggleClass(w.call(this,Me,wi(this),E),E)}):typeof E=="boolean"&&xe?E?this.addClass(w):this.removeClass(w):(X=hs(w),this.each(function(){if(xe)for(fe=c(this),ce=0;ce<X.length;ce++)re=X[ce],fe.hasClass(re)?fe.removeClass(re):fe.addClass(re);else w!==void 0&&be!=="boolean"||((re=wi(this))&&Be.set(this,"__className__",re),this.setAttribute&&this.setAttribute("class",re||w===!1?"":Be.get(this,"__className__")||""))}))},hasClass:function(w){var E,X,re=0;for(E=" "+w+" ";X=this[re++];)if(X.nodeType===1&&(" "+ha(wi(X))+" ").indexOf(E)>-1)return!0;return!1}});var io=/\r/g;c.fn.extend({val:function(w){var E,X,re,ce=this[0];return arguments.length?(re=S(w),this.each(function(fe){var be;this.nodeType===1&&((be=re?w.call(this,fe,c(this).val()):w)==null?be="":typeof be=="number"?be+="":Array.isArray(be)&&(be=c.map(be,function(xe){return xe==null?"":xe+""})),(E=c.valHooks[this.type]||c.valHooks[this.nodeName.toLowerCase()])&&"set"in E&&E.set(this,be,"value")!==void 0||(this.value=be))})):ce?(E=c.valHooks[ce.type]||c.valHooks[ce.nodeName.toLowerCase()])&&"get"in E&&(X=E.get(ce,"value"))!==void 0?X:typeof(X=ce.value)=="string"?X.replace(io,""):X??"":void 0}}),c.extend({valHooks:{option:{get:function(w){var E=c.find.attr(w,"value");return E??ha(c.text(w))}},select:{get:function(w){var E,X,re,ce=w.options,fe=w.selectedIndex,be=w.type==="select-one",xe=be?null:[],Me=be?fe+1:ce.length;for(re=fe<0?Me:be?fe:0;re<Me;re++)if(((X=ce[re]).selected||re===fe)&&!X.disabled&&(!X.parentNode.disabled||!m(X.parentNode,"optgroup"))){if(E=c(X).val(),be)return E;xe.push(E)}return xe},set:function(w,E){for(var X,re,ce=w.options,fe=c.makeArray(E),be=ce.length;be--;)((re=ce[be]).selected=c.inArray(c.valHooks.option.get(re),fe)>-1)&&(X=!0);return X||(w.selectedIndex=-1),fe}}}}),c.each(["radio","checkbox"],function(){c.valHooks[this]={set:function(w,E){if(Array.isArray(E))return w.checked=c.inArray(c(w).val(),E)>-1}},A.checkOn||(c.valHooks[this].get=function(w){return w.getAttribute("value")===null?"on":w.value})});var ao=a.location,Di={guid:Date.now()},Qr=/\?/;c.parseXML=function(w){var E,X;if(!w||typeof w!="string")return null;try{E=new a.DOMParser().parseFromString(w,"text/xml")}catch{}return X=E&&E.getElementsByTagName("parsererror")[0],E&&!X||c.error("Invalid XML: "+(X?c.map(X.childNodes,function(re){return re.textContent}).join(`
`):w)),E};var Fi=/^(?:focusinfocus|focusoutblur)$/,Uo=function(w){w.stopPropagation()};c.extend(c.event,{trigger:function(w,E,X,re){var ce,fe,be,xe,Me,Ne,Qe,ht,lt=[X||W],Ot=C.call(w,"type")?w.type:w,Pn=C.call(w,"namespace")?w.namespace.split("."):[];if(fe=ht=be=X=X||W,X.nodeType!==3&&X.nodeType!==8&&!Fi.test(Ot+c.event.triggered)&&(Ot.indexOf(".")>-1&&(Ot=(Pn=Ot.split(".")).shift(),Pn.sort()),Me=Ot.indexOf(":")<0&&"on"+Ot,(w=w[c.expando]?w:new c.Event(Ot,typeof w=="object"&&w)).isTrigger=re?2:3,w.namespace=Pn.join("."),w.rnamespace=w.namespace?new RegExp("(^|\\.)"+Pn.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,w.result=void 0,w.target||(w.target=X),E=E==null?[w]:c.makeArray(E,[w]),Qe=c.event.special[Ot]||{},re||!Qe.trigger||Qe.trigger.apply(X,E)!==!1)){if(!re&&!Qe.noBubble&&!q(X)){for(xe=Qe.delegateType||Ot,Fi.test(xe+Ot)||(fe=fe.parentNode);fe;fe=fe.parentNode)lt.push(fe),be=fe;be===(X.ownerDocument||W)&&lt.push(be.defaultView||be.parentWindow||a)}for(ce=0;(fe=lt[ce++])&&!w.isPropagationStopped();)ht=fe,w.type=ce>1?xe:Qe.bindType||Ot,(Ne=(Be.get(fe,"events")||Object.create(null))[w.type]&&Be.get(fe,"handle"))&&Ne.apply(fe,E),(Ne=Me&&fe[Me])&&Ne.apply&&Qt(fe)&&(w.result=Ne.apply(fe,E),w.result===!1&&w.preventDefault());return w.type=Ot,re||w.isDefaultPrevented()||Qe._default&&Qe._default.apply(lt.pop(),E)!==!1||!Qt(X)||Me&&S(X[Ot])&&!q(X)&&((be=X[Me])&&(X[Me]=null),c.event.triggered=Ot,w.isPropagationStopped()&&ht.addEventListener(Ot,Uo),X[Ot](),w.isPropagationStopped()&&ht.removeEventListener(Ot,Uo),c.event.triggered=void 0,be&&(X[Me]=be)),w.result}},simulate:function(w,E,X){var re=c.extend(new c.Event,X,{type:w,isSimulated:!0});c.event.trigger(re,null,E)}}),c.fn.extend({trigger:function(w,E){return this.each(function(){c.event.trigger(w,E,this)})},triggerHandler:function(w,E){var X=this[0];if(X)return c.event.trigger(w,E,X,!0)}});var Cn=/\[\]$/,ps=/\r?\n/g,Zl=/^(?:submit|button|image|reset|file)$/i,dl=/^(?:input|select|textarea|keygen)/i;function qa(w,E,X,re){var ce;if(Array.isArray(E))c.each(E,function(fe,be){X||Cn.test(w)?re(w,be):qa(w+"["+(typeof be=="object"&&be!=null?fe:"")+"]",be,X,re)});else if(X||v(E)!=="object")re(w,E);else for(ce in E)qa(w+"["+ce+"]",E[ce],X,re)}c.param=function(w,E){var X,re=[],ce=function(fe,be){var xe=S(be)?be():be;re[re.length]=encodeURIComponent(fe)+"="+encodeURIComponent(xe??"")};if(w==null)return"";if(Array.isArray(w)||w.jquery&&!c.isPlainObject(w))c.each(w,function(){ce(this.name,this.value)});else for(X in w)qa(X,w[X],E,ce);return re.join("&")},c.fn.extend({serialize:function(){return c.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var w=c.prop(this,"elements");return w?c.makeArray(w):this}).filter(function(){var w=this.type;return this.name&&!c(this).is(":disabled")&&dl.test(this.nodeName)&&!Zl.test(w)&&(this.checked||!Lt.test(w))}).map(function(w,E){var X=c(this).val();return X==null?null:Array.isArray(X)?c.map(X,function(re){return{name:E.name,value:re.replace(ps,`\r
`)}}):{name:E.name,value:X.replace(ps,`\r
`)}}).get()}});var ds=/%20/g,rr=/#.*$/,Xa=/([?&])_=[^&]*/,qr=/^(.*?):[ \t]*([^\r\n]*)$/gm,$n=/^(?:GET|HEAD)$/,fs=/^\/\//,ms={},Eo={},Ho="*/".concat("*"),yo=W.createElement("a");function $i(w){return function(E,X){typeof E!="string"&&(X=E,E="*");var re,ce=0,fe=E.toLowerCase().match(le)||[];if(S(X))for(;re=fe[ce++];)re[0]==="+"?(re=re.slice(1)||"*",(w[re]=w[re]||[]).unshift(X)):(w[re]=w[re]||[]).push(X)}}function vo(w,E,X,re){var ce={},fe=w===Eo;function be(xe){var Me;return ce[xe]=!0,c.each(w[xe]||[],function(Ne,Qe){var ht=Qe(E,X,re);return typeof ht!="string"||fe||ce[ht]?fe?!(Me=ht):void 0:(E.dataTypes.unshift(ht),be(ht),!1)}),Me}return be(E.dataTypes[0])||!ce["*"]&&be("*")}function ln(w,E){var X,re,ce=c.ajaxSettings.flatOptions||{};for(X in E)E[X]!==void 0&&((ce[X]?w:re||(re={}))[X]=E[X]);return re&&c.extend(!0,w,re),w}yo.href=ao.href,c.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ao.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(ao.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ho,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":c.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(w,E){return E?ln(ln(w,c.ajaxSettings),E):ln(c.ajaxSettings,w)},ajaxPrefilter:$i(ms),ajaxTransport:$i(Eo),ajax:function(w,E){typeof w=="object"&&(E=w,w=void 0),E=E||{};var X,re,ce,fe,be,xe,Me,Ne,Qe,ht,lt=c.ajaxSetup({},E),Ot=lt.context||lt,Pn=lt.context&&(Ot.nodeType||Ot.jquery)?c(Ot):c.event,_n=c.Deferred(),Xn=c.Callbacks("once memory"),ni=lt.statusCode||{},Nr={},oa={},Vr="canceled",vr={readyState:0,getResponseHeader:function(Ar){var Fn;if(Me){if(!fe)for(fe={};Fn=qr.exec(ce);)fe[Fn[1].toLowerCase()+" "]=(fe[Fn[1].toLowerCase()+" "]||[]).concat(Fn[2]);Fn=fe[Ar.toLowerCase()+" "]}return Fn==null?null:Fn.join(", ")},getAllResponseHeaders:function(){return Me?ce:null},setRequestHeader:function(Ar,Fn){return Me==null&&(Ar=oa[Ar.toLowerCase()]=oa[Ar.toLowerCase()]||Ar,Nr[Ar]=Fn),this},overrideMimeType:function(Ar){return Me==null&&(lt.mimeType=Ar),this},statusCode:function(Ar){var Fn;if(Ar)if(Me)vr.always(Ar[vr.status]);else for(Fn in Ar)ni[Fn]=[ni[Fn],Ar[Fn]];return this},abort:function(Ar){var Fn=Ar||Vr;return X&&X.abort(Fn),Ea(0,Fn),this}};if(_n.promise(vr),lt.url=((w||lt.url||ao.href)+"").replace(fs,ao.protocol+"//"),lt.type=E.method||E.type||lt.method||lt.type,lt.dataTypes=(lt.dataType||"*").toLowerCase().match(le)||[""],lt.crossDomain==null){xe=W.createElement("a");try{xe.href=lt.url,xe.href=xe.href,lt.crossDomain=yo.protocol+"//"+yo.host!=xe.protocol+"//"+xe.host}catch{lt.crossDomain=!0}}if(lt.data&&lt.processData&&typeof lt.data!="string"&&(lt.data=c.param(lt.data,lt.traditional)),vo(ms,lt,E,vr),Me)return vr;for(Qe in(Ne=c.event&&lt.global)&&c.active++==0&&c.event.trigger("ajaxStart"),lt.type=lt.type.toUpperCase(),lt.hasContent=!$n.test(lt.type),re=lt.url.replace(rr,""),lt.hasContent?lt.data&&lt.processData&&(lt.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(lt.data=lt.data.replace(ds,"+")):(ht=lt.url.slice(re.length),lt.data&&(lt.processData||typeof lt.data=="string")&&(re+=(Qr.test(re)?"&":"?")+lt.data,delete lt.data),lt.cache===!1&&(re=re.replace(Xa,"$1"),ht=(Qr.test(re)?"&":"?")+"_="+Di.guid+++ht),lt.url=re+ht),lt.ifModified&&(c.lastModified[re]&&vr.setRequestHeader("If-Modified-Since",c.lastModified[re]),c.etag[re]&&vr.setRequestHeader("If-None-Match",c.etag[re])),(lt.data&&lt.hasContent&&lt.contentType!==!1||E.contentType)&&vr.setRequestHeader("Content-Type",lt.contentType),vr.setRequestHeader("Accept",lt.dataTypes[0]&&lt.accepts[lt.dataTypes[0]]?lt.accepts[lt.dataTypes[0]]+(lt.dataTypes[0]!=="*"?", "+Ho+"; q=0.01":""):lt.accepts["*"]),lt.headers)vr.setRequestHeader(Qe,lt.headers[Qe]);if(lt.beforeSend&&(lt.beforeSend.call(Ot,vr,lt)===!1||Me))return vr.abort();if(Vr="abort",Xn.add(lt.complete),vr.done(lt.success),vr.fail(lt.error),X=vo(Eo,lt,E,vr)){if(vr.readyState=1,Ne&&Pn.trigger("ajaxSend",[vr,lt]),Me)return vr;lt.async&&lt.timeout>0&&(be=a.setTimeout(function(){vr.abort("timeout")},lt.timeout));try{Me=!1,X.send(Nr,Ea)}catch(Ar){if(Me)throw Ar;Ea(-1,Ar)}}else Ea(-1,"No Transport");function Ea(Ar,Fn,Jo,qo){var kn,Xo,Aa,Pa,hi,Ri=Fn;Me||(Me=!0,be&&a.clearTimeout(be),X=void 0,ce=qo||"",vr.readyState=Ar>0?4:0,kn=Ar>=200&&Ar<300||Ar===304,Jo&&(Pa=function(Fr,Ur,Dr){for(var Oa,Ei,jn,ei,Zr=Fr.contents,Pr=Fr.dataTypes;Pr[0]==="*";)Pr.shift(),Oa===void 0&&(Oa=Fr.mimeType||Ur.getResponseHeader("Content-Type"));if(Oa){for(Ei in Zr)if(Zr[Ei]&&Zr[Ei].test(Oa)){Pr.unshift(Ei);break}}if(Pr[0]in Dr)jn=Pr[0];else{for(Ei in Dr){if(!Pr[0]||Fr.converters[Ei+" "+Pr[0]]){jn=Ei;break}ei||(ei=Ei)}jn=jn||ei}if(jn)return jn!==Pr[0]&&Pr.unshift(jn),Dr[jn]}(lt,vr,Jo)),!kn&&c.inArray("script",lt.dataTypes)>-1&&c.inArray("json",lt.dataTypes)<0&&(lt.converters["text script"]=function(){}),Pa=function(Fr,Ur,Dr,Oa){var Ei,jn,ei,Zr,Pr,en={},Yo=Fr.dataTypes.slice();if(Yo[1])for(ei in Fr.converters)en[ei.toLowerCase()]=Fr.converters[ei];for(jn=Yo.shift();jn;)if(Fr.responseFields[jn]&&(Dr[Fr.responseFields[jn]]=Ur),!Pr&&Oa&&Fr.dataFilter&&(Ur=Fr.dataFilter(Ur,Fr.dataType)),Pr=jn,jn=Yo.shift()){if(jn==="*")jn=Pr;else if(Pr!=="*"&&Pr!==jn){if(!(ei=en[Pr+" "+jn]||en["* "+jn])){for(Ei in en)if((Zr=Ei.split(" "))[1]===jn&&(ei=en[Pr+" "+Zr[0]]||en["* "+Zr[0]])){ei===!0?ei=en[Ei]:en[Ei]!==!0&&(jn=Zr[0],Yo.unshift(Zr[1]));break}}if(ei!==!0)if(ei&&Fr.throws)Ur=ei(Ur);else try{Ur=ei(Ur)}catch(Zo){return{state:"parsererror",error:ei?Zo:"No conversion from "+Pr+" to "+jn}}}}return{state:"success",data:Ur}}(lt,Pa,vr,kn),kn?(lt.ifModified&&((hi=vr.getResponseHeader("Last-Modified"))&&(c.lastModified[re]=hi),(hi=vr.getResponseHeader("etag"))&&(c.etag[re]=hi)),Ar===204||lt.type==="HEAD"?Ri="nocontent":Ar===304?Ri="notmodified":(Ri=Pa.state,Xo=Pa.data,kn=!(Aa=Pa.error))):(Aa=Ri,!Ar&&Ri||(Ri="error",Ar<0&&(Ar=0))),vr.status=Ar,vr.statusText=(Fn||Ri)+"",kn?_n.resolveWith(Ot,[Xo,Ri,vr]):_n.rejectWith(Ot,[vr,Ri,Aa]),vr.statusCode(ni),ni=void 0,Ne&&Pn.trigger(kn?"ajaxSuccess":"ajaxError",[vr,lt,kn?Xo:Aa]),Xn.fireWith(Ot,[vr,Ri]),Ne&&(Pn.trigger("ajaxComplete",[vr,lt]),--c.active||c.event.trigger("ajaxStop")))}return vr},getJSON:function(w,E,X){return c.get(w,E,X,"json")},getScript:function(w,E){return c.get(w,void 0,E,"script")}}),c.each(["get","post"],function(w,E){c[E]=function(X,re,ce,fe){return S(re)&&(fe=fe||ce,ce=re,re=void 0),c.ajax(c.extend({url:X,type:E,dataType:fe,data:re,success:ce},c.isPlainObject(X)&&X))}}),c.ajaxPrefilter(function(w){var E;for(E in w.headers)E.toLowerCase()==="content-type"&&(w.contentType=w.headers[E]||"")}),c._evalUrl=function(w,E,X){return c.ajax({url:w,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(re){c.globalEval(re,E,X)}})},c.fn.extend({wrapAll:function(w){var E;return this[0]&&(S(w)&&(w=w.call(this[0])),E=c(w,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&E.insertBefore(this[0]),E.map(function(){for(var X=this;X.firstElementChild;)X=X.firstElementChild;return X}).append(this)),this},wrapInner:function(w){return S(w)?this.each(function(E){c(this).wrapInner(w.call(this,E))}):this.each(function(){var E=c(this),X=E.contents();X.length?X.wrapAll(w):E.append(w)})},wrap:function(w){var E=S(w);return this.each(function(X){c(this).wrapAll(E?w.call(this,X):w)})},unwrap:function(w){return this.parent(w).not("body").each(function(){c(this).replaceWith(this.childNodes)}),this}}),c.expr.pseudos.hidden=function(w){return!c.expr.pseudos.visible(w)},c.expr.pseudos.visible=function(w){return!!(w.offsetWidth||w.offsetHeight||w.getClientRects().length)},c.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch{}};var ks={0:200,1223:204},Wo=c.ajaxSettings.xhr();A.cors=!!Wo&&"withCredentials"in Wo,A.ajax=Wo=!!Wo,c.ajaxTransport(function(w){var E,X;if(A.cors||Wo&&!w.crossDomain)return{send:function(re,ce){var fe,be=w.xhr();if(be.open(w.type,w.url,w.async,w.username,w.password),w.xhrFields)for(fe in w.xhrFields)be[fe]=w.xhrFields[fe];for(fe in w.mimeType&&be.overrideMimeType&&be.overrideMimeType(w.mimeType),w.crossDomain||re["X-Requested-With"]||(re["X-Requested-With"]="XMLHttpRequest"),re)be.setRequestHeader(fe,re[fe]);E=function(xe){return function(){E&&(E=X=be.onload=be.onerror=be.onabort=be.ontimeout=be.onreadystatechange=null,xe==="abort"?be.abort():xe==="error"?typeof be.status!="number"?ce(0,"error"):ce(be.status,be.statusText):ce(ks[be.status]||be.status,be.statusText,(be.responseType||"text")!=="text"||typeof be.responseText!="string"?{binary:be.response}:{text:be.responseText},be.getAllResponseHeaders()))}},be.onload=E(),X=be.onerror=be.ontimeout=E("error"),be.onabort!==void 0?be.onabort=X:be.onreadystatechange=function(){be.readyState===4&&a.setTimeout(function(){E&&X()})},E=E("abort");try{be.send(w.hasContent&&w.data||null)}catch(xe){if(E)throw xe}},abort:function(){E&&E()}}}),c.ajaxPrefilter(function(w){w.crossDomain&&(w.contents.script=!1)}),c.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(w){return c.globalEval(w),w}}}),c.ajaxPrefilter("script",function(w){w.cache===void 0&&(w.cache=!1),w.crossDomain&&(w.type="GET")}),c.ajaxTransport("script",function(w){var E,X;if(w.crossDomain||w.scriptAttrs)return{send:function(re,ce){E=c("<script>").attr(w.scriptAttrs||{}).prop({charset:w.scriptCharset,src:w.url}).on("load error",X=function(fe){E.remove(),X=null,fe&&ce(fe.type==="error"?404:200,fe.type)}),W.head.appendChild(E[0])},abort:function(){X&&X()}}});var Kl,iu=[],Na=/(=)\?(?=&|$)|\?\?/;c.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var w=iu.pop()||c.expando+"_"+Di.guid++;return this[w]=!0,w}}),c.ajaxPrefilter("json jsonp",function(w,E,X){var re,ce,fe,be=w.jsonp!==!1&&(Na.test(w.url)?"url":typeof w.data=="string"&&(w.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Na.test(w.data)&&"data");if(be||w.dataTypes[0]==="jsonp")return re=w.jsonpCallback=S(w.jsonpCallback)?w.jsonpCallback():w.jsonpCallback,be?w[be]=w[be].replace(Na,"$1"+re):w.jsonp!==!1&&(w.url+=(Qr.test(w.url)?"&":"?")+w.jsonp+"="+re),w.converters["script json"]=function(){return fe||c.error(re+" was not called"),fe[0]},w.dataTypes[0]="json",ce=a[re],a[re]=function(){fe=arguments},X.always(function(){ce===void 0?c(a).removeProp(re):a[re]=ce,w[re]&&(w.jsonpCallback=E.jsonpCallback,iu.push(re)),fe&&S(ce)&&ce(fe[0]),fe=ce=void 0}),"script"}),A.createHTMLDocument=((Kl=W.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",Kl.childNodes.length===2),c.parseHTML=function(w,E,X){return typeof w!="string"?[]:(typeof E=="boolean"&&(X=E,E=!1),E||(A.createHTMLDocument?((re=(E=W.implementation.createHTMLDocument("")).createElement("base")).href=W.location.href,E.head.appendChild(re)):E=W),fe=!X&&[],(ce=ae.exec(w))?[E.createElement(ce[1])]:(ce=Ni([w],E,fe),fe&&fe.length&&c(fe).remove(),c.merge([],ce.childNodes)));var re,ce,fe},c.fn.load=function(w,E,X){var re,ce,fe,be=this,xe=w.indexOf(" ");return xe>-1&&(re=ha(w.slice(xe)),w=w.slice(0,xe)),S(E)?(X=E,E=void 0):E&&typeof E=="object"&&(ce="POST"),be.length>0&&c.ajax({url:w,type:ce||"GET",dataType:"html",data:E}).done(function(Me){fe=arguments,be.html(re?c("<div>").append(c.parseHTML(Me)).find(re):Me)}).always(X&&function(Me,Ne){be.each(function(){X.apply(this,fe||[Me.responseText,Ne,Me])})}),this},c.expr.pseudos.animated=function(w){return c.grep(c.timers,function(E){return w===E.elem}).length},c.offset={setOffset:function(w,E,X){var re,ce,fe,be,xe,Me,Ne=c.css(w,"position"),Qe=c(w),ht={};Ne==="static"&&(w.style.position="relative"),xe=Qe.offset(),fe=c.css(w,"top"),Me=c.css(w,"left"),(Ne==="absolute"||Ne==="fixed")&&(fe+Me).indexOf("auto")>-1?(be=(re=Qe.position()).top,ce=re.left):(be=parseFloat(fe)||0,ce=parseFloat(Me)||0),S(E)&&(E=E.call(w,X,c.extend({},xe))),E.top!=null&&(ht.top=E.top-xe.top+be),E.left!=null&&(ht.left=E.left-xe.left+ce),"using"in E?E.using.call(w,ht):Qe.css(ht)}},c.fn.extend({offset:function(w){if(arguments.length)return w===void 0?this:this.each(function(ce){c.offset.setOffset(this,w,ce)});var E,X,re=this[0];return re?re.getClientRects().length?(E=re.getBoundingClientRect(),X=re.ownerDocument.defaultView,{top:E.top+X.pageYOffset,left:E.left+X.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var w,E,X,re=this[0],ce={top:0,left:0};if(c.css(re,"position")==="fixed")E=re.getBoundingClientRect();else{for(E=this.offset(),X=re.ownerDocument,w=re.offsetParent||X.documentElement;w&&(w===X.body||w===X.documentElement)&&c.css(w,"position")==="static";)w=w.parentNode;w&&w!==re&&w.nodeType===1&&((ce=c(w).offset()).top+=c.css(w,"borderTopWidth",!0),ce.left+=c.css(w,"borderLeftWidth",!0))}return{top:E.top-ce.top-c.css(re,"marginTop",!0),left:E.left-ce.left-c.css(re,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var w=this.offsetParent;w&&c.css(w,"position")==="static";)w=w.offsetParent;return w||Kt})}}),c.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(w,E){var X=E==="pageYOffset";c.fn[w]=function(re){return Je(this,function(ce,fe,be){var xe;if(q(ce)?xe=ce:ce.nodeType===9&&(xe=ce.defaultView),be===void 0)return xe?xe[E]:ce[fe];xe?xe.scrollTo(X?xe.pageXOffset:be,X?be:xe.pageYOffset):ce[fe]=be},w,re,arguments.length)}}),c.each(["top","left"],function(w,E){c.cssHooks[E]=go(A.pixelPosition,function(X,re){if(re)return re=ra(X,E),Vi.test(re)?c(X).position()[E]+"px":re})}),c.each({Height:"height",Width:"width"},function(w,E){c.each({padding:"inner"+w,content:E,"":"outer"+w},function(X,re){c.fn[re]=function(ce,fe){var be=arguments.length&&(X||typeof ce!="boolean"),xe=X||(ce===!0||fe===!0?"margin":"border");return Je(this,function(Me,Ne,Qe){var ht;return q(Me)?re.indexOf("outer")===0?Me["inner"+w]:Me.document.documentElement["client"+w]:Me.nodeType===9?(ht=Me.documentElement,Math.max(Me.body["scroll"+w],ht["scroll"+w],Me.body["offset"+w],ht["offset"+w],ht["client"+w])):Qe===void 0?c.css(Me,Ne,xe):c.style(Me,Ne,Qe,xe)},E,be?ce:void 0,be)}})}),c.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(w,E){c.fn[E]=function(X){return this.on(E,X)}}),c.fn.extend({bind:function(w,E,X){return this.on(w,null,E,X)},unbind:function(w,E){return this.off(w,null,E)},delegate:function(w,E,X,re){return this.on(E,w,X,re)},undelegate:function(w,E,X){return arguments.length===1?this.off(w,"**"):this.off(E,w||"**",X)},hover:function(w,E){return this.on("mouseenter",w).on("mouseleave",E||w)}}),c.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(w,E){c.fn[E]=function(X,re){return arguments.length>0?this.on(E,null,X,re):this.trigger(E)}});var Ao=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;c.proxy=function(w,E){var X,re,ce;if(typeof E=="string"&&(X=w[E],E=w,w=X),S(w))return re=I.call(arguments,2),(ce=function(){return w.apply(E||this,re.concat(I.call(arguments)))}).guid=w.guid=w.guid||c.guid++,ce},c.holdReady=function(w){w?c.readyWait++:c.ready(!0)},c.isArray=Array.isArray,c.parseJSON=JSON.parse,c.nodeName=m,c.isFunction=S,c.isWindow=q,c.camelCase=Yt,c.type=v,c.now=Date.now,c.isNumeric=function(w){var E=c.type(w);return(E==="number"||E==="string")&&!isNaN(w-parseFloat(w))},c.trim=function(w){return w==null?"":(w+"").replace(Ao,"$1")};var Po=a.jQuery,wa=a.$;return c.noConflict=function(w){return a.$===c&&(a.$=wa),w&&a.jQuery===c&&(a.jQuery=Po),c},x===void 0&&(a.jQuery=a.$=c),c},T.exports=r.document?o(r,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return o(a)}}),jquery$1=Object.freeze({__proto__:null,default:jquery,__moduleExports:jquery});function mxcadassemblyinit(){var T,r=(T=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0,typeof __filename<"u"&&(T=T||__filename),function(o){var a,x,u;o=o||{},a||(a=o!==void 0?o:{}),a.ready=new Promise(function(Re,xt){x=Re,u=xt});var M,I,H,G,L,y,D=Object.assign({},a),C=typeof window=="object",B=typeof importScripts=="function",z=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",A="";z?(A=B?xxxxx("path").dirname(A)+"/":__dirname+"/",y=()=>{L||(G=xxxxx("fs"),L=xxxxx("path"))},M=function(Re,xt){var qt=at(Re);return qt?xt?qt:qt.toString():(y(),Re=L.normalize(Re),G.readFileSync(Re,xt?void 0:"utf8"))},H=Re=>((Re=M(Re,!0)).buffer||(Re=new Uint8Array(Re)),Re),I=(Re,xt,qt)=>{var Lt=at(Re);Lt&&xt(Lt),y(),Re=L.normalize(Re),G.readFile(Re,function(En,yr){En?qt(En):xt(yr.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(Re){throw Re}),process.on("unhandledRejection",function(Re){throw Re}),a.inspect=function(){return"[Emscripten Module object]"}):(C||B)&&(B?A=self.location.href:typeof document<"u"&&document.currentScript&&(A=document.currentScript.src),T&&(A=T),A=A.indexOf("blob:")!==0?A.substr(0,A.replace(/[?#].*/,"").lastIndexOf("/")+1):"",M=Re=>{try{var xt=new XMLHttpRequest;return xt.open("GET",Re,!1),xt.send(null),xt.responseText}catch(En){if(Re=at(Re)){xt=[];for(var qt=0;qt<Re.length;qt++){var Lt=Re[qt];255<Lt&&(Lt&=255),xt.push(String.fromCharCode(Lt))}return xt.join("")}throw En}},B&&(H=Re=>{try{var xt=new XMLHttpRequest;return xt.open("GET",Re,!1),xt.responseType="arraybuffer",xt.send(null),new Uint8Array(xt.response)}catch(qt){if(Re=at(Re))return Re;throw qt}}),I=(Re,xt,qt)=>{var Lt=new XMLHttpRequest;Lt.open("GET",Re,!0),Lt.responseType="arraybuffer",Lt.onload=()=>{if(Lt.status==200||Lt.status==0&&Lt.response)xt(Lt.response);else{var En=at(Re);En?xt(En.buffer):qt()}},Lt.onerror=qt,Lt.send(null)}),a.print||console.log.bind(console);var S,q=a.printErr||console.warn.bind(console);Object.assign(a,D),D=null,a.wasmBinary&&(S=a.wasmBinary),a.noExitRuntime;var W=Error,_={};S=[],typeof _!="object"&&we("no native wasm support detected");var R,v,V,Y,c,p=!1,m=a.INITIAL_MEMORY||16777216;(R=a.wasmMemory?a.wasmMemory:new function(){this.buffer=new ArrayBuffer(m/65536*65536)})&&(v=R.buffer),m=v.byteLength;var f=v;v=f,a.HEAP8=V=new Int8Array(f),a.HEAP16=new Int16Array(f),a.HEAP32=c=new Int32Array(f),a.HEAPU8=Y=new Uint8Array(f),a.HEAPU16=new Uint16Array(f),a.HEAPU32=new Uint32Array(f),a.HEAPF32=new Float32Array(f),a.HEAPF64=new Float64Array(f);var N,P=[],O=[],Z=[];function te(){var Re=a.preRun.shift();P.unshift(Re)}var de=0,me=null;function we(Re){throw a.onAbort&&a.onAbort(Re),q(Re="Aborted("+Re+")"),p=!0,Re=new W(Re+". Build with -s ASSERTIONS=1 for more info."),u(Re),Re}a.preloadedImages={},a.preloadedAudios={};var ge,Le="data:application/octet-stream;base64,";if(!(ge="mxcadassembly_min.wasm").startsWith(Le)){var Pe=ge;ge=a.locateFile?a.locateFile(Pe,A):A+Pe}function ae(){var Re=ge;try{if(Re==ge&&S)return new Uint8Array(S);var xt=at(Re);if(xt)return xt;if(H)return H(Re);throw"both async and sync fetching of the wasm failed"}catch(qt){we(qt)}}function ve(Re){for(;0<Re.length;){var xt=Re.shift();if(typeof xt=="function")xt(a);else{var qt=xt.U;typeof qt=="number"?xt.G===void 0?ze(qt)():ze(qt)(xt.G):qt(xt.G===void 0?null:xt.G)}}}var Ie=[];function ze(Re){var xt=Ie[Re];return xt||(Re>=Ie.length&&(Ie.length=Re+1),Ie[Re]=xt=N.get(Re)),xt}var He=typeof atob=="function"?atob:function(Re){var xt="",qt=0;Re=Re.replace(/[^A-Za-z0-9\+\/=]/g,"");do{var Lt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(Re.charAt(qt++)),En="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(Re.charAt(qt++)),yr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(Re.charAt(qt++)),pr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(Re.charAt(qt++));Lt=Lt<<2|En>>4,En=(15&En)<<4|yr>>2;var Mr=(3&yr)<<6|pr;xt+=String.fromCharCode(Lt),yr!==64&&(xt+=String.fromCharCode(En)),pr!==64&&(xt+=String.fromCharCode(Mr))}while(qt<Re.length);return xt};function at(Re){if(Re.startsWith(Le)){if(Re=Re.slice(Le.length),typeof z=="boolean"&&z){var xt=Buffer.from(Re,"base64");xt=new Uint8Array(xt.buffer,xt.byteOffset,xt.byteLength)}else try{var qt=He(Re),Lt=new Uint8Array(qt.length);for(Re=0;Re<qt.length;++Re)Lt[Re]=qt.charCodeAt(Re);xt=Lt}catch{throw Error("Converting base64 string to bytes failed.")}return xt}}var tt={f:function(Re){return Zt(Re+16)+16},e:function(Re,xt,qt){throw new function(Lt){this.C=Lt-16,this.P=function(En){c[this.C+4>>2]=En},this.M=function(En){c[this.C+8>>2]=En},this.N=function(){c[this.C>>2]=0},this.L=function(){V[this.C+12|0]=0},this.O=function(){V[this.C+13|0]=0},this.K=function(En,yr){this.P(En),this.M(yr),this.N(),this.L(),this.O()}}(Re).K(xt,qt),Re},c:function(){we("")},d:function(Re,xt,qt){Y.copyWithin(Re,xt,xt+qt)},b:function(){we("OOM")},a:R};(function(){function Re(En){a.asm=En.exports,N=a.asm.A,O.unshift(a.asm.g),de--,a.monitorRunDependencies&&a.monitorRunDependencies(de),de==0&&me&&(En=me,me=null,En())}function xt(En){Re(En.instance)}function qt(En){return function(){if(!S&&(C||B)){if(typeof fetch=="function"&&!ge.startsWith("file://"))return fetch(ge,{credentials:"same-origin"}).then(function(yr){if(!yr.ok)throw"failed to load wasm binary file at '"+ge+"'";return yr.arrayBuffer()}).catch(function(){return ae()});if(I)return new Promise(function(yr,pr){I(ge,function(Mr){yr(new Uint8Array(Mr))},pr)})}return Promise.resolve().then(function(){return ae()})}().then(function(){return{then:function(yr){yr({instance:new function(){this.exports=function(pr){for(var Mr,Si=new Uint8Array(123),ci=25;ci>=0;--ci)Si[48+ci]=52+ci,Si[65+ci]=ci,Si[97+ci]=26+ci;function Ni(Jr,ai,hr){for(var xi,J,Lr=0,Pi=ai,zn=hr.length,Zi=ai+(3*zn>>2)-(hr[zn-2]=="=")-(hr[zn-1]=="=");Lr<zn;Lr+=4)xi=Si[hr.charCodeAt(Lr+1)],J=Si[hr.charCodeAt(Lr+2)],Jr[Pi++]=Si[hr.charCodeAt(Lr)]<<2|xi>>4,Pi<Zi&&(Jr[Pi++]=xi<<4|J>>2),Pi<Zi&&(Jr[Pi++]=J<<6|Si[hr.charCodeAt(Lr+3)])}return Si[43]=62,Si[47]=63,function(Jr){var ai=Jr.a.buffer,hr=new Int8Array(ai),xi=new Int16Array(ai),J=new Int32Array(ai),Lr=new Uint8Array(ai),Pi=new Uint32Array(ai),zn=new Float64Array(ai),Zi=Math.imul,mo=Jr.abort,mn=Jr.b,Ca=Jr.c,ka=Jr.d,Sa=Jr.e,Co=Jr.f,Vi=5245008;function Wa(ee){var Ce,se=0,_e=0,Ke=0,mt=0,It=0,Gt=0,Mn=0,Vn=0,qn=0,$r=0;Vi=Ce=Vi-16|0;e:{t:{n:{a:{i:{l:{r:{c:{u:{s:{o:{if((ee|=0)>>>0<=244){if(3&(se=(mt=J[404])>>>(_e=(Gt=ee>>>0<11?16:ee+11&-8)>>>3|0)|0)){ee=(It=J[1664+(se=(Ke=_e+(1&~se)|0)<<3)>>2])+8|0,(0|(_e=J[It+8>>2]))!=(0|(se=se+1656|0))?(J[_e+12>>2]=se,J[se+8>>2]=_e):J[404]=Sr(Ke)&mt,se=Ke<<3,J[It+4>>2]=3|se,J[4+(se=se+It|0)>>2]=1|J[se+4>>2];break e}if(($r=J[406])>>>0>=Gt>>>0)break o;if(se){_e=ee=(se=(0-(ee=(0-(ee=2<<_e)|ee)&se<<_e)&ee)-1|0)>>>12&16,_e|=ee=(se=se>>>ee|0)>>>5&8,_e|=ee=(se=se>>>ee|0)>>>2&4,qn=J[1664+(ee=(_e=((_e|=ee=(se=se>>>ee|0)>>>1&2)|(ee=(se=se>>>ee|0)>>>1&1))+(se>>>ee|0)|0)<<3)>>2],(0|(se=J[qn+8>>2]))!=(0|(ee=ee+1656|0))?(J[se+12>>2]=ee,J[ee+8>>2]=se):(mt=Sr(_e)&mt,J[404]=mt),ee=qn+8|0,J[qn+4>>2]=3|Gt,It=(se=_e<<3)-Gt|0,J[4+(Ke=Gt+qn|0)>>2]=1|It,J[se+qn>>2]=It,$r&&(_e=1656+((se=$r>>>3|0)<<3)|0,qn=J[409],(se=1<<se)&mt?se=J[_e+8>>2]:(J[404]=se|mt,se=_e),J[_e+8>>2]=qn,J[se+12>>2]=qn,J[qn+12>>2]=_e,J[qn+8>>2]=se),J[409]=Ke,J[406]=It;break e}if(!(Mn=J[405]))break o;for(_e=ee=(se=(0-Mn&Mn)-1|0)>>>12&16,_e|=ee=(se=se>>>ee|0)>>>5&8,_e|=ee=(se=se>>>ee|0)>>>2&4,se=J[1920+(((_e|=ee=(se=se>>>ee|0)>>>1&2)|(ee=(se=se>>>ee|0)>>>1&1))+(se>>>ee|0)<<2)>>2],Ke=(-8&J[se+4>>2])-Gt|0,_e=se;(ee=J[_e+16>>2])||(ee=J[_e+20>>2]);)Ke=(It=(_e=(-8&J[ee+4>>2])-Gt|0)>>>0<Ke>>>0)?_e:Ke,se=It?ee:se,_e=ee;if(Vn=J[se+24>>2],(0|(It=J[se+12>>2]))!=(0|se)){ee=J[se+8>>2],J[ee+12>>2]=It,J[It+8>>2]=ee;break t}if(!(ee=J[(_e=se+20|0)>>2])){if(!(ee=J[se+16>>2]))break s;_e=se+16|0}for(;qn=_e,It=ee,(ee=J[(_e=ee+20|0)>>2])||(_e=It+16|0,ee=J[It+16>>2]););J[qn>>2]=0;break t}if(Gt=-1,!(ee>>>0>4294967231)&&(Gt=-8&(ee=ee+11|0),Vn=J[405])){Ke=0-Gt|0,mt=0,Gt>>>0<256||(mt=31,Gt>>>0>16777215||(ee=ee>>>8|0,ee<<=qn=ee+1048320>>>16&8,mt=28+((ee=((ee<<=_e=ee+520192>>>16&4)<<(se=ee+245760>>>16&2)>>>15|0)-(se|_e|qn)|0)<<1|Gt>>>ee+21&1)|0));h:{p:{if(_e=J[1920+(mt<<2)>>2])for(ee=0,se=Gt<<((0|mt)==31?0:25-(mt>>>1|0));;){if(!((qn=(Mn=-8&J[_e+4>>2])-Gt|0)>>>0>=Ke>>>0)&&(Ke=qn,It=_e,(0|Gt)==(0|Mn))){Ke=0,ee=_e;break p}if(qn=J[_e+20>>2],_e=J[16+((se>>>29&4)+_e|0)>>2],ee=qn?(0|qn)==(0|_e)?ee:qn:ee,se<<=1,!_e)break}else ee=0;if(!(ee|It)){if(It=0,!(ee=(0-(ee=2<<mt)|ee)&Vn))break o;_e=ee=(se=(ee&0-ee)-1|0)>>>12&16,_e|=ee=(se=se>>>ee|0)>>>5&8,_e|=ee=(se=se>>>ee|0)>>>2&4,ee=J[1920+(((_e|=ee=(se=se>>>ee|0)>>>1&2)|(ee=(se=se>>>ee|0)>>>1&1))+(se>>>ee|0)<<2)>>2]}if(!ee)break h}for(;Ke=(_e=(se=(-8&J[ee+4>>2])-Gt|0)>>>0<Ke>>>0)?se:Ke,It=_e?ee:It,ee=(se=J[ee+16>>2])||J[ee+20>>2];);}if(!(!It|J[406]-Gt>>>0<=Ke>>>0)){if(mt=J[It+24>>2],(0|It)!=(0|(se=J[It+12>>2]))){ee=J[It+8>>2],J[ee+12>>2]=se,J[se+8>>2]=ee;break n}if(!(ee=J[(_e=It+20|0)>>2])){if(!(ee=J[It+16>>2]))break u;_e=It+16|0}for(;qn=_e,se=ee,(ee=J[(_e=ee+20|0)>>2])||(_e=se+16|0,ee=J[se+16>>2]););J[qn>>2]=0;break n}}}if((_e=J[406])>>>0>=Gt>>>0){Ke=J[409],(se=_e-Gt|0)>>>0>=16?(J[406]=se,ee=Ke+Gt|0,J[409]=ee,J[ee+4>>2]=1|se,J[_e+Ke>>2]=se,J[Ke+4>>2]=3|Gt):(J[409]=0,J[406]=0,J[Ke+4>>2]=3|_e,J[4+(ee=_e+Ke|0)>>2]=1|J[ee+4>>2]),ee=Ke+8|0;break e}if((Vn=J[407])>>>0>Gt>>>0){se=Vn-Gt|0,J[407]=se,ee=(_e=J[410])+Gt|0,J[410]=ee,J[ee+4>>2]=1|se,J[_e+4>>2]=3|Gt,ee=_e+8|0;break e}if(ee=0,Mn=Gt+47|0,J[522]?_e=J[524]:(J[525]=-1,J[526]=-1,J[523]=4096,J[524]=4096,J[522]=Ce+12&-16^1431655768,J[527]=0,J[515]=0,_e=4096),(_e=(qn=Mn+_e|0)&(It=0-_e|0))>>>0<=Gt>>>0||(Ke=J[514])&&(mt=(se=J[512])+_e|0)>>>0>Ke>>>0|se>>>0>=mt>>>0)break e;if(4&Lr[2060])break l;o:{h:{if(Ke=J[410])for(ee=2064;;){if((se=J[ee>>2])>>>0<=Ke>>>0&Ke>>>0<se+J[ee+4>>2]>>>0)break h;if(!(ee=J[ee+8>>2]))break}if((0|(se=aa(0)))==-1||(mt=_e,(ee=(Ke=J[523])-1|0)&se&&(mt=(_e-se|0)+(ee+se&0-Ke)|0),mt>>>0<=Gt>>>0|mt>>>0>2147483646)||(Ke=J[514])&&Ke>>>0<(It=(ee=J[512])+mt|0)>>>0|ee>>>0>=It>>>0)break r;if((0|se)!=(0|(ee=aa(mt))))break o;break i}if((mt=It&qn-Vn)>>>0>2147483646)break r;if((0|(se=aa(mt)))==(J[ee>>2]+J[ee+4>>2]|0))break c;ee=se}if(!((0|ee)==-1|Gt+48>>>0<=mt>>>0)){if((se=(se=J[524])+(Mn-mt|0)&0-se)>>>0>2147483646){se=ee;break i}if((0|aa(se))!=-1){mt=se+mt|0,se=ee;break i}aa(0-mt|0);break r}if(se=ee,(0|ee)!=-1)break i;break r}It=0;break t}se=0;break n}if((0|se)!=-1)break i}J[515]=4|J[515]}if(_e>>>0>2147483646||(0|(se=aa(_e)))==-1|(0|(ee=aa(0)))==-1|ee>>>0<=se>>>0||(mt=ee-se|0)>>>0<=Gt+40>>>0)break a}ee=J[512]+mt|0,J[512]=ee,ee>>>0>Pi[513]&&(J[513]=ee);i:{l:{r:{if(Mn=J[410]){for(ee=2064;;){if(((Ke=J[ee>>2])+(_e=J[ee+4>>2])|0)==(0|se))break r;if(!(ee=J[ee+8>>2]))break}break l}for((ee=J[408])>>>0<=se>>>0&&ee||(J[408]=se),ee=0,J[517]=mt,J[516]=se,J[412]=-1,J[413]=J[522],J[519]=0;_e=1656+(Ke=ee<<3)|0,J[Ke+1664>>2]=_e,J[Ke+1668>>2]=_e,(0|(ee=ee+1|0))!=32;);_e=(Ke=mt-40|0)-(ee=se+8&7?-8-se&7:0)|0,J[407]=_e,ee=ee+se|0,J[410]=ee,J[ee+4>>2]=1|_e,J[4+(se+Ke|0)>>2]=40,J[411]=J[526];break i}if(!(8&Lr[ee+12|0]|Ke>>>0>Mn>>>0|se>>>0<=Mn>>>0)){J[ee+4>>2]=_e+mt,_e=(ee=Mn+8&7?-8-Mn&7:0)+Mn|0,J[410]=_e,ee=(se=J[407]+mt|0)-ee|0,J[407]=ee,J[_e+4>>2]=1|ee,J[4+(se+Mn|0)>>2]=40,J[411]=J[526];break i}}Pi[408]>se>>>0&&(J[408]=se),_e=se+mt|0,ee=2064;l:{r:{c:{u:{s:{o:{for(;;){if((0|_e)!=J[ee>>2]){if(ee=J[ee+8>>2])continue;break o}break}if(!(8&Lr[ee+12|0]))break s}for(ee=2064;;){if((_e=J[ee>>2])>>>0<=Mn>>>0&&(It=_e+J[ee+4>>2]|0)>>>0>Mn>>>0)break u;ee=J[ee+8>>2]}}if(J[ee>>2]=se,J[ee+4>>2]=J[ee+4>>2]+mt,J[4+(qn=(se+8&7?-8-se&7:0)+se|0)>>2]=3|Gt,Gt=(mt=_e+(_e+8&7?-8-_e&7:0)|0)-(Vn=Gt+qn|0)|0,(0|mt)==(0|Mn)){J[410]=Vn,ee=J[407]+Gt|0,J[407]=ee,J[Vn+4>>2]=1|ee;break r}if(J[409]==(0|mt)){J[409]=Vn,ee=J[406]+Gt|0,J[406]=ee,J[Vn+4>>2]=1|ee,J[ee+Vn>>2]=ee;break r}if((3&(ee=J[mt+4>>2]))==1){It=-8&ee;s:if(ee>>>0<=255){if(_e=J[mt+8>>2],ee=ee>>>3|0,(0|(se=J[mt+12>>2]))==(0|_e)){J[404]=J[404]&Sr(ee);break s}J[_e+12>>2]=se,J[se+8>>2]=_e}else{if(Mn=J[mt+24>>2],(0|mt)==(0|(se=J[mt+12>>2])))if((Ke=J[(ee=mt+20|0)>>2])||(Ke=J[(ee=mt+16|0)>>2])){for(;_e=ee,(Ke=J[(ee=(se=Ke)+20|0)>>2])||(ee=se+16|0,Ke=J[se+16>>2]););J[_e>>2]=0}else se=0;else ee=J[mt+8>>2],J[ee+12>>2]=se,J[se+8>>2]=ee;if(Mn){_e=J[mt+28>>2];o:{if(J[(ee=1920+(_e<<2)|0)>>2]==(0|mt)){if(J[ee>>2]=se,se)break o;J[405]=J[405]&Sr(_e);break s}if(J[Mn+(J[Mn+16>>2]==(0|mt)?16:20)>>2]=se,!se)break s}J[se+24>>2]=Mn,(ee=J[mt+16>>2])&&(J[se+16>>2]=ee,J[ee+24>>2]=se),(ee=J[mt+20>>2])&&(J[se+20>>2]=ee,J[ee+24>>2]=se)}}Gt=It+Gt|0,mt=mt+It|0}if(J[mt+4>>2]=-2&J[mt+4>>2],J[Vn+4>>2]=1|Gt,J[Gt+Vn>>2]=Gt,Gt>>>0<=255){se=1656+((ee=Gt>>>3|0)<<3)|0,(_e=J[404])&(ee=1<<ee)?ee=J[se+8>>2]:(J[404]=ee|_e,ee=se),J[se+8>>2]=Vn,J[ee+12>>2]=Vn,J[Vn+12>>2]=se,J[Vn+8>>2]=ee;break r}if(ee=31,Gt>>>0<=16777215&&(ee=Gt>>>8|0,ee<<=Ke=ee+1048320>>>16&8,ee=28+((ee=((ee<<=_e=ee+520192>>>16&4)<<(se=ee+245760>>>16&2)>>>15|0)-(se|_e|Ke)|0)<<1|Gt>>>ee+21&1)|0),J[Vn+28>>2]=ee,J[Vn+16>>2]=0,J[Vn+20>>2]=0,Ke=1920+(ee<<2)|0,(_e=J[405])&(se=1<<ee)){for(ee=Gt<<((0|ee)==31?0:25-(ee>>>1|0)),se=J[Ke>>2];;){if(_e=se,(-8&J[se+4>>2])==(0|Gt))break c;if(se=ee>>>29|0,ee<<=1,!(se=J[16+(Ke=_e+(4&se)|0)>>2]))break}J[Ke+16>>2]=Vn,J[Vn+24>>2]=_e}else J[405]=se|_e,J[Ke>>2]=Vn,J[Vn+24>>2]=Ke;J[Vn+12>>2]=Vn,J[Vn+8>>2]=Vn;break r}for(_e=(Ke=mt-40|0)-(ee=se+8&7?-8-se&7:0)|0,J[407]=_e,ee=ee+se|0,J[410]=ee,J[ee+4>>2]=1|_e,J[4+(se+Ke|0)>>2]=40,J[411]=J[526],J[(_e=(ee=(It+(It-39&7?39-It&7:0)|0)-47|0)>>>0<Mn+16>>>0?Mn:ee)+4>>2]=27,ee=J[519],J[_e+16>>2]=J[518],J[_e+20>>2]=ee,ee=J[517],J[_e+8>>2]=J[516],J[_e+12>>2]=ee,J[518]=_e+8,J[517]=mt,J[516]=se,J[519]=0,ee=_e+24|0;J[ee+4>>2]=7,se=ee+8|0,ee=ee+4|0,se>>>0<It>>>0;);if((0|_e)==(0|Mn))break i;if(J[_e+4>>2]=-2&J[_e+4>>2],It=_e-Mn|0,J[Mn+4>>2]=1|It,J[_e>>2]=It,It>>>0<=255){se=1656+((ee=It>>>3|0)<<3)|0,(_e=J[404])&(ee=1<<ee)?ee=J[se+8>>2]:(J[404]=ee|_e,ee=se),J[se+8>>2]=Mn,J[ee+12>>2]=Mn,J[Mn+12>>2]=se,J[Mn+8>>2]=ee;break i}if(ee=31,J[Mn+16>>2]=0,J[Mn+20>>2]=0,It>>>0<=16777215&&(ee=It>>>8|0,ee<<=Ke=ee+1048320>>>16&8,ee=28+((ee=((ee<<=_e=ee+520192>>>16&4)<<(se=ee+245760>>>16&2)>>>15|0)-(se|_e|Ke)|0)<<1|It>>>ee+21&1)|0),J[Mn+28>>2]=ee,Ke=1920+(ee<<2)|0,(_e=J[405])&(se=1<<ee)){for(ee=It<<((0|ee)==31?0:25-(ee>>>1|0)),se=J[Ke>>2];;){if(_e=se,(0|It)==(-8&J[se+4>>2]))break l;if(se=ee>>>29|0,ee<<=1,!(se=J[16+(Ke=_e+(4&se)|0)>>2]))break}J[Ke+16>>2]=Mn,J[Mn+24>>2]=_e}else J[405]=se|_e,J[Ke>>2]=Mn,J[Mn+24>>2]=Ke;J[Mn+12>>2]=Mn,J[Mn+8>>2]=Mn;break i}ee=J[_e+8>>2],J[ee+12>>2]=Vn,J[_e+8>>2]=Vn,J[Vn+24>>2]=0,J[Vn+12>>2]=_e,J[Vn+8>>2]=ee}ee=qn+8|0;break e}ee=J[_e+8>>2],J[ee+12>>2]=Mn,J[_e+8>>2]=Mn,J[Mn+24>>2]=0,J[Mn+12>>2]=_e,J[Mn+8>>2]=ee}if(!((ee=J[407])>>>0<=Gt>>>0)){se=ee-Gt|0,J[407]=se,ee=(_e=J[410])+Gt|0,J[410]=ee,J[ee+4>>2]=1|se,J[_e+4>>2]=3|Gt,ee=_e+8|0;break e}}J[403]=48,ee=0;break e}n:if(mt){_e=J[It+28>>2];a:{if(J[(ee=1920+(_e<<2)|0)>>2]==(0|It)){if(J[ee>>2]=se,se)break a;Vn=Sr(_e)&Vn,J[405]=Vn;break n}if(J[mt+(J[mt+16>>2]==(0|It)?16:20)>>2]=se,!se)break n}J[se+24>>2]=mt,(ee=J[It+16>>2])&&(J[se+16>>2]=ee,J[ee+24>>2]=se),(ee=J[It+20>>2])&&(J[se+20>>2]=ee,J[ee+24>>2]=se)}n:if(Ke>>>0<=15)ee=Ke+Gt|0,J[It+4>>2]=3|ee,J[4+(ee=ee+It|0)>>2]=1|J[ee+4>>2];else if(J[It+4>>2]=3|Gt,J[4+(mt=It+Gt|0)>>2]=1|Ke,J[mt+Ke>>2]=Ke,Ke>>>0<=255)se=1656+((ee=Ke>>>3|0)<<3)|0,(_e=J[404])&(ee=1<<ee)?ee=J[se+8>>2]:(J[404]=ee|_e,ee=se),J[se+8>>2]=mt,J[ee+12>>2]=mt,J[mt+12>>2]=se,J[mt+8>>2]=ee;else{ee=31,Ke>>>0<=16777215&&(ee=Ke>>>8|0,ee<<=qn=ee+1048320>>>16&8,ee=28+((ee=((ee<<=_e=ee+520192>>>16&4)<<(se=ee+245760>>>16&2)>>>15|0)-(se|_e|qn)|0)<<1|Ke>>>ee+21&1)|0),J[mt+28>>2]=ee,J[mt+16>>2]=0,J[mt+20>>2]=0,se=1920+(ee<<2)|0;a:{if((_e=1<<ee)&Vn){for(ee=Ke<<((0|ee)==31?0:25-(ee>>>1|0)),_e=J[se>>2];;){if((-8&J[(se=_e)+4>>2])==(0|Ke))break a;if(_e=ee>>>29|0,ee<<=1,!(_e=J[16+(qn=(4&_e)+se|0)>>2]))break}J[qn+16>>2]=mt}else J[405]=_e|Vn,J[se>>2]=mt;J[mt+24>>2]=se,J[mt+12>>2]=mt,J[mt+8>>2]=mt;break n}ee=J[se+8>>2],J[ee+12>>2]=mt,J[se+8>>2]=mt,J[mt+24>>2]=0,J[mt+12>>2]=se,J[mt+8>>2]=ee}ee=It+8|0;break e}t:if(Vn){_e=J[se+28>>2];n:{if(J[(ee=1920+(_e<<2)|0)>>2]==(0|se)){if(J[ee>>2]=It,It)break n;J[405]=Sr(_e)&Mn;break t}if(J[Vn+(J[Vn+16>>2]==(0|se)?16:20)>>2]=It,!It)break t}J[It+24>>2]=Vn,(ee=J[se+16>>2])&&(J[It+16>>2]=ee,J[ee+24>>2]=It),(ee=J[se+20>>2])&&(J[It+20>>2]=ee,J[ee+24>>2]=It)}Ke>>>0<=15?(ee=Ke+Gt|0,J[se+4>>2]=3|ee,J[4+(ee=ee+se|0)>>2]=1|J[ee+4>>2]):(J[se+4>>2]=3|Gt,J[4+(It=se+Gt|0)>>2]=1|Ke,J[Ke+It>>2]=Ke,$r&&(_e=1656+((ee=$r>>>3|0)<<3)|0,qn=J[409],(ee=1<<ee)&mt?ee=J[_e+8>>2]:(J[404]=ee|mt,ee=_e),J[_e+8>>2]=qn,J[ee+12>>2]=qn,J[qn+12>>2]=_e,J[qn+8>>2]=ee),J[409]=It,J[406]=Ke),ee=se+8|0}return Vi=Ce+16|0,0|ee}function Ki(ee){var Ce=0,se=0,_e=0,Ke=0,mt=0,It=0,Gt=0;e:if(ee){mt=(_e=ee-8|0)+(ee=-8&(Ce=J[ee-4>>2]))|0;t:if(!(1&Ce)){if(!(3&Ce)||(_e=_e-(Ce=J[_e>>2])|0)>>>0<Pi[408])break e;if(ee=ee+Ce|0,J[409]==(0|_e)){if(!(3&~(Ce=J[mt+4>>2])))return J[406]=ee,J[mt+4>>2]=-2&Ce,J[_e+4>>2]=1|ee,void(J[ee+_e>>2]=ee)}else{if(Ce>>>0<=255){if(Ke=J[_e+8>>2],Ce=Ce>>>3|0,(0|(se=J[_e+12>>2]))==(0|Ke)){J[404]=J[404]&Sr(Ce);break t}J[Ke+12>>2]=se,J[se+8>>2]=Ke;break t}if(Gt=J[_e+24>>2],(0|_e)==(0|(Ce=J[_e+12>>2])))if((se=J[(Ke=_e+20|0)>>2])||(se=J[(Ke=_e+16|0)>>2])){for(;It=Ke,(se=J[(Ke=(Ce=se)+20|0)>>2])||(Ke=Ce+16|0,se=J[Ce+16>>2]););J[It>>2]=0}else Ce=0;else se=J[_e+8>>2],J[se+12>>2]=Ce,J[Ce+8>>2]=se;if(!Gt)break t;Ke=J[_e+28>>2];n:{if(J[(se=1920+(Ke<<2)|0)>>2]==(0|_e)){if(J[se>>2]=Ce,Ce)break n;J[405]=J[405]&Sr(Ke);break t}if(J[Gt+(J[Gt+16>>2]==(0|_e)?16:20)>>2]=Ce,!Ce)break t}if(J[Ce+24>>2]=Gt,(se=J[_e+16>>2])&&(J[Ce+16>>2]=se,J[se+24>>2]=Ce),!(se=J[_e+20>>2]))break t;J[Ce+20>>2]=se,J[se+24>>2]=Ce}}if(!(_e>>>0>=mt>>>0)&&1&(Ce=J[mt+4>>2])){t:{if(!(2&Ce)){if(J[410]==(0|mt)){if(J[410]=_e,ee=J[407]+ee|0,J[407]=ee,J[_e+4>>2]=1|ee,J[409]!=(0|_e))break e;return J[406]=0,void(J[409]=0)}if(J[409]==(0|mt))return J[409]=_e,ee=J[406]+ee|0,J[406]=ee,J[_e+4>>2]=1|ee,void(J[ee+_e>>2]=ee);ee=(-8&Ce)+ee|0;n:if(Ce>>>0<=255){if(Ke=J[mt+8>>2],Ce=Ce>>>3|0,(0|(se=J[mt+12>>2]))==(0|Ke)){J[404]=J[404]&Sr(Ce);break n}J[Ke+12>>2]=se,J[se+8>>2]=Ke}else{if(Gt=J[mt+24>>2],(0|mt)==(0|(Ce=J[mt+12>>2])))if((se=J[(Ke=mt+20|0)>>2])||(se=J[(Ke=mt+16|0)>>2])){for(;It=Ke,(se=J[(Ke=(Ce=se)+20|0)>>2])||(Ke=Ce+16|0,se=J[Ce+16>>2]););J[It>>2]=0}else Ce=0;else se=J[mt+8>>2],J[se+12>>2]=Ce,J[Ce+8>>2]=se;if(Gt){Ke=J[mt+28>>2];a:{if(J[(se=1920+(Ke<<2)|0)>>2]==(0|mt)){if(J[se>>2]=Ce,Ce)break a;J[405]=J[405]&Sr(Ke);break n}if(J[Gt+(J[Gt+16>>2]==(0|mt)?16:20)>>2]=Ce,!Ce)break n}J[Ce+24>>2]=Gt,(se=J[mt+16>>2])&&(J[Ce+16>>2]=se,J[se+24>>2]=Ce),(se=J[mt+20>>2])&&(J[Ce+20>>2]=se,J[se+24>>2]=Ce)}}if(J[_e+4>>2]=1|ee,J[ee+_e>>2]=ee,J[409]!=(0|_e))break t;return void(J[406]=ee)}J[mt+4>>2]=-2&Ce,J[_e+4>>2]=1|ee,J[ee+_e>>2]=ee}if(ee>>>0<=255)return Ce=1656+((ee=ee>>>3|0)<<3)|0,(se=J[404])&(ee=1<<ee)?ee=J[Ce+8>>2]:(J[404]=ee|se,ee=Ce),J[Ce+8>>2]=_e,J[ee+12>>2]=_e,J[_e+12>>2]=Ce,void(J[_e+8>>2]=ee);Ke=31,J[_e+16>>2]=0,J[_e+20>>2]=0,ee>>>0<=16777215&&(Ce=ee>>>8|0,Ce<<=It=Ce+1048320>>>16&8,Ke=28+((Ce=((Ce<<=Ke=Ce+520192>>>16&4)<<(se=Ce+245760>>>16&2)>>>15|0)-(se|Ke|It)|0)<<1|ee>>>Ce+21&1)|0),J[_e+28>>2]=Ke,It=1920+(Ke<<2)|0;t:{n:{if((se=J[405])&(Ce=1<<Ke)){for(Ke=ee<<((0|Ke)==31?0:25-(Ke>>>1|0)),Ce=J[It>>2];;){if(se=Ce,(-8&J[Ce+4>>2])==(0|ee))break n;if(Ce=Ke>>>29|0,Ke<<=1,!(Ce=J[16+(It=se+(4&Ce)|0)>>2]))break}J[It+16>>2]=_e,J[_e+24>>2]=se}else J[405]=Ce|se,J[It>>2]=_e,J[_e+24>>2]=It;J[_e+12>>2]=_e,J[_e+8>>2]=_e;break t}ee=J[se+8>>2],J[ee+12>>2]=_e,J[se+8>>2]=_e,J[_e+24>>2]=0,J[_e+12>>2]=se,J[_e+8>>2]=ee}ee=J[412]-1|0,J[412]=ee||-1}}}function ja(ee,Ce,se){var _e,Ke=0,mt=0;if(se>>>0>=512)return ka(0|ee,0|Ce,0|se),ee;_e=ee+se|0;e:if(3&(ee^Ce))if(_e>>>0<4)se=ee;else if((Ke=_e-4|0)>>>0<ee>>>0)se=ee;else for(se=ee;hr[0|se]=Lr[0|Ce],hr[se+1|0]=Lr[Ce+1|0],hr[se+2|0]=Lr[Ce+2|0],hr[se+3|0]=Lr[Ce+3|0],Ce=Ce+4|0,Ke>>>0>=(se=se+4|0)>>>0;);else{t:if(3&ee)if(se)for(se=ee;;){if(hr[0|se]=Lr[0|Ce],Ce=Ce+1|0,!(3&(se=se+1|0)))break t;if(!(se>>>0<_e>>>0))break}else se=ee;else se=ee;if(!((Ke=-4&_e)>>>0<64||(mt=Ke+-64|0)>>>0<se>>>0))for(;J[se>>2]=J[Ce>>2],J[se+4>>2]=J[Ce+4>>2],J[se+8>>2]=J[Ce+8>>2],J[se+12>>2]=J[Ce+12>>2],J[se+16>>2]=J[Ce+16>>2],J[se+20>>2]=J[Ce+20>>2],J[se+24>>2]=J[Ce+24>>2],J[se+28>>2]=J[Ce+28>>2],J[se+32>>2]=J[Ce+32>>2],J[se+36>>2]=J[Ce+36>>2],J[se+40>>2]=J[Ce+40>>2],J[se+44>>2]=J[Ce+44>>2],J[se+48>>2]=J[Ce+48>>2],J[se+52>>2]=J[Ce+52>>2],J[se+56>>2]=J[Ce+56>>2],J[se+60>>2]=J[Ce+60>>2],Ce=Ce- -64|0,mt>>>0>=(se=se- -64|0)>>>0;);if(se>>>0>=Ke>>>0)break e;for(;J[se>>2]=J[Ce>>2],Ce=Ce+4|0,Ke>>>0>(se=se+4|0)>>>0;);}if(se>>>0<_e>>>0)for(;hr[0|se]=Lr[0|Ce],Ce=Ce+1|0,(0|_e)!=(0|(se=se+1|0)););return ee}function Ja(ee,Ce){var se=0;if(Ce&&(hr[0|ee]=0,hr[(se=ee+Ce|0)-1|0]=0,!(Ce>>>0<3||(hr[ee+2|0]=0,hr[ee+1|0]=0,hr[se-3|0]=0,hr[se-2|0]=0,Ce>>>0<7||(hr[ee+3|0]=0,hr[se-4|0]=0,Ce>>>0<9||(J[(ee=(se=0-ee&3)+ee|0)>>2]=0,J[(Ce=(se=Ce-se&-4)+ee|0)-4>>2]=0,se>>>0<9||(J[ee+8>>2]=0,J[ee+4>>2]=0,J[Ce-8>>2]=0,J[Ce-12>>2]=0,se>>>0<25||(J[ee+24>>2]=0,J[ee+20>>2]=0,J[ee+16>>2]=0,J[ee+12>>2]=0,J[Ce-16>>2]=0,J[Ce-20>>2]=0,J[Ce-24>>2]=0,J[Ce-28>>2]=0,(Ce=(Ce=se)-(se=4&ee|24)|0)>>>0<32))))))))for(ee=ee+se|0;J[ee+24>>2]=0,J[ee+28>>2]=0,J[ee+16>>2]=0,J[ee+20>>2]=0,J[ee+8>>2]=0,J[ee+12>>2]=0,J[ee>>2]=0,J[ee+4>>2]=0,ee=ee+32|0,(Ce=Ce-32|0)>>>0>31;);}function ra(ee){var Ce,se=0,_e=0,Ke=0;Ce=0|Co(8),J[Ce>>2]=1348,J[Ce>>2]=1392;e:{t:{if(3&(se=ee))for(;;){if(!Lr[0|se])break t;if(!(3&(se=se+1|0)))break}for(;_e=se,se=se+4|0,!(~(Ke=J[_e>>2])&Ke-16843009&-2139062144););if(se=_e-ee|0,!(255&Ke))break e;for(;Ke=Lr[_e+1|0],_e=se=_e+1|0,Ke;);}se=se-ee|0}_e=Oi(se+13|0),J[_e+8>>2]=0,J[_e+4>>2]=se,J[_e>>2]=se,J[Ce+4>>2]=ja(_e+12|0,ee,se+1|0),J[Ce>>2]=1440,Sa(0|Ce,1472,1),mo()}function go(ee,Ce,se,_e){hr[ee+53|0]=1;e:if(J[ee+4>>2]==(0|se)){hr[ee+52|0]=1;t:{if(!(se=J[ee+16>>2])){if(J[ee+36>>2]=1,J[ee+24>>2]=_e,J[ee+16>>2]=Ce,(0|_e)!=1)break e;if(J[ee+48>>2]==1)break t;break e}if((0|Ce)==(0|se)){if((0|(se=J[ee+24>>2]))==2&&(J[ee+24>>2]=_e,se=_e),J[ee+48>>2]!=1)break e;if((0|se)==1)break t;break e}J[ee+36>>2]=J[ee+36>>2]+1}hr[ee+54|0]=1}}function ia(ee,Ce,se){var _e=0;if(!se)return J[ee+4>>2]==J[Ce+4>>2];if((0|ee)==(0|Ce))return 1;_e=J[ee+4>>2],ee=Lr[0|_e],se=J[Ce+4>>2];e:if(!(!ee|(0|(Ce=Lr[0|se]))!=(0|ee)))for(;;){if(Ce=Lr[se+1|0],!(ee=Lr[_e+1|0]))break e;if(se=se+1|0,_e=_e+1|0,(0|ee)!=(0|Ce))break}return(0|ee)==(0|Ce)}function So(ee,Ce,se){var _e;if(!(_e=J[ee+16>>2]))return J[ee+36>>2]=1,J[ee+24>>2]=se,void(J[ee+16>>2]=Ce);e:{if((0|Ce)==(0|_e)){if(J[ee+24>>2]!=2)break e;return void(J[ee+24>>2]=se)}hr[ee+54|0]=1,J[ee+24>>2]=2,J[ee+36>>2]=J[ee+36>>2]+1}}function aa(ee){var Ce,se;return(ee=(Ce=J[377])+(se=ee+3&-4)|0)>>>0<=Ce>>>0&&se||ee>>>0>ai.byteLength/65536<<16>>>0&&!(0|mn(0|ee))?(J[403]=48,-1):(J[377]=ee,Ce)}function Oi(ee){var Ce=0;ee=ee||1;e:{for(;;){if(Ce=Wa(ee))break e;if(!(Ce=J[528]))break;kr[0|Ce]()}Ca(),mo()}return Ce}function zr(ee){var Ce,se;return J[(ee|=0)>>2]=1392,Ce=J[ee+4>>2]-12|0,se=J[Ce+8>>2]-1|0,J[Ce+8>>2]=se,(0|se)<0&&Ki(Ce),0|ee}function Sr(ee){var Ce;return(-1>>>(Ce=31&ee)&-2)<<Ce|(-1<<(ee=0-ee&31)&-2)>>>ee}function xa(ee){(ee|=0)&&Ki(ee)}function Da(ee){zr(ee|=0),Ki(ee)}function Do(ee){return 0|ee}function ro(ee){Ki(ee|=0)}function ui(ee){}Ni(Mr=Lr,1024,"dmVjdG9yAHN0ZDo6ZXhjZXB0aW9uAGFsbG9jYXRvcjxUPjo6YWxsb2NhdGUoc2l6ZV90IG4pICduJyBleGNlZWRzIG1heGltdW0gc3VwcG9ydGVkIHNpemUATjEwX19jeHhhYml2MTE2X19zaGltX3R5cGVfaW5mb0UAAOgEAABaBAAA3AUAAE4xMF9fY3h4YWJpdjExN19fY2xhc3NfdHlwZV9pbmZvRQAAAOgEAACIBAAAfAQAAAAAAACsBAAAAgAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAAAAAAMAUAAAIAAAAKAAAABAAAAAUAAAAGAAAACwAAAAwAAAANAAAATjEwX19jeHhhYml2MTIwX19zaV9jbGFzc190eXBlX2luZm9FAAAAAOgEAAAIBQAArAQAAAAAAABgBQAADgAAAA8AAAAQAAAAU3Q5ZXhjZXB0aW9uAAAAAMAEAABQBQAAAAAAAIwFAAABAAAAEQAAABIAAABTdDExbG9naWNfZXJyb3IA6AQAAHwFAABgBQAAAAAAAMAFAAABAAAAEwAAABIAAABTdDEybGVuZ3RoX2Vycm9yAAAAAOgEAACsBQAAjAUAAFN0OXR5cGVfaW5mbwAAAADABAAAzAU="),Ni(Mr,1508,"UAhQ");var kr=function(ee){return ee.grow=function(Ce){var se=this.length;return this.length=this.length+Ce,se},ee.set=function(Ce,se){this[Ce]=se},ee.get=function(Ce){return this[Ce]},ee}([null,zr,Do,ro,ui,ui,function(ee,Ce,se){se|=0;var _e,Ke=0,mt=0,It=0,Gt=0;if(Vi=_e=Vi+-64|0,Ke=1,!ia(ee|=0,Ce|=0,0)&&(Ke=0,Ce)){Vi=Ke=Vi+-64|0,mt=J[Ce>>2],It=J[mt-4>>2],Gt=J[mt-8>>2],J[Ke+20>>2]=0,J[Ke+16>>2]=1148,J[Ke+12>>2]=Ce,J[Ke+8>>2]=1196,mt=0,Ja(Ke+24|0,39),Ce=Ce+Gt|0;e:if(ia(It,1196,0))J[Ke+56>>2]=1,kr[J[J[It>>2]+20>>2]](It,Ke+8|0,Ce,Ce,1,0),mt=J[Ke+32>>2]==1?Ce:0;else{kr[J[J[It>>2]+24>>2]](It,Ke+8|0,Ce,1,0);t:switch(J[Ke+44>>2]){case 0:mt=J[Ke+48>>2]==1&&J[Ke+36>>2]==1&&J[Ke+40>>2]==1?J[Ke+28>>2]:0;break e;case 1:break t;default:break e}J[Ke+32>>2]!=1&&J[Ke+48>>2]|J[Ke+36>>2]!=1|J[Ke+40>>2]!=1||(mt=J[Ke+24>>2])}Vi=Ke- -64|0,Ke=0,mt&&(Ja(4|(Ce=_e+8|0),52),J[_e+56>>2]=1,J[_e+20>>2]=-1,J[_e+16>>2]=ee,J[_e+8>>2]=mt,kr[J[J[mt>>2]+28>>2]](mt,Ce,J[se>>2],1),(0|(ee=J[_e+32>>2]))==1&&(J[se>>2]=J[_e+24>>2]),Ke=(0|ee)==1)}return Vi=_e- -64|0,0|Ke},function(ee,Ce,se,_e,Ke,mt){se|=0,_e|=0,Ke|=0,mt|=0,ia(ee|=0,J[8+(Ce|=0)>>2],mt)&&go(Ce,se,_e,Ke)},function(ee,Ce,se,_e,Ke){if(se|=0,_e|=0,Ke|=0,ia(ee|=0,J[8+(Ce|=0)>>2],Ke))J[Ce+28>>2]==1|J[Ce+4>>2]!=(0|se)||(J[Ce+28>>2]=_e);else e:if(ia(ee,J[Ce>>2],Ke)){if(!(J[Ce+16>>2]!=(0|se)&J[Ce+20>>2]!=(0|se))){if((0|_e)!=1)break e;return void(J[Ce+32>>2]=1)}J[Ce+20>>2]=se,J[Ce+32>>2]=_e,J[Ce+40>>2]=J[Ce+40>>2]+1,J[Ce+36>>2]!=1|J[Ce+24>>2]!=2||(hr[Ce+54|0]=1),J[Ce+44>>2]=4}},function(ee,Ce,se,_e){se|=0,_e|=0,ia(ee|=0,J[8+(Ce|=0)>>2],0)&&So(Ce,se,_e)},ro,function(ee,Ce,se,_e,Ke,mt){se|=0,_e|=0,Ke|=0,mt|=0,ia(ee|=0,J[8+(Ce|=0)>>2],mt)?go(Ce,se,_e,Ke):(ee=J[ee+8>>2],kr[J[J[ee>>2]+20>>2]](ee,Ce,se,_e,Ke,mt))},function(ee,Ce,se,_e,Ke){if(se|=0,_e|=0,Ke|=0,ia(ee|=0,J[8+(Ce|=0)>>2],Ke))J[Ce+28>>2]==1|J[Ce+4>>2]!=(0|se)||(J[Ce+28>>2]=_e);else e:{if(ia(ee,J[Ce>>2],Ke)){if(!(J[Ce+16>>2]!=(0|se)&J[Ce+20>>2]!=(0|se))){if((0|_e)!=1)break e;return void(J[Ce+32>>2]=1)}J[Ce+32>>2]=_e;t:if(J[Ce+44>>2]!=4){if(xi[Ce+52>>1]=0,ee=J[ee+8>>2],kr[J[J[ee>>2]+20>>2]](ee,Ce,se,se,1,Ke),Lr[Ce+53|0]){if(J[Ce+44>>2]=3,!Lr[Ce+52|0])break t;break e}J[Ce+44>>2]=4}if(J[Ce+20>>2]=se,J[Ce+40>>2]=J[Ce+40>>2]+1,J[Ce+36>>2]!=1|J[Ce+24>>2]!=2)break e;return void(hr[Ce+54|0]=1)}ee=J[ee+8>>2],kr[J[J[ee>>2]+24>>2]](ee,Ce,se,_e,Ke)}},function(ee,Ce,se,_e){se|=0,_e|=0,ia(ee|=0,J[8+(Ce|=0)>>2],0)?So(Ce,se,_e):(ee=J[ee+8>>2],kr[J[J[ee>>2]+28>>2]](ee,Ce,se,_e))},Do,ro,function(ee){return 1031},Da,function(ee){return J[4+(ee|=0)>>2]},Da]);return{g:function(){},h:xa,i:function(){var ee;return ee=Oi(24),J[ee>>2]=0,J[ee+4>>2]=0,J[ee+16>>2]=0,J[ee+20>>2]=0,J[ee+8>>2]=0,J[ee+12>>2]=0,0|ee},j:function(ee,Ce,se){var _e;return ee=+ee,Ce=+Ce,se=+se,_e=Oi(24),zn[_e+16>>3]=se,zn[_e+8>>3]=Ce,zn[_e>>3]=ee,0|_e},k:function(ee,Ce){Ce|=0,zn[(ee|=0)>>3]=zn[ee>>3]+zn[Ce>>3],zn[ee+8>>3]=zn[ee+8>>3]+zn[Ce+8>>3],zn[ee+16>>3]=zn[ee+16>>3]+zn[Ce+16>>3]},l:function(ee,Ce){Ce|=0,zn[(ee|=0)>>3]=zn[ee>>3]-zn[Ce>>3],zn[ee+8>>3]=zn[ee+8>>3]-zn[Ce+8>>3],zn[ee+16>>3]=zn[ee+16>>3]-zn[Ce+16>>3]},m:function(ee){return+zn[(ee|=0)>>3]},n:function(ee,Ce){Ce=+Ce,zn[(ee|=0)>>3]=Ce},o:function(ee){return+zn[8+(ee|=0)>>3]},p:function(ee,Ce){Ce=+Ce,zn[8+(ee|=0)>>3]=Ce},q:function(ee){return+zn[16+(ee|=0)>>3]},r:function(ee,Ce){Ce=+Ce,zn[16+(ee|=0)>>3]=Ce},s:xa,t:function(){var ee;return ee=Oi(12),J[ee+8>>2]=0,J[ee>>2]=0,J[ee+4>>2]=0,0|ee},u:function(ee,Ce){Ce|=0;var se=0,_e=0,Ke=0,mt=0,It=0,Gt=0;e:if((0|(se=J[4+(ee|=0)>>2]))==J[ee+8>>2]){t:{if((Ke=1+(se=(0|(Gt=se-(_e=J[ee>>2])|0))/24|0)|0)>>>0<178956971){if(mt=se<<1,Ke=se>>>0<89478485?Ke>>>0<mt>>>0?mt:Ke:178956970){if(Ke>>>0>=178956971)break t;mt=Oi(Zi(Ke,24))}else mt=0;se=mt+Zi(se,24)|0,It=J[Ce+4>>2],J[se>>2]=J[Ce>>2],J[se+4>>2]=It,It=J[Ce+20>>2],J[se+16>>2]=J[Ce+16>>2],J[se+20>>2]=It,It=J[Ce+12>>2],J[se+8>>2]=J[Ce+8>>2],J[se+12>>2]=It,Ce=se+Zi((0|Gt)/-24|0,24)|0,(0|Gt)>0&&ja(Ce,_e,Gt),J[ee+8>>2]=mt+Zi(Ke,24),J[ee+4>>2]=se+24,J[ee>>2]=Ce,_e&&Ki(_e);break e}ra(1024),mo()}ra(1046),mo()}else _e=J[Ce+4>>2],J[se>>2]=J[Ce>>2],J[se+4>>2]=_e,_e=J[Ce+20>>2],J[se+16>>2]=J[Ce+16>>2],J[se+20>>2]=_e,_e=J[Ce+12>>2],J[se+8>>2]=J[Ce+8>>2],J[se+12>>2]=_e,J[ee+4>>2]=se+24},v:function(ee){var Ce=0;(ee|=0)&&((Ce=J[ee>>2])&&(J[ee+4>>2]=Ce,Ki(Ce)),Ki(ee))},w:function(){return 0|Oi(1)},x:function(ee,Ce){ee|=0;var se=0,_e=0,Ke=0,mt=0,It=0,Gt=0,Mn=0,Vn=0,qn=0,$r=0,ha=0,wi=0;if(ee=J[(Ce|=0)>>2],(_e=(0|(Ke=J[Ce+4>>2]-ee|0))/24|0)>>>0>=2){if(!(Ke-24>>>0<24)){if(se=zn[ee+8>>3],Ce=1,ha=1&(_e=_e-1|0),It=zn[ee>>3],Ke-48>>>0<24)Gt=se;else for(wi=-2&_e,_e=0,Mn=It,Vn=se;Ke=ee+Zi(Ce,24)|0,mt=.5*((It=zn[Ke+24>>3])-(qn=zn[Ke>>3]))*(($r=zn[Ke+8>>3]-se)+((Gt=zn[Ke+32>>3])-se))+(.5*(qn-Mn)*(Vn-se+$r)+mt),Ce=Ce+2|0,Mn=It,Vn=Gt,(0|wi)!=(0|(_e=_e+2|0)););ha&&(ee=ee+Zi(Ce,24)|0,mt=.5*(zn[ee>>3]-It)*(Gt-se+(zn[ee+8>>3]-se))+mt)}se=mt<0?-mt:mt}else se=0;return+se},y:function(ee,Ce,se){ee|=0,Ce|=0;var _e,Ke=0,mt=0,It=0,Gt=0,Mn=0,Vn=0,qn=0;if((_e=((ee=J[4+(se|=0)>>2])-(se=J[se>>2])|0)/24|0)>>>0>=3)for(ee=_e-1|0,Ke=zn[Ce+8>>3],qn=zn[Ce>>3],Ce=0;Gt=se+Zi(ee,24)|0,It=zn[Gt+8>>3],ee=Ce,Ce=se+Zi(Ce,24)|0,!(Ke<It&(mt=zn[Ce+8>>3])<=Ke)&(!(Ke>=It)|!(Ke<mt))||qn-(Mn=zn[Ce>>3])<(Ke-mt)*(zn[Gt>>3]-Mn)/(It-mt)&&(Vn^=1),(0|_e)!=(0|(Ce=ee+1|0)););return 1&Vn},z:xa,A:kr,B:Wa}}(pr)}(tt)}})}}}).then(function(yr){return yr}).then(En,function(yr){q("failed to asynchronously prepare wasm: "+yr),we(yr)})}var Lt={a:tt};if(de++,a.monitorRunDependencies&&a.monitorRunDependencies(de),a.instantiateWasm)try{return a.instantiateWasm(Lt,Re)}catch(En){return q("Module.instantiateWasm callback failed with error: "+En),!1}(S||typeof _.instantiateStreaming!="function"||ge.startsWith(Le)||ge.startsWith("file://")||typeof fetch!="function"?qt(xt):fetch(ge,{credentials:"same-origin"}).then(function(En){return _.instantiateStreaming(En,Lt).then(xt,function(yr){return q("wasm streaming compile failed: "+yr),q("falling back to ArrayBuffer instantiation"),qt(xt)})})).catch(u)})(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.g).apply(null,arguments)};var le,De=a._emscripten_bind_VoidPtr___destroy___0=function(){return(De=a._emscripten_bind_VoidPtr___destroy___0=a.asm.h).apply(null,arguments)},st=a._emscripten_bind_McGePoint3d_McGePoint3d_0=function(){return(st=a._emscripten_bind_McGePoint3d_McGePoint3d_0=a.asm.i).apply(null,arguments)},gt=a._emscripten_bind_McGePoint3d_McGePoint3d_3=function(){return(gt=a._emscripten_bind_McGePoint3d_McGePoint3d_3=a.asm.j).apply(null,arguments)},St=a._emscripten_bind_McGePoint3d_op_add_1=function(){return(St=a._emscripten_bind_McGePoint3d_op_add_1=a.asm.k).apply(null,arguments)},Rt=a._emscripten_bind_McGePoint3d_op_sub_1=function(){return(Rt=a._emscripten_bind_McGePoint3d_op_sub_1=a.asm.l).apply(null,arguments)},Pt=a._emscripten_bind_McGePoint3d_get_x_0=function(){return(Pt=a._emscripten_bind_McGePoint3d_get_x_0=a.asm.m).apply(null,arguments)},Je=a._emscripten_bind_McGePoint3d_set_x_1=function(){return(Je=a._emscripten_bind_McGePoint3d_set_x_1=a.asm.n).apply(null,arguments)},bt=a._emscripten_bind_McGePoint3d_get_y_0=function(){return(bt=a._emscripten_bind_McGePoint3d_get_y_0=a.asm.o).apply(null,arguments)},jt=a._emscripten_bind_McGePoint3d_set_y_1=function(){return(jt=a._emscripten_bind_McGePoint3d_set_y_1=a.asm.p).apply(null,arguments)},Ln=a._emscripten_bind_McGePoint3d_get_z_0=function(){return(Ln=a._emscripten_bind_McGePoint3d_get_z_0=a.asm.q).apply(null,arguments)},Yt=a._emscripten_bind_McGePoint3d_set_z_1=function(){return(Yt=a._emscripten_bind_McGePoint3d_set_z_1=a.asm.r).apply(null,arguments)},Qt=a._emscripten_bind_McGePoint3d___destroy___0=function(){return(Qt=a._emscripten_bind_McGePoint3d___destroy___0=a.asm.s).apply(null,arguments)},Ve=a._emscripten_bind_McGePoint3dArray_McGePoint3dArray_0=function(){return(Ve=a._emscripten_bind_McGePoint3dArray_McGePoint3dArray_0=a.asm.t).apply(null,arguments)},Be=a._emscripten_bind_McGePoint3dArray_append_1=function(){return(Be=a._emscripten_bind_McGePoint3dArray_append_1=a.asm.u).apply(null,arguments)},Wt=a._emscripten_bind_McGePoint3dArray___destroy___0=function(){return(Wt=a._emscripten_bind_McGePoint3dArray___destroy___0=a.asm.v).apply(null,arguments)},Kn=a._emscripten_bind_McGeTool_McGeTool_0=function(){return(Kn=a._emscripten_bind_McGeTool_McGeTool_0=a.asm.w).apply(null,arguments)},nn=a._emscripten_bind_McGeTool_calcArea_1=function(){return(nn=a._emscripten_bind_McGeTool_calcArea_1=a.asm.x).apply(null,arguments)},ct=a._emscripten_bind_McGeTool_pointInPolyline_2=function(){return(ct=a._emscripten_bind_McGeTool_pointInPolyline_2=a.asm.y).apply(null,arguments)},rt=a._emscripten_bind_McGeTool___destroy___0=function(){return(rt=a._emscripten_bind_McGeTool___destroy___0=a.asm.z).apply(null,arguments)},Zt=a._malloc=function(){return(Zt=a._malloc=a.asm.B).apply(null,arguments)};function bn(){function Re(){if(!le&&(le=!0,a.calledRun=!0,!p)){if(ve(O),x(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;){var xt=a.postRun.shift();Z.unshift(xt)}ve(Z)}}if(!(0<de)){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)te();ve(P),0<de||(a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),Re()},1)):Re())}}if(me=function Re(){le||bn(),le||(me=Re)},a.run=bn,a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();function Kt(){}function Zn(Re){return(Re||Kt).F}function Se(Re,xt){var qt=Zn(xt),Lt=qt[Re];return Lt||((Lt=Object.create((xt||Kt).prototype)).C=Re,qt[Re]=Lt)}function Cr(){throw"cannot construct a VoidPtr, no constructor in IDL"}function Xe(Re,xt,qt){Re&&typeof Re=="object"&&(Re=Re.C),xt&&typeof xt=="object"&&(xt=xt.C),qt&&typeof qt=="object"&&(qt=qt.C),this.C=Re===void 0?st():xt===void 0?_emscripten_bind_McGePoint3d_McGePoint3d_1(Re):qt===void 0?_emscripten_bind_McGePoint3d_McGePoint3d_2(Re,xt):gt(Re,xt,qt),Zn(Xe)[this.C]=this}function qe(){this.C=Ve(),Zn(qe)[this.C]=this}function ut(){this.C=Kn(),Zn(ut)[this.C]=this}return bn(),Kt.prototype=Object.create(Kt.prototype),Kt.prototype.constructor=Kt,Kt.prototype.D=Kt,Kt.F={},a.WrapperObject=Kt,a.getCache=Zn,a.wrapPointer=Se,a.castObject=function(Re,xt){return Se(Re.C,xt)},a.NULL=Se(0),a.destroy=function(Re){if(!Re.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";Re.__destroy__(),delete Zn(Re.D)[Re.C]},a.compare=function(Re,xt){return Re.C===xt.C},a.getPointer=function(Re){return Re.C},a.getClass=function(Re){return Re.D},Cr.prototype=Object.create(Kt.prototype),Cr.prototype.constructor=Cr,Cr.prototype.D=Cr,Cr.F={},a.VoidPtr=Cr,Cr.prototype.__destroy__=function(){De(this.C)},Xe.prototype=Object.create(Kt.prototype),Xe.prototype.constructor=Xe,Xe.prototype.D=Xe,Xe.F={},a.McGePoint3d=Xe,Xe.prototype.op_add=function(Re){var xt=this.C;Re&&typeof Re=="object"&&(Re=Re.C),St(xt,Re)},Xe.prototype.op_sub=function(Re){var xt=this.C;Re&&typeof Re=="object"&&(Re=Re.C),Rt(xt,Re)},Xe.prototype.get_x=Xe.prototype.H=function(){return Pt(this.C)},Xe.prototype.set_x=Xe.prototype.R=function(Re){var xt=this.C;Re&&typeof Re=="object"&&(Re=Re.C),Je(xt,Re)},Object.defineProperty(Xe.prototype,"x",{get:Xe.prototype.H,set:Xe.prototype.R}),Xe.prototype.get_y=Xe.prototype.I=function(){return bt(this.C)},Xe.prototype.set_y=Xe.prototype.S=function(Re){var xt=this.C;Re&&typeof Re=="object"&&(Re=Re.C),jt(xt,Re)},Object.defineProperty(Xe.prototype,"y",{get:Xe.prototype.I,set:Xe.prototype.S}),Xe.prototype.get_z=Xe.prototype.J=function(){return Ln(this.C)},Xe.prototype.set_z=Xe.prototype.T=function(Re){var xt=this.C;Re&&typeof Re=="object"&&(Re=Re.C),Yt(xt,Re)},Object.defineProperty(Xe.prototype,"z",{get:Xe.prototype.J,set:Xe.prototype.T}),Xe.prototype.__destroy__=function(){Qt(this.C)},qe.prototype=Object.create(Kt.prototype),qe.prototype.constructor=qe,qe.prototype.D=qe,qe.F={},a.McGePoint3dArray=qe,qe.prototype.append=qe.prototype.append=function(Re){var xt=this.C;Re&&typeof Re=="object"&&(Re=Re.C),Be(xt,Re)},qe.prototype.__destroy__=function(){Wt(this.C)},ut.prototype=Object.create(Kt.prototype),ut.prototype.constructor=ut,ut.prototype.D=ut,ut.F={},a.McGeTool=ut,ut.prototype.calcArea=function(Re){var xt=this.C;return Re&&typeof Re=="object"&&(Re=Re.C),nn(xt,Re)},ut.prototype.pointInPolyline=function(Re,xt){var qt=this.C;return Re&&typeof Re=="object"&&(Re=Re.C),xt&&typeof xt=="object"&&(xt=xt.C),!!ct(qt,Re,xt)},ut.prototype.__destroy__=function(){rt(this.C)},o.ready});return typeof exports=="object"&&typeof module=="object"?module.exports=r:typeof define=="function"&&define.amd?define([],function(){return r}):typeof exports=="object"&&(exports.mxcadassembly=r),r()}function loadMxcadAssembly(){mxcadassemblyinit().then(function(T){store.commit("setMxassembly",T)})}function _load(T){window.MxDocumentReady=void 0,window.MxUiMain=r=>{const o=r("./MxFun").MxFun;window.THREE=o.getTHREE(),store.commit("setMxFun",o),store.events.emit("MxUiMain",r),window.MxUiMain=void 0},window.MxMain=r=>(store.events.emit("MxMain",r),window.MxMain=void 0,registerMxDbEntity(),T(),0),mxfun(),loadMxcadAssembly()}async function loadCoreCode(){return new Promise(async(T,r)=>{try{if(store.state.MxFun)return console.warn("程序已自动调用loadCoreCode 无需主动调用 | The program has automatically called loadCoreCode without actively calling it"),void T();_load(T)}catch(o){r({code:"error",msg:o})}})}function createCanvas(T="mx-canvas"){let r=document.getElementById(T);return r||((r=document.createElement("canvas")).id=T),r}function createCanvasParent(T=createCanvas()){let r;return T||(T=createCanvas()),T.parentNode?r=T.parentNode:((r=document.createElement("div")).style.height="80vh",r.appendChild(T)),r}async function dynamicImport(T){let r;switch(T){case"jquery":r=await dynamicImportJquery();break;case"element-resize-event-polyfill":r=await dynamicImportResize()}return r}async function dynamicImportResize(){try{const T=await Promise.resolve().then(function(){return elementResizeEventPolyfill_umd_min$2});return T.default?T.default:T}catch(T){console.log("import动态导入：element-resize-event-polyfill失败！",T)}}async function dynamicImportJquery(){try{const T=await Promise.resolve().then(function(){return jquery$1});return T.default?T.default:T}catch(T){console.log("import动态导入：jquery失败！",T)}}window.$=window.jQuery=jquery,_load(()=>{});var lodash=createCommonjsModule(function(T,r){(function(){var o,a="Expected a function",x="__lodash_hash_undefined__",u="__lodash_placeholder__",M=16,I=32,H=64,G=128,L=256,y=1/0,D=9007199254740991,C=NaN,B=4294967295,z=[["ary",G],["bind",1],["bindKey",2],["curry",8],["curryRight",M],["flip",512],["partial",I],["partialRight",H],["rearg",L]],A="[object Arguments]",S="[object Array]",q="[object Boolean]",W="[object Date]",_="[object Error]",R="[object Function]",v="[object GeneratorFunction]",V="[object Map]",Y="[object Number]",c="[object Object]",p="[object Promise]",m="[object RegExp]",f="[object Set]",N="[object String]",P="[object Symbol]",O="[object WeakMap]",Z="[object ArrayBuffer]",te="[object DataView]",de="[object Float32Array]",me="[object Float64Array]",we="[object Int8Array]",ge="[object Int16Array]",Le="[object Int32Array]",Pe="[object Uint8Array]",ae="[object Uint8ClampedArray]",ve="[object Uint16Array]",Ie="[object Uint32Array]",ze=/\b__p \+= '';/g,He=/\b(__p \+=) '' \+/g,at=/(__e\(.*?\)|\b__t\)) \+\n'';/g,tt=/&(?:amp|lt|gt|quot|#39);/g,le=/[&<>"']/g,De=RegExp(tt.source),st=RegExp(le.source),gt=/<%-([\s\S]+?)%>/g,St=/<%([\s\S]+?)%>/g,Rt=/<%=([\s\S]+?)%>/g,Pt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Je=/^\w*$/,bt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,jt=/[\\^$.*+?()[\]{}|]/g,Ln=RegExp(jt.source),Yt=/^\s+/,Qt=/\s/,Ve=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Be=/\{\n\/\* \[wrapped with (.+)\] \*/,Wt=/,? & /,Kn=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,nn=/[()=,{}\[\]\/\s]/,ct=/\\(\\)?/g,rt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Zt=/\w*$/,bn=/^[-+]0x[0-9a-f]+$/i,Kt=/^0b[01]+$/i,Zn=/^\[object .+?Constructor\]$/,Se=/^0o[0-7]+$/i,Cr=/^(?:0|[1-9]\d*)$/,Xe=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,qe=/($^)/,ut=/['\n\r\u2028\u2029\\]/g,Re="\\ud800-\\udfff",xt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",qt="\\u2700-\\u27bf",Lt="a-z\\xdf-\\xf6\\xf8-\\xff",En="A-Z\\xc0-\\xd6\\xd8-\\xde",yr="\\ufe0e\\ufe0f",pr="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Mr="["+Re+"]",Si="["+pr+"]",ci="["+xt+"]",Ni="\\d+",Jr="["+qt+"]",ai="["+Lt+"]",hr="[^"+Re+pr+Ni+qt+Lt+En+"]",xi="\\ud83c[\\udffb-\\udfff]",J="[^"+Re+"]",Lr="(?:\\ud83c[\\udde6-\\uddff]){2}",Pi="[\\ud800-\\udbff][\\udc00-\\udfff]",zn="["+En+"]",Zi="\\u200d",mo="(?:"+ai+"|"+hr+")",mn="(?:"+zn+"|"+hr+")",Ca="(?:['’](?:d|ll|m|re|s|t|ve))?",ka="(?:['’](?:D|LL|M|RE|S|T|VE))?",Sa="(?:"+ci+"|"+xi+")?",Co="["+yr+"]?",Vi=Co+Sa+"(?:"+Zi+"(?:"+[J,Lr,Pi].join("|")+")"+Co+Sa+")*",Wa="(?:"+[Jr,Lr,Pi].join("|")+")"+Vi,Ki="(?:"+[J+ci+"?",ci,Lr,Pi,Mr].join("|")+")",ja=RegExp("['’]","g"),Ja=RegExp(ci,"g"),ra=RegExp(xi+"(?="+xi+")|"+Ki+Vi,"g"),go=RegExp([zn+"?"+ai+"+"+Ca+"(?="+[Si,zn,"$"].join("|")+")",mn+"+"+ka+"(?="+[Si,zn+mo,"$"].join("|")+")",zn+"?"+mo+"+"+Ca,zn+"+"+ka,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ni,Wa].join("|"),"g"),ia=RegExp("["+Zi+Re+xt+yr+"]"),So=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,aa=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Oi=-1,zr={};zr[de]=zr[me]=zr[we]=zr[ge]=zr[Le]=zr[Pe]=zr[ae]=zr[ve]=zr[Ie]=!0,zr[A]=zr[S]=zr[Z]=zr[q]=zr[te]=zr[W]=zr[_]=zr[R]=zr[V]=zr[Y]=zr[c]=zr[m]=zr[f]=zr[N]=zr[O]=!1;var Sr={};Sr[A]=Sr[S]=Sr[Z]=Sr[te]=Sr[q]=Sr[W]=Sr[de]=Sr[me]=Sr[we]=Sr[ge]=Sr[Le]=Sr[V]=Sr[Y]=Sr[c]=Sr[m]=Sr[f]=Sr[N]=Sr[P]=Sr[Pe]=Sr[ae]=Sr[ve]=Sr[Ie]=!0,Sr[_]=Sr[R]=Sr[O]=!1;var xa={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Da=parseFloat,Do=parseInt,ro=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,ui=typeof self=="object"&&self&&self.Object===Object&&self,kr=ro||ui||Function("return this")(),ee=r&&!r.nodeType&&r,Ce=ee&&T&&!T.nodeType&&T,se=Ce&&Ce.exports===ee,_e=se&&ro.process,Ke=function(){try{return Ce&&Ce.require&&Ce.require("util").types||_e&&_e.binding&&_e.binding("util")}catch{}}(),mt=Ke&&Ke.isArrayBuffer,It=Ke&&Ke.isDate,Gt=Ke&&Ke.isMap,Mn=Ke&&Ke.isRegExp,Vn=Ke&&Ke.isSet,qn=Ke&&Ke.isTypedArray;function $r(xe,Me,Ne){switch(Ne.length){case 0:return xe.call(Me);case 1:return xe.call(Me,Ne[0]);case 2:return xe.call(Me,Ne[0],Ne[1]);case 3:return xe.call(Me,Ne[0],Ne[1],Ne[2])}return xe.apply(Me,Ne)}function ha(xe,Me,Ne,Qe){for(var ht=-1,lt=xe==null?0:xe.length;++ht<lt;){var Ot=xe[ht];Me(Qe,Ot,Ne(Ot),xe)}return Qe}function wi(xe,Me){for(var Ne=-1,Qe=xe==null?0:xe.length;++Ne<Qe&&Me(xe[Ne],Ne,xe)!==!1;);return xe}function hs(xe,Me){for(var Ne=-1,Qe=xe==null?0:xe.length;++Ne<Qe;)if(!Me(xe[Ne],Ne,xe))return!1;return!0}function io(xe,Me){for(var Ne=-1,Qe=xe==null?0:xe.length,ht=0,lt=[];++Ne<Qe;){var Ot=xe[Ne];Me(Ot,Ne,xe)&&(lt[ht++]=Ot)}return lt}function ao(xe,Me){return!(xe==null||!xe.length)&&ds(xe,Me,0)>-1}function Di(xe,Me,Ne){for(var Qe=-1,ht=xe==null?0:xe.length;++Qe<ht;)if(Ne(Me,xe[Qe]))return!0;return!1}function Qr(xe,Me){for(var Ne=-1,Qe=xe==null?0:xe.length,ht=Array(Qe);++Ne<Qe;)ht[Ne]=Me(xe[Ne],Ne,xe);return ht}function Fi(xe,Me){for(var Ne=-1,Qe=Me.length,ht=xe.length;++Ne<Qe;)xe[ht+Ne]=Me[Ne];return xe}function Uo(xe,Me,Ne,Qe){var ht=-1,lt=xe==null?0:xe.length;for(Qe&&lt&&(Ne=xe[++ht]);++ht<lt;)Ne=Me(Ne,xe[ht],ht,xe);return Ne}function Cn(xe,Me,Ne,Qe){var ht=xe==null?0:xe.length;for(Qe&&ht&&(Ne=xe[--ht]);ht--;)Ne=Me(Ne,xe[ht],ht,xe);return Ne}function ps(xe,Me){for(var Ne=-1,Qe=xe==null?0:xe.length;++Ne<Qe;)if(Me(xe[Ne],Ne,xe))return!0;return!1}var Zl=$n("length");function dl(xe,Me,Ne){var Qe;return Ne(xe,function(ht,lt,Ot){if(Me(ht,lt,Ot))return Qe=lt,!1}),Qe}function qa(xe,Me,Ne,Qe){for(var ht=xe.length,lt=Ne+(Qe?1:-1);Qe?lt--:++lt<ht;)if(Me(xe[lt],lt,xe))return lt;return-1}function ds(xe,Me,Ne){return Me==Me?function(Qe,ht,lt){for(var Ot=lt-1,Pn=Qe.length;++Ot<Pn;)if(Qe[Ot]===ht)return Ot;return-1}(xe,Me,Ne):qa(xe,Xa,Ne)}function rr(xe,Me,Ne,Qe){for(var ht=Ne-1,lt=xe.length;++ht<lt;)if(Qe(xe[ht],Me))return ht;return-1}function Xa(xe){return xe!=xe}function qr(xe,Me){var Ne=xe==null?0:xe.length;return Ne?Eo(xe,Me)/Ne:C}function $n(xe){return function(Me){return Me==null?o:Me[xe]}}function fs(xe){return function(Me){return xe==null?o:xe[Me]}}function ms(xe,Me,Ne,Qe,ht){return ht(xe,function(lt,Ot,Pn){Ne=Qe?(Qe=!1,lt):Me(Ne,lt,Ot,Pn)}),Ne}function Eo(xe,Me){for(var Ne,Qe=-1,ht=xe.length;++Qe<ht;){var lt=Me(xe[Qe]);lt!==o&&(Ne=Ne===o?lt:Ne+lt)}return Ne}function Ho(xe,Me){for(var Ne=-1,Qe=Array(xe);++Ne<xe;)Qe[Ne]=Me(Ne);return Qe}function yo(xe){return xe&&xe.slice(0,ce(xe)+1).replace(Yt,"")}function $i(xe){return function(Me){return xe(Me)}}function vo(xe,Me){return Qr(Me,function(Ne){return xe[Ne]})}function ln(xe,Me){return xe.has(Me)}function ks(xe,Me){for(var Ne=-1,Qe=xe.length;++Ne<Qe&&ds(Me,xe[Ne],0)>-1;);return Ne}function Wo(xe,Me){for(var Ne=xe.length;Ne--&&ds(Me,xe[Ne],0)>-1;);return Ne}var Kl=fs({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),iu=fs({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Na(xe){return"\\"+xa[xe]}function Ao(xe){return ia.test(xe)}function Po(xe){var Me=-1,Ne=Array(xe.size);return xe.forEach(function(Qe,ht){Ne[++Me]=[ht,Qe]}),Ne}function wa(xe,Me){return function(Ne){return xe(Me(Ne))}}function w(xe,Me){for(var Ne=-1,Qe=xe.length,ht=0,lt=[];++Ne<Qe;){var Ot=xe[Ne];Ot!==Me&&Ot!==u||(xe[Ne]=u,lt[ht++]=Ne)}return lt}function E(xe){var Me=-1,Ne=Array(xe.size);return xe.forEach(function(Qe){Ne[++Me]=Qe}),Ne}function X(xe){return Ao(xe)?function(Me){for(var Ne=ra.lastIndex=0;ra.test(Me);)++Ne;return Ne}(xe):Zl(xe)}function re(xe){return Ao(xe)?function(Me){return Me.match(ra)||[]}(xe):function(Me){return Me.split("")}(xe)}function ce(xe){for(var Me=xe.length;Me--&&Qt.test(xe.charAt(Me)););return Me}var fe=fs({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),be=function xe(Me){var Ne,Qe=(Me=Me==null?kr:be.defaults(kr.Object(),Me,be.pick(kr,aa))).Array,ht=Me.Date,lt=Me.Error,Ot=Me.Function,Pn=Me.Math,_n=Me.Object,Xn=Me.RegExp,ni=Me.String,Nr=Me.TypeError,oa=Qe.prototype,Vr=Ot.prototype,vr=_n.prototype,Ea=Me["__core-js_shared__"],Ar=Vr.toString,Fn=vr.hasOwnProperty,Jo=0,qo=(Ne=/[^.]+$/.exec(Ea&&Ea.keys&&Ea.keys.IE_PROTO||""))?"Symbol(src)_1."+Ne:"",kn=vr.toString,Xo=Ar.call(_n),Aa=kr._,Pa=Xn("^"+Ar.call(Fn).replace(jt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),hi=se?Me.Buffer:o,Ri=Me.Symbol,Fr=Me.Uint8Array,Ur=hi?hi.allocUnsafe:o,Dr=wa(_n.getPrototypeOf,_n),Oa=_n.create,Ei=vr.propertyIsEnumerable,jn=oa.splice,ei=Ri?Ri.isConcatSpreadable:o,Zr=Ri?Ri.iterator:o,Pr=Ri?Ri.toStringTag:o,en=function(){try{var s=ko(_n,"defineProperty");return s({},"",{}),s}catch{}}(),Yo=Me.clearTimeout!==kr.clearTimeout&&Me.clearTimeout,Zo=ht&&ht.now!==kr.Date.now&&ht.now,Va=Me.setTimeout!==kr.setTimeout&&Me.setTimeout,dr=Pn.ceil,Li=Pn.floor,fl=_n.getOwnPropertySymbols,js=hi?hi.isBuffer:o,Ns=Me.isFinite,oo=oa.join,gs=wa(_n.keys,_n),oi=Pn.max,Bi=Pn.min,$l=ht.now,Ql=Me.parseInt,ml=Pn.random,ke=oa.reverse,ot=ko(Me,"DataView"),vt=ko(Me,"Map"),Dt=ko(Me,"Promise"),kt=ko(Me,"Set"),on=ko(Me,"WeakMap"),rn=ko(_n,"create"),pn=on&&new on,un={},Br=Ms(ot),_r=Ms(vt),fr=Ms(Dt),jr=Ms(kt),ir=Ms(on),bi=Ri?Ri.prototype:o,Ii=bi?bi.valueOf:o,Gi=bi?bi.toString:o;function ye(s){if(Wr(s)&&!br(s)&&!(s instanceof xr)){if(s instanceof Or)return s;if(Fn.call(s,"__wrapped__"))return kl(s)}return new Or(s)}var Wi=function(){function s(){}return function(d){if(!dn(d))return{};if(Oa)return Oa(d);s.prototype=d;var j=new s;return s.prototype=o,j}}();function ba(){}function Or(s,d){this.__wrapped__=s,this.__actions__=[],this.__chain__=!!d,this.__index__=0,this.__values__=o}function xr(s){this.__wrapped__=s,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=B,this.__views__=[]}function Qi(s){var d=-1,j=s==null?0:s.length;for(this.clear();++d<j;){var ie=s[d];this.set(ie[0],ie[1])}}function Fa(s){var d=-1,j=s==null?0:s.length;for(this.clear();++d<j;){var ie=s[d];this.set(ie[0],ie[1])}}function so(s){var d=-1,j=s==null?0:s.length;for(this.clear();++d<j;){var ie=s[d];this.set(ie[0],ie[1])}}function Oo(s){var d=-1,j=s==null?0:s.length;for(this.__data__=new so;++d<j;)this.add(s[d])}function Ya(s){var d=this.__data__=new Fa(s);this.size=d.size}function Lh(s,d){var j=br(s),ie=!j&&os(s),he=!j&&!ie&&No(s),Ee=!j&&!ie&&!he&&ol(s),Ue=j||ie||he||Ee,it=Ue?Ho(s.length,ni):[],yt=it.length;for(var Vt in s)!d&&!Fn.call(s,Vt)||Ue&&(Vt=="length"||he&&(Vt=="offset"||Vt=="parent")||Ee&&(Vt=="buffer"||Vt=="byteLength"||Vt=="byteOffset")||Ka(Vt,yt))||it.push(Vt);return it}function Ih(s){var d=s.length;return d?s[ih(0,d-1)]:o}function Hu(s,d,j){(j!==o&&!ki(s[d],j)||j===o&&!(d in s))&&Ko(s,d,j)}function ec(s,d,j){var ie=s[d];Fn.call(s,d)&&ki(ie,j)&&(j!==o||d in s)||Ko(s,d,j)}function au(s,d){for(var j=s.length;j--;)if(ki(s[j][0],d))return j;return-1}function pp(s,d,j,ie){return Ro(s,function(he,Ee,Ue){d(ie,he,j(he),Ue)}),ie}function kh(s,d){return s&&uo(d,zi(d),s)}function Ko(s,d,j){d=="__proto__"&&en?en(s,d,{configurable:!0,enumerable:!0,value:j,writable:!0}):s[d]=j}function Wu(s,d){for(var j=-1,ie=d.length,he=Qe(ie),Ee=s==null;++j<ie;)he[j]=Ee?o:Jl(s,d[j]);return he}function Vs(s,d,j){return s==s&&(j!==o&&(s=s<=j?s:j),d!==o&&(s=s>=d?s:d)),s}function lo(s,d,j,ie,he,Ee){var Ue,it=1&d,yt=2&d,Vt=4&d;if(j&&(Ue=he?j(s,ie,he,Ee):j(s)),Ue!==o)return Ue;if(!dn(s))return s;var Ft=br(s);if(Ft){if(Ue=function(Ut){var tn=Ut.length,ar=new Ut.constructor(tn);return tn&&typeof Ut[0]=="string"&&Fn.call(Ut,"index")&&(ar.index=Ut.index,ar.input=Ut.input),ar}(s),!it)return ma(s,Ue)}else{var $t=Ji(s),On=$t==R||$t==v;if(No(s))return ic(s,it);if($t==c||$t==A||On&&!he){if(Ue=yt||On?{}:Pl(s),!it)return yt?function(Ut,tn){return uo(Ut,hc(Ut),tn)}(s,function(Ut,tn){return Ut&&uo(tn,ya(tn),Ut)}(Ue,s)):function(Ut,tn){return uo(Ut,bs(Ut),tn)}(s,kh(Ue,s))}else{if(!Sr[$t])return he?s:{};Ue=function(Ut,tn,ar){var fn,mr=Ut.constructor;switch(tn){case Z:return pu(Ut);case q:case W:return new mr(+Ut);case te:return function(cr,Gr){var Un=Gr?pu(cr.buffer):cr.buffer;return new cr.constructor(Un,cr.byteOffset,cr.byteLength)}(Ut,ar);case de:case me:case we:case ge:case Le:case Pe:case ae:case ve:case Ie:return Tl(Ut,ar);case V:return new mr;case Y:case N:return new mr(Ut);case m:return function(cr){var Gr=new cr.constructor(cr.source,Zt.exec(cr));return Gr.lastIndex=cr.lastIndex,Gr}(Ut);case f:return new mr;case P:return fn=Ut,Ii?_n(Ii.call(fn)):{}}}(s,$t,it)}}Ee||(Ee=new Ya);var Bn=Ee.get(s);if(Bn)return Bn;Ee.set(s,Ue),Du(s)?s.forEach(function(Ut){Ue.add(lo(Ut,d,j,Ut,s,Ee))}):Pc(s)&&s.forEach(function(Ut,tn){Ue.set(tn,lo(Ut,d,j,tn,s,Ee))});var Yn=Ft?o:(Vt?yt?Ys:uc:yt?ya:zi)(s);return wi(Yn||s,function(Ut,tn){Yn&&(Ut=s[tn=Ut]),ec(Ue,tn,lo(Ut,d,j,tn,s,Ee))}),Ue}function jh(s,d,j){var ie=j.length;if(s==null)return!ie;for(s=_n(s);ie--;){var he=j[ie],Ee=d[he],Ue=s[he];if(Ue===o&&!(he in s)||!Ee(Ue))return!1}return!0}function Ju(s,d,j){if(typeof s!="function")throw new Nr(a);return fc(function(){s.apply(o,j)},d)}function gl(s,d,j,ie){var he=-1,Ee=ao,Ue=!0,it=s.length,yt=[],Vt=d.length;if(!it)return yt;j&&(d=Qr(d,$i(j))),ie?(Ee=Di,Ue=!1):d.length>=200&&(Ee=ln,Ue=!1,d=new Oo(d));e:for(;++he<it;){var Ft=s[he],$t=j==null?Ft:j(Ft);if(Ft=ie||Ft!==0?Ft:0,Ue&&$t==$t){for(var On=Vt;On--;)if(d[On]===$t)continue e;yt.push(Ft)}else Ee(d,$t,ie)||yt.push(Ft)}return yt}ye.templateSettings={escape:gt,evaluate:St,interpolate:Rt,variable:"",imports:{_:ye}},ye.prototype=ba.prototype,ye.prototype.constructor=ye,Or.prototype=Wi(ba.prototype),Or.prototype.constructor=Or,xr.prototype=Wi(ba.prototype),xr.prototype.constructor=xr,Qi.prototype.clear=function(){this.__data__=rn?rn(null):{},this.size=0},Qi.prototype.delete=function(s){var d=this.has(s)&&delete this.__data__[s];return this.size-=d?1:0,d},Qi.prototype.get=function(s){var d=this.__data__;if(rn){var j=d[s];return j===x?o:j}return Fn.call(d,s)?d[s]:o},Qi.prototype.has=function(s){var d=this.__data__;return rn?d[s]!==o:Fn.call(d,s)},Qi.prototype.set=function(s,d){var j=this.__data__;return this.size+=this.has(s)?0:1,j[s]=rn&&d===o?x:d,this},Fa.prototype.clear=function(){this.__data__=[],this.size=0},Fa.prototype.delete=function(s){var d=this.__data__,j=au(d,s);return!(j<0||(j==d.length-1?d.pop():jn.call(d,j,1),--this.size,0))},Fa.prototype.get=function(s){var d=this.__data__,j=au(d,s);return j<0?o:d[j][1]},Fa.prototype.has=function(s){return au(this.__data__,s)>-1},Fa.prototype.set=function(s,d){var j=this.__data__,ie=au(j,s);return ie<0?(++this.size,j.push([s,d])):j[ie][1]=d,this},so.prototype.clear=function(){this.size=0,this.__data__={hash:new Qi,map:new(vt||Fa),string:new Qi}},so.prototype.delete=function(s){var d=Zs(this,s).delete(s);return this.size-=d?1:0,d},so.prototype.get=function(s){return Zs(this,s).get(s)},so.prototype.has=function(s){return Zs(this,s).has(s)},so.prototype.set=function(s,d){var j=Zs(this,s),ie=j.size;return j.set(s,d),this.size+=j.size==ie?0:1,this},Oo.prototype.add=Oo.prototype.push=function(s){return this.__data__.set(s,x),this},Oo.prototype.has=function(s){return this.__data__.has(s)},Ya.prototype.clear=function(){this.__data__=new Fa,this.size=0},Ya.prototype.delete=function(s){var d=this.__data__,j=d.delete(s);return this.size=d.size,j},Ya.prototype.get=function(s){return this.__data__.get(s)},Ya.prototype.has=function(s){return this.__data__.has(s)},Ya.prototype.set=function(s,d){var j=this.__data__;if(j instanceof Fa){var ie=j.__data__;if(!vt||ie.length<199)return ie.push([s,d]),this.size=++j.size,this;j=this.__data__=new so(ie)}return j.set(s,d),this.size=j.size,this};var Ro=Hs(Ba),qu=Hs(Fs,!0);function dp(s,d){var j=!0;return Ro(s,function(ie,he,Ee){return j=!!d(ie,he,Ee)}),j}function xo(s,d,j){for(var ie=-1,he=s.length;++ie<he;){var Ee=s[ie],Ue=d(Ee);if(Ue!=null&&(it===o?Ue==Ue&&!pi(Ue):j(Ue,it)))var it=Ue,yt=Ee}return yt}function Xu(s,d){var j=[];return Ro(s,function(ie,he,Ee){d(ie,he,Ee)&&j.push(ie)}),j}function pa(s,d,j,ie,he){var Ee=-1,Ue=s.length;for(j||(j=mu),he||(he=[]);++Ee<Ue;){var it=s[Ee];d>0&&j(it)?d>1?pa(it,d-1,j,ie,he):Fi(he,it):ie||(he[he.length]=it)}return he}var ou=Sl(),Yu=Sl(!0);function Ba(s,d){return s&&ou(s,d,zi)}function Fs(s,d){return s&&Yu(s,d,zi)}function tc(s,d){return io(d,function(j){return za(s[j])})}function ys(s,d){for(var j=0,ie=(d=Lo(d,s)).length;s!=null&&j<ie;)s=s[_a(d[j++])];return j&&j==ie?s:o}function Nh(s,d,j){var ie=d(s);return br(s)?ie:Fi(ie,j(s))}function da(s){return s==null?s===o?"[object Undefined]":"[object Null]":Pr&&Pr in _n(s)?function(d){var j=Fn.call(d,Pr),ie=d[Pr];try{d[Pr]=o;var he=!0}catch{}var Ee=kn.call(d);return he&&(j?d[Pr]=ie:delete d[Pr]),Ee}(s):function(d){return kn.call(d)}(s)}function Zu(s,d){return s>d}function fp(s,d){return s!=null&&Fn.call(s,d)}function Vh(s,d){return s!=null&&d in _n(s)}function Ku(s,d,j){for(var ie=j?Di:ao,he=s[0].length,Ee=s.length,Ue=Ee,it=Qe(Ee),yt=1/0,Vt=[];Ue--;){var Ft=s[Ue];Ue&&d&&(Ft=Qr(Ft,$i(d))),yt=Bi(Ft.length,yt),it[Ue]=!j&&(d||he>=120&&Ft.length>=120)?new Oo(Ue&&Ft):o}Ft=s[0];var $t=-1,On=it[0];e:for(;++$t<he&&Vt.length<yt;){var Bn=Ft[$t],Yn=d?d(Bn):Bn;if(Bn=j||Bn!==0?Bn:0,!(On?ln(On,Yn):ie(Vt,Yn,j))){for(Ue=Ee;--Ue;){var Ut=it[Ue];if(!(Ut?ln(Ut,Yn):ie(s[Ue],Yn,j)))continue e}On&&On.push(Yn),Vt.push(Bn)}}return Vt}function yl(s,d,j){var ie=(s=qh(s,d=Lo(d,s)))==null?s:s[_a($a(d))];return ie==null?o:$r(ie,s,j)}function Fh(s){return Wr(s)&&da(s)==A}function nc(s,d,j,ie,he){return s===d||(s==null||d==null||!Wr(s)&&!Wr(d)?s!=s&&d!=d:function(Ee,Ue,it,yt,Vt,Ft){var $t=br(Ee),On=br(Ue),Bn=$t?S:Ji(Ee),Yn=On?S:Ji(Ue),Ut=(Bn=Bn==A?c:Bn)==c,tn=(Yn=Yn==A?c:Yn)==c,ar=Bn==Yn;if(ar&&No(Ee)){if(!No(Ue))return!1;$t=!0,Ut=!1}if(ar&&!Ut)return Ft||(Ft=new Ya),$t||ol(Ee)?cc(Ee,Ue,it,yt,Vt,Ft):function(Un,or,ji,ri,ca,li,ea){switch(ji){case te:if(Un.byteLength!=or.byteLength||Un.byteOffset!=or.byteOffset)return!1;Un=Un.buffer,or=or.buffer;case Z:return!(Un.byteLength!=or.byteLength||!li(new Fr(Un),new Fr(or)));case q:case W:case Y:return ki(+Un,+or);case _:return Un.name==or.name&&Un.message==or.message;case m:case N:return Un==or+"";case V:var eo=Po;case f:var Ps=1&ri;if(eo||(eo=E),Un.size!=or.size&&!Ps)return!1;var Os=ea.get(Un);if(Os)return Os==or;ri|=2,ea.set(Un,or);var zo=cc(eo(Un),eo(or),ri,ca,li,ea);return ea.delete(Un),zo;case P:if(Ii)return Ii.call(Un)==Ii.call(or)}return!1}(Ee,Ue,Bn,it,yt,Vt,Ft);if(!(1&it)){var fn=Ut&&Fn.call(Ee,"__wrapped__"),mr=tn&&Fn.call(Ue,"__wrapped__");if(fn||mr){var cr=fn?Ee.value():Ee,Gr=mr?Ue.value():Ue;return Ft||(Ft=new Ya),Vt(cr,Gr,it,yt,Ft)}}return!!ar&&(Ft||(Ft=new Ya),function(Un,or,ji,ri,ca,li){var ea=1&ji,eo=uc(Un),Ps=eo.length;if(Ps!=uc(or).length&&!ea)return!1;for(var Os=Ps;Os--;){var zo=eo[Os];if(!(ea?zo in or:Fn.call(or,zo)))return!1}var zc=li.get(Un),Uc=li.get(or);if(zc&&Uc)return zc==or&&Uc==Un;var Yl=!0;li.set(Un,or),li.set(or,Un);for(var Nu=ea;++Os<Ps;){var ul=Un[zo=eo[Os]],Hc=or[zo];if(ri)var Wc=ea?ri(Hc,ul,zo,or,Un,li):ri(ul,Hc,zo,Un,or,li);if(!(Wc===o?ul===Hc||ca(ul,Hc,ji,ri,li):Wc)){Yl=!1;break}Nu||(Nu=zo=="constructor")}if(Yl&&!Nu){var hl=Un.constructor,yi=or.constructor;hl==yi||!("constructor"in Un)||!("constructor"in or)||typeof hl=="function"&&hl instanceof hl&&typeof yi=="function"&&yi instanceof yi||(Yl=!1)}return li.delete(Un),li.delete(or),Yl}(Ee,Ue,it,yt,Vt,Ft))}(s,d,j,ie,nc,he))}function $u(s,d,j,ie){var he=j.length,Ee=he,Ue=!ie;if(s==null)return!Ee;for(s=_n(s);he--;){var it=j[he];if(Ue&&it[2]?it[1]!==s[it[0]]:!(it[0]in s))return!1}for(;++he<Ee;){var yt=(it=j[he])[0],Vt=s[yt],Ft=it[1];if(Ue&&it[2]){if(Vt===o&&!(yt in s))return!1}else{var $t=new Ya;if(ie)var On=ie(Vt,Ft,yt,s,d,$t);if(!(On===o?nc(Ft,Vt,3,ie,$t):On))return!1}}return!0}function Bh(s){return!(!dn(s)||(d=s,qo&&qo in d))&&(za(s)?Pa:Zn).test(Ms(s));var d}function Qu(s){return typeof s=="function"?s:s==null?Ia:typeof s=="object"?br(s)?Bs(s[0],s[1]):nh(s):ll(s)}function eh(s){if(!Rl(s))return gs(s);var d=[];for(var j in _n(s))Fn.call(s,j)&&j!="constructor"&&d.push(j);return d}function th(s,d){return s<d}function Gh(s,d){var j=-1,ie=_i(s)?Qe(s.length):[];return Ro(s,function(he,Ee,Ue){ie[++j]=d(he,Ee,Ue)}),ie}function nh(s){var d=Ks(s);return d.length==1&&d[0][2]?Il(d[0][0],d[0][1]):function(j){return j===s||$u(j,s,d)}}function Bs(s,d){return $s(s)&&Ll(d)?Il(_a(s),d):function(j){var ie=Jl(j,s);return ie===o&&ie===d?ql(j,s):nc(d,ie,3)}}function $o(s,d,j,ie,he){s!==d&&ou(d,function(Ee,Ue){if(he||(he=new Ya),dn(Ee))(function(yt,Vt,Ft,$t,On,Bn,Yn){var Ut=hh(yt,Ft),tn=hh(Vt,Ft),ar=Yn.get(tn);if(ar)Hu(yt,Ft,ar);else{var fn=Bn?Bn(Ut,tn,Ft+"",yt,Vt,Yn):o,mr=fn===o;if(mr){var cr=br(tn),Gr=!cr&&No(tn),Un=!cr&&!Gr&&ol(tn);fn=tn,cr||Gr||Un?br(Ut)?fn=Ut:Hr(Ut)?fn=ma(Ut):Gr?(mr=!1,fn=ic(tn,!0)):Un?(mr=!1,fn=Tl(tn,!0)):fn=[]:Ds(tn)||os(tn)?(fn=Ut,os(Ut)?fn=ss(Ut):dn(Ut)&&!za(Ut)||(fn=Pl(tn))):mr=!1}mr&&(Yn.set(tn,fn),On(fn,tn,$t,Bn,Yn),Yn.delete(tn)),Hu(yt,Ft,fn)}})(s,d,Ue,j,$o,ie,he);else{var it=ie?ie(hh(s,Ue),Ee,Ue+"",s,d,he):o;it===o&&(it=Ee),Hu(s,Ue,it)}},ya)}function rh(s,d){var j=s.length;if(j)return Ka(d+=d<0?j:0,j)?s[d]:o}function zh(s,d,j){var ie=-1;return d=Qr(d=d.length?Qr(d,function(he){return br(he)?function(Ee){return ys(Ee,he.length===1?he[0]:he)}:he}):[Ia],$i(In())),function(he,Ee){var Ue=he.length;for(he.sort(Ee);Ue--;)he[Ue]=he[Ue].value;return he}(Gh(s,function(he,Ee,Ue){return{criteria:Qr(d,function(it){return it(he)}),index:++ie,value:he}}),function(he,Ee){return function(Ue,it,yt){for(var Vt=-1,Ft=Ue.criteria,$t=it.criteria,On=Ft.length,Bn=yt.length;++Vt<On;){var Yn=Cl(Ft[Vt],$t[Vt]);if(Yn)return Vt>=Bn?Yn:Yn*(yt[Vt]=="desc"?-1:1)}return Ue.index-it.index}(he,Ee,j)})}function Uh(s,d,j){for(var ie=-1,he=d.length,Ee={};++ie<he;){var Ue=d[ie],it=ys(s,Ue);j(it,Ue)&&xl(Ee,Lo(Ue,s),it)}return Ee}function su(s,d,j,ie){var he=ie?rr:ds,Ee=-1,Ue=d.length,it=s;for(s===d&&(d=ma(d)),j&&(it=Qr(s,$i(j)));++Ee<Ue;)for(var yt=0,Vt=d[Ee],Ft=j?j(Vt):Vt;(yt=he(it,Ft,yt,ie))>-1;)it!==s&&jn.call(it,yt,1),jn.call(s,yt,1);return s}function lu(s,d){for(var j=s?d.length:0,ie=j-1;j--;){var he=d[j];if(j==ie||he!==Ee){var Ee=he;Ka(he)?jn.call(s,he,1):vs(s,he)}}return s}function ih(s,d){return s+Li(ml()*(d-s+1))}function vl(s,d){var j="";if(!s||d<1||d>D)return j;do d%2&&(j+=s),(d=Li(d/2))&&(s+=s);while(d);return j}function wr(s,d){return ph(Jh(s,d,Ia),s+"")}function xl(s,d,j,ie){if(!dn(s))return s;for(var he=-1,Ee=(d=Lo(d,s)).length,Ue=Ee-1,it=s;it!=null&&++he<Ee;){var yt=_a(d[he]),Vt=j;if(yt==="__proto__"||yt==="constructor"||yt==="prototype")return s;if(he!=Ue){var Ft=it[yt];(Vt=ie?ie(Ft,yt,it):o)===o&&(Vt=dn(Ft)?Ft:Ka(d[he+1])?[]:{})}ec(it,yt,Vt),it=it[yt]}return s}var cu=pn?function(s,d){return pn.set(s,d),s}:Ia,uu=en?function(s,d){return en(s,"toString",{configurable:!0,enumerable:!1,value:Qa(d),writable:!0})}:Ia;function Ra(s,d,j){var ie=-1,he=s.length;d<0&&(d=-d>he?0:he+d),(j=j>he?he:j)<0&&(j+=he),he=d>j?0:j-d>>>0,d>>>=0;for(var Ee=Qe(he);++ie<he;)Ee[ie]=s[ie+d];return Ee}function Qo(s,d){var j;return Ro(s,function(ie,he,Ee){return!(j=d(ie,he,Ee))}),!!j}function es(s,d,j){var ie=0,he=s==null?ie:s.length;if(typeof d=="number"&&d==d&&he<=2147483647){for(;ie<he;){var Ee=ie+he>>>1,Ue=s[Ee];Ue!==null&&!pi(Ue)&&(j?Ue<=d:Ue<d)?ie=Ee+1:he=Ee}return he}return ts(s,d,Ia,j)}function ts(s,d,j,ie){var he=0,Ee=s==null?0:s.length;if(Ee===0)return 0;for(var Ue=(d=j(d))!=d,it=d===null,yt=pi(d),Vt=d===o;he<Ee;){var Ft=Li((he+Ee)/2),$t=j(s[Ft]),On=$t!==o,Bn=$t===null,Yn=$t==$t,Ut=pi($t);if(Ue)var tn=ie||Yn;else tn=Vt?Yn&&(ie||On):it?Yn&&On&&(ie||!Bn):yt?Yn&&On&&!Bn&&(ie||!Ut):!Bn&&!Ut&&(ie?$t<=d:$t<d);tn?he=Ft+1:Ee=Ft}return Bi(Ee,4294967294)}function wl(s,d){for(var j=-1,ie=s.length,he=0,Ee=[];++j<ie;){var Ue=s[j],it=d?d(Ue):Ue;if(!j||!ki(it,yt)){var yt=it;Ee[he++]=Ue===0?0:Ue}}return Ee}function Gs(s){return typeof s=="number"?s:pi(s)?C:+s}function fa(s){if(typeof s=="string")return s;if(br(s))return Qr(s,fa)+"";if(pi(s))return Gi?Gi.call(s):"";var d=s+"";return d=="0"&&1/s==-1/0?"-0":d}function Za(s,d,j){var ie=-1,he=ao,Ee=s.length,Ue=!0,it=[],yt=it;if(j)Ue=!1,he=Di;else if(Ee>=200){var Vt=d?null:ch(s);if(Vt)return E(Vt);Ue=!1,he=ln,yt=new Oo}else yt=d?[]:it;e:for(;++ie<Ee;){var Ft=s[ie],$t=d?d(Ft):Ft;if(Ft=j||Ft!==0?Ft:0,Ue&&$t==$t){for(var On=yt.length;On--;)if(yt[On]===$t)continue e;d&&yt.push($t),it.push(Ft)}else he(yt,$t,j)||(yt!==it&&yt.push($t),it.push(Ft))}return it}function vs(s,d){return(s=qh(s,d=Lo(d,s)))==null||delete s[_a($a(d))]}function zs(s,d,j,ie){return xl(s,d,j(ys(s,d)),ie)}function xs(s,d,j,ie){for(var he=s.length,Ee=ie?he:-1;(ie?Ee--:++Ee<he)&&d(s[Ee],Ee,s););return j?Ra(s,ie?0:Ee,ie?Ee+1:he):Ra(s,ie?Ee+1:0,ie?he:Ee)}function ah(s,d){var j=s;return j instanceof xr&&(j=j.value()),Uo(d,function(ie,he){return he.func.apply(he.thisArg,Fi([ie],he.args))},j)}function bl(s,d,j){var ie=s.length;if(ie<2)return ie?Za(s[0]):[];for(var he=-1,Ee=Qe(ie);++he<ie;)for(var Ue=s[he],it=-1;++it<ie;)it!=he&&(Ee[he]=gl(Ee[he]||Ue,s[it],d,j));return Za(pa(Ee,1),d,j)}function Ml(s,d,j){for(var ie=-1,he=s.length,Ee=d.length,Ue={};++ie<he;){var it=ie<Ee?d[ie]:o;j(Ue,s[ie],it)}return Ue}function _l(s){return Hr(s)?s:[]}function hu(s){return typeof s=="function"?s:Ia}function Lo(s,d){return br(s)?s:$s(s,d)?[s]:la(Rr(s))}var Hh=wr;function co(s,d,j){var ie=s.length;return j=j===o?ie:j,!d&&j>=ie?s:Ra(s,d,j)}var rc=Yo||function(s){return kr.clearTimeout(s)};function ic(s,d){if(d)return s.slice();var j=s.length,ie=Ur?Ur(j):new s.constructor(j);return s.copy(ie),ie}function pu(s){var d=new s.constructor(s.byteLength);return new Fr(d).set(new Fr(s)),d}function Tl(s,d){var j=d?pu(s.buffer):s.buffer;return new s.constructor(j,s.byteOffset,s.length)}function Cl(s,d){if(s!==d){var j=s!==o,ie=s===null,he=s==s,Ee=pi(s),Ue=d!==o,it=d===null,yt=d==d,Vt=pi(d);if(!it&&!Vt&&!Ee&&s>d||Ee&&Ue&&yt&&!it&&!Vt||ie&&Ue&&yt||!j&&yt||!he)return 1;if(!ie&&!Ee&&!Vt&&s<d||Vt&&j&&he&&!ie&&!Ee||it&&j&&he||!Ue&&he||!yt)return-1}return 0}function oh(s,d,j,ie){for(var he=-1,Ee=s.length,Ue=j.length,it=-1,yt=d.length,Vt=oi(Ee-Ue,0),Ft=Qe(yt+Vt),$t=!ie;++it<yt;)Ft[it]=d[it];for(;++he<Ue;)($t||he<Ee)&&(Ft[j[he]]=s[he]);for(;Vt--;)Ft[it++]=s[he++];return Ft}function Wh(s,d,j,ie){for(var he=-1,Ee=s.length,Ue=-1,it=j.length,yt=-1,Vt=d.length,Ft=oi(Ee-it,0),$t=Qe(Ft+Vt),On=!ie;++he<Ft;)$t[he]=s[he];for(var Bn=he;++yt<Vt;)$t[Bn+yt]=d[yt];for(;++Ue<it;)(On||he<Ee)&&($t[Bn+j[Ue]]=s[he++]);return $t}function ma(s,d){var j=-1,ie=s.length;for(d||(d=Qe(ie));++j<ie;)d[j]=s[j];return d}function uo(s,d,j,ie){var he=!j;j||(j={});for(var Ee=-1,Ue=d.length;++Ee<Ue;){var it=d[Ee],yt=ie?ie(j[it],s[it],it,j,s):o;yt===o&&(yt=s[it]),he?Ko(j,it,yt):ec(j,it,yt)}return j}function ac(s,d){return function(j,ie){var he=br(j)?ha:pp,Ee=d?d():{};return he(j,s,In(ie,2),Ee)}}function Us(s){return wr(function(d,j){var ie=-1,he=j.length,Ee=he>1?j[he-1]:o,Ue=he>2?j[2]:o;for(Ee=s.length>3&&typeof Ee=="function"?(he--,Ee):o,Ue&&sa(j[0],j[1],Ue)&&(Ee=he<3?o:Ee,he=1),d=_n(d);++ie<he;){var it=j[ie];it&&s(d,it,ie,Ee)}return d})}function Hs(s,d){return function(j,ie){if(j==null)return j;if(!_i(j))return s(j,ie);for(var he=j.length,Ee=d?he:-1,Ue=_n(j);(d?Ee--:++Ee<he)&&ie(Ue[Ee],Ee,Ue)!==!1;);return j}}function Sl(s){return function(d,j,ie){for(var he=-1,Ee=_n(d),Ue=ie(d),it=Ue.length;it--;){var yt=Ue[s?it:++he];if(j(Ee[yt],yt,Ee)===!1)break}return d}}function oc(s){return function(d){var j=Ao(d=Rr(d))?re(d):o,ie=j?j[0]:d.charAt(0),he=j?co(j,1).join(""):d.slice(1);return ie[s]()+he}}function si(s){return function(d){return Uo(Lu(Qh(d).replace(ja,"")),s,"")}}function Dl(s){return function(){var d=arguments;switch(d.length){case 0:return new s;case 1:return new s(d[0]);case 2:return new s(d[0],d[1]);case 3:return new s(d[0],d[1],d[2]);case 4:return new s(d[0],d[1],d[2],d[3]);case 5:return new s(d[0],d[1],d[2],d[3],d[4]);case 6:return new s(d[0],d[1],d[2],d[3],d[4],d[5]);case 7:return new s(d[0],d[1],d[2],d[3],d[4],d[5],d[6])}var j=Wi(s.prototype),ie=s.apply(j,d);return dn(ie)?ie:j}}function sh(s){return function(d,j,ie){var he=_n(d);if(!_i(d)){var Ee=In(j,3);d=zi(d),j=function(it){return Ee(he[it],it,he)}}var Ue=s(d,j,ie);return Ue>-1?he[Ee?d[Ue]:Ue]:o}}function lh(s){return wo(function(d){var j=d.length,ie=j,he=Or.prototype.thru;for(s&&d.reverse();ie--;){var Ee=d[ie];if(typeof Ee!="function")throw new Nr(a);if(he&&!Ue&&ws(Ee)=="wrapper")var Ue=new Or([],!0)}for(ie=Ue?ie:j;++ie<j;){var it=ws(Ee=d[ie]),yt=it=="wrapper"?Al(Ee):o;Ue=yt&&Ol(yt[0])&&yt[1]==424&&!yt[4].length&&yt[9]==1?Ue[ws(yt[0])].apply(Ue,yt[3]):Ee.length==1&&Ol(Ee)?Ue[it]():Ue.thru(Ee)}return function(){var Vt=arguments,Ft=Vt[0];if(Ue&&Vt.length==1&&br(Ft))return Ue.plant(Ft).value();for(var $t=0,On=j?d[$t].apply(this,Vt):Ft;++$t<j;)On=d[$t].call(this,On);return On}})}function Ws(s,d,j,ie,he,Ee,Ue,it,yt,Vt){var Ft=d&G,$t=1&d,On=2&d,Bn=24&d,Yn=512&d,Ut=On?o:Dl(s);return function tn(){for(var ar=arguments.length,fn=Qe(ar),mr=ar;mr--;)fn[mr]=arguments[mr];if(Bn)var cr=ns(tn),Gr=function(ri,ca){for(var li=ri.length,ea=0;li--;)ri[li]===ca&&++ea;return ea}(fn,cr);if(ie&&(fn=oh(fn,ie,he,Bn)),Ee&&(fn=Wh(fn,Ee,Ue,Bn)),ar-=Gr,Bn&&ar<Vt){var Un=w(fn,cr);return Io(s,d,Ws,tn.placeholder,j,fn,Un,it,yt,Vt-ar)}var or=$t?j:this,ji=On?or[s]:s;return ar=fn.length,it?fn=function(ri,ca){for(var li=ri.length,ea=Bi(ca.length,li),eo=ma(ri);ea--;){var Ps=ca[ea];ri[ea]=Ka(Ps,li)?eo[Ps]:o}return ri}(fn,it):Yn&&ar>1&&fn.reverse(),Ft&&yt<ar&&(fn.length=yt),this&&this!==kr&&this instanceof tn&&(ji=Ut||Dl(ji)),ji.apply(or,fn)}}function sc(s,d){return function(j,ie){return function(he,Ee,Ue,it){return Ba(he,function(yt,Vt,Ft){Ee(it,Ue(yt),Vt,Ft)}),it}(j,s,d(ie),{})}}function Ma(s,d){return function(j,ie){var he;if(j===o&&ie===o)return d;if(j!==o&&(he=j),ie!==o){if(he===o)return ie;typeof j=="string"||typeof ie=="string"?(j=fa(j),ie=fa(ie)):(j=Gs(j),ie=Gs(ie)),he=s(j,ie)}return he}}function El(s){return wo(function(d){return d=Qr(d,$i(In())),wr(function(j){var ie=this;return s(d,function(he){return $r(he,ie,j)})})})}function Js(s,d){var j=(d=d===o?" ":fa(d)).length;if(j<2)return j?vl(d,s):d;var ie=vl(d,dr(s/X(d)));return Ao(d)?co(re(ie),0,s).join(""):ie.slice(0,s)}function Mi(s){return function(d,j,ie){return ie&&typeof ie!="number"&&sa(d,j,ie)&&(j=ie=o),d=Ta(d),j===o?(j=d,d=0):j=Ta(j),function(he,Ee,Ue,it){for(var yt=-1,Vt=oi(dr((Ee-he)/(Ue||1)),0),Ft=Qe(Vt);Vt--;)Ft[it?Vt:++yt]=he,he+=Ue;return Ft}(d,j,ie=ie===o?d<j?1:-1:Ta(ie),s)}}function qs(s){return function(d,j){return typeof d=="string"&&typeof j=="string"||(d=qi(d),j=qi(j)),s(d,j)}}function Io(s,d,j,ie,he,Ee,Ue,it,yt,Vt){var Ft=8&d;d|=Ft?I:H,4&(d&=~(Ft?H:I))||(d&=-4);var $t=[s,d,he,Ft?Ee:o,Ft?Ue:o,Ft?o:Ee,Ft?o:Ue,it,yt,Vt],On=j.apply(o,$t);return Ol(s)&&Xh(On,$t),On.placeholder=ie,gu(On,s,d)}function du(s){var d=Pn[s];return function(j,ie){if(j=qi(j),(ie=ie==null?0:Bi(er(ie),292))&&Ns(j)){var he=(Rr(j)+"e").split("e");return+((he=(Rr(d(he[0]+"e"+(+he[1]+ie)))+"e").split("e"))[0]+"e"+(+he[1]-ie))}return d(j)}}var ch=kt&&1/E(new kt([,-0]))[1]==y?function(s){return new kt(s)}:ju;function lc(s){return function(d){var j=Ji(d);return j==V?Po(d):j==f?function(ie){var he=-1,Ee=Array(ie.size);return ie.forEach(function(Ue){Ee[++he]=[Ue,Ue]}),Ee}(d):function(ie,he){return Qr(he,function(Ee){return[Ee,ie[Ee]]})}(d,s(d))}}function ho(s,d,j,ie,he,Ee,Ue,it){var yt=2&d;if(!yt&&typeof s!="function")throw new Nr(a);var Vt=ie?ie.length:0;if(Vt||(d&=-97,ie=he=o),Ue=Ue===o?Ue:oi(er(Ue),0),it=it===o?it:er(it),Vt-=he?he.length:0,d&H){var Ft=ie,$t=he;ie=he=o}var On=yt?o:Al(s),Bn=[s,d,j,ie,he,Ft,$t,Ee,Ue,it];if(On&&function(Ut,tn){var ar=Ut[1],fn=tn[1],mr=ar|fn,cr=mr<131,Gr=fn==G&&ar==8||fn==G&&ar==L&&Ut[7].length<=tn[8]||fn==384&&tn[7].length<=tn[8]&&ar==8;if(!cr&&!Gr)return Ut;1&fn&&(Ut[2]=tn[2],mr|=1&ar?0:4);var Un=tn[3];if(Un){var or=Ut[3];Ut[3]=or?oh(or,Un,tn[4]):Un,Ut[4]=or?w(Ut[3],u):tn[4]}(Un=tn[5])&&(or=Ut[5],Ut[5]=or?Wh(or,Un,tn[6]):Un,Ut[6]=or?w(Ut[5],u):tn[6]),(Un=tn[7])&&(Ut[7]=Un),fn&G&&(Ut[8]=Ut[8]==null?tn[8]:Bi(Ut[8],tn[8])),Ut[9]==null&&(Ut[9]=tn[9]),Ut[0]=tn[0],Ut[1]=mr}(Bn,On),s=Bn[0],d=Bn[1],j=Bn[2],ie=Bn[3],he=Bn[4],!(it=Bn[9]=Bn[9]===o?yt?0:s.length:oi(Bn[9]-Vt,0))&&24&d&&(d&=-25),d&&d!=1)Yn=d==8||d==M?function(Ut,tn,ar){var fn=Dl(Ut);return function mr(){for(var cr=arguments.length,Gr=Qe(cr),Un=cr,or=ns(mr);Un--;)Gr[Un]=arguments[Un];var ji=cr<3&&Gr[0]!==or&&Gr[cr-1]!==or?[]:w(Gr,or);return(cr-=ji.length)<ar?Io(Ut,tn,Ws,mr.placeholder,o,Gr,ji,o,o,ar-cr):$r(this&&this!==kr&&this instanceof mr?fn:Ut,this,Gr)}}(s,d,it):d!=I&&d!=33||he.length?Ws.apply(o,Bn):function(Ut,tn,ar,fn){var mr=1&tn,cr=Dl(Ut);return function Gr(){for(var Un=-1,or=arguments.length,ji=-1,ri=fn.length,ca=Qe(ri+or),li=this&&this!==kr&&this instanceof Gr?cr:Ut;++ji<ri;)ca[ji]=fn[ji];for(;or--;)ca[ji++]=arguments[++Un];return $r(li,mr?ar:this,ca)}}(s,d,j,ie);else var Yn=function(Ut,tn,ar){var fn=1&tn,mr=Dl(Ut);return function cr(){return(this&&this!==kr&&this instanceof cr?mr:Ut).apply(fn?ar:this,arguments)}}(s,d,j);return gu((On?cu:Xh)(Yn,Bn),s,d)}function Xs(s,d,j,ie){return s===o||ki(s,vr[j])&&!Fn.call(ie,j)?d:s}function fu(s,d,j,ie,he,Ee){return dn(s)&&dn(d)&&(Ee.set(d,s),$o(s,d,o,fu,Ee),Ee.delete(d)),s}function uh(s){return Ds(s)?o:s}function cc(s,d,j,ie,he,Ee){var Ue=1&j,it=s.length,yt=d.length;if(it!=yt&&!(Ue&&yt>it))return!1;var Vt=Ee.get(s),Ft=Ee.get(d);if(Vt&&Ft)return Vt==d&&Ft==s;var $t=-1,On=!0,Bn=2&j?new Oo:o;for(Ee.set(s,d),Ee.set(d,s);++$t<it;){var Yn=s[$t],Ut=d[$t];if(ie)var tn=Ue?ie(Ut,Yn,$t,d,s,Ee):ie(Yn,Ut,$t,s,d,Ee);if(tn!==o){if(tn)continue;On=!1;break}if(Bn){if(!ps(d,function(ar,fn){if(!ln(Bn,fn)&&(Yn===ar||he(Yn,ar,j,ie,Ee)))return Bn.push(fn)})){On=!1;break}}else if(Yn!==Ut&&!he(Yn,Ut,j,ie,Ee)){On=!1;break}}return Ee.delete(s),Ee.delete(d),On}function wo(s){return ph(Jh(s,o,dh),s+"")}function uc(s){return Nh(s,zi,bs)}function Ys(s){return Nh(s,ya,hc)}var Al=pn?function(s){return pn.get(s)}:ju;function ws(s){for(var d=s.name+"",j=un[d],ie=Fn.call(un,d)?j.length:0;ie--;){var he=j[ie],Ee=he.func;if(Ee==null||Ee==s)return he.name}return d}function ns(s){return(Fn.call(ye,"placeholder")?ye:s).placeholder}function In(){var s=ye.iteratee||ku;return s=s===ku?Qu:s,arguments.length?s(arguments[0],arguments[1]):s}function Zs(s,d){var j,ie,he=s.__data__;return((ie=typeof(j=d))=="string"||ie=="number"||ie=="symbol"||ie=="boolean"?j!=="__proto__":j===null)?he[typeof d=="string"?"string":"hash"]:he.map}function Ks(s){for(var d=zi(s),j=d.length;j--;){var ie=d[j],he=s[ie];d[j]=[ie,he,Ll(he)]}return d}function ko(s,d){var j=function(ie,he){return ie==null?o:ie[he]}(s,d);return Bh(j)?j:o}var bs=fl?function(s){return s==null?[]:(s=_n(s),io(fl(s),function(d){return Ei.call(s,d)}))}:Sh,hc=fl?function(s){for(var d=[];s;)Fi(d,bs(s)),s=Dr(s);return d}:Sh,Ji=da;function pc(s,d,j){for(var ie=-1,he=(d=Lo(d,s)).length,Ee=!1;++ie<he;){var Ue=_a(d[ie]);if(!(Ee=s!=null&&j(s,Ue)))break;s=s[Ue]}return Ee||++ie!=he?Ee:!!(he=s==null?0:s.length)&&al(he)&&Ka(Ue,he)&&(br(s)||os(s))}function Pl(s){return typeof s.constructor!="function"||Rl(s)?{}:Wi(Dr(s))}function mu(s){return br(s)||os(s)||!!(ei&&s&&s[ei])}function Ka(s,d){var j=typeof s;return!!(d=d??D)&&(j=="number"||j!="symbol"&&Cr.test(s))&&s>-1&&s%1==0&&s<d}function sa(s,d,j){if(!dn(j))return!1;var ie=typeof d;return!!(ie=="number"?_i(j)&&Ka(d,j.length):ie=="string"&&d in j)&&ki(j[d],s)}function $s(s,d){if(br(s))return!1;var j=typeof s;return!(j!="number"&&j!="symbol"&&j!="boolean"&&s!=null&&!pi(s))||Je.test(s)||!Pt.test(s)||d!=null&&s in _n(d)}function Ol(s){var d=ws(s),j=ye[d];if(typeof j!="function"||!(d in xr.prototype))return!1;if(s===j)return!0;var ie=Al(j);return!!ie&&s===ie[0]}(ot&&Ji(new ot(new ArrayBuffer(1)))!=te||vt&&Ji(new vt)!=V||Dt&&Ji(Dt.resolve())!=p||kt&&Ji(new kt)!=f||on&&Ji(new on)!=O)&&(Ji=function(s){var d=da(s),j=d==c?s.constructor:o,ie=j?Ms(j):"";if(ie)switch(ie){case Br:return te;case _r:return V;case fr:return p;case jr:return f;case ir:return O}return d});var dc=Ea?za:cs;function Rl(s){var d=s&&s.constructor;return s===(typeof d=="function"&&d.prototype||vr)}function Ll(s){return s==s&&!dn(s)}function Il(s,d){return function(j){return j!=null&&j[s]===d&&(d!==o||s in _n(j))}}function Jh(s,d,j){return d=oi(d===o?s.length-1:d,0),function(){for(var ie=arguments,he=-1,Ee=oi(ie.length-d,0),Ue=Qe(Ee);++he<Ee;)Ue[he]=ie[d+he];he=-1;for(var it=Qe(d+1);++he<d;)it[he]=ie[he];return it[d]=j(Ue),$r(s,this,it)}}function qh(s,d){return d.length<2?s:ys(s,Ra(d,0,-1))}function hh(s,d){if((d!=="constructor"||typeof s[d]!="function")&&d!="__proto__")return s[d]}var Xh=Yh(cu),fc=Va||function(s,d){return kr.setTimeout(s,d)},ph=Yh(uu);function gu(s,d,j){var ie=d+"";return ph(s,function(he,Ee){var Ue=Ee.length;if(!Ue)return he;var it=Ue-1;return Ee[it]=(Ue>1?"& ":"")+Ee[it],Ee=Ee.join(Ue>2?", ":" "),he.replace(Ve,`{
/* [wrapped with `+Ee+`] */
`)}(ie,function(he,Ee){return wi(z,function(Ue){var it="_."+Ue[0];Ee&Ue[1]&&!ao(he,it)&&he.push(it)}),he.sort()}(function(he){var Ee=ie.match(Be);return Ee?Ee[1].split(Wt):[]}(),j)))}function Yh(s){var d=0,j=0;return function(){var ie=$l(),he=16-(ie-j);if(j=ie,he>0){if(++d>=800)return arguments[0]}else d=0;return s.apply(o,arguments)}}function rs(s,d){var j=-1,ie=s.length,he=ie-1;for(d=d===o?ie:d;++j<d;){var Ee=ih(j,he),Ue=s[Ee];s[Ee]=s[j],s[j]=Ue}return s.length=d,s}var la=function(s){var d=nl(function(ie){var he=[];return ie.charCodeAt(0)===46&&he.push(""),ie.replace(bt,function(Ee,Ue,it,yt){he.push(it?yt.replace(ct,"$1"):Ue||Ee)}),he},function(ie){return j.size===500&&j.clear(),ie}),j=d.cache;return d}();function _a(s){if(typeof s=="string"||pi(s))return s;var d=s+"";return d=="0"&&1/s==-1/0?"-0":d}function Ms(s){if(s!=null){try{return Ar.call(s)}catch{}try{return s+""}catch{}}return""}function kl(s){if(s instanceof xr)return s.clone();var d=new Or(s.__wrapped__,s.__chain__);return d.__actions__=ma(s.__actions__),d.__index__=s.__index__,d.__values__=s.__values__,d}var Zh=wr(function(s,d){return Hr(s)?gl(s,pa(d,1,Hr,!0)):[]}),Kh=wr(function(s,d){var j=$a(d);return Hr(j)&&(j=o),Hr(s)?gl(s,pa(d,1,Hr,!0),In(j,2)):[]}),mc=wr(function(s,d){var j=$a(d);return Hr(j)&&(j=o),Hr(s)?gl(s,pa(d,1,Hr,!0),o,j):[]});function yu(s,d,j){var ie=s==null?0:s.length;if(!ie)return-1;var he=j==null?0:er(j);return he<0&&(he=oi(ie+he,0)),qa(s,In(d,3),he)}function jo(s,d,j){var ie=s==null?0:s.length;if(!ie)return-1;var he=ie-1;return j!==o&&(he=er(j),he=j<0?oi(ie+he,0):Bi(he,ie-1)),qa(s,In(d,3),he,!0)}function dh(s){return s!=null&&s.length?pa(s,1):[]}function fh(s){return s&&s.length?s[0]:o}var gc=wr(function(s){var d=Qr(s,_l);return d.length&&d[0]===s[0]?Ku(d):[]}),_s=wr(function(s){var d=$a(s),j=Qr(s,_l);return d===$a(j)?d=o:j.pop(),j.length&&j[0]===s[0]?Ku(j,In(d,2)):[]}),mp=wr(function(s){var d=$a(s),j=Qr(s,_l);return(d=typeof d=="function"?d:o)&&j.pop(),j.length&&j[0]===s[0]?Ku(j,o,d):[]});function $a(s){var d=s==null?0:s.length;return d?s[d-1]:o}var vu=wr(jl);function jl(s,d){return s&&s.length&&d&&d.length?su(s,d):s}var xu=wo(function(s,d){var j=s==null?0:s.length,ie=Wu(s,d);return lu(s,Qr(d,function(he){return Ka(he,j)?+he:he}).sort(Cl)),ie});function Ts(s){return s==null?s:ke.call(s)}var wu=wr(function(s){return Za(pa(s,1,Hr,!0))}),yc=wr(function(s){var d=$a(s);return Hr(d)&&(d=o),Za(pa(s,1,Hr,!0),In(d,2))}),bu=wr(function(s){var d=$a(s);return d=typeof d=="function"?d:o,Za(pa(s,1,Hr,!0),o,d)});function Qs(s){if(!s||!s.length)return[];var d=0;return s=io(s,function(j){if(Hr(j))return d=oi(j.length,d),!0}),Ho(d,function(j){return Qr(s,$n(j))})}function Nl(s,d){if(!s||!s.length)return[];var j=Qs(s);return d==null?j:Qr(j,function(ie){return $r(d,o,ie)})}var vc=wr(function(s,d){return Hr(s)?gl(s,d):[]}),$h=wr(function(s){return bl(io(s,Hr))}),xc=wr(function(s){var d=$a(s);return Hr(d)&&(d=o),bl(io(s,Hr),In(d,2))}),Vl=wr(function(s){var d=$a(s);return d=typeof d=="function"?d:o,bl(io(s,Hr),o,d)}),Cs=wr(Qs),Mu=wr(function(s){var d=s.length,j=d>1?s[d-1]:o;return Nl(s,j=typeof j=="function"?(s.pop(),j):o)});function wc(s){var d=ye(s);return d.__chain__=!0,d}function el(s,d){return d(s)}var bc=wo(function(s){var d=s.length,j=d?s[0]:0,ie=this.__wrapped__,he=function(Ee){return Wu(Ee,s)};return!(d>1||this.__actions__.length)&&ie instanceof xr&&Ka(j)?((ie=ie.slice(j,+j+(d?1:0))).__actions__.push({func:el,args:[he],thisArg:o}),new Or(ie,this.__chain__).thru(function(Ee){return d&&!Ee.length&&Ee.push(o),Ee})):this.thru(he)}),La=ac(function(s,d,j){Fn.call(s,j)?++s[j]:Ko(s,j,1)}),Mc=sh(yu),tl=sh(jo);function is(s,d){return(br(s)?wi:Ro)(s,In(d,3))}function Fl(s,d){return(br(s)?function(j,ie){for(var he=j==null?0:j.length;he--&&ie(j[he],he,j)!==!1;);return j}:qu)(s,In(d,3))}var Bl=ac(function(s,d,j){Fn.call(s,j)?s[j].push(d):Ko(s,j,[d])}),_c=wr(function(s,d,j){var ie=-1,he=typeof d=="function",Ee=_i(s)?Qe(s.length):[];return Ro(s,function(Ue){Ee[++ie]=he?$r(d,Ue,j):yl(Ue,d,j)}),Ee}),Tc=ac(function(s,d,j){Ko(s,j,d)});function Ss(s,d){return(br(s)?Qr:Gh)(s,In(d,3))}var Cc=ac(function(s,d,j){s[j?0:1].push(d)},function(){return[[],[]]}),Sc=wr(function(s,d){if(s==null)return[];var j=d.length;return j>1&&sa(s,d[0],d[1])?d=[]:j>2&&sa(d[0],d[1],d[2])&&(d=[d[0]]),zh(s,pa(d,1),[])}),_u=Zo||function(){return kr.Date.now()};function Ai(s,d,j){return d=j?o:d,d=s&&d==null?s.length:d,ho(s,G,o,o,o,o,d)}function Ga(s,d){var j;if(typeof d!="function")throw new Nr(a);return s=er(s),function(){return--s>0&&(j=d.apply(this,arguments)),s<=1&&(d=o),j}}var Gl=wr(function(s,d,j){var ie=1;if(j.length){var he=w(j,ns(Gl));ie|=I}return ho(s,ie,d,j,he)}),zl=wr(function(s,d,j){var ie=3;if(j.length){var he=w(j,ns(zl));ie|=I}return ho(d,ie,s,j,he)});function Dc(s,d,j){var ie,he,Ee,Ue,it,yt,Vt=0,Ft=!1,$t=!1,On=!0;if(typeof s!="function")throw new Nr(a);function Bn(fn){var mr=ie,cr=he;return ie=he=o,Vt=fn,Ue=s.apply(cr,mr)}function Yn(fn){var mr=fn-yt;return yt===o||mr>=d||mr<0||$t&&fn-Vt>=Ee}function Ut(){var fn=_u();if(Yn(fn))return tn(fn);it=fc(Ut,function(mr){var cr=d-(mr-yt);return $t?Bi(cr,Ee-(mr-Vt)):cr}(fn))}function tn(fn){return it=o,On&&ie?Bn(fn):(ie=he=o,Ue)}function ar(){var fn=_u(),mr=Yn(fn);if(ie=arguments,he=this,yt=fn,mr){if(it===o)return function(cr){return Vt=cr,it=fc(Ut,d),Ft?Bn(cr):Ue}(yt);if($t)return rc(it),it=fc(Ut,d),Bn(yt)}return it===o&&(it=fc(Ut,d)),Ue}return d=qi(d)||0,dn(j)&&(Ft=!!j.leading,Ee=($t="maxWait"in j)?oi(qi(j.maxWait)||0,d):Ee,On="trailing"in j?!!j.trailing:On),ar.cancel=function(){it!==o&&rc(it),Vt=0,ie=yt=he=it=o},ar.flush=function(){return it===o?Ue:tn(_u())},ar}var ga=wr(function(s,d){return Ju(s,1,d)}),Tu=wr(function(s,d,j){return Ju(s,qi(d)||0,j)});function nl(s,d){if(typeof s!="function"||d!=null&&typeof d!="function")throw new Nr(a);var j=function(){var ie=arguments,he=d?d.apply(this,ie):ie[0],Ee=j.cache;if(Ee.has(he))return Ee.get(he);var Ue=s.apply(this,ie);return j.cache=Ee.set(he,Ue)||Ee,Ue};return j.cache=new(nl.Cache||so),j}function as(s){if(typeof s!="function")throw new Nr(a);return function(){var d=arguments;switch(d.length){case 0:return!s.call(this);case 1:return!s.call(this,d[0]);case 2:return!s.call(this,d[0],d[1]);case 3:return!s.call(this,d[0],d[1],d[2])}return!s.apply(this,d)}}nl.Cache=so;var Cu=Hh(function(s,d){var j=(d=d.length==1&&br(d[0])?Qr(d[0],$i(In())):Qr(pa(d,1),$i(In()))).length;return wr(function(ie){for(var he=-1,Ee=Bi(ie.length,j);++he<Ee;)ie[he]=d[he].call(this,ie[he]);return $r(s,this,ie)})}),rl=wr(function(s,d){var j=w(d,ns(rl));return ho(s,I,o,d,j)}),Ec=wr(function(s,d){var j=w(d,ns(Ec));return ho(s,H,o,d,j)}),Ul=wo(function(s,d){return ho(s,L,o,o,o,d)});function ki(s,d){return s===d||s!=s&&d!=d}var gp=qs(Zu),il=qs(function(s,d){return s>=d}),os=Fh(function(){return arguments}())?Fh:function(s){return Wr(s)&&Fn.call(s,"callee")&&!Ei.call(s,"callee")},br=Qe.isArray,Kr=mt?$i(mt):function(s){return Wr(s)&&da(s)==Z};function _i(s){return s!=null&&al(s.length)&&!za(s)}function Hr(s){return Wr(s)&&_i(s)}var No=js||cs,mh=It?$i(It):function(s){return Wr(s)&&da(s)==W};function Hl(s){if(!Wr(s))return!1;var d=da(s);return d==_||d=="[object DOMException]"||typeof s.message=="string"&&typeof s.name=="string"&&!Ds(s)}function za(s){if(!dn(s))return!1;var d=da(s);return d==R||d==v||d=="[object AsyncFunction]"||d=="[object Proxy]"}function Ac(s){return typeof s=="number"&&s==er(s)}function al(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=D}function dn(s){var d=typeof s;return s!=null&&(d=="object"||d=="function")}function Wr(s){return s!=null&&typeof s=="object"}var Pc=Gt?$i(Gt):function(s){return Wr(s)&&Ji(s)==V};function Su(s){return typeof s=="number"||Wr(s)&&da(s)==Y}function Ds(s){if(!Wr(s)||da(s)!=c)return!1;var d=Dr(s);if(d===null)return!0;var j=Fn.call(d,"constructor")&&d.constructor;return typeof j=="function"&&j instanceof j&&Ar.call(j)==Xo}var Oc=Mn?$i(Mn):function(s){return Wr(s)&&da(s)==m},Du=Vn?$i(Vn):function(s){return Wr(s)&&Ji(s)==f};function Wl(s){return typeof s=="string"||!br(s)&&Wr(s)&&da(s)==N}function pi(s){return typeof s=="symbol"||Wr(s)&&da(s)==P}var ol=qn?$i(qn):function(s){return Wr(s)&&al(s.length)&&!!zr[da(s)]},Rc=qs(th),Lc=qs(function(s,d){return s<=d});function Vo(s){if(!s)return[];if(_i(s))return Wl(s)?re(s):ma(s);if(Zr&&s[Zr])return function(j){for(var ie,he=[];!(ie=j.next()).done;)he.push(ie.value);return he}(s[Zr]());var d=Ji(s);return(d==V?Po:d==f?E:As)(s)}function Ta(s){return s?(s=qi(s))===y||s===-1/0?17976931348623157e292*(s<0?-1:1):s==s?s:0:s===0?s:0}function er(s){var d=Ta(s),j=d%1;return d==d?j?d-j:d:0}function Fo(s){return s?Vs(er(s),0,B):0}function qi(s){if(typeof s=="number")return s;if(pi(s))return C;if(dn(s)){var d=typeof s.valueOf=="function"?s.valueOf():s;s=dn(d)?d+"":d}if(typeof s!="string")return s===0?s:+s;s=yo(s);var j=Kt.test(s);return j||Se.test(s)?Do(s.slice(2),j?2:8):bn.test(s)?C:+s}function ss(s){return uo(s,ya(s))}function Rr(s){return s==null?"":fa(s)}var gh=Us(function(s,d){if(Rl(d)||_i(d))uo(d,zi(d),s);else for(var j in d)Fn.call(d,j)&&ec(s,j,d[j])}),Bo=Us(function(s,d){uo(d,ya(d),s)}),Ua=Us(function(s,d,j,ie){uo(d,ya(d),s,ie)}),Es=Us(function(s,d,j,ie){uo(d,zi(d),s,ie)}),di=wo(Wu),Eu=wr(function(s,d){s=_n(s);var j=-1,ie=d.length,he=ie>2?d[2]:o;for(he&&sa(d[0],d[1],he)&&(ie=1);++j<ie;)for(var Ee=d[j],Ue=ya(Ee),it=-1,yt=Ue.length;++it<yt;){var Vt=Ue[it],Ft=s[Vt];(Ft===o||ki(Ft,vr[Vt])&&!Fn.call(s,Vt))&&(s[Vt]=Ee[Vt])}return s}),Go=wr(function(s){return s.push(o,fu),$r(Ic,o,s)});function Jl(s,d,j){var ie=s==null?o:ys(s,d);return ie===o?j:ie}function ql(s,d){return s!=null&&pc(s,d,Vh)}var yh=sc(function(s,d,j){d!=null&&typeof d.toString!="function"&&(d=kn.call(d)),s[d]=j},Qa(Ia)),Au=sc(function(s,d,j){d!=null&&typeof d.toString!="function"&&(d=kn.call(d)),Fn.call(s,d)?s[d].push(j):s[d]=[j]},In),Xl=wr(yl);function zi(s){return _i(s)?Lh(s):eh(s)}function ya(s){return _i(s)?Lh(s,!0):function(d){if(!dn(d))return function(Ee){var Ue=[];if(Ee!=null)for(var it in _n(Ee))Ue.push(it);return Ue}(d);var j=Rl(d),ie=[];for(var he in d)(he!="constructor"||!j&&Fn.call(d,he))&&ie.push(he);return ie}(s)}var Pu=Us(function(s,d,j){$o(s,d,j)}),Ic=Us(function(s,d,j,ie){$o(s,d,j,ie)}),Ou=wo(function(s,d){var j={};if(s==null)return j;var ie=!1;d=Qr(d,function(Ee){return Ee=Lo(Ee,s),ie||(ie=Ee.length>1),Ee}),uo(s,Ys(s),j),ie&&(j=lo(j,7,uh));for(var he=d.length;he--;)vs(j,d[he]);return j}),vh=wo(function(s,d){return s==null?{}:function(j,ie){return Uh(j,ie,function(he,Ee){return ql(j,Ee)})}(s,d)});function kc(s,d){if(s==null)return{};var j=Qr(Ys(s),function(ie){return[ie]});return d=In(d),Uh(s,j,function(ie,he){return d(ie,he[0])})}var jc=lc(zi),Nc=lc(ya);function As(s){return s==null?[]:vo(s,zi(s))}var Ru=si(function(s,d,j){return d=d.toLowerCase(),s+(j?Vc(d):d)});function Vc(s){return Fc(Rr(s).toLowerCase())}function Qh(s){return(s=Rr(s))&&s.replace(Xe,Kl).replace(Ja,"")}var ep=si(function(s,d,j){return s+(j?"-":"")+d.toLowerCase()}),tp=si(function(s,d,j){return s+(j?" ":"")+d.toLowerCase()}),xh=oc("toLowerCase"),wh=si(function(s,d,j){return s+(j?"_":"")+d.toLowerCase()}),bh=si(function(s,d,j){return s+(j?" ":"")+Fc(d)}),yp=si(function(s,d,j){return s+(j?" ":"")+d.toUpperCase()}),Fc=oc("toUpperCase");function Lu(s,d,j){return s=Rr(s),(d=j?o:d)===o?function(ie){return So.test(ie)}(s)?function(ie){return ie.match(go)||[]}(s):function(ie){return ie.match(Kn)||[]}(s):s.match(d)||[]}var Bc=wr(function(s,d){try{return $r(s,o,d)}catch(j){return Hl(j)?j:new lt(j)}}),Iu=wo(function(s,d){return wi(d,function(j){j=_a(j),Ko(s,j,Gl(s[j],s))}),s});function Qa(s){return function(){return s}}var Mh=lh(),_h=lh(!0);function Ia(s){return s}function ku(s){return Qu(typeof s=="function"?s:lo(s,1))}var np=wr(function(s,d){return function(j){return yl(j,s,d)}}),Th=wr(function(s,d){return function(j){return yl(s,j,d)}});function ls(s,d,j){var ie=zi(d),he=tc(d,ie);j!=null||dn(d)&&(he.length||!ie.length)||(j=d,d=s,s=this,he=tc(d,zi(d)));var Ee=!(dn(j)&&"chain"in j&&!j.chain),Ue=za(s);return wi(he,function(it){var yt=d[it];s[it]=yt,Ue&&(s.prototype[it]=function(){var Vt=this.__chain__;if(Ee||Vt){var Ft=s(this.__wrapped__);return(Ft.__actions__=ma(this.__actions__)).push({func:yt,args:arguments,thisArg:s}),Ft.__chain__=Vt,Ft}return yt.apply(s,Fi([this.value()],arguments))})}),s}function ju(){}var vp=El(Qr),sl=El(hs),Ch=El(ps);function ll(s){return $s(s)?$n(_a(s)):function(d){return function(j){return ys(j,d)}}(s)}var cl=Mi(),rp=Mi(!0);function Sh(){return[]}function cs(){return!1}var Gc,Dh=Ma(function(s,d){return s+d},0),Eh=du("ceil"),Ah=Ma(function(s,d){return s/d},1),xp=du("floor"),Ph=Ma(function(s,d){return s*d},1),wp=du("round"),bp=Ma(function(s,d){return s-d},0);return ye.after=function(s,d){if(typeof d!="function")throw new Nr(a);return s=er(s),function(){if(--s<1)return d.apply(this,arguments)}},ye.ary=Ai,ye.assign=gh,ye.assignIn=Bo,ye.assignInWith=Ua,ye.assignWith=Es,ye.at=di,ye.before=Ga,ye.bind=Gl,ye.bindAll=Iu,ye.bindKey=zl,ye.castArray=function(){if(!arguments.length)return[];var s=arguments[0];return br(s)?s:[s]},ye.chain=wc,ye.chunk=function(s,d,j){d=(j?sa(s,d,j):d===o)?1:oi(er(d),0);var ie=s==null?0:s.length;if(!ie||d<1)return[];for(var he=0,Ee=0,Ue=Qe(dr(ie/d));he<ie;)Ue[Ee++]=Ra(s,he,he+=d);return Ue},ye.compact=function(s){for(var d=-1,j=s==null?0:s.length,ie=0,he=[];++d<j;){var Ee=s[d];Ee&&(he[ie++]=Ee)}return he},ye.concat=function(){var s=arguments.length;if(!s)return[];for(var d=Qe(s-1),j=arguments[0],ie=s;ie--;)d[ie-1]=arguments[ie];return Fi(br(j)?ma(j):[j],pa(d,1))},ye.cond=function(s){var d=s==null?0:s.length,j=In();return s=d?Qr(s,function(ie){if(typeof ie[1]!="function")throw new Nr(a);return[j(ie[0]),ie[1]]}):[],wr(function(ie){for(var he=-1;++he<d;){var Ee=s[he];if($r(Ee[0],this,ie))return $r(Ee[1],this,ie)}})},ye.conforms=function(s){return function(d){var j=zi(d);return function(ie){return jh(ie,d,j)}}(lo(s,1))},ye.constant=Qa,ye.countBy=La,ye.create=function(s,d){var j=Wi(s);return d==null?j:kh(j,d)},ye.curry=function s(d,j,ie){var he=ho(d,8,o,o,o,o,o,j=ie?o:j);return he.placeholder=s.placeholder,he},ye.curryRight=function s(d,j,ie){var he=ho(d,M,o,o,o,o,o,j=ie?o:j);return he.placeholder=s.placeholder,he},ye.debounce=Dc,ye.defaults=Eu,ye.defaultsDeep=Go,ye.defer=ga,ye.delay=Tu,ye.difference=Zh,ye.differenceBy=Kh,ye.differenceWith=mc,ye.drop=function(s,d,j){var ie=s==null?0:s.length;return ie?Ra(s,(d=j||d===o?1:er(d))<0?0:d,ie):[]},ye.dropRight=function(s,d,j){var ie=s==null?0:s.length;return ie?Ra(s,0,(d=ie-(d=j||d===o?1:er(d)))<0?0:d):[]},ye.dropRightWhile=function(s,d){return s&&s.length?xs(s,In(d,3),!0,!0):[]},ye.dropWhile=function(s,d){return s&&s.length?xs(s,In(d,3),!0):[]},ye.fill=function(s,d,j,ie){var he=s==null?0:s.length;return he?(j&&typeof j!="number"&&sa(s,d,j)&&(j=0,ie=he),function(Ee,Ue,it,yt){var Vt=Ee.length;for((it=er(it))<0&&(it=-it>Vt?0:Vt+it),(yt=yt===o||yt>Vt?Vt:er(yt))<0&&(yt+=Vt),yt=it>yt?0:Fo(yt);it<yt;)Ee[it++]=Ue;return Ee}(s,d,j,ie)):[]},ye.filter=function(s,d){return(br(s)?io:Xu)(s,In(d,3))},ye.flatMap=function(s,d){return pa(Ss(s,d),1)},ye.flatMapDeep=function(s,d){return pa(Ss(s,d),y)},ye.flatMapDepth=function(s,d,j){return j=j===o?1:er(j),pa(Ss(s,d),j)},ye.flatten=dh,ye.flattenDeep=function(s){return s!=null&&s.length?pa(s,y):[]},ye.flattenDepth=function(s,d){return s!=null&&s.length?pa(s,d=d===o?1:er(d)):[]},ye.flip=function(s){return ho(s,512)},ye.flow=Mh,ye.flowRight=_h,ye.fromPairs=function(s){for(var d=-1,j=s==null?0:s.length,ie={};++d<j;){var he=s[d];ie[he[0]]=he[1]}return ie},ye.functions=function(s){return s==null?[]:tc(s,zi(s))},ye.functionsIn=function(s){return s==null?[]:tc(s,ya(s))},ye.groupBy=Bl,ye.initial=function(s){return s!=null&&s.length?Ra(s,0,-1):[]},ye.intersection=gc,ye.intersectionBy=_s,ye.intersectionWith=mp,ye.invert=yh,ye.invertBy=Au,ye.invokeMap=_c,ye.iteratee=ku,ye.keyBy=Tc,ye.keys=zi,ye.keysIn=ya,ye.map=Ss,ye.mapKeys=function(s,d){var j={};return d=In(d,3),Ba(s,function(ie,he,Ee){Ko(j,d(ie,he,Ee),ie)}),j},ye.mapValues=function(s,d){var j={};return d=In(d,3),Ba(s,function(ie,he,Ee){Ko(j,he,d(ie,he,Ee))}),j},ye.matches=function(s){return nh(lo(s,1))},ye.matchesProperty=function(s,d){return Bs(s,lo(d,1))},ye.memoize=nl,ye.merge=Pu,ye.mergeWith=Ic,ye.method=np,ye.methodOf=Th,ye.mixin=ls,ye.negate=as,ye.nthArg=function(s){return s=er(s),wr(function(d){return rh(d,s)})},ye.omit=Ou,ye.omitBy=function(s,d){return kc(s,as(In(d)))},ye.once=function(s){return Ga(2,s)},ye.orderBy=function(s,d,j,ie){return s==null?[]:(br(d)||(d=d==null?[]:[d]),br(j=ie?o:j)||(j=j==null?[]:[j]),zh(s,d,j))},ye.over=vp,ye.overArgs=Cu,ye.overEvery=sl,ye.overSome=Ch,ye.partial=rl,ye.partialRight=Ec,ye.partition=Cc,ye.pick=vh,ye.pickBy=kc,ye.property=ll,ye.propertyOf=function(s){return function(d){return s==null?o:ys(s,d)}},ye.pull=vu,ye.pullAll=jl,ye.pullAllBy=function(s,d,j){return s&&s.length&&d&&d.length?su(s,d,In(j,2)):s},ye.pullAllWith=function(s,d,j){return s&&s.length&&d&&d.length?su(s,d,o,j):s},ye.pullAt=xu,ye.range=cl,ye.rangeRight=rp,ye.rearg=Ul,ye.reject=function(s,d){return(br(s)?io:Xu)(s,as(In(d,3)))},ye.remove=function(s,d){var j=[];if(!s||!s.length)return j;var ie=-1,he=[],Ee=s.length;for(d=In(d,3);++ie<Ee;){var Ue=s[ie];d(Ue,ie,s)&&(j.push(Ue),he.push(ie))}return lu(s,he),j},ye.rest=function(s,d){if(typeof s!="function")throw new Nr(a);return wr(s,d=d===o?d:er(d))},ye.reverse=Ts,ye.sampleSize=function(s,d,j){return d=(j?sa(s,d,j):d===o)?1:er(d),(br(s)?function(ie,he){return rs(ma(ie),Vs(he,0,ie.length))}:function(ie,he){var Ee=As(ie);return rs(Ee,Vs(he,0,Ee.length))})(s,d)},ye.set=function(s,d,j){return s==null?s:xl(s,d,j)},ye.setWith=function(s,d,j,ie){return ie=typeof ie=="function"?ie:o,s==null?s:xl(s,d,j,ie)},ye.shuffle=function(s){return(br(s)?function(d){return rs(ma(d))}:function(d){return rs(As(d))})(s)},ye.slice=function(s,d,j){var ie=s==null?0:s.length;return ie?(j&&typeof j!="number"&&sa(s,d,j)?(d=0,j=ie):(d=d==null?0:er(d),j=j===o?ie:er(j)),Ra(s,d,j)):[]},ye.sortBy=Sc,ye.sortedUniq=function(s){return s&&s.length?wl(s):[]},ye.sortedUniqBy=function(s,d){return s&&s.length?wl(s,In(d,2)):[]},ye.split=function(s,d,j){return j&&typeof j!="number"&&sa(s,d,j)&&(d=j=o),(j=j===o?B:j>>>0)?(s=Rr(s))&&(typeof d=="string"||d!=null&&!Oc(d))&&!(d=fa(d))&&Ao(s)?co(re(s),0,j):s.split(d,j):[]},ye.spread=function(s,d){if(typeof s!="function")throw new Nr(a);return d=d==null?0:oi(er(d),0),wr(function(j){var ie=j[d],he=co(j,0,d);return ie&&Fi(he,ie),$r(s,this,he)})},ye.tail=function(s){var d=s==null?0:s.length;return d?Ra(s,1,d):[]},ye.take=function(s,d,j){return s&&s.length?Ra(s,0,(d=j||d===o?1:er(d))<0?0:d):[]},ye.takeRight=function(s,d,j){var ie=s==null?0:s.length;return ie?Ra(s,(d=ie-(d=j||d===o?1:er(d)))<0?0:d,ie):[]},ye.takeRightWhile=function(s,d){return s&&s.length?xs(s,In(d,3),!1,!0):[]},ye.takeWhile=function(s,d){return s&&s.length?xs(s,In(d,3)):[]},ye.tap=function(s,d){return d(s),s},ye.throttle=function(s,d,j){var ie=!0,he=!0;if(typeof s!="function")throw new Nr(a);return dn(j)&&(ie="leading"in j?!!j.leading:ie,he="trailing"in j?!!j.trailing:he),Dc(s,d,{leading:ie,maxWait:d,trailing:he})},ye.thru=el,ye.toArray=Vo,ye.toPairs=jc,ye.toPairsIn=Nc,ye.toPath=function(s){return br(s)?Qr(s,_a):pi(s)?[s]:ma(la(Rr(s)))},ye.toPlainObject=ss,ye.transform=function(s,d,j){var ie=br(s),he=ie||No(s)||ol(s);if(d=In(d,4),j==null){var Ee=s&&s.constructor;j=he?ie?new Ee:[]:dn(s)&&za(Ee)?Wi(Dr(s)):{}}return(he?wi:Ba)(s,function(Ue,it,yt){return d(j,Ue,it,yt)}),j},ye.unary=function(s){return Ai(s,1)},ye.union=wu,ye.unionBy=yc,ye.unionWith=bu,ye.uniq=function(s){return s&&s.length?Za(s):[]},ye.uniqBy=function(s,d){return s&&s.length?Za(s,In(d,2)):[]},ye.uniqWith=function(s,d){return d=typeof d=="function"?d:o,s&&s.length?Za(s,o,d):[]},ye.unset=function(s,d){return s==null||vs(s,d)},ye.unzip=Qs,ye.unzipWith=Nl,ye.update=function(s,d,j){return s==null?s:zs(s,d,hu(j))},ye.updateWith=function(s,d,j,ie){return ie=typeof ie=="function"?ie:o,s==null?s:zs(s,d,hu(j),ie)},ye.values=As,ye.valuesIn=function(s){return s==null?[]:vo(s,ya(s))},ye.without=vc,ye.words=Lu,ye.wrap=function(s,d){return rl(hu(d),s)},ye.xor=$h,ye.xorBy=xc,ye.xorWith=Vl,ye.zip=Cs,ye.zipObject=function(s,d){return Ml(s||[],d||[],ec)},ye.zipObjectDeep=function(s,d){return Ml(s||[],d||[],xl)},ye.zipWith=Mu,ye.entries=jc,ye.entriesIn=Nc,ye.extend=Bo,ye.extendWith=Ua,ls(ye,ye),ye.add=Dh,ye.attempt=Bc,ye.camelCase=Ru,ye.capitalize=Vc,ye.ceil=Eh,ye.clamp=function(s,d,j){return j===o&&(j=d,d=o),j!==o&&(j=(j=qi(j))==j?j:0),d!==o&&(d=(d=qi(d))==d?d:0),Vs(qi(s),d,j)},ye.clone=function(s){return lo(s,4)},ye.cloneDeep=function(s){return lo(s,5)},ye.cloneDeepWith=function(s,d){return lo(s,5,d=typeof d=="function"?d:o)},ye.cloneWith=function(s,d){return lo(s,4,d=typeof d=="function"?d:o)},ye.conformsTo=function(s,d){return d==null||jh(s,d,zi(d))},ye.deburr=Qh,ye.defaultTo=function(s,d){return s==null||s!=s?d:s},ye.divide=Ah,ye.endsWith=function(s,d,j){s=Rr(s),d=fa(d);var ie=s.length,he=j=j===o?ie:Vs(er(j),0,ie);return(j-=d.length)>=0&&s.slice(j,he)==d},ye.eq=ki,ye.escape=function(s){return(s=Rr(s))&&st.test(s)?s.replace(le,iu):s},ye.escapeRegExp=function(s){return(s=Rr(s))&&Ln.test(s)?s.replace(jt,"\\$&"):s},ye.every=function(s,d,j){var ie=br(s)?hs:dp;return j&&sa(s,d,j)&&(d=o),ie(s,In(d,3))},ye.find=Mc,ye.findIndex=yu,ye.findKey=function(s,d){return dl(s,In(d,3),Ba)},ye.findLast=tl,ye.findLastIndex=jo,ye.findLastKey=function(s,d){return dl(s,In(d,3),Fs)},ye.floor=xp,ye.forEach=is,ye.forEachRight=Fl,ye.forIn=function(s,d){return s==null?s:ou(s,In(d,3),ya)},ye.forInRight=function(s,d){return s==null?s:Yu(s,In(d,3),ya)},ye.forOwn=function(s,d){return s&&Ba(s,In(d,3))},ye.forOwnRight=function(s,d){return s&&Fs(s,In(d,3))},ye.get=Jl,ye.gt=gp,ye.gte=il,ye.has=function(s,d){return s!=null&&pc(s,d,fp)},ye.hasIn=ql,ye.head=fh,ye.identity=Ia,ye.includes=function(s,d,j,ie){s=_i(s)?s:As(s),j=j&&!ie?er(j):0;var he=s.length;return j<0&&(j=oi(he+j,0)),Wl(s)?j<=he&&s.indexOf(d,j)>-1:!!he&&ds(s,d,j)>-1},ye.indexOf=function(s,d,j){var ie=s==null?0:s.length;if(!ie)return-1;var he=j==null?0:er(j);return he<0&&(he=oi(ie+he,0)),ds(s,d,he)},ye.inRange=function(s,d,j){return d=Ta(d),j===o?(j=d,d=0):j=Ta(j),function(ie,he,Ee){return ie>=Bi(he,Ee)&&ie<oi(he,Ee)}(s=qi(s),d,j)},ye.invoke=Xl,ye.isArguments=os,ye.isArray=br,ye.isArrayBuffer=Kr,ye.isArrayLike=_i,ye.isArrayLikeObject=Hr,ye.isBoolean=function(s){return s===!0||s===!1||Wr(s)&&da(s)==q},ye.isBuffer=No,ye.isDate=mh,ye.isElement=function(s){return Wr(s)&&s.nodeType===1&&!Ds(s)},ye.isEmpty=function(s){if(s==null)return!0;if(_i(s)&&(br(s)||typeof s=="string"||typeof s.splice=="function"||No(s)||ol(s)||os(s)))return!s.length;var d=Ji(s);if(d==V||d==f)return!s.size;if(Rl(s))return!eh(s).length;for(var j in s)if(Fn.call(s,j))return!1;return!0},ye.isEqual=function(s,d){return nc(s,d)},ye.isEqualWith=function(s,d,j){var ie=(j=typeof j=="function"?j:o)?j(s,d):o;return ie===o?nc(s,d,o,j):!!ie},ye.isError=Hl,ye.isFinite=function(s){return typeof s=="number"&&Ns(s)},ye.isFunction=za,ye.isInteger=Ac,ye.isLength=al,ye.isMap=Pc,ye.isMatch=function(s,d){return s===d||$u(s,d,Ks(d))},ye.isMatchWith=function(s,d,j){return j=typeof j=="function"?j:o,$u(s,d,Ks(d),j)},ye.isNaN=function(s){return Su(s)&&s!=+s},ye.isNative=function(s){if(dc(s))throw new lt("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Bh(s)},ye.isNil=function(s){return s==null},ye.isNull=function(s){return s===null},ye.isNumber=Su,ye.isObject=dn,ye.isObjectLike=Wr,ye.isPlainObject=Ds,ye.isRegExp=Oc,ye.isSafeInteger=function(s){return Ac(s)&&s>=-9007199254740991&&s<=D},ye.isSet=Du,ye.isString=Wl,ye.isSymbol=pi,ye.isTypedArray=ol,ye.isUndefined=function(s){return s===o},ye.isWeakMap=function(s){return Wr(s)&&Ji(s)==O},ye.isWeakSet=function(s){return Wr(s)&&da(s)=="[object WeakSet]"},ye.join=function(s,d){return s==null?"":oo.call(s,d)},ye.kebabCase=ep,ye.last=$a,ye.lastIndexOf=function(s,d,j){var ie=s==null?0:s.length;if(!ie)return-1;var he=ie;return j!==o&&(he=(he=er(j))<0?oi(ie+he,0):Bi(he,ie-1)),d==d?function(Ee,Ue,it){for(var yt=he+1;yt--;)if(Ee[yt]===Ue)return yt;return yt}(s,d):qa(s,Xa,he,!0)},ye.lowerCase=tp,ye.lowerFirst=xh,ye.lt=Rc,ye.lte=Lc,ye.max=function(s){return s&&s.length?xo(s,Ia,Zu):o},ye.maxBy=function(s,d){return s&&s.length?xo(s,In(d,2),Zu):o},ye.mean=function(s){return qr(s,Ia)},ye.meanBy=function(s,d){return qr(s,In(d,2))},ye.min=function(s){return s&&s.length?xo(s,Ia,th):o},ye.minBy=function(s,d){return s&&s.length?xo(s,In(d,2),th):o},ye.stubArray=Sh,ye.stubFalse=cs,ye.stubObject=function(){return{}},ye.stubString=function(){return""},ye.stubTrue=function(){return!0},ye.multiply=Ph,ye.nth=function(s,d){return s&&s.length?rh(s,er(d)):o},ye.noConflict=function(){return kr._===this&&(kr._=Aa),this},ye.noop=ju,ye.now=_u,ye.pad=function(s,d,j){s=Rr(s);var ie=(d=er(d))?X(s):0;if(!d||ie>=d)return s;var he=(d-ie)/2;return Js(Li(he),j)+s+Js(dr(he),j)},ye.padEnd=function(s,d,j){s=Rr(s);var ie=(d=er(d))?X(s):0;return d&&ie<d?s+Js(d-ie,j):s},ye.padStart=function(s,d,j){s=Rr(s);var ie=(d=er(d))?X(s):0;return d&&ie<d?Js(d-ie,j)+s:s},ye.parseInt=function(s,d,j){return j||d==null?d=0:d&&(d=+d),Ql(Rr(s).replace(Yt,""),d||0)},ye.random=function(s,d,j){if(j&&typeof j!="boolean"&&sa(s,d,j)&&(d=j=o),j===o&&(typeof d=="boolean"?(j=d,d=o):typeof s=="boolean"&&(j=s,s=o)),s===o&&d===o?(s=0,d=1):(s=Ta(s),d===o?(d=s,s=0):d=Ta(d)),s>d){var ie=s;s=d,d=ie}if(j||s%1||d%1){var he=ml();return Bi(s+he*(d-s+Da("1e-"+((he+"").length-1))),d)}return ih(s,d)},ye.reduce=function(s,d,j){var ie=br(s)?Uo:ms,he=arguments.length<3;return ie(s,In(d,4),j,he,Ro)},ye.reduceRight=function(s,d,j){var ie=br(s)?Cn:ms,he=arguments.length<3;return ie(s,In(d,4),j,he,qu)},ye.repeat=function(s,d,j){return d=(j?sa(s,d,j):d===o)?1:er(d),vl(Rr(s),d)},ye.replace=function(){var s=arguments,d=Rr(s[0]);return s.length<3?d:d.replace(s[1],s[2])},ye.result=function(s,d,j){var ie=-1,he=(d=Lo(d,s)).length;for(he||(he=1,s=o);++ie<he;){var Ee=s==null?o:s[_a(d[ie])];Ee===o&&(ie=he,Ee=j),s=za(Ee)?Ee.call(s):Ee}return s},ye.round=wp,ye.runInContext=xe,ye.sample=function(s){return(br(s)?Ih:function(d){return Ih(As(d))})(s)},ye.size=function(s){if(s==null)return 0;if(_i(s))return Wl(s)?X(s):s.length;var d=Ji(s);return d==V||d==f?s.size:eh(s).length},ye.snakeCase=wh,ye.some=function(s,d,j){var ie=br(s)?ps:Qo;return j&&sa(s,d,j)&&(d=o),ie(s,In(d,3))},ye.sortedIndex=function(s,d){return es(s,d)},ye.sortedIndexBy=function(s,d,j){return ts(s,d,In(j,2))},ye.sortedIndexOf=function(s,d){var j=s==null?0:s.length;if(j){var ie=es(s,d);if(ie<j&&ki(s[ie],d))return ie}return-1},ye.sortedLastIndex=function(s,d){return es(s,d,!0)},ye.sortedLastIndexBy=function(s,d,j){return ts(s,d,In(j,2),!0)},ye.sortedLastIndexOf=function(s,d){if(s!=null&&s.length){var j=es(s,d,!0)-1;if(ki(s[j],d))return j}return-1},ye.startCase=bh,ye.startsWith=function(s,d,j){return s=Rr(s),j=j==null?0:Vs(er(j),0,s.length),d=fa(d),s.slice(j,j+d.length)==d},ye.subtract=bp,ye.sum=function(s){return s&&s.length?Eo(s,Ia):0},ye.sumBy=function(s,d){return s&&s.length?Eo(s,In(d,2)):0},ye.template=function(s,d,j){var ie=ye.templateSettings;j&&sa(s,d,j)&&(d=o),s=Rr(s),d=Ua({},d,ie,Xs);var he,Ee,Ue=Ua({},d.imports,ie.imports,Xs),it=zi(Ue),yt=vo(Ue,it),Vt=0,Ft=d.interpolate||qe,$t="__p += '",On=Xn((d.escape||qe).source+"|"+Ft.source+"|"+(Ft===Rt?rt:qe).source+"|"+(d.evaluate||qe).source+"|$","g"),Bn="//# sourceURL="+(Fn.call(d,"sourceURL")?(d.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Oi+"]")+`
`;s.replace(On,function(tn,ar,fn,mr,cr,Gr){return fn||(fn=mr),$t+=s.slice(Vt,Gr).replace(ut,Na),ar&&(he=!0,$t+=`' +
__e(`+ar+`) +
'`),cr&&(Ee=!0,$t+=`';
`+cr+`;
__p += '`),fn&&($t+=`' +
((__t = (`+fn+`)) == null ? '' : __t) +
'`),Vt=Gr+tn.length,tn}),$t+=`';
`;var Yn=Fn.call(d,"variable")&&d.variable;if(Yn){if(nn.test(Yn))throw new lt("Invalid `variable` option passed into `_.template`")}else $t=`with (obj) {
`+$t+`
}
`;$t=(Ee?$t.replace(ze,""):$t).replace(He,"$1").replace(at,"$1;"),$t="function("+(Yn||"obj")+`) {
`+(Yn?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(he?", __e = _.escape":"")+(Ee?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+$t+`return __p
}`;var Ut=Bc(function(){return Ot(it,Bn+"return "+$t).apply(o,yt)});if(Ut.source=$t,Hl(Ut))throw Ut;return Ut},ye.times=function(s,d){if((s=er(s))<1||s>D)return[];var j=B,ie=Bi(s,B);d=In(d),s-=B;for(var he=Ho(ie,d);++j<s;)d(j);return he},ye.toFinite=Ta,ye.toInteger=er,ye.toLength=Fo,ye.toLower=function(s){return Rr(s).toLowerCase()},ye.toNumber=qi,ye.toSafeInteger=function(s){return s?Vs(er(s),-9007199254740991,D):s===0?s:0},ye.toString=Rr,ye.toUpper=function(s){return Rr(s).toUpperCase()},ye.trim=function(s,d,j){if((s=Rr(s))&&(j||d===o))return yo(s);if(!s||!(d=fa(d)))return s;var ie=re(s),he=re(d);return co(ie,ks(ie,he),Wo(ie,he)+1).join("")},ye.trimEnd=function(s,d,j){if((s=Rr(s))&&(j||d===o))return s.slice(0,ce(s)+1);if(!s||!(d=fa(d)))return s;var ie=re(s);return co(ie,0,Wo(ie,re(d))+1).join("")},ye.trimStart=function(s,d,j){if((s=Rr(s))&&(j||d===o))return s.replace(Yt,"");if(!s||!(d=fa(d)))return s;var ie=re(s);return co(ie,ks(ie,re(d))).join("")},ye.truncate=function(s,d){var j=30,ie="...";if(dn(d)){var he="separator"in d?d.separator:he;j="length"in d?er(d.length):j,ie="omission"in d?fa(d.omission):ie}var Ee=(s=Rr(s)).length;if(Ao(s)){var Ue=re(s);Ee=Ue.length}if(j>=Ee)return s;var it=j-X(ie);if(it<1)return ie;var yt=Ue?co(Ue,0,it).join(""):s.slice(0,it);if(he===o)return yt+ie;if(Ue&&(it+=yt.length-it),Oc(he)){if(s.slice(it).search(he)){var Vt,Ft=yt;for(he.global||(he=Xn(he.source,Rr(Zt.exec(he))+"g")),he.lastIndex=0;Vt=he.exec(Ft);)var $t=Vt.index;yt=yt.slice(0,$t===o?it:$t)}}else if(s.indexOf(fa(he),it)!=it){var On=yt.lastIndexOf(he);On>-1&&(yt=yt.slice(0,On))}return yt+ie},ye.unescape=function(s){return(s=Rr(s))&&De.test(s)?s.replace(tt,fe):s},ye.uniqueId=function(s){var d=++Jo;return Rr(s)+d},ye.upperCase=yp,ye.upperFirst=Fc,ye.each=is,ye.eachRight=Fl,ye.first=fh,ls(ye,(Gc={},Ba(ye,function(s,d){Fn.call(ye.prototype,d)||(Gc[d]=s)}),Gc),{chain:!1}),ye.VERSION="4.17.21",wi(["bind","bindKey","curry","curryRight","partial","partialRight"],function(s){ye[s].placeholder=ye}),wi(["drop","take"],function(s,d){xr.prototype[s]=function(j){j=j===o?1:oi(er(j),0);var ie=this.__filtered__&&!d?new xr(this):this.clone();return ie.__filtered__?ie.__takeCount__=Bi(j,ie.__takeCount__):ie.__views__.push({size:Bi(j,B),type:s+(ie.__dir__<0?"Right":"")}),ie},xr.prototype[s+"Right"]=function(j){return this.reverse()[s](j).reverse()}}),wi(["filter","map","takeWhile"],function(s,d){var j=d+1,ie=j==1||j==3;xr.prototype[s]=function(he){var Ee=this.clone();return Ee.__iteratees__.push({iteratee:In(he,3),type:j}),Ee.__filtered__=Ee.__filtered__||ie,Ee}}),wi(["head","last"],function(s,d){var j="take"+(d?"Right":"");xr.prototype[s]=function(){return this[j](1).value()[0]}}),wi(["initial","tail"],function(s,d){var j="drop"+(d?"":"Right");xr.prototype[s]=function(){return this.__filtered__?new xr(this):this[j](1)}}),xr.prototype.compact=function(){return this.filter(Ia)},xr.prototype.find=function(s){return this.filter(s).head()},xr.prototype.findLast=function(s){return this.reverse().find(s)},xr.prototype.invokeMap=wr(function(s,d){return typeof s=="function"?new xr(this):this.map(function(j){return yl(j,s,d)})}),xr.prototype.reject=function(s){return this.filter(as(In(s)))},xr.prototype.slice=function(s,d){s=er(s);var j=this;return j.__filtered__&&(s>0||d<0)?new xr(j):(s<0?j=j.takeRight(-s):s&&(j=j.drop(s)),d!==o&&(j=(d=er(d))<0?j.dropRight(-d):j.take(d-s)),j)},xr.prototype.takeRightWhile=function(s){return this.reverse().takeWhile(s).reverse()},xr.prototype.toArray=function(){return this.take(B)},Ba(xr.prototype,function(s,d){var j=/^(?:filter|find|map|reject)|While$/.test(d),ie=/^(?:head|last)$/.test(d),he=ye[ie?"take"+(d=="last"?"Right":""):d],Ee=ie||/^find/.test(d);he&&(ye.prototype[d]=function(){var Ue=this.__wrapped__,it=ie?[1]:arguments,yt=Ue instanceof xr,Vt=it[0],Ft=yt||br(Ue),$t=function(ar){var fn=he.apply(ye,Fi([ar],it));return ie&&On?fn[0]:fn};Ft&&j&&typeof Vt=="function"&&Vt.length!=1&&(yt=Ft=!1);var On=this.__chain__,Bn=!!this.__actions__.length,Yn=Ee&&!On,Ut=yt&&!Bn;if(!Ee&&Ft){Ue=Ut?Ue:new xr(this);var tn=s.apply(Ue,it);return tn.__actions__.push({func:el,args:[$t],thisArg:o}),new Or(tn,On)}return Yn&&Ut?s.apply(this,it):(tn=this.thru($t),Yn?ie?tn.value()[0]:tn.value():tn)})}),wi(["pop","push","shift","sort","splice","unshift"],function(s){var d=oa[s],j=/^(?:push|sort|unshift)$/.test(s)?"tap":"thru",ie=/^(?:pop|shift)$/.test(s);ye.prototype[s]=function(){var he=arguments;if(ie&&!this.__chain__){var Ee=this.value();return d.apply(br(Ee)?Ee:[],he)}return this[j](function(Ue){return d.apply(br(Ue)?Ue:[],he)})}}),Ba(xr.prototype,function(s,d){var j=ye[d];if(j){var ie=j.name+"";Fn.call(un,ie)||(un[ie]=[]),un[ie].push({name:d,func:j})}}),un[Ws(o,2).name]=[{name:"wrapper",func:o}],xr.prototype.clone=function(){var s=new xr(this.__wrapped__);return s.__actions__=ma(this.__actions__),s.__dir__=this.__dir__,s.__filtered__=this.__filtered__,s.__iteratees__=ma(this.__iteratees__),s.__takeCount__=this.__takeCount__,s.__views__=ma(this.__views__),s},xr.prototype.reverse=function(){if(this.__filtered__){var s=new xr(this);s.__dir__=-1,s.__filtered__=!0}else(s=this.clone()).__dir__*=-1;return s},xr.prototype.value=function(){var s=this.__wrapped__.value(),d=this.__dir__,j=br(s),ie=d<0,he=j?s.length:0,Ee=function(Gr,Un,or){for(var ji=-1,ri=or.length;++ji<ri;){var ca=or[ji],li=ca.size;switch(ca.type){case"drop":Gr+=li;break;case"dropRight":Un-=li;break;case"take":Un=Bi(Un,Gr+li);break;case"takeRight":Gr=oi(Gr,Un-li)}}return{start:Gr,end:Un}}(0,he,this.__views__),Ue=Ee.start,it=Ee.end,yt=it-Ue,Vt=ie?it:Ue-1,Ft=this.__iteratees__,$t=Ft.length,On=0,Bn=Bi(yt,this.__takeCount__);if(!j||!ie&&he==yt&&Bn==yt)return ah(s,this.__actions__);var Yn=[];e:for(;yt--&&On<Bn;){for(var Ut=-1,tn=s[Vt+=d];++Ut<$t;){var ar=Ft[Ut],fn=ar.iteratee,mr=ar.type,cr=fn(tn);if(mr==2)tn=cr;else if(!cr){if(mr==1)continue e;break e}}Yn[On++]=tn}return Yn},ye.prototype.at=bc,ye.prototype.chain=function(){return wc(this)},ye.prototype.commit=function(){return new Or(this.value(),this.__chain__)},ye.prototype.next=function(){this.__values__===o&&(this.__values__=Vo(this.value()));var s=this.__index__>=this.__values__.length;return{done:s,value:s?o:this.__values__[this.__index__++]}},ye.prototype.plant=function(s){for(var d,j=this;j instanceof ba;){var ie=kl(j);ie.__index__=0,ie.__values__=o,d?he.__wrapped__=ie:d=ie;var he=ie;j=j.__wrapped__}return he.__wrapped__=s,d},ye.prototype.reverse=function(){var s=this.__wrapped__;if(s instanceof xr){var d=s;return this.__actions__.length&&(d=new xr(this)),(d=d.reverse()).__actions__.push({func:el,args:[Ts],thisArg:o}),new Or(d,this.__chain__)}return this.thru(Ts)},ye.prototype.toJSON=ye.prototype.valueOf=ye.prototype.value=function(){return ah(this.__wrapped__,this.__actions__)},ye.prototype.first=ye.prototype.head,Zr&&(ye.prototype[Zr]=function(){return this}),ye}();Ce?((Ce.exports=be)._=be,ee._=be):kr._=be}).call(commonjsGlobal)}),MrxDbgUiPrBaseReturn;async function useCanvasResizeListener(T,r,o=100){if(!store.state.MxFun)return void console.error("请先调用loadCoreCode方法! ");if(!T)return void console.error("请确保mxdrawObj参数 是通过调用MxFun.createMxObject的callback回调函数拿到的mxDraw对象");let a=T;if(!a.isLoadCanvasResizeListene){let x;a.isLoadCanvasResizeListene=!0,T.addEvent("addResizeEvent",M=>{x=M}),await dynamicImport("element-resize-event-polyfill");let u=createCanvasParent(r);u.addEventListener?u.addEventListener("resize",lodash.throttle(function(M){x&&x()},o),!1):console.log("mx: parentdiv[addEventListener] invalid")}}class McEdGetPointWorldDrawObject{constructor(){var r;this._McEdGetPointWorldDraw=new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().McEdGetPointWorldDrawObjectClass()),this._get=()=>this._McEdGetPointWorldDraw}drawCircle(r,o){return this._McEdGetPointWorldDraw.drawCircle(r,o)}drawLine(r,o){return this._McEdGetPointWorldDraw.drawLine(r,o)}drawSolid(r,o){this.drawSolid(r,o)}drawRect(r,o){return this._McEdGetPointWorldDraw.drawRect(r,o)}drawEntity(r,o){return this._McEdGetPointWorldDraw.drawEntity(r,o)}drawMcDbEntity(r,o){return this._McEdGetPointWorldDraw.drawMcDbEntity(r,o)}drawMcDbLine(r,o,a,x,u,M){return this._McEdGetPointWorldDraw.drawMcDbLine(r,o,a,x,u,M)}drawText(r,o,a,x){return this._McEdGetPointWorldDraw.drawText(r,o,a,x)}setDraw(r){return this._McEdGetPointWorldDraw.setDraw(r)}setColor(r){return this._McEdGetPointWorldDraw.setColor(r)}getColor(){return this._McEdGetPointWorldDraw.getColor()}drawCustomEntity(r,o){return this._McEdGetPointWorldDraw.drawCustomEntity(r,o)}}(function(T){T[T.kCancel=-2]="kCancel",T[T.kNone=-1]="kNone",T[T.kOk=0]="kOk",T[T.kKeyWord=1]="kKeyWord"})(MrxDbgUiPrBaseReturn||(MrxDbgUiPrBaseReturn={}));var MrxDbgUiPrBaseReturn$1=MrxDbgUiPrBaseReturn,MxCursorType,DynamicInputType,DetailedResult,UserInputControls;(function(T){T[T.kNormal=0]="kNormal",T[T.kRect=1]="kRect",T[T.kCross=2]="kCross"})(MxCursorType||(MxCursorType={})),function(T){T[T.kNoInput=0]="kNoInput",T[T.kXYCoordInput=1]="kXYCoordInput",T[T.kDistanceInput=2]="kDistanceInput",T[T.kDynTip=3]="kDynTip",T[T.kAutoInput=4]="kAutoInput"}(DynamicInputType||(DynamicInputType={})),function(T){T[T.kUnknown=1]="kUnknown",T[T.kTouchDownIn=2]="kTouchDownIn",T[T.kTouchUpIn=3]="kTouchUpIn",T[T.kMouseLeftIn=4]="kMouseLeftIn",T[T.kMouseLeftUpIn=5]="kMouseLeftUpIn",T[T.kMouseRightIn=6]="kMouseRightIn",T[T.kKeyIn=7]="kKeyIn",T[T.kCoordIn=8]="kCoordIn",T[T.kNullEnterIn=9]="kNullEnterIn",T[T.kNullSpaceIn=10]="kNullSpaceIn",T[T.kEcsIn=11]="kEcsIn",T[T.kNewCommadIn=12]="kNewCommadIn",T[T.kCodeAbort=13]="kCodeAbort"}(DetailedResult||(DetailedResult={})),function(T){T[T.kGovernedByOrthoMode=1]="kGovernedByOrthoMode",T[T.kNullResponseAccepted=2]="kNullResponseAccepted",T[T.kDontEchoCancelForCtrlC=4]="kDontEchoCancelForCtrlC",T[T.kDontUpdateLastPoint=8]="kDontUpdateLastPoint",T[T.kNoDwgLimitsChecking=16]="kNoDwgLimitsChecking",T[T.kNoZeroResponseAccepted=32]="kNoZeroResponseAccepted",T[T.kNoNegativeResponseAccepted=64]="kNoNegativeResponseAccepted",T[T.kAccept3dCoordinates=128]="kAccept3dCoordinates",T[T.kAcceptMouseUpAsPoint=256]="kAcceptMouseUpAsPoint",T[T.kAnyBlankTerminatesInput=512]="kAnyBlankTerminatesInput",T[T.kInitialBlankTerminatesInput=1024]="kInitialBlankTerminatesInput",T[T.kAcceptOtherInputString=2048]="kAcceptOtherInputString",T[T.kGovernedByUCSDetect=4096]="kGovernedByUCSDetect",T[T.kNoZDirectionOrtho=8192]="kNoZDirectionOrtho",T[T.kSpacesInAccepted=16384]="kSpacesInAccepted"}(UserInputControls||(UserInputControls={}));class MrxDbgUiPrBase{constructor(r){this.imp=r,this.status=MrxDbgUiPrBaseReturn$1.kCancel}keyWords(){return this.imp.keyWords()}setKeyWords(r){return this.imp.setKeyWords(r)}message(){return this.imp.message()}setMessage(r){return this.imp.setMessage(r)}clearLastInputPoint(){this.imp.clearLastInputPoint()}setLastInputPoint(r){this.imp.SetLASTPOINT(r)}keyWordPicked(){return this.imp.keyWordPicked()}isKeyWordPicked(r){return this.status==MrxDbgUiPrBaseReturn$1.kKeyWord&&this.imp.isKeyWordPicked(r)}setUserDraw(r){if(typeof r!="function")return this.imp.setUserDraw(r._get?r._get():r);{const o=new McEdGetPointWorldDrawObject;o.setDraw(r),this.imp.setUserDraw(o._get())}}getDetailedResult(){return this.imp.getDetailedResult()}getStatus(){return this.status}drawReserve(r){return this.imp.drawReserve(r)}setInputToucheType(r){return this.imp.setInputToucheType(r)}getInputToucheType(){return this.imp.getInputToucheType()}setCursorType(r){this.imp.setCursorType(r)}getCursorType(){return this.imp.getCursorType()}setDynamicInputType(r){this.imp.setDynamicInputType(r)}getDynamicInputType(){return this.imp.getDynamicInputType()}isDisableDynInput(){return this.imp.isDisableDynInput()}setDisableDynInput(r){return this.imp.setDisableDynInput(r)}setDisableOsnap(r){return this.imp.setDisableOsnap(r)}isOffsetInputPostion(){return this.imp.isOffsetInputPostion()}setOffsetInputPostion(r){return this.imp.setOffsetInputPostion(r)}isDisableOsnap(){return this.imp.isDisableOsnap()}setDisableDynamicTrace(r){this.imp.setDisableDynamicTrace(r)}isDisableDynamicTrace(){return this.imp.isDisableDynamicTrace()}setDisablePolarAxisTrace(r){this.imp.setDisablePolarAxisTrace(r)}isDisablePolarAxisTrace(){return this.imp.isDisablePolarAxisTrace()}setDisableGridTrace(r){this.imp.setDisableGridTrace(r)}isDisableGridTrace(){return this.imp.isDisableGridTrace()}setDisableOrthoTrace(r){this.imp.setDisableOrthoTrace(r)}isDisableOrthoTrace(){return this.imp.isDisableOrtho()}disableAllTrace(r=!0){this.imp.disableAllTrace(r)}userInputControls(){return this.imp.userInputControls()}setUserInputControls(r){this.imp.setUserInputControls(r)}}class MrxDbgUiPrPoint extends MrxDbgUiPrBase{constructor(){var r;super(new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().getMrxDbgUiPrPointClass()))}value(){return this.imp.value()}getCADValue(){return this.imp.getCADValue()}valueDocCoord(){return this.imp.valueDocCoord()}basePt(){return this.imp.basePt()}setBasePt(r){return this.imp.setBasePt(r)}setUseBasePt(r){return this.imp.setUseBasePt(r)}go(r){let o=this;return r?(o.imp.go(a=>{o.status=a,r(a)}),new Promise((a,x)=>{a(null)})):new Promise((a,x)=>{o.imp.go(u=>{o.status=u,a(u!=0?null:o.imp.value())})})}goWhile(r,o){return this.imp.goWhile(r,o)}abort(r){this.imp.abort(r)}}class MxVueComandLine{constructor(){this.msCmdText="",this.msCmdDisplay="",this.msCmdTip="",this.mxFunObject=void 0,this.mountUpDisplayFun=r=>{this.mUpDisplayFun=r},this.setCmdText=r=>{this.msCmdText=r},this.getCmdText=()=>this.msCmdText,this.getCmdDisplay=()=>this.msCmdDisplay,this.setCmdDisplay=r=>{this.msCmdDisplay=r},this.addCmdDisplay=r=>{this.msCmdDisplay.length>1024?(this.msCmdDisplay=this.msCmdDisplay.substring(this.msCmdDisplay.length-1024,this.msCmdDisplay.length),this.msCmdDisplay=this.msCmdDisplay+r):this.msCmdDisplay=this.msCmdDisplay+r},this.setCmdTip=r=>{this.msCmdTip=r},this.getCmdTip=()=>this.msCmdTip}upDisplay(){const{msCmdTip:r,msCmdDisplay:o,msCmdText:a}=this;this.mUpDisplayFun!=null&&this.mUpDisplayFun({msCmdTip:r,msCmdDisplay:o,msCmdText:a})}}const MxInputType={kNoInput:0,kXYCoordInput:1,kDistanceInput:2,kDynTip:3},MxInputPostionType={kRelative:0,kAbsolutely:1};class MxDynamicInput{constructor(){this.mType=MxInputType.kNoInput,this.mPos=[0,0],this.mTip="",this.mValue1="",this.mValue1Pos=[0,0],this.mValue2="",this.mValue2Pos=[0,0],this.misShow=!1,this.focusIndex=0,this.mLockValues=new Map,this.mOnKeydownEvent=void 0,this.mFocusValue="",this.setFocusValue=r=>{this.mFocusValue=r},this.getFocusValue=()=>this.mFocusValue,this.getFocusIndex=()=>this.focusIndex,this.setFocusIndex=r=>{this.focusIndex=r},this.mountKeydownEvent=r=>{this.mOnKeydownEvent=r},this.onKeydown=r=>this.mOnKeydownEvent==null?0:this.mOnKeydownEvent(r),this.setType=r=>{this.mType=r},this.getType=()=>this.mType,this.isShow=()=>this.misShow,this.setPos=r=>{this.mPos=r},this.setTip=r=>{this.mTip=r},this.setValue1=r=>{this.mValue1=r},this.getValue1=()=>this.mValue1,this.setValue1Pos=r=>{this.mValue1Pos=r},this.setValue2=r=>{this.mValue2=r},this.getValue2=()=>this.mValue2,this.setValue2Pos=r=>{this.mValue2Pos=r},this.setShow=r=>{this.misShow=r},this.getData=()=>{if(!this.misShow)return;let r={list:[{value:"",readonly:!0},{value:"",readonly:!1},{value:"",readonly:!1}],pos:this.mPos,postype:MxInputPostionType.kRelative};return this.mType!=MxInputType.kNoInput?(this.mType==MxInputType.kXYCoordInput?(r.list[0].show=!0,r.list[0].value=this.mTip,r.list[0].readonly=!0,r.list[1].show=!0,r.list[1].value=this.mValue1,r.list[1].readonly=!1,r.list[2].show=!0,r.list[2].value=this.mValue2,r.list[2].readonly=!1):this.mType==MxInputType.kDistanceInput?(r.list[0].show=!0,r.list[0].value=this.mTip,r.list[0].readonly=!0,r.list[1].show=!0,r.list[1].value=this.mValue1,r.list[1].readonly=!1,r.list[1].pos=this.mValue1Pos,r.list[2].show=!0,r.list[2].value=this.mValue2,r.list[2].readonly=!1,r.list[2].pos=this.mValue2Pos,r.postype=MxInputPostionType.kAbsolutely):this.mType==MxInputType.kDynTip?(r.list[0].show=!0,r.list[0].value=this.mTip,r.list[0].readonly=!0,r.list[1].show=!1,r.list[2].show=!1):r=void 0,r):void 0}}setLockValues(r,o){o.length==0?this.mLockValues.delete(r):this.mLockValues.set(r,o)}getLockValues(r){return this.mLockValues.has(r)?this.mLockValues.get(r):""}getLockValuesMap(){return this.mLockValues}clearLockValuesMap(){this.mLockValues.clear()}}const CursorType={kNormal:"Normal",kRect:"Rect",kCross:"Cross",kPan:"Pan"},RightMenuType={kNoShow:0,kDefautMenu:1,kCommandRuningMenu:2,kOsnapSetCommandRuningMenu:3};class MxVueInterface{constructor(){this.mSetCoordFun=void 0,this.mUpdateCursorFun=void 0,this.mOnKeydownEvent=void 0,this.mCursorType=CursorType.kNormal,this.mComandLine=new MxVueComandLine,this.mdynamicInput=new MxDynamicInput,this.mMxEvents={},this.mountSetCoordFun=r=>{this.mSetCoordFun=r},this.mountUpdateCursorFun=r=>{this.mUpdateCursorFun=r},this.mountKeydownEvent=r=>{this.mOnKeydownEvent=r},this.onKeydown=r=>{this.mOnKeydownEvent!=null&&this.mOnKeydownEvent(r)},this.mountsetRightMenuSnapTypeFun=r=>{this.mRightMenuSnapTypeFun=r},this.setTipCoord=r=>{this.mSetCoordFun!=null&&this.mSetCoordFun(r)},this.getCursorType=()=>this.mCursorType,this.setCursorType=r=>{if(typeof r=="number")switch(r){case 0:this.mCursorType=CursorType.kNormal;break;case 1:this.mCursorType=CursorType.kRect;break;case 2:this.mCursorType=CursorType.kCross;break;case 3:this.mCursorType=CursorType.kPan}else this.mCursorType=r;this.mUpdateCursorFun!=null&&this.mUpdateCursorFun(this.mCursorType)},this.getTitle=()=>this.mTitle,this.getTopButtonBarData=()=>this.mTopButtonBarData,this.getMenuBarData=()=>this.mMenuBarData,this.getRighButtonBarData=()=>this.mRighButtonBarData,this.getLeftButtonBarData=()=>this.mLeftButtonBarData,this.getTitleButtonBarData=()=>this.mTitleButtonBarData,this.getLayerComboxData=()=>this.mLayerComboxData,this.getColorComboxData=()=>this.mColorComboxData,this.getLinetypeComboxData=()=>this.mLinetypeComboxData,this.getFooterData=()=>this.mFooterData,this.sendStringToExecute=r=>{this.mxFunObject.sendStringToExecute(r)},this.getCmdLine=()=>this.mComandLine,this.getDynamicInput=()=>this.mdynamicInput,this.init=r=>{this.mxFunObject=r},this.OnMxEvent=r=>{const o=r.name;if(o==null)return;const a=this.mMxEvents[o];a!=null&&a(r.param)},this.mountMxEvent=(r,o)=>{this.mMxEvents[r]=o}}setRightMenuOSmodeValue(r){this.mRightMenuSnapTypeFun!=null&&this.mRightMenuSnapTypeFun(r)}executeOperations(r){this.mTsWeb_MxUiVue.executeOperations(r)}mountTsWeb_MxUiVue(r){this.mTsWeb_MxUiVue=r}getRightMenuType(r){let o=MxFun.getRunningCommand();return o?r&&o.isEnableOsnap()?RightMenuType.kOsnapSetCommandRuningMenu:RightMenuType.kCommandRuningMenu:RightMenuType.kDefautMenu}}const mxUiData$1=new MxVueInterface;function createReandomId(T=10){return new Number(Math.random().toString().substr(3,T)+Date.now()).toString(36)}class Node extends PubSub{constructor(){super(...arguments),this.parent=null,this.children=[]}add(...r){if(r.length>1){for(let a=0;a<r.length;a++){const x=r[a];this.add(x)}return this}const o=r[0];return o===this?(console.error("Node.add 不可以添加它自己"),this):(o&&(o.parent!==null&&o.parent.remove(o),o.parent=this,this.children.push(o)),this)}remove(...r){r.length>1&&r.forEach(x=>{this.remove(x)});const o=r[0],a=this.children.indexOf(o);return a!==-1&&(o.parent=null,this.children.splice(a,1)),this}removeFromParent(){const r=this.parent;return r!==null&&r.remove(this),this}clear(){for(let r=0;r<this.children.length;r++)this.children[r].parent=null;return this.children.length=0,this}getNodeByProperty(r,o){if(this[r]===o)return this;for(let a=0,x=this.children.length;a<x;a++){const u=this.children[a].getNodeByProperty(r,o);if(u!==void 0)return u}}getNodesByProperty(r,o){let a=[];this[r]===o&&a.push(this);for(let x=0,u=this.children.length;x<u;x++){const M=this.children[x].getNodesByProperty(r,o);M.length>0&&(a=a.concat(M))}return a}traverse(r){r(this);const o=this.children;for(let a=0,x=o.length;a<x;a++)o[a].traverse(r)}traverseParent(r){this.parent!==null&&r(this.parent)!==!1&&this.parent.traverseParent(r)}emit(r,...o){super.emit(r,...o),this.traverseParent(a=>(a.emit(r,...o),(o==null?void 0:o.isEventBubbling)!==!1&&void 0))}}class RenderOrderNode extends Node{constructor(){super(),this.renderOrder=30}setRenderOrder(r){this.renderOrder=r}getRenderOrder(){return this.renderOrder}top(){var r;if(!this.parent)return;let o=Math.max(...(r=this.parent)===null||r===void 0?void 0:r.children.map(({renderOrder:a})=>a));o!==this.renderOrder&&o++,this.setRenderOrder(o)}bottom(){var r;if(!this.parent)return;let o=Math.min(...(r=this.parent)===null||r===void 0?void 0:r.children.map(({renderOrder:a})=>a));o--,this.setRenderOrder(o)}restoreDefaultRenderOrder(){this.renderOrder=30}}class Layer extends RenderOrderNode{constructor(r){super(),this.isLayer=!0,this.getLayerMap=()=>this.getDatabase()._mxDatabase.mapNameToLayer,this.getEntityMap=()=>this.getDatabase()._mxDatabase.mapIdToEntity,this.getRootLayerName=()=>this.getNames()[0]||"0";const o=typeof r=="string"?r:Date.now()+Math.random().toString(36).substr(2,9);Object.defineProperty(this,"name",{get:()=>o,set(){throw new Error("不能修改Layer.name值, 因为它是Layer 实例的唯一标识")},configurable:!1});let a=this.renderOrder;Object.defineProperty(this,"renderOrder",{get:()=>a,set(x){this.getLayer().group.renderOrder=x,a=x,MxFun.updateDisplay()}})}get visible(){const r=this.getDatabase().getLayer(this.name);return!r||r.getVisible()}set visible(r){this.getDatabase().showLayer(this.name,r),MxFun.updateDisplay()}setVisible(r){this.visible=r}getDatabase(){return this._database||(this._database=MxFun.getCurrentDatabase()),this._database}getLayer(){return this.getDatabase().getLayer(this.name)||this.getDatabase().addLayer(this.name),this.getDatabase().getLayer(this.name)}getCurrentName(){return this.getDatabase()._mxDatabase.curLayer.toString()}async callLayerContextFun(r){const o=this.getCurrentName();this.getDatabase().setCurrentLayer(this.name);const a=await r();return this.getDatabase().setCurrentLayer(o),a}getNames(){return Array.from(this.getLayerMap().keys())}getAllEntity(){return Array.from(this.getEntityMap().values()).filter(({userObject:r})=>r.layer===this.name).map(({userObject:r})=>r)}add(...r){var o;const a=this.getLayer();return a.group.renderOrder!==this.renderOrder&&(a.group.renderOrder=this.renderOrder,this.children=this.getAllEntity()),this.parent||(this.parent=MxFun.getCurrentDraw(),(o=this.parent)===null||o===void 0||o.add(this)),super.add(...r),this.callLayerContextFun(()=>{r.forEach(x=>{x&&this.getDatabase().addEntity(x)})}),this}remove(...r){super.remove(...r);let o=this.getRootLayerName();return this.callLayerContextFun(()=>{r.forEach(a=>{a&&(a.setLayer(o),a.setNeedUpdateDisplay())})}),this}}class MxDbDatabase{constructor(r){this._mxDatabase=r}addLayer(r){return this._mxDatabase.addLayer(r)}showLayer(r,o){this._mxDatabase.showLayer(r,o)}setCurrentLayer(r){return this._mxDatabase.setCurrentLayer(r)}getLayer(r){return this._mxDatabase.getLayer(r)}addEntity(r){return this._mxDatabase.addMxEntity(r)}getGroup(r){return this._mxDatabase.getGroupDictionary().getAt(r)}addGroup(r){return this._mxDatabase.getGroupDictionary().add(r)}getEntityInGroup(r){return this._mxDatabase.getGroupDictionary().getEntityInGroup(r)}deleteGroup(r){return this._mxDatabase.getGroupDictionary().delete(r)}}class MxTempMarkDraw{constructor(r){this.imp=r}clear(){this.imp.clear()}drawLine(r,o,a=16777215,x=1){this.imp.drawLine(r,o,a,x)}drawCircle(r,o,a){this.imp.drawCircle(r,o,a)}drawEntity(r){this.imp.drawEntity(r)}drawCircleMark(r,o,a){this.imp.drawCircleMark(r,o,a)}}function setGeometrPostion(T,r){for(let o=0;o<T.vertices.length;o++)T.vertices[o].x+=r.x,T.vertices[o].y+=r.y,T.vertices[o].z+=r.z}function repairGeometryFaceVertexUvs(T){T.computeBoundingBox();const r=T.boundingBox.min,o=T.boundingBox.max,a=new THREE.Vector2(0-r.x,0-r.y),x=new THREE.Vector2(o.x-r.x,o.y-r.y);T.faceVertexUvs[0]=[];const u=T.faces;for(let M=0;M<u.length;M++){const I=u[M],H=T.vertices[I.a],G=T.vertices[I.b],L=T.vertices[I.c];T.faceVertexUvs[0].push([new THREE.Vector2((H.x+a.x)/x.x,(H.y+a.y)/x.y),new THREE.Vector2((G.x+a.x)/x.x,(G.y+a.y)/x.y),new THREE.Vector2((L.x+a.x)/x.x,(L.y+a.y)/x.y)])}return T.uvsNeedUpdate=!0,T}function insertPointsWithEqualSpacing(T){const r=[];if(T.length<2)return T;let o=Number.MAX_VALUE;for(let a=0;a<T.length-1;a++){const x=T[a].distanceTo(T[a+1]);x<o&&(o=x)}for(let a=0;a<T.length-1;a++){const x=T[a],u=T[a+1];r.push(x);const M=x.distanceTo(u);if(M>o){const I=Math.floor(M/o),H=u.clone().sub(x).normalize();for(let G=1;G<I;G++){const L=x.clone().add(H.clone().multiplyScalar(G*o));r.push(L)}}}return r.push(T[T.length-1]),r}function getToGenerateRoundedCorners(T,r,o=!0){const a=new THREE.CurvePath;if(T.length<2)throw new Error("Points should have at least 2 items");if(!r||r.length===0)return T;!o&&T[0].equals(T[T.length-1])&&T.pop(),o||T.push(T[0]);for(let u=0;u<T.length-1;u++){const M=r[u]||0;if(u===0&&!o){const C=T[0].clone().sub(T[1]);C.normalize();const B=T[1].clone();B.add(C.clone().multiplyScalar(M));const z=new THREE.LineCurve3(T[0],B);a.curves.push(z);continue}const I=!o||T[u-1]?T[u-1].clone().sub(T[u]):T[T.length-1].clone().sub(T[0]);I.normalize();const H=!o||T[u+1]?T[u+1].clone().sub(T[u]):T[1].clone().sub(T[0]);H.normalize();const G=T[u].clone().add(I.clone().multiplyScalar(M)),L=T[u].clone(),y=T[u].clone().add(H.clone().multiplyScalar(M)),D=new THREE.QuadraticBezierCurve3(G,L,y);if(u===T.length-2){const C=T[u].clone().add(H.clone().multiplyScalar(M)),B=T[u+1].clone();o?B.add(H.clone().multiplyScalar(-M)):B.add(H.clone());const z=new THREE.LineCurve3(C,B);a.curves.push(D,z)}else a.curves.push(D);u===0&&T.push(T[0])}let x=a.getPoints();return x=insertPointsWithEqualSpacing(x)}function computeRectPoints(T,r){return[T,T.clone().set(r.x,T.y,r.z),r,r.clone().set(T.x,r.y,T.z)]}function calculateArcOrigin(T,r,o){const a=T.x,x=r.x,u=o.x,M=T.y,I=r.y,H=o.y,G=a-x,L=M-I,y=a-u,D=M-H,C=(a*a-x*x+(M*M-I*I))/2,B=(a*a-u*u+(M*M-H*H))/2,z=L*y-G*D,A=-(D*C-L*B)/z,S=-(G*B-y*C)/z;return new THREE.Vector3(A,S,0)}function calculateRadiusArc(T,r){const o=T.x,a=T.y,x=r.x,u=r.y;return Math.sqrt((o-x)*(o-x)+(a-u)*(a-u))}function calculateArcAngle(T,r,o){const a=T.x,x=r.x;let u,M,I;return u=(T.y-r.y)/o,(M=(a-x)/o)>=.99999&&(M=.99999),M<=-.99999&&(M=-.99999),I=(I=Math.acos(M))/Math.PI*180,u<-.05&&(I=360-I),{sin:u,cos:M,angle:I}}function judgementArcRenderDirection(T,r,o){return(T<r?r-T:r-T+360)>(T<o?o-T:o-T+360)}function createThreePointArc(T,r,o,a=!1,x=!1,u=new THREE.Color("#ff0000")){const M=calculateArcOrigin(T,r,o),I=M.x,H=M.y,G=calculateRadiusArc(T,M),L=calculateArcAngle(T,M,G),y=calculateArcAngle(r,M,G),D=calculateArcAngle(o,M,G);let C,B,z=L.angle,A=y.angle,S=D.angle,q=judgementArcRenderDirection(z,A,S);x&&(q=!0),a?(B=new THREE.ArcCurve(I,H,G,THREE.MathUtils.degToRad(z),THREE.MathUtils.degToRad(A),!q),C=q?A>z?THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle):360-Math.abs(THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle)):z>A?Math.abs(THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle)):360-THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle)):(B=new THREE.ArcCurve(I,H,G,THREE.MathUtils.degToRad(z),THREE.MathUtils.degToRad(S),q),C=q?S>z?360-THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle):Math.abs(THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle)):z>S?360+THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle):THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle));const W=C*Math.PI*G/180,_=new THREE.BufferGeometry().setFromPoints(B.getPoints(50)),R=new THREE.LineBasicMaterial({color:u});return{arc:new THREE.Line(_,R),radius:G,angle:C,arcLength:W}}function computeRegularPolygonVertices(T=new THREE.Vector3,r=new THREE.Vector3,o=3){const a=[];o=Math.max(3,o),a.push(r);const x=2*Math.PI/o;for(let u=1;u<o;u++){const M=Math.cos(x*u),I=Math.sin(x*u),H=T.clone(),G=r.clone(),L=G.x-H.x,y=G.y-H.y,D=new THREE.Vector3(L*M-y*I+H.x,L*I+y*M+H.y);a.push(D)}return a}function computeBounding(T){if(T.length==0){let r=new THREE.Vector3;return{centerPoint:r,minPoint:r,maxPoint:r}}{let r=new THREE.Vector3(T[0].x,T[0].y,T[0].z||0),o=new THREE.Vector3(T[0].x,T[0].y,T[0].z||0),a=T.length;for(let x=1;x<a;x++){let u=T[x];r.x>u.x&&(r.x=u.x),r.y>u.y&&(r.y=u.y),o.x<u.x&&(o.x=u.x),o.y<u.y&&(o.y=u.y)}return{centerPoint:new THREE.Vector3(r.x+.5*(o.x-r.x),r.y+.5*(o.y-r.y),0),minPoint:r,maxPoint:o}}}function MxThreeJSMixin(T){return T.createImage=function(r,o,a,x,u){if(!u)return new Promise((M,I)=>{T.createImage.call(this,r,o,a,x,H=>M(H))});new THREE.TextureLoader().load(x,function(M){let I=new THREE.PlaneGeometry(o,a),H=new THREE.MeshLambertMaterial({map:M,transparent:!0,side:THREE.DoubleSide});H.map&&(H.map.needsUpdate=!0),setGeometrPostion(I,r);let G=new THREE.Mesh(I,H);G.material.depthTest=!1,u&&u(G)},void 0,function(M){console.log(M),u&&u(null)})},T.loadSVG=function(r,o,a,x){return a?(store.state.MxFun.loadSVG(r,o,a,x),new Promise(u=>{u(null)})):new Promise(u=>{store.state.MxFun.loadSVG(r,o,M=>{u(M)},x)})},T.clacTextSize=(r,o)=>store.state.MxFun.getMxThreeJS().clacTextSize(r,o),T.clacTextSpriteSize=(r,o,a)=>store.state.MxFun.getMxThreeJS().clacTextSpriteSize(r,o,a),T.creatTextSprite=(r,o,a,x,u)=>r.length===0?null:(u instanceof Object?u.getHex&&(u=u.getHex()):typeof u=="string"&&(u=parseInt(u)),store.state.MxFun.getMxThreeJS().creatTextSprite(r,o,a,x,u)),T}class MxThreeJS$1{createLine(r,o,a){const x=new THREE.Geometry,u=new THREE.LineBasicMaterial({color:a});return x.vertices.push(r,o),new THREE.Line(x,u)}createCircle(r,o,a){const x=new THREE.CircleGeometry(o,64,3,2*Math.PI),u=new THREE.LineBasicMaterial({color:a});x.vertices.shift();const M=new THREE.LineLoop(x,u),{x:I,y:H,z:G}=r;return M.position.set(I,H,G),M}createPoint(r,o,a=3){const x=new THREE.Geometry;x.vertices.push(r);const u=new THREE.PointsMaterial({color:o,size:a});return new THREE.Points(x,u)}createTriangle(r,o,a=1){if(r.length<3)return null;const x=r.length,u=new THREE.Geometry;for(let I=0;I+2<x;I+=3){u.vertices.push(r[I]),u.vertices.push(r[I+1]),u.vertices.push(r[I+2]);const H=new THREE.Face3(I,I+1,I+2);u.faces.push(H)}u.computeFaceNormals(),u.computeVertexNormals();const M=new THREE.MeshBasicMaterial({color:o,transparent:!0,depthTest:!1,side:THREE.DoubleSide,opacity:a});return new THREE.Mesh(u,M)}createLines(r,o){const a=new THREE.Geometry;a.vertices=r;const x=new THREE.LineBasicMaterial({color:o});return new THREE.Line(a,x)}createDashedLines(r,o,a,x){const u=new THREE.Geometry;u.vertices=r;const M=new THREE.Line(u,new THREE.LineDashedMaterial({color:o,dashSize:a,gapSize:x}));return M.computeLineDistances(),M}}const MxThreeJS=MxThreeJSMixin(new MxThreeJS$1);class MxDrawObject extends Node{constructor(r){super(),this.rootLayer=new Layer(r.m_mxDatabase.curLayer),this.add(this.rootLayer),this._mxdrawObj=r}getMxObjectImplement(){return this._mxdrawObj}getScene(){return this._mxdrawObj.getScene()}setMultipleSelect(r){this._mxdrawObj.isMultipleSelect=r}getCamera(){return this._mxdrawObj.getCamera()}getRenderer(){return this._mxdrawObj.renderer}setMouseRightRotate(r=!0){return this._mxdrawObj.setMouseRightRotate(r)}getFullDisplayRange(){return this._mxdrawObj.getFullDisplayRange()}getCanvas(){return this._mxdrawObj.getCanvas()}updateDisplay(r=!1){return this._mxdrawObj.updateDisplay(r)}createCanvasImageData(r,o){return this._mxdrawObj.createCanvasImageData(r,o)}setViewColor(r){return this._mxdrawObj.setViewColor(r)}getViewColor(){return this._mxdrawObj.getViewColor()}setSize(r,o){return this._mxdrawObj.setSize(r,o)}getIntersectObjects(r){return this._mxdrawObj.getIntersectObjects(r)}addObject(r,o=!0){return this._mxdrawObj.addObject(r,o)}addViewObject(r){return this._mxdrawObj.addViewObject(r)}getViewWidth(){return this._mxdrawObj.getViewWidth()}getViewHeight(){return this._mxdrawObj.getViewHeight()}removeObject(r,o=!0){return this._mxdrawObj.removeObject(r,o)}zoomInitialStates(){return this._mxdrawObj.zoomInitialStates()}zoomScale(r){return this._mxdrawObj.zoomScale(r)}zoomW(r,o,a,x,u){return this._mxdrawObj.zoomW(r,o,a,x,u)}saveZoom(){return this._mxdrawObj.saveZoom()}recoverZoom(){return this._mxdrawObj.recoverZoom()}zoomCenter(r,o){return this._mxdrawObj.zoomCenter(r,o)}initZoomW(r,o){return this._mxdrawObj.initZoomW(r,o)}addEvent(r,o){return this._mxdrawObj.addEvent(r,o)}on(r,o){return super.on(r,o),this._mxdrawObj.addEvent(r,o)}off(r,o){return super.off(r,o),this.removeEventFuction(r,o)}removeEventFuction(r,o){return this._mxdrawObj.removeEventFuction(r,o)}setIniset(r){return this._mxdrawObj.setIniset(r)}getViewDocCoord(){return this._mxdrawObj.getViewDocCoord()}screenCoord2World(r,o,a){return this._mxdrawObj.screenCoord2World(r,o,a)}worldCoord2Screen(r,o,a){return this._mxdrawObj.worldCoord2Screen(r,o,a)}screenCoord2Doc(r,o){return this._mxdrawObj.screenCoord2Doc(r,o,0)}worldCoordLong2Doc(r){return this._mxdrawObj.worldCoordLong2Doc(r)}docCoordLong2World(r){return this._mxdrawObj.docCoordLong2World(r)}docCoord2World(r,o,a){return this._mxdrawObj.docCoord2World(r,o,a)}docCoord2World2(r){return this._mxdrawObj.docCoord2World(r.x,r.y,r.z)}worldCoord2Doc(r,o,a){return this._mxdrawObj.worldCoord2Doc(r,o,a)}worldCoord2Doc2(r){return this._mxdrawObj.worldCoord2Doc(r.x,r.y,r.z)}docCoord2Screen(r,o){return this._mxdrawObj.docCoord2Screen(r,o,0)}screenCoordLong2Doc(r){return this._mxdrawObj.screenCoordLong2Doc(r)}docCoordLong2Screen(r){return this._mxdrawObj.docCoordLong2Screen(r)}screenCoordLong2World(r){return this._mxdrawObj.screenCoordLong2World(r)}worldCoordLong2Screen(r){return this._mxdrawObj.worldCoordLong2Screen(r)}initRendererParam(r){return this._mxdrawObj.initRendererParam(r)}addMxEntity(r){return this.rootLayer.add(r),r.objectId()}getMxCurrentSelect(){let r=this._mxdrawObj.getMxAllSelect();return r.length==0&&(r=this._mxdrawObj.getPrvCommandSelect()),r}getMxCADCurrentSelect(){let r=this._mxdrawObj.getMxCADAllSelect();return r.length==0&&(r=this._mxdrawObj.getPrvCommandMxCADSelect()),r}getSelectPoints(){return this._mxdrawObj.getSelectPoints()}addMxCurrentSelect(r,o=!0,a=!0){return this._mxdrawObj.addMxCurrentSelect(r,o,a)}addMxCADCurrentSelect(r,o=!0,a=!0){return this._mxdrawObj.addMxCADCurrentSelect(r,o,a)}fireSelectChange(r){this._mxdrawObj.fireSelectChange(r)}clearMxCurrentSelect(){return this._mxdrawObj.clearMxCurrentSelect()}getMxEntity(r){return this._mxdrawObj.getMxEntityUserObject(r)}findMxEntityAtPoint(r,o,a){return this._mxdrawObj.findMxEntityAtPoint(r,o,a)}getAllMxEntity(){return this._mxdrawObj.getAllMxEntity()}setViewMovementMethod(r){return this._mxdrawObj.setMouseMiddlePan(r)}setMouseMiddlePan(r){return this._mxdrawObj.setMouseMiddlePan(r)}resetThreeJSControls(){return this._mxdrawObj.resetThreeJSControls()}enableZoom(r){return this._mxdrawObj.enableZoom(r)}enablePan(r){return this._mxdrawObj.enablePan(r)}eraseMxEntity(r){return this._mxdrawObj.eraseMxEntity(r)}removeViewObject(r){this._mxdrawObj.removeViewObject(r)}saveMxEntityToJson(r){return JSON.stringify(this._mxdrawObj.saveMxEntityToJson(r))}saveMxEntityToObject(r){return this._mxdrawObj.saveMxEntityToJson(r)}async loadMxEntityFromJson(r,o=null){if(o){let a=o.length;for(let x=0;x<a;x++)await MxThreeJS.loadSVG(o[x])}return this.getAllMxEntity().forEach(a=>{for(let x in a)Reflect.deleteProperty(a,x)}),typeof r=="string"?this._mxdrawObj.loadMxEntityFromJson(JSON.parse(r)):this._mxdrawObj.loadMxEntityFromJson(r)}eraseAllMxEntity(){return this._mxdrawObj.eraseAllMxEntity()}makeCurrent(){this._mxdrawObj.makeCurrent()}getViewCenterDocCoord(){return this._mxdrawObj.getViewCenterDocCoord()}updateCanvasSize(){this._mxdrawObj.updateCanvasSize()}newFile(r,o,a,x){return this._mxdrawObj.newFile(r,o,a,x)}stopAllLoading(){this._mxdrawObj.stopAllLoading()}getOrbitControls(){return this._mxdrawObj.getOrbitControls()}enableViewControls(r){return this._mxdrawObj.enableViewControls(r)}getMxDatabase(){return new MxDbDatabase(this._mxdrawObj.getMxDatabase())}getTempMarkDraw(){return new MxTempMarkDraw(this._mxdrawObj.getTempMarkDraw())}setZoomSpeed(r){return this._mxdrawObj.setZoomSpeed(r)}resetRenderer(){return this._mxdrawObj.resetRenderer()}setRequestHeader(r){return this._mxdrawObj.setRequestHeader(r)}closeWebSocket(){return this._mxdrawObj.closeWebSocket()}cadCoord2Doc(r,o,a){return this._mxdrawObj.cadCoord2Doc(r,o,a)}cadCoord2Doc2(r){return this._mxdrawObj.cadCoord2Doc2(r)}toSmallcoord(r){return this._mxdrawObj.toSmallcoord(r)}toSmallcoord2(r,o,a=0){return this._mxdrawObj.toSmallcoord2(r,o,a)}docCoord2Cad(r,o,a){return this._mxdrawObj.docCoord2Cad(r,o,a)}docCoord2Cad2(r){return this._mxdrawObj.docCoord2Cad2(r)}viewCoord2Cad(r,o,a){return this._mxdrawObj.viewCoord2Cad(r,o,a)}cadCoord2View(r,o,a){return this._mxdrawObj.cadCoord2View(r,o,a)}cadCoordLong2View(r){return this._mxdrawObj.cadCoordLong2View(r)}viewCoordLong2Cad(r){return this._mxdrawObj.viewCoordLong2Cad(r)}docCoordLong2Cad(r){return this._mxdrawObj.docCoordLong2Cad(r)}cadCoordLong2Doc(r){return this._mxdrawObj.cadCoordLong2Doc(r)}setViewAngle(r){return this._mxdrawObj.setViewAngle(r)}getViewAngle(){return this._mxdrawObj.getViewAngle()}getSysVar(r){return this._mxdrawObj.sysVariable().getSysVar()}setSysVar(r,o){return this._mxdrawObj.sysVariable().setSysVar(r,o)}isMxCAD(){return this._mxdrawObj.isCppMxCAD()}getAllLayoutName(){return this._mxdrawObj.getAllLayoutName()}getDtabaseJsonString(){return this._mxdrawObj.getDtabaseJsonString()}gotoLayout(r){return this._mxdrawObj.gotoLayout(r)}initMxCpp(r){return this._mxdrawObj.initMxCpp(r)}isWebgl2(){return this._mxdrawObj.isWebgl2()}getId(){return this._mxdrawObj.getId()}addControlsEvent(r,o,a=!1){return this._mxdrawObj.addControlsEvent(r,o,a)}clearAllObject(){return this.rootLayer.clear(),this._mxdrawObj.clearAllObject()}setPointMultipleSelect(r=!0){return this._mxdrawObj.setPointMultipleSelect(r)}isWhiteViewColor(){return this._mxdrawObj.isWhiteViewColor()}automaticInversionColor(r){return this._mxdrawObj.automaticInversionColor(r)}renderLoop(r=!0){return this._mxdrawObj.renderLoop(r)}}const initEvents=T=>{let r=[];["click","mousedown","mouseup"].forEach(o=>{T.addEventListener(o,()=>{r.forEach(a=>{a.emit(o)})})}),T.addEventListener("mousemove",()=>{const o=MxFun.getCurrentDraw().findMxEntityAtPoint(MxFun.getCurrentMousePostion(),!1);o.forEach(a=>{a.emit("mousemove")}),o.length===0&&(r.length>0&&r.forEach(a=>{a.emit("mouseout")}),r=[]),r.length===0&&(r=o).forEach(a=>{a.emit("mouseover"),a.emit("hover")})})};function createMxObject({canvasId:T=createReandomId(),cadFile:r="",callback:o,isNewFile:a=!1,useWebsocket:x=!1,isAutoResize:u=!0,mapBox:M,isMxCAD:I=!1,userIdentitySign:H="emptyUserIdentity",isCPPMxCAD:G=!1}){if(this.initUiDataObject(mxUiData$1),!x&&a&&(a=!1),M)if(G){const L=M.canvas;let y=!0;store.state.MxFun.createMxObject(L,"",D=>{let C=new MxDrawObject(D);D.setMouseRightRotate(!1),D.setIniset({EnableOsnapFunction:!0}),o&&o(C,{canvas:L,canvasParent:void 0})},y,!1,!1,M,G)}else{const L=M.canvas;store.state.MxFun.createMxObject(L,r,y=>{let D=new MxDrawObject(y);y.setIniset({EnableOsnapFunction:!0}),o&&o(D,{canvas:L,canvasParent:void 0})},void 0,a,x,M)}else if(G){const L=createCanvas(T),y=createCanvasParent(L);y.parentNode&&y.parentNode.nodeType!=11||document.body.appendChild(y);let D=!0;store.state.MxFun.createMxObject(T,"",C=>{let B=new MxDrawObject(C);C.setMouseRightRotate(!1),C.setIniset({EnableOsnapFunction:!0}),C.addEvent("onResize",()=>(y.tabindex=3,{width:y.clientWidth,height:y.clientHeight})),u&&useCanvasResizeListener(B,L),o&&o(B,{canvas:L,canvasParent:y})},D,!1,!1,void 0,G)}else{const L=createCanvas(T),y=createCanvasParent(L);let D;y.parentNode&&y.parentNode.nodeType!=11||document.body.appendChild(y),I&&(D=!0,x=!0),store.state.MxFun.createMxObject(T,r,C=>{let B=new MxDrawObject(C);I&&(H.length==0&&(H="invalidUserIdentity"),C.initRunMode(2),C.initUserLoginData(H,"")),C.setMouseRightRotate(!1),C.setIniset({EnableOsnapFunction:!0}),C.addEvent("onResize",()=>(y.tabindex=3,{width:y.clientWidth,height:y.clientHeight})),u&&useCanvasResizeListener(B,L),initEvents(L),o&&o(B,{canvas:L,canvasParent:y})},D,a,x,void 0)}}let mxUiData=mxUiData$1,mxFunSyncInitialization;class MxFunClass{constructor(){this.createMxObject=createMxObject,this.getMxFunTHREE=()=>store.state.MxFun.getTHREE()}setMxServer(r="ws://localhost:5090"){store.state.MxFun.setMxServer(r)}setloadImageFuction(r){store.state.MxFun.setloadImageFuction(r)}onInitSync(r){mxFunSyncInitialization=r}callSyncInitialization(){return mxFunSyncInitialization!=null?mxFunSyncInitialization():new Promise(r=>{r(!0)})}screenCoord2Doc(r,o){return store.state.MxFun.screenCoord2Doc(r,o,0)}docCoord2Screen(r,o){return store.state.MxFun.docCoord2Screen(r,o,0)}getCurrentDraw(){const r=store.state.MxFun.getCurrentDraw();return r.tmp||(r.tmp=new MxDrawObject(r)),r.tmp}addToCurrentSpace(r){return MxFun.getCurrentDraw().addMxEntity(r)}initUiDataObject(r){return mxUiData=r,store.state.MxFun.initUiDataObject(r)}getUIData(){return mxUiData}getCurrentDatabase(){return MxFun.getCurrentDraw().getMxDatabase()}testMX(r){return 11}loadImageMaterial(r,o){return o?(store.state.MxFun.loadImageMaterial(r,o),new Promise((a,x)=>{a(null)})):new Promise((a,x)=>{store.state.MxFun.loadImageMaterial(r,u=>{a(u||null)})})}selectEnt(r,o=null){return new Promise((a,x)=>{const u=new MrxDbgUiPrPoint;u.setMessage(r),u.go(M=>{if(M!=0)return void a(0);const I=u.value();let H=MxFun.getCurrentDraw().findMxEntityAtPoint(I),G=0;for(;H.length!=0;){let L=H.length;for(let y=0;y<L;y++){let D=H[y];if(!o||!o.type||o.type==D.getTypeName()){G=D.objectId();break}}break}a(G)})})}listenForCommandLineInput(r){mxUiData.getCmdLine().mountUpDisplayFun(r)}setCommandLineInputData(r,o){mxUiData.getCmdLine().setCmdText(r),mxUiData.onKeydown(o)}listenForCoordTip(r){mxUiData.mountSetCoordFun(r)}listenForUpdateCursor(r){mxUiData.mountUpdateCursorFun(r)}getMxFunThreeTool(){return store.state.MxFun.getMxThreeJS()}ceneratecursor(r=128,o=10,a=!0,x){return store.state.MxFun.ceneratecursor(r,o,a,x)}getCurrentMousePostion(){let r=store.state.MxFun.getCurrentMousePostion();return new THREE.Vector3(r.x,r.y,0)}onUseCreateMxDbEntity(r){store.events.on("use:create:MxDbEntity",r)}}const _MxFun=new MxFunClass,MxFun=new Proxy({},{get:(T,r)=>typeof _MxFun[r]=="function"?_MxFun[r].bind(_MxFun):store.state.MxFun[r]});var MxCloneType,MxCommandFlag,MxDefaultRenderOrder,InputToucheType;(function(T){T[T.kClone=1]="kClone",T[T.kDragClone=2]="kDragClone",T[T.kMxFileClone=3]="kMxFileClone",T[T.kSaveDwgClone=4]="kSaveDwgClone"})(MxCloneType||(MxCloneType={})),function(T){T[T.MCRX_CMD_MODAL=0]="MCRX_CMD_MODAL",T[T.MCRX_CMD_TRANSPARENT=1]="MCRX_CMD_TRANSPARENT",T[T.MCRX_CMD_NO_UNDO_MARKER=2]="MCRX_CMD_NO_UNDO_MARKER",T[T.MCRX_CMD_NOPRV=4]="MCRX_CMD_NOPRV"}(MxCommandFlag||(MxCommandFlag={})),function(T){T[T.kCADMeshRenderOrder=10]="kCADMeshRenderOrder",T[T.kCADCurveRenderOrder=20]="kCADCurveRenderOrder",T[T.kMxEntityRenderOrder=30]="kMxEntityRenderOrder",T[T.kGripRenderOrder=110]="kGripRenderOrder",T[T.kDynJigRenderOrder=120]="kDynJigRenderOrder"}(MxDefaultRenderOrder||(MxDefaultRenderOrder={})),function(T){T[T.kGetBegan=1]="kGetBegan",T[T.kGetEnd=2]="kGetEnd"}(InputToucheType||(InputToucheType={}));var MxType=Object.freeze({__proto__:null,get MxCloneType(){return MxCloneType},get MxCommandFlag(){return MxCommandFlag},get MxDefaultRenderOrder(){return MxDefaultRenderOrder},get InputToucheType(){return InputToucheType}});class MxassemblyClass{constructor(){this.mxassembly=null}initImp(){this.mxassembly||store.state.Mxassembly&&(this.mxassembly=store.state.Mxassembly)}NewMcGePoint3d(r,o,a){this.initImp();let x=new this.mxassembly.McGePoint3d;return r&&(x.x=r),o&&(x.y=o),a&&(x.z=a),x}NewMcGePoint3dArray(r){this.initImp();let o=new this.mxassembly.McGePoint3dArray;return r&&r.forEach(a=>{let x=this.NewMcGePoint3d();x.x=a.x,x.y=a.y,x.z=a.z,o.append(x)}),o}}const Mxassembly=new MxassemblyClass;class McGeToolClass{constructor(){this.mxgeTool=null}initImp(){this.mxgeTool||store.state.Mxassembly&&(this.mxgeTool=new store.state.Mxassembly.McGeTool)}calcArea(r){if(this.initImp(),!store.state.Mxassembly)return 0;if(r instanceof Array){let o=Mxassembly.NewMcGePoint3dArray(r);return this.mxgeTool.calcArea(o)}return this.mxgeTool.calcArea(r)}pointInPolyline(r,o){this.initImp();let a=o;o instanceof Array&&(a=Mxassembly.NewMcGePoint3dArray(o));let x=Mxassembly.NewMcGePoint3d(r.x,r.y,r.z);return this.mxgeTool.pointInPolyline(x,a)}}const McGeTool=new McGeToolClass;class MrxDbgUtilsClass{constructor(){this.imp=null}initImp(){if(!this.imp&&store.state.MxFun){let r=store.state.MxFun;this.imp=new r.getMrxDbgUtilsClass}}findEntAtPoint(r,o=null,a,x=!0,u){return this.initImp(),a||(a=MxFun.getCurrentDraw()),this.imp.findEntAtPoint(a.getMxObjectImplement(),r,o,x,u)}selectEnt(r,o){return this.initImp(),this.imp.selectEnt(r)}getCorner(r,o,a=!1,x,u=!1){return this.initImp(),this.imp.getCorner(r,o,a,x,u)}}const MrxDbgUtils=new MrxDbgUtilsClass,MxPaintBrushProps={},MxPaintBrush={getProps:()=>MxPaintBrushProps,setProps:T=>Object.assign(MxPaintBrushProps,T),use:T=>Object.assign(T,MxPaintBrushProps)};var DataType;(function(T){T[T.Default=0]="Default",T[T.Color=1]="Color",T[T.Vector2=2]="Vector2",T[T.Vector3=3]="Vector3",T[T.Vector4=4]="Vector4",T[T.Matrix3=5]="Matrix3",T[T.Matrix4=6]="Matrix4"})(DataType||(DataType={}));const MXDBDATATYPE="datatype";function getDwgKeyVal(T,r){let o,a="";return lodash.isObject(r)?(o=r.default,a=r.key):typeof r=="string"&&(a=r),[a,T[a]===void 0?o:T[a]]}class MxDbEntity extends RenderOrderNode{constructor(){super(),this.color=16777215,this.opacity=1,this.visible=!0,this.userData={},this.sGuid="",this.dLineWidth=0,this.lineWidthByPixels=!0,this.dDashArray=0,this.dDashRatio=0,this.layer="",this.use_smallcoord_display=!1,this.addEvent=this.on,this.removeEvent=this.off,this.callEvent=this.emit;const r=this.constructor;r.isPaintBrushDraw&&(MxPaintBrush.use(this),store.events.emit("use:create:MxDbEntity",this),r.isPaintBrushDraw=!1)}static register(){const r=this;r.isRegister||(r.cmd&&r.draw&&MxFun.addCommand(r.cmd,o=>r.use.call(r,void 0,o)),new r().rxInit(),r.isRegister=!0)}static async use(r,o){return new Promise((a,x)=>{const u=this;if(!u.isRegister&&u.register(),u.isPaintBrushDraw=!0,!u.cmd&&u.draw)return x();const M=I=>{a(I),r&&r(I),store.events.off("use:create:MxDbEntity",M)};store.events.on("use:create:MxDbEntity",M),u.draw(o)})}initGuid(r){this.sGuid.length>0?console.log("mx: init guid error"):this.sGuid=r}toSmallcoord2(r,o,a,x=0){return this.use_smallcoord_display?r.toSmallcoord2(o,a,x):new THREE.Vector3(o,a,x)}toSmallcoord(r,o){return this.use_smallcoord_display?r.toSmallcoord(o):o}isUseSmallcoordDisplay(){return this.use_smallcoord_display}setUseSmallcoordDisplay(r){this.use_smallcoord_display=r}dwgInHelp(r,o,a){let x=this;const u=r.type===MxType.MxCloneType.kMxFileClone||r.type===MxType.MxCloneType.kSaveDwgClone,M=H=>{if(!H)return;const{value:G,[MXDBDATATYPE]:L}=H;switch(L){case DataType.Color:return new THREE.Color(...G);case DataType.Vector2:return new THREE.Vector2(...G);case DataType.Vector3:return new THREE.Vector3(...G);case DataType.Vector4:return new THREE.Vector4(...G);case DataType.Matrix3:return new THREE.Matrix3().fromArray(G);case DataType.Matrix4:return new THREE.Matrix4().fromArray(G)}return a&&a.getCacheVal?a.getCacheVal(H):void 0};function I(H){return H instanceof THREE.Color||H instanceof THREE.Vector2||H instanceof THREE.Vector3||H instanceof THREE.Vector4||H instanceof THREE.Matrix3||H instanceof THREE.Matrix4?H.clone():a&&a.getVal?a.getVal(H):void 0}return o.forEach(H=>{const[G,L]=getDwgKeyVal(r,H);x[G]=lodash.cloneDeepWith(L,u?M:I)}),!0}dwgOutHelp(r,o){const a=M=>M instanceof THREE.Color?{[MXDBDATATYPE]:DataType.Color,value:M.toArray()}:M instanceof THREE.Vector2?{[MXDBDATATYPE]:DataType.Vector2,value:M.toArray()}:M instanceof THREE.Vector3?{[MXDBDATATYPE]:DataType.Vector3,value:M.toArray()}:M instanceof THREE.Vector4?{[MXDBDATATYPE]:DataType.Vector4,value:M.toArray()}:M instanceof THREE.Matrix3?{[MXDBDATATYPE]:DataType.Matrix3,value:M.toArray()}:M instanceof THREE.Matrix4?{[MXDBDATATYPE]:DataType.Matrix4,value:M.toArray()}:void 0;let x=this;const u=r.type===MxType.MxCloneType.kMxFileClone||r.type===MxType.MxCloneType.kSaveDwgClone;return o.forEach(M=>{const[I,H]=getDwgKeyVal(x,M);r[I]=u?lodash.cloneDeepWith(H,a):H}),r}create(r){return new this.constructor(r)}transformBy(r){}transformScale(r,o){let a=new THREE.Matrix4().makeTranslation(r.x,r.y,r.z).multiply(new THREE.Matrix4().makeScale(o,o,o)).multiply(new THREE.Matrix4().makeTranslation(-r.x,-r.y,-r.z));this.transformBy(a)}transformRotate(r,o){let a=new THREE.Matrix4().makeTranslation(r.x,r.y,r.z).multiply(new THREE.Matrix4().makeRotationZ(o)).multiply(new THREE.Matrix4().makeTranslation(-r.x,-r.y,-r.z));this.transformBy(a)}transformMove(r){let o=new THREE.Matrix4().makeTranslation(r.x,r.y,r.z);this.transformBy(o)}getGeomExtents(){return null}getClosestPointTo(r,o=0){return null}getImp(){return this.MxDbEntityImp}setNeedUpdateDisplay(r){let o=this.getImp();return!!o&&(r?o.upDisplay():o.setDirtyDisplay(!0),!0)}getMxObject(){let r=this.getImp();return r?r.getMxObject():null}onViewChange(){return!1}objectId(){let r=this.getImp();return r?r.objectId():0}erase(){let r=this.getImp();return!!r&&r.erase()}setLayer(r){let o=this.getImp();o&&o.nodifySetLayer(),this.layer=r}getLayer(){return this.layer}setColor(r){return this.color=r,this}getColor(){return this.color||16777215}clone(r){let o=this.create(),a={type:r||MxType.MxCloneType.kClone};return this.dwgOut(a),o.dwgIn(a),o.sGuid="",o}onDwgIn(r){this.color=r.color,this.renderOrder=r.renderOrder,this.opacity=r.opacity,this.visible=r.visible,r.userData?this.userData=JSON.parse(JSON.stringify(r.userData)):this.userData={},this.dLineWidth=r.lineWidth,this.lineWidthByPixels=r.lineWidthByPixels,this.dDashArray=r.dashArray,this.dDashRatio=r.dashRatio,this.layer=r.layer,r.guid&&(this.sGuid=r.guid)}onDwgOut(r){r.color=this.color,r.renderOrder=this.renderOrder,r.opacity=this.opacity,r.visible=this.visible,r.lineWidth=this.dLineWidth,r.lineWidthByPixels=this.lineWidthByPixels,r.dashArray=this.dDashArray,r.dashRatio=this.dDashRatio,r.layer=this.layer,r.guid=this.sGuid,Object.keys(this.userData).length>0&&(r.userData=this.userData)}rxInit(){MxFun.initMxDbEntityType(this)}setRenderOrder(r){this.renderOrder=r}getRenderOrder(){return this.renderOrder}setLineWidthByPixels(r){return this.lineWidthByPixels=r,this}getLineWidthByPixels(){return this.lineWidthByPixels}setLineWidth(r){return this.dLineWidth=r,this}getLineWidth(){return this.dLineWidth}getGetLength(){return 0}setDashLen(r){let o=this.getGetLength();if(o<1e-6||r<1e-6)return this;let a=Math.floor(o/r);return a<1e-6&&(this.dDashRatio=0),this.dDashArray=1/a,this}setDashRatio(r){return this.dDashRatio=r,this}setDashArray(r){return this.dDashArray=r,this}setDash(r,o){return this.dDashArray=r,this.dDashRatio=o,this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0),this}getDash(){return{dDashArray:this.dDashArray,dDashRatio:this.dDashRatio}}setDashLineDisplay(r){return r?(this.dDashArray<1e-5&&(this.dDashArray=.03),this.dDashRatio<1e-5&&(this.dDashRatio=.1),this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0)):(this.dDashArray=0,this.dDashRatio=0),this}isDashLineDisplay(){return this.dDashArray>0&&this.dDashRatio>0}guid(){return this.sGuid}setGuid(r){return this.sGuid=r}onEndGripEidt(){this.callEvent("onEndGripEidt")}onStartGripEidt(){return this.callEvent("onStartGripEidt")}toJsonString(r=MxType.MxCloneType.kMxFileClone){let o={type:r};return this.dwgOut(o),o.TypeName=this.getTypeName(),JSON.stringify(o)}fromJsonString(r){let o=JSON.parse(r);return(o.type==MxType.MxCloneType.kMxFileClone||o.type==MxType.MxCloneType.kClone)&&this.dwgIn(o)}}function drawMxDbImage(){const T=new MrxDbgUiPrPoint;T.setMessage(`
指定插入点:`);let r=MxFun.getCurrentDraw();T.go(o=>{if(o!=0)return;let a=MxFun.screenCoordLong2Doc(300),x=MxFun.screenCoordLong2Doc(200);const u=T.value();let M=MxFun.screenCoord2Doc(10,10);u.z=M.z;let I=new MxDbImage;I.setRenderOrder(MxType.MxDefaultRenderOrder.kCADMeshRenderOrder-1),I.setPoint1(u);let H=new THREE.Vector3(u.x+a,u.y+x,u.z);I.setPoint2(H);let G=prompt("请填写图片网络地址","https://cdn.pixabay.com/photo/2022/11/15/12/23/winter-7593872_960_720.jpg");G&&(I.setImagePath(G),r.addMxEntity(I),I.addEvent("onStartGripEidt",()=>(I.visible=!1,I.setNeedUpdateDisplay(),{renderOrder:MxType.MxDefaultRenderOrder.kCADMeshRenderOrder-1})),I.addEvent("onEndGripEidt",()=>{I.visible=!0,I.setNeedUpdateDisplay()}))})}MxDbEntity.isRegister=!1;class MxDbImage extends MxDbEntity{constructor(){super(...arguments),this.pt1=new THREE.Vector3,this.pt2=new THREE.Vector3,this.imagePath="",this.isLoadMaterialFromPath=!0,this.material=null,this.angle=0}getTypeName(){return"MxDbImage"}getAngle(){return this.angle}setAngle(r){this.angle=r}worldDraw(r){let o=new THREE.Vector3(this.pt1.x,this.pt2.y),a=new THREE.Vector3(this.pt2.x,this.pt1.y);if(Math.abs(this.angle)>1e-5){let x=new THREE.Vector3(.5*(this.pt1.x-this.pt2.x)+this.pt2.x,.5*(this.pt1.y-this.pt2.y)+this.pt2.y),u=new THREE.Matrix4;u.makeRotationZ(this.angle);let M=new THREE.Matrix4().makeTranslation(x.x,x.y,x.z).multiply(u).multiply(new THREE.Matrix4().makeTranslation(-x.x,-x.y,-x.z));r.setMatrix(M)}if(r.getType()==1){if(r.drawSelectLine(this.pt1,o),r.drawSelectLine(o,this.pt2),r.drawSelectLine(this.pt2,a),r.drawSelectLine(a,this.pt1),this.material){let x=Math.abs(this.pt1.x-this.pt2.x),u=Math.abs(this.pt1.y-this.pt2.y),M=new THREE.PlaneGeometry(x,u),I=Math.min(this.pt1.x,this.pt2.x),H=Math.min(this.pt1.y,this.pt2.y);for(let L=0;L<M.vertices.length;L++)M.vertices[L].x+=I+.5*x,M.vertices[L].y+=H+.5*u,M.vertices[L].z=0;let G=new THREE.Mesh(M,this.material);G.material.depthTest=!1,r.drawEntity(G)}else if(this.imagePath.length>0&&this.isLoadMaterialFromPath){let x=this,u=r.getMxObject();const M=I=>{this.isLoadMaterialFromPath=!1,I&&(x.setMaterial(I),x.setNeedUpdateDisplay(),u.updateDisplay())};MxFun.loadImageMaterial(this.imagePath,I=>{M(I)})}}else if(this.material){let x=Math.abs(this.pt1.x-this.pt2.x),u=Math.abs(this.pt1.y-this.pt2.y),M=new THREE.PlaneGeometry(x,u),I=Math.min(this.pt1.x,this.pt2.x),H=Math.min(this.pt1.y,this.pt2.y);for(let L=0;L<M.vertices.length;L++)M.vertices[L].x+=I+.5*x,M.vertices[L].y+=H+.5*u,M.vertices[L].z=0;let G=new THREE.Mesh(M,this.material);G.material.depthTest=!1,r.drawEntity(G)}else r.drawLine(this.pt1,o),r.drawLine(o,this.pt2),r.drawLine(this.pt2,a),r.drawLine(a,this.pt1);r.setMatrix(null)}setImagePath(r){this.imagePath=r,this.isLoadMaterialFromPath=!0,this.material=null}getImagePath(){return this.imagePath}setMaterial(r){this.material=r}loadMaterial(r){r&&(this.imagePath=r),this.isLoadMaterialFromPath=!1,this.material=null;let o=this;MxFun.loadImageMaterial(this.imagePath,a=>{this.isLoadMaterialFromPath=!1,o.setMaterial(a)})}setPoint1(r){this.pt1=r}getPoint1(){return this.pt1}setPoint2(r){this.pt2=r}getPoint2(){return this.pt2}getGripPoints(){let r=[];r.push(this.pt1),r.push(this.pt2);let o=new THREE.Vector3(this.pt1.x+.5*(this.pt2.x-this.pt1.x),this.pt1.y+.5*(this.pt2.y-this.pt1.y));return r.push(o),r}moveGripPointsAt(r,o){return r==0?this.pt1.add(o):r==1?this.pt2.add(o):r==2&&(this.pt1.add(o),this.pt2.add(o)),!0}dwgIn(r){return this.onDwgIn(r),this.pt1.copy(r.pt1),this.pt2.copy(r.pt2),this.imagePath=r.imagePath.substr(0),this.isLoadMaterialFromPath=!0,r.angle&&(this.angle=r.angle),r.material&&(this.material=r.material),!0}dwgOut(r){return this.onDwgOut(r),r.pt1=this.pt1,r.pt2=this.pt2,r.imagePath=this.imagePath,r.angle=this.angle,r.type==MxType.MxCloneType.kDragClone&&(r.material=this.material),r}create(){return new MxDbImage}}var McGiWorldDrawType;MxDbImage.cmd="Mx_DrawImage",MxDbImage.draw=drawMxDbImage,addRegisterMxDbEntity(MxDbImage),function(T){T[T.kWorldDraw=1]="kWorldDraw",T[T.kDynDragDraw=2]="kDynDragDraw",T[T.kSelectDraw=3]="kSelectDraw"}(McGiWorldDrawType||(McGiWorldDrawType={}));var McGiWorldDrawType$1=McGiWorldDrawType;class MxDbSVGText{constructor(){this.txtPos=new THREE.Vector3,this.txt="",this.txtHeight=1,this.color=void 0,this._txtObject=null,this._txtAspectRatio=-1,this.move=!1,this.drawConnectingLine=!1,this._connectingLine=null,this.fontStyle="",this.underline=!1,this._underLine=null}}async function drawMxDbSVG(){const T=new MrxDbgUiPrPoint;T.setMessage(`
指定一点:`);let r=await T.go();if(!r)return;let o=new MxDbSVG,a=prompt("请输入svg图片网络或本地地址","https://img.alicdn.com/imgextra/i2/O1CN01FF1t1g1Q3PDWpSm4b_!!6000000001920-55-tps-508-135.svg");if(!a)return;o.setSvgPath(a),o.setSvgPostion(r),o.svgReverse=!0,o.svgMargin.x=.2,o.setSvgAlignmentRatio(new THREE.Vector2(.5,-1)),o.setRenderOrder(100),o.setSvgSize(new THREE.Vector2(50,0));let x=new MxDbSVGText;x.txt="A1",x.txtPos=new THREE.Vector3(0,-30,0),x.txtHeight=30,o.addText(x),o.fixedSize=!0,o.color=65297,MxFun.addToCurrentSpace(o)}class MxDbSVG extends MxDbEntity{constructor(){super(...arguments),this.svgPos=new THREE.Vector3,this.svg=null,this.svgPath="",this.svgSize=new THREE.Vector2(50,50),this.svgAlignmentRatio=new THREE.Vector2(0,0),this.imagePath="",this.isLoadMaterialFromPath=!0,this.material=null,this.svgRotate=0,this.svgReverse=!1,this.svgMirror=!1,this.svgChildColor=[],this.svgMargin=new THREE.Vector2(0,0),this.isSvgDirtyLocation=!1,this.isLoadFromPath=!0,this.aryText=[],this.svgBoxSize=null,this.fixedSize=!1,this.useSvgColor=!1}setSvgChildColor(r){if(this.svgChildColor=r,!this.useSvgColor&&this.svg){let o=new THREE.Color(this.getColor()),a=0,x=this;this.svg.traverse(function(u){u.material&&(a<x.svgChildColor.length?u.material.color=new THREE.Color(x.svgChildColor[a]):u.material.color=o,a++)}),this.setNeedUpdateDisplay(!0)}}getSvgChildColor(){return this.svgChildColor}calcVewSize(r){let o=this.svgSize.x,a=this.svgSize.y;return a<=0&&(a=this.svgBoxSize?this.svgBoxSize.y/this.svgBoxSize.x*o:o),this.fixedSize&&(o=r.screenCoordLong2Doc(o),a=r.screenCoordLong2Doc(a)),[o,a]}calcSvgDrawRect(r){if(!r)return;this.calcSvgPosition(r);let[o,a]=this.calcVewSize(r),x=new THREE.Matrix4;x.makeScale(this.svgMirror?-1:1,this.svgReverse?-1:1,1);let u=new THREE.Matrix4;u.makeRotationZ(this.svgRotate);let M=new THREE.Matrix4,I=new THREE.Vector3(this.svgPos.x-o*this.svgAlignmentRatio.x,this.svgPos.y-a*this.svgAlignmentRatio.y,0);M.makeTranslation(I.x,I.y,I.z),u.multiply(x),u.premultiply(M);let H=new THREE.Vector3(0,0,0),G=new THREE.Vector3(o,0,0),L=new THREE.Vector3(o,a,0),y=new THREE.Vector3(0,a,0);return H.applyMatrix4(u),G.applyMatrix4(u),L.applyMatrix4(u),y.applyMatrix4(u),{pt1:H,pt2:L,pt3:G,pt4:y,cenpt:L.clone().add(H.clone().sub(L).multiplyScalar(.5)),sizew:o,sizeh:a}}calcImageDrawRect(r){if(!r)return;this.calcSvgPosition(r);let[o,a]=this.calcVewSize(r),x=new THREE.Matrix4;x.makeScale(this.svgMirror?-1:1,this.svgReverse?-1:1,1);let u=new THREE.Matrix4,M=new THREE.Matrix4,I=new THREE.Vector3(this.svgPos.x-o*this.svgAlignmentRatio.x,this.svgPos.y-a*this.svgAlignmentRatio.y,0);M.makeTranslation(I.x,I.y,I.z),u.multiply(x),u.premultiply(M);let H=new THREE.Vector3(0,0,0),G=new THREE.Vector3(o,0,0),L=new THREE.Vector3(o,a,0),y=new THREE.Vector3(0,a,0);return H.applyMatrix4(u),G.applyMatrix4(u),L.applyMatrix4(u),y.applyMatrix4(u),{pt1:H,pt2:L,pt3:G,pt4:y,cenpt:L.clone().add(H.clone().sub(L).multiplyScalar(.5)),sizew:o,sizeh:a}}worldDraw(r){let o,a=r.getMxObject();if(this.imagePath.length>0){if(o=this.calcImageDrawRect(a),Math.abs(this.svgRotate)>1e-5){let y=new THREE.Vector3(.5*(o.pt1.x-o.pt2.x)+o.pt2.x,.5*(o.pt1.y-o.pt2.y)+o.pt2.y),D=new THREE.Matrix4;D.makeRotationZ(this.svgRotate);let C=new THREE.Matrix4().makeTranslation(y.x,y.y,y.z).multiply(D).multiply(new THREE.Matrix4().makeTranslation(-y.x,-y.y,-y.z));r.setMatrix(C)}}else o=this.calcSvgDrawRect(a);let x=o.pt1,u=o.pt2,M=o.pt3,I=o.pt4,H=o.cenpt,G=o.sizew,L=this;if(r.getType()!=McGiWorldDrawType$1.kSelectDraw&&this.aryText.forEach((y,D)=>{if(y.txt.length>0){let z,A=new THREE.Vector3(y.txtPos.x,y.txtPos.y,0);this.fixedSize&&(y.txtPos.x>0?A.x=this.svgPos.x+a.screenCoordLong2Doc(y.txtPos.x):A.x=this.svgPos.x-a.screenCoordLong2Doc(y.txtPos.x),y.txtPos.y>0?A.y=this.svgPos.y+a.screenCoordLong2Doc(y.txtPos.y):A.y=this.svgPos.y-a.screenCoordLong2Doc(y.txtPos.y)),y.color&&(z=r.getColor(),r.setColor(y.color));let S=y.txtHeight;L.fixedSize&&(S=a.screenCoordLong2Doc(y.txtHeight)),r.setXData({type:"text",txt:y.txt,index:D});let q=r.drawText(y.txt,S,0,A,void 0,W=>y.fontStyle.length>0?`${y.fontStyle} ${W}px Arial`:`normal ${W}px Arial`);if(r.getType()==McGiWorldDrawType$1.kWorldDraw&&(y._txtObject=q),y.underline&&y._txtObject){const W=new THREE.Box3;W.expandByObject(y._txtObject);let _=new THREE.Vector3(W.min.x,W.min.y+.1*S,0),R=new THREE.Vector3(W.max.x,W.min.y+.1*S,0);var C=new THREE.Geometry;let v=new THREE.LineBasicMaterial({color:r.getColor(),transparent:!0,depthTest:!1});C.vertices.push(_,R);var B=new THREE.Line(C,v);r.drawEntity(B),r.getType()==McGiWorldDrawType$1.kWorldDraw&&(y._underLine=B)}if(y._txtAspectRatio=-1,z&&r.setColor(z),y.drawConnectingLine){let W=H.clone().sub(A);if(W.length()>S+G){W.normalize();let _=H.clone().sub(W.clone().multiplyScalar(G)),R=A.clone().add(W.clone().multiplyScalar(S));C=new THREE.Geometry;let v=new THREE.LineBasicMaterial({color:r.getColor(),transparent:!0,depthTest:!1});C.vertices.push(_,R),B=new THREE.Line(C,v),r.setXData({type:"line"}),r.drawEntity(B),r.getType()==McGiWorldDrawType$1.kWorldDraw&&(y._connectingLine=B)}}}}),r.getType()==1){if(this.svg)r.setXData({type:"svg"}),r.drawEntity(this.svg);else if(this.svgPath.length>0&&this.isLoadFromPath){let y=this,D=r.getMxObject();MxThreeJS.loadSVG(this.svgPath,void 0,C=>{if(C){let B=C;if(B.boxSize)y.svgBoxSize=B.boxSize.clone();else{let W=new THREE.Box3().setFromObject(C);y.svgBoxSize||(y.svgBoxSize=new THREE.Vector3),y.svgBoxSize.x=W.max.x-W.min.x,y.svgBoxSize.y=W.max.y-W.min.y}let[z,A]=y.calcVewSize(a);y.svgBoxSize&&(C.scale.x=z/y.svgBoxSize.x,C.scale.y=A/y.svgBoxSize.y),C.scale.z=C.scale.x,y.svgReverse&&(C.scale.y*=-1),y.svgMirror&&(C.scale.x*=-1),C.rotateZ(y.svgRotate),y.isSvgDirtyLocation=!0;let S=new THREE.Color(r.getColor()),q=0;C.traverse(function(W){W.material&&(W.material=W.material.clone(),W.material.transparent=!0,W.material.depthTest=!1,y.useSvgColor||(q<y.svgChildColor.length?W.material.color=new THREE.Color(y.svgChildColor[q]):W.material.color=S),q++)}),y.svg=C,y.setNeedUpdateDisplay(),D.updateDisplay()}else console.log("mx LoadSVG:"+y.svgPath+" failed");y.isLoadFromPath=!1})}else if(this.material){let y=Math.abs(x.x-u.x),D=Math.abs(x.y-u.y),C=new THREE.PlaneGeometry(y,D),B=Math.min(x.x,u.x),z=Math.min(x.y,u.y);for(let S=0;S<C.vertices.length;S++)C.vertices[S].x+=B+.5*y,C.vertices[S].y+=z+.5*D,C.vertices[S].z=0;let A=new THREE.Mesh(C,this.material);A.material.depthTest=!1,r.drawEntity(A)}else if(this.isLoadMaterialFromPath&&this.imagePath.length>0){let y=this,D=r.getMxObject();MxFun.loadImageMaterial(this.imagePath,C=>{this.isLoadMaterialFromPath=!1,C&&(y.material=C,y.setNeedUpdateDisplay(),D.updateDisplay())})}this.fixedSize||(r.drawSelectLine(x,u),r.drawSelectLine(M,I),r.drawSelectLine(x,M),r.drawSelectLine(M,u),r.drawSelectLine(u,I),r.drawSelectLine(I,x))}else r.drawLine(x,M),r.drawLine(M,u),r.drawLine(u,I),r.drawLine(I,x);this.imagePath.length>0&&r.setMatrix(null)}async setSvgPath(r,o=!1){this.svgPath=r,this.svg=null,this.isLoadFromPath=!0,this.svgBoxSize=null,o&&await MxThreeJS.loadSVG(r)}getSvgPath(){return this.svgPath}setSvgPostion(r){this.svgPos=r.clone(),this.isSvgDirtyLocation=!0}setImagePath(r,o){this.imagePath=r,o?(this.material=o,this.isLoadMaterialFromPath=!1):(this.material=null,this.isLoadMaterialFromPath=!0)}getImagePath(){return this.imagePath}getSvgPostion(){return this.svgPos}setSvgSize(r){this.svgSize=r,this.isSvgDirtyLocation=!0}getSvgSize(){return this.svgSize}setSvgAlignmentRatio(r){this.svgAlignmentRatio=r,this.isSvgDirtyLocation=!0}getSvgAlignmentRatio(){return this.svgAlignmentRatio}getText(r){return r<this.aryText.length?this.aryText[r]:null}addText(r){this.aryText.push(r)}getGripPoints(){let r=[];r.push(this.svgPos);let o=0;for(;o<this.aryText.length;o++){let a=this.aryText[o];if(a.move){let x=new THREE.Vector3(a.txtPos.x,a.txtPos.y,0);if(this.fixedSize){let u=MxFun.getCurrentDraw();a.txtPos.x>0?x.x=this.svgPos.x+u.screenCoordLong2Doc(a.txtPos.x):x.x=this.svgPos.x-u.screenCoordLong2Doc(a.txtPos.x),a.txtPos.y>0?x.y=this.svgPos.y+u.screenCoordLong2Doc(a.txtPos.y):x.y=this.svgPos.y-u.screenCoordLong2Doc(a.txtPos.y)}r.push(x)}}return r}moveGripPointsAt(r,o){if(r==0)this.svgPos.add(o),this.fixedSize||this.aryText.forEach(a=>{a.txtPos.add(o)});else if(r-1>=0&&r-1<this.aryText.length){let a=this.aryText[r-1];if(a.move)if(this.fixedSize){let x=MxFun.getCurrentDraw();a.txtPos.x+=x.docCoordLong2Screen(o.x),a.txtPos.y+=x.docCoordLong2Screen(o.y)}else a.txtPos.add(o)}return this.isSvgDirtyLocation=!0,!0}calcSvgPosition(r){if(!this.svg||!this.isSvgDirtyLocation)return;this.isSvgDirtyLocation=!1;let[o,a]=this.calcVewSize(r);this.svg.position.x=this.svgPos.x-o*this.svgAlignmentRatio.x-this.svgMargin.x*o,this.svg.position.y=this.svgPos.y-a*this.svgAlignmentRatio.y-this.svgMargin.y*a}dwgIn(r){this.onDwgIn(r),this.fixedSize=r.fixedSize,this.fixedSize?this.svg=null:r.type==MxType.MxCloneType.kClone&&r.svg&&(this.svg=r.svg.clone()),this.svgPos.copy(r.svgPos),this.svgPath=r.svgPath.substr(0),this.svgSize.copy(r.svgSize),this.svgAlignmentRatio.copy(r.svgAlignmentRatio),this.isSvgDirtyLocation=!0,this.svg||(this.isLoadFromPath=!0),this.svgBoxSize=null;let o=r.txts;return this.aryText=[],o.forEach(a=>{let x=new MxDbSVGText;x.txt=a.txt,x.txtHeight=a.txtHeight,x.txtPos.copy(a.txtPos),x.move=a.move,x.drawConnectingLine=a.drawConnectingLine,this.aryText.push(x)}),this.svgRotate=r.svgRotate,this.useSvgColor=r.useSvgColor,this.svgReverse=r.svgReverse,this.svgMirror=r.svgMirror,this.svgMargin=r.svgMargin,r.svgChildColor?this.svgChildColor=r.svgChildColor:this.svgChildColor=[],this.imagePath=r.imagePath.substr(0),this.isLoadMaterialFromPath=!0,r.material&&(this.material=r.material),!0}dwgOut(r){this.onDwgOut(r);let o,a=this.getMxObject();return r.type==MxType.MxCloneType.kClone&&(r.svg=this.svg),r.svgPath=this.svgPath,r.svgPos=this.svgPos,r.svgSize=this.svgSize,r.svgAlignmentRatio=this.svgAlignmentRatio,r.txts=[],r.type==MxType.MxCloneType.kSaveDwgClone&&a&&(o=this.calcSvgDrawRect(a)),this.aryText.forEach(x=>{let u={txtPos:x.txtPos,txt:x.txt,txtHeight:x.txtHeight,color:x.color,_txtAspectRatio:x._txtAspectRatio,move:x.move,drawConnectingLine:x.drawConnectingLine};r.type==MxType.MxCloneType.kSaveDwgClone&&(x._connectingLine&&(u.connectingLine=x._connectingLine.geometry.vertice),x._underLine&&(u._underLine=x._underLine.geometry.vertice)),r.txts.push(u)}),r.fixedSize=this.fixedSize,r.svgRotate=this.svgRotate,r.useSvgColor=this.useSvgColor,r.svgReverse=this.svgReverse,r.svgMirror=this.svgMirror,r.svgMargin=this.svgMargin,r.svgChildColor=this.svgChildColor,r.type==MxType.MxCloneType.kSaveDwgClone&&(r.svgRect=o),r.imagePath=this.imagePath,r.type==MxType.MxCloneType.kDragClone&&(r.material=this.material),r}create(){return new MxDbSVG}transformBy(r){this.svgPos.applyMatrix4(r),this.isSvgDirtyLocation=!0,this.fixedSize||this.aryText.forEach(o=>{o.txtPos.applyMatrix4(r)})}getTypeName(){return"MxDbSVG"}setColor(r){if(super.setColor(r),this.svg){let o=new THREE.Color(this.color);this.svg.traverse(function(a){a.material&&(a.material.color=o)})}return this}setSvg(r){this.svg=r,this.isLoadFromPath=!1,this.svgBoxSize=null}calcSvgBoxSize(r){if(!this.svgBoxSize)if(r.boxSize)this.svgBoxSize=r.boxSize.clone();else{let o=new THREE.Box3().setFromObject(r);this.svgBoxSize||(this.svgBoxSize=new THREE.Vector3),this.svgBoxSize.x=o.max.x-o.min.x,this.svgBoxSize.y=o.max.y-o.min.y}}reComputeSVG(){if(!this.svg)return;let r=this.getMxObject();if(!r)return;this.calcSvgBoxSize(this.svg);let[o,a]=this.calcVewSize(r);this.svgBoxSize&&(this.svg.scale.x=o/this.svgBoxSize.x,this.svg.scale.y=a/this.svgBoxSize.y),this.svg.scale.z=this.svg.scale.x,this.svgReverse&&(this.svg.scale.y*=-1),this.svgMirror&&(this.svg.scale.x*=-1),this.isSvgDirtyLocation=!0,this.calcSvgPosition(r)}onViewChange(){if(!this.fixedSize)return!1;if(this.imagePath.length>0)return this.setNeedUpdateDisplay(!1),!0;let r=this.getMxObject();if(r==null)return!1;if(this.svg){this.calcSvgBoxSize(this.svg);let[M,I]=this.calcVewSize(r);this.svgBoxSize&&(this.svg.scale.x=M/this.svgBoxSize.x,this.svg.scale.y=I/this.svgBoxSize.y),this.svg.scale.z=this.svg.scale.x,this.svgReverse&&(this.svg.scale.y*=-1),this.svgMirror&&(this.svg.scale.x*=-1),this.isSvgDirtyLocation=!0,this.calcSvgPosition(r)}let o=this.calcSvgDrawRect(r),a=o.cenpt,x=o.sizew,u=this;return this.aryText.forEach(M=>{if(M._txtObject&&r){let H=r.screenCoordLong2Doc(M.txtHeight);if(H>1e-5){M._txtAspectRatio<=0&&(M._txtAspectRatio=M._txtObject.scale.x/M._txtObject.scale.y),M._txtObject.scale.set(M._txtAspectRatio*H*1.5,1.5*H,1),M.txtPos.x>0?M._txtObject.position.x=u.svgPos.x+r.screenCoordLong2Doc(M.txtPos.x):M._txtObject.position.x=u.svgPos.x-r.screenCoordLong2Doc(M.txtPos.x),M.txtPos.y>0?M._txtObject.position.y=u.svgPos.y+r.screenCoordLong2Doc(M.txtPos.y):M._txtObject.position.y=u.svgPos.y-r.screenCoordLong2Doc(M.txtPos.y);let G=M._txtObject.position;if(M._txtObject.updateMatrix(),M._underLine){const L=new THREE.Box3;let y=M._txtObject.parent;M._txtObject.parent=null,L.expandByObject(M._txtObject),M._txtObject.parent=y;let D=new THREE.Vector3(L.min.x,L.min.y+.1*H,0),C=new THREE.Vector3(L.max.x,L.min.y+.1*H,0);(I=new THREE.Geometry).vertices.push(D,C),M._underLine.geometry=I}if(M._connectingLine){let L=a.clone().sub(G);L.normalize();let y=a.clone().sub(L.clone().multiplyScalar(x)),D=G.clone().add(L.clone().multiplyScalar(H));var I;(I=new THREE.Geometry).vertices.push(y,D),M._connectingLine.geometry=I}}}}),!0}}function drawMxDbPolyline(){const T=new MrxDbgUiPrPoint;T.setMessage(`
指定第一点:`);let r,o=new MxDbPolyline;T.go(a=>{if(a!=0)return;let x=T.value();r||(r=x.clone());let u=x;const M=new McEdGetPointWorldDrawObject;M.setDraw((H,G)=>{G.setColor(16711680),G.drawLine(u,H),G.drawCustomEntity(o)}),T.setUserDraw(M),T.setMessage(`
指定下一点:`);let I=0;o.addVertexAt(x),T.goWhile(H=>{if(H==0)u=T.value(),o.addVertexAt(u),++I>=2?(T.setMessage(`
指定下一点:`),T.setKeyWords("[闭合(C)/放弃(U)]")):I>0?(T.setMessage(`
指定下一点:`),T.setKeyWords("[放弃(U)]")):(T.setMessage(`
指定第一点:`),T.setKeyWords(""));else if(H==1){if(T.isKeyWordPicked("C"))return{exit:!0};T.isKeyWordPicked("U")&&console.log("Mx_Line undo....")}},()=>{MxFun.getCurrentDraw().addMxEntity(o)})})}MxDbSVG.cmd="Mx_ModelFixedSvg",MxDbSVG.draw=drawMxDbSVG,addRegisterMxDbEntity(MxDbSVG);class MxDbPolyline extends MxDbEntity{constructor(){super(...arguments),this.points=[]}getTypeName(){return"MxDbPolyline"}worldDraw(r){this.points.length<2||r.drawLines(this.points)}getGripPoints(){return this.points}moveGripPointsAt(r,o){return!(r>=this.points.length||(this.points[r].add(o),0))}create(){return new MxDbPolyline}dwgIn(r){this.onDwgIn(r);let o=r.points;return this.points=[],o.forEach(a=>{this.points.push(new THREE.Vector3(a.x,a.y,a.z))}),!0}dwgOut(r){return this.onDwgOut(r),r.points=this.points,r}addVertexAt(r){this.points.push(r)}numVerts(){return this.points.length}getPointAt(r){return r<this.points.length?this.points[r]:null}setPointAt(r,o){return r<this.points.length&&(this.points[r]=o,!0)}}function drawMxDb2LineAngularDimension(){const T=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),o=new MxDb2LineAngularDimension,a=new McEdGetPointWorldDrawObject;return T.setMessage(`
指定第一点:`),T.go(x=>{x===0&&(T.setMessage(`
指定第二个角度点:`),o.point1=T.value(),a.setDraw((u,M)=>{o.point2=u,a.drawLine(o.point1,u)}),T.setUserDraw(a),T.go(u=>{T.setMessage(`
指定最后一个点:`),u===0&&(o.point2=T.value(),a.setDraw((M,I)=>{o.point3=M,a.drawCustomEntity(o)}),T.go(M=>{M===0&&r.addMxEntity(o)}))}))}),o}MxDbPolyline.cmd="Mx_Lines",MxDbPolyline.draw=drawMxDbPolyline,addRegisterMxDbEntity(MxDbPolyline);const propertyDbKeys$6=["colors","point1","point2","point3"];class MxDb2LineAngularDimension extends MxDbEntity{constructor(r){if(super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.point3=new THREE.Vector3,this.colors=[],r){const{points:o,colors:a}=r;o&&this.setPoints(o),a&&this.setColor(a)}}calculateLineAngle(r,o,a){const x=2*Math.PI/360;return{startAngle:180*Math.atan2(o.y-r.y,o.x-r.x)/Math.PI*x,endAngle:180*Math.atan2(a.y-r.y,a.x-r.x)/Math.PI*x}}setPoints(r){const[o,a,x]=r;return o&&(this.point1=o),a&&(this.point2=a),x&&(this.point3=x),this}setColor(r){return lodash.isArray(r)?this.colors=r:this.color=r,this}worldDraw(r){if(r.getType()==McGiWorldDrawType$1.kWorldDraw||r.getType()==McGiWorldDrawType$1.kDynDragDraw){const[o,a,x,u]=this.colors||[],M=this.getColor(),I=r.getMxObject();r.setOpacity(this.opacity),r.setColor(o||M),r.drawLine(this.point1,this.point2),r.setColor(a||M),r.drawLine(this.point2,this.point3);const{startAngle:H,endAngle:G}=this.calculateLineAngle(this.point2,this.point1,this.point3),L=this.point2.distanceTo(this.point1),y=this.point2.distanceTo(this.point3),D=Math.min(L,y)/4;let C=THREE.MathUtils.radToDeg(H-G);C<0&&(C+=360);let B=I.screenCoordLong2Doc(50);const z=new THREE.ArcCurve(this.point2.x,this.point2.y,D,H,G,!0),A=new THREE.Geometry().setFromPoints(z.getPoints(50));r.setColor(x||M),r.drawGeometryLines(A);const S=z.getPoint(.5);let q=new THREE.Vector3(S.x,S.y,0);const W=q.sub(this.point2),_=W.length()+.5*B;W.normalize().multiplyScalar(_),q=this.point2.clone().add(W),r.setColor(u||M),r.drawText(C.toFixed(3)+"°",.5*B,0,q)}else r.drawLine(this.point1,this.point2),r.drawLine(this.point3,this.point2)}getGripPoints(){return[this.point1,this.point2,this.point3]}moveGripPointsAt(r,o){return r===0?this.point1.add(o):r===1?this.point2.add(o):r===2&&this.point3.add(o),!0}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,propertyDbKeys$6),!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,propertyDbKeys$6),r}create(){return new MxDb2LineAngularDimension}transformBy(r){this.point1.applyMatrix4(r),this.point2.applyMatrix4(r)}getTypeName(){return"MxDb2LineAngularDimension"}}MxDb2LineAngularDimension.cmd="Mx_AngleSurveying",MxDb2LineAngularDimension.draw=drawMxDb2LineAngularDimension,addRegisterMxDbEntity(MxDb2LineAngularDimension);class MxFilters{constructor(){this.uniformObj={},this.filtersStr="",this.filtersTypes="",this.VSHADER_SOURCE=`
  varying vec2 v_Uv;
  void main () {
      v_Uv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }
  `,this.FSHADER_SOURCE=`
  varying vec2 v_Uv;
  uniform sampler2D e_Texture;
  uniform mat4 colorMatrix;
  ${this.filtersStr}
  void main () {
    vec4 color = texture2D( e_Texture, v_Uv );
    color = color * colorMatrix;
    ${this.filtersTypes}
    gl_FragColor = color;
  }`,this._matrix=new THREE.Matrix4}channel({r=1,g:o=1,b:a=1}){return this._matrix=new THREE.Matrix4().set(r,0,0,0,0,o,0,0,0,0,a,0,0,0,0,1).multiply(this._matrix),this}brightness(r){return this._matrix=new THREE.Matrix4().set(r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1).multiply(this._matrix),this}saturate(r){const o=.2126*(1-r),a=.7152*(1-r),x=.0722*(1-r);return this._matrix=new THREE.Matrix4().set(o+r,a,x,0,o,a+r,x,0,o,a,x+r,0,0,0,0,1).multiply(this._matrix),this}contrast(r){const o=.5*(1-r);return this._matrix=new THREE.Matrix4().set(r,0,0,0,0,r,0,0,0,0,r,0,o,o,o,1).multiply(this._matrix),this}opacity(r){return this._matrix=new THREE.Matrix4().set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,r).multiply(this._matrix),this}invert(r){const o=1-2*r;return this._matrix=new THREE.Matrix4().set(o,0,0,0,0,o,0,0,0,0,o,0,r,r,r,1).multiply(this._matrix),this}grayscale(r=1){const o=.2126*r,a=.7152*r,x=.0722*r;return this._matrix=new THREE.Matrix4().set(o+1-r,a,x,0,o,a+1-r,x,0,o,a,x+1-r,0,0,0,0,1).multiply(this._matrix),this}sepia(r=1){return this._matrix=new THREE.Matrix4().set(1-.607*r,.769*r,.189*r,0,.349*r,1-.314*r,.168*r,0,.272*r,.534*r,1-.869*r,0,0,0,0,1).multiply(this._matrix),this}hueRotate(r){const o=r/180*Math.PI,a=Math.cos(o),x=Math.sin(o),u=.2126,M=.7152,I=.0722;return this._matrix=new THREE.Matrix4().set(u+.7874*a+x*-u,M+a*-M+x*-M,I+a*-I+.9278*x,0,u+a*-u+.143*x,M+a*(1-M)+.14*x,I+a*-I+-.283*x,0,u+a*-u+-.7874*x,M+a*-M+x*M,I+.9278*a+x*I,0,0,0,0,1).multiply(this._matrix),this}convolution(r,o=1/9,a=521){return this.uniformObj=Object.assign(Object.assign({},this.uniformObj),{cKernel:{value:r.toArray()},stStep:{value:o},scaleFactor:{value:a}}),this.filtersTypes.indexOf("convolutionTextureColor")<0&&(this.filtersStr+=`
        uniform float cKernel[9];
        uniform float stStep;
        uniform float scaleFactor;
        vec4 convolutionTextureColor(vec4 color) {
            vec2 offsets[9];
            offsets[0] = vec2(-1.0,-1.0);
            offsets[1] =  vec2(0.0,-1.0);
            offsets[2] = vec2(1.0,-1.0);
            offsets[3] =  vec2(-1.0,0.0);
            offsets[4] = vec2(0.0,0.0);
            offsets[5] = vec2(1.0,0.0);
            offsets[6] =  vec2(-1.0,1.0);
            offsets[7] = vec2(0.0,1.0);
            offsets[8] = vec2(1.0,1.0);

            vec4 sum = color;
            for(int i = 0; i < 9; i++) {
                sum = sum + cKernel[i] * scaleFactor * texture2D(e_Texture, v_Uv + offsets[i] / stStep);
            };
            return sum;
        }`,this.filtersTypes+=`color = convolutionTextureColor(color);
`),this}reset(){return this.uniformObj={},this.filtersStr="",this.filtersTypes="",this._matrix=new THREE.Matrix4,this}_getFilterShaderData(r){return{uniforms:Object.assign({e_Texture:{value:r},colorMatrix:{value:this._matrix}},this.uniformObj),vertexShader:this.VSHADER_SOURCE,fragmentShader:this.FSHADER_SOURCE}}_getFilterColor(r="#000000",o=1){r=new THREE.Color(r);let{r:a,g:x,b:u}=r;const M=this._matrix.toArray();M[12],M[13],M[14],M[15];const I=M[0]*a+M[1]*a+M[2]*a+M[3]*o,H=M[4]*x+M[5]*x+M[6]*x+M[7]*o,G=M[8]*u+M[9]*u+M[10]*u+M[11]*o;return r.setRGB(I,H,G),r}toJSON(){return JSON.stringify({matrix:this._matrix.toArray(),uniformObj:this.uniformObj,filtersStr:this.filtersStr,filtersTypes:this.filtersTypes})}static fromJSON(r){const{matrix:o,uniformObj:a,filtersStr:x,filtersTypes:u}=JSON.parse(r),M=new MxFilters;return M._matrix=new THREE.Matrix4().fromArray(o),M.uniformObj=a,M.filtersStr=x,M.filtersTypes=u,M}}class MxDbShape extends MxDbEntity{constructor(){super(...arguments),this.isLoadMaterialFromPath=!0,this.stroke="#fff",this.strokeLineWidth=2,this.isStrokeDashLine=!1,this.isFill=!1,this._fillImageSrc=null,this.curveSegments=50,this.closed=!0,this.filter=null,this._cornerRadius=[],this._propertyDbKeys=["isFill","stroke","strokeLineWidth","isStrokeDashLine","closed","cornerRadius","fillImageSrc","fillImageParam","curveSegments"]}setStroke(r){return this.stroke=r,this}setStrokeLineWidth(r){return this.strokeLineWidth=r,this}setIsStrokeDashLine(r){return this.isStrokeDashLine=r,this}setIsFill(r){return this.isFill=r,this}get fillImageSrc(){return this._fillImageSrc}set fillImageSrc(r){this._fillImageSrc=r,this.isLoadMaterialFromPath=!0,this.material=null,this.fillImageSrc&&(this.isFill=!0),r!==!1&&r!==null||(this.setNeedUpdateDisplay(),MxFun.updateDisplay())}setFillImageSrc(r){return this.fillImageSrc=r,this}setFillImageParam(r){this.fillImageParam=r===void 0?r:Object.assign(this.fillImageParam,r)}setCurveSegments(r){return this.curveSegments=r,this}setClosed(r){return this.closed=r,this}getFilter(){return this.filter}setFilter(r){this.filter=r,this.isLoadMaterialFromPath=!0,this.material=null}get cornerRadius(){return this._cornerRadius}set cornerRadius(r){this.setCornerRadius(r)}setCornerRadius(r,o=!0){this._cornerRadius=r instanceof Array?r.map(a=>o?MxFun.screenCoordLong2Doc(a):a):o?MxFun.screenCoordLong2Doc(r):r}getTypeName(){return"MxDbShape"}getShapePoints(r){const{curveSegments:o}=this;return this.points=r.getPoints(o).map(a=>a instanceof THREE.Vector2?new THREE.Vector3(a.x,a.y,0):a),this.points}createPaths(r){return this._paths=new THREE.CurvePath,Array.isArray(r)?r.forEach(o=>this._paths.add(o)):this._paths.add(r),this._paths}_draw(r,o){let{isFill:a,closed:x,opacity:u,dLineWidth:M,lineWidthByPixels:I}=this;r.setOpacity(u),r.setLineWidthByPixels(I),r.setLineWidth(M);const H=r.getColor();r.setColor(this.filter?this.filter._getFilterColor(this.color,this.opacity):this.color);const G=this.getCornerRadiusPoints(x||a?this.getClosedPoints(o):o);a?!this.fillImageSrc&&r.drawSolid(G):r.drawLines(G),this._fillImg(r,G),r.setColor(H)}getCornerRadiusPoints(r){const{cornerRadius:o}=this;if(!o)return r;const a=typeof o=="number"?r.map(()=>o):o;return a.length>0?getToGenerateRoundedCorners(r,a):r}_drawStoreLine(r,o,a){const{isFill:x,stroke:u,strokeLineWidth:M}=this,I=r.getLineWidth(),H=r.getColor(),G=r.isDashLineDisplay();u&&x&&(r.setDashLineDisplay(this.isStrokeDashLine),r.setColor(u),r.setLineWidth(M),a?a(r):r.drawLines(this.getCornerRadiusPoints(this.getClosedPoints(o))),r.setColor(H),r.setLineWidth(I),r.setDashLineDisplay(G))}getClosedPoints(r){return[...r,r[0]]}getTotalLength(){if(this.points){let r=0;return this.points.reduce((o,a)=>(r+=o.distanceTo(a),a)),r}if(this._paths)return this._paths.getLength()+(this.closedLine?this.closedLine.getLength():0)}getGetLength(){return this._paths.getLength()}getArea(){return this.points?McGeTool.calcArea(this.closed?this.getClosedPoints(this.points):this.points):0}worldDraw(r){const o=this.createPaths(new THREE.Curve),a=this.getShapePoints(o);this._draw(r,a),this._drawStoreLine(r,a)}_fillImg(r,o){const a={transparent:!0,depthTest:!1,opacity:this.opacity,visible:this.visible};if(!this.isFill||!this.fillImageSrc)return;if(!this.material){let H=this;return void MxFun.loadImageMaterial(this.fillImageSrc,G=>{H.isLoadMaterialFromPath=!1,G&&(H.material=G,H.setNeedUpdateDisplay(),MxFun.updateDisplay())})}const x=o.map(({x:H,y:G})=>new THREE.Vector2(H,G));let u=this.material,M=new THREE.ShapeGeometry(new THREE.Shape(x));if(M=repairGeometryFaceVertexUvs(M),this.filter){const H=u.map,G=this.filter._getFilterShaderData(H);u=new THREE.ShaderMaterial(Object.assign(Object.assign({},G),a))}if(u.depthTest=!1,u.transparent=!0,u.opacity=this.opacity,u.visible=this.visible,this.fillImageParam){const H=this.fillImageParam;for(let G in this.fillImageParam)this.material.map[G]=H[G]}let I=new THREE.Mesh(M,u);r.drawEntity(I)}getGripPoints(){return[]}moveGripPointsAt(r,o){return!0}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,this._propertyDbKeys),this.isLoadMaterialFromPath=!0,this.material=null,r.type===MxType.MxCloneType.kMxFileClone?r.filter&&(this.filter=MxFilters.fromJSON(r.filter)):r.filter&&(this.filter=r.filter),!0}dwgOut(r){var o;return this.onDwgOut(r),this.dwgOutHelp(r,this._propertyDbKeys),r.type===MxType.MxCloneType.kMxFileClone?this.filter&&(r.filter=(o=this.filter)===null||o===void 0?void 0:o.toJSON()):r.filter=this.filter,r}transformBy(r){this.points&&this.points.forEach(o=>{o.applyMatrix4(r)})}}class MxDbEllipseShape extends MxDbShape{constructor(){super(),this.center=new THREE.Vector3,this.xRadius=10,this.yRadius=10,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!1,this.rotation=0,this.isClosedToCenter=!0,this._propertyDbKeys=[...this._propertyDbKeys,"center","xRadius","yRadius","startAngle","endAngle","clockwise","rotation","isClosedToCenter"]}getTypeName(){return"MxDbEllipseShape"}setCenter(r){return this.center=r,this}setXRadius(r){return this.xRadius=r,this}setYRadius(r){return this.yRadius=r,this}setStartAngle(r){return this.startAngle=r,this}setEndAngle(r){return this.endAngle=r,this}setClockwise(r){return this.clockwise=r,this}setRotation(r){return this.rotation=r,this}setIsClosedToCenter(r){return this.isClosedToCenter=r,this}worldDraw(r){this.drawEllipseShape(r)}drawEllipseShape(r){let{startAngle:o,endAngle:a,clockwise:x}=this;const u=this.createEllipseCurve(),M=this.createPaths(u);let I=this.getShapePoints(M);return this._draw(r,I),this._drawStoreLine(r,I),{centralAngle:x?a>o?THREE.MathUtils.radToDeg(u.aEndAngle-u.aStartAngle):360-Math.abs(THREE.MathUtils.radToDeg(u.aEndAngle-u.aStartAngle)):o>a?Math.abs(THREE.MathUtils.radToDeg(u.aEndAngle-u.aStartAngle)):360-THREE.MathUtils.radToDeg(u.aEndAngle-u.aStartAngle),curve:u,points:I}}createEllipseCurve(r=this.center.x,o=this.center.y,a=this.xRadius,x=this.yRadius,u=this.startAngle,M=this.endAngle,I=this.clockwise,H=this.rotation){return new THREE.EllipseCurve(r,o,a,x,u,M,I,H)}getCornerRadiusPoints(r){return r}getClosedPoints(r){try{let o=(this._paths||new THREE.CatmullRomCurve3(r,!1,"catmullrom",0)).getLength();this.closedLine=this.getClosedLine(r);const a=this.closedLine.getLength();let x=this.curveSegments/o,u=2.5*(o>this.curveSegments?a*x:1);if(u>20*this.curveSegments&&(u=20*this.curveSegments),u<=0)return r;const M=this.closedLine.getPoints(u);return[...r,...M]}catch{return[...r,r[0]]}}getClosedLine(r){const{isClosedToCenter:o,center:a}=this;let x=o?[r[r.length-1],a,r[0]]:[r[r.length-1],r[0]];return new THREE.CatmullRomCurve3(x,!1,"catmullrom",.01)}getGripPoints(){return[this.center]}moveGripPointsAt(r,o){return r===0&&this.center.add(o),!0}}addRegisterMxDbEntity(MxDbEllipseShape);class MxDbCircleShape extends MxDbEllipseShape{getTypeName(){return"MxDbCircleShape"}get radius(){return this.xRadius}set radius(r){this.xRadius=r,this.yRadius=r}setRadius(r){return this.radius=r,this}setXRadius(r){return this.setRadius(r),this}setYRadius(r){return this.setRadius(r),this}}function drawMx3PointArc(){const T=new MrxDbgUiPrPoint,r=new McEdGetPointWorldDrawObject,o=new Mx3PointArc;T.setUserDraw(r),T.setMessage(`
确定圆弧开始点:`),T.go(a=>{a===MrxDbgUiPrBaseReturn$1.kOk&&(o.point1=T.value(),r.setDraw(x=>{r.drawLine(o.point1,x)})),T.setMessage(`
确定圆弧结束点:`),T.go(x=>{x===MrxDbgUiPrBaseReturn$1.kOk&&(o.point2=T.value(),r.setDraw(u=>{o.point3=u,r.drawCustomEntity(o)})),T.setMessage(`
确定圆弧上任意一点:`),T.go(u=>{if(u===MrxDbgUiPrBaseReturn$1.kOk){MxFun.getCurrentDraw().addMxEntity(o);const{radius:M,angle:I,arcLength:H}=createThreePointArc(o.point1,o.point2,o.point3,!0);console.log("半径:",M),console.log("圆弧弧长:",H,o.getTotalLength())}})})})}addRegisterMxDbEntity(MxDbCircleShape);class Mx3PointArc extends MxDbCircleShape{constructor(){super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.point3=new THREE.Vector3,this.autoClockwise=!0,this.closed=!1,this.centralAngle=0,this._propertyDbKeys=[...this._propertyDbKeys,"point1","point2","point3","autoClockwise"]}getTypeName(){return"Mx3PointArc"}create(){return new Mx3PointArc}worldDraw(r){this.updateDataInfo();const{centralAngle:o}=this.drawEllipseShape(r);this.centralAngle=o}getGripPoints(){return[this.point1,this.point2,this.point3,this.center]}compute3PointAngle(r=this.point1,o=this.point2,a=this.point3){const x=calculateArcAngle(r,this.center,this.radius),u=calculateArcAngle(o,this.center,this.radius),M=calculateArcAngle(a,this.center,this.radius);return[x.angle,u.angle,M.angle]}upDateCenter(r=this.point1,o=this.point2,a=this.point3){return this.center=calculateArcOrigin(r,o,a),this.center}upDateRadius(r=this.point1){return this.radius=calculateRadiusArc(r,this.center),this.radius}upDataClockwise(r,o,a){const{autoClockwise:x}=this;x&&(this.clockwise=judgementArcRenderDirection(o,r,a))}updateDataInfo(){this.upDateCenter(this.point1,this.point2,this.point3),this.upDateRadius(this.point1);const[r,o,a]=this.compute3PointAngle();this.startAngle=THREE.MathUtils.degToRad(r),this.endAngle=THREE.MathUtils.degToRad(o),this.upDataClockwise(r,o,a)}getArcMidPoint(){const r=MxFun.getMxFunTHREE();this.updateDataInfo();let{startAngle:o,endAngle:a,center:x,radius:u,clockwise:M}=this;M?o<a&&(o+=2*Math.PI):o>a&&(a+=2*Math.PI);const I=(o+a)/2,H=x.x+u*Math.cos(I),G=x.y+u*Math.sin(I);return new r.Vector3(H,G,0)}moveGripPointsAt(r,o){return r===0?this.point1.add(o):r===1?this.point2.add(o):r===2?this.point3.add(o):r===3&&(this.point1.add(o),this.point2.add(o),this.point3.add(o)),this.upDateCenter(),!0}}Mx3PointArc.cmd="Mx_3PointArc",Mx3PointArc.draw=drawMx3PointArc,Mx3PointArc.isRegister=!1,addRegisterMxDbEntity(Mx3PointArc);const drawMx2PointArc=async()=>{const T=new MrxDbgUiPrPoint,r=new Mx2PointArc,o=await T.go();if(!o)return;r.startPoint=o,T.setUserDraw((x,u)=>{r.endPoint=x,u.drawCustomEntity(r)});const a=await T.go();a&&(r.endPoint=a,MxFun.getCurrentDraw().addMxEntity(r))};class Mx2PointArc extends Mx3PointArc{getTypeName(){return"Mx2PointArc"}create(){return new Mx2PointArc}get startPoint(){return this.point1}set startPoint(r){this.point1=r,this.point3.x,this.point1.x,this.point3.y,this.point2.y}get endPoint(){return this.point2}set endPoint(r){this.point2=r,this.point3=this.getArcMidPoint()}}function drawMxDbCoord(){const T=new MrxDbgUiPrPoint;T.setMessage(`
指定坐标点:`),T.go(r=>{if(r!=0)return;const o=T.value();let a=new MxDbCoord;a.point1=o,a.point2=o.clone(),T.setBasePt(o),T.setUseBasePt(!0),T.setUserDraw((x,u)=>{a.point2=x,u.drawCustomEntity(a)}),T.setMessage(`
指定标注点:`),T.go(x=>{x==0?(a.point2=T.value(),MxFun.addToCurrentSpace(a)):console.log(x)})})}Mx2PointArc.cmd="Mx_2PointArc",Mx2PointArc.draw=drawMx2PointArc,Mx2PointArc.isRegister=!1,addRegisterMxDbEntity(Mx2PointArc);class MxDbCoord extends MxDbEntity{constructor(){super(...arguments),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3}worldDraw(r){let o=r.getMxObject();r.drawLine(this.point1,this.point2);let a=this.point2.clone();var x=o.screenCoordLong2Doc(20),u=6*x;a.x=a.x+u,r.drawLine(this.point2,a);var M=new THREE.Vector3,I=new THREE.Vector3;let H=o.docCoord2Cad(this.point1.x,this.point1.y,this.point1.z),G=H.x.toFixed(3),L=H.y.toFixed(3);M.x=this.point2.x+.3*x+.5*u,M.y=this.point2.y+.1*x+.5*x,r.drawText(G,x,0,M),I.x=this.point2.x+.3*x+.5*u,I.y=this.point2.y-.1*x-.5*x,r.drawText(L,x,0,I)}getGripPoints(){let r=[];return r.push(this.point1),r.push(this.point2),r}moveGripPointsAt(r,o){return r==0?this.point1.add(o):r==1&&this.point2.add(o),!0}dwgIn(r){return this.onDwgIn(r),this.point1.copy(r.point1),this.point2.copy(r.point2),!0}dwgOut(r){return this.onDwgOut(r),r.point1=this.point1,r.point2=this.point2,r}create(){return new MxDbCoord}transformBy(r){this.point1.applyMatrix4(r),this.point2.applyMatrix4(r)}getTypeName(){return"MxDbCoord"}}async function drawMxDbLine(){const T=new MrxDbgUiPrPoint;T.setMessage(`
指定第一点:`);let r=await T.go();if(r==null)return;T.setBasePt(r.clone()),T.setUseBasePt(!0),T.setMessage(`
指定第二点:`);let o=await T.go();if(o==null)return;let a=new MxDbLine;a.pt1=r,a.pt2=o,MxFun.addToCurrentSpace(a)}MxDbCoord.cmd="Mx_Coord",MxDbCoord.draw=drawMxDbCoord,addRegisterMxDbEntity(MxDbCoord);class MxDbLine extends MxDbEntity{constructor(){super(...arguments),this.pt1=new THREE.Vector3,this.pt2=new THREE.Vector3}getTypeName(){return"MxDbLine"}worldDraw(r){r.drawLine(this.pt1,this.pt2)}setPoint1(r){this.pt1=r}getPoint1(){return this.pt1}setPoint2(r){this.pt2=r}getPoint2(){return this.pt2}getGripPoints(){let r=[];r.push(this.pt1),r.push(this.pt2);let o=new THREE.Vector3(this.pt1.x+.5*(this.pt2.x-this.pt1.x),this.pt1.y+.5*(this.pt2.y-this.pt1.y),0);return r.push(o),r}moveGripPointsAt(r,o){return r==0?this.pt1.add(o):r==1?this.pt2.add(o):r==2&&(this.pt1.add(o),this.pt2.add(o)),!0}dwgIn(r){return this.onDwgIn(r),this.pt1.copy(r.pt1),this.pt2.copy(r.pt2),!0}dwgOut(r){return this.onDwgOut(r),r.pt1=this.pt1,r.pt2=this.pt2,r}create(){return new MxDbLine}getGeomExtents(){return new THREE.Box3(this.pt1,this.pt2)}getGetLength(){return this.pt1.distanceTo(this.pt2)}}async function drawMxDbRect(){const T=new MrxDbgUiPrPoint;T.setMessage(`
指定第一点:`);let r=await T.go();if(!r)return;let o=new MxDbRect;o.pt1=r;const a=new McEdGetPointWorldDrawObject;a.setDraw(x=>{o.pt2=x,a.drawCustomEntity(o)}),T.setBasePt(r),T.setUseBasePt(!0),T.setUserDraw(a),T.setMessage(`
指定第二点:`),await T.go()&&(o.pt2=T.value(),MxFun.getCurrentDraw().addMxEntity(o))}MxDbLine.cmd="Mx_Line",MxDbLine.draw=drawMxDbLine,addRegisterMxDbEntity(MxDbLine);class MxDbRect extends MxDbEntity{constructor(){super(...arguments),this.cornerRadius=[],this.pt1=new THREE.Vector3,this.pt2=new THREE.Vector3,this.isSolidColorFill=!1,this.isLoadMaterialFromPath=!0,this.material=null}worldDraw(r){let o=computeRectPoints(this.pt1,this.pt2);if(this.cornerRadius.length>0&&(o=getToGenerateRoundedCorners(o,this.cornerRadius)),r.getType()!=McGiWorldDrawType$1.kWorldDraw)return o.push(o[0]),void r.drawLines(o);const a={transparent:!0,depthTest:!1,opacity:this.opacity,visible:this.visible};if(this.isSolidColorFill){let x;o=o.map(({x:I,y:H})=>new THREE.Vector2(I,H)),x=new THREE.ShapeGeometry(new THREE.Shape(o));let u=new THREE.MeshBasicMaterial(Object.assign({color:this.filter?this.filter._getFilterColor(this.color,this.opacity):new THREE.Color(this.color)},a)),M=new THREE.Mesh(x,u);r.drawEntity(M)}else if(this.fillImageSrc){if(this.material){o=o.map(({x:I,y:H})=>new THREE.Vector2(I,H));let x=this.material,u=new THREE.ShapeGeometry(new THREE.Shape(o));if(u=repairGeometryFaceVertexUvs(u),this.filter){const I=x.map;this.fillImageParam&&(this.fillImageParam.center&&(I.center=this.fillImageParam.center),this.fillImageParam.offset&&(I.offset=this.fillImageParam.offset),this.fillImageParam.repeat&&(I.repeat=this.fillImageParam.repeat),this.fillImageParam.rotation&&(I.rotation=this.fillImageParam.rotation));const H=this.filter._getFilterShaderData(I);x=new THREE.ShaderMaterial(Object.assign(Object.assign({},H),a))}x.depthTest=!1,x.transparent=!0,x.opacity=this.opacity,x.visible=this.visible;let M=new THREE.Mesh(u,x);r.drawEntity(M)}else if(this.fillImageSrc.length>0&&this.isLoadMaterialFromPath){let x=this;MxFun.loadImageMaterial(this.fillImageSrc,u=>{this.isLoadMaterialFromPath=!1,u&&(x.material=u,x.setNeedUpdateDisplay(),MxFun.updateDisplay())})}}else r.drawLines([...o,o[0]])}getGripPoints(){let r=[];r.push(this.pt1);const o=new THREE.Line3(this.pt1,this.pt2);let a=new THREE.Vector3;return o.getCenter(a),r.push(a),r.push(this.pt2),r}moveGripPointsAt(r,o){return r==0?this.pt1.add(o):r==1?(this.pt1.add(o),this.pt2.add(o)):r==2&&this.pt2.add(o),!0}dwgIn(r){return this.onDwgIn(r),this.pt1.copy(r.pt1),this.pt2.copy(r.pt2),this.isSolidColorFill=r.isSolidColorFill,this.fillImageSrc=r.fillImageSrc,this.fillImageParam=r.fillImageParam,this.cornerRadius=r.cornerRadius,this.filter=r.filter,this.isLoadMaterialFromPath=!0,this.material=null,!0}dwgOut(r){return this.onDwgOut(r),r.pt1=this.pt1,r.pt2=this.pt2,r.isSolidColorFill=this.isSolidColorFill,r.fillImageSrc=this.fillImageSrc,r.fillImageParam=this.fillImageParam,r.cornerRadius=this.cornerRadius,r.filter=this.filter,r}create(){return new MxDbRect}transformBy(r){this.pt1.applyMatrix4(r),this.pt2.applyMatrix4(r)}setRadius(r,o=!0){this.cornerRadius=r instanceof Array?r.map(a=>o?MxFun.screenCoordLong2Doc(a):a):r>0?o?[MxFun.screenCoordLong2Doc(r),MxFun.screenCoordLong2Doc(r),MxFun.screenCoordLong2Doc(r),MxFun.screenCoordLong2Doc(r)]:[r,r,r,r]:[]}getTypeName(){return"MxDbRect"}getFilter(){return this.filter}setFilter(r){this.filter=r,this.isLoadMaterialFromPath=!0,this.material=null}setFillImagePath(r){this.fillImageSrc=r,this.isLoadMaterialFromPath=!0,this.material=null,this.fillImageSrc&&(this.isSolidColorFill=!1)}getFillImagePath(){return this.fillImageSrc}}function drawMxDbAlignedDimension(){let T=new MxDbAlignedDimension;const r=new MrxDbgUiPrPoint;return r.setMessage(`
指定第一点:`),r.go(o=>{if(o!=0)return;const a=r.value();T.setPoint1(a),T.setColor(65314);const x=new McEdGetPointWorldDrawObject;x.setDraw(u=>{T.setPoint2(u),x.drawCustomEntity(T)}),r.setBasePt(a),r.setUseBasePt(!0),r.setUserDraw(x),r.setMessage(`
指定第二点:`),r.setInputToucheType(MxType.InputToucheType.kGetEnd),r.go(u=>{if(u!=0)return void console.log(u);const M=r.value();T.setPoint2(M),MxFun.getCurrentDraw().addMxEntity(T)})}),T}MxDbRect.cmd="Mx_DrawRect",MxDbRect.draw=drawMxDbRect,addRegisterMxDbEntity(MxDbRect);const propertyDbKeys$5=["point1","point2","fontColor"];class MxDbAlignedDimension extends MxDbEntity{constructor(r){if(super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,r){const{points:o,fontColor:a}=r;o&&this.setPoints(o),a&&(this.fontColor=a)}}setPoints(r){const[o,a]=r;o&&(this.point1=o),a&&(this.point2=a)}getTypeName(){return"MxDbAlignedDimension"}getDirection(r,o,a){const x=new THREE.Vector3(r.x,r.y,0),u=new THREE.Vector3(1,0,0),M=r.angleTo(u);let I=-1;(M<7*Math.PI/18||M>10*Math.PI/18)&&o.x>a.x&&(I=1);const H=new THREE.Matrix4;return H.makeRotationZ(Math.PI/2*I),x.applyMatrix4(H),x}getDimText(){return new THREE.Vector3(this.point1.x-this.point2.x,this.point1.y-this.point2.y,0).length().toFixed(3)}worldDraw(r){if(r.setOpacity(this.opacity),r.getType()==McGiWorldDrawType$1.kWorldDraw||r.getType()==McGiWorldDrawType$1.kDynDragDraw){let _=function(R,v){Array.isArray(R)?R.forEach(V=>{_(V,v)}):R.opacity=v};const o=this.point1,a=this.point2;let x,u,M,I,H,G,L;const y=new THREE.Vector3(o.x-a.x,o.y-a.y,0),D=this.getDirection(y,o,a),C=new THREE.Matrix4;C.makeScale(.01,.01,.01);const B=new THREE.Vector3(D.x,D.y,0);B.applyMatrix4(C);const z=new THREE.Vector3(o.x+B.x,o.y+B.y,0),A=new THREE.Vector3(a.x+B.x,a.y+B.y,0),S=this.getColor();G=MxThreeJS.createPoint(o,S),L=MxThreeJS.createPoint(a,S);const q=new THREE.Vector3(D.x,D.y,0),W=new THREE.Vector3(D.x,D.y,0);C.identity(),C.makeScale(.2,.2,0),q.applyMatrix4(C),C.identity(),C.makeScale(.02,.02,0),W.applyMatrix4(C),r.drawLine(z.x+2*W.x,z.y+2*W.y,A.x+2*W.x,A.y+2*W.y),x=MxThreeJS.createLine(new THREE.Vector3(z.x+3*W.x,z.y+3*W.y,0),new THREE.Vector3(o.x+.5*W.x,o.y+.5*W.y,0),S),u=MxThreeJS.createLine(new THREE.Vector3(A.x+3*W.x,A.y+3*W.y,0),new THREE.Vector3(a.x+.5*W.x,a.y+.5*W.y,0),S);{const R=new THREE.Vector3(1,0,0);let v=y.angleTo(R);const V=new THREE.Vector3(D.x,D.y,0);V.normalize();const Y=o.distanceTo(a);y.y<0?v=v<Math.PI/2?2*Math.PI-v:Math.PI-v:v>Math.PI/2&&(v=Math.PI+v);const c=r.getMxObject();c&&(v-=c.getViewAngle());const p=this.getDimText();(M=MxThreeJS.creatTextSprite(p,new THREE.Vector3(A.x+y.x/2+V.x*Y/15,A.y+y.y/2+V.y*Y/15,0),.07*Y,v,this.fontColor||S))!=null&&(M.material.opacity=this.opacity,r.drawEntity(M))}{C.identity(),C.makeScale(.08,.08,.08);const R=new THREE.Matrix4;R.makeRotationZ(17*Math.PI/18);let v=new THREE.Vector3(y.x,y.y,0);v.applyMatrix4(C),v.applyMatrix4(R),R.identity(),R.makeRotationZ(17*-Math.PI/18);let V=new THREE.Vector3(y.x,y.y,0);V.applyMatrix4(C),V.applyMatrix4(R);const Y=new Array;Y.push(new THREE.Vector3(z.x+2*W.x,z.y+2*W.y,0),new THREE.Vector3(z.x+2*W.x+v.x,z.y+v.y+2*W.y,0),new THREE.Vector3(z.x+2*W.x+V.x,z.y+V.y+2*W.y,0)),I=MxThreeJS.createTriangle(Y,S),R.identity(),R.makeRotationZ(Math.PI/18),(v=new THREE.Vector3(y.x,y.y,0)).applyMatrix4(C),v.applyMatrix4(R),R.identity(),R.makeRotationZ(-Math.PI/18),(V=new THREE.Vector3(y.x,y.y,0)).applyMatrix4(C),V.applyMatrix4(R);const c=new Array;c.push(new THREE.Vector3(A.x+2*W.x,A.y+2*W.y,0),new THREE.Vector3(A.x+v.x+2*W.x,A.y+v.y+2*W.y,0),new THREE.Vector3(A.x+V.x+2*W.x,A.y+V.y+2*W.y,0)),H=MxThreeJS.createTriangle(c,S)}r.drawEntity(x),r.drawEntity(u),I&&(_(I.material,this.opacity),r.drawEntity(I)),H&&(_(H.material,this.opacity),r.drawEntity(H)),r.drawEntity(G),r.drawEntity(L)}else r.drawLine(this.point1,this.point2)}setPoint1(r){this.point1=r}setPoint2(r){this.point2=r}setColor(r){return lodash.isArray(r)?([this.color=this.color,this.fontColor=this.fontColor||this.color]=r,console.log("this.fontColor : ",this.fontColor)):this.color=r,this}getGripPoints(){let r=[];return r.push(this.point1),r.push(this.point2),r}moveGripPointsAt(r,o){return r==0?this.point1.add(o):(r=1)&&this.point2.add(o),!0}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,propertyDbKeys$5),!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,propertyDbKeys$5),r}create(){return new MxDbAlignedDimension}}MxDbAlignedDimension.cmd="Mx_DimensionMeasurement",MxDbAlignedDimension.draw=drawMxDbAlignedDimension,addRegisterMxDbEntity(MxDbAlignedDimension);class MxDbHatch extends MxDbEntity{constructor(){super(...arguments),this.points=[]}worldDraw(r){r.getType()===McGiWorldDrawType$1.kWorldDraw?r.drawSolid(this.points):r.drawLines([...this.points,this.points[0]])}getTypeName(){return"MxDbHatch"}moveGripPointsAt(r,o){return r===0?this.points.forEach(a=>{a.add(o)}):this.points[r-1]&&this.points[r-1].add(o),!0}setPoints(r){this.points=r.map(o=>o.clone())}getGripPoints(){if(this.points.length>0){const{centerPoint:r}=computeBounding(this.points);return[r,...this.points]}return[]}dwgIn(r){this.onDwgIn(r);const o=r.points;return this.points=o.map(({x:a,y:x,z:u})=>new THREE.Vector3(a,x,u)),!0}dwgOut(r){return this.onDwgOut(r),r.points=this.points,r}}function drawMxDbArea(){const T=new MrxDbgUiPrPoint;T.setMessage(`
指定第一点:`),T.go(r=>{if(r!=0)return;const o=T.value();let a=new MxDbArea;a.addPoint(o);const x=new McEdGetPointWorldDrawObject;x.setDraw((u,M)=>{let I=a.clone();I.addPoint(u),x.drawCustomEntity(I)}),T.setUserDraw(x),T.setMessage(`
指定下一点:`),T.goWhile(u=>{if(u==0){const M=T.value();a.addPoint(M)}},u=>{a.isFill=!0,a.fillOpacity=.7,a.fillColor=6697540,MxFun.getCurrentDraw().addMxEntity(a)})})}addRegisterMxDbEntity(MxDbHatch);class MxDbArea extends MxDbEntity{constructor(){super(...arguments),this.points=[],this.isFill=!1,this.fillColor=6697540,this.fillOpacity=.7}getTypeName(){return"MxDbArea"}create(){return new MxDbArea}getDimText(){return McGeTool.calcArea(this.points).toFixed(2)}worldDraw(r){if(this.points.length<3)return void(this.points.length==2&&r.drawLine(this.points[0],this.points[1]));let o=this.points[0],a=o.clone(),x=o.clone(),u=this.points.length;for(let L=1;L<u;L++){let y=this.points[L];a.x>y.x&&(a.x=y.x),a.y>y.y&&(a.y=y.y),x.x<y.x&&(x.x=y.x),x.y<y.y&&(x.y=y.y),r.drawLine(o,y),o=y}r.drawLine(o,this.points[0]);let M=new THREE.Vector3(a.x+.5*(x.x-a.x),a.y+.5*(x.y-a.y));const I=r.getColor();let H=MxFun.screenCoordLong2Doc(20),G=MxThreeJS.creatTextSprite(this.getDimText(),M,H,0,I);if(G!=null&&r.drawEntity(G),r.getType()==McGiWorldDrawType$1.kWorldDraw&&this.isFill){r.setColor(this.fillColor),r.setOpacity(this.fillOpacity),r.setRenderOrder(r.getRenderOrder()-1);const L=new MxDbHatch;L.points=this.points,L.worldDraw(r)}}getGripPoints(){return this.points}moveGripPointsAt(r,o){return!(r>=this.points.length||(this.points[r].add(o),0))}dwgIn(r){this.onDwgIn(r);let o=r.points;return this.points=[],o.forEach(a=>{this.points.push(new THREE.Vector3(a.x,a.y,a.z))}),this.dwgInHelp(r,["isFill","fillColor","fillOpacity"]),!0}dwgOut(r){return this.onDwgOut(r),r.points=this.points,this.dwgOutHelp(r,["isFill","fillColor","fillOpacity"]),r}addPoint(r){this.points.push(r.clone())}getPoints(){return this.points}clearPoint(){this.points=[]}}async function drawMxDbLeadTag(){let r=await new MrxDbgUiPrPoint().go();if(!r)return;let o=prompt("请输入文字批注","批注");if(!o)return;const a=new MxDbLeadTag;a.point=r,a.text=o,MxFun.addToCurrentSpace(a)}MxDbArea.cmd="Mx_Area",MxDbArea.draw=drawMxDbArea,addRegisterMxDbEntity(MxDbArea);class MxDbLeadTag extends MxDbEntity{constructor(){super(...arguments),this.point=new THREE.Vector3,this.leadLen=88,this.text="",this.textHeight=24}getTypeName(){return"MxDbLeadTag"}createDots(r,o){const{x:a,y:x,z:u}=r,M=new THREE.Shape;M.arc(a,x,o.screenCoordLong2Doc(6),0,2*Math.PI,!0);const I=new THREE.Path;I.arc(a,x,o.screenCoordLong2Doc(3),0,2*Math.PI,!0),M.holes.push(I);const H=new THREE.ShapeGeometry(M),G=new THREE.MeshPhongMaterial({color:"#ff0000",transparent:!0}),L=new THREE.Shape;L.arc(a,x,o.screenCoordLong2Doc(3),0,2*Math.PI,!0);const y=new THREE.ShapeGeometry(L),D=new THREE.MeshPhongMaterial({color:"#e2da8f",transparent:!0}),C=new THREE.Mesh(H,G),B=new THREE.Mesh(y,D);return C.add(B),C}worldDraw(r){let o=r.getMxObject();const a=this.createDots(this.point,o);if(r.drawEntity(a),a.geometry.computeBoundingBox(),r.drawSelectLine(a.geometry.boundingBox.max,a.geometry.boundingBox.min),r.getType()===2)return;let x=r.getMxObject().screenCoordLong2Doc(this.leadLen),u=new THREE.Vector3(this.point.x+2*x,this.point.y+x,0);const M=u.x-x,I=new THREE.Vector3(M,u.y,u.z);r.setLineWidth(4),r.setColor(16770565),r.drawLines([this.point,I,u]);const H=r.getMxObject().screenCoordLong2Doc(this.textHeight),G=u.clone().setX(u.x);r.setColor(16744448);const L=MxThreeJS.creatTextSprite(this.text,G,H,0,r.getColor());if(L){const y=new THREE.Box3,D=new THREE.Vector3;y.expandByObject(L),y.getSize(D),L.position.setX(L.position.x+D.x/2);const C=r.getMxObject().screenCoordLong2Doc(5),B=y.min.clone().setX(y.min.x+D.x/2).setY(y.min.y-C),z=y.max.clone().setX(y.max.x+D.x/2).setY(y.min.y+C);z.setY(y.max.y+C);const A=new THREE.Vector3(B.x,z.y),S=new THREE.Vector3(z.x,B.y);r.setColor(16777215),r.setLineWidth(0),r.drawLine(B,A),r.drawLine(z,S),r.drawLine(B,S),r.drawLine(A,z);const q=C/2,W=[],_=[];W.push(new THREE.Vector3(A.x+q,A.y-C,A.z),new THREE.Vector3(A.x+q,A.y-q,A.z),new THREE.Vector3(A.x+C,A.y-q,A.z)),_.push(new THREE.Vector3(S.x-q,S.y+C,S.z),new THREE.Vector3(S.x-q,S.y+q,S.z),new THREE.Vector3(S.x-C,S.y+q,S.z)),r.drawLines(W),r.drawLines(_),r.setOpacity(.5),r.setColor(6697540),r.setRenderOrder(-100),r.drawSolid([B,A,z,S]),r.setRenderOrder(100),r.drawEntity(L)}}getGripPoints(){return[this.point]}onViewChange(){return this.setNeedUpdateDisplay(),!0}moveGripPointsAt(r,o){return r===0&&this.point.add(o),!0}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,["point","text","textHeight","leadLen"]),!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,["point","text","textHeight","leadLen"]),r}}function drawMxDbAnyLine(){const T=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject,a=new MxDbAnyLine;T.setUserDraw(o),T.setMessage(`
点击开始画线:`),T.go(x=>{x===MrxDbgUiPrBaseReturn$1.kOk&&(a.points.push(T.value()),o.setDraw(u=>{a.points.push(u.clone()),o.drawCustomEntity(a)})),T.setMessage(`
再次点击结束画线:`),T.go(u=>{u===MrxDbgUiPrBaseReturn$1.kOk&&r.addMxEntity(a)})})}MxDbLeadTag.cmd="Mx_LeadTag",MxDbLeadTag.draw=drawMxDbLeadTag,addRegisterMxDbEntity(MxDbLeadTag);const propertyDbKeys$4=["points"];class MxDbAnyLine extends MxDbEntity{constructor(){super(...arguments),this.points=[]}getTypeName(){return"MxDbAnyLine"}create(){return new MxDbAnyLine}worldDraw(r){let o=r.getMxObject();const a=new THREE.Box3().setFromPoints(this.points);let x=new THREE.Vector3;if(a.getCenter(x),r.drawLines(this.points),r.getType()===McGiWorldDrawType$1.kSelectDraw){const u=new THREE.Vector3;a.getSize(u),u.addScalar(o.screenCoordLong2Doc(20));const M=u.x/2,I=u.y/2,H={x:x.x-M,y:x.y-I},G={x:x.x+M,y:x.y-I},L={x:x.x+M,y:x.y+I},y={x:x.x-M,y:x.y+I};r.drawLine(G.x,G.y,L.x,L.y),r.drawLine(H.x,H.y,G.x,G.y),r.drawLine(L.x,L.y,y.x,y.y),r.drawLine(y.x,y.y,H.x,H.y)}}setPoints(r){return this.points=r,this}getCenter(){const r=new THREE.Geometry;r.vertices=this.points;const o=new THREE.Vector3;return r.computeBoundingBox(),r.boundingBox.getCenter(o),o}getGripPoints(){return[this.getCenter()]}moveGripPointsAt(r,o){return r===0&&this.points.forEach(a=>{a.add(o)}),!0}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,propertyDbKeys$4),!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,propertyDbKeys$4),r}}function drawMxDbCloudLine(){const T=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject;T.setMessage(`
点击开启绘制云线:`),T.go(()=>{const a=MxFun.screenCoordLong2Doc(16);let x=T.value();const u=new MxDbCloudLine;u.setRadius(a),u.addPoint(x),o.setDraw(M=>{x.distanceTo(M)>a&&(x=M.clone(),u.addPoint(M,!0)),o.drawCustomEntity(u)}),T.setUserDraw(o),T.setMessage(`
再次点击结束绘制云线:`),T.go(()=>{r.addMxEntity(u)})})}MxDbAnyLine.cmd="Mx_AnyLine",MxDbAnyLine.draw=drawMxDbAnyLine,addRegisterMxDbEntity(MxDbAnyLine);const propertyDbKeys$3=["points","radius"];class MxDbCloudLine extends MxDbEntity{constructor(){super(),this.points=[],this.radius=16,this.cachePoint=null,this.use_smallcoord_display=!0}getTypeName(){return"MxDbCloudLine"}create(){return new MxDbCloudLine}setRadius(r){this.radius=r}getRadius(){return this.radius}getCachePoint(){return this.cachePoint}clacNewArcDiameterPoint(r){if(this.points.length==0)return r;let o=this.points[this.points.length-1];const a=2*this.radius,x=o.distanceTo(r);if(x<a)return null;const u=a*(r.x-o.x)/x+o.x,M=a*(r.y-o.y)/x+o.y;return new THREE.Vector3(u,M,o.z)}createCloudArcCurvePoints(r,o,a){const x=new THREE.Vector3((r.x+o.x)/2,(r.y+o.y)/2,0);a||(a=x.distanceTo(r));const{startAngle:u,endAngle:M}=function(I,H,G){const L=2*Math.PI/360;return{startAngle:180*Math.atan2(H.y-I.y,H.x-I.x)/Math.PI*L,endAngle:180*Math.atan2(G.y-I.y,G.x-I.x)/Math.PI*L}}(x,r,o);return new THREE.ArcCurve(x.x,x.y,a,u,M,!0).getPoints(10)}addPoint(r,o){let a=this.clacNewArcDiameterPoint(r);a&&(this.points.push(a),this.cachePoint=null,o&&(this.cachePoint=this.reCalculateDrawGeometryPoint()))}addLine(r,o){this.addPoint(r);const a=2*this.radius;let x=this.points[this.points.length-1],u=x.distanceTo(o);const M=Math.round(u/a);for(let I=0;I<M;I++){u=x.distanceTo(o);const H=a*(o.x-x.x)/u+x.x,G=a*(o.y-x.y)/u+x.y;let L=new THREE.Vector3(H,G,o.z);this.addPoint(L),x=L}return this.addPoint(o),this.points[this.points.length-1]}reCalculateDrawGeometryPoint(){if(this.points.length<2)return null;let r=this.points[0],o=this.points.length,a=[];for(let x=1;x<o;x++){let u=this.points[x];this.createCloudArcCurvePoints(r,u).forEach(M=>{a.push(new THREE.Vector3(M.x,M.y,0))}),r=u}return a}worldDraw(r){if(this.cachePoint||(this.cachePoint=this.reCalculateDrawGeometryPoint()),!this.cachePoint)return;let o=r.getMxObject();if(r.getType()===McGiWorldDrawType$1.kSelectDraw){let a=new THREE.Geometry;this.cachePoint.forEach(D=>{a.vertices.push(new THREE.Vector3(D.x,D.y,0))}),a.computeBoundingBox();const x=new THREE.Vector3;a.boundingBox.getSize(x);let u=new THREE.Vector3;a.boundingBox.getCenter(u);const M=x.x/2,I=x.y/2,H={x:u.x-M,y:u.y-I},G={x:u.x+M,y:u.y-I},L={x:u.x+M,y:u.y+I},y={x:u.x-M,y:u.y+I};r.drawLine(this.toSmallcoord2(o,H.x,H.y),this.toSmallcoord2(o,G.x,G.y)),r.drawLine(this.toSmallcoord2(o,G.x,G.y),this.toSmallcoord2(o,L.x,L.y)),r.drawLine(this.toSmallcoord2(o,L.x,L.y),this.toSmallcoord2(o,y.x,y.y)),r.drawLine(this.toSmallcoord2(o,y.x,y.y),this.toSmallcoord2(o,H.x,H.y))}else{let a=[];this.cachePoint.forEach(x=>{a.push(this.toSmallcoord(o,x))}),r.drawLines(a)}}getCenter(){const r=new THREE.Geometry;r.vertices=this.points;let o=new THREE.Vector3;return r.computeBoundingBox(),r.boundingBox.getCenter(o),o}getGripPoints(){return[this.getCenter()]}moveGripPointsAt(r,o){return this.points.forEach(a=>{a.add(o)}),this.cachePoint=null,!0}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,propertyDbKeys$3),this.cachePoint=null,!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,propertyDbKeys$3),r.type===MxType.MxCloneType.kSaveDwgClone&&this.dwgOutHelp(r,["cachePoint"]),r}}function drawMxDbRegularPolygon(){const T=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject,a=new MxDbRegularPolygon;T.setMessage(`
点击开始绘制多边形:`),T.go(()=>{let x=prompt("请输入多边形的边数","8");x&&(a.sidesNumber=Number(x),a.centerPoint=T.value(),T.setUserDraw(o),o.setDraw(u=>{a.otherPoint=u,o.drawCustomEntity(a)}),T.setMessage(`
再次点击结束绘制多边形:`),T.go(()=>{r.addMxEntity(a)}))})}MxDbCloudLine.isRegister=!1,MxDbCloudLine.cmd="Mx_CloudLine",MxDbCloudLine.draw=drawMxDbCloudLine,addRegisterMxDbEntity(MxDbCloudLine);class MxDbRegularPolygon extends MxDbShape{getTypeName(){return"MxDbRegularPolygon"}constructor(){super(),this.centerPoint=new THREE.Vector3,this.otherPoint=new THREE.Vector3,this.sidesNumber=5,this._propertyDbKeys=[...this._propertyDbKeys,"centerPoint","otherPoint","sidesNumber"]}worldDraw(r){const o=computeRegularPolygonVertices(this.centerPoint,this.otherPoint,this.sidesNumber);this.closed=!1,o.push(o[0]),this._draw(r,o),this._drawStoreLine(r,o)}getGripPoints(){return[this.centerPoint,this.otherPoint]}moveGripPointsAt(r,o){return r===0?(this.centerPoint.add(o),this.otherPoint.add(o)):r===1&&this.otherPoint.add(o),!0}}function drawMxDbLeadComment(){const T=new MrxDbgUiPrPoint;T.setMessage(`
指定第一点:`),T.go(r=>{if(r!=0)return;const o=T.value();let a=new MxDbLeadComment;a.point1=o.clone(),a.textHeight=MxFun.screenCoordLong2Doc(50);let x=prompt("请输入文字批注","批注");if(!x)return;a.text=x,a.textWidth=MxFun.screenCoordLong2Doc(10*x.length),a.fixedSize=!0,a.fixedSize&&(a.textHeight=50,a.textWidth=50*x.length);const u=new McEdGetPointWorldDrawObject;u.setDraw((M,I)=>{a.point2=M,I.drawCustomEntity(a)}),T.setBasePt(o),T.setUseBasePt(!0),T.setUserDraw(u),T.setMessage(`
指定第二点:`),T.go(M=>{if(M!=0)return void console.log(M);const I=T.value();a.point2=I,MxFun.addToCurrentSpace(a)})})}MxDbRegularPolygon.cmd="Mx_RegularPolygon",MxDbRegularPolygon.draw=drawMxDbRegularPolygon,addRegisterMxDbEntity(MxDbRegularPolygon);class MxDbLeadComment extends MxDbEntity{constructor(){super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.text="",this.textHeight=20,this.textWidth=0,this.fixedSize=!1,this.use_smallcoord_display=!0}getTypeName(){return"MxDbLeadComment"}create(){return new MxDbLeadComment}worldDraw(r){let o=r.getMxObject(),a=this.toSmallcoord(o,this.point1),x=this.toSmallcoord(o,this.point2);if(r.drawLine(a,x),this.text.length>0){const u=new THREE.Vector3;let M=this.textHeight,I=this.textWidth;this.fixedSize&&(M=o.screenCoordLong2Doc(M),I=o.screenCoordLong2Doc(I));let H=MxThreeJS.clacTextSpriteSize(this.text,M,I);u.x=x.x+.5*H.textwidth,u.y=x.y+.5*H.allTextHeight,r.drawText(this.text,M,0,u,I);const G=new THREE.Vector3;G.x=x.x+H.textwidth,G.y=x.y,r.drawLine(G,x)}}getGripPoints(){let r=[];return r.push(this.point1),r.push(this.point2),r}moveGripPointsAt(r,o){return r==0?this.point1.add(o):r==1&&this.point2.add(o),!0}dwgIn(r){return this.onDwgIn(r),this.point1.copy(r.point1),this.point2.copy(r.point2),this.text=r.text.substr(0),this.textHeight=r.textHeight,r.textWidth&&(this.textWidth=r.textWidth),this.fixedSize=r.fixedSize,!0}dwgOut(r){return this.onDwgOut(r),r.point1=this.point1,r.point2=this.point2,r.textHeight=this.textHeight,r.text=this.text,r.textWidth=this.textWidth,r.fixedSize=this.fixedSize,r}onViewChange(){return!!this.fixedSize&&(this.setNeedUpdateDisplay(!1),!0)}}function drawMxDbRectBoxLeadComment(){const T=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject,a=new MxDbRectBoxLeadComment;a.setLineWidth(3),a.setLineWidthByPixels(!0),T.setMessage(`
云线框起始点:`),T.go(x=>{a.radius=MxFun.screenCoordLong2Doc(8),x==MrxDbgUiPrBaseReturn$1.kOk&&(a.point1=T.value(),o.setDraw(u=>{a.point2=u,o.drawCustomEntity(a)}),T.setUserDraw(o),T.setMessage(`
云线框结束点:`),T.go(u=>{if(u!=MrxDbgUiPrBaseReturn$1.kOk)return;a.point2=T.value(),o.setDraw(I=>{a.point3=I,o.drawCustomEntity(a)});let M=prompt("请输入文字批注","批注");M||(M="默认批注文字"),a.text=M,a.textWidth=MxFun.screenCoordLong2Doc(10*M.length),a.textHeight=MxFun.screenCoordLong2Doc(5*M.length),a.fixedSize=!0,a.fixedSize&&(a.textHeight=20,a.textWidth=20*M.length),T.setMessage(`
审图标注点:`),T.go(I=>{I==MrxDbgUiPrBaseReturn$1.kOk&&(a.point3=T.value(),r.addMxEntity(a))})}))})}MxDbLeadComment.cmd="Mx_Comment",MxDbLeadComment.draw=drawMxDbLeadComment,addRegisterMxDbEntity(MxDbLeadComment);class MxDbRectBoxLeadComment extends MxDbEntity{constructor(){super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.point3=new THREE.Vector3,this.text="",this.textHeight=20,this.radius=16,this.textWidth=0,this.fixedSize=!1,this.use_smallcoord_display=!0}getTypeName(){return"MxDbRectBoxLeadComment"}create(){return new MxDbRectBoxLeadComment}getCloudLine(){let r=new MxDbCloudLine;r.setRadius(this.radius);let o=this.point1.clone(),a=this.point2.clone();if(o.x>a.x){let H=o.x;o.x=a.x,a.x=H}if(o.y>a.y){let H=o.y;o.y=a.y,a.y=H}let x=new THREE.Vector3(o.x,a.y,o.z);x=r.addLine(o,x),a=new THREE.Vector3(a.x,x.y,a.z),a=r.addLine(x,a);let u=new THREE.Vector3(a.x,o.y,o.z);u=r.addLine(a,u);let M=o=r.addLine(u,o),I=o.distanceTo(this.point3);return I>x.distanceTo(this.point3)&&(M=x,I=x.distanceTo(this.point3)),I>a.distanceTo(this.point3)&&(M=a,I=a.distanceTo(this.point3)),I>u.distanceTo(this.point3)&&(M=u,I=u.distanceTo(this.point3)),{cloudLine:r,pt1:o,pt2:x,pt3:a,pt4:u,leadPt:M}}worldDraw(r){let o=this.getCloudLine(),a=o.cloudLine;if(a.setUseSmallcoordDisplay(this.use_smallcoord_display),a.worldDraw(r),this.text.length>0){let x=o.leadPt,u=new MxDbLeadComment;u.setUseSmallcoordDisplay(this.use_smallcoord_display),u.point1=x,u.point2=this.point3,u.text=this.text,u.textHeight=this.textHeight,u.textWidth=this.textWidth,u.fixedSize=this.fixedSize,u.worldDraw(r)}}getGripPoints(){let r=[];return r.push(this.point1),r.push(this.point2),r.push(this.point3),r}moveGripPointsAt(r,o){return r==0?this.point1.add(o):r==1?this.point2.add(o):r==2&&this.point3.add(o),!0}dwgIn(r){return this.onDwgIn(r),this.point1.copy(r.point1),this.point2.copy(r.point2),this.point3.copy(r.point3),this.text=r.text.substr(0),this.textHeight=r.textHeight,this.radius=r.radius,r.textWidth&&(this.textWidth=r.textWidth),this.fixedSize=r.fixedSize,!0}dwgOut(r){if(this.onDwgOut(r),r.point1=this.point1,r.point2=this.point2,r.point3=this.point3,r.textHeight=this.textHeight,r.text=this.text,r.radius=this.radius,r.textWidth=this.textWidth,r.fixedSize=this.fixedSize,r.type===MxType.MxCloneType.kSaveDwgClone){let o=this.getCloudLine(),a=o.cloudLine.reCalculateDrawGeometryPoint();r.cachePoint=a||[],r.leadPt=o.leadPt}return r}onViewChange(){return!!this.fixedSize&&(this.setNeedUpdateDisplay(!1),!0)}}function drawMxDbEllipse(){const T=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject,a=new MxDbEllipse;T.setMessage(`
点击开始绘制椭圆:`),T.go(()=>{a.point1=T.value(),o.setDraw(x=>{a.point2=x,o.drawCustomEntity(a)}),T.setUserDraw(o),T.setMessage(`
再次点击结束绘制椭圆:`),T.go(()=>{r.addMxEntity(a)})})}MxDbRectBoxLeadComment.cmd="Mx_CheckDraw",MxDbRectBoxLeadComment.draw=drawMxDbRectBoxLeadComment,addRegisterMxDbEntity(MxDbRectBoxLeadComment);class MxDbEllipse extends MxDbEllipseShape{constructor(){super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.isClosedToCenter=!1,this.closed=!1,this._propertyDbKeys=[...this._propertyDbKeys,"point1","point2"]}getTypeName(){return"MxDbEllipse"}create(){return new MxDbEllipse}setPoint1(r){return this.point1=r,this}setPoint2(r){return this.point2=r,this}worldDraw(r){const{point1:o,point2:a}=this,x=o.clone().set(a.x,o.y,a.z),u=a.clone().set(o.x,a.y,o.z);this.xRadius=o.distanceTo(x)/2,this.yRadius=o.distanceTo(u)/2;const M=o.x>a.x,I=o.y>a.y,H=M?o.x-this.xRadius:o.x+this.xRadius,G=I?o.y-this.yRadius:o.y+this.yRadius;this.center=new THREE.Vector3(H,G,0),this.drawEllipseShape(r),r.getType()===McGiWorldDrawType$1.kSelectDraw&&r.drawLines([o,new THREE.Vector3(o.x,a.y),a,new THREE.Vector3(a.x,o.y),o])}getGripPoints(){let r=new THREE.Vector3(.5*(this.point2.x+this.point1.x),.5*(this.point2.y+this.point1.y),0);return[this.point1,this.point2,r]}moveGripPointsAt(r,o){return r===0?this.point1.add(o):r===1?this.point2.add(o):r===2&&(this.point1.add(o),this.point2.add(o)),!0}}async function drawMxDbText(){const T=new MrxDbgUiPrPoint;T.setMessage(`
 点取文字插入点:`);let r=await T.go();if(r==null)return;let o=prompt("请输入文字");if(!o)return;let a=new MxDbText;a.position=r,a.height=MxFun.screenCoordLong2Doc(50),a.text=o,MxFun.addToCurrentSpace(a)}let _SpriteText;function getSpriteTextColor(T){return T?T instanceof THREE.Color?T.getStyle():typeof T=="number"?new THREE.Color(T).getStyle():T:"#fff"}function toCSSFont(T,r,o,a,x){let u=document.createElement("span");return u.style.font="1px serif",u.style.fontFamily=T,u.style.fontSize=`${r}px`,u.style.fontStyle=o,u.style.fontVariant=a,u.style.fontWeight=x,u.style.font}function getSpriteTextClass(){if(!_SpriteText){class T extends THREE.Sprite{constructor(o){super(new THREE.SpriteMaterial);const{text:a,textHeight:x,color:u,backgroundColor:M,padding:I,borderWidth:H,borderRadius:G,borderColor:L,strokeWidth:y,strokeColor:D,fontFace:C,fontSize:B,fontWeight:z,textAlign:A,textShadowBlur:S,textShadowColor:q,textShadowOffsetX:W,textShadowOffsetY:_,angle:R,scale:v,underline:V,fontStyle:Y,fontVariant:c}=o||{};this._text=`${a}`,this._textHeight=x||10,this._color=u,this._backgroundColor=M,this._padding=I||0,this._borderWidth=H||0,this._borderRadius=G||0,this._borderColor=L||"white",this._strokeWidth=y||0,this._strokeColor=D||"white",this._fontFace=C||"Arial",this._fontSize=B||90,this._fontWeight=(z==null?void 0:z.toString())||"normal",this._textAlign=A||"start",this._fontStyle=Y||"normal",this._fontVariant=c||"normal",this._textShadowBlur=S||0,this._textShadowColor=q,this._textShadowOffsetX=W||0,this._textShadowOffsetY=_||0,this._angle=R||0,this._textScale=v||1,this._underline=V||!1,this._canvas=document.createElement("canvas"),this._genCanvas()}get text(){return this._text}set text(o){this._text=o,this._genCanvas()}get textHeight(){return this._textHeight}set textHeight(o){this._textHeight=o,this._genCanvas()}get color(){return this._color}set color(o){this._color=o,this._genCanvas()}get backgroundColor(){return this._backgroundColor}set backgroundColor(o){this._backgroundColor=o,this._genCanvas()}get padding(){return this._padding}set padding(o){this._padding=o,this._genCanvas()}get borderWidth(){return this._borderWidth}set borderWidth(o){this._borderWidth=o,this._genCanvas()}get borderRadius(){return this._borderRadius}set borderRadius(o){this._borderRadius=o,this._genCanvas()}get borderColor(){return this._borderColor}set borderColor(o){this._borderColor=o,this._genCanvas()}get fontFace(){return this._fontFace}set fontFace(o){this._fontFace=o,this._genCanvas()}get fontSize(){return this._fontSize}set fontSize(o){this._fontSize=o,this._genCanvas()}get fontWeight(){return this._fontWeight}set fontWeight(o){this._fontWeight=o,this._genCanvas()}get strokeWidth(){return this._strokeWidth}set strokeWidth(o){this._strokeWidth=o,this._genCanvas()}get strokeColor(){return this._strokeColor}set strokeColor(o){this._strokeColor=o,this._genCanvas()}get textAlign(){return this._textAlign}set textAlign(o){this._textAlign=o,this._genCanvas()}get textShadowBlur(){return this._textShadowBlur}set textShadowBlur(o){this._textShadowBlur=o,this._genCanvas()}get textShadowColor(){return this._textShadowColor}set textShadowColor(o){this._textShadowColor=o,this._genCanvas()}get textShadowOffsetX(){return this._textShadowOffsetX}set textShadowOffsetX(o){this._textShadowOffsetX=o,this._genCanvas()}get textShadowOffsetY(){return this._textShadowOffsetY}set textShadowOffsetY(o){this._textShadowOffsetY=o,this._genCanvas()}get angle(){return this._angle}set angle(o){this._angle=o,this._genCanvas()}get textScale(){return this._textScale}set textScale(o){this._textScale=o,this._genCanvas()}get underline(){return this._underline}set underline(o){this._underline=o,this._genCanvas()}get fontStyle(){return this._fontStyle}set fontStyle(o){this._fontStyle=o,this._genCanvas()}get fontVariant(){return this._fontVariant}set fontVariant(o){this._fontVariant=o,this._genCanvas()}_genCanvas(){const o=this._canvas,a=o.getContext("2d"),x=Array.isArray(this.borderWidth)?this.borderWidth:[this.borderWidth,this.borderWidth],u=x.map(_=>_*this.fontSize*.1),M=(Array.isArray(this.borderRadius)?this.borderRadius:[this.borderRadius,this.borderRadius,this.borderRadius,this.borderRadius]).map(_=>_*this.fontSize*.1),I=Array.isArray(this.padding)?this.padding:[this.padding,this.padding],H=I.map(_=>_*this.fontSize*.1),G=this.text.split(`
`),L=this.font;a.font=L;const y=Math.max(...G.map(_=>a.measureText(_).width)),D=4*this.strokeWidth+(this.underline?this.fontSize/15*4:this.fontSize/15),C=(this.fontSize+D)*G.length;if(o.width=y+2*u[0]+2*H[0],o.height=C+2*u[1]+2*H[1],this.borderWidth){if(a.strokeStyle=getSpriteTextColor(this.borderColor),u[0]){const _=u[0]/2;a.lineWidth=u[0],a.beginPath(),a.moveTo(_,M[0]),a.lineTo(_,o.height-M[3]),a.moveTo(o.width-_,M[1]),a.lineTo(o.width-_,o.height-M[2]),a.stroke()}if(u[1]){const _=u[1]/2;a.lineWidth=u[1],a.beginPath(),a.moveTo(Math.max(u[0],M[0]),_),a.lineTo(o.width-Math.max(u[0],M[1]),_),a.moveTo(Math.max(u[0],M[3]),o.height-_),a.lineTo(o.width-Math.max(u[0],M[2]),o.height-_),a.stroke()}if(this.borderRadius){const _=Math.max(...u),R=_/2;a.lineWidth=_,a.beginPath(),[!!M[0]&&[M[0],R,R,M[0]],!!M[1]&&[o.width-M[1],o.width-R,R,M[1]],!!M[2]&&[o.width-M[2],o.width-R,o.height-R,o.height-M[2]],!!M[3]&&[M[3],R,o.height-R,o.height-M[3]]].filter(v=>v).forEach(v=>{const[V,Y,c,p]=v;a.moveTo(V,c),a.quadraticCurveTo(Y,c,Y,p)}),a.stroke()}}this.backgroundColor&&(a.fillStyle=getSpriteTextColor(this.backgroundColor),this.borderRadius?(a.beginPath(),a.moveTo(u[0],M[0]),[[u[0],M[0],o.width-M[1],u[1],u[1],u[1]],[o.width-u[0],o.width-u[0],o.width-u[0],u[1],M[1],o.height-M[2]],[o.width-u[0],o.width-M[2],M[3],o.height-u[1],o.height-u[1],o.height-u[1]],[u[0],u[0],u[0],o.height-u[1],o.height-M[3],M[0]]].forEach(([_,R,v,V,Y,c])=>{a.quadraticCurveTo(_,V,R,Y),a.lineTo(v,c)}),a.closePath(),a.fill()):a.fillRect(u[0],u[1],o.width-2*u[0],o.height-2*u[1])),a.translate(u[0],u[1]),a.translate(H[0],H[1]),a.font=L,a.fillStyle=getSpriteTextColor(this.color),a.textBaseline="bottom",a.shadowBlur=this.textShadowBlur,a.shadowColor=new THREE.Color(this.textShadowColor).getStyle(),a.shadowOffsetX=this.textShadowOffsetX,a.shadowOffsetY=this.textShadowOffsetY;const B=this.strokeWidth>0;B&&(a.lineWidth=this.strokeWidth*this.fontSize/10,a.strokeStyle=getSpriteTextColor(this.strokeColor));const z=this.textAlign==="center",A=this.textAlign==="start"||this.textAlign==="left";G.forEach(async(_,R)=>{let v=z?2:1;const V=a.measureText(_).width,Y=A?0:(y-V)/v,c=(R+1)*(this.fontSize+D);B&&a.strokeText(_,Y,c),a.fillText(_,Y,c),this.underline&&a.fillRect(Y,o.height-this.fontSize/25,V,this.fontSize/25)}),this.material.map&&this.material.map.dispose();const S=this.material.map=new THREE.Texture(o);S.minFilter=THREE.LinearFilter,S.needsUpdate=!0;const q=this.textHeight*G.length+2*x[1]+2*I[1],W=q*o.width/o.height;this.scale.set(W,q,this.scale.z),this.material.rotation=this.angle,this.scale.applyMatrix4(new THREE.Matrix4().makeScale(this.textScale,this.textScale,1))}clone(){return new this.constructor(this.text,this.textHeight,this.color).copy(THREE.Sprite.prototype.clone.call(this))}copy(o){return THREE.Sprite.prototype.copy.call(this,o),this.color=o.color,this.backgroundColor=o.backgroundColor,this.padding=o.padding,this.borderWidth=o.borderWidth,this.borderColor=o.borderColor,this.fontFace=o.fontFace,this.fontSize=o.fontSize,this.fontWeight=o.fontWeight,this.strokeWidth=o.strokeWidth,this.strokeColor=o.strokeColor,this.textAlign=o.textAlign,this.textShadowBlur=o.textShadowBlur,this.textShadowColor=o.textShadowColor,this.textShadowOffsetX=o.textShadowOffsetX,this.textShadowOffsetY=o.textShadowOffsetY,this.angle=o.angle,this.textScale=o.textScale,this}get font(){return toCSSFont(this.fontFace,this.fontSize,this.fontStyle,this.fontVariant,this.fontWeight)}checkFontFace(){try{const{fontFace:o}=this;return document.fonts.check(o)}catch{}return!0}async loadFontFace(){try{const{fontFace:o}=this;await document.fonts.load(o)}catch{}}dispose(){var o;(o=this.material.map)===null||o===void 0||o.dispose(),this.material.dispose(),this.geometry.dispose(),this.dispatchEvent({type:"dispose"})}}_SpriteText=T}return _SpriteText}MxDbEllipse.cmd="Mx_Ellipse",MxDbEllipse.draw=drawMxDbEllipse,addRegisterMxDbEntity(MxDbEllipse);const propertyDbKeys$2=["text","position","height","backgroundColor","padding","borderWidth","borderRadius","borderColor","fontFace","fontSize","fontWeight","strokeWidth","strokeColor","angle","textAlign","textShadowBlur","textShadowColor","textShadowOffsetX","textShadowOffsetY","scale","underline"];class MxDbText extends MxDbEntity{constructor(){super(...arguments),this.position=new THREE.Vector3,this._text="",this._height=16,this._angle=0,this._scale=1,this._underline=!1}setPosition(r){return this.position=r,this}get text(){return this.spriteText?this.spriteText.text:this._text}set text(r){this.spriteText?this.spriteText.text=r:this._text=r}setText(r){return this.text=r,this}get height(){return this.spriteText?this.spriteText.textHeight:this._height}set height(r){this.spriteText?this.spriteText.textHeight=r:this._height=r}setHeight(r){return this.height=r,this}get backgroundColor(){return this.spriteText?this.spriteText.backgroundColor:this._backgroundColor}set backgroundColor(r){this.spriteText?this.spriteText.backgroundColor=r:this._backgroundColor=r}setBackgroundColor(r){return this.backgroundColor=r,this}get padding(){return this.spriteText?this.spriteText.padding:this._padding}set padding(r){this.spriteText?this.spriteText.padding=r:this._padding=r}setPadding(r){return this.padding=r,this}get borderWidth(){return this.spriteText?this.spriteText.borderWidth:this._borderWidth}set borderWidth(r){this.spriteText?this.spriteText.borderWidth=r:this._borderWidth=r}setBorderWidth(r){return this.borderWidth=r,this}get borderRadius(){return this.spriteText?this.spriteText.borderRadius:this._borderRadius}set borderRadius(r){this.spriteText?this.spriteText.borderRadius=r:this._borderRadius=r}setBorderRadius(r){return this.borderRadius=r,this}get borderColor(){return this.spriteText?this.spriteText.borderColor:this._borderColor}set borderColor(r){this.spriteText?this.spriteText.borderColor=r:this._borderColor=r}setBorderColor(r){return this.borderColor=r,this}get fontFace(){return this.spriteText?this.spriteText.fontFace:this._fontFace}set fontFace(r){this.spriteText?this.spriteText.fontFace=r:this._fontFace=r}setFontFace(r){return this.fontFace=r,this}get fontSize(){return this.spriteText?this.spriteText.fontSize:this._fontSize}set fontSize(r){this.spriteText?this.spriteText.fontSize=r:this._fontSize=r}setFontSize(r){return this.fontSize=r,this}get fontWeight(){return this.spriteText?this.spriteText.fontWeight:this._fontWeight}set fontWeight(r){this.spriteText?this.spriteText.fontWeight=r:this._fontWeight=r}setFontWeight(r){return this.fontWeight=r,this}get strokeWidth(){return this.spriteText?this.spriteText.strokeWidth:this._strokeWidth}set strokeWidth(r){this.spriteText?this.spriteText.strokeWidth=r:this._strokeWidth=r}setStrokeWidth(r){return this.strokeWidth=r,this}get strokeColor(){return this.spriteText?this.spriteText.strokeColor:this._strokeColor}set strokeColor(r){this.spriteText?this.spriteText.strokeColor=r:this._strokeColor=r}setStrokeColor(r){return this.strokeColor=r,this}get textAlign(){return this.spriteText?this.spriteText.textAlign:this._textAlign}set textAlign(r){this.spriteText?this.spriteText.textAlign=r:this._textAlign=r}setTextAlign(r){return this.textAlign=r,this}get textShadowBlur(){return this.spriteText?this.spriteText.textShadowBlur:this._textShadowBlur}set textShadowBlur(r){this.spriteText?this.spriteText.textShadowBlur=r:this._textShadowBlur=r}setTextShadowBlur(r){return this.textShadowBlur=r,this}get textShadowColor(){return this.spriteText?this.spriteText.textShadowColor:this._textShadowColor}set textShadowColor(r){this.spriteText?this.spriteText.textShadowColor=r:this._textShadowColor=r}setTextShadowColor(r){return this.textShadowColor=r,this}get textShadowOffsetX(){return this.spriteText?this.spriteText.textShadowOffsetX:this._textShadowOffsetX}set textShadowOffsetX(r){this.spriteText?this.spriteText.textShadowOffsetX=r:this._textShadowOffsetX=r}setTextShadowOffsetX(r){return this.textShadowOffsetX=r,this}get textShadowOffsetY(){return this.spriteText?this.spriteText.textShadowOffsetY:this._textShadowOffsetY}set textShadowOffsetY(r){this.spriteText?this.spriteText.textShadowOffsetY=r:this._textShadowOffsetY=r}setTextShadowOffsetY(r){return this.textShadowOffsetY=r,this}get angle(){return this.spriteText?this.spriteText.angle:this._angle}set angle(r){this.spriteText?this.spriteText.angle=r:this._angle=r}setAngle(r){return this.angle=r,this}get scale(){return this.spriteText?this.spriteText.textScale:this._scale}set scale(r){this.spriteText?this.spriteText.textScale=r:this._scale=r}setScale(r){return this.scale=r,this}get underline(){return this.spriteText?this.spriteText.underline:this._underline}set underline(r){this.spriteText?this.spriteText.underline=r:this._underline=r}setUnderline(r){this.underline=r}getTypeName(){return"MxDbText"}worldDraw(r){if(this.text.length>0){r.getType()!==McGiWorldDrawType$1.kWorldDraw||this.spriteText||this.createSpriteText(),this.color!==this.spriteText.color&&(this.spriteText.color=this.color),this.spriteText.material.setValues({opacity:this.opacity,visible:this.visible});const{x:o,y:a,z:x}=this.position;this.spriteText.position.set(o,a,x),r.drawEntity(this.spriteText)}}createSpriteText(){const r=getSpriteTextClass(),{text:o,height:a,color:x,backgroundColor:u,padding:M,borderWidth:I,borderRadius:H,borderColor:G,strokeWidth:L,strokeColor:y,fontFace:D,fontSize:C,fontWeight:B,textAlign:z,textShadowBlur:A,textShadowColor:S,textShadowOffsetX:q,textShadowOffsetY:W,angle:_,scale:R,underline:v}=this;this.spriteText=new r({text:o,textHeight:a,color:x,backgroundColor:u,padding:M,borderWidth:I,borderRadius:H,borderColor:G,strokeWidth:L,strokeColor:y,fontFace:D,fontSize:C,fontWeight:B,textAlign:z,textShadowBlur:A,textShadowColor:S,textShadowOffsetX:q,textShadowOffsetY:W,angle:_,scale:R,underline:v})}getGripPoints(){return[this.position]}moveGripPointsAt(r,o){return r===0&&this.position.add(o),!0}create(){return new MxDbText}dwgIn(r){var o,a;return this.onDwgIn(r),this.dwgInHelp(r,propertyDbKeys$2),typeof r.path=="string"&&(r.path=JSON.parse(r.path)),((a=(o=r==null?void 0:r.path)===null||o===void 0?void 0:o.metadata)===null||a===void 0?void 0:a.generator)==="Curve.toJSON"&&(r.path=new THREE.Path().fromJSON(r.path)),r.type===MxType.MxCloneType.kMxFileClone||r.type===MxType.MxCloneType.kSaveDwgClone?this.createSpriteText():this.spriteText=r.spriteText,!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,propertyDbKeys$2),r.type===MxType.MxCloneType.kMxFileClone||r.type===MxType.MxCloneType.kSaveDwgClone?r.spriteText=void 0:r.spriteText=this.spriteText,r}getGeomExtents(){return new THREE.Box3().expandByObject(this.spriteText)}erase(){return super.erase(),this.spriteText&&this.spriteText.dispose(),!0}}function createCurvePath(T=!1){const r=new THREE.CurvePath;return r.autoClose=T,r}function createQuadraticBezierCurve3(T){let r=0,o=[];for(let a=0;a<T.length;a++){const x=T[r],u=T[++r]||x,M=T[++r]||u;if(!x||!u||!M)break;o.push(new THREE.QuadraticBezierCurve3(x,u,M))}return o}function createCubicBezierCurve3(T){let r=0,o=[];for(let a=0;a<T.length;a++){const x=T[r],u=T[++r]||x,M=T[++r]||u,I=T[++r]||M;if(!(x&&u&&M&&I))break;o.push(new THREE.CubicBezierCurve3(x,u,M,I))}return o}function getCurveColorGradientData(T,r){let o=0,a=[],x=[];const u=Number((1/r.length).toFixed(2));let M=new THREE.Color(r[o]),I=new THREE.Color(r[o+1]);for(let H=0,G=T.length;H<G;H++){const L=T[H],y=H/T.length;y/o>=u&&(o++,I.set(new THREE.Color(r[o]||r[--o]))),a.push(L.x,L.y,L.z||0),M.lerpHSL(I,y),x.push(M.r,M.g,M.b)}return[a,x]}function getColorGradientData(T,r){let o=[],a=[];for(let x=0,u=T.length;x<u;x++){const M=T[x];o.push(M.x,M.y,M.z||0);const I=new THREE.Color(r[x]);a.push(I.r,I.g,I.b)}return[o,a]}MxDbText.cmd="Mx_Text",MxDbText.draw=drawMxDbText,addRegisterMxDbEntity(MxDbText);const propertyDbKeys$1=["points","colors","linecap","linejoin","closed","curveType","tension","bezierType"];class MxDbGradientLine extends MxDbEntity{constructor(){super(...arguments),this.linecap="round",this.linejoin="round",this.closed=!1,this.curveType="centripetal",this.tension=0,this.bezierType="quadratic"}create(){return new MxDbGradientLine}getTypeName(){return"MxDbGradientLine"}setPoints(r){return this.points=r,this}setColors(r){return this.colors=r,this}addColor(r){return this.colors.push(r),this}setLinecap(r){this.linecap=r}setClosed(r){this.closed=r}setCurveType(r){this.curveType=r}setTension(r){this.tension=r}setBezierType(r){this.bezierType=r}worldDraw(r){const o=r.getType();let a=this.getPoints();const{closed:x,curveType:u,tension:M,bezierType:I}=this,H=new THREE.BufferGeometry;let G=[],L=[];const y=I==="cubic",D=I==="quadratic";M!==0?this.curve=new THREE.CatmullRomCurve3(a,x,u,M):I?(this.curve=createCurvePath(x),y?this.curve.curves=createCubicBezierCurve3(a):D?this.curve.curves=createQuadraticBezierCurve3(a):this.curve=void 0):this.curve=void 0,this.curve&&(a=this.curve.getPoints(50));const{linecap:C,linejoin:B}=this;let z;if(this.colors&&this.colors.length>1){const S=x?[...this.colors,this.colors[0]]:this.colors;[G,L]=this.curve?getCurveColorGradientData(a,S):getColorGradientData(a,S),H.setAttribute("position",new THREE.Float32BufferAttribute(G,3)),H.setAttribute("color",new THREE.Float32BufferAttribute(L,3)),z=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linecap:C,linejoin:B})}else H.setFromPoints(a),z=new THREE.LineBasicMaterial({color:this.color,linecap:C,linejoin:B});const A=x?new THREE.LineLoop(H,z):new THREE.Line(H,z);if(r.drawEntity(A),(o===McGiWorldDrawType$1.kSelectDraw||o===McGiWorldDrawType$1.kDynDragDraw)&&this.curve){let S=this.getPoints();const q=r.getLineWidth();r.setLineWidth(1),r.drawLines(S),r.setLineWidth(q)}}getGripPoints(){return this.getPoints()}getPoints(){return this.closed?[...this.points,this.points[0]]:this.points}moveGripPointsAt(r,o){return this.move(r,o),!0}move(r,o){return this.points[r].add(o),this}dwgIn(r){return this.dwgInHelp(r,propertyDbKeys$1),this.curve=r.curve,!0}dwgOut(r){return this.dwgOutHelp(r,propertyDbKeys$1),r.curve=this.curve,r}}function drawMxDbEllipseArc(){const T=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject;let a=new MxDbEllipseArc;T.setUserDraw(o),T.go(async()=>{a.center=T.value(),o.setDraw((x,u)=>{a.startPoint=x,a.yRadius=a.center.distanceTo(x),u.drawCustomEntity(a)}),a.startPoint=await T.go()||new THREE.Vector3,o.setDraw((x,u)=>{a.endPoint=x,u.drawCustomEntity(a)}),a.endPoint=await T.go()||new THREE.Vector3,r.addMxEntity(a)})}addRegisterMxDbEntity(MxDbGradientLine);class MxDbEllipseArc extends MxDbEllipseShape{getTypeName(){return"MxDbEllipseArc"}constructor(){super(),this._propertyDbKeys=[...this._propertyDbKeys,"startPoint","endPoint"]}setStartPoint(r){return this.startPoint=r,this}setEndPoint(r){return this.endPoint=r,this}worldDraw(r){let{center:o,startPoint:a,endPoint:x}=this;a&&(this.xRadius=o.distanceTo(a),this.startAngle=THREE.MathUtils.degToRad(calculateArcAngle(a,o,this.xRadius).angle)),x&&(this.yRadius=o.distanceTo(x),this.endAngle=THREE.MathUtils.degToRad(calculateArcAngle(x,o,this.yRadius).angle)),this.drawEllipseShape(r)}getGripPoints(){return[this.center,this.startPoint,this.endPoint]}moveGripPointsAt(r,o){return r===0&&(this.center.add(o),this.startPoint.add(o),this.endPoint.add(o)),r===1&&this.startPoint.add(o),r===2&&this.endPoint.add(o),!0}}function drawMxDbCircleArc(){const T=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject;let a=new MxDbCircleArc;a.stroke="#ff0000",T.setUserDraw(o),T.setMessage(`
确定圆弧中点:`),T.go(async()=>{a.center=T.value(),o.setDraw(x=>{o.drawLine(a.center,x)}),T.setMessage(`
确定圆弧开始点:`),a.startPoint=await T.go()||new THREE.Vector3,o.setDraw(x=>{a.endPoint=x,o.drawCustomEntity(a)}),T.setMessage(`
确定圆弧结束点:`),a.endPoint=await T.go()||new THREE.Vector3,o.setDraw(()=>{}),r.addMxEntity(a)})}MxDbEllipseArc.cmd="Mx_MxDbEllipseArc",MxDbEllipseArc.draw=drawMxDbEllipseArc,addRegisterMxDbEntity(MxDbEllipseArc);class MxDbCircleArc extends MxDbCircleShape{constructor(){super(),this._propertyDbKeys=[...this._propertyDbKeys,"startPoint","endPoint"]}getTypeName(){return"MxDbCircleArc"}setStartPoint(r){return this.startPoint=r,this}setEndPoint(r){return this.endPoint=r,this}worldDraw(r){let{startPoint:o,endPoint:a}=this;if(o&&(this.startAngle=this.computePointAngle(o)),a&&(this.endAngle=this.computePointAngle(a)),o&&a){const{points:x}=this.drawEllipseShape(r);this.startPoint=x[0]}}computePointAngle(r){return this.radius=this.center.distanceTo(r),THREE.MathUtils.degToRad(calculateArcAngle(r,this.center,this.radius).angle)}getGripPoints(){return[this.center,this.startPoint,this.endPoint]}moveGripPointsAt(r,o){return r===0?(this.center.add(o),this.startPoint.add(o),this.endPoint.add(o)):r===1?this.startPoint.add(o):r===2&&this.endPoint.add(o),!0}}MxDbCircleArc.cmd="Mx_MxDbCircleArc",MxDbCircleArc.draw=drawMxDbCircleArc,addRegisterMxDbEntity(MxDbCircleArc);class MxDbArcShape extends MxDbCircleArc{constructor(){super(),this.center=new THREE.Vector3,this.innerRadius=10,this.outerRadius=20,this._propertyDbKeys=[...this._propertyDbKeys,"center","innerRadius","outerRadius"]}getTypeName(){return"MxDbArcShape"}worldDraw(r){r.getType()===McGiWorldDrawType$1.kDynDragDraw?(r.drawCircle(this.center,this.innerRadius),r.drawCircle(this.center,this.outerRadius)):this.drawArcShape(r)}drawArcShape(r){const{center:o,startAngle:a,endAngle:x,clockwise:u}=this,{x:M,y:I}=o;this.isClosedToCenter=!1;const H=this.createEllipseCurve(M,I,this.innerRadius,this.innerRadius,a,x,u),G=this.createEllipseCurve(M,I,this.outerRadius,this.outerRadius,x,a,!u),L=this.createPaths([H,G]);let y=this.getShapePoints(L);this._draw(r,y),this._drawStoreLine(r,y)}getGripPoints(){return[this.center]}moveGripPointsAt(r,o){return r===0&&this.center.add(o),!0}}function drawMxDbArcShape(){const T=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject;let a=new MxDbArcShapeDraw;T.setMessage(`
确定圆弧中点:`),T.setUserDraw(o),T.go(async()=>{T.setMessage(`
确定圆弧开始点:`),a.center=T.value(),o.setDraw(x=>{a.interRadiusPoint=x,o.drawCircle(a.center,x.distanceTo(a.center))}),a.interRadiusPoint=await T.go()||new THREE.Vector3,o.setDraw(x=>{a.outerRadiusPoint=x,o.drawCustomEntity(a)}),a.outerRadiusPoint=await T.go()||new THREE.Vector3,r.addMxEntity(a)})}class MxDbArcShapeDraw extends MxDbArcShape{getTypeName(){return"MxDbArcShapeDraw"}constructor(){super(),this.outerRadiusPoint=new THREE.Vector3,this.interRadiusPoint=new THREE.Vector3,this._propertyDbKeys=[...this._propertyDbKeys,"interRadiusPoint","outerRadiusPoint"]}worldDraw(r){this.innerRadius=this.center.distanceTo(this.interRadiusPoint),this.outerRadius=this.center.distanceTo(this.outerRadiusPoint),this.startAngle=THREE.MathUtils.degToRad(calculateArcAngle(this.interRadiusPoint,this.center,this.innerRadius).angle),this.endAngle=THREE.MathUtils.degToRad(calculateArcAngle(this.outerRadiusPoint,this.center,this.outerRadius).angle),this.drawArcShape(r)}getGripPoints(){return[this.center,this.interRadiusPoint,this.outerRadiusPoint]}moveGripPointsAt(r,o){return r===0&&(this.center.add(o),this.interRadiusPoint.add(o),this.outerRadiusPoint.add(o)),r===1&&this.interRadiusPoint.add(o),r===2&&this.outerRadiusPoint.add(o),!0}}function drawMxDbRingShape(){const T=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject;T.setUserDraw(o);const a=new McEdGetPointWorldDrawObject,x=new MxDbRingShapeDraw;T.setUserDraw(a),T.setMessage(`
确定圆弧开始点:`),T.go(async u=>{console.log(123),x.center=T.value(),a.setDraw(M=>{a.drawCircle(x.center,x.center.distanceTo(M))}),x.innerPoint=await T.go()||new THREE.Vector3,a.setDraw(M=>{x.outerPoint=M,a.drawCustomEntity(x)}),x.outerPoint=await T.go()||new THREE.Vector3,r.addMxEntity(x)})}MxDbArcShapeDraw.isRegister=!1,MxDbArcShapeDraw.cmd="Mx_MxDbArcShape",MxDbArcShapeDraw.draw=drawMxDbArcShape,addRegisterMxDbEntity(MxDbArcShapeDraw);class MxDbRingShape extends MxDbArcShape{getTypeName(){return"MxDbRingShape"}worldDraw(r){const{center:o,startAngle:a,endAngle:x,clockwise:u}=this,{x:M,y:I}=o;this.isClosedToCenter=!1;const H=this.createEllipseCurve(M,I,this.innerRadius,this.innerRadius,a,x,u),G=this.createEllipseCurve(M,I,this.outerRadius,this.outerRadius,a,x,!u),L=this.createPaths([H,G]);let y=this.getShapePoints(L);const D=this.createPaths(H);let C=this.getShapePoints(D);const B=this.createPaths(G);let z=this.getShapePoints(B);this.isFill?(this._draw(r,y),this._drawStoreLine(r,C),this._drawStoreLine(r,z)):(this._draw(r,C),this._drawStoreLine(r,C),this._draw(r,z),this._drawStoreLine(r,z))}}MxDbRingShape.isRegister=!1,MxDbRingShape.cmd="Mx_MxDbRingShape",MxDbRingShape.draw=drawMxDbRingShape;class MxDbRingShapeDraw extends MxDbRingShape{constructor(){super(),this.innerPoint=new THREE.Vector3,this.outerPoint=new THREE.Vector3,this._propertyDbKeys=[...this._propertyDbKeys,"innerPoint","outerPoint"]}getGripPoints(){return[this.center,this.innerPoint,this.outerPoint]}moveGripPointsAt(r,o){return r===0&&(this.center.add(o),this.innerPoint.add(o),this.outerPoint.add(o)),r===1&&this.innerPoint.add(o),r===2&&this.outerPoint.add(o),!0}worldDraw(r){this.innerPoint&&(this.innerRadius=this.center.distanceTo(this.innerPoint)),this.outerPoint&&(this.outerRadius=this.center.distanceTo(this.outerPoint)),super.worldDraw(r)}}function drawMxDbStarShape(){const T=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject;T.setUserDraw(o);const a=new McEdGetPointWorldDrawObject,x=new MxDbStarShapeDraw;T.setUserDraw(a),T.setMessage(`
确定圆弧开始点:`),T.go(async u=>{x.center=T.value(),a.setDraw(M=>{x.innerPoint=M,a.drawCircle(x.center,x.center.distanceTo(M))}),x.innerPoint=await T.go()||new THREE.Vector3,a.setDraw(M=>{x.outerPoint=M,a.drawCustomEntity(x)}),x.outerPoint=await T.go()||new THREE.Vector3,r.addMxEntity(x)})}addRegisterMxDbEntity(MxDbRingShape);class MxDbStarShape extends MxDbShape{getTypeName(){return"MxDbStarShape"}constructor(){super(),this.center=new THREE.Vector3,this.numPoints=10,this.innerRadius=10,this.outerRadius=10,this._propertyDbKeys=[...this._propertyDbKeys,"center","numPoints","innerRadius","outerRadius"]}worldDraw(r){const{x:o,y:a}=this.center,x=new THREE.Path;x.moveTo(o,a-this.outerRadius);for(let I=1;I<2*this.numPoints;I++){const H=I%2==0?this.outerRadius:this.innerRadius,G=H*Math.sin(I*Math.PI/this.numPoints)+o,L=-1*H*Math.cos(I*Math.PI/this.numPoints)+a;x.lineTo(G,L)}x.closePath();const u=this.createPaths(x),M=this.getShapePoints(u);this._draw(r,M),this._drawStoreLine(r,M)}getGripPoints(){return[this.center]}moveGripPointsAt(r,o){return r===0&&this.center.add(o),!0}}MxDbStarShape.cmd="Mx_MxDbStarShape",MxDbStarShape.draw=drawMxDbStarShape;class MxDbStarShapeDraw extends MxDbStarShape{constructor(){super(),this.innerPoint=new THREE.Vector3,this.outerPoint=new THREE.Vector3,this._propertyDbKeys=[...this._propertyDbKeys,"innerPoint","outerPoint"]}getGripPoints(){return[this.center,this.innerPoint,this.outerPoint]}moveGripPointsAt(r,o){return r===0&&(this.center.add(o),this.innerPoint.add(o),this.outerPoint.add(o)),r===1&&this.innerPoint.add(o),r===2&&this.outerPoint.add(o),!0}worldDraw(r){this.innerPoint&&(this.innerRadius=this.center.distanceTo(this.innerPoint)),this.outerPoint&&(this.outerRadius=this.center.distanceTo(this.outerPoint)),super.worldDraw(r)}}addRegisterMxDbEntity(MxDbStarShape);class MxDbRegularPolygonShape extends MxDbShape{getTypeName(){return"MxDbRegularPolygonShape"}constructor(){super(),this.center=new THREE.Vector3,this.sidesNumber=6,this.radius=70,this._propertyDbKeys=[...this._propertyDbKeys,"center","sidesNumber","radius"]}worldDraw(r){this._drawPolygonShape(r)}_drawPolygonShape(r){const o=this._getPoints(),a=new THREE.Path;a.moveTo(o[0].x,o[0].y);for(let M=0;M<o.length;M++)a.lineTo(o[M].x,o[M].y);a.closePath();const x=this.createPaths(a),u=this.getShapePoints(x);this._draw(r,u),this._drawStoreLine(r,u)}_getPoints(){const{sidesNumber:r,radius:o}=this,{x:a,y:x}=this.center,u=[];for(let M=0;M<r;M++)u.push({x:o*Math.sin(2*M*Math.PI/r)+a,y:-1*o*Math.cos(2*M*Math.PI/r)+x});return u}getGripPoints(){return[this.center]}moveGripPointsAt(r,o){return r===0&&this.center.add(o),!0}}function getScreenPixel(T,r){let o=MxFun.screenCoordLong2World(r?T:T-T/3);return o=MxFun.worldCoordLong2Doc(o)}function drawMxDbArrow(){const T=new McEdGetPointWorldDrawObject,r=new MxDbArrow,o=MxFun.getCurrentDraw(),a=new MrxDbgUiPrPoint;a.setUserDraw(T),r.setLineWidth(10),a.go(()=>{r.innerOffset=getScreenPixel(10),r.outerOffset=getScreenPixel(22),r.topOffset=getScreenPixel(36),r.startPoint=a.value(),T.setDraw(x=>{r.endPoint=x,T.drawCustomEntity(r)}),a.go(async x=>{r.endPoint=a.value(),o.addMxEntity(r)})})}addRegisterMxDbEntity(MxDbRegularPolygonShape);class MxDbArrow extends MxDbShape{constructor(){super(),this.isSharpCorner=!1,this.innerOffset=10,this.outerOffset=22,this.topOffset=36,this.startPoint=new THREE.Vector3,this.endPoint=new THREE.Vector3,this._propertyDbKeys=[...this._propertyDbKeys,"outerOffset","topOffset","innerOffset","isSharpCorner","startPoint","endPoint"]}worldDraw(r){const o=this.getArrowVertex(this.startPoint,this.endPoint);o&&(this._draw(r,o),this._drawStoreLine(r,o))}getArrowVertex(r,o,a=this.isSharpCorner){let{innerOffset:x,topOffset:u,outerOffset:M}=this;const I=[];I[3]=o;const H=Math.sqrt((r.x-o.x)*(r.x-o.x)+(r.y-o.y)*(r.y-o.y));if(H===0)return;const G=-(o.x-r.x)/H,L=(o.y-r.y)/H,y=r.x+x,D=r.y+H-u,C=r.x+M,B=r.y+H-u,z=r.x-x,A=r.y+H-u,S=r.x-M,q=r.y+H-u;return a?(I[0]=r,I[6]=I[0]):(I[0]=new THREE.Vector3(r.x-(z-r.x)*L,r.y-(z-r.x)*G),I[6]=new THREE.Vector3(r.x+(z-r.x)*L,r.y+(z-r.x)*G),I[7]=I[0]),I[1]=new THREE.Vector3(r.x+(y-r.x)*L-(D-r.y)*G,r.y+(y-r.x)*G+(D-r.y)*L),I[2]=new THREE.Vector3(r.x+(C-r.x)*L-(B-r.y)*G,r.y+(C-r.x)*G+(B-r.y)*L),I[4]=new THREE.Vector3(r.x+(S-r.x)*L-(q-r.y)*G,r.y+(S-r.x)*G+(q-r.y)*L),I[5]=new THREE.Vector3(r.x+(z-r.x)*L-(A-r.y)*G,r.y+(z-r.x)*G+(A-r.y)*L),I}getGripPoints(){const r=new THREE.Vector3;return new THREE.Line3(this.startPoint,this.endPoint).getCenter(r),[this.startPoint,r,this.endPoint]}moveGripPointsAt(r,o){return r===0&&this.startPoint.add(o),r===1&&(this.startPoint.add(o),this.endPoint.add(o)),r===2&&this.endPoint.add(o),!0}getCornerRadiusPoints(r){return r}}MxDbArrow.cmd="Mx_MxDbArrow",MxDbArrow.draw=drawMxDbArrow,addRegisterMxDbEntity(MxDbArrow);class MxDbLineShape extends MxDbShape{setPoints(r){return this.points=r,this}addPoint(r){return this.points.push(r),this}removePoint(r){return this.points.splice(r,1),this}constructor(){super(),this.points=[],this._propertyDbKeys=[...this._propertyDbKeys,"points"]}getTypeName(){return"MxDbLineShape"}worldDraw(r){this._draw(r,this.points),this._drawStoreLine(r,this.points)}getGripPoints(){return this.points}moveGripPointsAt(r,o){return this.points[r].add(o),!0}getGeomExtents(){return new THREE.Box3().setFromPoints(this.points)}getGetLength(){let r=0;for(let o=0;o++;o<this.points.length)this.points[o+1]&&(r+=this.points[o].distanceTo(this.points[o+1]));return r}}async function drawMxDbSplineCurve(){const T=new MrxDbgUiPrPoint,r=new MxDbSplineCurve;T.setMessage(`
指定第一个点:`),T.goWhile(async o=>{if(o===MrxDbgUiPrBaseReturn$1.kOk)r.points.push(T.value()),T.setUserDraw((a,x)=>{const u=r.clone();u.points.push(a),x.drawCustomEntity(u),r.points.length===0?T.setMessage(`
指定第一个点:`):(T.setMessage(`
指定下一个点:`),T.setKeyWords("[闭合(C)/ 放弃(U)]"))});else if(o===MrxDbgUiPrBaseReturn$1.kKeyWord){if(T.isKeyWordPicked("C"))return r.closed=!0,{exit:!0};T.isKeyWordPicked("U")&&r.points.pop()}},()=>{MxFun.getCurrentDraw().addMxEntity(r)})}addRegisterMxDbEntity(MxDbLineShape);const propertyDbKeys=["points","closed","tension","curveType"];class MxDbSplineCurve extends MxDbEntity{constructor(){super(...arguments),this.points=[],this.closed=!1,this.tension=.5,this.curveType="centripetal"}worldDraw(r){const o=new THREE.CatmullRomCurve3(this.points,this.closed,"catmullrom",this.tension).getPoints(15*this.points.length),a=new THREE.Geometry().setFromPoints(o),x=new THREE.LineBasicMaterial({color:this.color}),u=new THREE.Line(a,x);r.drawEntity(u)}getGripPoints(){return this.points}moveGripPointsAt(r,o){return this.points[r].add(o),!0}create(){return new MxDbSplineCurve}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,propertyDbKeys),!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,propertyDbKeys),r}getTypeName(){return"MxDbSplineCurve"}}MxDbSplineCurve.draw=drawMxDbSplineCurve,MxDbSplineCurve.cmd="Mx_Spline",addRegisterMxDbEntity(MxDbSplineCurve);class MrxDbgUiPrDist extends MrxDbgUiPrBase{constructor(){var r;super(new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().getMrxDbgUiPrDistClass()))}value(){return this.imp.value()}basePt(){return this.imp.basePt()}setBasePt(r){return this.imp.setBasePt(r)}setUseBasePt(r){return this.imp.setUseBasePt(r)}go(r){let o=this;return r?(o.imp.go(a=>{o.status=a,r(a)}),new Promise((a,x)=>{a(null)})):new Promise((a,x)=>{o.imp.go(u=>{o.status=u,a(u!=0?null:o.imp.value())})})}}class MrxDbgUiPrInt extends MrxDbgUiPrBase{constructor(){var r;super(new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().getMrxDbgUiPrIntClass()))}value(){return this.imp.value()}go(r){let o=this;return r?(o.imp.go(a=>{o.status=a,r(a)}),new Promise((a,x)=>{a(null)})):new Promise((a,x)=>{o.imp.go(u=>{o.status=u,a(u!=0?null:o.imp.value())})})}}class MrxDbgUiPrString extends MrxDbgUiPrBase{constructor(){var r;super(new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().getMrxDbgUiPrStringClass()))}value(){return this.imp.value()}go(r){let o=this;return r?(o.imp.go(a=>{o.status=a,r(a)}),new Promise((a,x)=>{a(null)})):new Promise((a,x)=>{o.imp.go(u=>{o.status=u,a(u!=0?null:o.imp.value())})})}}class MrxDbgUiPrKeyWord extends MrxDbgUiPrBase{constructor(){var r;super(new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().getMrxDbgUiPrKeyWordClass()))}go(r){let o=this;return r?(o.imp.go(a=>{o.status=a,r(a)}),new Promise((a,x)=>{a(null)})):new Promise((a,x)=>{o.imp.go(u=>{o.status=u,a(u!=0?null:o.keyWordPicked())})})}}class MrxDbgUiPrAngle extends MrxDbgUiPrBase{constructor(){var r;super(new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().getMrxDbgUiPrAngleClass()))}value(){return this.imp.value()}basePt(){return this.imp.basePt()}setBasePt(r){return this.imp.setBasePt(r)}setUseBasePt(r){return this.imp.setUseBasePt(r)}go(r){let o=this;return r?(o.imp.go(a=>{o.status=a,r(a)}),new Promise((a,x)=>{a(null)})):new Promise((a,x)=>{o.imp.go(u=>{o.status=u,a(u!=0?null:o.imp.value())})})}}var Mx=Object.freeze({__proto__:null,loadCoreCode,useCanvasResizeListener,store,MxFun,MxThreeJS,MxType,Mxassembly,McGeTool,MrxDbgUtils,MxPaintBrush,MrxDbgUiPrPoint,McEdGetPointWorldDrawObject,MrxDbgUiPrBaseReturn:MrxDbgUiPrBaseReturn$1,MxDbEntity,MxDbImage,MxDbSVG,MxDbSVGText,MxDbPolyline,MxDb2LineAngularDimension,Mx3PointArc,Mx2PointArc,MxDbCoord,MxDbLine,MxDbRect,MxDbAlignedDimension,MxFilters,McGiWorldDrawType:McGiWorldDrawType$1,MxDbArea,MxDbLeadTag,MxDbAnyLine,MxDbCloudLine,MxDbRegularPolygon,MxDbLeadComment,MxDbRectBoxLeadComment,MxDbEllipse,MxDbText,MxDrawObject,MxDbHatch,MxDbDatabase,MxDbGradientLine,MxDbShape,MxDbEllipseShape,MxDbEllipseArc,MxDbCircleShape,MxDbCircleArc,MxDbArcShapeDraw,MxDbRingShape,MxDbStarShape,MxDbRegularPolygonShape,MxDbArrow,MxDbLineShape,Layer,MxDbSplineCurve,MrxDbgUiPrBase,get MxCursorType(){return MxCursorType},get DetailedResult(){return DetailedResult},get DynamicInputType(){return DynamicInputType},get UserInputControls(){return UserInputControls},MrxDbgUiPrDist,MrxDbgUiPrInt,MrxDbgUiPrString,MrxDbgUiPrKeyWord,MrxDbgUiPrAngle,MxTempMarkDraw}),elementResizeEventPolyfill_umd_min=createCommonjsModule(function(T,r){T.exports=function(o){var a={};function x(u){if(a[u])return a[u].exports;var M=a[u]={i:u,l:!1,exports:{}};return o[u].call(M.exports,M,M.exports,x),M.l=!0,M.exports}return x.m=o,x.c=a,x.d=function(u,M,I){x.o(u,M)||Object.defineProperty(u,M,{enumerable:!0,get:I})},x.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},x.t=function(u,M){if(1&M&&(u=x(u)),8&M||4&M&&typeof u=="object"&&u&&u.__esModule)return u;var I=Object.create(null);if(x.r(I),Object.defineProperty(I,"default",{enumerable:!0,value:u}),2&M&&typeof u!="string")for(var H in u)x.d(I,H,function(G){return u[G]}.bind(null,H));return I},x.n=function(u){var M=u&&u.__esModule?function(){return u.default}:function(){return u};return x.d(M,"a",M),M},x.o=function(u,M){return Object.prototype.hasOwnProperty.call(u,M)},x.p="",x(x.s="fae3")}({"6dd8":function(o,a,x){(function(u){var M=function(){if(typeof Map<"u")return Map;function P(O,Z){var te=-1;return O.some(function(de,me){return de[0]===Z&&(te=me,!0)}),te}return function(){function O(){this.__entries__=[]}return Object.defineProperty(O.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),O.prototype.get=function(Z){var te=P(this.__entries__,Z),de=this.__entries__[te];return de&&de[1]},O.prototype.set=function(Z,te){var de=P(this.__entries__,Z);~de?this.__entries__[de][1]=te:this.__entries__.push([Z,te])},O.prototype.delete=function(Z){var te=this.__entries__,de=P(te,Z);~de&&te.splice(de,1)},O.prototype.has=function(Z){return!!~P(this.__entries__,Z)},O.prototype.clear=function(){this.__entries__.splice(0)},O.prototype.forEach=function(Z,te){te===void 0&&(te=null);for(var de=0,me=this.__entries__;de<me.length;de++){var we=me[de];Z.call(te,we[1],we[0])}},O}()}(),I=typeof window<"u"&&typeof document<"u"&&window.document===document,H=u!==void 0&&u.Math===Math?u:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")(),G=typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(H):function(P){return setTimeout(function(){return P(Date.now())},1e3/60)},L=2,y=20,D=["top","right","bottom","left","width","height","size","weight"],C=typeof MutationObserver<"u",B=function(){function P(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(O,Z){var te=!1,de=!1,me=0;function we(){te&&(te=!1,O()),de&&Le()}function ge(){G(we)}function Le(){var Pe=Date.now();if(te){if(Pe-me<L)return;de=!0}else te=!0,de=!1,setTimeout(ge,Z);me=Pe}return Le}(this.refresh.bind(this),y)}return P.prototype.addObserver=function(O){~this.observers_.indexOf(O)||this.observers_.push(O),this.connected_||this.connect_()},P.prototype.removeObserver=function(O){var Z=this.observers_,te=Z.indexOf(O);~te&&Z.splice(te,1),!Z.length&&this.connected_&&this.disconnect_()},P.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},P.prototype.updateObservers_=function(){var O=this.observers_.filter(function(Z){return Z.gatherActive(),Z.hasActive()});return O.forEach(function(Z){return Z.broadcastActive()}),O.length>0},P.prototype.connect_=function(){I&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),C?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},P.prototype.disconnect_=function(){I&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},P.prototype.onTransitionEnd_=function(O){var Z=O.propertyName,te=Z===void 0?"":Z;D.some(function(de){return!!~te.indexOf(de)})&&this.refresh()},P.getInstance=function(){return this.instance_||(this.instance_=new P),this.instance_},P.instance_=null,P}(),z=function(P,O){for(var Z=0,te=Object.keys(O);Z<te.length;Z++){var de=te[Z];Object.defineProperty(P,de,{value:O[de],enumerable:!1,writable:!1,configurable:!0})}return P},A=function(P){return P&&P.ownerDocument&&P.ownerDocument.defaultView||H},S=V(0,0,0,0);function q(P){return parseFloat(P)||0}function W(P){for(var O=[],Z=1;Z<arguments.length;Z++)O[Z-1]=arguments[Z];return O.reduce(function(te,de){return te+q(P["border-"+de+"-width"])},0)}function _(P){var O=P.clientWidth,Z=P.clientHeight;if(!O&&!Z)return S;var te=A(P).getComputedStyle(P),de=function(ve){for(var Ie={},ze=0,He=["top","right","bottom","left"];ze<He.length;ze++){var at=He[ze],tt=ve["padding-"+at];Ie[at]=q(tt)}return Ie}(te),me=de.left+de.right,we=de.top+de.bottom,ge=q(te.width),Le=q(te.height);if(te.boxSizing==="border-box"&&(Math.round(ge+me)!==O&&(ge-=W(te,"left","right")+me),Math.round(Le+we)!==Z&&(Le-=W(te,"top","bottom")+we)),!function(ve){return ve===A(ve).document.documentElement}(P)){var Pe=Math.round(ge+me)-O,ae=Math.round(Le+we)-Z;Math.abs(Pe)!==1&&(ge-=Pe),Math.abs(ae)!==1&&(Le-=ae)}return V(de.left,de.top,ge,Le)}var R=typeof SVGGraphicsElement<"u"?function(P){return P instanceof A(P).SVGGraphicsElement}:function(P){return P instanceof A(P).SVGElement&&typeof P.getBBox=="function"};function v(P){return I?R(P)?function(O){var Z=O.getBBox();return V(0,0,Z.width,Z.height)}(P):_(P):S}function V(P,O,Z,te){return{x:P,y:O,width:Z,height:te}}var Y=function(){function P(O){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=V(0,0,0,0),this.target=O}return P.prototype.isActive=function(){var O=v(this.target);return this.contentRect_=O,O.width!==this.broadcastWidth||O.height!==this.broadcastHeight},P.prototype.broadcastRect=function(){var O=this.contentRect_;return this.broadcastWidth=O.width,this.broadcastHeight=O.height,O},P}(),c=function(){return function(P,O){var Z=function(te){var de=te.x,me=te.y,we=te.width,ge=te.height,Le=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,Pe=Object.create(Le.prototype);return z(Pe,{x:de,y:me,width:we,height:ge,top:me,right:de+we,bottom:ge+me,left:de}),Pe}(O);z(this,{target:P,contentRect:Z})}}(),p=function(){function P(O,Z,te){if(this.activeObservations_=[],this.observations_=new M,typeof O!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=O,this.controller_=Z,this.callbackCtx_=te}return P.prototype.observe=function(O){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(typeof Element<"u"&&Element instanceof Object){if(!(O instanceof A(O).Element))throw new TypeError('parameter 1 is not of type "Element".');var Z=this.observations_;Z.has(O)||(Z.set(O,new Y(O)),this.controller_.addObserver(this),this.controller_.refresh())}},P.prototype.unobserve=function(O){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(typeof Element<"u"&&Element instanceof Object){if(!(O instanceof A(O).Element))throw new TypeError('parameter 1 is not of type "Element".');var Z=this.observations_;Z.has(O)&&(Z.delete(O),Z.size||this.controller_.removeObserver(this))}},P.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},P.prototype.gatherActive=function(){var O=this;this.clearActive(),this.observations_.forEach(function(Z){Z.isActive()&&O.activeObservations_.push(Z)})},P.prototype.broadcastActive=function(){if(this.hasActive()){var O=this.callbackCtx_,Z=this.activeObservations_.map(function(te){return new c(te.target,te.broadcastRect())});this.callback_.call(O,Z,O),this.clearActive()}},P.prototype.clearActive=function(){this.activeObservations_.splice(0)},P.prototype.hasActive=function(){return this.activeObservations_.length>0},P}(),m=typeof WeakMap<"u"?new WeakMap:new M,f=function(){return function P(O){if(!(this instanceof P))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var Z=B.getInstance(),te=new p(O,Z,this);m.set(this,te)}}();["observe","unobserve","disconnect"].forEach(function(P){f.prototype[P]=function(){var O;return(O=m.get(this))[P].apply(O,arguments)}});var N=H.ResizeObserver!==void 0?H.ResizeObserver:f;a.a=N}).call(this,x("c8ba"))},c8ba:function(o,a){var x;x=function(){return this}();try{x=x||new Function("return this")()}catch{typeof window=="object"&&(x=window)}o.exports=x},f6fd:function(o,a){(function(x){var u="currentScript",M=x.getElementsByTagName("script");u in x||Object.defineProperty(x,u,{get:function(){try{throw new Error}catch(G){var I,H=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(G.stack)||[!1])[1];for(I in M)if(M[I].src==H||M[I].readyState=="interactive")return M[I];return null}}})})(document)},fae3:function(o,a,x){var u;x.r(a),x.d(a,"EventListenerWrapper",function(){return G}),typeof window<"u"&&(x("f6fd"),(u=window.document.currentScript)&&(u=u.src.match(/(.+\/)[^/]+\.js(\?.*)?$/))&&(x.p=u[1]));var M=x("6dd8");const I=EventTarget.prototype.addEventListener,H=function(D){const C=document.createEvent("HTMLEvents");return C.initEvent(D),C},G=function(D){D==="resize"&&y(this),I.apply(this,arguments)};function L(D){const C=L.observer=L.observer||new M.a(D);return C.initialized=!0,C}function y(D){const C=L(B=>{if(C.initialized)C.initialized=!1;else for(let z of B){const A=H("resize");z.target.dispatchEvent(A),z&&z.target&&typeof z.target.onresize=="function"&&z.target.onresize(A)}});C.observe(D)}HTMLElement.prototype.addEventListener=G,Reflect.defineProperty(HTMLElement.prototype,"onresize",{set(D){this._onresize=D,typeof D=="function"&&y(this)},get(){return this._onresize||null}})}})}),elementResizeEventPolyfill_umd_min$1=unwrapExports(elementResizeEventPolyfill_umd_min),elementResizeEventPolyfill_umd_min$2=Object.freeze({__proto__:null,default:elementResizeEventPolyfill_umd_min$1,__moduleExports:elementResizeEventPolyfill_umd_min});export{DetailedResult,DynamicInputType,Layer,McEdGetPointWorldDrawObject,McGeTool,McGiWorldDrawType$1 as McGiWorldDrawType,MrxDbgUiPrAngle,MrxDbgUiPrBase,MrxDbgUiPrBaseReturn$1 as MrxDbgUiPrBaseReturn,MrxDbgUiPrDist,MrxDbgUiPrInt,MrxDbgUiPrKeyWord,MrxDbgUiPrPoint,MrxDbgUiPrString,MrxDbgUtils,Mx2PointArc,Mx3PointArc,MxCursorType,MxDb2LineAngularDimension,MxDbAlignedDimension,MxDbAnyLine,MxDbArcShapeDraw,MxDbArea,MxDbArrow,MxDbCircleArc,MxDbCircleShape,MxDbCloudLine,MxDbCoord,MxDbDatabase,MxDbEllipse,MxDbEllipseArc,MxDbEllipseShape,MxDbEntity,MxDbGradientLine,MxDbHatch,MxDbImage,MxDbLeadComment,MxDbLeadTag,MxDbLine,MxDbLineShape,MxDbPolyline,MxDbRect,MxDbRectBoxLeadComment,MxDbRegularPolygon,MxDbRegularPolygonShape,MxDbRingShape,MxDbSVG,MxDbSVGText,MxDbShape,MxDbSplineCurve,MxDbStarShape,MxDbText,MxDrawObject,MxFilters,MxFun,MxPaintBrush,MxTempMarkDraw,MxThreeJS,MxType,Mxassembly,UserInputControls,Mx as default,loadCoreCode,store,useCanvasResizeListener};
