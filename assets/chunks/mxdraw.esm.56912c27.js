class PubSub{constructor(){this.events={}}on(r,s){let o=this;o.events.hasOwnProperty(r)||(o.events[r]=[]),o.events[r].push(s)}emit(r,...s){this.events.hasOwnProperty(r)&&this.events[r].map(o=>o(...s))}off(r,s){if(this.events[r])if(s===void 0)this.events[r]=[];else{const o=this.events[r].indexOf(s);this.events[r].splice(o,1)}}}class Store{constructor(r){let s=this;s.actions={},s.mutations={},s.state=r.state,s.status="resting",s.events=new PubSub,r.hasOwnProperty("actions")&&(s.actions=r.actions),r.hasOwnProperty("mutations")&&(s.mutations=r.mutations)}dispatch(r,s){let o=this;return typeof o.actions[r]=="function"&&(console.groupCollapsed(`ACTION: ${r}`),o.status="action",o.actions[r](o,s),console.groupEnd(),!0)}commit(r,s){let o=this;if(typeof o.mutations[r]!="function")return console.log(`Mutation "${r}" doesn't exist`),!1;o.status="mutation";let v=o.mutations[r](o.state,s);return o.state=Object.assign(o.state,v),!0}}const options={state:{MxFun:null,Mxassembly:null,isCreateDrawObj:!1},actions:{},mutations:{}};for(let b in options.state){const r=b.charAt(0).toUpperCase()+b.slice(1);options.mutations["set"+r]=(s,o)=>{s[b]=o}}const store=new Store(options);function mxfun(){(function b(r,s,o){function v(L,U){if(!s[L]){if(!r[L]){var N=typeof require=="function"&&require;if(!U&&N)return N(L,!0);if(u)return u(L,!0);var D=new Error("Cannot find module '"+L+"'");throw D.code="MODULE_NOT_FOUND",D}var f=s[L]={exports:{}};r[L][0].call(f.exports,function(P){return v(r[L][1][P]||P)},f,f.exports,b,r,s,o)}return s[L].exports}for(var u=typeof require=="function"&&require,w=0;w<o.length;w++)v(o[w]);return v})({1:[function(b,r,s){var o={};(0,b("./lib/utils/common").assign)(o,b("./lib/deflate"),b("./lib/inflate"),b("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":2,"./lib/inflate":3,"./lib/utils/common":4,"./lib/zlib/constants":7}],2:[function(b,r,s){var o=b("./zlib/deflate"),v=b("./utils/common"),u=b("./utils/strings"),w=b("./zlib/messages"),L=b("./zlib/zstream"),U=Object.prototype.toString,N=0,D=-1,f=0,P=8;function T(G){if(!(this instanceof T))return new T(G);this.options=v.assign({level:D,method:P,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},G||{});var R=this.options;R.raw&&0<R.windowBits?R.windowBits=-R.windowBits:R.gzip&&0<R.windowBits&&R.windowBits<16&&(R.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new L,this.strm.avail_out=0;var _=o.deflateInit2(this.strm,R.level,R.method,R.windowBits,R.memLevel,R.strategy);if(_!==N)throw new Error(w[_]);if(R.header&&o.deflateSetHeader(this.strm,R.header),R.dictionary){var ee;if(ee=typeof R.dictionary=="string"?u.string2buf(R.dictionary):U.call(R.dictionary)==="[object ArrayBuffer]"?new Uint8Array(R.dictionary):R.dictionary,(_=o.deflateSetDictionary(this.strm,ee))!==N)throw new Error(w[_]);this._dict_set=!0}}function B(G,R){var _=new T(R);if(_.push(G,!0),_.err)throw _.msg||w[_.err];return _.result}T.prototype.push=function(G,R){var _,ee,k=this.strm,E=this.options.chunkSize;if(this.ended)return!1;ee=R===~~R?R:R===!0?4:0,typeof G=="string"?k.input=u.string2buf(G):U.call(G)==="[object ArrayBuffer]"?k.input=new Uint8Array(G):k.input=G,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new v.Buf8(E),k.next_out=0,k.avail_out=E),(_=o.deflate(k,ee))!==1&&_!==N)return this.onEnd(_),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||ee!==4&&ee!==2)||(this.options.to==="string"?this.onData(u.buf2binstring(v.shrinkBuf(k.output,k.next_out))):this.onData(v.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&_!==1);return ee===4?(_=o.deflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===N):ee!==2||(this.onEnd(N),!(k.avail_out=0))},T.prototype.onData=function(G){this.chunks.push(G)},T.prototype.onEnd=function(G){G===N&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=v.flattenChunks(this.chunks)),this.chunks=[],this.err=G,this.msg=this.strm.msg},s.Deflate=T,s.deflate=B,s.deflateRaw=function(G,R){return(R=R||{}).raw=!0,B(G,R)},s.gzip=function(G,R){return(R=R||{}).gzip=!0,B(G,R)}},{"./utils/common":4,"./utils/strings":5,"./zlib/deflate":9,"./zlib/messages":14,"./zlib/zstream":16}],3:[function(b,r,s){var o=b("./zlib/inflate"),v=b("./utils/common"),u=b("./utils/strings"),w=b("./zlib/constants"),L=b("./zlib/messages"),U=b("./zlib/zstream"),N=b("./zlib/gzheader"),D=Object.prototype.toString;function f(T){if(!(this instanceof f))return new f(T);this.options=v.assign({chunkSize:16384,windowBits:0,to:""},T||{});var B=this.options;B.raw&&0<=B.windowBits&&B.windowBits<16&&(B.windowBits=-B.windowBits,B.windowBits===0&&(B.windowBits=-15)),!(0<=B.windowBits&&B.windowBits<16)||T&&T.windowBits||(B.windowBits+=32),15<B.windowBits&&B.windowBits<48&&!(15&B.windowBits)&&(B.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new U,this.strm.avail_out=0;var G=o.inflateInit2(this.strm,B.windowBits);if(G!==w.Z_OK)throw new Error(L[G]);if(this.header=new N,o.inflateGetHeader(this.strm,this.header),B.dictionary&&(typeof B.dictionary=="string"?B.dictionary=u.string2buf(B.dictionary):D.call(B.dictionary)==="[object ArrayBuffer]"&&(B.dictionary=new Uint8Array(B.dictionary)),B.raw&&(G=o.inflateSetDictionary(this.strm,B.dictionary))!==w.Z_OK))throw new Error(L[G])}function P(T,B){var G=new f(B);if(G.push(T,!0),G.err)throw G.msg||L[G.err];return G.result}f.prototype.push=function(T,B){var G,R,_,ee,k,E=this.strm,W=this.options.chunkSize,C=this.options.dictionary,F=!1;if(this.ended)return!1;R=B===~~B?B:B===!0?w.Z_FINISH:w.Z_NO_FLUSH,typeof T=="string"?E.input=u.binstring2buf(T):D.call(T)==="[object ArrayBuffer]"?E.input=new Uint8Array(T):E.input=T,E.next_in=0,E.avail_in=E.input.length;do{if(E.avail_out===0&&(E.output=new v.Buf8(W),E.next_out=0,E.avail_out=W),(G=o.inflate(E,w.Z_NO_FLUSH))===w.Z_NEED_DICT&&C&&(G=o.inflateSetDictionary(this.strm,C)),G===w.Z_BUF_ERROR&&F===!0&&(G=w.Z_OK,F=!1),G!==w.Z_STREAM_END&&G!==w.Z_OK)return this.onEnd(G),!(this.ended=!0);E.next_out&&(E.avail_out!==0&&G!==w.Z_STREAM_END&&(E.avail_in!==0||R!==w.Z_FINISH&&R!==w.Z_SYNC_FLUSH)||(this.options.to==="string"?(_=u.utf8border(E.output,E.next_out),ee=E.next_out-_,k=u.buf2string(E.output,_),E.next_out=ee,E.avail_out=W-ee,ee&&v.arraySet(E.output,E.output,_,ee,0),this.onData(k)):this.onData(v.shrinkBuf(E.output,E.next_out)))),E.avail_in===0&&E.avail_out===0&&(F=!0)}while((0<E.avail_in||E.avail_out===0)&&G!==w.Z_STREAM_END);return G===w.Z_STREAM_END&&(R=w.Z_FINISH),R===w.Z_FINISH?(G=o.inflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===w.Z_OK):R!==w.Z_SYNC_FLUSH||(this.onEnd(w.Z_OK),!(E.avail_out=0))},f.prototype.onData=function(T){this.chunks.push(T)},f.prototype.onEnd=function(T){T===w.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=v.flattenChunks(this.chunks)),this.chunks=[],this.err=T,this.msg=this.strm.msg},s.Inflate=f,s.inflate=P,s.inflateRaw=function(T,B){return(B=B||{}).raw=!0,P(T,B)},s.ungzip=P},{"./utils/common":4,"./utils/strings":5,"./zlib/constants":7,"./zlib/gzheader":10,"./zlib/inflate":12,"./zlib/messages":14,"./zlib/zstream":16}],4:[function(b,r,s){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(w){for(var L,U,N=Array.prototype.slice.call(arguments,1);N.length;){var D=N.shift();if(D){if(typeof D!="object")throw new TypeError(D+"must be non-object");for(var f in D)L=D,U=f,Object.prototype.hasOwnProperty.call(L,U)&&(w[f]=D[f])}}return w},s.shrinkBuf=function(w,L){return w.length===L?w:w.subarray?w.subarray(0,L):(w.length=L,w)};var v={arraySet:function(w,L,U,N,D){if(L.subarray&&w.subarray)w.set(L.subarray(U,U+N),D);else for(var f=0;f<N;f++)w[D+f]=L[U+f]},flattenChunks:function(w){var L,U,N,D,f,P;for(L=N=0,U=w.length;L<U;L++)N+=w[L].length;for(P=new Uint8Array(N),L=D=0,U=w.length;L<U;L++)f=w[L],P.set(f,D),D+=f.length;return P}},u={arraySet:function(w,L,U,N,D){for(var f=0;f<N;f++)w[D+f]=L[U+f]},flattenChunks:function(w){return[].concat.apply([],w)}};s.setTyped=function(w){w?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,v)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,u))},s.setTyped(o)},{}],5:[function(b,r,s){var o=b("./common"),v=!0,u=!0;try{String.fromCharCode.apply(null,[0])}catch{v=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{u=!1}for(var w=new o.Buf8(256),L=0;L<256;L++)w[L]=252<=L?6:248<=L?5:240<=L?4:224<=L?3:192<=L?2:1;function U(N,D){if(D<65534&&(N.subarray&&u||!N.subarray&&v))return String.fromCharCode.apply(null,o.shrinkBuf(N,D));for(var f="",P=0;P<D;P++)f+=String.fromCharCode(N[P]);return f}w[254]=w[254]=1,s.string2buf=function(N){var D,f,P,T,B,G=N.length,R=0;for(T=0;T<G;T++)(64512&(f=N.charCodeAt(T)))==55296&&T+1<G&&(64512&(P=N.charCodeAt(T+1)))==56320&&(f=65536+(f-55296<<10)+(P-56320),T++),R+=f<128?1:f<2048?2:f<65536?3:4;for(D=new o.Buf8(R),T=B=0;B<R;T++)(64512&(f=N.charCodeAt(T)))==55296&&T+1<G&&(64512&(P=N.charCodeAt(T+1)))==56320&&(f=65536+(f-55296<<10)+(P-56320),T++),f<128?D[B++]=f:(f<2048?D[B++]=192|f>>>6:(f<65536?D[B++]=224|f>>>12:(D[B++]=240|f>>>18,D[B++]=128|f>>>12&63),D[B++]=128|f>>>6&63),D[B++]=128|63&f);return D},s.buf2binstring=function(N){return U(N,N.length)},s.binstring2buf=function(N){for(var D=new o.Buf8(N.length),f=0,P=D.length;f<P;f++)D[f]=N.charCodeAt(f);return D},s.buf2string=function(N,D){var f,P,T,B,G=D||N.length,R=new Array(2*G);for(f=P=0;f<G;)if((T=N[f++])<128)R[P++]=T;else if(4<(B=w[T]))R[P++]=65533,f+=B-1;else{for(T&=B===2?31:B===3?15:7;1<B&&f<G;)T=T<<6|63&N[f++],B--;1<B?R[P++]=65533:T<65536?R[P++]=T:(T-=65536,R[P++]=55296|T>>10&1023,R[P++]=56320|1023&T)}return U(R,P)},s.utf8border=function(N,D){var f;for((D=D||N.length)>N.length&&(D=N.length),f=D-1;0<=f&&(192&N[f])==128;)f--;return!(f<0)&&f!==0&&f+w[N[f]]>D?f:D}},{"./common":4}],6:[function(b,r,s){r.exports=function(o,v,u,w){for(var L=65535&o|0,U=o>>>16&65535|0,N=0;u!==0;){for(u-=N=2e3<u?2e3:u;U=U+(L=L+v[w++]|0)|0,--N;);L%=65521,U%=65521}return L|U<<16|0}},{}],7:[function(b,r,s){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],8:[function(b,r,s){var o=function(){for(var v,u=[],w=0;w<256;w++){v=w;for(var L=0;L<8;L++)v=1&v?3988292384^v>>>1:v>>>1;u[w]=v}return u}();r.exports=function(v,u,w,L){var U=o,N=L+w;v^=-1;for(var D=L;D<N;D++)v=v>>>8^U[255&(v^u[D])];return-1^v}},{}],9:[function(b,r,s){var o,v=b("../utils/common"),u=b("./trees"),w=b("./adler32"),L=b("./crc32"),U=b("./messages"),N=0,D=0,f=-2,P=2,T=8,B=286,G=30,R=19,_=2*B+1,ee=15,k=3,E=258,W=E+k+1,C=42,F=113;function M(J,ge){return J.msg=U[ge],ge}function a(J){return(J<<1)-(4<J?9:0)}function h(J){for(var ge=J.length;0<=--ge;)J[ge]=0}function y(J){var ge=J.state,oe=ge.pending;oe>J.avail_out&&(oe=J.avail_out),oe!==0&&(v.arraySet(J.output,ge.pending_buf,ge.pending_out,oe,J.next_out),J.next_out+=oe,ge.pending_out+=oe,J.total_out+=oe,J.avail_out-=oe,ge.pending-=oe,ge.pending===0&&(ge.pending_out=0))}function j(J,ge){u._tr_flush_block(J,0<=J.block_start?J.block_start:-1,J.strstart-J.block_start,ge),J.block_start=J.strstart,y(J.strm)}function Y(J,ge){J.pending_buf[J.pending++]=ge}function q(J,ge){J.pending_buf[J.pending++]=ge>>>8&255,J.pending_buf[J.pending++]=255&ge}function V(J,ge){var oe,le,Re=J.max_chain_length,Ye=J.strstart,Be=J.prev_length,se=J.nice_match,ve=J.strstart>J.w_size-W?J.strstart-(J.w_size-W):0,Ee=J.window,rt=J.w_mask,tt=J.prev,xt=J.strstart+E,Rt=Ee[Ye+Be-1],At=Ee[Ye+Be];J.prev_length>=J.good_match&&(Re>>=2),se>J.lookahead&&(se=J.lookahead);do if(Ee[(oe=ge)+Be]===At&&Ee[oe+Be-1]===Rt&&Ee[oe]===Ee[Ye]&&Ee[++oe]===Ee[Ye+1]){Ye+=2,oe++;do;while(Ee[++Ye]===Ee[++oe]&&Ee[++Ye]===Ee[++oe]&&Ee[++Ye]===Ee[++oe]&&Ee[++Ye]===Ee[++oe]&&Ee[++Ye]===Ee[++oe]&&Ee[++Ye]===Ee[++oe]&&Ee[++Ye]===Ee[++oe]&&Ee[++Ye]===Ee[++oe]&&Ye<xt);if(le=E-(xt-Ye),Ye=xt-E,Be<le){if(J.match_start=ge,se<=(Be=le))break;Rt=Ee[Ye+Be-1],At=Ee[Ye+Be]}}while((ge=tt[ge&rt])>ve&&--Re!=0);return Be<=J.lookahead?Be:J.lookahead}function ne(J){var ge,oe,le,Re,Ye,Be,se,ve,Ee,rt,tt=J.w_size;do{if(Re=J.window_size-J.lookahead-J.strstart,J.strstart>=tt+(tt-W)){for(v.arraySet(J.window,J.window,tt,tt,0),J.match_start-=tt,J.strstart-=tt,J.block_start-=tt,ge=oe=J.hash_size;le=J.head[--ge],J.head[ge]=tt<=le?le-tt:0,--oe;);for(ge=oe=tt;le=J.prev[--ge],J.prev[ge]=tt<=le?le-tt:0,--oe;);Re+=tt}if(J.strm.avail_in===0)break;if(Be=J.strm,se=J.window,ve=J.strstart+J.lookahead,rt=void 0,(Ee=Re)<(rt=Be.avail_in)&&(rt=Ee),oe=rt===0?0:(Be.avail_in-=rt,v.arraySet(se,Be.input,Be.next_in,rt,ve),Be.state.wrap===1?Be.adler=w(Be.adler,se,rt,ve):Be.state.wrap===2&&(Be.adler=L(Be.adler,se,rt,ve)),Be.next_in+=rt,Be.total_in+=rt,rt),J.lookahead+=oe,J.lookahead+J.insert>=k)for(Ye=J.strstart-J.insert,J.ins_h=J.window[Ye],J.ins_h=(J.ins_h<<J.hash_shift^J.window[Ye+1])&J.hash_mask;J.insert&&(J.ins_h=(J.ins_h<<J.hash_shift^J.window[Ye+k-1])&J.hash_mask,J.prev[Ye&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=Ye,Ye++,J.insert--,!(J.lookahead+J.insert<k)););}while(J.lookahead<W&&J.strm.avail_in!==0)}function ie(J,ge){for(var oe,le;;){if(J.lookahead<W){if(ne(J),J.lookahead<W&&ge===N)return 1;if(J.lookahead===0)break}if(oe=0,J.lookahead>=k&&(J.ins_h=(J.ins_h<<J.hash_shift^J.window[J.strstart+k-1])&J.hash_mask,oe=J.prev[J.strstart&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=J.strstart),oe!==0&&J.strstart-oe<=J.w_size-W&&(J.match_length=V(J,oe)),J.match_length>=k)if(le=u._tr_tally(J,J.strstart-J.match_start,J.match_length-k),J.lookahead-=J.match_length,J.match_length<=J.max_lazy_match&&J.lookahead>=k){for(J.match_length--;J.strstart++,J.ins_h=(J.ins_h<<J.hash_shift^J.window[J.strstart+k-1])&J.hash_mask,oe=J.prev[J.strstart&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=J.strstart,--J.match_length!=0;);J.strstart++}else J.strstart+=J.match_length,J.match_length=0,J.ins_h=J.window[J.strstart],J.ins_h=(J.ins_h<<J.hash_shift^J.window[J.strstart+1])&J.hash_mask;else le=u._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++;if(le&&(j(J,!1),J.strm.avail_out===0))return 1}return J.insert=J.strstart<k-1?J.strstart:k-1,ge===4?(j(J,!0),J.strm.avail_out===0?3:4):J.last_lit&&(j(J,!1),J.strm.avail_out===0)?1:2}function he(J,ge){for(var oe,le,Re;;){if(J.lookahead<W){if(ne(J),J.lookahead<W&&ge===N)return 1;if(J.lookahead===0)break}if(oe=0,J.lookahead>=k&&(J.ins_h=(J.ins_h<<J.hash_shift^J.window[J.strstart+k-1])&J.hash_mask,oe=J.prev[J.strstart&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=J.strstart),J.prev_length=J.match_length,J.prev_match=J.match_start,J.match_length=k-1,oe!==0&&J.prev_length<J.max_lazy_match&&J.strstart-oe<=J.w_size-W&&(J.match_length=V(J,oe),J.match_length<=5&&(J.strategy===1||J.match_length===k&&4096<J.strstart-J.match_start)&&(J.match_length=k-1)),J.prev_length>=k&&J.match_length<=J.prev_length){for(Re=J.strstart+J.lookahead-k,le=u._tr_tally(J,J.strstart-1-J.prev_match,J.prev_length-k),J.lookahead-=J.prev_length-1,J.prev_length-=2;++J.strstart<=Re&&(J.ins_h=(J.ins_h<<J.hash_shift^J.window[J.strstart+k-1])&J.hash_mask,oe=J.prev[J.strstart&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=J.strstart),--J.prev_length!=0;);if(J.match_available=0,J.match_length=k-1,J.strstart++,le&&(j(J,!1),J.strm.avail_out===0))return 1}else if(J.match_available){if((le=u._tr_tally(J,0,J.window[J.strstart-1]))&&j(J,!1),J.strstart++,J.lookahead--,J.strm.avail_out===0)return 1}else J.match_available=1,J.strstart++,J.lookahead--}return J.match_available&&(le=u._tr_tally(J,0,J.window[J.strstart-1]),J.match_available=0),J.insert=J.strstart<k-1?J.strstart:k-1,ge===4?(j(J,!0),J.strm.avail_out===0?3:4):J.last_lit&&(j(J,!1),J.strm.avail_out===0)?1:2}function be(J,ge,oe,le,Re){this.good_length=J,this.max_lazy=ge,this.nice_length=oe,this.max_chain=le,this.func=Re}function je(J){var ge;return J&&J.state?(J.total_in=J.total_out=0,J.data_type=P,(ge=J.state).pending=0,ge.pending_out=0,ge.wrap<0&&(ge.wrap=-ge.wrap),ge.status=ge.wrap?C:F,J.adler=ge.wrap===2?0:1,ge.last_flush=N,u._tr_init(ge),D):M(J,f)}function xe(J){var ge,oe=je(J);return oe===D&&((ge=J.state).window_size=2*ge.w_size,h(ge.head),ge.max_lazy_match=o[ge.level].max_lazy,ge.good_match=o[ge.level].good_length,ge.nice_match=o[ge.level].nice_length,ge.max_chain_length=o[ge.level].max_chain,ge.strstart=0,ge.block_start=0,ge.lookahead=0,ge.insert=0,ge.match_length=ge.prev_length=k-1,ge.match_available=0,ge.ins_h=0),oe}function Fe(J,ge,oe,le,Re,Ye){if(!J)return f;var Be=1;if(ge===-1&&(ge=6),le<0?(Be=0,le=-le):15<le&&(Be=2,le-=16),Re<1||9<Re||oe!==T||le<8||15<le||ge<0||9<ge||Ye<0||4<Ye)return M(J,f);le===8&&(le=9);var se=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new v.Buf16(2*_),this.dyn_dtree=new v.Buf16(2*(2*G+1)),this.bl_tree=new v.Buf16(2*(2*R+1)),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new v.Buf16(ee+1),this.heap=new v.Buf16(2*B+1),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new v.Buf16(2*B+1),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return(J.state=se).strm=J,se.wrap=Be,se.gzhead=null,se.w_bits=le,se.w_size=1<<se.w_bits,se.w_mask=se.w_size-1,se.hash_bits=Re+7,se.hash_size=1<<se.hash_bits,se.hash_mask=se.hash_size-1,se.hash_shift=~~((se.hash_bits+k-1)/k),se.window=new v.Buf8(2*se.w_size),se.head=new v.Buf16(se.hash_size),se.prev=new v.Buf16(se.w_size),se.lit_bufsize=1<<Re+6,se.pending_buf_size=4*se.lit_bufsize,se.pending_buf=new v.Buf8(se.pending_buf_size),se.d_buf=+se.lit_bufsize,se.l_buf=3*se.lit_bufsize,se.level=ge,se.strategy=Ye,se.method=oe,xe(J)}o=[new be(0,0,0,0,function(J,ge){var oe=65535;for(oe>J.pending_buf_size-5&&(oe=J.pending_buf_size-5);;){if(J.lookahead<=1){if(ne(J),J.lookahead===0&&ge===N)return 1;if(J.lookahead===0)break}J.strstart+=J.lookahead,J.lookahead=0;var le=J.block_start+oe;if((J.strstart===0||J.strstart>=le)&&(J.lookahead=J.strstart-le,J.strstart=le,j(J,!1),J.strm.avail_out===0)||J.strstart-J.block_start>=J.w_size-W&&(j(J,!1),J.strm.avail_out===0))return 1}return J.insert=0,ge===4?(j(J,!0),J.strm.avail_out===0?3:4):(J.strstart>J.block_start&&(j(J,!1),J.strm.avail_out),1)}),new be(4,4,8,4,ie),new be(4,5,16,8,ie),new be(4,6,32,32,ie),new be(4,4,16,16,he),new be(8,16,32,32,he),new be(8,16,128,128,he),new be(8,32,128,256,he),new be(32,128,258,1024,he),new be(32,258,258,4096,he)],s.deflateInit=function(J,ge){return Fe(J,ge,T,15,8,0)},s.deflateInit2=Fe,s.deflateReset=xe,s.deflateResetKeep=je,s.deflateSetHeader=function(J,ge){return J&&J.state&&J.state.wrap===2?(J.state.gzhead=ge,D):f},s.deflate=function(J,ge){var oe,le,Re,Ye;if(!J||!J.state||5<ge||ge<0)return J?M(J,f):f;if(le=J.state,!J.output||!J.input&&J.avail_in!==0||le.status===666&&ge!==4)return M(J,J.avail_out===0?-5:f);if(le.strm=J,oe=le.last_flush,le.last_flush=ge,le.status===C)if(le.wrap===2)J.adler=0,Y(le,31),Y(le,139),Y(le,8),le.gzhead?(Y(le,(le.gzhead.text?1:0)+(le.gzhead.hcrc?2:0)+(le.gzhead.extra?4:0)+(le.gzhead.name?8:0)+(le.gzhead.comment?16:0)),Y(le,255&le.gzhead.time),Y(le,le.gzhead.time>>8&255),Y(le,le.gzhead.time>>16&255),Y(le,le.gzhead.time>>24&255),Y(le,le.level===9?2:2<=le.strategy||le.level<2?4:0),Y(le,255&le.gzhead.os),le.gzhead.extra&&le.gzhead.extra.length&&(Y(le,255&le.gzhead.extra.length),Y(le,le.gzhead.extra.length>>8&255)),le.gzhead.hcrc&&(J.adler=L(J.adler,le.pending_buf,le.pending,0)),le.gzindex=0,le.status=69):(Y(le,0),Y(le,0),Y(le,0),Y(le,0),Y(le,0),Y(le,le.level===9?2:2<=le.strategy||le.level<2?4:0),Y(le,3),le.status=F);else{var Be=T+(le.w_bits-8<<4)<<8;Be|=(2<=le.strategy||le.level<2?0:le.level<6?1:le.level===6?2:3)<<6,le.strstart!==0&&(Be|=32),Be+=31-Be%31,le.status=F,q(le,Be),le.strstart!==0&&(q(le,J.adler>>>16),q(le,65535&J.adler)),J.adler=1}if(le.status===69)if(le.gzhead.extra){for(Re=le.pending;le.gzindex<(65535&le.gzhead.extra.length)&&(le.pending!==le.pending_buf_size||(le.gzhead.hcrc&&le.pending>Re&&(J.adler=L(J.adler,le.pending_buf,le.pending-Re,Re)),y(J),Re=le.pending,le.pending!==le.pending_buf_size));)Y(le,255&le.gzhead.extra[le.gzindex]),le.gzindex++;le.gzhead.hcrc&&le.pending>Re&&(J.adler=L(J.adler,le.pending_buf,le.pending-Re,Re)),le.gzindex===le.gzhead.extra.length&&(le.gzindex=0,le.status=73)}else le.status=73;if(le.status===73)if(le.gzhead.name){Re=le.pending;do{if(le.pending===le.pending_buf_size&&(le.gzhead.hcrc&&le.pending>Re&&(J.adler=L(J.adler,le.pending_buf,le.pending-Re,Re)),y(J),Re=le.pending,le.pending===le.pending_buf_size)){Ye=1;break}Ye=le.gzindex<le.gzhead.name.length?255&le.gzhead.name.charCodeAt(le.gzindex++):0,Y(le,Ye)}while(Ye!==0);le.gzhead.hcrc&&le.pending>Re&&(J.adler=L(J.adler,le.pending_buf,le.pending-Re,Re)),Ye===0&&(le.gzindex=0,le.status=91)}else le.status=91;if(le.status===91)if(le.gzhead.comment){Re=le.pending;do{if(le.pending===le.pending_buf_size&&(le.gzhead.hcrc&&le.pending>Re&&(J.adler=L(J.adler,le.pending_buf,le.pending-Re,Re)),y(J),Re=le.pending,le.pending===le.pending_buf_size)){Ye=1;break}Ye=le.gzindex<le.gzhead.comment.length?255&le.gzhead.comment.charCodeAt(le.gzindex++):0,Y(le,Ye)}while(Ye!==0);le.gzhead.hcrc&&le.pending>Re&&(J.adler=L(J.adler,le.pending_buf,le.pending-Re,Re)),Ye===0&&(le.status=103)}else le.status=103;if(le.status===103&&(le.gzhead.hcrc?(le.pending+2>le.pending_buf_size&&y(J),le.pending+2<=le.pending_buf_size&&(Y(le,255&J.adler),Y(le,J.adler>>8&255),J.adler=0,le.status=F)):le.status=F),le.pending!==0){if(y(J),J.avail_out===0)return le.last_flush=-1,D}else if(J.avail_in===0&&a(ge)<=a(oe)&&ge!==4)return M(J,-5);if(le.status===666&&J.avail_in!==0)return M(J,-5);if(J.avail_in!==0||le.lookahead!==0||ge!==N&&le.status!==666){var se=le.strategy===2?function(ve,Ee){for(var rt;;){if(ve.lookahead===0&&(ne(ve),ve.lookahead===0)){if(Ee===N)return 1;break}if(ve.match_length=0,rt=u._tr_tally(ve,0,ve.window[ve.strstart]),ve.lookahead--,ve.strstart++,rt&&(j(ve,!1),ve.strm.avail_out===0))return 1}return ve.insert=0,Ee===4?(j(ve,!0),ve.strm.avail_out===0?3:4):ve.last_lit&&(j(ve,!1),ve.strm.avail_out===0)?1:2}(le,ge):le.strategy===3?function(ve,Ee){for(var rt,tt,xt,Rt,At=ve.window;;){if(ve.lookahead<=E){if(ne(ve),ve.lookahead<=E&&Ee===N)return 1;if(ve.lookahead===0)break}if(ve.match_length=0,ve.lookahead>=k&&0<ve.strstart&&(tt=At[xt=ve.strstart-1])===At[++xt]&&tt===At[++xt]&&tt===At[++xt]){Rt=ve.strstart+E;do;while(tt===At[++xt]&&tt===At[++xt]&&tt===At[++xt]&&tt===At[++xt]&&tt===At[++xt]&&tt===At[++xt]&&tt===At[++xt]&&tt===At[++xt]&&xt<Rt);ve.match_length=E-(Rt-xt),ve.match_length>ve.lookahead&&(ve.match_length=ve.lookahead)}if(ve.match_length>=k?(rt=u._tr_tally(ve,1,ve.match_length-k),ve.lookahead-=ve.match_length,ve.strstart+=ve.match_length,ve.match_length=0):(rt=u._tr_tally(ve,0,ve.window[ve.strstart]),ve.lookahead--,ve.strstart++),rt&&(j(ve,!1),ve.strm.avail_out===0))return 1}return ve.insert=0,Ee===4?(j(ve,!0),ve.strm.avail_out===0?3:4):ve.last_lit&&(j(ve,!1),ve.strm.avail_out===0)?1:2}(le,ge):o[le.level].func(le,ge);if(se!==3&&se!==4||(le.status=666),se===1||se===3)return J.avail_out===0&&(le.last_flush=-1),D;if(se===2&&(ge===1?u._tr_align(le):ge!==5&&(u._tr_stored_block(le,0,0,!1),ge===3&&(h(le.head),le.lookahead===0&&(le.strstart=0,le.block_start=0,le.insert=0))),y(J),J.avail_out===0))return le.last_flush=-1,D}return ge!==4?D:le.wrap<=0?1:(le.wrap===2?(Y(le,255&J.adler),Y(le,J.adler>>8&255),Y(le,J.adler>>16&255),Y(le,J.adler>>24&255),Y(le,255&J.total_in),Y(le,J.total_in>>8&255),Y(le,J.total_in>>16&255),Y(le,J.total_in>>24&255)):(q(le,J.adler>>>16),q(le,65535&J.adler)),y(J),0<le.wrap&&(le.wrap=-le.wrap),le.pending!==0?D:1)},s.deflateEnd=function(J){var ge;return J&&J.state?(ge=J.state.status)!==C&&ge!==69&&ge!==73&&ge!==91&&ge!==103&&ge!==F&&ge!==666?M(J,f):(J.state=null,ge===F?M(J,-3):D):f},s.deflateSetDictionary=function(J,ge){var oe,le,Re,Ye,Be,se,ve,Ee,rt=ge.length;if(!J||!J.state||(Ye=(oe=J.state).wrap)===2||Ye===1&&oe.status!==C||oe.lookahead)return f;for(Ye===1&&(J.adler=w(J.adler,ge,rt,0)),oe.wrap=0,rt>=oe.w_size&&(Ye===0&&(h(oe.head),oe.strstart=0,oe.block_start=0,oe.insert=0),Ee=new v.Buf8(oe.w_size),v.arraySet(Ee,ge,rt-oe.w_size,oe.w_size,0),ge=Ee,rt=oe.w_size),Be=J.avail_in,se=J.next_in,ve=J.input,J.avail_in=rt,J.next_in=0,J.input=ge,ne(oe);oe.lookahead>=k;){for(le=oe.strstart,Re=oe.lookahead-(k-1);oe.ins_h=(oe.ins_h<<oe.hash_shift^oe.window[le+k-1])&oe.hash_mask,oe.prev[le&oe.w_mask]=oe.head[oe.ins_h],oe.head[oe.ins_h]=le,le++,--Re;);oe.strstart=le,oe.lookahead=k-1,ne(oe)}return oe.strstart+=oe.lookahead,oe.block_start=oe.strstart,oe.insert=oe.lookahead,oe.lookahead=0,oe.match_length=oe.prev_length=k-1,oe.match_available=0,J.next_in=se,J.input=ve,J.avail_in=Be,oe.wrap=Ye,D},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":4,"./adler32":6,"./crc32":8,"./messages":14,"./trees":15}],10:[function(b,r,s){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],11:[function(b,r,s){r.exports=function(o,v){var u,w,L,U,N,D,f,P,T,B,G,R,_,ee,k,E,W,C,F,M,a,h,y,j,Y;u=o.state,w=o.next_in,j=o.input,L=w+(o.avail_in-5),U=o.next_out,Y=o.output,N=U-(v-o.avail_out),D=U+(o.avail_out-257),f=u.dmax,P=u.wsize,T=u.whave,B=u.wnext,G=u.window,R=u.hold,_=u.bits,ee=u.lencode,k=u.distcode,E=(1<<u.lenbits)-1,W=(1<<u.distbits)-1;e:do{_<15&&(R+=j[w++]<<_,_+=8,R+=j[w++]<<_,_+=8),C=ee[R&E];t:for(;;){if(R>>>=F=C>>>24,_-=F,(F=C>>>16&255)==0)Y[U++]=65535&C;else{if(!(16&F)){if(!(64&F)){C=ee[(65535&C)+(R&(1<<F)-1)];continue t}if(32&F){u.mode=12;break e}o.msg="invalid literal/length code",u.mode=30;break e}M=65535&C,(F&=15)&&(_<F&&(R+=j[w++]<<_,_+=8),M+=R&(1<<F)-1,R>>>=F,_-=F),_<15&&(R+=j[w++]<<_,_+=8,R+=j[w++]<<_,_+=8),C=k[R&W];n:for(;;){if(R>>>=F=C>>>24,_-=F,!(16&(F=C>>>16&255))){if(!(64&F)){C=k[(65535&C)+(R&(1<<F)-1)];continue n}o.msg="invalid distance code",u.mode=30;break e}if(a=65535&C,_<(F&=15)&&(R+=j[w++]<<_,(_+=8)<F&&(R+=j[w++]<<_,_+=8)),f<(a+=R&(1<<F)-1)){o.msg="invalid distance too far back",u.mode=30;break e}if(R>>>=F,_-=F,(F=U-N)<a){if(T<(F=a-F)&&u.sane){o.msg="invalid distance too far back",u.mode=30;break e}if(y=G,(h=0)===B){if(h+=P-F,F<M){for(M-=F;Y[U++]=G[h++],--F;);h=U-a,y=Y}}else if(B<F){if(h+=P+B-F,(F-=B)<M){for(M-=F;Y[U++]=G[h++],--F;);if(h=0,B<M){for(M-=F=B;Y[U++]=G[h++],--F;);h=U-a,y=Y}}}else if(h+=B-F,F<M){for(M-=F;Y[U++]=G[h++],--F;);h=U-a,y=Y}for(;2<M;)Y[U++]=y[h++],Y[U++]=y[h++],Y[U++]=y[h++],M-=3;M&&(Y[U++]=y[h++],1<M&&(Y[U++]=y[h++]))}else{for(h=U-a;Y[U++]=Y[h++],Y[U++]=Y[h++],Y[U++]=Y[h++],2<(M-=3););M&&(Y[U++]=Y[h++],1<M&&(Y[U++]=Y[h++]))}break}}break}}while(w<L&&U<D);w-=M=_>>3,R&=(1<<(_-=M<<3))-1,o.next_in=w,o.next_out=U,o.avail_in=w<L?L-w+5:5-(w-L),o.avail_out=U<D?D-U+257:257-(U-D),u.hold=R,u.bits=_}},{}],12:[function(b,r,s){var o=b("../utils/common"),v=b("./adler32"),u=b("./crc32"),w=b("./inffast"),L=b("./inftrees"),U=0,N=-2,D=1,f=852,P=592;function T(M){return(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24)}function B(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function G(M){var a;return M&&M.state?(a=M.state,M.total_in=M.total_out=a.total=0,M.msg="",a.wrap&&(M.adler=1&a.wrap),a.mode=D,a.last=0,a.havedict=0,a.dmax=32768,a.head=null,a.hold=0,a.bits=0,a.lencode=a.lendyn=new o.Buf32(f),a.distcode=a.distdyn=new o.Buf32(P),a.sane=1,a.back=-1,U):N}function R(M){var a;return M&&M.state?((a=M.state).wsize=0,a.whave=0,a.wnext=0,G(M)):N}function _(M,a){var h,y;return M&&M.state?(y=M.state,a<0?(h=0,a=-a):(h=1+(a>>4),a<48&&(a&=15)),a&&(a<8||15<a)?N:(y.window!==null&&y.wbits!==a&&(y.window=null),y.wrap=h,y.wbits=a,R(M))):N}function ee(M,a){var h,y;return M?(y=new B,(M.state=y).window=null,(h=_(M,a))!==U&&(M.state=null),h):N}var k,E,W=!0;function C(M){if(W){var a;for(k=new o.Buf32(512),E=new o.Buf32(32),a=0;a<144;)M.lens[a++]=8;for(;a<256;)M.lens[a++]=9;for(;a<280;)M.lens[a++]=7;for(;a<288;)M.lens[a++]=8;for(L(1,M.lens,0,288,k,0,M.work,{bits:9}),a=0;a<32;)M.lens[a++]=5;L(2,M.lens,0,32,E,0,M.work,{bits:5}),W=!1}M.lencode=k,M.lenbits=9,M.distcode=E,M.distbits=5}function F(M,a,h,y){var j,Y=M.state;return Y.window===null&&(Y.wsize=1<<Y.wbits,Y.wnext=0,Y.whave=0,Y.window=new o.Buf8(Y.wsize)),y>=Y.wsize?(o.arraySet(Y.window,a,h-Y.wsize,Y.wsize,0),Y.wnext=0,Y.whave=Y.wsize):(y<(j=Y.wsize-Y.wnext)&&(j=y),o.arraySet(Y.window,a,h-y,j,Y.wnext),(y-=j)?(o.arraySet(Y.window,a,h-y,y,0),Y.wnext=y,Y.whave=Y.wsize):(Y.wnext+=j,Y.wnext===Y.wsize&&(Y.wnext=0),Y.whave<Y.wsize&&(Y.whave+=j))),0}s.inflateReset=R,s.inflateReset2=_,s.inflateResetKeep=G,s.inflateInit=function(M){return ee(M,15)},s.inflateInit2=ee,s.inflate=function(M,a){var h,y,j,Y,q,V,ne,ie,he,be,je,xe,Fe,J,ge,oe,le,Re,Ye,Be,se,ve,Ee,rt,tt=0,xt=new o.Buf8(4),Rt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!M||!M.state||!M.output||!M.input&&M.avail_in!==0)return N;(h=M.state).mode===12&&(h.mode=13),q=M.next_out,j=M.output,ne=M.avail_out,Y=M.next_in,y=M.input,V=M.avail_in,ie=h.hold,he=h.bits,be=V,je=ne,ve=U;e:for(;;)switch(h.mode){case D:if(h.wrap===0){h.mode=13;break}for(;he<16;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}if(2&h.wrap&&ie===35615){xt[h.check=0]=255&ie,xt[1]=ie>>>8&255,h.check=u(h.check,xt,2,0),he=ie=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&ie)<<8)+(ie>>8))%31){M.msg="incorrect header check",h.mode=30;break}if((15&ie)!=8){M.msg="unknown compression method",h.mode=30;break}if(he-=4,se=8+(15&(ie>>>=4)),h.wbits===0)h.wbits=se;else if(se>h.wbits){M.msg="invalid window size",h.mode=30;break}h.dmax=1<<se,M.adler=h.check=1,h.mode=512&ie?10:12,he=ie=0;break;case 2:for(;he<16;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}if(h.flags=ie,(255&h.flags)!=8){M.msg="unknown compression method",h.mode=30;break}if(57344&h.flags){M.msg="unknown header flags set",h.mode=30;break}h.head&&(h.head.text=ie>>8&1),512&h.flags&&(xt[0]=255&ie,xt[1]=ie>>>8&255,h.check=u(h.check,xt,2,0)),he=ie=0,h.mode=3;case 3:for(;he<32;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}h.head&&(h.head.time=ie),512&h.flags&&(xt[0]=255&ie,xt[1]=ie>>>8&255,xt[2]=ie>>>16&255,xt[3]=ie>>>24&255,h.check=u(h.check,xt,4,0)),he=ie=0,h.mode=4;case 4:for(;he<16;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}h.head&&(h.head.xflags=255&ie,h.head.os=ie>>8),512&h.flags&&(xt[0]=255&ie,xt[1]=ie>>>8&255,h.check=u(h.check,xt,2,0)),he=ie=0,h.mode=5;case 5:if(1024&h.flags){for(;he<16;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}h.length=ie,h.head&&(h.head.extra_len=ie),512&h.flags&&(xt[0]=255&ie,xt[1]=ie>>>8&255,h.check=u(h.check,xt,2,0)),he=ie=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(V<(xe=h.length)&&(xe=V),xe&&(h.head&&(se=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Array(h.head.extra_len)),o.arraySet(h.head.extra,y,Y,xe,se)),512&h.flags&&(h.check=u(h.check,y,xe,Y)),V-=xe,Y+=xe,h.length-=xe),h.length))break e;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(V===0)break e;for(xe=0;se=y[Y+xe++],h.head&&se&&h.length<65536&&(h.head.name+=String.fromCharCode(se)),se&&xe<V;);if(512&h.flags&&(h.check=u(h.check,y,xe,Y)),V-=xe,Y+=xe,se)break e}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(V===0)break e;for(xe=0;se=y[Y+xe++],h.head&&se&&h.length<65536&&(h.head.comment+=String.fromCharCode(se)),se&&xe<V;);if(512&h.flags&&(h.check=u(h.check,y,xe,Y)),V-=xe,Y+=xe,se)break e}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;he<16;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}if(ie!==(65535&h.check)){M.msg="header crc mismatch",h.mode=30;break}he=ie=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),M.adler=h.check=0,h.mode=12;break;case 10:for(;he<32;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}M.adler=h.check=T(ie),he=ie=0,h.mode=11;case 11:if(h.havedict===0)return M.next_out=q,M.avail_out=ne,M.next_in=Y,M.avail_in=V,h.hold=ie,h.bits=he,2;M.adler=h.check=1,h.mode=12;case 12:if(a===5||a===6)break e;case 13:if(h.last){ie>>>=7&he,he-=7&he,h.mode=27;break}for(;he<3;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}switch(h.last=1&ie,--he,3&(ie>>>=1)){case 0:h.mode=14;break;case 1:if(C(h),h.mode=20,a!==6)break;ie>>>=2,he-=2;break e;case 2:h.mode=17;break;case 3:M.msg="invalid block type",h.mode=30}ie>>>=2,he-=2;break;case 14:for(ie>>>=7&he,he-=7&he;he<32;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}if((65535&ie)!=(ie>>>16^65535)){M.msg="invalid stored block lengths",h.mode=30;break}if(h.length=65535&ie,he=ie=0,h.mode=15,a===6)break e;case 15:h.mode=16;case 16:if(xe=h.length){if(V<xe&&(xe=V),ne<xe&&(xe=ne),xe===0)break e;o.arraySet(j,y,Y,xe,q),V-=xe,Y+=xe,ne-=xe,q+=xe,h.length-=xe;break}h.mode=12;break;case 17:for(;he<14;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}if(h.nlen=257+(31&ie),ie>>>=5,he-=5,h.ndist=1+(31&ie),ie>>>=5,he-=5,h.ncode=4+(15&ie),ie>>>=4,he-=4,286<h.nlen||30<h.ndist){M.msg="too many length or distance symbols",h.mode=30;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;he<3;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}h.lens[Rt[h.have++]]=7&ie,ie>>>=3,he-=3}for(;h.have<19;)h.lens[Rt[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,Ee={bits:h.lenbits},ve=L(0,h.lens,0,19,h.lencode,0,h.work,Ee),h.lenbits=Ee.bits,ve){M.msg="invalid code lengths set",h.mode=30;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;oe=(tt=h.lencode[ie&(1<<h.lenbits)-1])>>>16&255,le=65535&tt,!((ge=tt>>>24)<=he);){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}if(le<16)ie>>>=ge,he-=ge,h.lens[h.have++]=le;else{if(le===16){for(rt=ge+2;he<rt;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}if(ie>>>=ge,he-=ge,h.have===0){M.msg="invalid bit length repeat",h.mode=30;break}se=h.lens[h.have-1],xe=3+(3&ie),ie>>>=2,he-=2}else if(le===17){for(rt=ge+3;he<rt;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}he-=ge,se=0,xe=3+(7&(ie>>>=ge)),ie>>>=3,he-=3}else{for(rt=ge+7;he<rt;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}he-=ge,se=0,xe=11+(127&(ie>>>=ge)),ie>>>=7,he-=7}if(h.have+xe>h.nlen+h.ndist){M.msg="invalid bit length repeat",h.mode=30;break}for(;xe--;)h.lens[h.have++]=se}}if(h.mode===30)break;if(h.lens[256]===0){M.msg="invalid code -- missing end-of-block",h.mode=30;break}if(h.lenbits=9,Ee={bits:h.lenbits},ve=L(1,h.lens,0,h.nlen,h.lencode,0,h.work,Ee),h.lenbits=Ee.bits,ve){M.msg="invalid literal/lengths set",h.mode=30;break}if(h.distbits=6,h.distcode=h.distdyn,Ee={bits:h.distbits},ve=L(2,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,Ee),h.distbits=Ee.bits,ve){M.msg="invalid distances set",h.mode=30;break}if(h.mode=20,a===6)break e;case 20:h.mode=21;case 21:if(6<=V&&258<=ne){M.next_out=q,M.avail_out=ne,M.next_in=Y,M.avail_in=V,h.hold=ie,h.bits=he,w(M,je),q=M.next_out,j=M.output,ne=M.avail_out,Y=M.next_in,y=M.input,V=M.avail_in,ie=h.hold,he=h.bits,h.mode===12&&(h.back=-1);break}for(h.back=0;oe=(tt=h.lencode[ie&(1<<h.lenbits)-1])>>>16&255,le=65535&tt,!((ge=tt>>>24)<=he);){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}if(oe&&!(240&oe)){for(Re=ge,Ye=oe,Be=le;oe=(tt=h.lencode[Be+((ie&(1<<Re+Ye)-1)>>Re)])>>>16&255,le=65535&tt,!(Re+(ge=tt>>>24)<=he);){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}ie>>>=Re,he-=Re,h.back+=Re}if(ie>>>=ge,he-=ge,h.back+=ge,h.length=le,oe===0){h.mode=26;break}if(32&oe){h.back=-1,h.mode=12;break}if(64&oe){M.msg="invalid literal/length code",h.mode=30;break}h.extra=15&oe,h.mode=22;case 22:if(h.extra){for(rt=h.extra;he<rt;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}h.length+=ie&(1<<h.extra)-1,ie>>>=h.extra,he-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;oe=(tt=h.distcode[ie&(1<<h.distbits)-1])>>>16&255,le=65535&tt,!((ge=tt>>>24)<=he);){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}if(!(240&oe)){for(Re=ge,Ye=oe,Be=le;oe=(tt=h.distcode[Be+((ie&(1<<Re+Ye)-1)>>Re)])>>>16&255,le=65535&tt,!(Re+(ge=tt>>>24)<=he);){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}ie>>>=Re,he-=Re,h.back+=Re}if(ie>>>=ge,he-=ge,h.back+=ge,64&oe){M.msg="invalid distance code",h.mode=30;break}h.offset=le,h.extra=15&oe,h.mode=24;case 24:if(h.extra){for(rt=h.extra;he<rt;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}h.offset+=ie&(1<<h.extra)-1,ie>>>=h.extra,he-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){M.msg="invalid distance too far back",h.mode=30;break}h.mode=25;case 25:if(ne===0)break e;if(xe=je-ne,h.offset>xe){if((xe=h.offset-xe)>h.whave&&h.sane){M.msg="invalid distance too far back",h.mode=30;break}Fe=xe>h.wnext?(xe-=h.wnext,h.wsize-xe):h.wnext-xe,xe>h.length&&(xe=h.length),J=h.window}else J=j,Fe=q-h.offset,xe=h.length;for(ne<xe&&(xe=ne),ne-=xe,h.length-=xe;j[q++]=J[Fe++],--xe;);h.length===0&&(h.mode=21);break;case 26:if(ne===0)break e;j[q++]=h.length,ne--,h.mode=21;break;case 27:if(h.wrap){for(;he<32;){if(V===0)break e;V--,ie|=y[Y++]<<he,he+=8}if(je-=ne,M.total_out+=je,h.total+=je,je&&(M.adler=h.check=(h.flags?u:v)(h.check,j,je,q-je)),je=ne,(h.flags?ie:T(ie))!==h.check){M.msg="incorrect data check",h.mode=30;break}he=ie=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;he<32;){if(V===0)break e;V--,ie+=y[Y++]<<he,he+=8}if(ie!==(4294967295&h.total)){M.msg="incorrect length check",h.mode=30;break}he=ie=0}h.mode=29;case 29:ve=1;break e;case 30:ve=-3;break e;case 31:return-4;default:return N}return M.next_out=q,M.avail_out=ne,M.next_in=Y,M.avail_in=V,h.hold=ie,h.bits=he,(h.wsize||je!==M.avail_out&&h.mode<30&&(h.mode<27||a!==4))&&F(M,M.output,M.next_out,je-M.avail_out)?(h.mode=31,-4):(be-=M.avail_in,je-=M.avail_out,M.total_in+=be,M.total_out+=je,h.total+=je,h.wrap&&je&&(M.adler=h.check=(h.flags?u:v)(h.check,j,je,M.next_out-je)),M.data_type=h.bits+(h.last?64:0)+(h.mode===12?128:0)+(h.mode===20||h.mode===15?256:0),(be==0&&je===0||a===4)&&ve===U&&(ve=-5),ve)},s.inflateEnd=function(M){if(!M||!M.state)return N;var a=M.state;return a.window&&(a.window=null),M.state=null,U},s.inflateGetHeader=function(M,a){var h;return M&&M.state&&2&(h=M.state).wrap?((h.head=a).done=!1,U):N},s.inflateSetDictionary=function(M,a){var h,y=a.length;return!M||!M.state||(h=M.state).wrap!==0&&h.mode!==11?N:h.mode===11&&v(1,a,y,0)!==h.check?-3:F(M,a,y,y)?(h.mode=31,-4):(h.havedict=1,U)},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":4,"./adler32":6,"./crc32":8,"./inffast":11,"./inftrees":13}],13:[function(b,r,s){var o=b("../utils/common"),v=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],w=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],L=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(U,N,D,f,P,T,B,G){var R,_,ee,k,E,W,C,F,M,a=G.bits,h=0,y=0,j=0,Y=0,q=0,V=0,ne=0,ie=0,he=0,be=0,je=null,xe=0,Fe=new o.Buf16(16),J=new o.Buf16(16),ge=null,oe=0;for(h=0;h<=15;h++)Fe[h]=0;for(y=0;y<f;y++)Fe[N[D+y]]++;for(q=a,Y=15;1<=Y&&Fe[Y]===0;Y--);if(Y<q&&(q=Y),Y===0)return P[T++]=20971520,P[T++]=20971520,G.bits=1,0;for(j=1;j<Y&&Fe[j]===0;j++);for(q<j&&(q=j),h=ie=1;h<=15;h++)if(ie<<=1,(ie-=Fe[h])<0)return-1;if(0<ie&&(U===0||Y!==1))return-1;for(J[1]=0,h=1;h<15;h++)J[h+1]=J[h]+Fe[h];for(y=0;y<f;y++)N[D+y]!==0&&(B[J[N[D+y]]++]=y);if(W=U===0?(je=ge=B,19):U===1?(je=v,xe-=257,ge=u,oe-=257,256):(je=w,ge=L,-1),h=j,E=T,ne=y=be=0,ee=-1,k=(he=1<<(V=q))-1,U===1&&852<he||U===2&&592<he)return 1;for(;;){for(C=h-ne,M=B[y]<W?(F=0,B[y]):B[y]>W?(F=ge[oe+B[y]],je[xe+B[y]]):(F=96,0),R=1<<h-ne,j=_=1<<V;P[E+(be>>ne)+(_-=R)]=C<<24|F<<16|M|0,_!==0;);for(R=1<<h-1;be&R;)R>>=1;if(R!==0?(be&=R-1,be+=R):be=0,y++,--Fe[h]==0){if(h===Y)break;h=N[D+B[y]]}if(q<h&&(be&k)!==ee){for(ne===0&&(ne=q),E+=j,ie=1<<(V=h-ne);V+ne<Y&&!((ie-=Fe[V+ne])<=0);)V++,ie<<=1;if(he+=1<<V,U===1&&852<he||U===2&&592<he)return 1;P[ee=be&k]=q<<24|V<<16|E-T|0}}return be!==0&&(P[E+be]=h-ne<<24|64<<16|0),G.bits=q,0}},{"../utils/common":4}],14:[function(b,r,s){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],15:[function(b,r,s){var o=b("../utils/common");function v(oe){for(var le=oe.length;0<=--le;)oe[le]=0}var u=256,w=286,L=30,U=15,N=16,D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],f=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],B=new Array(576);v(B);var G=new Array(60);v(G);var R=new Array(512);v(R);var _=new Array(256);v(_);var ee=new Array(29);v(ee);var k,E,W,C=new Array(L);function F(oe,le,Re,Ye,Be){this.static_tree=oe,this.extra_bits=le,this.extra_base=Re,this.elems=Ye,this.max_length=Be,this.has_stree=oe&&oe.length}function M(oe,le){this.dyn_tree=oe,this.max_code=0,this.stat_desc=le}function a(oe){return oe<256?R[oe]:R[256+(oe>>>7)]}function h(oe,le){oe.pending_buf[oe.pending++]=255&le,oe.pending_buf[oe.pending++]=le>>>8&255}function y(oe,le,Re){oe.bi_valid>N-Re?(oe.bi_buf|=le<<oe.bi_valid&65535,h(oe,oe.bi_buf),oe.bi_buf=le>>N-oe.bi_valid,oe.bi_valid+=Re-N):(oe.bi_buf|=le<<oe.bi_valid&65535,oe.bi_valid+=Re)}function j(oe,le,Re){y(oe,Re[2*le],Re[2*le+1])}function Y(oe,le){for(var Re=0;Re|=1&oe,oe>>>=1,Re<<=1,0<--le;);return Re>>>1}function q(oe,le,Re){var Ye,Be,se=new Array(U+1),ve=0;for(Ye=1;Ye<=U;Ye++)se[Ye]=ve=ve+Re[Ye-1]<<1;for(Be=0;Be<=le;Be++){var Ee=oe[2*Be+1];Ee!==0&&(oe[2*Be]=Y(se[Ee]++,Ee))}}function V(oe){var le;for(le=0;le<w;le++)oe.dyn_ltree[2*le]=0;for(le=0;le<L;le++)oe.dyn_dtree[2*le]=0;for(le=0;le<19;le++)oe.bl_tree[2*le]=0;oe.dyn_ltree[512]=1,oe.opt_len=oe.static_len=0,oe.last_lit=oe.matches=0}function ne(oe){8<oe.bi_valid?h(oe,oe.bi_buf):0<oe.bi_valid&&(oe.pending_buf[oe.pending++]=oe.bi_buf),oe.bi_buf=0,oe.bi_valid=0}function ie(oe,le,Re,Ye){var Be=2*le,se=2*Re;return oe[Be]<oe[se]||oe[Be]===oe[se]&&Ye[le]<=Ye[Re]}function he(oe,le,Re){for(var Ye=oe.heap[Re],Be=Re<<1;Be<=oe.heap_len&&(Be<oe.heap_len&&ie(le,oe.heap[Be+1],oe.heap[Be],oe.depth)&&Be++,!ie(le,Ye,oe.heap[Be],oe.depth));)oe.heap[Re]=oe.heap[Be],Re=Be,Be<<=1;oe.heap[Re]=Ye}function be(oe,le,Re){var Ye,Be,se,ve,Ee=0;if(oe.last_lit!==0)for(;Ye=oe.pending_buf[oe.d_buf+2*Ee]<<8|oe.pending_buf[oe.d_buf+2*Ee+1],Be=oe.pending_buf[oe.l_buf+Ee],Ee++,Ye===0?j(oe,Be,le):(j(oe,(se=_[Be])+u+1,le),(ve=D[se])!==0&&y(oe,Be-=ee[se],ve),j(oe,se=a(--Ye),Re),(ve=f[se])!==0&&y(oe,Ye-=C[se],ve)),Ee<oe.last_lit;);j(oe,256,le)}function je(oe,le){var Re,Ye,Be,se=le.dyn_tree,ve=le.stat_desc.static_tree,Ee=le.stat_desc.has_stree,rt=le.stat_desc.elems,tt=-1;for(oe.heap_len=0,oe.heap_max=573,Re=0;Re<rt;Re++)se[2*Re]!==0?(oe.heap[++oe.heap_len]=tt=Re,oe.depth[Re]=0):se[2*Re+1]=0;for(;oe.heap_len<2;)se[2*(Be=oe.heap[++oe.heap_len]=tt<2?++tt:0)]=1,oe.depth[Be]=0,oe.opt_len--,Ee&&(oe.static_len-=ve[2*Be+1]);for(le.max_code=tt,Re=oe.heap_len>>1;1<=Re;Re--)he(oe,se,Re);for(Be=rt;Re=oe.heap[1],oe.heap[1]=oe.heap[oe.heap_len--],he(oe,se,1),Ye=oe.heap[1],oe.heap[--oe.heap_max]=Re,oe.heap[--oe.heap_max]=Ye,se[2*Be]=se[2*Re]+se[2*Ye],oe.depth[Be]=(oe.depth[Re]>=oe.depth[Ye]?oe.depth[Re]:oe.depth[Ye])+1,se[2*Re+1]=se[2*Ye+1]=Be,oe.heap[1]=Be++,he(oe,se,1),2<=oe.heap_len;);oe.heap[--oe.heap_max]=oe.heap[1],function(xt,Rt){var At,He,Gt,jt,Tn,mn,Qn=Rt.dyn_tree,gt=Rt.max_code,ze=Rt.stat_desc.static_tree,Zt=Rt.stat_desc.has_stree,Rn=Rt.stat_desc.extra_bits,Xn=Rt.stat_desc.extra_base,pt=Rt.stat_desc.max_length,st=0;for(jt=0;jt<=U;jt++)xt.bl_count[jt]=0;for(Qn[2*xt.heap[xt.heap_max]+1]=0,At=xt.heap_max+1;At<573;At++)pt<(jt=Qn[2*Qn[2*(He=xt.heap[At])+1]+1]+1)&&(jt=pt,st++),Qn[2*He+1]=jt,gt<He||(xt.bl_count[jt]++,Tn=0,Xn<=He&&(Tn=Rn[He-Xn]),mn=Qn[2*He],xt.opt_len+=mn*(jt+Tn),Zt&&(xt.static_len+=mn*(ze[2*He+1]+Tn)));if(st!==0){do{for(jt=pt-1;xt.bl_count[jt]===0;)jt--;xt.bl_count[jt]--,xt.bl_count[jt+1]+=2,xt.bl_count[pt]--,st-=2}while(0<st);for(jt=pt;jt!==0;jt--)for(He=xt.bl_count[jt];He!==0;)gt<(Gt=xt.heap[--At])||(Qn[2*Gt+1]!==jt&&(xt.opt_len+=(jt-Qn[2*Gt+1])*Qn[2*Gt],Qn[2*Gt+1]=jt),He--)}}(oe,le),q(se,tt,oe.bl_count)}function xe(oe,le,Re){var Ye,Be,se=-1,ve=le[1],Ee=0,rt=7,tt=4;for(ve===0&&(rt=138,tt=3),le[2*(Re+1)+1]=65535,Ye=0;Ye<=Re;Ye++)Be=ve,ve=le[2*(Ye+1)+1],++Ee<rt&&Be===ve||(Ee<tt?oe.bl_tree[2*Be]+=Ee:Be!==0?(Be!==se&&oe.bl_tree[2*Be]++,oe.bl_tree[32]++):Ee<=10?oe.bl_tree[34]++:oe.bl_tree[36]++,se=Be,tt=(Ee=0)===ve?(rt=138,3):Be===ve?(rt=6,3):(rt=7,4))}function Fe(oe,le,Re){var Ye,Be,se=-1,ve=le[1],Ee=0,rt=7,tt=4;for(ve===0&&(rt=138,tt=3),Ye=0;Ye<=Re;Ye++)if(Be=ve,ve=le[2*(Ye+1)+1],!(++Ee<rt&&Be===ve)){if(Ee<tt)for(;j(oe,Be,oe.bl_tree),--Ee!=0;);else Be!==0?(Be!==se&&(j(oe,Be,oe.bl_tree),Ee--),j(oe,16,oe.bl_tree),y(oe,Ee-3,2)):Ee<=10?(j(oe,17,oe.bl_tree),y(oe,Ee-3,3)):(j(oe,18,oe.bl_tree),y(oe,Ee-11,7));se=Be,tt=(Ee=0)===ve?(rt=138,3):Be===ve?(rt=6,3):(rt=7,4)}}v(C);var J=!1;function ge(oe,le,Re,Ye){var Be,se,ve;y(oe,0+(Ye?1:0),3),se=le,ve=Re,ne(Be=oe),h(Be,ve),h(Be,~ve),o.arraySet(Be.pending_buf,Be.window,se,ve,Be.pending),Be.pending+=ve}s._tr_init=function(oe){J||(function(){var le,Re,Ye,Be,se,ve=new Array(U+1);for(Be=Ye=0;Be<28;Be++)for(ee[Be]=Ye,le=0;le<1<<D[Be];le++)_[Ye++]=Be;for(_[Ye-1]=Be,Be=se=0;Be<16;Be++)for(C[Be]=se,le=0;le<1<<f[Be];le++)R[se++]=Be;for(se>>=7;Be<L;Be++)for(C[Be]=se<<7,le=0;le<1<<f[Be]-7;le++)R[256+se++]=Be;for(Re=0;Re<=U;Re++)ve[Re]=0;for(le=0;le<=143;)B[2*le+1]=8,le++,ve[8]++;for(;le<=255;)B[2*le+1]=9,le++,ve[9]++;for(;le<=279;)B[2*le+1]=7,le++,ve[7]++;for(;le<=287;)B[2*le+1]=8,le++,ve[8]++;for(q(B,287,ve),le=0;le<L;le++)G[2*le+1]=5,G[2*le]=Y(le,5);k=new F(B,D,257,w,U),E=new F(G,f,0,L,U),W=new F(new Array(0),P,0,19,7)}(),J=!0),oe.l_desc=new M(oe.dyn_ltree,k),oe.d_desc=new M(oe.dyn_dtree,E),oe.bl_desc=new M(oe.bl_tree,W),oe.bi_buf=0,oe.bi_valid=0,V(oe)},s._tr_stored_block=ge,s._tr_flush_block=function(oe,le,Re,Ye){var Be,se,ve=0;0<oe.level?(oe.strm.data_type===2&&(oe.strm.data_type=function(Ee){var rt,tt=4093624447;for(rt=0;rt<=31;rt++,tt>>>=1)if(1&tt&&Ee.dyn_ltree[2*rt]!==0)return 0;if(Ee.dyn_ltree[18]!==0||Ee.dyn_ltree[20]!==0||Ee.dyn_ltree[26]!==0)return 1;for(rt=32;rt<u;rt++)if(Ee.dyn_ltree[2*rt]!==0)return 1;return 0}(oe)),je(oe,oe.l_desc),je(oe,oe.d_desc),ve=function(Ee){var rt;for(xe(Ee,Ee.dyn_ltree,Ee.l_desc.max_code),xe(Ee,Ee.dyn_dtree,Ee.d_desc.max_code),je(Ee,Ee.bl_desc),rt=18;3<=rt&&Ee.bl_tree[2*T[rt]+1]===0;rt--);return Ee.opt_len+=3*(rt+1)+5+5+4,rt}(oe),Be=oe.opt_len+3+7>>>3,(se=oe.static_len+3+7>>>3)<=Be&&(Be=se)):Be=se=Re+5,Re+4<=Be&&le!==-1?ge(oe,le,Re,Ye):oe.strategy===4||se===Be?(y(oe,2+(Ye?1:0),3),be(oe,B,G)):(y(oe,4+(Ye?1:0),3),function(Ee,rt,tt,xt){var Rt;for(y(Ee,rt-257,5),y(Ee,tt-1,5),y(Ee,xt-4,4),Rt=0;Rt<xt;Rt++)y(Ee,Ee.bl_tree[2*T[Rt]+1],3);Fe(Ee,Ee.dyn_ltree,rt-1),Fe(Ee,Ee.dyn_dtree,tt-1)}(oe,oe.l_desc.max_code+1,oe.d_desc.max_code+1,ve+1),be(oe,oe.dyn_ltree,oe.dyn_dtree)),V(oe),Ye&&ne(oe)},s._tr_tally=function(oe,le,Re){return oe.pending_buf[oe.d_buf+2*oe.last_lit]=le>>>8&255,oe.pending_buf[oe.d_buf+2*oe.last_lit+1]=255&le,oe.pending_buf[oe.l_buf+oe.last_lit]=255&Re,oe.last_lit++,le===0?oe.dyn_ltree[2*Re]++:(oe.matches++,le--,oe.dyn_ltree[2*(_[Re]+u+1)]++,oe.dyn_dtree[2*a(le)]++),oe.last_lit===oe.lit_bufsize-1},s._tr_align=function(oe){var le;y(oe,2,3),j(oe,256,B),(le=oe).bi_valid===16?(h(le,le.bi_buf),le.bi_buf=0,le.bi_valid=0):8<=le.bi_valid&&(le.pending_buf[le.pending++]=255&le.bi_buf,le.bi_buf>>=8,le.bi_valid-=8)}},{"../utils/common":4}],16:[function(b,r,s){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],17:[function(b,r,s){var o=b("three");o.OrbitControls=function(v,u){var w,L,U,N,D;u===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),u===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=v,this.domElement=u,this.enabled=!0,this.target=new o.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:o.MOUSE.ROTATE,MIDDLE:o.MOUSE.DOLLY,RIGHT:o.MOUSE.PAN},this.touches={ONE:o.TOUCH.ROTATE,TWO:o.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return ee.phi},this.getAzimuthalAngle=function(){return ee.theta},this.saveState=function(){f.target0.copy(f.target),f.position0.copy(f.object.position),f.zoom0=f.object.zoom},this.resetStatusValue=function(){R=G.NONE},this.reset=function(){f.target.copy(f.target0),f.object.position.copy(f.position0),f.object.zoom=f.zoom0,f.object.updateProjectionMatrix(),f.dispatchEvent(P),f.update(),R=G.NONE},this.update=(w=new o.Vector3,L=new o.Quaternion().setFromUnitVectors(v.up,new o.Vector3(0,1,0)),U=L.clone().inverse(),N=new o.Vector3,D=new o.Quaternion,function(){var gt=f.object.position;return w.copy(gt).sub(f.target),w.applyQuaternion(L),ee.setFromVector3(w),f.autoRotate&&R===G.NONE&&ie(2*Math.PI/60/60*f.autoRotateSpeed),f.enableDamping?(ee.theta+=k.theta*f.dampingFactor,ee.phi+=k.phi*f.dampingFactor):(ee.theta+=k.theta,ee.phi+=k.phi),ee.theta=Math.max(f.minAzimuthAngle,Math.min(f.maxAzimuthAngle,ee.theta)),ee.phi=Math.max(f.minPolarAngle,Math.min(f.maxPolarAngle,ee.phi)),ee.makeSafe(),ee.radius*=E,ee.radius=Math.max(f.minDistance,Math.min(f.maxDistance,ee.radius)),f.enableDamping===!0?f.target.addScaledVector(W,f.dampingFactor):f.target.add(W),w.setFromSpherical(ee),w.applyQuaternion(U),gt.copy(f.target).add(w),f.object.lookAt(f.target),f.enableDamping===!0?(k.theta*=1-f.dampingFactor,k.phi*=1-f.dampingFactor,W.multiplyScalar(1-f.dampingFactor)):(k.set(0,0,0),W.set(0,0,0)),E=1,!(!(C||N.distanceToSquared(f.object.position)>_||8*(1-D.dot(f.object.quaternion))>_)||(f.dispatchEvent(P),N.copy(f.object.position),D.copy(f.object.quaternion),C=!1))}),this.dispose=function(){f.domElement.removeEventListener("contextmenu",Qn,!1),f.domElement.removeEventListener("mousedown",tt,!1),f.domElement.removeEventListener("wheel",At,!1),f.domElement.removeEventListener("touchstart",jt,!1),f.domElement.removeEventListener("touchend",mn,!1),f.domElement.removeEventListener("touchmove",Tn,!1),document.removeEventListener("mousemove",xt,!1),document.removeEventListener("mouseup",Rt,!1),f.domElement.removeEventListener("keydown",He,!1)};var f=this,P={type:"change"},T={type:"start"},B={type:"end"},G={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},R=G.NONE,_=1e-6,ee=new o.Spherical,k=new o.Spherical,E=1,W=new o.Vector3,C=!1,F=new o.Vector2,M=new o.Vector2,a=new o.Vector2,h=new o.Vector2,y=new o.Vector2,j=new o.Vector2,Y=new o.Vector2,q=new o.Vector2,V=new o.Vector2;function ne(){return Math.pow(.95,f.zoomSpeed)}function ie(gt){k.theta-=gt}function he(gt){k.phi-=gt}var be,je,xe,Fe=(be=new o.Vector3,function(gt,ze){be.setFromMatrixColumn(ze,0),be.multiplyScalar(-gt),W.add(be)}),J=(je=new o.Vector3,function(gt,ze){f.screenSpacePanning===!0?je.setFromMatrixColumn(ze,1):(je.setFromMatrixColumn(ze,0),je.crossVectors(f.object.up,je)),je.multiplyScalar(gt),W.add(je)}),ge=(xe=new o.Vector3,function(gt,ze){var Zt=f.domElement;if(f.object.isPerspectiveCamera){var Rn=f.object.position;xe.copy(Rn).sub(f.target);var Xn=xe.length();Xn*=Math.tan(f.object.fov/2*Math.PI/180),Fe(2*gt*Xn/Zt.clientHeight,f.object.matrix),J(2*ze*Xn/Zt.clientHeight,f.object.matrix)}else f.object.isOrthographicCamera?(Fe(gt*(f.object.right-f.object.left)/f.object.zoom/Zt.clientWidth,f.object.matrix),J(ze*(f.object.top-f.object.bottom)/f.object.zoom/Zt.clientHeight,f.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),f.enablePan=!1)});function oe(gt){f.object.isPerspectiveCamera?E/=gt:f.object.isOrthographicCamera?(f.object.zoom=Math.max(f.minZoom,Math.min(f.maxZoom,f.object.zoom*gt)),f.object.updateProjectionMatrix(),C=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),f.enableZoom=!1)}function le(gt){F.set(gt.clientX,gt.clientY)}function Re(gt){h.set(gt.clientX,gt.clientY)}function Ye(gt){if(gt.touches.length==1)F.set(gt.touches[0].pageX,gt.touches[0].pageY);else{var ze=.5*(gt.touches[0].pageX+gt.touches[1].pageX),Zt=.5*(gt.touches[0].pageY+gt.touches[1].pageY);F.set(ze,Zt)}}function Be(gt){if(gt.touches.length==1)h.set(gt.touches[0].pageX,gt.touches[0].pageY);else{var ze=.5*(gt.touches[0].pageX+gt.touches[1].pageX),Zt=.5*(gt.touches[0].pageY+gt.touches[1].pageY);h.set(ze,Zt)}}function se(gt){var ze=gt.touches[0].pageX-gt.touches[1].pageX,Zt=gt.touches[0].pageY-gt.touches[1].pageY,Rn=Math.sqrt(ze*ze+Zt*Zt);Y.set(0,Rn)}function ve(gt){if(gt.touches.length==1)M.set(gt.touches[0].pageX,gt.touches[0].pageY);else{var ze=.5*(gt.touches[0].pageX+gt.touches[1].pageX),Zt=.5*(gt.touches[0].pageY+gt.touches[1].pageY);M.set(ze,Zt)}a.subVectors(M,F).multiplyScalar(f.rotateSpeed);var Rn=f.domElement;ie(2*Math.PI*a.x/Rn.clientHeight),he(2*Math.PI*a.y/Rn.clientHeight),F.copy(M)}function Ee(gt){if(gt.touches.length==1)y.set(gt.touches[0].pageX,gt.touches[0].pageY);else{var ze=.5*(gt.touches[0].pageX+gt.touches[1].pageX),Zt=.5*(gt.touches[0].pageY+gt.touches[1].pageY);y.set(ze,Zt)}j.subVectors(y,h).multiplyScalar(f.panSpeed),ge(j.x,j.y),h.copy(y)}function rt(gt){var ze=gt.touches[0].pageX-gt.touches[1].pageX,Zt=gt.touches[0].pageY-gt.touches[1].pageY,Rn=Math.sqrt(ze*ze+Zt*Zt);q.set(0,Rn),V.set(0,Math.pow(q.y/Y.y,f.zoomSpeed)),oe(V.y),Y.copy(q)}function tt(gt){if(f.enabled!==!1){switch(gt.preventDefault(),f.domElement.focus?f.domElement.focus():window.focus(),gt.button){case 0:switch(f.mouseButtons.LEFT){case o.MOUSE.ROTATE:if(gt.ctrlKey||gt.metaKey||gt.shiftKey){if(f.enablePan===!1)return;Re(gt),R=G.PAN}else{if(f.enableRotate===!1)return;le(gt),R=G.ROTATE}break;case o.MOUSE.PAN:if(gt.ctrlKey||gt.metaKey||gt.shiftKey){if(f.enableRotate===!1)return;le(gt),R=G.ROTATE}else{if(f.enablePan===!1)return;Re(gt),R=G.PAN}break;default:R=G.NONE}break;case 1:switch(f.mouseButtons.MIDDLE){case o.MOUSE.DOLLY:if(f.enableZoom===!1)return;ze=gt,Y.set(ze.clientX,ze.clientY),R=G.DOLLY;break;case o.MOUSE.PAN:if(f.enablePan===!1)return;Re(gt),R=G.PAN;break;default:R=G.NONE}break;case 2:switch(f.mouseButtons.RIGHT){case o.MOUSE.ROTATE:if(f.enableRotate===!1)return;le(gt),R=G.ROTATE;break;case o.MOUSE.PAN:if(f.enablePan===!1)return;Re(gt),R=G.PAN;break;default:R=G.NONE}}var ze;R!==G.NONE&&(document.addEventListener("mousemove",xt,!1),document.addEventListener("mouseup",Rt,!1),f.dispatchEvent(T))}}function xt(gt){var ze;if(f.enabled!==!1)switch(gt.preventDefault(),R){case G.ROTATE:if(f.enableRotate===!1)return;(function(Zt){M.set(Zt.clientX,Zt.clientY),a.subVectors(M,F).multiplyScalar(f.rotateSpeed);var Rn=f.domElement;ie(2*Math.PI*a.x/Rn.clientHeight),he(2*Math.PI*a.y/Rn.clientHeight),F.copy(M),f.update()})(gt);break;case G.DOLLY:if(f.enableZoom===!1)return;(function(Zt){var Rn;q.set(Zt.clientX,Zt.clientY),V.subVectors(q,Y),0<V.y?oe(ne()):V.y<0&&(Rn=ne(),f.object.isPerspectiveCamera?E*=Rn:f.object.isOrthographicCamera?(f.object.zoom=Math.max(f.minZoom,Math.min(f.maxZoom,f.object.zoom/Rn)),f.object.updateProjectionMatrix(),C=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),f.enableZoom=!1)),Y.copy(q),f.update()})(gt);break;case G.PAN:if(f.enablePan===!1)return;ze=gt,y.set(ze.clientX,ze.clientY),j.subVectors(y,h).multiplyScalar(f.panSpeed),ge(j.x,j.y),h.copy(y),f.update()}}function Rt(gt){f.enabled!==!1&&(document.removeEventListener("mousemove",xt,!1),document.removeEventListener("mouseup",Rt,!1),f.dispatchEvent(B),R=G.NONE)}function At(gt){f.enabled===!1||f.enableZoom===!1||R!==G.NONE&&R!==G.ROTATE||(gt.preventDefault(),gt.stopPropagation(),f.dispatchEvent(T),function(ze){ze.deltaY<0?function(Zt,Rn){if(f.object.isPerspectiveCamera)lt*=Zt;else if(f.object.isOrthographicCamera){var Xn=f.domElement.clientWidth,pt=f.domElement.clientHeight,st=(f.object.near+f.object.far)/(f.object.near-f.object.far),qt=Rn.offsetX,xn=Rn.offsetY,nn=new o.Vector3(qt/Xn*2-1,-xn/pt*2+1,st);nn.applyMatrix4(f.object.projectionMatrixInverse);var er=new o.Vector3(-1,-1,st),kr=new o.Vector3(1,1,st);er.applyMatrix4(f.object.projectionMatrixInverse),kr.applyMatrix4(f.object.projectionMatrixInverse);var ct=Math.max(f.minZoom,Math.min(f.maxZoom,1/Zt)),Ue=new o.Matrix4;Ue.makeTranslation(-nn.x,-nn.y,0);var lt=new o.Matrix4().scale(new o.Vector3(1/ct,1/ct,1/ct)),Wt=new o.Matrix4;Wt.makeTranslation(nn.x,nn.y,0);var Ke=new o.Matrix4().multiply(Wt).multiply(lt).multiply(Ue);er.applyMatrix4(Ke),kr.applyMatrix4(Ke),f.object.left=er.x,f.object.right=kr.x,f.object.top=kr.y,f.object.bottom=er.y,f.object.zoom=1,f.object.updateProjectionMatrix(),C=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),f.enableZoom=!1}(ne(),ze):0<ze.deltaY&&function(Zt,Rn){if(f.object.isPerspectiveCamera)lt/=Zt;else if(f.object.isOrthographicCamera){var Xn=f.domElement.clientWidth,pt=f.domElement.clientHeight,st=(f.object.near+f.object.far)/(f.object.near-f.object.far),qt=Rn.offsetX,xn=Rn.offsetY,nn=new o.Vector3(qt/Xn*2-1,-xn/pt*2+1,st);nn.applyMatrix4(f.object.projectionMatrixInverse);var er=new o.Vector3(-1,-1,st),kr=new o.Vector3(1,1,st);er.applyMatrix4(f.object.projectionMatrixInverse),kr.applyMatrix4(f.object.projectionMatrixInverse);var ct=Math.max(f.minZoom,Math.min(f.maxZoom,Zt)),Ue=new o.Matrix4;Ue.makeTranslation(-nn.x,-nn.y,0);var lt=new o.Matrix4().scale(new o.Vector3(1/ct,1/ct,1/ct)),Wt=new o.Matrix4;Wt.makeTranslation(nn.x,nn.y,0);var Ke=new o.Matrix4().multiply(Wt).multiply(lt).multiply(Ue);er.applyMatrix4(Ke),kr.applyMatrix4(Ke),f.object.left=er.x,f.object.right=kr.x,f.object.top=kr.y,f.object.bottom=er.y,f.object.zoom=1,f.object.updateProjectionMatrix(),C=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),f.enableZoom=!1}(ne(),ze),f.update()}(gt),f.dispatchEvent(B))}function He(gt){f.enabled!==!1&&f.enableKeys!==!1&&f.enablePan!==!1&&function(ze){var Zt=!1;switch(ze.keyCode){case f.keys.UP:ge(0,f.keyPanSpeed),Zt=!0;break;case f.keys.BOTTOM:ge(0,-f.keyPanSpeed),Zt=!0;break;case f.keys.LEFT:ge(f.keyPanSpeed,0),Zt=!0;break;case f.keys.RIGHT:ge(-f.keyPanSpeed,0),Zt=!0}Zt&&(ze.preventDefault(),f.update())}(gt)}function Gt(gt){switch(gt.touches.length){case 1:switch(f.touches.ONE){case o.TOUCH.ROTATE:if(f.enableRotate===!1)return;Ye(gt),R=G.TOUCH_ROTATE;break;case o.TOUCH.PAN:if(f.enablePan===!1)return;Be(gt),R=G.TOUCH_PAN;break;default:R=G.NONE}break;case 2:switch(f.touches.TWO){case o.TOUCH.DOLLY_PAN:if(f.enableZoom===!1&&f.enablePan===!1)return;Zt=gt,f.enableZoom&&se(Zt),f.enablePan&&Be(Zt),R=G.TOUCH_DOLLY_PAN;break;case o.TOUCH.DOLLY_ROTATE:if(f.enableZoom===!1&&f.enableRotate===!1)return;ze=gt,f.enableZoom&&se(ze),f.enableRotate&&Ye(ze),R=G.TOUCH_DOLLY_ROTATE;break;default:R=G.NONE}break;default:R=G.NONE}var ze,Zt}function jt(gt){f.enabled!==!1&&(gt.preventDefault(),Gt(gt),R!==G.NONE&&f.dispatchEvent(T))}function Tn(gt){var ze,Zt;if(f.enabled!==!1)switch(gt.preventDefault(),gt.stopPropagation(),R){case G.TOUCH_ROTATE:if(f.enableRotate===!1)return;ve(gt),f.update();break;case G.TOUCH_PAN:if(f.enablePan===!1)return;Ee(gt),f.update();break;case G.TOUCH_DOLLY_PAN:if(f.enableZoom===!1&&f.enablePan===!1)return;Zt=gt,f.enableZoom&&rt(Zt),f.enablePan&&Ee(Zt),f.update();break;case G.TOUCH_DOLLY_ROTATE:if(f.enableZoom===!1&&f.enableRotate===!1)return;ze=gt,f.enableZoom&&rt(ze),f.enableRotate&&ve(ze),f.update();break;default:Gt(gt)}}function mn(gt){f.enabled!==!1&&(f.dispatchEvent(B),R=G.NONE)}function Qn(gt){f.enabled!==!1&&gt.preventDefault()}f.domElement.addEventListener("contextmenu",Qn,!1),f.domElement.addEventListener("mousedown",tt,!1),f.domElement.addEventListener("wheel",At,!1),f.domElement.addEventListener("touchstart",jt,!1),f.domElement.addEventListener("touchend",mn,!1),f.domElement.addEventListener("touchmove",Tn,!1),f.domElement.addEventListener("keydown",He,!1),f.domElement.tabIndex===-1&&(f.domElement.tabIndex=0),this.update()},o.OrbitControls.prototype=Object.create(o.EventDispatcher.prototype),o.OrbitControls.prototype.constructor=o.OrbitControls,o.MapControls=function(v,u){o.OrbitControls.call(this,v,u),this.mouseButtons.LEFT=o.MOUSE.PAN,this.mouseButtons.RIGHT=o.MOUSE.ROTATE,this.touches.ONE=o.TOUCH.PAN,this.touches.TWO=o.TOUCH.DOLLY_ROTATE},o.MapControls.prototype=Object.create(o.EventDispatcher.prototype),o.MapControls.prototype.constructor=o.MapControls,s!==void 0&&(r!==void 0&&r.exports&&(s=r.exports={OrbitControls:o.OrbitControls,MapControls:o.MapControls}),s.OrbitControls=o.OrbitControls,s.MapControls=o.MapControls)},{three:19}],18:[function(b,r,s){(function(){var o,v,u,w=b!==void 0,L=this.THREE||w&&b("three");if(!L)throw new Error("MeshLine requires three.js");function U(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new L.BufferGeometry,this.widthCallback=null,this.matrixWorld=new L.Matrix4}function N(f,P,T,B,G){var R;if(f=f.subarray||f.slice?f:f.buffer,T=T.subarray||T.slice?T:T.buffer,f=P?f.subarray?f.subarray(P,G&&P+G):f.slice(P,G&&P+G):f,T.set)T.set(f,B);else for(R=0;R<f.length;R++)T[R+B]=f[R];return T}function D(f){L.ShaderMaterial.call(this,{uniforms:Object.assign({},L.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new L.Color(16777215)},opacity:{value:1},resolution:{value:new L.Vector2(1,1)},sizeAttenuation:{value:1},near:{value:1},far:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new L.Vector2(1,1)}}),vertexShader:L.ShaderChunk.meshline_vert,fragmentShader:L.ShaderChunk.meshline_frag}),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(P){this.uniforms.lineWidth.value=P}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(P){this.uniforms.map.value=P}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(P){this.uniforms.useMap.value=P}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(P){this.uniforms.alphaMap.value=P}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(P){this.uniforms.useAlphaMap.value=P}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(P){this.uniforms.color.value=P}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(P){this.uniforms.opacity.value=P}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(P){this.uniforms.resolution.value.copy(P)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(P){this.uniforms.sizeAttenuation.value=P}},near:{enumerable:!0,get:function(){return this.uniforms.near.value},set:function(P){this.uniforms.near.value=P}},far:{enumerable:!0,get:function(){return this.uniforms.far.value},set:function(P){this.uniforms.far.value=P}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(P){this.uniforms.dashArray.value=P,this.useDash=P!==0?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(P){this.uniforms.dashOffset.value=P}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(P){this.uniforms.dashRatio.value=P}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(P){this.uniforms.useDash.value=P}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(P){this.uniforms.visibility.value=P}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(P){this.uniforms.alphaTest.value=P}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(P){this.uniforms.repeat.value.copy(P)}}}),this.setValues(f)}U.prototype.setMatrixWorld=function(f){this.matrixWorld=f},U.prototype.setGeometry=function(f,P){if(this.widthCallback=P,this.positions=[],this.counters=[],f instanceof L.Geometry)for(var T=0;T<f.vertices.length;T++){var B=f.vertices[T];P=T/f.vertices.length,this.positions.push(B.x,B.y,B.z),this.positions.push(B.x,B.y,B.z),this.counters.push(P),this.counters.push(P)}if(L.BufferGeometry,f instanceof Float32Array||f instanceof Array)for(T=0;T<f.length;T+=3)P=T/f.length,this.positions.push(f[T],f[T+1],f[T+2]),this.positions.push(f[T],f[T+1],f[T+2]),this.counters.push(P),this.counters.push(P);this.process()},U.prototype.raycast=(o=new L.Matrix4,v=new L.Ray,u=new L.Sphere,function(f,P){var T=f.linePrecision,B=T*T,G=this.geometry;if(G.boundingSphere===null&&G.computeBoundingSphere(),u.copy(G.boundingSphere),u.applyMatrix4(this.matrixWorld),f.ray.intersectSphere(u)!==!1){o.getInverse(this.matrixWorld),v.copy(f.ray).applyMatrix4(o);var R=new L.Vector3,_=new L.Vector3,ee=new L.Vector3,k=new L.Vector3,E=this instanceof L.LineSegments?2:1;if(G instanceof L.BufferGeometry){var W=G.index,C=G.attributes;if(W!==null)for(var F=W.array,M=C.position.array,a=0,h=F.length-1;a<h;a+=E){var y=F[a],j=F[a+1];R.fromArray(M,3*y),_.fromArray(M,3*j),B<v.distanceSqToSegment(R,_,k,ee)||(k.applyMatrix4(this.matrixWorld),(V=f.ray.origin.distanceTo(k))<f.near||V>f.far||P.push({distance:V,point:ee.clone().applyMatrix4(this.matrixWorld),index:a,face:null,faceIndex:null,object:this}))}else for(a=0,h=(M=C.position.array).length/3-1;a<h;a+=E)R.fromArray(M,3*a),_.fromArray(M,3*a+3),B<v.distanceSqToSegment(R,_,k,ee)||(k.applyMatrix4(this.matrixWorld),(V=f.ray.origin.distanceTo(k))<f.near||V>f.far||P.push({distance:V,point:ee.clone().applyMatrix4(this.matrixWorld),index:a,face:null,faceIndex:null,object:this}))}else if(G instanceof L.Geometry){var Y=G.vertices,q=Y.length;for(a=0;a<q-1;a+=E){var V;B<v.distanceSqToSegment(Y[a],Y[a+1],k,ee)||(k.applyMatrix4(this.matrixWorld),(V=f.ray.origin.distanceTo(k))<f.near||V>f.far||P.push({distance:V,point:ee.clone().applyMatrix4(this.matrixWorld),index:a,face:null,faceIndex:null,object:this}))}}}}),U.prototype.compareV3=function(f,P){var T=6*f,B=6*P;return this.positions[T]===this.positions[B]&&this.positions[1+T]===this.positions[1+B]&&this.positions[2+T]===this.positions[2+B]},U.prototype.copyV3=function(f){var P=6*f;return[this.positions[P],this.positions[1+P],this.positions[2+P]]},U.prototype.process=function(){var f,P,T=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(var B=0;B<T;B++)this.side.push(1),this.side.push(-1);for(B=0;B<T;B++)f=this.widthCallback?this.widthCallback(B/(T-1)):1,this.width.push(f),this.width.push(f);for(B=0;B<T;B++)this.uvs.push(B/(T-1),0),this.uvs.push(B/(T-1),1);for(P=this.compareV3(0,T-1)?this.copyV3(T-2):this.copyV3(0),this.previous.push(P[0],P[1],P[2]),this.previous.push(P[0],P[1],P[2]),B=0;B<T-1;B++)P=this.copyV3(B),this.previous.push(P[0],P[1],P[2]),this.previous.push(P[0],P[1],P[2]);for(B=1;B<T;B++)P=this.copyV3(B),this.next.push(P[0],P[1],P[2]),this.next.push(P[0],P[1],P[2]);for(P=this.compareV3(T-1,0)?this.copyV3(1):this.copyV3(T-1),this.next.push(P[0],P[1],P[2]),this.next.push(P[0],P[1],P[2]),B=0;B<T-1;B++){var G=2*B;this.indices_array.push(G,1+G,2+G),this.indices_array.push(2+G,1+G,3+G)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new L.BufferAttribute(new Float32Array(this.positions),3),previous:new L.BufferAttribute(new Float32Array(this.previous),3),next:new L.BufferAttribute(new Float32Array(this.next),3),side:new L.BufferAttribute(new Float32Array(this.side),1),width:new L.BufferAttribute(new Float32Array(this.width),1),uv:new L.BufferAttribute(new Float32Array(this.uvs),2),index:new L.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new L.BufferAttribute(new Float32Array(this.counters),1)},this.geometry.setAttribute("position",this.attributes.position),this.geometry.setAttribute("previous",this.attributes.previous),this.geometry.setAttribute("next",this.attributes.next),this.geometry.setAttribute("side",this.attributes.side),this.geometry.setAttribute("width",this.attributes.width),this.geometry.setAttribute("uv",this.attributes.uv),this.geometry.setAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)},U.prototype.advance=function(f){var P=this.attributes.position.array,T=this.attributes.previous.array,B=this.attributes.next.array,G=P.length;N(P,0,T,0,G),N(P,6,P,0,G-6),P[G-6]=f.x,P[G-5]=f.y,P[G-4]=f.z,P[G-3]=f.x,P[G-2]=f.y,P[G-1]=f.z,N(P,6,B,0,G-6),B[G-6]=f.x,B[G-5]=f.y,B[G-4]=f.z,B[G-3]=f.x,B[G-2]=f.y,B[G-1]=f.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0},L.ShaderChunk.meshline_vert=["",L.ShaderChunk.logdepthbuf_pars_vertex,L.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","	 vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",L.ShaderChunk.logdepthbuf_vertex,L.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",L.ShaderChunk.fog_vertex,"}"].join(`
`),L.ShaderChunk.meshline_frag=["",L.ShaderChunk.fog_pars_fragment,L.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",L.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",L.ShaderChunk.fog_fragment,"}"].join(`
`),((D.prototype=Object.create(L.ShaderMaterial.prototype)).constructor=D).prototype.isMeshLineMaterial=!0,D.prototype.copy=function(f){return L.ShaderMaterial.prototype.copy.call(this,f),this.lineWidth=f.lineWidth,this.map=f.map,this.useMap=f.useMap,this.alphaMap=f.alphaMap,this.useAlphaMap=f.useAlphaMap,this.color.copy(f.color),this.opacity=f.opacity,this.resolution.copy(f.resolution),this.sizeAttenuation=f.sizeAttenuation,this.near=f.near,this.far=f.far,this.dashArray.copy(f.dashArray),this.dashOffset.copy(f.dashOffset),this.dashRatio.copy(f.dashRatio),this.useDash=f.useDash,this.visibility=f.visibility,this.alphaTest=f.alphaTest,this.repeat.copy(f.repeat),this},s!==void 0?(r!==void 0&&r.exports&&(s=r.exports={MeshLine:U,MeshLineMaterial:D}),s.MeshLine=U,s.MeshLineMaterial=D):(this.MeshLine=U,this.MeshLineMaterial=D)}).call(this)},{three:19}],19:[function(b,r,s){var o,v;o=this,v=function(u){Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52)),Number.isInteger===void 0&&(Number.isInteger=function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}),Math.sign===void 0&&(Math.sign=function(e){return e<0?-1:0<e?1:+e}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),Object.assign===void 0&&(Object.assign=function(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i!=null)for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(t[c]=i[c])}return t});var w=0,L=1,U=2,N=1,D=2,f=3,P=0,T=1,B=2,G=0,R=0,_=1,ee=2,k=3,E=4,W=5,C=100,F=101,M=102,a=103,h=104,y=200,j=201,Y=202,q=203,V=204,ne=205,ie=206,he=207,be=208,je=209,xe=210,Fe=0,J=1,ge=2,oe=3,le=4,Re=5,Ye=6,Be=7,se=0,ve=1,Ee=2,rt=0,tt=1,xt=2,Rt=3,At=4,He=5,Gt=301,jt=302,Tn=303,mn=304,Qn=305,gt=306,ze=307,Zt=1e3,Rn=1001,Xn=1002,pt=1003,st=1004,qt=1005,xn=1006,nn=1007,er=1008,kr=1009,ct=1010,Ue=1011,lt=1012,Wt=1013,Ke=1014,Ot=1015,$t=1016,rn=1017,hr=1018,_r=1019,qr=1020,Ur=1021,Gr=1022,Or=1023,Qi=1024,Pi=1025,si=Or,gr=1026,Wi=1027,H=1028,Hr=1029,Eo=1030,Kn=1031,ao=1032,Na=1033,Fs=33776,es=33777,fs=33778,na=33779,ts=35840,so=35841,Ba=35842,Po=35843,ms=36196,Vs=37808,ra=37809,gs=37810,Oo=37811,ys=37812,ia=37813,oa=37814,Xr=37815,Sr=37816,ns=37817,vs=37818,rs=37819,Fa=37820,Ji=37821,jr=2300,K=2301,Ce=2400,ce=2401,Te=2402,Ze=3e3,yt=3001,Bt=3007,Xt=3002,In=3003,Gn=3004,ar=3005,hi=3006,aa=3200,Ci=3201,va=0,Ca=1,sa=7680,Gs=519,Wr=35044,bo=35048;function ko(){}Object.assign(ko.prototype,{addEventListener:function(e,t){this._listeners===void 0&&(this._listeners={});var n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)},hasEventListener:function(e,t){if(this._listeners===void 0)return!1;var n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(this._listeners!==void 0){var n=this._listeners[e];if(n!==void 0){var i=n.indexOf(t);i!==-1&&n.splice(i,1)}}},dispatchEvent:function(e){if(this._listeners!==void 0){var t=this._listeners[e.type];if(t!==void 0){e.target=this;for(var n=t.slice(0),i=0,c=n.length;i<c;i++)n[i].call(this,e)}}}});for(var eo=[],Va=0;Va<256;Va++)eo[Va]=(Va<16?"0":"")+Va.toString(16);var xs,vr={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(eo[255&e]+eo[e>>8&255]+eo[e>>16&255]+eo[e>>24&255]+"-"+eo[255&t]+eo[t>>8&255]+"-"+eo[t>>16&15|64]+eo[t>>24&255]+"-"+eo[63&n|128]+eo[n>>8&255]+"-"+eo[n>>16&255]+eo[n>>24&255]+eo[255&i]+eo[i>>8&255]+eo[i>>16&255]+eo[i>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,c){return i+(e-t)*(c-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:n<=e?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:n<=e?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*vr.DEG2RAD},radToDeg:function(e){return e*vr.RAD2DEG},isPowerOfTwo:function(e){return(e&e-1)==0&&e!==0},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,c){var d=Math.cos,m=Math.sin,x=d(n/2),A=m(n/2),I=d((t+i)/2),X=m((t+i)/2),Q=d((t-i)/2),re=m((t-i)/2),z=d((i-t)/2),ue=m((i-t)/2);c==="XYX"?e.set(x*X,A*Q,A*re,x*I):c==="YZY"?e.set(A*re,x*X,A*Q,x*I):c==="ZXZ"?e.set(A*Q,A*re,x*X,x*I):c==="XZX"?e.set(x*X,A*ue,A*z,x*I):c==="YXY"?e.set(A*z,x*X,A*ue,x*I):c==="ZYZ"?e.set(A*ue,A*z,x*X,x*I):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function zt(e,t){this.x=e||0,this.y=t||0}function Si(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(zt.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(zt.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),i=Math.sin(t),c=this.x-e.x,d=this.y-e.y;return this.x=c*n-d*i+e.x,this.y=c*i+d*n+e.y,this}}),Object.assign(Si.prototype,{isMatrix3:!0,set:function(e,t,n,i,c,d,m,x,A){var I=this.elements;return I[0]=e,I[1]=i,I[2]=m,I[3]=t,I[4]=c,I[5]=x,I[6]=n,I[7]=d,I[8]=A,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,c=this.elements,d=n[0],m=n[3],x=n[6],A=n[1],I=n[4],X=n[7],Q=n[2],re=n[5],z=n[8],ue=i[0],me=i[3],ye=i[6],Pe=i[1],Le=i[4],Ge=i[7],Qe=i[2],Ve=i[5],ot=i[8];return c[0]=d*ue+m*Pe+x*Qe,c[3]=d*me+m*Le+x*Ve,c[6]=d*ye+m*Ge+x*ot,c[1]=A*ue+I*Pe+X*Qe,c[4]=A*me+I*Le+X*Ve,c[7]=A*ye+I*Ge+X*ot,c[2]=Q*ue+re*Pe+z*Qe,c[5]=Q*me+re*Le+z*Ve,c[8]=Q*ye+re*Ge+z*ot,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],c=e[3],d=e[4],m=e[5],x=e[6],A=e[7],I=e[8];return t*d*I-t*m*A-n*c*I+n*m*x+i*c*A-i*d*x},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,i=this.elements,c=n[0],d=n[1],m=n[2],x=n[3],A=n[4],I=n[5],X=n[6],Q=n[7],re=n[8],z=re*A-I*Q,ue=I*X-re*x,me=Q*x-A*X,ye=c*z+d*ue+m*me;if(ye==0){var Pe="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(t===!0)throw new Error(Pe);return console.warn(Pe),this.identity()}var Le=1/ye;return i[0]=z*Le,i[1]=(m*Q-re*d)*Le,i[2]=(I*d-m*A)*Le,i[3]=ue*Le,i[4]=(re*c-m*X)*Le,i[5]=(m*x-I*c)*Le,i[6]=me*Le,i[7]=(d*X-Q*c)*Le,i[8]=(A*c-d*x)*Le,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,i,c,d,m){var x=Math.cos(c),A=Math.sin(c);this.set(n*x,n*A,-n*(x*d+A*m)+d+e,-i*A,i*x,-i*(-A*d+x*m)+m+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.elements,c=i[0],d=i[3],m=i[6],x=i[1],A=i[4],I=i[7];return i[0]=t*c+n*x,i[3]=t*d+n*A,i[6]=t*m+n*I,i[1]=-n*c+t*x,i[4]=-n*d+t*A,i[7]=-n*m+t*I,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});var Ga={getDataURL:function(e){var t;if(typeof HTMLCanvasElement>"u")return e.src;if(e instanceof HTMLCanvasElement)t=e;else{xs===void 0&&(xs=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),xs.width=e.width,xs.height=e.height;var n=xs.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=xs}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},lu=0;function Yr(e,t,n,i,c,d,m,x,A,I){Object.defineProperty(this,"id",{value:lu++}),this.uuid=vr.generateUUID(),this.name="",this.image=e!==void 0?e:Yr.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=t!==void 0?t:Yr.DEFAULT_MAPPING,this.wrapS=n!==void 0?n:Rn,this.wrapT=i!==void 0?i:Rn,this.magFilter=c!==void 0?c:xn,this.minFilter=d!==void 0?d:er,this.anisotropy=A!==void 0?A:1,this.format=m!==void 0?m:Or,this.internalFormat=null,this.type=x!==void 0?x:kr,this.offset=new zt(0,0),this.repeat=new zt(1,1),this.center=new zt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Si,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=I!==void 0?I:Ze,this.version=0,this.onUpdate=null}function Jr(e,t,n,i){this.x=e||0,this.y=t||0,this.z=n||0,this.w=i!==void 0?i:1}function qi(e,t,n){this.width=e,this.height=t,this.scissor=new Jr(0,0,e,t),this.scissorTest=!1,this.viewport=new Jr(0,0,e,t),n=n||{},this.texture=new Yr(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=n.generateMipmaps!==void 0&&n.generateMipmaps,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:xn,this.depthBuffer=n.depthBuffer===void 0||n.depthBuffer,this.stencilBuffer=n.stencilBuffer===void 0||n.stencilBuffer,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null}function zs(e,t,n){qi.call(this,e,t,n),this.samples=4}function Bi(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._w=i!==void 0?i:1}Yr.DEFAULT_IMAGE=void 0,Yr.DEFAULT_MAPPING=300,Yr.prototype=Object.assign(Object.create(ko.prototype),{constructor:Yr,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var i=this.image;if(i.uuid===void 0&&(i.uuid=vr.generateUUID()),!t&&e.images[i.uuid]===void 0){var c;if(Array.isArray(i)){c=[];for(var d=0,m=i.length;d<m;d++)c.push(Ga.getDataURL(i[d]))}else c=Ga.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:c}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case Zt:e.x=e.x-Math.floor(e.x);break;case Rn:e.x=e.x<0?0:1;break;case Xn:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case Zt:e.y=e.y-Math.floor(e.y);break;case Rn:e.y=e.y<0?0:1;break;case Xn:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Yr.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.defineProperties(Jr.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(Jr.prototype,{isVector4:!0,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,c=this.w,d=e.elements;return this.x=d[0]*t+d[4]*n+d[8]*i+d[12]*c,this.y=d[1]*t+d[5]*n+d[9]*i+d[13]*c,this.z=d[2]*t+d[6]*n+d[10]*i+d[14]*c,this.w=d[3]*t+d[7]*n+d[11]*i+d[15]*c,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,i,c,d=e.elements,m=d[0],x=d[4],A=d[8],I=d[1],X=d[5],Q=d[9],re=d[2],z=d[6],ue=d[10];if(Math.abs(x-I)<.01&&Math.abs(A-re)<.01&&Math.abs(Q-z)<.01){if(Math.abs(x+I)<.1&&Math.abs(A+re)<.1&&Math.abs(Q+z)<.1&&Math.abs(m+X+ue-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var me=(m+1)/2,ye=(X+1)/2,Pe=(ue+1)/2,Le=(x+I)/4,Ge=(A+re)/4,Qe=(Q+z)/4;return ye<me&&Pe<me?c=me<.01?(n=0,i=.707106781):(i=Le/(n=Math.sqrt(me)),Ge/n):Pe<ye?c=ye<.01?(i=0,n=.707106781):(n=Le/(i=Math.sqrt(ye)),Qe/i):Pe<.01?(i=n=.707106781,c=0):(n=Ge/(c=Math.sqrt(Pe)),i=Qe/c),this.set(n,i,c,t),this}var Ve=Math.sqrt((z-Q)*(z-Q)+(A-re)*(A-re)+(I-x)*(I-x));return Math.abs(Ve)<.001&&(Ve=1),this.x=(z-Q)/Ve,this.y=(A-re)/Ve,this.z=(I-x)/Ve,this.w=Math.acos((m+X+ue-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),qi.prototype=Object.assign(Object.create(ko.prototype),{constructor:qi,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),zs.prototype=Object.assign(Object.create(qi.prototype),{constructor:zs,isWebGLMultisampleRenderTarget:!0,copy:function(e){return qi.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign(Bi,{slerp:function(e,t,n,i){return n.copy(e).slerp(t,i)},slerpFlat:function(e,t,n,i,c,d,m){var x=n[i+0],A=n[i+1],I=n[i+2],X=n[i+3],Q=c[d+0],re=c[d+1],z=c[d+2],ue=c[d+3];if(X!==ue||x!==Q||A!==re||I!==z){var me=1-m,ye=x*Q+A*re+I*z+X*ue,Pe=0<=ye?1:-1,Le=1-ye*ye;if(Le>Number.EPSILON){var Ge=Math.sqrt(Le),Qe=Math.atan2(Ge,ye*Pe);me=Math.sin(me*Qe)/Ge,m=Math.sin(m*Qe)/Ge}var Ve=m*Pe;if(x=x*me+Q*Ve,A=A*me+re*Ve,I=I*me+z*Ve,X=X*me+ue*Ve,me===1-m){var ot=1/Math.sqrt(x*x+A*A+I*I+X*X);x*=ot,A*=ot,I*=ot,X*=ot}}e[t]=x,e[t+1]=A,e[t+2]=I,e[t+3]=X}}),Object.defineProperties(Bi.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(Bi.prototype,{isQuaternion:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,c=e._z,d=e.order,m=Math.cos,x=Math.sin,A=m(n/2),I=m(i/2),X=m(c/2),Q=x(n/2),re=x(i/2),z=x(c/2);return d==="XYZ"?(this._x=Q*I*X+A*re*z,this._y=A*re*X-Q*I*z,this._z=A*I*z+Q*re*X,this._w=A*I*X-Q*re*z):d==="YXZ"?(this._x=Q*I*X+A*re*z,this._y=A*re*X-Q*I*z,this._z=A*I*z-Q*re*X,this._w=A*I*X+Q*re*z):d==="ZXY"?(this._x=Q*I*X-A*re*z,this._y=A*re*X+Q*I*z,this._z=A*I*z+Q*re*X,this._w=A*I*X-Q*re*z):d==="ZYX"?(this._x=Q*I*X-A*re*z,this._y=A*re*X+Q*I*z,this._z=A*I*z-Q*re*X,this._w=A*I*X+Q*re*z):d==="YZX"?(this._x=Q*I*X+A*re*z,this._y=A*re*X+Q*I*z,this._z=A*I*z-Q*re*X,this._w=A*I*X-Q*re*z):d==="XZY"&&(this._x=Q*I*X-A*re*z,this._y=A*re*X-Q*I*z,this._z=A*I*z+Q*re*X,this._w=A*I*X+Q*re*z),t!==!1&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,i=n[0],c=n[4],d=n[8],m=n[1],x=n[5],A=n[9],I=n[2],X=n[6],Q=n[10],re=i+x+Q;return 0<re?(t=.5/Math.sqrt(re+1),this._w=.25/t,this._x=(X-A)*t,this._y=(d-I)*t,this._z=(m-c)*t):x<i&&Q<i?(t=2*Math.sqrt(1+i-x-Q),this._w=(X-A)/t,this._x=.25*t,this._y=(c+m)/t,this._z=(d+I)/t):Q<x?(t=2*Math.sqrt(1+x-i-Q),this._w=(d-I)/t,this._x=(c+m)/t,this._y=.25*t,this._z=(A+X)/t):(t=2*Math.sqrt(1+Q-i-x),this._w=(m-c)/t,this._x=(d+I)/t,this._y=(A+X)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=n,this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(vr.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(n===0)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,i=e._y,c=e._z,d=e._w,m=t._x,x=t._y,A=t._z,I=t._w;return this._x=n*I+d*m+i*A-c*x,this._y=i*I+d*x+c*m-n*A,this._z=c*I+d*A+n*x-i*m,this._w=d*I-n*m-i*x-c*A,this._onChangeCallback(),this},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var n=this._x,i=this._y,c=this._z,d=this._w,m=d*e._w+n*e._x+i*e._y+c*e._z;if(m<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,m=-m):this.copy(e),1<=m)return this._w=d,this._x=n,this._y=i,this._z=c,this;var x=1-m*m;if(x<=Number.EPSILON){var A=1-t;return this._w=A*d+t*this._w,this._x=A*n+t*this._x,this._y=A*i+t*this._y,this._z=A*c+t*this._z,this.normalize(),this._onChangeCallback(),this}var I=Math.sqrt(x),X=Math.atan2(I,m),Q=Math.sin((1-t)*X)/I,re=Math.sin(t*X)/I;return this._w=d*Q+this._w*re,this._x=n*Q+this._x*re,this._y=i*Q+this._y*re,this._z=c*Q+this._z*re,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return t===void 0&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var ws=new Ae,Us=new Bi;function Ae(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}Object.assign(Ae.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Us.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(Us.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,n=this.y,i=this.z,c=e.elements;return this.x=c[0]*t+c[3]*n+c[6]*i,this.y=c[1]*t+c[4]*n+c[7]*i,this.z=c[2]*t+c[5]*n+c[8]*i,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,c=e.elements,d=1/(c[3]*t+c[7]*n+c[11]*i+c[15]);return this.x=(c[0]*t+c[4]*n+c[8]*i+c[12])*d,this.y=(c[1]*t+c[5]*n+c[9]*i+c[13])*d,this.z=(c[2]*t+c[6]*n+c[10]*i+c[14])*d,this},applyQuaternion:function(e){var t=this.x,n=this.y,i=this.z,c=e.x,d=e.y,m=e.z,x=e.w,A=x*t+d*i-m*n,I=x*n+m*t-c*i,X=x*i+c*n-d*t,Q=-c*t-d*n-m*i;return this.x=A*x+Q*-c+I*-m-X*-d,this.y=I*x+Q*-d+X*-c-A*-m,this.z=X*x+Q*-m+A*-d-I*-c,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,n=this.y,i=this.z,c=e.elements;return this.x=c[0]*t+c[4]*n+c[8]*i,this.y=c[1]*t+c[5]*n+c[9]*i,this.z=c[2]*t+c[6]*n+c[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,i=e.y,c=e.z,d=t.x,m=t.y,x=t.z;return this.x=i*x-c*m,this.y=c*d-n*x,this.z=n*m-i*d,this},projectOnVector:function(e){var t=e.lengthSq();if(t===0)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)},projectOnPlane:function(e){return ws.copy(this).projectOnVector(e),this.sub(ws)},reflect:function(e){return this.sub(ws.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(vr.clamp(n,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,3*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var Sa=new Ae,to=new fr,cu=new Ae(0,0,0),bs=new Ae(1,1,1),Da=new Ae,Hs=new Ae,Mo=new Ae;function fr(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(fr.prototype,{isMatrix4:!0,set:function(e,t,n,i,c,d,m,x,A,I,X,Q,re,z,ue,me){var ye=this.elements;return ye[0]=e,ye[4]=t,ye[8]=n,ye[12]=i,ye[1]=c,ye[5]=d,ye[9]=m,ye[13]=x,ye[2]=A,ye[6]=I,ye[10]=X,ye[14]=Q,ye[3]=re,ye[7]=z,ye[11]=ue,ye[15]=me,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new fr().fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,n=e.elements,i=1/Sa.setFromMatrixColumn(e,0).length(),c=1/Sa.setFromMatrixColumn(e,1).length(),d=1/Sa.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*c,t[5]=n[5]*c,t[6]=n[6]*c,t[7]=0,t[8]=n[8]*d,t[9]=n[9]*d,t[10]=n[10]*d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,c=e.z,d=Math.cos(n),m=Math.sin(n),x=Math.cos(i),A=Math.sin(i),I=Math.cos(c),X=Math.sin(c);if(e.order==="XYZ"){var Q=d*I,re=d*X,z=m*I,ue=m*X;t[0]=x*I,t[4]=-x*X,t[8]=A,t[1]=re+z*A,t[5]=Q-ue*A,t[9]=-m*x,t[2]=ue-Q*A,t[6]=z+re*A,t[10]=d*x}else if(e.order==="YXZ"){var me=x*I,ye=x*X,Pe=A*I,Le=A*X;t[0]=me+Le*m,t[4]=Pe*m-ye,t[8]=d*A,t[1]=d*X,t[5]=d*I,t[9]=-m,t[2]=ye*m-Pe,t[6]=Le+me*m,t[10]=d*x}else if(e.order==="ZXY")me=x*I,ye=x*X,Pe=A*I,Le=A*X,t[0]=me-Le*m,t[4]=-d*X,t[8]=Pe+ye*m,t[1]=ye+Pe*m,t[5]=d*I,t[9]=Le-me*m,t[2]=-d*A,t[6]=m,t[10]=d*x;else if(e.order==="ZYX")Q=d*I,re=d*X,z=m*I,ue=m*X,t[0]=x*I,t[4]=z*A-re,t[8]=Q*A+ue,t[1]=x*X,t[5]=ue*A+Q,t[9]=re*A-z,t[2]=-A,t[6]=m*x,t[10]=d*x;else if(e.order==="YZX"){var Ge=d*x,Qe=d*A,Ve=m*x,ot=m*A;t[0]=x*I,t[4]=ot-Ge*X,t[8]=Ve*X+Qe,t[1]=X,t[5]=d*I,t[9]=-m*I,t[2]=-A*I,t[6]=Qe*X+Ve,t[10]=Ge-ot*X}else e.order==="XZY"&&(Ge=d*x,Qe=d*A,Ve=m*x,ot=m*A,t[0]=x*I,t[4]=-X,t[8]=A*I,t[1]=Ge*X+ot,t[5]=d*I,t[9]=Qe*X-Ve,t[2]=Ve*X-Qe,t[6]=m*I,t[10]=ot*X+Ge);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(cu,e,bs)},lookAt:function(e,t,n){var i=this.elements;return Mo.subVectors(e,t),Mo.lengthSq()===0&&(Mo.z=1),Mo.normalize(),Da.crossVectors(n,Mo),Da.lengthSq()===0&&(Math.abs(n.z)===1?Mo.x+=1e-4:Mo.z+=1e-4,Mo.normalize(),Da.crossVectors(n,Mo)),Da.normalize(),Hs.crossVectors(Mo,Da),i[0]=Da.x,i[4]=Hs.x,i[8]=Mo.x,i[1]=Da.y,i[5]=Hs.y,i[9]=Mo.y,i[2]=Da.z,i[6]=Hs.z,i[10]=Mo.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,c=this.elements,d=n[0],m=n[4],x=n[8],A=n[12],I=n[1],X=n[5],Q=n[9],re=n[13],z=n[2],ue=n[6],me=n[10],ye=n[14],Pe=n[3],Le=n[7],Ge=n[11],Qe=n[15],Ve=i[0],ot=i[4],We=i[8],vt=i[12],_t=i[1],Dt=i[5],Et=i[9],Vt=i[13],Kt=i[2],Ct=i[6],Mt=i[10],hn=i[14],Mn=i[3],Yn=i[7],qn=i[11],Vn=i[15];return c[0]=d*Ve+m*_t+x*Kt+A*Mn,c[4]=d*ot+m*Dt+x*Ct+A*Yn,c[8]=d*We+m*Et+x*Mt+A*qn,c[12]=d*vt+m*Vt+x*hn+A*Vn,c[1]=I*Ve+X*_t+Q*Kt+re*Mn,c[5]=I*ot+X*Dt+Q*Ct+re*Yn,c[9]=I*We+X*Et+Q*Mt+re*qn,c[13]=I*vt+X*Vt+Q*hn+re*Vn,c[2]=z*Ve+ue*_t+me*Kt+ye*Mn,c[6]=z*ot+ue*Dt+me*Ct+ye*Yn,c[10]=z*We+ue*Et+me*Mt+ye*qn,c[14]=z*vt+ue*Vt+me*hn+ye*Vn,c[3]=Pe*Ve+Le*_t+Ge*Kt+Qe*Mn,c[7]=Pe*ot+Le*Dt+Ge*Ct+Qe*Yn,c[11]=Pe*We+Le*Et+Ge*Mt+Qe*qn,c[15]=Pe*vt+Le*Vt+Ge*hn+Qe*Vn,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],c=e[12],d=e[1],m=e[5],x=e[9],A=e[13],I=e[2],X=e[6],Q=e[10],re=e[14];return e[3]*(c*x*X-i*A*X-c*m*Q+n*A*Q+i*m*re-n*x*re)+e[7]*(t*x*re-t*A*Q+c*d*Q-i*d*re+i*A*I-c*x*I)+e[11]*(t*A*X-t*m*re-c*d*X+n*d*re+c*m*I-n*A*I)+e[15]*(-i*m*I-t*x*X+t*m*Q+i*d*X-n*d*Q+n*x*I)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this},getInverse:function(e,t){var n=this.elements,i=e.elements,c=i[0],d=i[1],m=i[2],x=i[3],A=i[4],I=i[5],X=i[6],Q=i[7],re=i[8],z=i[9],ue=i[10],me=i[11],ye=i[12],Pe=i[13],Le=i[14],Ge=i[15],Qe=z*Le*Q-Pe*ue*Q+Pe*X*me-I*Le*me-z*X*Ge+I*ue*Ge,Ve=ye*ue*Q-re*Le*Q-ye*X*me+A*Le*me+re*X*Ge-A*ue*Ge,ot=re*Pe*Q-ye*z*Q+ye*I*me-A*Pe*me-re*I*Ge+A*z*Ge,We=ye*z*X-re*Pe*X-ye*I*ue+A*Pe*ue+re*I*Le-A*z*Le,vt=c*Qe+d*Ve+m*ot+x*We;if(vt==0){var _t="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(t===!0)throw new Error(_t);return console.warn(_t),this.identity()}var Dt=1/vt;return n[0]=Qe*Dt,n[1]=(Pe*ue*x-z*Le*x-Pe*m*me+d*Le*me+z*m*Ge-d*ue*Ge)*Dt,n[2]=(I*Le*x-Pe*X*x+Pe*m*Q-d*Le*Q-I*m*Ge+d*X*Ge)*Dt,n[3]=(z*X*x-I*ue*x-z*m*Q+d*ue*Q+I*m*me-d*X*me)*Dt,n[4]=Ve*Dt,n[5]=(re*Le*x-ye*ue*x+ye*m*me-c*Le*me-re*m*Ge+c*ue*Ge)*Dt,n[6]=(ye*X*x-A*Le*x-ye*m*Q+c*Le*Q+A*m*Ge-c*X*Ge)*Dt,n[7]=(A*ue*x-re*X*x+re*m*Q-c*ue*Q-A*m*me+c*X*me)*Dt,n[8]=ot*Dt,n[9]=(ye*z*x-re*Pe*x-ye*d*me+c*Pe*me+re*d*Ge-c*z*Ge)*Dt,n[10]=(A*Pe*x-ye*I*x+ye*d*Q-c*Pe*Q-A*d*Ge+c*I*Ge)*Dt,n[11]=(re*I*x-A*z*x-re*d*Q+c*z*Q+A*d*me-c*I*me)*Dt,n[12]=We*Dt,n[13]=(re*Pe*m-ye*z*m+ye*d*ue-c*Pe*ue-re*d*Le+c*z*Le)*Dt,n[14]=(ye*I*m-A*Pe*m-ye*d*X+c*Pe*X+A*d*Le-c*I*Le)*Dt,n[15]=(A*z*m-re*I*m+re*d*X-c*z*X-A*d*ue+c*I*ue)*Dt,this},scale:function(e){var t=this.elements,n=e.x,i=e.y,c=e.z;return t[0]*=n,t[4]*=i,t[8]*=c,t[1]*=n,t[5]*=i,t[9]*=c,t[2]*=n,t[6]*=i,t[10]*=c,t[3]*=n,t[7]*=i,t[11]*=c,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),c=1-n,d=e.x,m=e.y,x=e.z,A=c*d,I=c*m;return this.set(A*d+n,A*m-i*x,A*x+i*m,0,A*m+i*x,I*m+n,I*x-i*d,0,A*x-i*m,I*x+i*d,c*x*x+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var i=this.elements,c=t._x,d=t._y,m=t._z,x=t._w,A=c+c,I=d+d,X=m+m,Q=c*A,re=c*I,z=c*X,ue=d*I,me=d*X,ye=m*X,Pe=x*A,Le=x*I,Ge=x*X,Qe=n.x,Ve=n.y,ot=n.z;return i[0]=(1-(ue+ye))*Qe,i[1]=(re+Ge)*Qe,i[2]=(z-Le)*Qe,i[3]=0,i[4]=(re-Ge)*Ve,i[5]=(1-(Q+ye))*Ve,i[6]=(me+Pe)*Ve,i[7]=0,i[8]=(z+Le)*ot,i[9]=(me-Pe)*ot,i[10]=(1-(Q+ue))*ot,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:function(e,t,n){var i=this.elements,c=Sa.set(i[0],i[1],i[2]).length(),d=Sa.set(i[4],i[5],i[6]).length(),m=Sa.set(i[8],i[9],i[10]).length();this.determinant()<0&&(c=-c),e.x=i[12],e.y=i[13],e.z=i[14],to.copy(this);var x=1/c,A=1/d,I=1/m;return to.elements[0]*=x,to.elements[1]*=x,to.elements[2]*=x,to.elements[4]*=A,to.elements[5]*=A,to.elements[6]*=A,to.elements[8]*=I,to.elements[9]*=I,to.elements[10]*=I,t.setFromRotationMatrix(to),n.x=c,n.y=d,n.z=m,this},makePerspective:function(e,t,n,i,c,d){d===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var m=this.elements,x=2*c/(t-e),A=2*c/(n-i),I=(t+e)/(t-e),X=(n+i)/(n-i),Q=-(d+c)/(d-c),re=-2*d*c/(d-c);return m[0]=x,m[4]=0,m[8]=I,m[12]=0,m[1]=0,m[5]=A,m[9]=X,m[13]=0,m[2]=0,m[6]=0,m[10]=Q,m[14]=re,m[3]=0,m[7]=0,m[11]=-1,m[15]=0,this},makeOrthographic:function(e,t,n,i,c,d){var m=this.elements,x=1/(t-e),A=1/(n-i),I=1/(d-c),X=(t+e)*x,Q=(n+i)*A,re=(d+c)*I;return m[0]=2*x,m[4]=0,m[8]=0,m[12]=-X,m[1]=0,m[5]=2*A,m[9]=0,m[13]=-Q,m[2]=0,m[6]=0,m[10]=-2*I,m[14]=-re,m[3]=0,m[7]=0,m[11]=0,m[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});var _l=new fr,oc=new Bi;function g(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._order=i||g.DefaultOrder}function S(){this.mask=1}g.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],g.DefaultOrder="XYZ",Object.defineProperties(g.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(g.prototype,{isEuler:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var i=vr.clamp,c=e.elements,d=c[0],m=c[4],x=c[8],A=c[1],I=c[5],X=c[9],Q=c[2],re=c[6],z=c[10];return(t=t||this._order)==="XYZ"?(this._y=Math.asin(i(x,-1,1)),Math.abs(x)<.9999999?(this._x=Math.atan2(-X,z),this._z=Math.atan2(-m,d)):(this._x=Math.atan2(re,I),this._z=0)):t==="YXZ"?(this._x=Math.asin(-i(X,-1,1)),Math.abs(X)<.9999999?(this._y=Math.atan2(x,z),this._z=Math.atan2(A,I)):(this._y=Math.atan2(-Q,d),this._z=0)):t==="ZXY"?(this._x=Math.asin(i(re,-1,1)),Math.abs(re)<.9999999?(this._y=Math.atan2(-Q,z),this._z=Math.atan2(-m,I)):(this._y=0,this._z=Math.atan2(A,d))):t==="ZYX"?(this._y=Math.asin(-i(Q,-1,1)),Math.abs(Q)<.9999999?(this._x=Math.atan2(re,z),this._z=Math.atan2(A,d)):(this._x=0,this._z=Math.atan2(-m,I))):t==="YZX"?(this._z=Math.asin(i(A,-1,1)),Math.abs(A)<.9999999?(this._x=Math.atan2(-X,I),this._y=Math.atan2(-Q,d)):(this._x=0,this._y=Math.atan2(x,z))):t==="XZY"?(this._z=Math.asin(-i(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(re,I),this._y=Math.atan2(x,d)):(this._x=Math.atan2(-X,z),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,n!==!1&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,n){return _l.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_l,t,n)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return oc.setFromEuler(this),this.setFromQuaternion(oc,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Ae(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(S.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return(this.mask&e.mask)!=0}});var Z=0,te=new Ae,de=new Bi,fe=new fr,_e=new Ae,Me=new Ae,Se=new Ae,Ne=new Bi,nt=new Ae(1,0,0),ft=new Ae(0,1,0),ut=new Ae(0,0,1),Lt={type:"added"},kn={type:"removed"};function Pt(){Object.defineProperty(this,"id",{value:Z++}),this.uuid=vr.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Pt.DefaultUp.clone();var e=new Ae,t=new g,n=new Bi,i=new Ae(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new fr},normalMatrix:{value:new Si}}),this.matrix=new fr,this.matrixWorld=new fr,this.matrixAutoUpdate=Pt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new S,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Hn(){Pt.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Pt.DefaultUp=new Ae(0,1,0),Pt.DefaultMatrixAutoUpdate=!0,Pt.prototype=Object.assign(Object.create(ko.prototype),{constructor:Pt,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return de.setFromAxisAngle(e,t),this.quaternion.multiply(de),this},rotateOnWorldAxis:function(e,t){return de.setFromAxisAngle(e,t),this.quaternion.premultiply(de),this},rotateX:function(e){return this.rotateOnAxis(nt,e)},rotateY:function(e){return this.rotateOnAxis(ft,e)},rotateZ:function(e){return this.rotateOnAxis(ut,e)},translateOnAxis:function(e,t){return te.copy(e).applyQuaternion(this.quaternion),this.position.add(te.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(nt,e)},translateY:function(e){return this.translateOnAxis(ft,e)},translateZ:function(e){return this.translateOnAxis(ut,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(fe.getInverse(this.matrixWorld))},lookAt:function(e,t,n){e.isVector3?_e.copy(e):_e.set(e,t,n);var i=this.parent;this.updateWorldMatrix(!0,!1),Me.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?fe.lookAt(Me,_e,this.up):fe.lookAt(_e,Me,this.up),this.quaternion.setFromRotationMatrix(fe),i&&(fe.extractRotation(i.matrixWorld),de.setFromRotationMatrix(fe),this.quaternion.premultiply(de.inverse()))},add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),(e.parent=this).children.push(e),e.dispatchEvent(Lt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(kn)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),fe.getInverse(this.matrixWorld),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),fe.multiply(e.parent.matrixWorld)),e.applyMatrix4(fe),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var c=this.children[n].getObjectByProperty(e,t);if(c!==void 0)return c}},getWorldPosition:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Ae),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Bi),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Me,e,Se),e},getWorldScale:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Ae),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Me,Ne,e),e},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Ae),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e=!(this.matrixWorldNeedsUpdate=!1));for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0)for(var i=this.children,c=0,d=i.length;c<d;c++)i[c].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function c(ye,Pe){return ye[Pe.uuid]===void 0&&(ye[Pe.uuid]=Pe.toJSON(e)),Pe.uuid}if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){i.geometry=c(e.geometries,this.geometry);var d=this.geometry.parameters;if(d!==void 0&&d.shapes!==void 0){var m=d.shapes;if(Array.isArray(m))for(var x=0,A=m.length;x<A;x++){var I=m[x];c(e.shapes,I)}else c(e.shapes,m)}}if(this.material!==void 0)if(Array.isArray(this.material)){var X=[];for(x=0,A=this.material.length;x<A;x++)X.push(c(e.materials,this.material[x]));i.material=X}else i.material=c(e.materials,this.material);if(0<this.children.length)for(i.children=[],x=0;x<this.children.length;x++)i.children.push(this.children[x].toJSON(e).object);if(t){var Q=me(e.geometries),re=me(e.materials),z=me(e.textures),ue=me(e.images);m=me(e.shapes),0<Q.length&&(n.geometries=Q),0<re.length&&(n.materials=re),0<z.length&&(n.textures=z),0<ue.length&&(n.images=ue),0<m.length&&(n.shapes=m)}return n.object=i,n;function me(ye){var Pe=[];for(var Le in ye){var Ge=ye[Le];delete Ge.metadata,Pe.push(Ge)}return Pe}},clone:function(e){return new this.constructor().copy(this,e)},copy:function(e,t){if(t===void 0&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(var n=0;n<e.children.length;n++){var i=e.children[n];this.add(i.clone())}return this}}),Hn.prototype=Object.assign(Object.create(Pt.prototype),{constructor:Hn,isScene:!0,copy:function(e,t){return Pt.prototype.copy.call(this,e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=Pt.prototype.toJSON.call(this,e);return this.background!==null&&(t.object.background=this.background.toJSON(e)),this.environment!==null&&(t.object.environment=this.environment.toJSON(e)),this.fog!==null&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Zr=[new Ae,new Ae,new Ae,new Ae,new Ae,new Ae,new Ae,new Ae],Fr=new Ae,lo=new Xi,_o=new Ae,dr=new Ae,To=new Ae,xr=new Ae,Wn=new Ae,la=new Ae,za=new Ae,co=new Ae,Ua=new Ae,Co=new Ae;function Xi(e,t){this.min=e!==void 0?e:new Ae(1/0,1/0,1/0),this.max=t!==void 0?t:new Ae(-1/0,-1/0,-1/0)}function ca(e,t,n,i,c){var d,m;for(d=0,m=e.length-3;d<=m;d+=3){Co.fromArray(e,d);var x=c.x*Math.abs(Co.x)+c.y*Math.abs(Co.y)+c.z*Math.abs(Co.z),A=t.dot(Co),I=n.dot(Co),X=i.dot(Co);if(Math.max(-Math.max(A,I,X),Math.min(A,I,X))>x)return!1}return!0}Object.assign(Xi.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,i=1/0,c=-1/0,d=-1/0,m=-1/0,x=0,A=e.length;x<A;x+=3){var I=e[x],X=e[x+1],Q=e[x+2];I<t&&(t=I),X<n&&(n=X),Q<i&&(i=Q),c<I&&(c=I),d<X&&(d=X),m<Q&&(m=Q)}return this.min.set(t,n,i),this.max.set(c,d,m),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,i=1/0,c=-1/0,d=-1/0,m=-1/0,x=0,A=e.count;x<A;x++){var I=e.getX(x),X=e.getY(x),Q=e.getZ(x);I<t&&(t=I),X<n&&(n=X),Q<i&&(i=Q),c<I&&(c=I),d<X&&(d=X),m<Q&&(m=Q)}return this.min.set(t,n,i),this.max.set(c,d,m),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=Fr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Ae),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Ae),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),lo.copy(t.boundingBox),lo.applyMatrix4(e.matrixWorld),this.expandByPoint(lo.min),this.expandByPoint(lo.max));for(var n=e.children,i=0,c=n.length;i<c;i++)this.expandByObject(n[i]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Ae),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,Fr),Fr.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,n;return n=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(za),co.subVectors(this.max,za),_o.subVectors(e.a,za),dr.subVectors(e.b,za),To.subVectors(e.c,za),xr.subVectors(dr,_o),Wn.subVectors(To,dr),la.subVectors(_o,To);var t=[0,-xr.z,xr.y,0,-Wn.z,Wn.y,0,-la.z,la.y,xr.z,0,-xr.x,Wn.z,0,-Wn.x,la.z,0,-la.x,-xr.y,xr.x,0,-Wn.y,Wn.x,0,-la.y,la.x,0];return!!ca(t,_o,dr,To,co)&&!!ca(t=[1,0,0,0,1,0,0,0,1],_o,dr,To,co)&&(Ua.crossVectors(xr,Wn),ca(t=[Ua.x,Ua.y,Ua.z],_o,dr,To,co))},clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Ae),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Fr.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return e===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(Fr).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(Zr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Zr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Zr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Zr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Zr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Zr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Zr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Zr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Zr)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Fi=new Xi;function Kr(e,t){this.center=e!==void 0?e:new Ae,this.radius=t!==void 0?t:0}Object.assign(Kr.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var n=this.center;t!==void 0?n.copy(t):Fi.setFromPoints(e).getCenter(n);for(var i=0,c=0,d=e.length;c<d;c++)i=Math.max(i,n.distanceToSquared(e[c]));return this.radius=Math.sqrt(i),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return t===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Ae),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return e===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Xi),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var $r=new Ae,Oi=new Ae,Ho=new Ae,wi=new Ae,Jn=new Ae,li=new Ae,ni=new Ae;function Ar(e,t){this.origin=e!==void 0?e:new Ae,this.direction=t!==void 0?t:new Ae(0,0,-1)}Object.assign(Ar.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return t===void 0&&(console.warn("THREE.Ray: .at() target is now required"),t=new Ae),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,$r)),this},closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Ae),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=$r.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):($r.copy(this.direction).multiplyScalar(t).add(this.origin),$r.distanceToSquared(e))},distanceSqToSegment:function(e,t,n,i){Oi.copy(e).add(t).multiplyScalar(.5),Ho.copy(t).sub(e).normalize(),wi.copy(this.origin).sub(Oi);var c,d,m,x,A=.5*e.distanceTo(t),I=-this.direction.dot(Ho),X=wi.dot(this.direction),Q=-wi.dot(Ho),re=wi.lengthSq(),z=Math.abs(1-I*I);if(0<z)if(d=I*X-Q,x=A*z,0<=(c=I*Q-X))if(-x<=d)if(d<=x){var ue=1/z;m=(c*=ue)*(c+I*(d*=ue)+2*X)+d*(I*c+d+2*Q)+re}else d=A,m=-(c=Math.max(0,-(I*d+X)))*c+d*(d+2*Q)+re;else d=-A,m=-(c=Math.max(0,-(I*d+X)))*c+d*(d+2*Q)+re;else m=d<=-x?-(c=Math.max(0,-(-I*A+X)))*c+(d=0<c?-A:Math.min(Math.max(-A,-Q),A))*(d+2*Q)+re:d<=x?(c=0,(d=Math.min(Math.max(-A,-Q),A))*(d+2*Q)+re):-(c=Math.max(0,-(I*A+X)))*c+(d=0<c?A:Math.min(Math.max(-A,-Q),A))*(d+2*Q)+re;else d=0<I?-A:A,m=-(c=Math.max(0,-(I*d+X)))*c+d*(d+2*Q)+re;return n&&n.copy(this.direction).multiplyScalar(c).add(this.origin),i&&i.copy(Ho).multiplyScalar(d).add(Oi),m},intersectSphere:function(e,t){$r.subVectors(e.center,this.origin);var n=$r.dot(this.direction),i=$r.dot($r)-n*n,c=e.radius*e.radius;if(c<i)return null;var d=Math.sqrt(c-i),m=n-d,x=n+d;return m<0&&x<0?null:m<0?this.at(x,t):this.at(m,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=n?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return n===null?null:this.at(n,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var n,i,c,d,m,x,A=1/this.direction.x,I=1/this.direction.y,X=1/this.direction.z,Q=this.origin;return i=0<=A?(n=(e.min.x-Q.x)*A,(e.max.x-Q.x)*A):(n=(e.max.x-Q.x)*A,(e.min.x-Q.x)*A),(d=0<=I?(c=(e.min.y-Q.y)*I,(e.max.y-Q.y)*I):(c=(e.max.y-Q.y)*I,(e.min.y-Q.y)*I))<n||i<c?null:((n<c||n!=n)&&(n=c),(d<i||i!=i)&&(i=d),(x=0<=X?(m=(e.min.z-Q.z)*X,(e.max.z-Q.z)*X):(m=(e.max.z-Q.z)*X,(e.min.z-Q.z)*X))<n||i<m?null:((n<m||n!=n)&&(n=m),(x<i||i!=i)&&(i=x),i<0?null:this.at(0<=n?n:i,t)))},intersectsBox:function(e){return this.intersectBox(e,$r)!==null},intersectTriangle:function(e,t,n,i,c){Jn.subVectors(t,e),li.subVectors(n,e),ni.crossVectors(Jn,li);var d,m=this.direction.dot(ni);if(0<m){if(i)return null;d=1}else{if(!(m<0))return null;d=-1,m=-m}wi.subVectors(this.origin,e);var x=d*this.direction.dot(li.crossVectors(wi,li));if(x<0)return null;var A=d*this.direction.dot(Jn.cross(wi));if(A<0||m<x+A)return null;var I=-d*wi.dot(ni);return I<0?null:this.at(I/m,c)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var So=new Ae,Ms=new Ae,Tl=new Si;function no(e,t){this.normal=e!==void 0?e:new Ae(1,0,0),this.constant=t!==void 0?t:0}Object.assign(no.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,n){var i=So.subVectors(n,t).cross(Ms.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return t===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Ae),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){t===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Ae);var n=e.delta(So),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):void 0;var c=-(e.start.dot(this.normal)+this.constant)/i;return c<0||1<c?void 0:t.copy(n).multiplyScalar(c).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&0<n||n<0&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return e===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Ae),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var n=t||Tl.getNormalMatrix(e),i=this.coplanarPoint(So).applyMatrix4(e),c=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(c),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var uo=new Ae,Vi=new Ae,_s=new Ae,Wo=new Ae,xa=new Ae,Ea=new Ae,Cl=new Ae,di=new Ae,Ai=new Ae,Ws=new Ae;function Ri(e,t,n){this.a=e!==void 0?e:new Ae,this.b=t!==void 0?t:new Ae,this.c=n!==void 0?n:new Ae}Object.assign(Ri,{getNormal:function(e,t,n,i){i===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Ae),i.subVectors(n,t),uo.subVectors(e,t),i.cross(uo);var c=i.lengthSq();return 0<c?i.multiplyScalar(1/Math.sqrt(c)):i.set(0,0,0)},getBarycoord:function(e,t,n,i,c){uo.subVectors(i,t),Vi.subVectors(n,t),_s.subVectors(e,t);var d=uo.dot(uo),m=uo.dot(Vi),x=uo.dot(_s),A=Vi.dot(Vi),I=Vi.dot(_s),X=d*A-m*m;if(c===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),c=new Ae),X==0)return c.set(-2,-1,-1);var Q=1/X,re=(A*x-m*I)*Q,z=(d*I-m*x)*Q;return c.set(1-re-z,z,re)},containsPoint:function(e,t,n,i){return Ri.getBarycoord(e,t,n,i,Wo),0<=Wo.x&&0<=Wo.y&&Wo.x+Wo.y<=1},getUV:function(e,t,n,i,c,d,m,x){return this.getBarycoord(e,t,n,i,Wo),x.set(0,0),x.addScaledVector(c,Wo.x),x.addScaledVector(d,Wo.y),x.addScaledVector(m,Wo.z),x},isFrontFacing:function(e,t,n,i){return uo.subVectors(n,t),Vi.subVectors(e,t),uo.cross(Vi).dot(i)<0}}),Object.assign(Ri.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return uo.subVectors(this.c,this.b),Vi.subVectors(this.a,this.b),.5*uo.cross(Vi).length()},getMidpoint:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Ae),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Ri.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new no),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Ri.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,n,i,c){return Ri.getUV(e,this.a,this.b,this.c,t,n,i,c)},containsPoint:function(e){return Ri.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return Ri.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Ae);var n,i,c=this.a,d=this.b,m=this.c;xa.subVectors(d,c),Ea.subVectors(m,c),di.subVectors(e,c);var x=xa.dot(di),A=Ea.dot(di);if(x<=0&&A<=0)return t.copy(c);Ai.subVectors(e,d);var I=xa.dot(Ai),X=Ea.dot(Ai);if(0<=I&&X<=I)return t.copy(d);var Q=x*X-I*A;if(Q<=0&&0<=x&&I<=0)return n=x/(x-I),t.copy(c).addScaledVector(xa,n);Ws.subVectors(e,m);var re=xa.dot(Ws),z=Ea.dot(Ws);if(0<=z&&re<=z)return t.copy(m);var ue=re*A-x*z;if(ue<=0&&0<=A&&z<=0)return i=A/(A-z),t.copy(c).addScaledVector(Ea,i);var me=I*z-re*X;if(me<=0&&0<=X-I&&0<=re-z)return Cl.subVectors(m,d),i=(X-I)/(X-I+(re-z)),t.copy(d).addScaledVector(Cl,i);var ye=1/(me+ue+Q);return n=ue*ye,i=Q*ye,t.copy(c).addScaledVector(xa,n).addScaledVector(Ea,i)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var Sl={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ie={h:0,s:0,l:0},at={h:0,s:0,l:0};function $e(e,t,n){return t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}function Tt(e,t,n){return n<0&&(n+=1),1<n&&--n,n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function kt(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function gn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function yn(e,t,n,i,c,d){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new Ae,this.vertexNormals=Array.isArray(i)?i:[],this.color=c&&c.isColor?c:new $e,this.vertexColors=Array.isArray(c)?c:[],this.materialIndex=d!==void 0?d:0}Object.assign($e.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(e=vr.euclideanModulo(e,1),t=vr.clamp(t,0,1),n=vr.clamp(n,0,1),t===0)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+t):n+t-n*t,c=2*n-i;this.r=Tt(c,i,e+1/3),this.g=Tt(c,i,e),this.b=Tt(c,i,e-1/3)}return this},setStyle:function(e){function t(Q){Q!==void 0&&parseFloat(Q)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,c=n[1],d=n[2];switch(c){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d)){var m=parseFloat(i[1])/360,x=parseInt(i[2],10)/100,A=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(m,x,A)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var I=n[1],X=I.length;if(X===3)return this.r=parseInt(I.charAt(0)+I.charAt(0),16)/255,this.g=parseInt(I.charAt(1)+I.charAt(1),16)/255,this.b=parseInt(I.charAt(2)+I.charAt(2),16)/255,this;if(X===6)return this.r=parseInt(I.charAt(0)+I.charAt(1),16)/255,this.g=parseInt(I.charAt(2)+I.charAt(3),16)/255,this.b=parseInt(I.charAt(4)+I.charAt(5),16)/255,this}return e&&0<e.length?this.setColorName(e):this},setColorName:function(e){var t=Sl[e];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return t===void 0&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){t===void 0&&(t=2);var n=0<t?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=kt(e.r),this.g=kt(e.g),this.b=kt(e.b),this},copyLinearToSRGB:function(e){return this.r=gn(e.r),this.g=gn(e.g),this.b=gn(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){e===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,i=this.r,c=this.g,d=this.b,m=Math.max(i,c,d),x=Math.min(i,c,d),A=(x+m)/2;if(x===m)n=t=0;else{var I=m-x;switch(n=A<=.5?I/(m+x):I/(2-m-x),m){case i:t=(c-d)/I+(c<d?6:0);break;case c:t=(d-i)/I+2;break;case d:t=(i-c)/I+4}t/=6}return e.h=t,e.s=n,e.l=A,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){return this.getHSL(Ie),Ie.h+=e,Ie.s+=t,Ie.l+=n,this.setHSL(Ie.h,Ie.s,Ie.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(Ie),e.getHSL(at);var n=vr.lerp(Ie.h,at.h,t),i=vr.lerp(Ie.s,at.s,t),c=vr.lerp(Ie.l,at.l,t);return this.setHSL(n,i,c),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return t===void 0&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),$e.NAMES=Sl,Object.assign(yn.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Ln=0;function It(){Object.defineProperty(this,"id",{value:Ln++}),this.uuid=vr.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=_,this.side=P,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=G,this.opacity=1,this.transparent=!1,this.blendSrc=V,this.blendDst=ne,this.blendEquation=C,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=oe,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Gs,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=sa,this.stencilZFail=sa,this.stencilZPass=sa,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Mr(e){It.call(this),this.type="MeshBasicMaterial",this.color=new $e(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=se,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}It.prototype=Object.assign(Object.create(ko.prototype),{constructor:It,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(e!==void 0)for(var t in e){var n=e[t];if(n!==void 0)if(t!=="shading"){var i=this[t];i!==void 0?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===1;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(m){var x=[];for(var A in m){var I=m[A];delete I.metadata,x.push(I)}return x}if(n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,this.combine!==void 0&&(n.combine=this.combine),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.size!==void 0&&(n.size=this.size),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==_&&(n.blending=this.blending),this.flatShading===!0&&(n.flatShading=this.flatShading),this.side!==P&&(n.side=this.side),this.vertexColors!==G&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),0<this.alphaTest&&(n.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),1<this.wireframeLinewidth&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(n.morphTargets=!0),this.morphNormals===!0&&(n.morphNormals=!0),this.skinning===!0&&(n.skinning=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),t){var c=i(e.textures),d=i(e.images);0<c.length&&(n.textures=c),0<d.length&&(n.images=d)}return n},clone:function(){return new this.constructor().copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(t!==null){var i=t.length;n=new Array(i);for(var c=0;c!==i;++c)n[c]=t[c].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(It.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),((Mr.prototype=Object.create(It.prototype)).constructor=Mr).prototype.isMeshBasicMaterial=!0,Mr.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var Sn=new Ae;function en(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=Wr,this.updateRange={offset:0,count:-1},this.version=0}function Rr(e,t,n){en.call(this,new Int8Array(e),t,n)}function tr(e,t,n){en.call(this,new Uint8Array(e),t,n)}function ci(e,t,n){en.call(this,new Uint8ClampedArray(e),t,n)}function bi(e,t,n){en.call(this,new Int16Array(e),t,n)}function pi(e,t,n){en.call(this,new Uint16Array(e),t,n)}function we(e,t,n){en.call(this,new Int32Array(e),t,n)}function Mi(e,t,n){en.call(this,new Uint32Array(e),t,n)}function on(e,t,n){en.call(this,new Float32Array(e),t,n)}function Tr(e,t,n){en.call(this,new Float64Array(e),t,n)}function wr(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Yi(e){if(e.length===0)return-1/0;for(var t=e[0],n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}Object.defineProperty(en.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.assign(en.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,c=this.itemSize;i<c;i++)this.array[e+i]=t.array[n+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,i=0,c=e.length;i<c;i++){var d=e[i];d===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),d=new $e),t[n++]=d.r,t[n++]=d.g,t[n++]=d.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,i=0,c=e.length;i<c;i++){var d=e[i];d===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),d=new zt),t[n++]=d.x,t[n++]=d.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,i=0,c=e.length;i<c;i++){var d=e[i];d===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),d=new Ae),t[n++]=d.x,t[n++]=d.y,t[n++]=d.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,i=0,c=e.length;i<c;i++){var d=e[i];d===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),d=new Jr),t[n++]=d.x,t[n++]=d.y,t[n++]=d.z,t[n++]=d.w}return this},applyMatrix3:function(e){for(var t=0,n=this.count;t<n;t++)Sn.x=this.getX(t),Sn.y=this.getY(t),Sn.z=this.getZ(t),Sn.applyMatrix3(e),this.setXYZ(t,Sn.x,Sn.y,Sn.z);return this},applyMatrix4:function(e){for(var t=0,n=this.count;t<n;t++)Sn.x=this.getX(t),Sn.y=this.getY(t),Sn.z=this.getZ(t),Sn.applyMatrix4(e),this.setXYZ(t,Sn.x,Sn.y,Sn.z);return this},applyNormalMatrix:function(e){for(var t=0,n=this.count;t<n;t++)Sn.x=this.getX(t),Sn.y=this.getY(t),Sn.z=this.getZ(t),Sn.applyNormalMatrix(e),this.setXYZ(t,Sn.x,Sn.y,Sn.z);return this},transformDirection:function(e){for(var t=0,n=this.count;t<n;t++)Sn.x=this.getX(t),Sn.y=this.getY(t),Sn.z=this.getZ(t),Sn.transformDirection(e),this.setXYZ(t,Sn.x,Sn.y,Sn.z);return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.itemSize<3?0:this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,c){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=c,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),(Rr.prototype=Object.create(en.prototype)).constructor=Rr,(tr.prototype=Object.create(en.prototype)).constructor=tr,(ci.prototype=Object.create(en.prototype)).constructor=ci,(bi.prototype=Object.create(en.prototype)).constructor=bi,(pi.prototype=Object.create(en.prototype)).constructor=pi,(we.prototype=Object.create(en.prototype)).constructor=we,(Mi.prototype=Object.create(en.prototype)).constructor=Mi,(on.prototype=Object.create(en.prototype)).constructor=on,(Tr.prototype=Object.create(en.prototype)).constructor=Tr,Object.assign(wr.prototype,{computeGroups:function(e){for(var t,n=[],i=void 0,c=e.faces,d=0;d<c.length;d++){var m=c[d];m.materialIndex!==i&&(i=m.materialIndex,t!==void 0&&(t.count=3*d-t.start,n.push(t)),t={start:3*d,materialIndex:i})}t!==void 0&&(t.count=3*d-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,n=e.faces,i=e.vertices,c=e.faceVertexUvs,d=c[0]&&0<c[0].length,m=c[1]&&0<c[1].length,x=e.morphTargets,A=x.length;if(0<A){t=[];for(var I=0;I<A;I++)t[I]={name:x[I].name,data:[]};this.morphTargets.position=t}var X,Q=e.morphNormals,re=Q.length;if(0<re){for(X=[],I=0;I<re;I++)X[I]={name:Q[I].name,data:[]};this.morphTargets.normal=X}var z=e.skinIndices,ue=e.skinWeights,me=z.length===i.length,ye=ue.length===i.length;for(0<i.length&&n.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),I=0;I<n.length;I++){var Pe=n[I];this.vertices.push(i[Pe.a],i[Pe.b],i[Pe.c]);var Le=Pe.vertexNormals;if(Le.length===3)this.normals.push(Le[0],Le[1],Le[2]);else{var Ge=Pe.normal;this.normals.push(Ge,Ge,Ge)}var Qe,Ve=Pe.vertexColors;if(Ve.length===3)this.colors.push(Ve[0],Ve[1],Ve[2]);else{var ot=Pe.color;this.colors.push(ot,ot,ot)}d===!0&&((Qe=c[0][I])!==void 0?this.uvs.push(Qe[0],Qe[1],Qe[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",I),this.uvs.push(new zt,new zt,new zt))),m===!0&&((Qe=c[1][I])!==void 0?this.uvs2.push(Qe[0],Qe[1],Qe[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",I),this.uvs2.push(new zt,new zt,new zt)));for(var We=0;We<A;We++){var vt=x[We].vertices;t[We].data.push(vt[Pe.a],vt[Pe.b],vt[Pe.c])}for(We=0;We<re;We++){var _t=Q[We].vertexNormals[I];X[We].data.push(_t.a,_t.b,_t.c)}me&&this.skinIndices.push(z[Pe.a],z[Pe.b],z[Pe.c]),ye&&this.skinWeights.push(ue[Pe.a],ue[Pe.b],ue[Pe.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}});var Jo=2147483647,Gi=new fr,wa=new Pt,ho=new Ae,qo=new Xi,Dl=new Xi,Li=new Ae;function Dn(){Object.defineProperty(this,"id",{value:Jo+=2}),this.uuid=vr.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Dn.prototype=Object.assign(Object.create(ko.prototype),{constructor:Dn,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(65535<Yi(e)?Mi:pi)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:n!==void 0?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(n!==void 0){var i=new Si().getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}var c=this.attributes.tangent;return c!==void 0&&(c.transformDirection(e),c.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(e){return Gi.makeRotationX(e),this.applyMatrix4(Gi),this},rotateY:function(e){return Gi.makeRotationY(e),this.applyMatrix4(Gi),this},rotateZ:function(e){return Gi.makeRotationZ(e),this.applyMatrix4(Gi),this},translate:function(e,t,n){return Gi.makeTranslation(e,t,n),this.applyMatrix4(Gi),this},scale:function(e,t,n){return Gi.makeScale(e,t,n),this.applyMatrix4(Gi),this},lookAt:function(e){return wa.lookAt(e),wa.updateMatrix(),this.applyMatrix4(wa.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ho).negate(),this.translate(ho.x,ho.y,ho.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new on(3*t.vertices.length,3),i=new on(3*t.colors.length,3);if(this.setAttribute("position",n.copyVector3sArray(t.vertices)),this.setAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var c=new on(t.lineDistances.length,1);this.setAttribute("lineDistance",c.copyArray(t.lineDistances))}t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var c=e[n];t.push(c.x,c.y,c.z||0)}return this.setAttribute("position",new on(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var i=n.__directGeometry;if(n.elementsNeedUpdate===!0&&(i=void 0,n.elementsNeedUpdate=!1),i===void 0)return this.fromGeometry(n);i.verticesNeedUpdate=n.verticesNeedUpdate,i.normalsNeedUpdate=n.normalsNeedUpdate,i.colorsNeedUpdate=n.colorsNeedUpdate,i.uvsNeedUpdate=n.uvsNeedUpdate,i.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=i}return n.verticesNeedUpdate===!0&&((t=this.attributes.position)!==void 0&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),n.normalsNeedUpdate===!0&&((t=this.attributes.normal)!==void 0&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),n.colorsNeedUpdate===!0&&((t=this.attributes.color)!==void 0&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&((t=this.attributes.uv)!==void 0&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&((t=this.attributes.lineDistance)!==void 0&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new wr().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new en(t,3).copyVector3sArray(e.vertices)),0<e.normals.length){var n=new Float32Array(3*e.normals.length);this.setAttribute("normal",new en(n,3).copyVector3sArray(e.normals))}if(0<e.colors.length){var i=new Float32Array(3*e.colors.length);this.setAttribute("color",new en(i,3).copyColorsArray(e.colors))}if(0<e.uvs.length){var c=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new en(c,2).copyVector2sArray(e.uvs))}if(0<e.uvs2.length){var d=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new en(d,2).copyVector2sArray(e.uvs2))}for(var m in this.groups=e.groups,e.morphTargets){for(var x=[],A=e.morphTargets[m],I=0,X=A.length;I<X;I++){var Q=A[I],re=new on(3*Q.data.length,3);re.name=Q.name,x.push(re.copyVector3sArray(Q.data))}this.morphAttributes[m]=x}if(0<e.skinIndices.length){var z=new on(4*e.skinIndices.length,4);this.setAttribute("skinIndex",z.copyVector4sArray(e.skinIndices))}if(0<e.skinWeights.length){var ue=new on(4*e.skinWeights.length,4);this.setAttribute("skinWeight",ue.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Xi);var e=this.attributes.position,t=this.morphAttributes.position;if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var c=t[n];qo.setFromBufferAttribute(c),this.morphTargetsRelative?(Li.addVectors(this.boundingBox.min,qo.min),this.boundingBox.expandByPoint(Li),Li.addVectors(this.boundingBox.max,qo.max),this.boundingBox.expandByPoint(Li)):(this.boundingBox.expandByPoint(qo.min),this.boundingBox.expandByPoint(qo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Kr);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var n=this.boundingSphere.center;if(qo.setFromBufferAttribute(e),t)for(var i=0,c=t.length;i<c;i++){var d=t[i];Dl.setFromBufferAttribute(d),this.morphTargetsRelative?(Li.addVectors(qo.min,Dl.min),qo.expandByPoint(Li),Li.addVectors(qo.max,Dl.max),qo.expandByPoint(Li)):(qo.expandByPoint(Dl.min),qo.expandByPoint(Dl.max))}qo.getCenter(n);var m=0;for(i=0,c=e.count;i<c;i++)Li.fromBufferAttribute(e,i),m=Math.max(m,n.distanceToSquared(Li));if(t)for(i=0,c=t.length;i<c;i++){d=t[i];for(var x=this.morphTargetsRelative,A=0,I=d.count;A<I;A++)Li.fromBufferAttribute(d,A),x&&(ho.fromBufferAttribute(e,A),Li.add(ho)),m=Math.max(m,n.distanceToSquared(Li))}this.boundingSphere.radius=Math.sqrt(m),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(t.normal===void 0)this.setAttribute("normal",new en(new Float32Array(n.length),3));else for(var i=t.normal.array,c=0,d=i.length;c<d;c++)i[c]=0;var m,x,A,I=t.normal.array,X=new Ae,Q=new Ae,re=new Ae,z=new Ae,ue=new Ae;if(e){var me=e.array;for(c=0,d=e.count;c<d;c+=3)m=3*me[c+0],x=3*me[c+1],A=3*me[c+2],X.fromArray(n,m),Q.fromArray(n,x),re.fromArray(n,A),z.subVectors(re,Q),ue.subVectors(X,Q),z.cross(ue),I[m]+=z.x,I[1+m]+=z.y,I[2+m]+=z.z,I[x]+=z.x,I[1+x]+=z.y,I[2+x]+=z.z,I[A]+=z.x,I[1+A]+=z.y,I[2+A]+=z.z}else for(c=0,d=n.length;c<d;c+=9)X.fromArray(n,c),Q.fromArray(n,c+3),re.fromArray(n,c+6),z.subVectors(re,Q),ue.subVectors(X,Q),z.cross(ue),I[c]=z.x,I[c+1]=z.y,I[c+2]=z.z,I[c+3]=z.x,I[c+4]=z.y,I[c+5]=z.z,I[c+6]=z.x,I[c+7]=z.y,I[c+8]=z.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var i in n)if(e.attributes[i]!==void 0)for(var c=n[i].array,d=e.attributes[i],m=d.array,x=d.itemSize*t,A=Math.min(m.length,c.length-x),I=0,X=x;I<A;I++,X++)c[X]=m[I];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)Li.x=e.getX(t),Li.y=e.getY(t),Li.z=e.getZ(t),Li.normalize(),e.setXYZ(t,Li.x,Li.y,Li.z)},toNonIndexed:function(){function e(ue,me){for(var ye=ue.array,Pe=ue.itemSize,Le=new ye.constructor(me.length*Pe),Ge=0,Qe=0,Ve=0,ot=me.length;Ve<ot;Ve++){Ge=me[Ve]*Pe;for(var We=0;We<Pe;We++)Le[Qe++]=ye[Ge++]}return new en(Le,Pe)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Dn,n=this.index.array,i=this.attributes;for(var c in i){var d=e(i[c],n);t.setAttribute(c,d)}var m=this.morphAttributes;for(c in m){for(var x=[],A=m[c],I=0,X=A.length;I<X;I++)d=e(A[I],n),x.push(d);t.morphAttributes[c]=x}t.morphTargetsRelative=this.morphTargetsRelative;for(var Q=this.groups,re=(I=0,Q.length);I<re;I++){var z=Q[I];t.addGroup(z.start,z.count,z.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),0<Object.keys(this.userData).length&&(e.userData=this.userData),this.parameters!==void 0){var t=this.parameters;for(var n in t)t[n]!==void 0&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var c=this.attributes;for(var n in c){var d=(re=c[n]).toJSON();re.name!==""&&(d.name=re.name),e.data.attributes[n]=d}var m={},x=!1;for(var n in this.morphAttributes){for(var A=this.morphAttributes[n],I=[],X=0,Q=A.length;X<Q;X++){var re;d=(re=A[X]).toJSON(),re.name!==""&&(d.name=re.name),I.push(d)}0<I.length&&(m[n]=I,x=!0)}x&&(e.data.morphAttributes=m,e.data.morphTargetsRelative=this.morphTargetsRelative);var z=this.groups;0<z.length&&(e.data.groups=JSON.parse(JSON.stringify(z)));var ue=this.boundingSphere;return ue!==null&&(e.data.boundingSphere={center:ue.center.toArray(),radius:ue.radius}),e},clone:function(){return new Dn().copy(this)},copy:function(e){var t,n,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var c=e.index;c!==null&&this.setIndex(c.clone());var d=e.attributes;for(t in d){var m=d[t];this.setAttribute(t,m.clone())}var x=e.morphAttributes;for(t in x){var A=[],I=x[t];for(n=0,i=I.length;n<i;n++)A.push(I[n].clone());this.morphAttributes[t]=A}this.morphTargetsRelative=e.morphTargetsRelative;var X=e.groups;for(n=0,i=X.length;n<i;n++){var Q=X[n];this.addGroup(Q.start,Q.count,Q.materialIndex)}var re=e.boundingBox;re!==null&&(this.boundingBox=re.clone());var z=e.boundingSphere;return z!==null&&(this.boundingSphere=z.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ac=new fr,Js=new Ar,uu=new Kr,jo=new Ae,is=new Ae,ua=new Ae,Xo=new Ae,hu=new Ae,du=new Ae,Ts=new Ae,Pa=new Ae,sc=new Ae,El=new zt,os=new zt,qs=new zt,zi=new Ae,Pl=new Ae;function _i(e,t){Pt.call(this),this.type="Mesh",this.geometry=e!==void 0?e:new Dn,this.material=t!==void 0?t:new Mr,this.updateMorphTargets()}function Oa(e,t,n,i,c,d,m,x){if((t.side===T?i.intersectTriangle(m,d,c,!0,x):i.intersectTriangle(c,d,m,t.side!==B,x))===null)return null;Pl.copy(x),Pl.applyMatrix4(e.matrixWorld);var A=n.ray.origin.distanceTo(Pl);return A<n.near||A>n.far?null:{distance:A,point:Pl.clone(),object:e}}function Ol(e,t,n,i,c,d,m,x,A,I,X,Q){jo.fromBufferAttribute(c,I),is.fromBufferAttribute(c,X),ua.fromBufferAttribute(c,Q);var re=e.morphTargetInfluences;if(t.morphTargets&&d&&re){Ts.set(0,0,0),Pa.set(0,0,0),sc.set(0,0,0);for(var z=0,ue=d.length;z<ue;z++){var me=re[z],ye=d[z];me!==0&&(Xo.fromBufferAttribute(ye,I),hu.fromBufferAttribute(ye,X),du.fromBufferAttribute(ye,Q),m?(Ts.addScaledVector(Xo,me),Pa.addScaledVector(hu,me),sc.addScaledVector(du,me)):(Ts.addScaledVector(Xo.sub(jo),me),Pa.addScaledVector(hu.sub(is),me),sc.addScaledVector(du.sub(ua),me)))}jo.add(Ts),is.add(Pa),ua.add(sc)}var Pe=Oa(e,t,n,i,jo,is,ua,zi);if(Pe){x&&(El.fromBufferAttribute(x,I),os.fromBufferAttribute(x,X),qs.fromBufferAttribute(x,Q),Pe.uv=Ri.getUV(zi,jo,is,ua,El,os,qs,new zt)),A&&(El.fromBufferAttribute(A,I),os.fromBufferAttribute(A,X),qs.fromBufferAttribute(A,Q),Pe.uv2=Ri.getUV(zi,jo,is,ua,El,os,qs,new zt));var Le=new yn(I,X,Q);Ri.getNormal(jo,is,ua,Le.normal),Pe.face=Le}return Pe}_i.prototype=Object.assign(Object.create(Pt.prototype),{constructor:_i,isMesh:!0,copy:function(e){return Pt.prototype.copy.call(this,e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,i=this.geometry;if(i.isBufferGeometry){var c=i.morphAttributes,d=Object.keys(c);if(0<d.length){var m=c[d[0]];if(m!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=m.length;e<t;e++)n=m[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var x=i.morphTargets;x!==void 0&&0<x.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var n,i=this.geometry,c=this.material,d=this.matrixWorld;if(c!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),uu.copy(i.boundingSphere),uu.applyMatrix4(d),e.ray.intersectsSphere(uu)!==!1&&(ac.getInverse(d),Js.copy(e.ray).applyMatrix4(ac),i.boundingBox===null||Js.intersectsBox(i.boundingBox)!==!1))){if(i.isBufferGeometry){var m,x,A,I,X,Q,re,z,ue,me=i.index,ye=i.attributes.position,Pe=i.morphAttributes.position,Le=i.morphTargetsRelative,Ge=i.attributes.uv,Qe=i.attributes.uv2,Ve=i.groups,ot=i.drawRange;if(me!==null)if(Array.isArray(c))for(I=0,Q=Ve.length;I<Q;I++)for(ue=c[(z=Ve[I]).materialIndex],X=Math.max(z.start,ot.start),re=Math.min(z.start+z.count,ot.start+ot.count);X<re;X+=3)m=me.getX(X),x=me.getX(X+1),A=me.getX(X+2),(n=Ol(this,ue,e,Js,ye,Pe,Le,Ge,Qe,m,x,A))&&(n.faceIndex=Math.floor(X/3),n.face.materialIndex=z.materialIndex,t.push(n));else for(I=Math.max(0,ot.start),Q=Math.min(me.count,ot.start+ot.count);I<Q;I+=3)m=me.getX(I),x=me.getX(I+1),A=me.getX(I+2),(n=Ol(this,c,e,Js,ye,Pe,Le,Ge,Qe,m,x,A))&&(n.faceIndex=Math.floor(I/3),t.push(n));else if(ye!==void 0)if(Array.isArray(c))for(I=0,Q=Ve.length;I<Q;I++)for(ue=c[(z=Ve[I]).materialIndex],X=Math.max(z.start,ot.start),re=Math.min(z.start+z.count,ot.start+ot.count);X<re;X+=3)(n=Ol(this,ue,e,Js,ye,Pe,Le,Ge,Qe,m=X,x=X+1,A=X+2))&&(n.faceIndex=Math.floor(X/3),n.face.materialIndex=z.materialIndex,t.push(n));else for(I=Math.max(0,ot.start),Q=Math.min(ye.count,ot.start+ot.count);I<Q;I+=3)(n=Ol(this,c,e,Js,ye,Pe,Le,Ge,Qe,m=I,x=I+1,A=I+2))&&(n.faceIndex=Math.floor(I/3),t.push(n))}else if(i.isGeometry){var We,vt,_t,Dt,Et=Array.isArray(c),Vt=i.vertices,Kt=i.faces,Ct=i.faceVertexUvs[0];0<Ct.length&&(Dt=Ct);for(var Mt=0,hn=Kt.length;Mt<hn;Mt++){var Mn=Kt[Mt],Yn=Et?c[Mn.materialIndex]:c;if(Yn!==void 0&&(We=Vt[Mn.a],vt=Vt[Mn.b],_t=Vt[Mn.c],n=Oa(this,Yn,e,Js,We,vt,_t,zi))){if(Dt&&Dt[Mt]){var qn=Dt[Mt];El.copy(qn[0]),os.copy(qn[1]),qs.copy(qn[2]),n.uv=Ri.getUV(zi,We,vt,_t,El,os,qs,new zt)}n.face=Mn,n.faceIndex=Mt,t.push(n)}}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var pu=0,Ao=new fr,fu=new Pt,po=new Ae;function sr(){Object.defineProperty(this,"id",{value:pu+=2}),this.uuid=vr.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}sr.prototype=Object.assign(Object.create(ko.prototype),{constructor:sr,isGeometry:!0,applyMatrix4:function(e){for(var t=new Si().getNormalMatrix(e),n=0,i=this.vertices.length;n<i;n++)this.vertices[n].applyMatrix4(e);for(n=0,i=this.faces.length;n<i;n++){var c=this.faces[n];c.normal.applyMatrix3(t).normalize();for(var d=0,m=c.vertexNormals.length;d<m;d++)c.vertexNormals[d].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Ao.makeRotationX(e),this.applyMatrix4(Ao),this},rotateY:function(e){return Ao.makeRotationY(e),this.applyMatrix4(Ao),this},rotateZ:function(e){return Ao.makeRotationZ(e),this.applyMatrix4(Ao),this},translate:function(e,t,n){return Ao.makeTranslation(e,t,n),this.applyMatrix4(Ao),this},scale:function(e,t,n){return Ao.makeScale(e,t,n),this.applyMatrix4(Ao),this},lookAt:function(e){return fu.lookAt(e),fu.updateMatrix(),this.applyMatrix4(fu.matrix),this},fromBufferGeometry:function(e){var t=this,n=e.index!==null?e.index.array:void 0,i=e.attributes;if(i.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var c=i.position.array,d=i.normal!==void 0?i.normal.array:void 0,m=i.color!==void 0?i.color.array:void 0,x=i.uv!==void 0?i.uv.array:void 0,A=i.uv2!==void 0?i.uv2.array:void 0;A!==void 0&&(this.faceVertexUvs[1]=[]);for(var I=0;I<c.length;I+=3)t.vertices.push(new Ae().fromArray(c,I)),m!==void 0&&t.colors.push(new $e().fromArray(m,I));function X(ye,Pe,Le,Ge){var Qe=m===void 0?[]:[t.colors[ye].clone(),t.colors[Pe].clone(),t.colors[Le].clone()],Ve=new yn(ye,Pe,Le,d===void 0?[]:[new Ae().fromArray(d,3*ye),new Ae().fromArray(d,3*Pe),new Ae().fromArray(d,3*Le)],Qe,Ge);t.faces.push(Ve),x!==void 0&&t.faceVertexUvs[0].push([new zt().fromArray(x,2*ye),new zt().fromArray(x,2*Pe),new zt().fromArray(x,2*Le)]),A!==void 0&&t.faceVertexUvs[1].push([new zt().fromArray(A,2*ye),new zt().fromArray(A,2*Pe),new zt().fromArray(A,2*Le)])}var Q=e.groups;if(0<Q.length)for(I=0;I<Q.length;I++)for(var re=Q[I],z=re.start,ue=z,me=z+re.count;ue<me;ue+=3)n!==void 0?X(n[ue],n[ue+1],n[ue+2],re.materialIndex):X(ue,ue+1,ue+2,re.materialIndex);else if(n!==void 0)for(I=0;I<n.length;I+=3)X(n[I],n[I+1],n[I+2]);else for(I=0;I<c.length/3;I+=3)X(I,I+1,I+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(po).negate(),this.translate(po.x,po.y,po.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=t===0?1:1/t,i=new fr;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(i),this},computeFaceNormals:function(){for(var e=new Ae,t=new Ae,n=0,i=this.faces.length;n<i;n++){var c=this.faces[n],d=this.vertices[c.a],m=this.vertices[c.b],x=this.vertices[c.c];e.subVectors(x,m),t.subVectors(d,m),e.cross(t),e.normalize(),c.normal.copy(e)}},computeVertexNormals:function(e){var t,n,i,c,d,m;for(e===void 0&&(e=!0),m=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)m[t]=new Ae;if(e){var x,A,I,X=new Ae,Q=new Ae;for(i=0,c=this.faces.length;i<c;i++)d=this.faces[i],x=this.vertices[d.a],A=this.vertices[d.b],I=this.vertices[d.c],X.subVectors(I,A),Q.subVectors(x,A),X.cross(Q),m[d.a].add(X),m[d.b].add(X),m[d.c].add(X)}else for(this.computeFaceNormals(),i=0,c=this.faces.length;i<c;i++)m[(d=this.faces[i]).a].add(d.normal),m[d.b].add(d.normal),m[d.c].add(d.normal);for(t=0,n=this.vertices.length;t<n;t++)m[t].normalize();for(i=0,c=this.faces.length;i<c;i++){var re=(d=this.faces[i]).vertexNormals;re.length===3?(re[0].copy(m[d.a]),re[1].copy(m[d.b]),re[2].copy(m[d.c])):(re[0]=m[d.a].clone(),re[1]=m[d.b].clone(),re[2]=m[d.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var i=(n=this.faces[e]).vertexNormals;i.length===3?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,i,c;for(n=0,i=this.faces.length;n<i;n++)for((c=this.faces[n]).__originalFaceNormal?c.__originalFaceNormal.copy(c.normal):c.__originalFaceNormal=c.normal.clone(),c.__originalVertexNormals||(c.__originalVertexNormals=[]),e=0,t=c.vertexNormals.length;e<t;e++)c.__originalVertexNormals[e]?c.__originalVertexNormals[e].copy(c.vertexNormals[e]):c.__originalVertexNormals[e]=c.vertexNormals[e].clone();var d=new sr;for(d.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var m=this.morphNormals[e].faceNormals,x=this.morphNormals[e].vertexNormals;for(n=0,i=this.faces.length;n<i;n++)A=new Ae,I={a:new Ae,b:new Ae,c:new Ae},m.push(A),x.push(I)}var A,I,X=this.morphNormals[e];for(d.vertices=this.morphTargets[e].vertices,d.computeFaceNormals(),d.computeVertexNormals(),n=0,i=this.faces.length;n<i;n++)c=this.faces[n],A=X.faceNormals[n],I=X.vertexNormals[n],A.copy(c.normal),I.a.copy(c.vertexNormals[0]),I.b.copy(c.vertexNormals[1]),I.c.copy(c.vertexNormals[2])}for(n=0,i=this.faces.length;n<i;n++)(c=this.faces[n]).normal=c.__originalFaceNormal,c.vertexNormals=c.__originalVertexNormals},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Xi),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Kr),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var i,c=this.vertices.length,d=this.vertices,m=e.vertices,x=this.faces,A=e.faces,I=this.colors,X=e.colors;n===void 0&&(n=0),t!==void 0&&(i=new Si().getNormalMatrix(t));for(var Q=0,re=m.length;Q<re;Q++){var z=m[Q].clone();t!==void 0&&z.applyMatrix4(t),d.push(z)}for(Q=0,re=X.length;Q<re;Q++)I.push(X[Q].clone());for(Q=0,re=A.length;Q<re;Q++){var ue,me,ye,Pe=A[Q],Le=Pe.vertexNormals,Ge=Pe.vertexColors;(ue=new yn(Pe.a+c,Pe.b+c,Pe.c+c)).normal.copy(Pe.normal),i!==void 0&&ue.normal.applyMatrix3(i).normalize();for(var Qe=0,Ve=Le.length;Qe<Ve;Qe++)me=Le[Qe].clone(),i!==void 0&&me.applyMatrix3(i).normalize(),ue.vertexNormals.push(me);for(ue.color.copy(Pe.color),Qe=0,Ve=Ge.length;Qe<Ve;Qe++)ye=Ge[Qe],ue.vertexColors.push(ye.clone());ue.materialIndex=Pe.materialIndex+n,x.push(ue)}for(Q=0,re=e.faceVertexUvs.length;Q<re;Q++){var ot=e.faceVertexUvs[Q];for(this.faceVertexUvs[Q]===void 0&&(this.faceVertexUvs[Q]=[]),Qe=0,Ve=ot.length;Qe<Ve;Qe++){for(var We=ot[Qe],vt=[],_t=0,Dt=We.length;_t<Dt;_t++)vt.push(We[_t].clone());this.faceVertexUvs[Q].push(vt)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,i,c,d,m,x,A={},I=[],X=[],Q=Math.pow(10,4);for(n=0,i=this.vertices.length;n<i;n++)e=this.vertices[n],A[t=Math.round(e.x*Q)+"_"+Math.round(e.y*Q)+"_"+Math.round(e.z*Q)]===void 0?(A[t]=n,I.push(this.vertices[n]),X[n]=I.length-1):X[n]=X[A[t]];var re=[];for(n=0,i=this.faces.length;n<i;n++){(c=this.faces[n]).a=X[c.a],c.b=X[c.b],c.c=X[c.c],d=[c.a,c.b,c.c];for(var z=0;z<3;z++)if(d[z]===d[(z+1)%3]){re.push(n);break}}for(n=re.length-1;0<=n;n--){var ue=re[n];for(this.faces.splice(ue,1),m=0,x=this.faceVertexUvs.length;m<x;m++)this.faceVertexUvs[m].splice(ue,1)}var me=this.vertices.length-I.length;return this.vertices=I,me},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var i=e[t];this.vertices.push(new Ae(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort(function(A,I){return A.materialIndex-I.materialIndex});var i,c,d=this.faceVertexUvs[0],m=this.faceVertexUvs[1];for(d&&d.length===t&&(i=[]),m&&m.length===t&&(c=[]),n=0;n<t;n++){var x=e[n]._id;i&&i.push(d[x]),c&&c.push(m[x])}i&&(this.faceVertexUvs[0]=i),c&&(this.faceVertexUvs[1]=c)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){var t=this.parameters;for(var n in t)t[n]!==void 0&&(e[n]=t[n]);return e}for(var i=[],c=0;c<this.vertices.length;c++){var d=this.vertices[c];i.push(d.x,d.y,d.z)}var m=[],x=[],A={},I=[],X={},Q=[],re={};for(c=0;c<this.faces.length;c++){var z=this.faces[c],ue=this.faceVertexUvs[0][c]!==void 0,me=0<z.normal.length(),ye=0<z.vertexNormals.length,Pe=z.color.r!==1||z.color.g!==1||z.color.b!==1,Le=0<z.vertexColors.length,Ge=0;if(Ge=We(Ge=We(Ge=We(Ge=We(Ge=We(Ge=We(Ge=We(Ge=We(Ge,0,0),1,!0),2,!1),3,ue),4,me),5,ye),6,Pe),7,Le),m.push(Ge),m.push(z.a,z.b,z.c),m.push(z.materialIndex),ue){var Qe=this.faceVertexUvs[0][c];m.push(Dt(Qe[0]),Dt(Qe[1]),Dt(Qe[2]))}if(me&&m.push(vt(z.normal)),ye){var Ve=z.vertexNormals;m.push(vt(Ve[0]),vt(Ve[1]),vt(Ve[2]))}if(Pe&&m.push(_t(z.color)),Le){var ot=z.vertexColors;m.push(_t(ot[0]),_t(ot[1]),_t(ot[2]))}}function We(Et,Vt,Kt){return Kt?Et|1<<Vt:Et&~(1<<Vt)}function vt(Et){var Vt=Et.x.toString()+Et.y.toString()+Et.z.toString();return A[Vt]!==void 0||(A[Vt]=x.length/3,x.push(Et.x,Et.y,Et.z)),A[Vt]}function _t(Et){var Vt=Et.r.toString()+Et.g.toString()+Et.b.toString();return X[Vt]!==void 0||(X[Vt]=I.length,I.push(Et.getHex())),X[Vt]}function Dt(Et){var Vt=Et.x.toString()+Et.y.toString();return re[Vt]!==void 0||(re[Vt]=Q.length/2,Q.push(Et.x,Et.y)),re[Vt]}return e.data={},e.data.vertices=i,e.data.normals=x,0<I.length&&(e.data.colors=I),0<Q.length&&(e.data.uvs=[Q]),e.data.faces=m,e},clone:function(){return new sr().copy(this)},copy:function(e){var t,n,i,c,d,m;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var x=e.vertices;for(t=0,n=x.length;t<n;t++)this.vertices.push(x[t].clone());var A=e.colors;for(t=0,n=A.length;t<n;t++)this.colors.push(A[t].clone());var I=e.faces;for(t=0,n=I.length;t<n;t++)this.faces.push(I[t].clone());for(t=0,n=e.faceVertexUvs.length;t<n;t++){var X=e.faceVertexUvs[t];for(this.faceVertexUvs[t]===void 0&&(this.faceVertexUvs[t]=[]),i=0,c=X.length;i<c;i++){var Q=X[i],re=[];for(d=0,m=Q.length;d<m;d++){var z=Q[d];re.push(z.clone())}this.faceVertexUvs[t].push(re)}}var ue=e.morphTargets;for(t=0,n=ue.length;t<n;t++){var me={};if(me.name=ue[t].name,ue[t].vertices!==void 0)for(me.vertices=[],i=0,c=ue[t].vertices.length;i<c;i++)me.vertices.push(ue[t].vertices[i].clone());if(ue[t].normals!==void 0)for(me.normals=[],i=0,c=ue[t].normals.length;i<c;i++)me.normals.push(ue[t].normals[i].clone());this.morphTargets.push(me)}var ye=e.morphNormals;for(t=0,n=ye.length;t<n;t++){var Pe={};if(ye[t].vertexNormals!==void 0)for(Pe.vertexNormals=[],i=0,c=ye[t].vertexNormals.length;i<c;i++){var Le=ye[t].vertexNormals[i],Ge={};Ge.a=Le.a.clone(),Ge.b=Le.b.clone(),Ge.c=Le.c.clone(),Pe.vertexNormals.push(Ge)}if(ye[t].faceNormals!==void 0)for(Pe.faceNormals=[],i=0,c=ye[t].faceNormals.length;i<c;i++)Pe.faceNormals.push(ye[t].faceNormals[i].clone());this.morphNormals.push(Pe)}var Qe=e.skinWeights;for(t=0,n=Qe.length;t<n;t++)this.skinWeights.push(Qe[t].clone());var Ve=e.skinIndices;for(t=0,n=Ve.length;t<n;t++)this.skinIndices.push(Ve[t].clone());var ot=e.lineDistances;for(t=0,n=ot.length;t<n;t++)this.lineDistances.push(ot[t]);var We=e.boundingBox;We!==null&&(this.boundingBox=We.clone());var vt=e.boundingSphere;return vt!==null&&(this.boundingSphere=vt.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ah=function(e){function t(n,i,c,d,m,x){e.call(this),this.type="BoxGeometry",this.parameters={width:n,height:i,depth:c,widthSegments:d,heightSegments:m,depthSegments:x},this.fromBufferGeometry(new lc(n,i,c,d,m,x)),this.mergeVertices()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t}(sr),lc=function(e){function t(n,i,c,d,m,x){e.call(this),this.type="BoxBufferGeometry",this.parameters={width:n,height:i,depth:c,widthSegments:d,heightSegments:m,depthSegments:x};var A=this;n=n||1,i=i||1,c=c||1,d=Math.floor(d)||1,m=Math.floor(m)||1;var I=[],X=[],Q=[],re=[],z=0,ue=0;function me(ye,Pe,Le,Ge,Qe,Ve,ot,We,vt,_t,Dt){var Et,Vt,Kt=Ve/vt,Ct=ot/_t,Mt=Ve/2,hn=ot/2,Mn=We/2,Yn=vt+1,qn=_t+1,Vn=0,cr=0,En=new Ae;for(Vt=0;Vt<qn;Vt++){var ke=Vt*Ct-hn;for(Et=0;Et<Yn;Et++){var et=Et*Kt-Mt;En[ye]=et*Ge,En[Pe]=ke*Qe,En[Le]=Mn,X.push(En.x,En.y,En.z),En[ye]=0,En[Pe]=0,En[Le]=0<We?1:-1,Q.push(En.x,En.y,En.z),re.push(Et/vt),re.push(1-Vt/_t),Vn+=1}}for(Vt=0;Vt<_t;Vt++)for(Et=0;Et<vt;Et++){var Yt=z+Et+Yn*Vt,Ht=z+Et+Yn*(Vt+1),rr=z+(Et+1)+Yn*(Vt+1),Pn=z+(Et+1)+Yn*Vt;I.push(Yt,Ht,Pn),I.push(Ht,rr,Pn),cr+=6}A.addGroup(ue,cr,Dt),ue+=cr,z+=Vn}me("z","y","x",-1,-1,c,i,n,x=Math.floor(x)||1,m,0),me("z","y","x",1,-1,c,i,-n,x,m,1),me("x","z","y",1,1,n,c,i,d,x,2),me("x","z","y",1,-1,n,c,-i,d,x,3),me("x","y","z",1,-1,n,i,c,d,m,4),me("x","y","z",-1,-1,n,i,-c,d,m,5),this.setIndex(I),this.setAttribute("position",new on(X,3)),this.setAttribute("normal",new on(Q,3)),this.setAttribute("uv",new on(re,2))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t}(Dn);function Cs(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var c=e[n][i];c&&(c.isColor||c.isMatrix3||c.isMatrix4||c.isVector2||c.isVector3||c.isVector4||c.isTexture)?t[n][i]=c.clone():Array.isArray(c)?t[n][i]=c.slice():t[n][i]=c}return t}function Zi(e){for(var t={},n=0;n<e.length;n++){var i=Cs(e[n]);for(var c in i)t[c]=i[c]}return t}var sh={clone:Cs,merge:Zi},cc=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,lh=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function Yo(e){It.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=cc,this.fragmentShader=lh,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Aa(){Pt.call(this),this.type="Camera",this.matrixWorldInverse=new fr,this.projectionMatrix=new fr,this.projectionMatrixInverse=new fr}function Ii(e,t,n,i){Aa.call(this),this.type="PerspectiveCamera",this.fov=e!==void 0?e:50,this.zoom=1,this.near=n!==void 0?n:.1,this.far=i!==void 0?i:2e3,this.focus=10,this.aspect=t!==void 0?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Xs(e,t,n,i){Pt.call(this),this.type="CubeCamera";var c=new Ii(90,1,e,t);c.up.set(0,-1,0),c.lookAt(new Ae(1,0,0)),this.add(c);var d=new Ii(90,1,e,t);d.up.set(0,-1,0),d.lookAt(new Ae(-1,0,0)),this.add(d);var m=new Ii(90,1,e,t);m.up.set(0,0,1),m.lookAt(new Ae(0,1,0)),this.add(m);var x=new Ii(90,1,e,t);x.up.set(0,0,-1),x.lookAt(new Ae(0,-1,0)),this.add(x);var A=new Ii(90,1,e,t);A.up.set(0,-1,0),A.lookAt(new Ae(0,0,1)),this.add(A);var I=new Ii(90,1,e,t);I.up.set(0,-1,0),I.lookAt(new Ae(0,0,-1)),this.add(I),i=i||{format:Gr,magFilter:xn,minFilter:xn},this.renderTarget=new Ys(n,i),this.renderTarget.texture.name="CubeCamera",this.update=function(X,Q){this.parent===null&&this.updateMatrixWorld();var re=X.getRenderTarget(),z=this.renderTarget,ue=z.texture.generateMipmaps;z.texture.generateMipmaps=!1,X.setRenderTarget(z,0),X.render(Q,c),X.setRenderTarget(z,1),X.render(Q,d),X.setRenderTarget(z,2),X.render(Q,m),X.setRenderTarget(z,3),X.render(Q,x),X.setRenderTarget(z,4),X.render(Q,A),z.texture.generateMipmaps=ue,X.setRenderTarget(z,5),X.render(Q,I),X.setRenderTarget(re)},this.clear=function(X,Q,re,z){for(var ue=X.getRenderTarget(),me=this.renderTarget,ye=0;ye<6;ye++)X.setRenderTarget(me,ye),X.clear(Q,re,z);X.setRenderTarget(ue)}}function Ys(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),qi.call(this,e,e,t)}function Al(e,t,n,i,c,d,m,x,A,I,X,Q){Yr.call(this,null,d,m,x,A,I,i,c,X,Q),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=A!==void 0?A:pt,this.minFilter=I!==void 0?I:pt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}((Yo.prototype=Object.create(It.prototype)).constructor=Yo).prototype.isShaderMaterial=!0,Yo.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Cs(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Yo.prototype.toJSON=function(e){var t=It.prototype.toJSON.call(this,e);for(var n in t.uniforms={},this.uniforms){var i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var c={};for(var d in this.extensions)this.extensions[d]===!0&&(c[d]=!0);return 0<Object.keys(c).length&&(t.extensions=c),t},Aa.prototype=Object.assign(Object.create(Pt.prototype),{constructor:Aa,isCamera:!0,copy:function(e,t){return Pt.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Ae),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Pt.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){Pt.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}}),Ii.prototype=Object.assign(Object.create(Aa.prototype),{constructor:Ii,isPerspectiveCamera:!0,copy:function(e,t){return Aa.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*vr.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*vr.DEG2RAD*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*vr.RAD2DEG*Math.atan(Math.tan(.5*vr.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,i,c,d){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=c,this.view.height=d,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*vr.DEG2RAD*this.fov)/this.zoom,n=2*t,i=this.aspect*n,c=-.5*i,d=this.view;if(this.view!==null&&this.view.enabled){var m=d.fullWidth,x=d.fullHeight;c+=d.offsetX*i/m,t-=d.offsetY*n/x,i*=d.width/m,n*=d.height/x}var A=this.filmOffset;A!==0&&(c+=e*A/this.getFilmWidth()),this.projectionMatrix.makePerspective(c,c+i,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Pt.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),(Xs.prototype=Object.create(Pt.prototype)).constructor=Xs,((Ys.prototype=Object.create(qi.prototype)).constructor=Ys).prototype.isWebGLCubeRenderTarget=!0,Ys.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var n=new Hn,i={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","	vWorldDirection = transformDirection( position, modelMatrix );","	#include <begin_vertex>","	#include <project_vertex>","}"].join(`
`),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","	vec3 direction = normalize( vWorldDirection );","	vec2 sampleUV;","	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","	gl_FragColor = texture2D( tEquirect, sampleUV );","}"].join(`
`)},c=new Yo({type:"CubemapFromEquirect",uniforms:Cs(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:T,blending:R});c.uniforms.tEquirect.value=t;var d=new _i(new lc(5,5,5),c);n.add(d);var m=new Xs(1,10,1);return m.renderTarget=this,m.renderTarget.texture.name="CubeCameraTexture",m.update(e,n),d.geometry.dispose(),d.material.dispose(),this},((Al.prototype=Object.create(Yr.prototype)).constructor=Al).prototype.isDataTexture=!0;var Zs=new Kr,Ks=new Ae;function $s(e,t,n,i,c,d){this.planes=[e!==void 0?e:new no,t!==void 0?t:new no,n!==void 0?n:new no,i!==void 0?i:new no,c!==void 0?c:new no,d!==void 0?d:new no]}Object.assign($s.prototype,{set:function(e,t,n,i,c,d){var m=this.planes;return m[0].copy(e),m[1].copy(t),m[2].copy(n),m[3].copy(i),m[4].copy(c),m[5].copy(d),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromProjectionMatrix:function(e){var t=this.planes,n=e.elements,i=n[0],c=n[1],d=n[2],m=n[3],x=n[4],A=n[5],I=n[6],X=n[7],Q=n[8],re=n[9],z=n[10],ue=n[11],me=n[12],ye=n[13],Pe=n[14],Le=n[15];return t[0].setComponents(m-i,X-x,ue-Q,Le-me).normalize(),t[1].setComponents(m+i,X+x,ue+Q,Le+me).normalize(),t[2].setComponents(m+c,X+A,ue+re,Le+ye).normalize(),t[3].setComponents(m-c,X-A,ue-re,Le-ye).normalize(),t[4].setComponents(m-d,X-I,ue-z,Le-Pe).normalize(),t[5].setComponents(m+d,X+I,ue+z,Le+Pe).normalize(),this},intersectsObject:function(e){var t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Zs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Zs)},intersectsSprite:function(e){return Zs.center.set(0,0,0),Zs.radius=.7071067811865476,Zs.applyMatrix4(e.matrixWorld),this.intersectsSphere(Zs)},intersectsSphere:function(e){for(var t=this.planes,n=e.center,i=-e.radius,c=0;c<6;c++)if(t[c].distanceToPoint(n)<i)return!1;return!0},intersectsBox:function(e){for(var t=this.planes,n=0;n<6;n++){var i=t[n];if(Ks.x=0<i.normal.x?e.max.x:e.min.x,Ks.y=0<i.normal.y?e.max.y:e.min.y,Ks.z=0<i.normal.z?e.max.z:e.min.z,i.distanceToPoint(Ks)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}});var bn={common:{diffuse:{value:new $e(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Si},uv2Transform:{value:new Si},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new zt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new $e(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new $e(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Si}},sprite:{diffuse:{value:new $e(15658734)},opacity:{value:1},center:{value:new zt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Si}}};function ch(){var e=null,t=!1,n=null;function i(c,d){t!==!1&&(n(c,d),e.requestAnimationFrame(i))}return{start:function(){t!==!0&&n!==null&&(e.requestAnimationFrame(i),t=!0)},stop:function(){t=!1},setAnimationLoop:function(c){n=c},setContext:function(c){e=c}}}function Rl(e,t,n,i){sr.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new Qs(e,t,n,i)),this.mergeVertices()}function Qs(e,t,n,i){Dn.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};var c,d,m=(e=e||1)/2,x=(t=t||1)/2,A=Math.floor(n)||1,I=Math.floor(i)||1,X=A+1,Q=I+1,re=e/A,z=t/I,ue=[],me=[],ye=[],Pe=[];for(d=0;d<Q;d++){var Le=d*z-x;for(c=0;c<X;c++){var Ge=c*re-m;me.push(Ge,-Le,0),ye.push(0,0,1),Pe.push(c/A),Pe.push(1-d/I)}}for(d=0;d<I;d++)for(c=0;c<A;c++){var Qe=c+X*d,Ve=c+X*(d+1),ot=c+1+X*(d+1),We=c+1+X*d;ue.push(Qe,Ve,We),ue.push(Ve,ot,We)}this.setIndex(ue),this.setAttribute("position",new on(me,3)),this.setAttribute("normal",new on(ye,3)),this.setAttribute("uv",new on(Pe,2))}(Rl.prototype=Object.create(sr.prototype)).constructor=Rl,(Qs.prototype=Object.create(Dn.prototype)).constructor=Qs;var Dr={alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE  = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS  = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha  = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;
	}
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;
		}
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
		varying vec3 vViewPosition;
	#endif
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
	varying vec3 vViewPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
	vViewPosition = - mvPosition.xyz;
#endif`,color_fragment:`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,color_pars_vertex:`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,color_vertex:`#ifdef USE_COLOR
	vColor.xyz = color.xyz;
#endif`,common:`#define PI 3.14159265359
#define PI2 6.28318530718
#define PI_HALF 1.5707963267949
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
#define LOG2 1.442695
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
  return m[ 2 ][ 3 ] == - 1.0;
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
#define cubeUV_maxMipLevel 8.0
#define cubeUV_minMipLevel 4.0
#define cubeUV_maxTileSize 256.0
#define cubeUV_minTileSize 16.0
float getFace(vec3 direction) {
    vec3 absDirection = abs(direction);
    float face = -1.0;
    if (absDirection.x > absDirection.z) {
      if (absDirection.x > absDirection.y)
        face = direction.x > 0.0 ? 0.0 : 3.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    } else {
      if (absDirection.z > absDirection.y)
        face = direction.z > 0.0 ? 2.0 : 5.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    }
    return face;
}
vec2 getUV(vec3 direction, float face) {
    vec2 uv;
    if (face == 0.0) {
      uv = vec2(-direction.z, direction.y) / abs(direction.x);
    } else if (face == 1.0) {
      uv = vec2(direction.x, -direction.z) / abs(direction.y);
    } else if (face == 2.0) {
      uv = direction.xy / abs(direction.z);
    } else if (face == 3.0) {
      uv = vec2(direction.z, direction.y) / abs(direction.x);
    } else if (face == 4.0) {
      uv = direction.xz / abs(direction.y);
    } else {
      uv = vec2(-direction.x, direction.y) / abs(direction.z);
    }
    return 0.5 * (uv + 1.0);
}
vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
  float face = getFace(direction);
  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
  mipInt = max(mipInt, cubeUV_minMipLevel);
  float faceSize = exp2(mipInt);
  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
  vec2 uv = getUV(direction, face) * (faceSize - 1.0);
  vec2 f = fract(uv);
  uv += 0.5 - f;
  if (face > 2.0) {
    uv.y += faceSize;
    face -= 3.0;
  }
  uv.x += face * faceSize;
  if(mipInt < cubeUV_maxMipLevel){
    uv.y += 2.0 * cubeUV_maxTileSize;
  }
  uv.y += filterInt * 2.0 * cubeUV_minTileSize;
  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
  uv *= texelSize;
  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x += texelSize;
  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.y += texelSize;
  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x -= texelSize;
  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  vec3 tm = mix(tl, tr, f.x);
  vec3 bm = mix(bl, br, f.x);
  return mix(tm, bm, f.y);
}
#define r0 1.0
#define v0 0.339
#define m0 -2.0
#define r1 0.8
#define v1 0.276
#define m1 -1.0
#define r4 0.4
#define v4 0.046
#define m4 2.0
#define r5 0.305
#define v5 0.016
#define m5 3.0
#define r6 0.21
#define v6 0.0038
#define m6 4.0
float roughnessToMip(float roughness) {
  float mip = 0.0;
  if (roughness >= r1) {
    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
  } else if (roughness >= r4) {
    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
  } else if (roughness >= r5) {
    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
  } else if (roughness >= r6) {
    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
  } else {
    mip = -2.0 * log2(1.16 * roughness);  }
  return mip;
}
vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {
  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);
  float mipF = fract(mip);
  float mipInt = floor(mip);
  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);
  if (mipF == 0.0) {
    return vec4(color0, 1.0);
  } else {
    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);
    return vec4(mix(color0, color1, mipF), 1.0);
  }
}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	transformedNormal = mat3( instanceMatrix ) * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value )  {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		}  else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#elif defined( ENVMAP_TYPE_EQUIREC )
		vec2 sampleUV;
		reflectVec = normalize( reflectVec );
		sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
		sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
		vec4 envColor = texture2D( envMap, sampleUV );
	#elif defined( ENVMAP_TYPE_SPHERE )
		reflectVec = normalize( reflectVec );
		vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );
		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
		  vec3 reflectVec = reflect( -viewDir, normal );
		  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
		  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#elif defined( ENVMAP_TYPE_EQUIREC )
			vec2 sampleUV;
			sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
			sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_SPHERE )
			vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) { 
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	fogDepth = -mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float fogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex:`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
#endif`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
		float shadowCameraNear;
		float shadowCameraFar;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = saturate( clearcoat );	material.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3	diffuseColor;
	float	specularRoughness;
	vec3	specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
	uniform float morphTargetInfluences[ 8 ];
	#else
	uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
	transformed += morphTarget4 * morphTargetInfluences[ 4 ];
	transformed += morphTarget5 * morphTargetInfluences[ 5 ];
	transformed += morphTarget6 * morphTargetInfluences[ 6 ];
	transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,normal_fragment_begin:`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		float scale = sign( st1.t * st0.s - st0.t * st1.s );
		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );
		mat3 tsn = mat3( S, T, N );
		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		return normalize( tsn * mapN );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );
	#endif
#endif`,clearcoat_normalmap_pars_fragment:`#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;
	}
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLights[ i ];
		shadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLights[ i ];
		shadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLights[ i ];
		shadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
uniform float toneMappingWhitePoint;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );
}`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( gl_FragCoord.z );
	#endif
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV;
	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	vLineDistance = scale * lineDistance;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSPARENCY
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSPARENCY
	uniform float transparency;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_normalmap_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSPARENCY
		diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,normal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,normal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,shadow_vert:`#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`},ba={basic:{uniforms:Zi([bn.common,bn.specularmap,bn.envmap,bn.aomap,bn.lightmap,bn.fog]),vertexShader:Dr.meshbasic_vert,fragmentShader:Dr.meshbasic_frag},lambert:{uniforms:Zi([bn.common,bn.specularmap,bn.envmap,bn.aomap,bn.lightmap,bn.emissivemap,bn.fog,bn.lights,{emissive:{value:new $e(0)}}]),vertexShader:Dr.meshlambert_vert,fragmentShader:Dr.meshlambert_frag},phong:{uniforms:Zi([bn.common,bn.specularmap,bn.envmap,bn.aomap,bn.lightmap,bn.emissivemap,bn.bumpmap,bn.normalmap,bn.displacementmap,bn.fog,bn.lights,{emissive:{value:new $e(0)},specular:{value:new $e(1118481)},shininess:{value:30}}]),vertexShader:Dr.meshphong_vert,fragmentShader:Dr.meshphong_frag},standard:{uniforms:Zi([bn.common,bn.envmap,bn.aomap,bn.lightmap,bn.emissivemap,bn.bumpmap,bn.normalmap,bn.displacementmap,bn.roughnessmap,bn.metalnessmap,bn.fog,bn.lights,{emissive:{value:new $e(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Dr.meshphysical_vert,fragmentShader:Dr.meshphysical_frag},toon:{uniforms:Zi([bn.common,bn.specularmap,bn.aomap,bn.lightmap,bn.emissivemap,bn.bumpmap,bn.normalmap,bn.displacementmap,bn.gradientmap,bn.fog,bn.lights,{emissive:{value:new $e(0)},specular:{value:new $e(1118481)},shininess:{value:30}}]),vertexShader:Dr.meshtoon_vert,fragmentShader:Dr.meshtoon_frag},matcap:{uniforms:Zi([bn.common,bn.bumpmap,bn.normalmap,bn.displacementmap,bn.fog,{matcap:{value:null}}]),vertexShader:Dr.meshmatcap_vert,fragmentShader:Dr.meshmatcap_frag},points:{uniforms:Zi([bn.points,bn.fog]),vertexShader:Dr.points_vert,fragmentShader:Dr.points_frag},dashed:{uniforms:Zi([bn.common,bn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Dr.linedashed_vert,fragmentShader:Dr.linedashed_frag},depth:{uniforms:Zi([bn.common,bn.displacementmap]),vertexShader:Dr.depth_vert,fragmentShader:Dr.depth_frag},normal:{uniforms:Zi([bn.common,bn.bumpmap,bn.normalmap,bn.displacementmap,{opacity:{value:1}}]),vertexShader:Dr.normal_vert,fragmentShader:Dr.normal_frag},sprite:{uniforms:Zi([bn.sprite,bn.fog]),vertexShader:Dr.sprite_vert,fragmentShader:Dr.sprite_frag},background:{uniforms:{uvTransform:{value:new Si},t2D:{value:null}},vertexShader:Dr.background_vert,fragmentShader:Dr.background_frag},cube:{uniforms:Zi([bn.envmap,{opacity:{value:1}}]),vertexShader:Dr.cube_vert,fragmentShader:Dr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Dr.equirect_vert,fragmentShader:Dr.equirect_frag},distanceRGBA:{uniforms:Zi([bn.common,bn.displacementmap,{referencePosition:{value:new Ae},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Dr.distanceRGBA_vert,fragmentShader:Dr.distanceRGBA_frag},shadow:{uniforms:Zi([bn.lights,bn.fog,{color:{value:new $e(0)},opacity:{value:1}}]),vertexShader:Dr.shadow_vert,fragmentShader:Dr.shadow_frag}};function Lr(e,t,n,i){var c,d,m=new $e(0),x=0,A=null,I=0,X=null;function Q(re,z){t.buffers.color.setClear(re.r,re.g,re.b,z,i)}return{getClearColor:function(){return m},setClearColor:function(re,z){m.set(re),Q(m,x=z!==void 0?z:1)},getClearAlpha:function(){return x},setClearAlpha:function(re){Q(m,x=re)},render:function(re,z,ue,me){var ye=z.background,Pe=e.xr,Le=Pe.getSession&&Pe.getSession();if(Le&&Le.environmentBlendMode==="additive"&&(ye=null),ye===null?Q(m,x):ye&&ye.isColor&&(Q(ye,1),me=!0),(e.autoClear||me)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),ye&&(ye.isCubeTexture||ye.isWebGLCubeRenderTarget||ye.mapping===gt)){d===void 0&&((d=new _i(new lc(1,1,1),new Yo({type:"BackgroundCubeMaterial",uniforms:Cs(ba.cube.uniforms),vertexShader:ba.cube.vertexShader,fragmentShader:ba.cube.fragmentShader,side:T,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(Qe,Ve,ot){this.matrixWorld.copyPosition(ot.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(d));var Ge=ye.isWebGLCubeRenderTarget?ye.texture:ye;d.material.uniforms.envMap.value=Ge,d.material.uniforms.flipEnvMap.value=Ge.isCubeTexture?-1:1,A===ye&&I===Ge.version&&X===e.toneMapping||(d.material.needsUpdate=!0,A=ye,I=Ge.version,X=e.toneMapping),re.unshift(d,d.geometry,d.material,0,0,null)}else ye&&ye.isTexture&&(c===void 0&&((c=new _i(new Qs(2,2),new Yo({type:"BackgroundMaterial",uniforms:Cs(ba.background.uniforms),vertexShader:ba.background.vertexShader,fragmentShader:ba.background.fragmentShader,side:P,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),(c.material.uniforms.t2D.value=ye).matrixAutoUpdate===!0&&ye.updateMatrix(),c.material.uniforms.uvTransform.value.copy(ye.matrix),A===ye&&I===ye.version&&X===e.toneMapping||(c.material.needsUpdate=!0,I=(A=ye).version,X=e.toneMapping),re.unshift(c,c.geometry,c.material,0,0,null))}}}function uc(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Ss(e,t,n,i,c,d,m,x,A,I){Yr.call(this,e=e!==void 0?e:[],t=t!==void 0?t:Gt,n,i,c,d,m=m!==void 0?m:Gr,x,A,I),this.flipY=!1}function mu(e,t,n,i){Yr.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:i||1},this.magFilter=pt,this.minFilter=pt,this.wrapR=Rn,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function No(e,t,n,i){Yr.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:i||1},this.magFilter=pt,this.minFilter=pt,this.wrapR=Rn,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}ba.physical={uniforms:Zi([ba.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new $e(0)},clearcoatNormalScale:{value:new zt(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:Dr.meshphysical_vert,fragmentShader:Dr.meshphysical_frag},((Ss.prototype=Object.create(Yr.prototype)).constructor=Ss).prototype.isCubeTexture=!0,Object.defineProperty(Ss.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),((mu.prototype=Object.create(Yr.prototype)).constructor=mu).prototype.isDataTexture2DArray=!0,((No.prototype=Object.create(Yr.prototype)).constructor=No).prototype.isDataTexture3D=!0;var Gh=new Yr,gu=new mu,uh=new No,hh=new Ss,dh=[],Zo=[],as=new Float32Array(16),yu=new Float32Array(9),ph=new Float32Array(4);function ss(e,t,n){var i=e[0];if(i<=0||0<i)return e;var c=t*n,d=dh[c];if(d===void 0&&(d=new Float32Array(c),dh[c]=d),t!==0){i.toArray(d,0);for(var m=1,x=0;m!==t;++m)x+=n,e[m].toArray(d,x)}return d}function ha(e,t){if(e.length===t.length){for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return;return 1}}function Bo(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function fh(e,t){var n=Zo[t];n===void 0&&(n=new Int32Array(t),Zo[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function mh(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function gh(e,t){var n=this.cache;if(t.x!==void 0)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ha(n,t))return;e.uniform2fv(this.addr,t),Bo(n,t)}}function Ds(e,t){var n=this.cache;if(t.x!==void 0)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(t.r!==void 0)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(ha(n,t))return;e.uniform3fv(this.addr,t),Bo(n,t)}}function Wd(e,t){var n=this.cache;if(t.x!==void 0)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ha(n,t))return;e.uniform4fv(this.addr,t),Bo(n,t)}}function Es(e,t){var n=this.cache,i=t.elements;if(i===void 0){if(ha(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Bo(n,t)}else{if(ha(n,i))return;ph.set(i),e.uniformMatrix2fv(this.addr,!1,ph),Bo(n,i)}}function zh(e,t){var n=this.cache,i=t.elements;if(i===void 0){if(ha(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Bo(n,t)}else{if(ha(n,i))return;yu.set(i),e.uniformMatrix3fv(this.addr,!1,yu),Bo(n,i)}}function Uh(e,t){var n=this.cache,i=t.elements;if(i===void 0){if(ha(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Bo(n,t)}else{if(ha(n,i))return;as.set(i),e.uniformMatrix4fv(this.addr,!1,as),Bo(n,i)}}function yh(e,t,n){var i=this.cache,c=n.allocateTextureUnit();i[0]!==c&&(e.uniform1i(this.addr,c),i[0]=c),n.safeSetTexture2D(t||Gh,c)}function Hh(e,t,n){var i=this.cache,c=n.allocateTextureUnit();i[0]!==c&&(e.uniform1i(this.addr,c),i[0]=c),n.setTexture2DArray(t||gu,c)}function Wh(e,t,n){var i=this.cache,c=n.allocateTextureUnit();i[0]!==c&&(e.uniform1i(this.addr,c),i[0]=c),n.setTexture3D(t||uh,c)}function Jh(e,t,n){var i=this.cache,c=n.allocateTextureUnit();i[0]!==c&&(e.uniform1i(this.addr,c),i[0]=c),n.safeSetTextureCube(t||hh,c)}function qh(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Ko(e,t){var n=this.cache;ha(n,t)||(e.uniform2iv(this.addr,t),Bo(n,t))}function Ha(e,t){var n=this.cache;ha(n,t)||(e.uniform3iv(this.addr,t),Bo(n,t))}function vu(e,t){var n=this.cache;ha(n,t)||(e.uniform4iv(this.addr,t),Bo(n,t))}function Ll(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Xh(e,t){e.uniform1fv(this.addr,t)}function Yh(e,t){e.uniform1iv(this.addr,t)}function Zh(e,t){e.uniform2iv(this.addr,t)}function Il(e,t){e.uniform3iv(this.addr,t)}function hc(e,t){e.uniform4iv(this.addr,t)}function Kh(e,t){var n=ss(t,this.size,2);e.uniform2fv(this.addr,n)}function $h(e,t){var n=ss(t,this.size,3);e.uniform3fv(this.addr,n)}function xu(e,t){var n=ss(t,this.size,4);e.uniform4fv(this.addr,n)}function Qh(e,t){var n=ss(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function wu(e,t){var n=ss(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function vh(e,t){var n=ss(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function bu(e,t,n){var i=t.length,c=fh(n,i);e.uniform1iv(this.addr,c);for(var d=0;d!==i;++d)n.safeSetTexture2D(t[d]||Gh,c[d])}function ed(e,t,n){var i=t.length,c=fh(n,i);e.uniform1iv(this.addr,c);for(var d=0;d!==i;++d)n.safeSetTextureCube(t[d]||hh,c[d])}function Mu(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(i){switch(t.type){case 5126:return mh;case 35664:return gh;case 35665:return Ds;case 35666:return Wd;case 35674:return Es;case 35675:return zh;case 35676:return Uh;case 5124:case 35670:return qh;case 35667:case 35671:return Ko;case 35668:case 35672:return Ha;case 35669:case 35673:return vu;case 5125:return Ll;case 35678:case 36198:case 36298:case 36306:case 35682:return yh;case 35679:case 36299:case 36307:return Wh;case 35680:case 36300:case 36308:case 36293:return Jh;case 36289:case 36303:case 36311:case 36292:return Hh}}()}function xh(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(i){switch(t.type){case 5126:return Xh;case 35664:return Kh;case 35665:return $h;case 35666:return xu;case 35674:return Qh;case 35675:return wu;case 35676:return vh;case 5124:case 35670:return Yh;case 35667:case 35671:return Zh;case 35668:case 35672:return Il;case 35669:case 35673:return hc;case 35678:case 36198:case 36298:case 36306:case 35682:return bu;case 35680:case 36300:case 36308:case 36293:return ed}}()}function _u(e){this.id=e,this.seq=[],this.map={}}xh.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Bo(t,e)},_u.prototype.setValue=function(e,t,n){for(var i=this.seq,c=0,d=i.length;c!==d;++c){var m=i[c];m.setValue(e,t[m.id],n)}};var wh=/([\w\d_]+)(\])?(\[|\.)?/g;function bh(e,t){e.seq.push(t),e.map[t.id]=t}function ls(e,t,n){var i=e.name,c=i.length;for(wh.lastIndex=0;;){var d=wh.exec(i),m=wh.lastIndex,x=d[1],A=d[2]==="]",I=d[3];if(A&&(x|=0),I===void 0||I==="["&&m+2===c){bh(n,new(I===void 0?Mu:xh)(x,e,t));break}var X=n.map[x];X===void 0&&bh(n,X=new _u(x)),n=X}}function cs(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),i=0;i<n;++i){var c=e.getActiveUniform(t,i);ls(c,e.getUniformLocation(t,c.name),this)}}function Mh(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}cs.prototype.setValue=function(e,t,n,i){var c=this.map[t];c!==void 0&&c.setValue(e,n,i)},cs.prototype.setOptional=function(e,t,n){var i=t[n];i!==void 0&&this.setValue(e,n,i)},cs.upload=function(e,t,n,i){for(var c=0,d=t.length;c!==d;++c){var m=t[c],x=n[m.id];x.needsUpdate!==!1&&m.setValue(e,x.value,i)}},cs.seqWithValue=function(e,t){for(var n=[],i=0,c=e.length;i!==c;++i){var d=e[i];d.id in t&&n.push(d)}return n};var Jd=0;function _h(e){switch(e){case Ze:return["Linear","( value )"];case yt:return["sRGB","( value )"];case Xt:return["RGBE","( value )"];case Gn:return["RGBM","( value, 7.0 )"];case ar:return["RGBM","( value, 16.0 )"];case hi:return["RGBD","( value, 256.0 )"];case Bt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case In:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function Wa(e,t,n){var i=e.getShaderParameter(t,35713),c=e.getShaderInfoLog(t).trim();return i&&c===""?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+`
`+c+function(d){for(var m=d.split(`
`),x=0;x<m.length;x++)m[x]=x+1+": "+m[x];return m.join(`
`)}(e.getShaderSource(t))}function el(e,t){var n=_h(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function tl(e){return e!==""}function Tu(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function dc(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var kl=/^[ \t]*#include +<([\w\d./]+)>/gm;function nr(e){return e.replace(kl,Cu)}function Cu(e,t){var n=Dr[t];if(n===void 0)throw new Error("Can not resolve #include <"+t+">");return nr(n)}var Th=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function Ps(e){return e.replace(Th,Ch)}function Ch(e,t,n,i){for(var c="",d=parseInt(t);d<parseInt(n);d++)c+=i.replace(/\[ i \]/g,"[ "+d+" ]").replace(/UNROLLED_LOOP_INDEX/g,d);return c}function Sh(e){var t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function Ro(e,t,n){var i,c,d,m,x,A,I,X=e.getContext(),Q=n.defines,re=n.vertexShader,z=n.fragmentShader,ue=(c="SHADOWMAP_TYPE_BASIC",(i=n).shadowMapType===N?c="SHADOWMAP_TYPE_PCF":i.shadowMapType===D?c="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===f&&(c="SHADOWMAP_TYPE_VSM"),c),me=function(cr){var En="ENVMAP_TYPE_CUBE";if(cr.envMap)switch(cr.envMapMode){case Gt:case jt:En="ENVMAP_TYPE_CUBE";break;case gt:case ze:En="ENVMAP_TYPE_CUBE_UV";break;case Tn:case mn:En="ENVMAP_TYPE_EQUIREC";break;case Qn:En="ENVMAP_TYPE_SPHERE"}return En}(n),ye=function(cr){var En="ENVMAP_MODE_REFLECTION";if(cr.envMap)switch(cr.envMapMode){case jt:case mn:En="ENVMAP_MODE_REFRACTION"}return En}(n),Pe=function(cr){var En="ENVMAP_BLENDING_NONE";if(cr.envMap)switch(cr.combine){case se:En="ENVMAP_BLENDING_MULTIPLY";break;case ve:En="ENVMAP_BLENDING_MIX";break;case Ee:En="ENVMAP_BLENDING_ADD"}return En}(n),Le=0<e.gammaFactor?e.gammaFactor:1,Ge=n.isWebGL2?"":[(d=n).extensionDerivatives||d.envMapCubeUV||d.bumpMap||d.tangentSpaceNormalMap||d.clearcoatNormalMap||d.flatShading||d.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(d.extensionFragDepth||d.logarithmicDepthBuffer)&&d.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",d.extensionDrawBuffers&&d.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(d.extensionShaderTextureLOD||d.envMap)&&d.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(tl).join(`
`),Qe=function(cr){var En=[];for(var ke in cr){var et=cr[ke];et!==!1&&En.push("#define "+ke+" "+et)}return En.join(`
`)}(Q),Ve=X.createProgram(),ot=n.numMultiviewViews;if(n.isRawShaderMaterial?(0<(m=[Qe].filter(tl).join(`
`)).length&&(m+=`
`),0<(x=[Ge,Qe].filter(tl).join(`
`)).length&&(x+=`
`)):(m=[Sh(n),"#define SHADER_NAME "+n.shaderName,Qe,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+Le,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+ye:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+ue:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(tl).join(`
`),x=[Ge,Sh(n),"#define SHADER_NAME "+n.shaderName,Qe,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+Le,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+me:"",n.envMap?"#define "+ye:"",n.envMap?"#define "+Pe:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+ue:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==rt?"#define TONE_MAPPING":"",n.toneMapping!==rt?Dr.tonemapping_pars_fragment:"",n.toneMapping!==rt?function(cr,En){var ke;switch(En){case tt:ke="Linear";break;case xt:ke="Reinhard";break;case Rt:ke="Uncharted2";break;case At:ke="OptimizedCineon";break;case He:ke="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+En)}return"vec3 toneMapping( vec3 color ) { return "+ke+"ToneMapping( color ); }"}(0,n.toneMapping):"",n.dithering?"#define DITHERING":"",n.outputEncoding||n.mapEncoding||n.matcapEncoding||n.envMapEncoding||n.emissiveMapEncoding||n.lightMapEncoding?Dr.encodings_pars_fragment:"",n.mapEncoding?el("mapTexelToLinear",n.mapEncoding):"",n.matcapEncoding?el("matcapTexelToLinear",n.matcapEncoding):"",n.envMapEncoding?el("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?el("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMapEncoding?el("lightMapTexelToLinear",n.lightMapEncoding):"",n.outputEncoding?(A=n.outputEncoding,I=_h(A),"vec4 linearToOutputTexel( vec4 value ) { return LinearTo"+I[0]+I[1]+"; }"):"",n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(tl).join(`
`)),re=dc(re=Tu(re=nr(re),n),n),z=dc(z=Tu(z=nr(z),n),n),re=Ps(re),z=Ps(z),n.isWebGL2&&!n.isRawShaderMaterial){var We=!1,vt=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&re.match(vt)!==null&&z.match(vt)!==null&&(We=!0,re=re.replace(vt,""),z=z.replace(vt,"")),m=[`#version 300 es
`,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,x=[`#version 300 es
`,"#define varying in",We?"":"out highp vec4 pc_fragColor;",We?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+x,0<ot&&(m=(m=m.replace(`#version 300 es
`,[`#version 300 es
`,"#extension GL_OVR_multiview2 : require","layout(num_views = "+ot+") in;","#define VIEW_ID gl_ViewID_OVR"].join(`
`))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join(`
`),["uniform mat4 modelViewMatrices["+ot+"];","uniform mat4 projectionMatrices["+ot+"];","uniform mat4 viewMatrices["+ot+"];","uniform mat3 normalMatrices["+ot+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join(`
`)),x=(x=x.replace(`#version 300 es
`,[`#version 300 es
`,"#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join(`
`))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+ot+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join(`
`)))}var _t,Dt,Et=x+z,Vt=Mh(X,35633,m+re),Kt=Mh(X,35632,Et);if(X.attachShader(Ve,Vt),X.attachShader(Ve,Kt),n.index0AttributeName!==void 0?X.bindAttribLocation(Ve,0,n.index0AttributeName):n.morphTargets===!0&&X.bindAttribLocation(Ve,0,"position"),X.linkProgram(Ve),e.debug.checkShaderErrors){var Ct=X.getProgramInfoLog(Ve).trim(),Mt=X.getShaderInfoLog(Vt).trim(),hn=X.getShaderInfoLog(Kt).trim(),Mn=!0,Yn=!0;if(X.getProgramParameter(Ve,35714)===!1){Mn=!1;var qn=Wa(X,Vt,"vertex"),Vn=Wa(X,Kt,"fragment");console.error("THREE.WebGLProgram: shader error: ",X.getError(),"35715",X.getProgramParameter(Ve,35715),"gl.getProgramInfoLog",Ct,qn,Vn)}else Ct!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",Ct):Mt!==""&&hn!==""||(Yn=!1);Yn&&(this.diagnostics={runnable:Mn,programLog:Ct,vertexShader:{log:Mt,prefix:m},fragmentShader:{log:hn,prefix:x}})}return X.deleteShader(Vt),X.deleteShader(Kt),this.getUniforms=function(){return _t===void 0&&(_t=new cs(X,Ve)),_t},this.getAttributes=function(){return Dt===void 0&&(Dt=function(cr,En){for(var ke={},et=cr.getProgramParameter(En,35721),Yt=0;Yt<et;Yt++){var Ht=cr.getActiveAttrib(En,Yt).name;ke[Ht]=cr.getAttribLocation(En,Ht)}return ke}(X,Ve)),Dt},this.destroy=function(){X.deleteProgram(Ve),this.program=void 0},this.name=n.shaderName,this.id=Jd++,this.cacheKey=t,this.usedTimes=1,this.program=Ve,this.vertexShader=Vt,this.fragmentShader=Kt,this.numMultiviewViews=ot,this}function td(e,t,n){var i=[],c=n.isWebGL2,d=n.logarithmicDepthBuffer,m=n.floatVertexTextures,x=n.precision,A=n.maxVertexUniforms,I=n.vertexTextures,X={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},Q=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function re(z){var ue;return z?z.isTexture?ue=z.encoding:z.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),ue=z.texture.encoding):ue=Ze,ue}this.getParameters=function(z,ue,me,ye,Pe,Le,Ge){var Qe=ye.fog,Ve=z.isMeshStandardMaterial?ye.environment:null,ot=z.envMap||Ve,We=X[z.type],vt=Ge.isSkinnedMesh?function(Vt){var Kt=Ge.skeleton.bones;if(m)return 1024;var Ct=A,Mt=Math.floor((Ct-20)/4),hn=Math.min(Mt,Kt.length);return hn<Kt.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+Kt.length+" bones. This GPU supports "+hn+"."),0):hn}():0;z.precision!==null&&(x=n.getMaxPrecision(z.precision))!==z.precision&&console.warn("THREE.WebGLProgram.getParameters:",z.precision,"not supported, using",x,"instead.");var _t=function(Vt,Kt){var Ct;if(We){var Mt=ba[We];Ct={name:Vt.type,uniforms:sh.clone(Mt.uniforms),vertexShader:Mt.vertexShader,fragmentShader:Mt.fragmentShader}}else Ct={name:Vt.type,uniforms:Vt.uniforms,vertexShader:Vt.vertexShader,fragmentShader:Vt.fragmentShader};return Ct}(z);z.onBeforeCompile(_t,e);var Dt=e.getRenderTarget(),Et=Dt&&Dt.isWebGLMultiviewRenderTarget?Dt.numViews:0;return{isWebGL2:c,shaderID:We,shaderName:_t.name,uniforms:_t.uniforms,vertexShader:_t.vertexShader,fragmentShader:_t.fragmentShader,defines:z.defines,isRawShaderMaterial:z.isRawShaderMaterial,isShaderMaterial:z.isShaderMaterial,precision:x,instancing:Ge.isInstancedMesh===!0,supportsVertexTextures:I,numMultiviewViews:Et,outputEncoding:Dt!==null?re(Dt.texture):e.outputEncoding,map:!!z.map,mapEncoding:re(z.map),matcap:!!z.matcap,matcapEncoding:re(z.matcap),envMap:!!ot,envMapMode:ot&&ot.mapping,envMapEncoding:re(ot),envMapCubeUV:!!ot&&(ot.mapping===gt||ot.mapping===ze),lightMap:!!z.lightMap,lightMapEncoding:re(z.lightMap),aoMap:!!z.aoMap,emissiveMap:!!z.emissiveMap,emissiveMapEncoding:re(z.emissiveMap),bumpMap:!!z.bumpMap,normalMap:!!z.normalMap,objectSpaceNormalMap:z.normalMapType===Ca,tangentSpaceNormalMap:z.normalMapType===va,clearcoatNormalMap:!!z.clearcoatNormalMap,displacementMap:!!z.displacementMap,roughnessMap:!!z.roughnessMap,metalnessMap:!!z.metalnessMap,specularMap:!!z.specularMap,alphaMap:!!z.alphaMap,gradientMap:!!z.gradientMap,sheen:!!z.sheen,combine:z.combine,vertexTangents:z.normalMap&&z.vertexTangents,vertexColors:z.vertexColors,vertexUvs:!!(z.map||z.bumpMap||z.normalMap||z.specularMap||z.alphaMap||z.emissiveMap||z.roughnessMap||z.metalnessMap||z.clearcoatNormalMap||z.displacementMap),uvsVertexOnly:!(z.map||z.bumpMap||z.normalMap||z.specularMap||z.alphaMap||z.emissiveMap||z.roughnessMap||z.metalnessMap||z.clearcoatNormalMap||!z.displacementMap),fog:!!Qe,useFog:z.fog,fogExp2:Qe&&Qe.isFogExp2,flatShading:z.flatShading,sizeAttenuation:z.sizeAttenuation,logarithmicDepthBuffer:d,skinning:z.skinning&&0<vt,maxBones:vt,useVertexTexture:m,morphTargets:z.morphTargets,morphNormals:z.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:ue.directional.length,numPointLights:ue.point.length,numSpotLights:ue.spot.length,numRectAreaLights:ue.rectArea.length,numHemiLights:ue.hemi.length,numDirLightShadows:ue.directionalShadowMap.length,numPointLightShadows:ue.pointShadowMap.length,numSpotLightShadows:ue.spotShadowMap.length,numClippingPlanes:Pe,numClipIntersection:Le,dithering:z.dithering,shadowMapEnabled:e.shadowMap.enabled&&0<me.length,shadowMapType:e.shadowMap.type,toneMapping:z.toneMapped?e.toneMapping:rt,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:z.premultipliedAlpha,alphaTest:z.alphaTest,doubleSided:z.side===B,flipSided:z.side===T,depthPacking:z.depthPacking!==void 0&&z.depthPacking,index0AttributeName:z.index0AttributeName,extensionDerivatives:z.extensions&&z.extensions.derivatives,extensionFragDepth:z.extensions&&z.extensions.frawbuffers,extensionDrawbuffers:z.extensions&&z.extensions.drawbuffers,extensionShaderTextureLOD:z.extensions&&z.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||t.get("EXT_frag_depth")!==null,rendererExtensionDrawBuffers:c||t.get("WEBGL_draw_buffers")!==null,rendererExtensionShaderTextureLod:c||t.get("EXT_shader_texture_lod")!==null,onBeforeCompile:z.onBeforeCompile}},this.getProgramCacheKey=function(z){var ue=[];if(z.shaderID?ue.push(z.shaderID):(ue.push(z.fragmentShader),ue.push(z.vertexShader)),z.defines!==void 0)for(var me in z.defines)ue.push(me),ue.push(z.defines[me]);if(z.isRawShaderMaterial===void 0){for(var ye=0;ye<Q.length;ye++)ue.push(z[Q[ye]]);ue.push(e.outputEncoding),ue.push(e.gammaFactor)}return ue.push(z.onBeforeCompile.toString()),ue.join()},this.acquireProgram=function(z,ue){for(var me,ye=0,Pe=i.length;ye<Pe;ye++){var Le=i[ye];if(Le.cacheKey===ue){++(me=Le).usedTimes;break}}return me===void 0&&(me=new Ro(e,ue,z),i.push(me)),me},this.releaseProgram=function(z){if(--z.usedTimes==0){var ue=i.indexOf(z);i[ue]=i[i.length-1],i.pop(),z.destroy()}},this.programs=i}function nd(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function qd(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ja(){var e=[],t=0,n=[],i=[],c={id:-1};function d(m,x,A,I,X,Q){var re=e[t];return re===void 0?(re={id:m.id,object:m,geometry:x,material:A,program:A.program||c,groupOrder:I,renderOrder:m.renderOrder,z:X,group:Q},e[t]=re):(re.id=m.id,re.object=m,re.geometry=x,re.material=A,re.program=A.program||c,re.groupOrder=I,re.renderOrder=m.renderOrder,re.z=X,re.group=Q),t++,re}return{opaque:n,transparent:i,init:function(){t=0,n.length=0,i.length=0},push:function(m,x,A,I,X,Q){var re=d(m,x,A,I,X,Q);(A.transparent===!0?i:n).push(re)},unshift:function(m,x,A,I,X,Q){var re=d(m,x,A,I,X,Q);(A.transparent===!0?i:n).unshift(re)},sort:function(m,x){1<n.length&&n.sort(m||nd),1<i.length&&i.sort(x||qd)}}}var Fo=0;function Dh(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Eh(){for(var e=new function(){var m={};return{get:function(x){if(m[x.id]!==void 0)return m[x.id];var A;switch(x.type){case"DirectionalLight":A={direction:new Ae,color:new $e,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new zt};break;case"SpotLight":A={position:new Ae,direction:new Ae,color:new $e,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new zt};break;case"PointLight":A={position:new Ae,color:new $e,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new zt,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":A={direction:new Ae,skyColor:new $e,groundColor:new $e};break;case"RectAreaLight":A={color:new $e,position:new Ae,halfWidth:new Ae,halfHeight:new Ae}}return m[x.id]=A}}},t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},n=0;n<9;n++)t.probe.push(new Ae);var i=new Ae,c=new fr,d=new fr;return{setup:function(m,x,A){for(var I=0,X=0,Q=0,re=0;re<9;re++)t.probe[re].set(0,0,0);var z=0,ue=0,me=0,ye=0,Pe=0,Le=0,Ge=0,Qe=0,Ve=A.matrixWorldInverse;m.sort(Dh),re=0;for(var ot=m.length;re<ot;re++){var We=m[re],vt=We.color,_t=We.intensity,Dt=We.distance,Et=We.shadow&&We.shadow.map?We.shadow.map.texture:null;if(We.isAmbientLight)I+=vt.r*_t,X+=vt.g*_t,Q+=vt.b*_t;else if(We.isLightProbe)for(var Vt=0;Vt<9;Vt++)t.probe[Vt].addScaledVector(We.sh.coefficients[Vt],_t);else if(We.isDirectionalLight){if((Ct=e.get(We)).color.copy(We.color).multiplyScalar(We.intensity),Ct.direction.setFromMatrixPosition(We.matrixWorld),i.setFromMatrixPosition(We.target.matrixWorld),Ct.direction.sub(i),Ct.direction.transformDirection(Ve),Ct.shadow=We.castShadow,We.castShadow){var Kt=We.shadow;Ct.shadowBias=Kt.bias,Ct.shadowRadius=Kt.radius,Ct.shadowMapSize=Kt.mapSize,t.directionalShadowMap[z]=Et,t.directionalShadowMatrix[z]=We.shadow.matrix,Le++}t.directional[z]=Ct,z++}else if(We.isSpotLight)(Ct=e.get(We)).position.setFromMatrixPosition(We.matrixWorld),Ct.position.applyMatrix4(Ve),Ct.color.copy(vt).multiplyScalar(_t),Ct.distance=Dt,Ct.direction.setFromMatrixPosition(We.matrixWorld),i.setFromMatrixPosition(We.target.matrixWorld),Ct.direction.sub(i),Ct.direction.transformDirection(Ve),Ct.coneCos=Math.cos(We.angle),Ct.penumbraCos=Math.cos(We.angle*(1-We.penumbra)),Ct.decay=We.decay,Ct.shadow=We.castShadow,We.castShadow&&(Kt=We.shadow,Ct.shadowBias=Kt.bias,Ct.shadowRadius=Kt.radius,Ct.shadowMapSize=Kt.mapSize,t.spotShadowMap[me]=Et,t.spotShadowMatrix[me]=We.shadow.matrix,Qe++),t.spot[me]=Ct,me++;else if(We.isRectAreaLight)(Ct=e.get(We)).color.copy(vt).multiplyScalar(_t),Ct.position.setFromMatrixPosition(We.matrixWorld),Ct.position.applyMatrix4(Ve),d.identity(),c.copy(We.matrixWorld),c.premultiply(Ve),d.extractRotation(c),Ct.halfWidth.set(.5*We.width,0,0),Ct.halfHeight.set(0,.5*We.height,0),Ct.halfWidth.applyMatrix4(d),Ct.halfHeight.applyMatrix4(d),t.rectArea[ye]=Ct,ye++;else if(We.isPointLight)(Ct=e.get(We)).position.setFromMatrixPosition(We.matrixWorld),Ct.position.applyMatrix4(Ve),Ct.color.copy(We.color).multiplyScalar(We.intensity),Ct.distance=We.distance,Ct.decay=We.decay,Ct.shadow=We.castShadow,We.castShadow&&(Kt=We.shadow,Ct.shadowBias=Kt.bias,Ct.shadowRadius=Kt.radius,Ct.shadowMapSize=Kt.mapSize,Ct.shadowCameraNear=Kt.camera.near,Ct.shadowCameraFar=Kt.camera.far,t.pointShadowMap[ue]=Et,t.pointShadowMatrix[ue]=We.shadow.matrix,Ge++),t.point[ue]=Ct,ue++;else if(We.isHemisphereLight){var Ct;(Ct=e.get(We)).direction.setFromMatrixPosition(We.matrixWorld),Ct.direction.transformDirection(Ve),Ct.direction.normalize(),Ct.skyColor.copy(We.color).multiplyScalar(_t),Ct.groundColor.copy(We.groundColor).multiplyScalar(_t),t.hemi[Pe]=Ct,Pe++}}t.ambient[0]=I,t.ambient[1]=X,t.ambient[2]=Q;var Mt=t.hash;Mt.directionalLength===z&&Mt.pointLength===ue&&Mt.spotLength===me&&Mt.rectAreaLength===ye&&Mt.hemiLength===Pe&&Mt.numDirectionalShadows===Le&&Mt.numPointShadows===Ge&&Mt.numSpotShadows===Qe||(t.directional.length=z,t.spot.length=me,t.rectArea.length=ye,t.point.length=ue,t.hemi.length=Pe,t.directionalShadowMap.length=Le,t.pointShadowMap.length=Ge,t.spotShadowMap.length=Qe,t.directionalShadowMatrix.length=Le,t.pointShadowMatrix.length=Ge,t.spotShadowMatrix.length=Qe,Mt.directionalLength=z,Mt.pointLength=ue,Mt.spotLength=me,Mt.rectAreaLength=ye,Mt.hemiLength=Pe,Mt.numDirectionalShadows=Le,Mt.numPointShadows=Ge,Mt.numSpotShadows=Qe,t.version=Fo++)},state:t}}function rd(){var e=new Eh,t=[],n=[];return{init:function(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function(i){e.setup(t,n,i)},pushLight:function(i){t.push(i)},pushShadow:function(i){n.push(i)}}}function qa(e){It.call(this),this.type="MeshDepthMaterial",this.depthPacking=aa,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function nl(e){It.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Ae,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}((qa.prototype=Object.create(It.prototype)).constructor=qa).prototype.isMeshDepthMaterial=!0,qa.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},((nl.prototype=Object.create(It.prototype)).constructor=nl).prototype.isMeshDistanceMaterial=!0,nl.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var id=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
  float mean = 0.0;
  float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );
  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
    #ifdef HORIZONAL_PASS
      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
      mean += distribution.x;
      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
    #else
      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );
      mean += depth;
      squared_mean += depth * depth;
    #endif
  }
  mean = mean * HALF_SAMPLE_RATE;
  squared_mean = squared_mean * HALF_SAMPLE_RATE;
  float std_dev = sqrt( squared_mean - mean * mean );
  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,od=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function Ph(e,t,n){var i=new $s,c=new zt,d=new zt,m=new Jr,x=[],A=[],I={},X={0:T,1:P,2:B},Q=new Yo({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new zt},radius:{value:4}},vertexShader:od,fragmentShader:id}),re=Q.clone();re.defines.HORIZONAL_PASS=1;var z=new Dn;z.setAttribute("position",new en(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var ue=new _i(z,Q),me=this;function ye(Ve,ot){var We=t.update(ue);Q.uniforms.shadow_pass.value=Ve.map.texture,Q.uniforms.resolution.value=Ve.mapSize,Q.uniforms.radius.value=Ve.radius,e.setRenderTarget(Ve.mapPass),e.clear(),e.renderBufferDirect(ot,null,We,Q,ue,null),re.uniforms.shadow_pass.value=Ve.mapPass.texture,re.uniforms.resolution.value=Ve.mapSize,re.uniforms.radius.value=Ve.radius,e.setRenderTarget(Ve.map),e.clear(),e.renderBufferDirect(ot,null,We,re,ue,null)}function Pe(Ve,ot,We){var vt=Ve<<0|ot<<1|We<<2,_t=x[vt];return _t===void 0&&(_t=new qa({depthPacking:Ci,morphTargets:Ve,skinning:ot}),x[vt]=_t),_t}function Le(Ve,ot,We){var vt=Ve<<0|ot<<1|We<<2,_t=A[vt];return _t===void 0&&(_t=new nl({morphTargets:Ve,skinning:ot}),A[vt]=_t),_t}function Ge(Ve,ot,We,vt,_t,Dt){var Et=Ve.geometry,Vt=null,Kt=Pe,Ct=Ve.customDepthMaterial;if(We.isPointLight===!0&&(Kt=Le,Ct=Ve.customDistanceMaterial),Ct===void 0){var Mt=!1;ot.morphTargets===!0&&(Et.isBufferGeometry===!0?Mt=Et.morphAttributes&&Et.morphAttributes.position&&0<Et.morphAttributes.position.length:Et.isGeometry===!0&&(Mt=Et.morphTargets&&0<Et.morphTargets.length));var hn=!1;Ve.isSkinnedMesh===!0&&(ot.skinning===!0?hn=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",Ve)),Vt=Kt(Mt,hn,Ve.isInstancedMesh===!0)}else Vt=Ct;if(e.localClippingEnabled&&ot.clipShadows===!0&&ot.clippingPlanes.length!==0){var Mn=Vt.uuid,Yn=ot.uuid,qn=I[Mn];qn===void 0&&(qn={},I[Mn]=qn);var Vn=qn[Yn];Vn===void 0&&(Vn=Vt.clone(),qn[Yn]=Vn),Vt=Vn}return Vt.visible=ot.visible,Vt.wireframe=ot.wireframe,Vt.side=Dt===f?ot.shadowSide!==null?ot.shadowSide:ot.side:ot.shadowSide!==null?ot.shadowSide:X[ot.side],Vt.clipShadows=ot.clipShadows,Vt.clippingPlanes=ot.clippingPlanes,Vt.clipIntersection=ot.clipIntersection,Vt.wireframeLinewidth=ot.wireframeLinewidth,Vt.linewidth=ot.linewidth,We.isPointLight===!0&&Vt.isMeshDistanceMaterial===!0&&(Vt.referencePosition.setFromMatrixPosition(We.matrixWorld),Vt.nearDistance=vt,Vt.farDistance=_t),Vt}function Qe(Ve,ot,We,vt,_t){if(Ve.visible!==!1){if(Ve.layers.test(ot.layers)&&(Ve.isMesh||Ve.isLine||Ve.isPoints)&&(Ve.castShadow||Ve.receiveShadow&&_t===f)&&(!Ve.frustumCulled||i.intersectsObject(Ve))){Ve.modelViewMatrix.multiplyMatrices(We.matrixWorldInverse,Ve.matrixWorld);var Dt=t.update(Ve),Et=Ve.material;if(Array.isArray(Et))for(var Vt=Dt.groups,Kt=0,Ct=Vt.length;Kt<Ct;Kt++){var Mt=Vt[Kt],hn=Et[Mt.materialIndex];if(hn&&hn.visible){var Mn=Ge(Ve,hn,vt,We.near,We.far,_t);e.renderBufferDirect(We,null,Dt,Mn,Ve,Mt)}}else Et.visible&&(Mn=Ge(Ve,Et,vt,We.near,We.far,_t),e.renderBufferDirect(We,null,Dt,Mn,Ve,null))}for(var Yn=Ve.children,qn=0,Vn=Yn.length;qn<Vn;qn++)Qe(Yn[qn],ot,We,vt,_t)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=N,this.render=function(Ve,ot,We){if(me.enabled!==!1&&(me.autoUpdate!==!1||me.needsUpdate!==!1)&&Ve.length!==0){var vt=e.getRenderTarget(),_t=e.getActiveCubeFace(),Dt=e.getActiveMipmapLevel(),Et=e.state;Et.setBlending(R),Et.buffers.color.setClear(1,1,1,1),Et.buffers.depth.setTest(!0),Et.setScissorTest(!1);for(var Vt=0,Kt=Ve.length;Vt<Kt;Vt++){var Ct=Ve[Vt],Mt=Ct.shadow;if(Mt!==void 0){c.copy(Mt.mapSize);var hn=Mt.getFrameExtents();if(c.multiply(hn),d.copy(Mt.mapSize),(c.x>n||c.y>n)&&(console.warn("THREE.WebGLShadowMap:",Ct,"has shadow exceeding max texture size, reducing"),c.x>n&&(d.x=Math.floor(n/hn.x),c.x=d.x*hn.x,Mt.mapSize.x=d.x),c.y>n&&(d.y=Math.floor(n/hn.y),c.y=d.y*hn.y,Mt.mapSize.y=d.y)),Mt.map===null&&!Mt.isPointLightShadow&&this.type===f){var Mn={minFilter:xn,magFilter:xn,format:Or};Mt.map=new qi(c.x,c.y,Mn),Mt.map.texture.name=Ct.name+".shadowMap",Mt.mapPass=new qi(c.x,c.y,Mn),Mt.camera.updateProjectionMatrix()}Mt.map===null&&(Mn={minFilter:pt,magFilter:pt,format:Or},Mt.map=new qi(c.x,c.y,Mn),Mt.map.texture.name=Ct.name+".shadowMap",Mt.camera.updateProjectionMatrix()),e.setRenderTarget(Mt.map),e.clear();for(var Yn=Mt.getViewportCount(),qn=0;qn<Yn;qn++){var Vn=Mt.getViewport(qn);m.set(d.x*Vn.x,d.y*Vn.y,d.x*Vn.z,d.y*Vn.w),Et.viewport(m),Mt.updateMatrices(Ct,qn),i=Mt.getFrustum(),Qe(ot,We,Mt.camera,Ct,this.type)}Mt.isPointLightShadow||this.type!==f||ye(Mt,We)}else console.warn("THREE.WebGLShadowMap:",Ct,"has no shadow.")}me.needsUpdate=!1,e.setRenderTarget(vt,_t,Dt)}}}function Oh(e,t,n){var i=n.isWebGL2,c=new function(){var dt=!1,_n=new Jr,Cn=null,ir=new Jr(0,0,0,0);return{setMask:function(cn){Cn===cn||dt||(e.colorMask(cn,cn,cn,cn),Cn=cn)},setLocked:function(cn){dt=cn},setClear:function(cn,br,Pr,vi,ma){ma===!0&&(cn*=vi,br*=vi,Pr*=vi),_n.set(cn,br,Pr,vi),ir.equals(_n)===!1&&(e.clearColor(cn,br,Pr,vi),ir.copy(_n))},reset:function(){dt=!1,Cn=null,ir.set(-1,0,0,0)}}},d=new function(){var dt=!1,_n=null,Cn=null,ir=null;return{setTest:function(cn){(cn?En:ke)(2929)},setMask:function(cn){_n===cn||dt||(e.depthMask(cn),_n=cn)},setFunc:function(cn){if(Cn!==cn){if(cn)switch(cn){case Fe:e.depthFunc(512);break;case J:e.depthFunc(519);break;case ge:e.depthFunc(513);break;case oe:e.depthFunc(515);break;case le:e.depthFunc(514);break;case Re:e.depthFunc(518);break;case Ye:e.depthFunc(516);break;case Be:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);Cn=cn}},setLocked:function(cn){dt=cn},setClear:function(cn){ir!==cn&&(e.clearDepth(cn),ir=cn)},reset:function(){dt=!1,ir=Cn=_n=null}}},m=new function(){var dt=!1,_n=null,Cn=null,ir=null,cn=null,br=null,Pr=null,vi=null,ma=null;return{setTest:function(Nr){dt||(Nr?En:ke)(2960)},setMask:function(Nr){_n===Nr||dt||(e.stencilMask(Nr),_n=Nr)},setFunc:function(Nr,Ei,Ir){Cn===Nr&&ir===Ei&&cn===Ir||(e.stencilFunc(Nr,Ei,Ir),Cn=Nr,ir=Ei,cn=Ir)},setOp:function(Nr,Ei,Ir){br===Nr&&Pr===Ei&&vi===Ir||(e.stencilOp(Nr,Ei,Ir),br=Nr,Pr=Ei,vi=Ir)},setLocked:function(Nr){dt=Nr},setClear:function(Nr){ma!==Nr&&(e.clearStencil(Nr),ma=Nr)},reset:function(){dt=!1,ma=vi=Pr=br=cn=ir=Cn=_n=null}}},x=e.getParameter(34921),A=new Uint8Array(x),I=new Uint8Array(x),X=new Uint8Array(x),Q={},re=null,z=null,ue=null,me=null,ye=null,Pe=null,Le=null,Ge=null,Qe=null,Ve=!1,ot=null,We=null,vt=null,_t=null,Dt=null,Et=e.getParameter(35661),Vt=!1,Kt=0,Ct=e.getParameter(7938);Ct.indexOf("WebGL")!==-1?(Kt=parseFloat(/^WebGL\ ([0-9])/.exec(Ct)[1]),Vt=1<=Kt):Ct.indexOf("OpenGL ES")!==-1&&(Kt=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(Ct)[1]),Vt=2<=Kt);var Mt=null,hn={},Mn=new Jr,Yn=new Jr;function qn(dt,_n,Cn){var ir=new Uint8Array(4),cn=e.createTexture();e.bindTexture(dt,cn),e.texParameteri(dt,10241,9728),e.texParameteri(dt,10240,9728);for(var br=0;br<Cn;br++)e.texImage2D(_n+br,0,6408,1,1,0,6408,5121,ir);return cn}var Vn={};function cr(dt,_n){A[dt]=1,I[dt]===0&&(e.enableVertexAttribArray(dt),I[dt]=1),X[dt]!==_n&&((i?e:t.get("ANGLE_instanced_arrays"))[i?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](dt,_n),X[dt]=_n)}function En(dt){Q[dt]!==!0&&(e.enable(dt),Q[dt]=!0)}function ke(dt){Q[dt]!==!1&&(e.disable(dt),Q[dt]=!1)}Vn[3553]=qn(3553,3553,1),Vn[34067]=qn(34067,34069,6),c.setClear(0,0,0,1),d.setClear(1),m.setClear(0),En(2929),d.setFunc(oe),Pn(!1),St(L),En(2884),rr(R);var et={};if(et[C]=32774,et[F]=32778,et[M]=32779,i)et[a]=32775,et[h]=32776;else{var Yt=t.get("EXT_blend_minmax");Yt!==null&&(et[a]=Yt.MIN_EXT,et[h]=Yt.MAX_EXT)}var Ht={};function rr(dt,_n,Cn,ir,cn,br,Pr,vi){if(dt!==R){if(z||(En(3042),z=!0),dt===W)cn=cn||_n,br=br||Cn,Pr=Pr||ir,_n===me&&cn===Le||(e.blendEquationSeparate(et[_n],et[cn]),me=_n,Le=cn),Cn===ye&&ir===Pe&&br===Ge&&Pr===Qe||(e.blendFuncSeparate(Ht[Cn],Ht[ir],Ht[br],Ht[Pr]),ye=Cn,Pe=ir,Ge=br,Qe=Pr),ue=dt,Ve=null;else if(dt!==ue||vi!==Ve){if(me===C&&Le===C||(e.blendEquation(32774),Le=me=C),vi)switch(dt){case _:e.blendFuncSeparate(1,771,1,771);break;case ee:e.blendFunc(1,1);break;case k:e.blendFuncSeparate(0,0,769,771);break;case E:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",dt)}else switch(dt){case _:e.blendFuncSeparate(770,771,1,771);break;case ee:e.blendFunc(770,1);break;case k:e.blendFunc(0,769);break;case E:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",dt)}Qe=Ge=Pe=ye=null,ue=dt,Ve=vi}}else z&&(ke(3042),z=!1)}function Pn(dt){ot!==dt&&(dt?e.frontFace(2304):e.frontFace(2305),ot=dt)}function St(dt){dt!==w?(En(2884),dt!==We&&(dt===L?e.cullFace(1029):dt===U?e.cullFace(1028):e.cullFace(1032))):ke(2884),We=dt}function On(dt,_n,Cn){dt?(En(32823),_t===_n&&Dt===Cn||(e.polygonOffset(_n,Cn),_t=_n,Dt=Cn)):ke(32823)}function ur(dt){dt===void 0&&(dt=33984+Et-1),Mt!==dt&&(e.activeTexture(dt),Mt=dt)}return Ht[y]=0,Ht[j]=1,Ht[Y]=768,Ht[V]=770,Ht[xe]=776,Ht[be]=774,Ht[ie]=772,Ht[q]=769,Ht[ne]=771,Ht[je]=775,Ht[he]=773,{buffers:{color:c,depth:d,stencil:m},initAttributes:function(){for(var dt=0,_n=A.length;dt<_n;dt++)A[dt]=0},enableAttribute:function(dt){cr(dt,0)},enableAttributeAndDivisor:cr,disableUnusedAttributes:function(){for(var dt=0,_n=I.length;dt!==_n;++dt)I[dt]!==A[dt]&&(e.disableVertexAttribArray(dt),I[dt]=0)},enable:En,disable:ke,useProgram:function(dt){return re!==dt&&(e.useProgram(dt),re=dt,!0)},setBlending:rr,setMaterial:function(dt,_n){(dt.side===B?ke:En)(2884);var Cn=dt.side===T;_n&&(Cn=!Cn),Pn(Cn),dt.blending===_&&dt.transparent===!1?rr(R):rr(dt.blending,dt.blendEquation,dt.blendSrc,dt.blendDst,dt.blendEquationAlpha,dt.blendSrcAlpha,dt.blendDstAlpha,dt.premultipliedAlpha),d.setFunc(dt.depthFunc),d.setTest(dt.depthTest),d.setMask(dt.depthWrite),c.setMask(dt.colorWrite);var ir=dt.stencilWrite;m.setTest(ir),ir&&(m.setMask(dt.stencilWriteMask),m.setFunc(dt.stencilFunc,dt.stencilRef,dt.stencilFuncMask),m.setOp(dt.stencilFail,dt.stencilZFail,dt.stencilZPass)),On(dt.polygonOffset,dt.polygonOffsetFactor,dt.polygonOffsetUnits)},setFlipSided:Pn,setCullFace:St,setLineWidth:function(dt){dt!==vt&&(Vt&&e.lineWidth(dt),vt=dt)},setPolygonOffset:On,setScissorTest:function(dt){(dt?En:ke)(3089)},activeTexture:ur,bindTexture:function(dt,_n){Mt===null&&ur();var Cn=hn[Mt];Cn===void 0&&(Cn={type:void 0,texture:void 0},hn[Mt]=Cn),Cn.type===dt&&Cn.texture===_n||(e.bindTexture(dt,_n||Vn[dt]),Cn.type=dt,Cn.texture=_n)},unbindTexture:function(){var dt=hn[Mt];dt!==void 0&&dt.type!==void 0&&(e.bindTexture(dt.type,null),dt.type=void 0,dt.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(dt){console.error("THREE.WebGLState:",dt)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(dt){console.error("THREE.WebGLState:",dt)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(dt){console.error("THREE.WebGLState:",dt)}},scissor:function(dt){Mn.equals(dt)===!1&&(e.scissor(dt.x,dt.y,dt.z,dt.w),Mn.copy(dt))},viewport:function(dt){Yn.equals(dt)===!1&&(e.viewport(dt.x,dt.y,dt.z,dt.w),Yn.copy(dt))},reset:function(){for(var dt=0;dt<I.length;dt++)I[dt]===1&&(e.disableVertexAttribArray(dt),I[dt]=0);Q={},hn={},We=ot=ue=re=Mt=null,c.reset(),d.reset(),m.reset()}}}function ad(e,t,n,i,c,d,m){var x,A=c.isWebGL2,I=c.maxTextures,X=c.maxCubemapSize,Q=c.maxTextureSize,re=c.maxSamples,z=new WeakMap,ue=!1;try{ue=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function me(ke,et){return ue?new OffscreenCanvas(ke,et):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function ye(ke,et,Yt,Ht){var rr=1;if((ke.width>Ht||ke.height>Ht)&&(rr=Ht/Math.max(ke.width,ke.height)),rr<1||et===!0){if(typeof HTMLImageElement<"u"&&ke instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ke instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ke instanceof ImageBitmap){var Pn=et?vr.floorPowerOfTwo:Math.floor,St=Pn(rr*ke.width),On=Pn(rr*ke.height);x===void 0&&(x=me(St,On));var ur=Yt?me(St,On):x;return ur.width=St,ur.height=On,ur.getContext("2d").drawImage(ke,0,0,St,On),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ke.width+"x"+ke.height+") to ("+St+"x"+On+")."),ur}return"data"in ke&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ke.width+"x"+ke.height+")."),ke}return ke}function Pe(ke){return vr.isPowerOfTwo(ke.width)&&vr.isPowerOfTwo(ke.height)}function Le(ke,et){return ke.generateMipmaps&&et&&ke.minFilter!==pt&&ke.minFilter!==xn}function Ge(ke,et,Yt,Ht){e.generateMipmap(ke),i.get(et).__maxMipLevel=Math.log(Math.max(Yt,Ht))*Math.LOG2E}function Qe(ke,et,Yt){if(A===!1)return et;if(ke!==null){if(e[ke]!==void 0)return e[ke];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ke+"'")}var Ht=et;return et===6403&&(Yt===5126&&(Ht=33326),Yt===5131&&(Ht=33325),Yt===5121&&(Ht=33321)),et===6407&&(Yt===5126&&(Ht=34837),Yt===5131&&(Ht=34843),Yt===5121&&(Ht=32849)),et===6408&&(Yt===5126&&(Ht=34836),Yt===5131&&(Ht=34842),Yt===5121&&(Ht=32856)),Ht===33325||Ht===33326||Ht===34842||Ht===34836?t.get("EXT_color_buffer_float"):Ht!==34843&&Ht!==34837||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),Ht}function Ve(ke){return ke===pt||ke===st||ke===qt?9728:9729}function ot(ke){var et=ke.target;et.removeEventListener("dispose",ot),function(Yt){var Ht=i.get(Yt);Ht.__webglInit!==void 0&&(e.deleteTexture(Ht.__webglTexture),i.remove(Yt))}(et),et.isVideoTexture&&z.delete(et),m.memory.textures--}function We(ke){var et=ke.target;et.removeEventListener("dispose",We),function(Yt){var Ht=i.get(Yt),rr=i.get(Yt.texture);if(Yt){if(rr.__webglTexture!==void 0&&e.deleteTexture(rr.__webglTexture),Yt.depthTexture&&Yt.depthTexture.dispose(),Yt.isWebGLCubeRenderTarget)for(var Pn=0;Pn<6;Pn++)e.deleteFramebuffer(Ht.__webglFramebuffer[Pn]),Ht.__webglDepthbuffer&&e.deleteRenderbuffer(Ht.__webglDepthbuffer[Pn]);else e.deleteFramebuffer(Ht.__webglFramebuffer),Ht.__webglDepthbuffer&&e.deleteRenderbuffer(Ht.__webglDepthbuffer);if(Yt.isWebGLMultiviewRenderTarget){e.deleteTexture(Ht.__webglColorTexture),e.deleteTexture(Ht.__webglDepthStencilTexture),m.memory.textures-=2,Pn=0;for(var St=Ht.__webglViewFramebuffers.length;Pn<St;Pn++)e.deleteFramebuffer(Ht.__webglViewFramebuffers[Pn])}i.remove(Yt.texture),i.remove(Yt)}}(et),m.memory.textures--}var vt=0;function _t(ke,et){var Yt,Ht,rr=i.get(ke);if(ke.isVideoTexture&&(Yt=ke,Ht=m.render.frame,z.get(Yt)!==Ht&&(z.set(Yt,Ht),Yt.update())),0<ke.version&&rr.__version!==ke.version){var Pn=ke.image;if(Pn===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(Pn.complete!==!1)return void hn(rr,ke,et);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+et),n.bindTexture(3553,rr.__webglTexture)}function Dt(ke,et){if(ke.image.length===6){var Yt=i.get(ke);if(0<ke.version&&Yt.__version!==ke.version){Mt(Yt,ke),n.activeTexture(33984+et),n.bindTexture(34067,Yt.__webglTexture),e.pixelStorei(37440,ke.flipY);for(var Ht=ke&&(ke.isCompressedTexture||ke.image[0].isCompressedTexture),rr=ke.image[0]&&ke.image[0].isDataTexture,Pn=[],St=0;St<6;St++)Pn[St]=Ht||rr?rr?ke.image[St].image:ke.image[St]:ye(ke.image[St],!1,!0,X);var On,ur=Pn[0],dt=Pe(ur)||A,_n=d.convert(ke.format),Cn=d.convert(ke.type),ir=Qe(ke.internalFormat,_n,Cn);if(Ct(34067,ke,dt),Ht){for(St=0;St<6;St++){On=Pn[St].mipmaps;for(var cn=0;cn<On.length;cn++){var br=On[cn];ke.format!==Or&&ke.format!==Gr?_n!==null?n.compressedTexImage2D(34069+St,cn,ir,br.width,br.height,0,br.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+St,cn,ir,br.width,br.height,0,_n,Cn,br.data)}}Yt.__maxMipLevel=On.length-1}else{for(On=ke.mipmaps,St=0;St<6;St++)if(rr)for(n.texImage2D(34069+St,0,ir,Pn[St].width,Pn[St].height,0,_n,Cn,Pn[St].data),cn=0;cn<On.length;cn++){var Pr=(br=On[cn]).image[St].image;n.texImage2D(34069+St,cn+1,ir,Pr.width,Pr.height,0,_n,Cn,Pr.data)}else for(n.texImage2D(34069+St,0,ir,_n,Cn,Pn[St]),cn=0;cn<On.length;cn++)br=On[cn],n.texImage2D(34069+St,cn+1,ir,_n,Cn,br.image[St]);Yt.__maxMipLevel=On.length}Le(ke,dt)&&Ge(34067,ke,ur.width,ur.height),Yt.__version=ke.version,ke.onUpdate&&ke.onUpdate(ke)}else n.activeTexture(33984+et),n.bindTexture(34067,Yt.__webglTexture)}}function Et(ke,et){n.activeTexture(33984+et),n.bindTexture(34067,i.get(ke).__webglTexture)}var Vt={};Vt[Zt]=10497,Vt[Rn]=33071,Vt[Xn]=33648;var Kt={};function Ct(ke,et,Yt){Yt?(e.texParameteri(ke,10242,Vt[et.wrapS]),e.texParameteri(ke,10243,Vt[et.wrapT]),ke!==32879&&ke!==35866||e.texParameteri(ke,32882,Vt[et.wrapR]),e.texParameteri(ke,10240,Kt[et.magFilter]),e.texParameteri(ke,10241,Kt[et.minFilter])):(e.texParameteri(ke,10242,33071),e.texParameteri(ke,10243,33071),ke!==32879&&ke!==35866||e.texParameteri(ke,32882,33071),et.wrapS===Rn&&et.wrapT===Rn||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(ke,10240,Ve(et.magFilter)),e.texParameteri(ke,10241,Ve(et.minFilter)),et.minFilter!==pt&&et.minFilter!==xn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var Ht=t.get("EXT_texture_filter_anisotropic");if(Ht){if(et.type===Ot&&t.get("OES_texture_float_linear")===null||et.type===$t&&(A||t.get("OES_texture_half_float_linear"))===null)return;(1<et.anisotropy||i.get(et).__currentAnisotropy)&&(e.texParameterf(ke,Ht.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(et.anisotropy,c.getMaxAnisotropy())),i.get(et).__currentAnisotropy=et.anisotropy)}}function Mt(ke,et){ke.__webglInit===void 0&&(ke.__webglInit=!0,et.addEventListener("dispose",ot),ke.__webglTexture=e.createTexture(),m.memory.textures++)}function hn(ke,et,Yt){var Ht=3553;et.isDataTexture2DArray&&(Ht=35866),et.isDataTexture3D&&(Ht=32879),Mt(ke,et),n.activeTexture(33984+Yt),n.bindTexture(Ht,ke.__webglTexture),e.pixelStorei(37440,et.flipY),e.pixelStorei(37441,et.premultiplyAlpha),e.pixelStorei(3317,et.unpackAlignment);var rr,Pn=(rr=et,!A&&(rr.wrapS!==Rn||rr.wrapT!==Rn||rr.minFilter!==pt&&rr.minFilter!==xn)&&Pe(et.image)===!1),St=ye(et.image,Pn,!1,Q),On=Pe(St)||A,ur=d.convert(et.format),dt=d.convert(et.type),_n=Qe(et.internalFormat,ur,dt);Ct(Ht,et,On);var Cn,ir=et.mipmaps;if(et.isDepthTexture){if(_n=6402,et.type===Ot){if(A===!1)throw new Error("Float Depth Texture only supported in WebGL2.0");_n=36012}else A&&(_n=33189);et.format===gr&&_n===6402&&et.type!==lt&&et.type!==Ke&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),et.type=lt,dt=d.convert(et.type)),et.format===Wi&&(_n=34041,et.type!==qr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),et.type=qr,dt=d.convert(et.type))),n.texImage2D(3553,0,_n,St.width,St.height,0,ur,dt,null)}else if(et.isDataTexture)if(0<ir.length&&On){for(var cn=0,br=ir.length;cn<br;cn++)Cn=ir[cn],n.texImage2D(3553,cn,_n,Cn.width,Cn.height,0,ur,dt,Cn.data);et.generateMipmaps=!1,ke.__maxMipLevel=ir.length-1}else n.texImage2D(3553,0,_n,St.width,St.height,0,ur,dt,St.data),ke.__maxMipLevel=0;else if(et.isCompressedTexture){for(cn=0,br=ir.length;cn<br;cn++)Cn=ir[cn],et.format!==Or&&et.format!==Gr?ur!==null?n.compressedTexImage2D(3553,cn,_n,Cn.width,Cn.height,0,Cn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,cn,_n,Cn.width,Cn.height,0,ur,dt,Cn.data);ke.__maxMipLevel=ir.length-1}else if(et.isDataTexture2DArray)n.texImage3D(35866,0,_n,St.width,St.height,St.depth,0,ur,dt,St.data),ke.__maxMipLevel=0;else if(et.isDataTexture3D)n.texImage3D(32879,0,_n,St.width,St.height,St.depth,0,ur,dt,St.data),ke.__maxMipLevel=0;else if(0<ir.length&&On){for(cn=0,br=ir.length;cn<br;cn++)Cn=ir[cn],n.texImage2D(3553,cn,_n,ur,dt,Cn);et.generateMipmaps=!1,ke.__maxMipLevel=ir.length-1}else n.texImage2D(3553,0,_n,ur,dt,St),ke.__maxMipLevel=0;Le(et,On)&&Ge(Ht,et,St.width,St.height),ke.__version=et.version,et.onUpdate&&et.onUpdate(et)}function Mn(ke,et,Yt,Ht){var rr=d.convert(et.texture.format),Pn=d.convert(et.texture.type),St=Qe(et.texture.internalFormat,rr,Pn);n.texImage2D(Ht,0,St,et.width,et.height,0,rr,Pn,null),e.bindFramebuffer(36160,ke),e.framebufferTexture2D(36160,Yt,Ht,i.get(et.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function Yn(ke,et,Yt){if(e.bindRenderbuffer(36161,ke),et.depthBuffer&&!et.stencilBuffer){if(Yt){var Ht=Vn(et);e.renderbufferStorageMultisample(36161,Ht,33189,et.width,et.height)}else e.renderbufferStorage(36161,33189,et.width,et.height);e.framebufferRenderbuffer(36160,36096,36161,ke)}else if(et.depthBuffer&&et.stencilBuffer)Yt?(Ht=Vn(et),e.renderbufferStorageMultisample(36161,Ht,35056,et.width,et.height)):e.renderbufferStorage(36161,34041,et.width,et.height),e.framebufferRenderbuffer(36160,33306,36161,ke);else{var rr=d.convert(et.texture.format),Pn=d.convert(et.texture.type),St=Qe(et.texture.internalFormat,rr,Pn);Yt?(Ht=Vn(et),e.renderbufferStorageMultisample(36161,Ht,St,et.width,et.height)):e.renderbufferStorage(36161,St,et.width,et.height)}e.bindRenderbuffer(36161,null)}function qn(ke){var et=i.get(ke),Yt=ke.isWebGLCubeRenderTarget===!0;if(ke.depthTexture){if(Yt)throw new Error("target.depthTexture not supported in Cube render targets");(function(rr,Pn){if(Pn&&Pn.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,rr),!Pn.depthTexture||!Pn.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(Pn.depthTexture).__webglTexture&&Pn.depthTexture.image.width===Pn.width&&Pn.depthTexture.image.height===Pn.height||(Pn.depthTexture.image.width=Pn.width,Pn.depthTexture.image.height=Pn.height,Pn.depthTexture.needsUpdate=!0),_t(Pn.depthTexture,0);var St=i.get(Pn.depthTexture).__webglTexture;if(Pn.depthTexture.format===gr)e.framebufferTexture2D(36160,36096,3553,St,0);else{if(Pn.depthTexture.format!==Wi)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,St,0)}})(et.__webglFramebuffer,ke)}else if(Yt){et.__webglDepthbuffer=[];for(var Ht=0;Ht<6;Ht++)e.bindFramebuffer(36160,et.__webglFramebuffer[Ht]),et.__webglDepthbuffer[Ht]=e.createRenderbuffer(),Yn(et.__webglDepthbuffer[Ht],ke)}else e.bindFramebuffer(36160,et.__webglFramebuffer),et.__webglDepthbuffer=e.createRenderbuffer(),Yn(et.__webglDepthbuffer,ke);e.bindFramebuffer(36160,null)}function Vn(ke){return A&&ke.isWebGLMultisampleRenderTarget?Math.min(re,ke.samples):0}Kt[pt]=9728,Kt[st]=9984,Kt[qt]=9986,Kt[xn]=9729,Kt[nn]=9985;var cr=!(Kt[er]=9987),En=!1;this.allocateTextureUnit=function(){var ke=vt;return I<=ke&&console.warn("THREE.WebGLTextures: Trying to use "+ke+" texture units while this GPU supports only "+I),vt+=1,ke},this.resetTextureUnits=function(){vt=0},this.setTexture2D=_t,this.setTexture2DArray=function(ke,et){var Yt=i.get(ke);0<ke.version&&Yt.__version!==ke.version?hn(Yt,ke,et):(n.activeTexture(33984+et),n.bindTexture(35866,Yt.__webglTexture))},this.setTexture3D=function(ke,et){var Yt=i.get(ke);0<ke.version&&Yt.__version!==ke.version?hn(Yt,ke,et):(n.activeTexture(33984+et),n.bindTexture(32879,Yt.__webglTexture))},this.setTextureCube=Dt,this.setTextureCubeDynamic=Et,this.setupRenderTarget=function(ke){var et=i.get(ke),Yt=i.get(ke.texture);ke.addEventListener("dispose",We),Yt.__webglTexture=e.createTexture(),m.memory.textures++;var Ht=ke.isWebGLCubeRenderTarget===!0,rr=ke.isWebGLMultisampleRenderTarget===!0,Pn=ke.isWebGLMultiviewRenderTarget===!0,St=Pe(ke)||A;if(Ht){et.__webglFramebuffer=[];for(var On=0;On<6;On++)et.__webglFramebuffer[On]=e.createFramebuffer()}else if(et.__webglFramebuffer=e.createFramebuffer(),rr)if(A){et.__webglMultisampledFramebuffer=e.createFramebuffer(),et.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,et.__webglColorRenderbuffer);var ur=d.convert(ke.texture.format),dt=d.convert(ke.texture.type),_n=Qe(ke.texture.internalFormat,ur,dt),Cn=Vn(ke);e.renderbufferStorageMultisample(36161,Cn,_n,ke.width,ke.height),e.bindFramebuffer(36160,et.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,et.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),ke.depthBuffer&&(et.__webglDepthRenderbuffer=e.createRenderbuffer(),Yn(et.__webglDepthRenderbuffer,ke,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(Pn){var ir=ke.width,cn=ke.height,br=ke.numViews;e.bindFramebuffer(36160,et.__webglFramebuffer);var Pr=t.get("OVR_multiview2");m.memory.textures+=2;var vi=e.createTexture();e.bindTexture(35866,vi),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,32856,ir,cn,br,0,6408,5121,null),Pr.framebufferTextureMultiviewOVR(36160,36064,vi,0,0,br);var ma=e.createTexture();e.bindTexture(35866,ma),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,35056,ir,cn,br,0,34041,34042,null),Pr.framebufferTextureMultiviewOVR(36160,33306,ma,0,0,br);var Nr=new Array(br);for(On=0;On<br;++On)Nr[On]=e.createFramebuffer(),e.bindFramebuffer(36160,Nr[On]),e.framebufferTextureLayer(36160,36064,vi,0,On);et.__webglColorTexture=vi,et.__webglDepthStencilTexture=ma,et.__webglViewFramebuffers=Nr,e.bindFramebuffer(36160,null),e.bindTexture(35866,null)}if(Ht){for(n.bindTexture(34067,Yt.__webglTexture),Ct(34067,ke.texture,St),On=0;On<6;On++)Mn(et.__webglFramebuffer[On],ke,36064,34069+On);Le(ke.texture,St)&&Ge(34067,ke.texture,ke.width,ke.height),n.bindTexture(34067,null)}else Pn||(n.bindTexture(3553,Yt.__webglTexture),Ct(3553,ke.texture,St),Mn(et.__webglFramebuffer,ke,36064,3553),Le(ke.texture,St)&&Ge(3553,ke.texture,ke.width,ke.height),n.bindTexture(3553,null));ke.depthBuffer&&qn(ke)},this.updateRenderTargetMipmap=function(ke){var et=ke.texture;if(Le(et,Pe(ke)||A)){var Yt=ke.isWebGLCubeRenderTarget?34067:3553,Ht=i.get(et).__webglTexture;n.bindTexture(Yt,Ht),Ge(Yt,et,ke.width,ke.height),n.bindTexture(Yt,null)}},this.updateMultisampleRenderTarget=function(ke){if(ke.isWebGLMultisampleRenderTarget)if(A){var et=i.get(ke);e.bindFramebuffer(36008,et.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,et.__webglFramebuffer);var Yt=ke.width,Ht=ke.height,rr=16384;ke.depthBuffer&&(rr|=256),ke.stencilBuffer&&(rr|=1024),e.blitFramebuffer(0,0,Yt,Ht,0,0,Yt,Ht,rr,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(ke,et){ke&&ke.isWebGLRenderTarget&&(cr===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),cr=!0),ke=ke.texture),_t(ke,et)},this.safeSetTextureCube=function(ke,et){ke&&ke.isWebGLCubeRenderTarget&&(En===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),En=!0),ke=ke.texture),(ke&&ke.isCubeTexture||Array.isArray(ke.image)&&ke.image.length===6?Dt:Et)(ke,et)}}function jl(e,t,n){var i=n.isWebGL2;return{convert:function(c){var d;if(c===kr)return 5121;if(c===rn)return 32819;if(c===hr)return 32820;if(c===_r)return 33635;if(c===ct)return 5120;if(c===Ue)return 5122;if(c===lt)return 5123;if(c===Wt)return 5124;if(c===Ke)return 5125;if(c===Ot)return 5126;if(c===$t)return i?5131:(d=t.get("OES_texture_half_float"))!==null?d.HALF_FLOAT_OES:null;if(c===Ur)return 6406;if(c===Gr)return 6407;if(c===Or)return 6408;if(c===Qi)return 6409;if(c===Pi)return 6410;if(c===gr)return 6402;if(c===Wi)return 34041;if(c===H)return 6403;if(c===Hr)return 36244;if(c===Eo)return 33319;if(c===Kn)return 33320;if(c===ao)return 36248;if(c===Na)return 36249;if(c===Fs||c===es||c===fs||c===na){if((d=t.get("WEBGL_compressed_texture_s3tc"))===null)return null;if(c===Fs)return d.COMPRESSED_RGB_S3TC_DXT1_EXT;if(c===es)return d.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(c===fs)return d.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(c===na)return d.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(c===ts||c===so||c===Ba||c===Po){if((d=t.get("WEBGL_compressed_texture_pvrtc"))===null)return null;if(c===ts)return d.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(c===so)return d.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(c===Ba)return d.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(c===Po)return d.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return c===ms?(d=t.get("WEBGL_compressed_texture_etc1"))!==null?d.COMPRESSED_RGB_ETC1_WEBGL:null:c===Vs||c===ra||c===gs||c===Oo||c===ys||c===ia||c===oa||c===Xr||c===Sr||c===ns||c===vs||c===rs||c===Fa||c===Ji?(d=t.get("WEBGL_compressed_texture_astc"))!==null?c:null:c===qr?i?34042:(d=t.get("WEBGL_depth_texture"))!==null?d.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function pc(e,t,n,i){qi.call(this,e,t,i),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=n}function fc(e){Ii.call(this),this.cameras=e||[]}function rl(){Pt.call(this),this.type="Group"}function mc(e,t){var n=this,i=null,c=null,d="local-floor",m=null,x=[],A=new Map,I=new Ii;I.layers.enable(1),I.viewport=new Jr;var X=new Ii;X.layers.enable(2),X.viewport=new Jr;var Q=new fc([I,X]);Q.layers.enable(1),Q.layers.enable(2);var re=null,z=null;function ue(We){var vt=A.get(We.inputSource);vt&&(vt.targetRay&&vt.targetRay.dispatchEvent({type:We.type}),vt.grip&&vt.grip.dispatchEvent({type:We.type}))}function me(){A.forEach(function(We,vt){We.targetRay&&(We.targetRay.dispatchEvent({type:"disconnected",data:vt}),We.targetRay.visible=!1),We.grip&&(We.grip.dispatchEvent({type:"disconnected",data:vt}),We.grip.visible=!1)}),A.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),ot.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function ye(We){c=We,ot.setContext(i),ot.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function Pe(We){for(var vt=i.inputSources,_t=0;_t<x.length;_t++)A.set(vt[_t],x[_t]);for(_t=0;_t<We.removed.length;_t++){var Dt=We.removed[_t];(Et=A.get(Dt))&&(Et.targetRay&&Et.targetRay.dispatchEvent({type:"disconnected",data:Dt}),Et.grip&&Et.grip.dispatchEvent({type:"disconnected",data:Dt}),A.delete(Dt))}for(_t=0;_t<We.added.length;_t++){var Et;Dt=We.added[_t],(Et=A.get(Dt))&&(Et.targetRay&&Et.targetRay.dispatchEvent({type:"connected",data:Dt}),Et.grip&&Et.grip.dispatchEvent({type:"connected",data:Dt}))}}this.enabled=!1,this.isPresenting=!1,this.getController=function(We){var vt=x[We];return vt===void 0&&(vt={},x[We]=vt),vt.targetRay===void 0&&(vt.targetRay=new rl,vt.targetRay.matrixAutoUpdate=!1,vt.targetRay.visible=!1),vt.targetRay},this.getControllerGrip=function(We){var vt=x[We];return vt===void 0&&(vt={},x[We]=vt),vt.grip===void 0&&(vt.grip=new rl,vt.grip.matrixAutoUpdate=!1,vt.grip.visible=!1),vt.grip},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(We){d=We},this.getReferenceSpace=function(){return c},this.getSession=function(){return i},this.setSession=function(We){if((i=We)!==null){i.addEventListener("select",ue),i.addEventListener("selectstart",ue),i.addEventListener("selectend",ue),i.addEventListener("squeeze",ue),i.addEventListener("squeezestart",ue),i.addEventListener("squeezeend",ue),i.addEventListener("end",me);var vt=t.getContextAttributes(),_t={antialias:vt.antialias,alpha:vt.alpha,depth:vt.depth,stencil:vt.stencil},Dt=new XRWebGLLayer(i,t,_t);i.updateRenderState({baseLayer:Dt}),i.requestReferenceSpace(d).then(ye),i.addEventListener("inputsourceschange",Pe)}};var Le=new Ae,Ge=new Ae;function Qe(We,vt){vt===null?We.matrixWorld.copy(We.matrix):We.matrixWorld.multiplyMatrices(vt.matrixWorld,We.matrix),We.matrixWorldInverse.getInverse(We.matrixWorld)}this.getCamera=function(We){Q.near=X.near=I.near=We.near,Q.far=X.far=I.far=We.far,re===Q.near&&z===Q.far||(i.updateRenderState({depthNear:Q.near,depthFar:Q.far}),re=Q.near,z=Q.far);var vt=We.parent,_t=Q.cameras;Qe(Q,vt);for(var Dt=0;Dt<_t.length;Dt++)Qe(_t[Dt],vt);We.matrixWorld.copy(Q.matrixWorld);for(var Et=We.children,Vt=(Dt=0,Et.length);Dt<Vt;Dt++)Et[Dt].updateMatrixWorld(!0);return function(Kt,Ct,Mt){Le.setFromMatrixPosition(Ct.matrixWorld),Ge.setFromMatrixPosition(Mt.matrixWorld);var hn=Le.distanceTo(Ge),Mn=Ct.projectionMatrix.elements,Yn=Mt.projectionMatrix.elements,qn=Mn[14]/(Mn[10]-1),Vn=Mn[14]/(Mn[10]+1),cr=(Mn[9]+1)/Mn[5],En=(Mn[9]-1)/Mn[5],ke=(Mn[8]-1)/Mn[0],et=(Yn[8]+1)/Yn[0],Yt=qn*ke,Ht=qn*et,rr=hn/(et-ke),Pn=rr*-ke;Ct.matrixWorld.decompose(Kt.position,Kt.quaternion,Kt.scale),Kt.translateX(Pn),Kt.translateZ(rr),Kt.matrixWorld.compose(Kt.position,Kt.quaternion,Kt.scale),Kt.matrixWorldInverse.getInverse(Kt.matrixWorld);var St=qn+rr,On=Vn+rr,ur=Yt-Pn,dt=hn-Pn+Ht,_n=cr*Vn/On*St,Cn=En*Vn/On*St;Kt.projectionMatrix.makePerspective(ur,dt,_n,Cn,St,On)}(Q,I,X),Q};var Ve=null,ot=new ch;ot.setAnimationLoop(function(We,vt){if((m=vt.getViewerPose(c))!==null){var _t=m.views,Dt=i.renderState.baseLayer;e.setFramebuffer(Dt.framebuffer);for(var Et=0;Et<_t.length;Et++){var Vt=_t[Et],Kt=Dt.getViewport(Vt),Ct=Q.cameras[Et];Ct.matrix.fromArray(Vt.transform.matrix),Ct.projectionMatrix.fromArray(Vt.projectionMatrix),Ct.viewport.set(Kt.x,Kt.y,Kt.width,Kt.height),Et===0&&Q.matrix.copy(Ct.matrix)}}var Mt=i.inputSources;for(Et=0;Et<x.length;Et++){var hn=x[Et],Mn=Mt[Et],Yn=null,qn=null;Mn&&(hn.targetRay&&(Yn=vt.getPose(Mn.targetRaySpace,c))!==null&&(hn.targetRay.matrix.fromArray(Yn.transform.matrix),hn.targetRay.matrix.decompose(hn.targetRay.position,hn.targetRay.rotation,hn.targetRay.scale)),hn.grip&&Mn.gripSpace&&(qn=vt.getPose(Mn.gripSpace,c))!==null&&(hn.grip.matrix.fromArray(qn.transform.matrix),hn.grip.matrix.decompose(hn.grip.position,hn.grip.rotation,hn.grip.scale))),hn.targetRay&&(hn.targetRay.visible=Yn!==null),hn.grip&&(hn.grip.visible=qn!==null)}Ve&&Ve(We,vt)}),this.setAnimationLoop=function(We){Ve=We},this.dispose=function(){}}function Su(e){var t=(e=e||{}).canvas!==void 0?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=e.context!==void 0?e.context:null,i=e.alpha!==void 0&&e.alpha,c=e.depth===void 0||e.depth,d=e.stencil===void 0||e.stencil,m=e.antialias!==void 0&&e.antialias,x=e.premultipliedAlpha===void 0||e.premultipliedAlpha,A=e.preserveDrawingBuffer!==void 0&&e.preserveDrawingBuffer,I=e.powerPreference!==void 0?e.powerPreference:"default",X=e.failIfMajorPerformanceCaveat!==void 0&&e.failIfMajorPerformanceCaveat,Q=null,re=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ze,this.physicallyCorrectLights=!1,this.toneMapping=tt,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var z,ue,me,ye,Pe,Le,Ge,Qe,Ve,ot,We,vt,_t,Dt,Et,Vt,Kt,Ct,Mt=this,hn=!1,Mn=null,Yn=0,qn=0,Vn=null,cr=null,En=-1,ke={geometry:null,program:null,wireframe:!1},et=null,Yt=null,Ht=new Jr,rr=new Jr,Pn=null,St=t.width,On=t.height,ur=1,dt=null,_n=null,Cn=new Jr(0,0,St,On),ir=new Jr(0,0,St,On),cn=!1,br=new $s,Pr=new function(){var De=this,Xe=null,Je=0,ht=!1,bt=!1,pn=new no,fn=new Si,ln={value:null,needsUpdate:!1};function vn(){ln.value!==Xe&&(ln.value=Xe,ln.needsUpdate=0<Je),De.numPlanes=Je,De.numIntersection=0}function Ft(tn,Fn,Un,un){var sn=tn!==null?tn.length:0,Zn=null;if(sn!==0){if(Zn=ln.value,un!==!0||Zn===null){var or=Un+4*sn,mr=Fn.matrixWorldInverse;fn.getNormalMatrix(mr),(Zn===null||Zn.length<or)&&(Zn=new Float32Array(or));for(var ii=0,Br=Un;ii!==sn;++ii,Br+=4)pn.copy(tn[ii]).applyMatrix4(mr,fn),pn.normal.toArray(Zn,Br),Zn[Br+3]=pn.constant}ln.value=Zn,ln.needsUpdate=!0}return De.numPlanes=sn,Zn}this.uniform=ln,this.numPlanes=0,this.numIntersection=0,this.init=function(tn,Fn,Un){var un=tn.length!==0||Fn||Je!==0||ht;return ht=Fn,Xe=Ft(tn,Un,0),Je=tn.length,un},this.beginShadows=function(){bt=!0,Ft(null)},this.endShadows=function(){bt=!1,vn()},this.setState=function(tn,Fn,Un,un,sn,Zn){if(!ht||tn===null||tn.length===0||bt&&!Un)bt?Ft(null):vn();else{var or=bt?0:Je,mr=4*or,ii=sn.clippingState||null;ln.value=ii,ii=Ft(tn,un,mr,Zn);for(var Br=0;Br!==mr;++Br)ii[Br]=Xe[Br];sn.clippingState=ii,this.numIntersection=Fn?this.numPlanes:0,this.numPlanes+=or}}},vi=!1,ma=!1,Nr=new fr,Ei=new Ae;function Ir(){return Vn===null?ur:1}try{var ai={alpha:i,depth:c,stencil:d,antialias:m,premultipliedAlpha:x,preserveDrawingBuffer:A,powerPreference:I,failIfMajorPerformanceCaveat:X,xrCompatible:!0};t.addEventListener("webglcontextlost",ga,!1),t.addEventListener("webglcontextrestored",ps,!1);var xi="webgl";if(e.webgl2===!0&&(xi="webgl2"),(z=n||t.getContext(xi,ai)||t.getContext("experimental-webgl",ai))===null)throw t.getContext("webgl")!==null?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");e.retver=xi,z.getShaderPrecisionFormat===void 0&&(z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(De){throw console.error("THREE.WebGLRenderer: "+De.message),De}function oo(){ue=new function(De){var Xe={};return{get:function(Je){if(Xe[Je]!==void 0)return Xe[Je];var ht;switch(Je){case"WEBGL_depth_texture":ht=De.getExtension("WEBGL_depth_texture")||De.getExtension("MOZ_WEBGL_depth_texture")||De.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":ht=De.getExtension("EXT_texture_filter_anisotropic")||De.getExtension("MOZ_EXT_texture_filter_anisotropic")||De.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":ht=De.getExtension("WEBGL_compressed_texture_s3tc")||De.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||De.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":ht=De.getExtension("WEBGL_compressed_texture_pvrtc")||De.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:ht=De.getExtension(Je)}return ht===null&&console.warn("THREE.WebGLRenderer: "+Je+" extension not supported."),Xe[Je]=ht}}}(z),(me=new function(De,Xe,Je){var ht;function bt(Br){if(Br==="highp"){if(0<De.getShaderPrecisionFormat(35633,36338).precision&&0<De.getShaderPrecisionFormat(35632,36338).precision)return"highp";Br="mediump"}return Br==="mediump"&&0<De.getShaderPrecisionFormat(35633,36337).precision&&0<De.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var pn=typeof WebGL2RenderingContext<"u"&&De instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&De instanceof WebGL2ComputeRenderingContext,fn=Je.precision!==void 0?Je.precision:"highp",ln=bt(fn);ln!==fn&&(console.warn("THREE.WebGLRenderer:",fn,"not supported, using",ln,"instead."),fn=ln);var vn=Je.logarithmicDepthBuffer===!0,Ft=De.getParameter(34930),tn=De.getParameter(35660),Fn=De.getParameter(3379),Un=De.getParameter(34076),un=De.getParameter(34921),sn=De.getParameter(36347),Zn=De.getParameter(36348),or=De.getParameter(36349),mr=0<tn,ii=pn||!!Xe.get("OES_texture_float");return{isWebGL2:pn,getMaxAnisotropy:function(){if(ht!==void 0)return ht;var Br=Xe.get("EXT_texture_filter_anisotropic");return ht=Br!==null?De.getParameter(Br.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:bt,precision:fn,logarithmicDepthBuffer:vn,maxTextures:Ft,maxVertexTextures:tn,maxTextureSize:Fn,maxCubemapSize:Un,maxAttributes:un,maxVertexUniforms:sn,maxVaryings:Zn,maxFragmentUniforms:or,vertexTextures:mr,floatFragmentTextures:ii,floatVertexTextures:mr&&ii,maxSamples:pn?De.getParameter(36183):0}}(z,ue,e)).isWebGL2===!1&&(ue.get("WEBGL_depth_texture"),ue.get("OES_texture_float"),ue.get("OES_texture_half_float"),ue.get("OES_texture_half_float_linear"),ue.get("OES_standard_derivatives"),ue.get("OES_element_index_uint"),ue.get("ANGLE_instanced_arrays")),ue.get("OES_texture_float_linear"),Ct=new jl(0,ue,me),(ye=new Oh(z,ue,me)).scissor(rr.copy(ir).multiplyScalar(ur).floor()),ye.viewport(Ht.copy(Cn).multiplyScalar(ur).floor()),Pe=new function(De){var Xe={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:Xe,programs:null,autoReset:!0,reset:function(){Xe.frame++,Xe.calls=0,Xe.triangles=0,Xe.points=0,Xe.lines=0},update:function(Je,ht,bt){switch(bt=bt||1,Xe.calls++,ht){case 4:Xe.triangles+=bt*(Je/3);break;case 1:Xe.lines+=bt*(Je/2);break;case 3:Xe.lines+=bt*(Je-1);break;case 2:Xe.lines+=bt*Je;break;case 0:Xe.points+=bt*Je;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",ht)}}}},Le=new function(){var De=new WeakMap;return{get:function(Xe){var Je=De.get(Xe);return Je===void 0&&(Je={},De.set(Xe,Je)),Je},remove:function(Xe){De.delete(Xe)},update:function(Xe,Je,ht){De.get(Xe)[Je]=ht},dispose:function(){De=new WeakMap}}},Ge=new ad(z,ue,ye,Le,me,Ct,Pe),Qe=new function(De,Xe){var Je=Xe.isWebGL2,ht=new WeakMap;return{get:function(bt){return bt.isInterleavedBufferAttribute&&(bt=bt.data),ht.get(bt)},remove:function(bt){bt.isInterleavedBufferAttribute&&(bt=bt.data);var pn=ht.get(bt);pn&&(De.deleteBuffer(pn.buffer),ht.delete(bt))},update:function(bt,pn){bt.isInterleavedBufferAttribute&&(bt=bt.data);var fn,ln,vn,Ft,tn,Fn=ht.get(bt);Fn===void 0?ht.set(bt,function(Un,un){var sn=Un.array,Zn=Un.usage,or=De.createBuffer();De.bindBuffer(un,or),De.bufferData(un,sn,Zn),Un.onUploadCallback();var mr=5126;return sn instanceof Float32Array?mr=5126:sn instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):sn instanceof Uint16Array?mr=5123:sn instanceof Int16Array?mr=5122:sn instanceof Uint32Array?mr=5125:sn instanceof Int32Array?mr=5124:sn instanceof Int8Array?mr=5120:sn instanceof Uint8Array&&(mr=5121),{buffer:or,type:mr,bytesPerElement:sn.BYTES_PER_ELEMENT,version:Un.version}}(bt,pn)):Fn.version<bt.version&&(fn=Fn.buffer,vn=pn,Ft=(ln=bt).array,tn=ln.updateRange,De.bindBuffer(vn,fn),tn.count===-1?De.bufferSubData(vn,0,Ft):(Je?De.bufferSubData(vn,tn.offset*Ft.BYTES_PER_ELEMENT,Ft,tn.offset,tn.count):De.bufferSubData(vn,tn.offset*Ft.BYTES_PER_ELEMENT,Ft.subarray(tn.offset,tn.offset+tn.count)),tn.count=-1),Fn.version=bt.version)}}}(z,me),Ve=new function(De,Xe,Je){var ht=new WeakMap,bt=new WeakMap;function pn(ln){var vn=ln.target,Ft=ht.get(vn);for(var tn in Ft.index!==null&&Xe.remove(Ft.index),Ft.attributes)Xe.remove(Ft.attributes[tn]);vn.removeEventListener("dispose",pn),ht.delete(vn);var Fn=bt.get(Ft);Fn&&(Xe.remove(Fn),bt.delete(Ft)),Je.memory.geometries--}function fn(ln){var vn=[],Ft=ln.index,tn=ln.attributes.position,Fn=0;if(Ft!==null){var Un=Ft.array;Fn=Ft.version;for(var un=0,sn=Un.length;un<sn;un+=3){var Zn=Un[un+0],or=Un[un+1],mr=Un[un+2];vn.push(Zn,or,or,mr,mr,Zn)}}else for(Un=tn.array,Fn=tn.version,un=0,sn=Un.length/3-1;un<sn;un+=3)Zn=un+0,or=un+1,mr=un+2,vn.push(Zn,or,or,mr,mr,Zn);var ii=new(65535<Yi(vn)?Mi:pi)(vn,1);ii.version=Fn,Xe.update(ii,34963);var Br=bt.get(ln);Br&&Xe.remove(Br),bt.set(ln,ii)}return{get:function(ln,vn){var Ft=ht.get(vn);return Ft||(vn.addEventListener("dispose",pn),vn.isBufferGeometry?Ft=vn:vn.isGeometry&&(vn._bufferGeometry===void 0&&(vn._bufferGeometry=new Dn().setFromObject(ln)),Ft=vn._bufferGeometry),ht.set(vn,Ft),Je.memory.geometries++,Ft)},update:function(ln){var vn=ln.index,Ft=ln.attributes;for(var tn in vn!==null&&Xe.update(vn,34963),Ft)Xe.update(Ft[tn],34962);var Fn=ln.morphAttributes;for(var tn in Fn)for(var Un=Fn[tn],un=0,sn=Un.length;un<sn;un++)Xe.update(Un[un],34962)},getWireframeAttribute:function(ln){var vn=bt.get(ln);if(vn){var Ft=ln.index;Ft!==null&&vn.version<Ft.version&&fn(ln)}else fn(ln);return bt.get(ln)}}}(0,Qe,Pe),ot=new function(De,Xe,Je,ht){var bt={};return{update:function(pn){var fn=ht.render.frame,ln=pn.geometry,vn=Xe.get(pn,ln);return bt[vn.id]!==fn&&(ln.isGeometry&&vn.updateFromObject(pn),Xe.update(vn),bt[vn.id]=fn),pn.isInstancedMesh&&Je.update(pn.instanceMatrix,34962),vn},dispose:function(){bt={}}}}(0,Ve,Qe,Pe),Et=new function(De){var Xe={},Je=new Float32Array(8);return{update:function(ht,bt,pn,fn){var ln=ht.morphTargetInfluences,vn=ln===void 0?0:ln.length,Ft=Xe[bt.id];if(Ft===void 0){Ft=[];for(var tn=0;tn<vn;tn++)Ft[tn]=[tn,0];Xe[bt.id]=Ft}var Fn=pn.morphTargets&&bt.morphAttributes.position,Un=pn.morphNormals&&bt.morphAttributes.normal;for(tn=0;tn<vn;tn++)(sn=Ft[tn])[1]!==0&&(Fn&&bt.deleteAttribute("morphTarget"+tn),Un&&bt.deleteAttribute("morphNormal"+tn));for(tn=0;tn<vn;tn++)(sn=Ft[tn])[0]=tn,sn[1]=ln[tn];Ft.sort(uc);var un=0;for(tn=0;tn<8;tn++){var sn;if(sn=Ft[tn]){var Zn=sn[0],or=sn[1];if(or){Fn&&bt.setAttribute("morphTarget"+tn,Fn[Zn]),Un&&bt.setAttribute("morphNormal"+tn,Un[Zn]),un+=Je[tn]=or;continue}}Je[tn]=0}var mr=bt.morphTargetsRelative?1:1-un;fn.getUniforms().setValue(De,"morphTargetBaseInfluence",mr),fn.getUniforms().setValue(De,"morphTargetInfluences",Je)}}}(z),We=new td(Mt,ue,me),vt=new function(){var De=new WeakMap;function Xe(Je){var ht=Je.target;ht.removeEventListener("dispose",Xe),De.delete(ht)}return{get:function(Je,ht){var bt,pn=De.get(Je);return pn===void 0?(bt=new Ja,De.set(Je,new WeakMap),De.get(Je).set(ht,bt),Je.addEventListener("dispose",Xe)):(bt=pn.get(ht))===void 0&&(bt=new Ja,pn.set(ht,bt)),bt},dispose:function(){De=new WeakMap}}},_t=new function(){var De=new WeakMap;function Xe(Je){var ht=Je.target;ht.removeEventListener("dispose",Xe),De.delete(ht)}return{get:function(Je,ht){var bt;return De.has(Je)===!1?(bt=new rd,De.set(Je,new WeakMap),De.get(Je).set(ht,bt),Je.addEventListener("dispose",Xe)):De.get(Je).has(ht)===!1?(bt=new rd,De.get(Je).set(ht,bt)):bt=De.get(Je).get(ht),bt},dispose:function(){De=new WeakMap}}},Dt=new Lr(Mt,ye,ot,x),Vt=new function(De,Xe,Je,ht){var bt,pn=ht.isWebGL2;this.setMode=function(fn){bt=fn},this.render=function(fn,ln){De.drawArrays(bt,fn,ln),Je.update(ln,bt)},this.renderInstances=function(fn,ln,vn,Ft){if(Ft!==0){var tn,Fn;if(pn)tn=De,Fn="drawArraysInstanced";else if(Fn="drawArraysInstancedANGLE",(tn=Xe.get("ANGLE_instanced_arrays"))===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");tn[Fn](bt,ln,vn,Ft),Je.update(vn,bt,Ft)}}}(z,ue,Pe,me),Kt=new function(De,Xe,Je,ht){var bt,pn,fn,ln=ht.isWebGL2;this.setMode=function(vn){bt=vn},this.setIndex=function(vn){pn=vn.type,fn=vn.bytesPerElement},this.render=function(vn,Ft){De.drawElements(bt,Ft,pn,vn*fn),Je.update(Ft,bt)},this.renderInstances=function(vn,Ft,tn,Fn){if(Fn!==0){var Un,un;if(ln)Un=De,un="drawElementsInstanced";else if(un="drawElementsInstancedANGLE",(Un=Xe.get("ANGLE_instanced_arrays"))===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Un[un](bt,tn,pn,Ft*fn,Fn),Je.update(tn,bt,Fn)}}}(z,ue,Pe,me),Pe.programs=We.programs,Mt.capabilities=me,Mt.extensions=ue,Mt.properties=Le,Mt.renderLists=vt,Mt.state=ye,Mt.info=Pe}oo();var ei=new mc(Mt,z);this.xr=ei;var $i=new function(De,Xe){var Je,ht,bt,pn,fn,ln,vn,Ft=De.extensions,tn=De.properties,Fn=0;function Un(un){return un.isArrayCamera?un.cameras:(fn[0]=un,fn)}this.isAvailable=function(){if(vn===void 0){var un=Ft.get("OVR_multiview2");if(vn=un!==null&&Xe.getContextAttributes().antialias===!1){Fn=Xe.getParameter(un.MAX_VIEWS_OVR),Je=new pc(0,0,2),ln=new zt,pn=[],bt=[],fn=[];for(var sn=0;sn<Fn;sn++)pn[sn]=new fr,bt[sn]=new Si}}return vn},this.attachCamera=function(un){(function(sn){if(sn.isArrayCamera===void 0)return!0;var Zn=sn.cameras;if(Zn.length>Fn)return!1;for(var or=1,mr=Zn.length;or<mr;or++)if(Zn[0].viewport.z!==Zn[or].viewport.z||Zn[0].viewport.w!==Zn[or].viewport.w)return!1;return!0})(un)!==!1&&(ht=De.getRenderTarget(),function(sn){if(ht?ln.set(ht.width,ht.height):De.getDrawingBufferSize(ln),sn.isArrayCamera){var Zn=sn.cameras[0].viewport;Je.setSize(Zn.z,Zn.w),Je.setNumViews(sn.cameras.length)}else Je.setSize(ln.x,ln.y),Je.setNumViews(2)}(un),De.setRenderTarget(Je))},this.detachCamera=function(un){Je===De.getRenderTarget()&&(De.setRenderTarget(ht),function(sn){var Zn=Je,or=Zn.numViews,mr=tn.get(Zn).__webglViewFramebuffers,ii=Zn.width,Br=Zn.height;if(sn.isArrayCamera)for(var Io=0;Io<or;Io++){var $a=sn.cameras[Io].viewport,Qa=$a.x,Ml=$a.y,ya=Qa+$a.z,Ni=Ml+$a.w;Xe.bindFramebuffer(36008,mr[Io]),Xe.blitFramebuffer(0,0,ii,Br,Qa,Ml,ya,Ni,16384,9728)}else Xe.bindFramebuffer(36008,mr[0]),Xe.blitFramebuffer(0,0,ii,Br,0,0,ln.x,ln.y,16384,9728)}(un))},this.updateCameraProjectionMatricesUniform=function(un,sn){for(var Zn=Un(un),or=0;or<Zn.length;or++)pn[or].copy(Zn[or].projectionMatrix);sn.setValue(Xe,"projectionMatrices",pn)},this.updateCameraViewMatricesUniform=function(un,sn){for(var Zn=Un(un),or=0;or<Zn.length;or++)pn[or].copy(Zn[or].matrixWorldInverse);sn.setValue(Xe,"viewMatrices",pn)},this.updateObjectMatricesUniforms=function(un,sn,Zn){for(var or=Un(sn),mr=0;mr<or.length;mr++)pn[mr].multiplyMatrices(or[mr].matrixWorldInverse,un.matrixWorld),bt[mr].getNormalMatrix(pn[mr]);Zn.setValue(Xe,"modelViewMatrices",pn),Zn.setValue(Xe,"normalMatrices",bt)}}(Mt,z),ta=new Ph(Mt,ot,me.maxTextureSize);function ga(De){De.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),hn=!0}function ps(){console.log("THREE.WebGLRenderer: Context Restored."),hn=!1,oo()}function Bs(De){var Xe,Je=De.target;Je.removeEventListener("dispose",Bs),nh(Xe=Je),Le.remove(Xe)}function nh(De){var Xe=Le.get(De).program;(De.program=void 0)!==Xe&&We.releaseProgram(Xe)}this.shadowMap=ta,this.getContext=function(){return z},this.getContextAttributes=function(){return z.getContextAttributes()},this.forceContextLoss=function(){var De=ue.get("WEBGL_lose_context");De&&De.loseContext()},this.forceContextRestore=function(){var De=ue.get("WEBGL_lose_context");De&&De.restoreContext()},this.getPixelRatio=function(){return ur},this.setPixelRatio=function(De){De!==void 0&&(ur=De,this.setSize(St,On,!1))},this.getSize=function(De){return De===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),De=new zt),De.set(St,On)},this.setSize=function(De,Xe,Je){ei.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(St=De,On=Xe,t.width=Math.floor(De*ur),t.height=Math.floor(Xe*ur),Je!==!1&&(t.style.width=De+"px",t.style.height=Xe+"px"),this.setViewport(0,0,De,Xe))},this.getDrawingBufferSize=function(De){return De===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),De=new zt),De.set(St*ur,On*ur).floor()},this.setDrawingBufferSize=function(De,Xe,Je){St=De,On=Xe,ur=Je,t.width=Math.floor(De*Je),t.height=Math.floor(Xe*Je),this.setViewport(0,0,De,Xe)},this.getCurrentViewport=function(De){return De===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),De=new Jr),De.copy(Ht)},this.getViewport=function(De){return De.copy(Cn)},this.setViewport=function(De,Xe,Je,ht){De.isVector4?Cn.set(De.x,De.y,De.z,De.w):Cn.set(De,Xe,Je,ht),ye.viewport(Ht.copy(Cn).multiplyScalar(ur).floor())},this.getScissor=function(De){return De.copy(ir)},this.setScissor=function(De,Xe,Je,ht){De.isVector4?ir.set(De.x,De.y,De.z,De.w):ir.set(De,Xe,Je,ht),ye.scissor(rr.copy(ir).multiplyScalar(ur).floor())},this.getScissorTest=function(){return cn},this.setScissorTest=function(De){ye.setScissorTest(cn=De)},this.setOpaqueSort=function(De){dt=De},this.setTransparentSort=function(De){_n=De},this.getClearColor=function(){return Dt.getClearColor()},this.setClearColor=function(){Dt.setClearColor.apply(Dt,arguments)},this.getClearAlpha=function(){return Dt.getClearAlpha()},this.setClearAlpha=function(){Dt.setClearAlpha.apply(Dt,arguments)},this.clear=function(De,Xe,Je){var ht=0;De!==void 0&&!De||(ht|=16384),Xe!==void 0&&!Xe||(ht|=256),Je!==void 0&&!Je||(ht|=1024),z.clear(ht)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ga,!1),t.removeEventListener("webglcontextrestored",ps,!1),vt.dispose(),_t.dispose(),Le.dispose(),ot.dispose(),ei.dispose(),nu.stop()},this.renderBufferImmediate=function(De,Xe){ye.initAttributes();var Je=Le.get(De);De.hasPositions&&!Je.position&&(Je.position=z.createBuffer()),De.hasNormals&&!Je.normal&&(Je.normal=z.createBuffer()),De.hasUvs&&!Je.uv&&(Je.uv=z.createBuffer()),De.hasColors&&!Je.color&&(Je.color=z.createBuffer());var ht=Xe.getAttributes();De.hasPositions&&(z.bindBuffer(34962,Je.position),z.bufferData(34962,De.positionArray,35048),ye.enableAttribute(ht.position),z.vertexAttribPointer(ht.position,3,5126,!1,0,0)),De.hasNormals&&(z.bindBuffer(34962,Je.normal),z.bufferData(34962,De.normalArray,35048),ye.enableAttribute(ht.normal),z.vertexAttribPointer(ht.normal,3,5126,!1,0,0)),De.hasUvs&&(z.bindBuffer(34962,Je.uv),z.bufferData(34962,De.uvArray,35048),ye.enableAttribute(ht.uv),z.vertexAttribPointer(ht.uv,2,5126,!1,0,0)),De.hasColors&&(z.bindBuffer(34962,Je.color),z.bufferData(34962,De.colorArray,35048),ye.enableAttribute(ht.color),z.vertexAttribPointer(ht.color,3,5126,!1,0,0)),ye.disableUnusedAttributes(),z.drawArrays(4,0,De.count),De.count=0};var kp=new Hn;this.renderBufferDirect=function(De,Xe,Je,ht,bt,pn){Xe===null&&(Xe=kp);var fn=bt.isMesh&&bt.matrixWorld.determinant()<0,ln=Vh(De,Xe,ht,bt);ye.setMaterial(ht,fn);var vn=!1;ke.geometry===Je.id&&ke.program===ln.id&&ke.wireframe===(ht.wireframe===!0)||(ke.geometry=Je.id,ke.program=ln.id,ke.wireframe=ht.wireframe===!0,vn=!0),(ht.morphTargets||ht.morphNormals)&&(Et.update(bt,Je,ht,ln),vn=!0);var Ft=Je.index,tn=Je.attributes.position;if(Ft===null){if(tn===void 0||tn.count===0)return}else if(Ft.count===0)return;var Fn,Un=1;ht.wireframe===!0&&(Ft=Ve.getWireframeAttribute(Je),Un=2);var un=Vt;Ft!==null&&((Fn=Qe.get(Ft))?(un=Kt).setIndex(Fn):(console.log("mx attribute == null"),Ft=null)),vn&&(function(Ml,ya,Ni,ti){if(me.isWebGL2!==!1||!Ml.isInstancedMesh&&!ya.isInstancedBufferGeometry||ue.get("ANGLE_instanced_arrays")!==null){ye.initAttributes();var Ud=ya.attributes,ka=ti.getAttributes(),Hd=Ni.defaultAttributeValues;for(var Ta in ka){var Hi=ka[Ta];if(0<=Hi){var ja=Ud[Ta];if(ja!==void 0){var dn=ja.normalized,Jt=ja.itemSize;if((su=Qe.get(ja))===void 0)continue;var wo=su.buffer,au=su.type,_f=su.bytesPerElement;if(ja.isInterleavedBufferAttribute){var ih=ja.data,Ff=ih.stride,Vf=ja.offset;ih&&ih.isInstancedInterleavedBuffer?(ye.enableAttributeAndDivisor(Hi,ih.meshPerAttribute),ya.maxInstancedCount===void 0&&(ya.maxInstancedCount=ih.meshPerAttribute*ih.count)):ye.enableAttribute(Hi),z.bindBuffer(34962,wo),z.vertexAttribPointer(Hi,Jt,au,dn,Ff*_f,Vf*_f)}else ja.isInstancedBufferAttribute?(ye.enableAttributeAndDivisor(Hi,ja.meshPerAttribute),ya.maxInstancedCount===void 0&&(ya.maxInstancedCount=ja.meshPerAttribute*ja.count)):ye.enableAttribute(Hi),z.bindBuffer(34962,wo),z.vertexAttribPointer(Hi,Jt,au,dn,0,0)}else if(Ta==="instanceMatrix"){var su;if((su=Qe.get(Ml.instanceMatrix))===void 0)continue;wo=su.buffer,au=su.type,ye.enableAttributeAndDivisor(Hi+0,1),ye.enableAttributeAndDivisor(Hi+1,1),ye.enableAttributeAndDivisor(Hi+2,1),ye.enableAttributeAndDivisor(Hi+3,1),z.bindBuffer(34962,wo),z.vertexAttribPointer(Hi+0,4,au,!1,64,0),z.vertexAttribPointer(Hi+1,4,au,!1,64,16),z.vertexAttribPointer(Hi+2,4,au,!1,64,32),z.vertexAttribPointer(Hi+3,4,au,!1,64,48)}else if(Hd!==void 0){var oh=Hd[Ta];if(oh!==void 0)switch(oh.length){case 2:z.vertexAttrib2fv(Hi,oh);break;case 3:z.vertexAttrib3fv(Hi,oh);break;case 4:z.vertexAttrib4fv(Hi,oh);break;default:z.vertexAttrib1fv(Hi,oh)}}}}ye.disableUnusedAttributes()}}(bt,Je,ht,ln),Ft!==null&&z.bindBuffer(34963,Fn.buffer));var sn=Ft!==null?Ft.count:tn.count,Zn=Je.drawRange.start*Un,or=Je.drawRange.count*Un,mr=pn!==null?pn.start*Un:0,ii=pn!==null?pn.count*Un:1/0,Br=Math.max(Zn,mr),Io=Math.min(sn,Zn+or,mr+ii)-1,$a=Math.max(0,Io-Br+1);if($a!==0){if(bt.isMesh)ht.wireframe===!0?(ye.setLineWidth(ht.wireframeLinewidth*Ir()),un.setMode(1)):un.setMode(4);else if(bt.isLine){var Qa=ht.linewidth;Qa===void 0&&(Qa=1),ye.setLineWidth(Qa*Ir()),bt.isLineSegments?un.setMode(1):bt.isLineLoop?un.setMode(2):un.setMode(3)}else bt.isPoints?un.setMode(0):bt.isSprite&&un.setMode(4);bt.isInstancedMesh?un.renderInstances(Je,Br,$a,bt.count):Je.isInstancedBufferGeometry?un.renderInstances(Je,Br,$a,Je.maxInstancedCount):un.render(Br,$a)}},this.compile=function(De,Xe){(re=_t.get(De,Xe)).init(),De.traverse(function(ht){ht.isLight&&(re.pushLight(ht),ht.castShadow&&re.pushShadow(ht))}),re.setupLights(Xe);var Je={};De.traverse(function(ht){if(ht.material)if(Array.isArray(ht.material))for(var bt=0;bt<ht.material.length;bt++)ht.material[bt].uuid in Je==0&&(ou(ht.material[bt],De,ht),Je[ht.material[bt].uuid]=!0);else ht.material.uuid in Je==0&&(ou(ht.material,De,ht),Je[ht.material.uuid]=!0)})};var rh=null,nu=new ch;function ru(De,Xe,Je,ht){for(var bt=0,pn=De.length;bt<pn;bt++){var fn=De[bt],ln=fn.object,vn=fn.geometry,Ft=ht===void 0?fn.material:ht,tn=fn.group;if(Je.isArrayCamera)if(Yt=Je,ei.enabled&&$i.isAvailable())iu(ln,Xe,Je,vn,Ft,tn);else for(var Fn=Je.cameras,Un=0,un=Fn.length;Un<un;Un++){var sn=Fn[Un];ln.layers.test(sn.layers)&&(ye.viewport(Ht.copy(sn.viewport)),re.setupLights(sn),iu(ln,Xe,sn,vn,Ft,tn))}else Yt=null,iu(ln,Xe,Je,vn,Ft,tn)}}function iu(De,Xe,Je,ht,bt,pn){if(De.onBeforeRender(Mt,Xe,Je,ht,bt,pn),re=_t.get(Xe,Yt||Je),De.modelViewMatrix.multiplyMatrices(Je.matrixWorldInverse,De.matrixWorld),De.normalMatrix.getNormalMatrix(De.modelViewMatrix),De.isImmediateRenderObject){var fn=Vh(Je,Xe,bt,De);ye.setMaterial(bt),ke.geometry=null,ke.program=null,ke.wireframe=!1,ln=fn,De.render(function(vn){Mt.renderBufferImmediate(vn,ln)})}else Mt.renderBufferDirect(Je,Xe,ht,bt,De,pn);var ln;De.onAfterRender(Mt,Xe,Je,ht,bt,pn),re=_t.get(Xe,Yt||Je)}function ou(De,Xe,Je){var ht=Le.get(De),bt=re.state.lights,pn=re.state.shadowsArray,fn=bt.state.version,ln=We.getParameters(De,bt.state,pn,Xe,Pr.numPlanes,Pr.numIntersection,Je),vn=We.getProgramCacheKey(ln),Ft=ht.program,tn=!0;if(Ft===void 0)De.addEventListener("dispose",Bs);else if(Ft.cacheKey!==vn)nh(De);else if(ht.lightsStateVersion!==fn)ht.lightsStateVersion=fn,tn=!1;else{if(ln.shaderID!==void 0)return;tn=!1}tn&&(Ft=We.acquireProgram(ln,vn),ht.program=Ft,ht.uniforms=ln.uniforms,ht.environment=De.isMeshStandardMaterial?Xe.environment:null,ht.outputEncoding=Mt.outputEncoding,De.program=Ft);var Fn=Ft.getAttributes();if(De.morphTargets)for(var Un=De.numSupportedMorphTargets=0;Un<Mt.maxMorphTargets;Un++)0<=Fn["morphTarget"+Un]&&De.numSupportedMorphTargets++;if(De.morphNormals)for(Un=De.numSupportedMorphNormals=0;Un<Mt.maxMorphNormals;Un++)0<=Fn["morphNormal"+Un]&&De.numSupportedMorphNormals++;var un,sn=ht.uniforms;(De.isShaderMaterial||De.isRawShaderMaterial)&&De.clipping!==!0||(ht.numClippingPlanes=Pr.numPlanes,ht.numIntersection=Pr.numIntersection,sn.clippingPlanes=Pr.uniform),ht.fog=Xe.fog,ht.needsLights=(un=De).isMeshLambertMaterial||un.isMeshToonMaterial||un.isMeshPhongMaterial||un.isMeshStandardMaterial||un.isShadowMaterial||un.isShaderMaterial&&un.lights===!0,ht.lightsStateVersion=fn,ht.needsLights&&(sn.ambientLightColor.value=bt.state.ambient,sn.lightProbe.value=bt.state.probe,sn.directionalLights.value=bt.state.directional,sn.spotLights.value=bt.state.spot,sn.rectAreaLights.value=bt.state.rectArea,sn.pointLights.value=bt.state.point,sn.hemisphereLights.value=bt.state.hemi,sn.directionalShadowMap.value=bt.state.directionalShadowMap,sn.directionalShadowMatrix.value=bt.state.directionalShadowMatrix,sn.spotShadowMap.value=bt.state.spotShadowMap,sn.spotShadowMatrix.value=bt.state.spotShadowMatrix,sn.pointShadowMap.value=bt.state.pointShadowMap,sn.pointShadowMatrix.value=bt.state.pointShadowMatrix);var Zn=ht.program.getUniforms(),or=cs.seqWithValue(Zn.seq,sn);ht.uniformsList=or}function Vh(De,Xe,Je,ht){Ge.resetTextureUnits();var bt=Xe.fog,pn=Je.isMeshStandardMaterial?Xe.environment:null,fn=Le.get(Je),ln=re.state.lights;if(vi&&(ma||De!==et)){var vn=De===et&&Je.id===En;Pr.setState(Je.clippingPlanes,Je.clipIntersection,Je.clipShadows,De,fn,vn)}Je.version===fn.__version?(fn.program===void 0||Je.fog&&fn.fog!==bt||fn.environment!==pn||fn.needsLights&&fn.lightsStateVersion!==ln.state.version||fn.numClippingPlanes!==void 0&&(fn.numClippingPlanes!==Pr.numPlanes||fn.numIntersection!==Pr.numIntersection)||fn.outputEncoding!==Mt.outputEncoding)&&ou(Je,Xe,ht):(Le.update(Je,"uniforms",Je.uniforms),ou(Je,Xe,ht),fn.__version=Je.version);var Ft,tn,Fn,Un,un,sn,Zn,or,mr,ii,Br,Io,$a=!1,Qa=!1,Ml=!1,ya=fn.program,Ni=ya.getUniforms(),ti=fn.uniforms;if(ye.useProgram(ya.program)&&(Ml=Qa=$a=!0),Je.id!==En&&(En=Je.id,Qa=!0),$a||et!==De){if(0<ya.numMultiviewViews?$i.updateCameraProjectionMatricesUniform(De,Ni):Ni.setValue(z,"projectionMatrix",De.projectionMatrix),me.logarithmicDepthBuffer&&Ni.setValue(z,"logDepthBufFC",2/(Math.log(De.far+1)/Math.LN2)),et!==De&&(et=De,Ml=Qa=!0),Je.isShaderMaterial||Je.isMeshPhongMaterial||Je.isMeshToonMaterial||Je.isMeshStandardMaterial||Je.envMap){var Ud=Ni.map.cameraPosition;Ud!==void 0&&Ud.setValue(z,Ei.setFromMatrixPosition(De.matrixWorld))}(Je.isMeshPhongMaterial||Je.isMeshToonMaterial||Je.isMeshLambertMaterial||Je.isMeshBasicMaterial||Je.isMeshStandardMaterial||Je.isShaderMaterial)&&Ni.setValue(z,"isOrthographic",De.isOrthographicCamera===!0),(Je.isMeshPhongMaterial||Je.isMeshToonMaterial||Je.isMeshLambertMaterial||Je.isMeshBasicMaterial||Je.isMeshStandardMaterial||Je.isShaderMaterial||Je.skinning)&&(0<ya.numMultiviewViews?$i.updateCameraViewMatricesUniform(De,Ni):Ni.setValue(z,"viewMatrix",De.matrixWorldInverse))}if(Je.skinning){Ni.setOptional(z,ht,"bindMatrix"),Ni.setOptional(z,ht,"bindMatrixInverse");var ka=ht.skeleton;if(ka){var Hd=ka.bones;if(me.floatVertexTextures){if(ka.boneTexture===void 0){var Ta=Math.sqrt(4*Hd.length);Ta=vr.ceilPowerOfTwo(Ta),Ta=Math.max(Ta,4);var Hi=new Float32Array(Ta*Ta*4);Hi.set(ka.boneMatrices);var ja=new Al(Hi,Ta,Ta,Or,Ot);ka.boneMatrices=Hi,ka.boneTexture=ja,ka.boneTextureSize=Ta}Ni.setValue(z,"boneTexture",ka.boneTexture,Ge),Ni.setValue(z,"boneTextureSize",ka.boneTextureSize)}else Ni.setOptional(z,ka,"boneMatrices")}}return!Qa&&fn.receiveShadow===ht.receiveShadow||(fn.receiveShadow=ht.receiveShadow,Ni.setValue(z,"receiveShadow",ht.receiveShadow)),Qa&&(Ni.setValue(z,"toneMappingExposure",Mt.toneMappingExposure),Ni.setValue(z,"toneMappingWhitePoint",Mt.toneMappingWhitePoint),fn.needsLights&&(Io=Ml,(Br=ti).ambientLightColor.needsUpdate=Io,Br.lightProbe.needsUpdate=Io,Br.directionalLights.needsUpdate=Io,Br.pointLights.needsUpdate=Io,Br.spotLights.needsUpdate=Io,Br.rectAreaLights.needsUpdate=Io,Br.hemisphereLights.needsUpdate=Io),bt&&Je.fog&&(ii=bt,(mr=ti).fogColor.value.copy(ii.color),ii.isFog?(mr.fogNear.value=ii.near,mr.fogFar.value=ii.far):ii.isFogExp2&&(mr.fogDensity.value=ii.density)),Je.isMeshBasicMaterial?_a(ti,Je):Je.isMeshLambertMaterial?(_a(ti,Je),Zn=ti,(or=Je).emissiveMap&&(Zn.emissiveMap.value=or.emissiveMap)):Je.isMeshToonMaterial?(_a(ti,Je),function(dn,Jt){dn.specular.value.copy(Jt.specular),dn.shininess.value=Math.max(Jt.shininess,1e-4),Jt.gradientMap&&(dn.gradientMap.value=Jt.gradientMap),Jt.emissiveMap&&(dn.emissiveMap.value=Jt.emissiveMap),Jt.bumpMap&&(dn.bumpMap.value=Jt.bumpMap,dn.bumpScale.value=Jt.bumpScale,Jt.side===T&&(dn.bumpScale.value*=-1)),Jt.normalMap&&(dn.normalMap.value=Jt.normalMap,dn.normalScale.value.copy(Jt.normalScale),Jt.side===T&&dn.normalScale.value.negate()),Jt.displacementMap&&(dn.displacementMap.value=Jt.displacementMap,dn.displacementScale.value=Jt.displacementScale,dn.displacementBias.value=Jt.displacementBias)}(ti,Je)):Je.isMeshPhongMaterial?(_a(ti,Je),function(dn,Jt){dn.specular.value.copy(Jt.specular),dn.shininess.value=Math.max(Jt.shininess,1e-4),Jt.emissiveMap&&(dn.emissiveMap.value=Jt.emissiveMap),Jt.bumpMap&&(dn.bumpMap.value=Jt.bumpMap,dn.bumpScale.value=Jt.bumpScale,Jt.side===T&&(dn.bumpScale.value*=-1)),Jt.normalMap&&(dn.normalMap.value=Jt.normalMap,dn.normalScale.value.copy(Jt.normalScale),Jt.side===T&&dn.normalScale.value.negate()),Jt.displacementMap&&(dn.displacementMap.value=Jt.displacementMap,dn.displacementScale.value=Jt.displacementScale,dn.displacementBias.value=Jt.displacementBias)}(ti,Je)):Je.isMeshStandardMaterial?(_a(ti,Je,pn),(Je.isMeshPhysicalMaterial?function(dn,Jt,wo){Mf(dn,Jt,wo),dn.reflectivity.value=Jt.reflectivity,dn.clearcoat.value=Jt.clearcoat,dn.clearcoatRoughness.value=Jt.clearcoatRoughness,Jt.sheen&&dn.sheen.value.copy(Jt.sheen),Jt.clearcoatNormalMap&&(dn.clearcoatNormalScale.value.copy(Jt.clearcoatNormalScale),dn.clearcoatNormalMap.value=Jt.clearcoatNormalMap,Jt.side===T&&dn.clearcoatNormalScale.value.negate()),dn.transparency.value=Jt.transparency}:Mf)(ti,Je,pn)):Je.isMeshMatcapMaterial?(_a(ti,Je),function(dn,Jt){Jt.matcap&&(dn.matcap.value=Jt.matcap),Jt.bumpMap&&(dn.bumpMap.value=Jt.bumpMap,dn.bumpScale.value=Jt.bumpScale,Jt.side===T&&(dn.bumpScale.value*=-1)),Jt.normalMap&&(dn.normalMap.value=Jt.normalMap,dn.normalScale.value.copy(Jt.normalScale),Jt.side===T&&dn.normalScale.value.negate()),Jt.displacementMap&&(dn.displacementMap.value=Jt.displacementMap,dn.displacementScale.value=Jt.displacementScale,dn.displacementBias.value=Jt.displacementBias)}(ti,Je)):Je.isMeshDepthMaterial?(_a(ti,Je),un=ti,(sn=Je).displacementMap&&(un.displacementMap.value=sn.displacementMap,un.displacementScale.value=sn.displacementScale,un.displacementBias.value=sn.displacementBias)):Je.isMeshDistanceMaterial?(_a(ti,Je),function(dn,Jt){Jt.displacementMap&&(dn.displacementMap.value=Jt.displacementMap,dn.displacementScale.value=Jt.displacementScale,dn.displacementBias.value=Jt.displacementBias),dn.referencePosition.value.copy(Jt.referencePosition),dn.nearDistance.value=Jt.nearDistance,dn.farDistance.value=Jt.farDistance}(ti,Je)):Je.isMeshNormalMaterial?(_a(ti,Je),function(dn,Jt){Jt.bumpMap&&(dn.bumpMap.value=Jt.bumpMap,dn.bumpScale.value=Jt.bumpScale,Jt.side===T&&(dn.bumpScale.value*=-1)),Jt.normalMap&&(dn.normalMap.value=Jt.normalMap,dn.normalScale.value.copy(Jt.normalScale),Jt.side===T&&dn.normalScale.value.negate()),Jt.displacementMap&&(dn.displacementMap.value=Jt.displacementMap,dn.displacementScale.value=Jt.displacementScale,dn.displacementBias.value=Jt.displacementBias)}(ti,Je)):Je.isLineBasicMaterial?(Un=Je,(Fn=ti).diffuse.value.copy(Un.color),Fn.opacity.value=Un.opacity,Je.isLineDashedMaterial&&(tn=Je,(Ft=ti).dashSize.value=tn.dashSize,Ft.totalSize.value=tn.dashSize+tn.gapSize,Ft.scale.value=tn.scale)):Je.isPointsMaterial?function(dn,Jt){var wo;dn.diffuse.value.copy(Jt.color),dn.opacity.value=Jt.opacity,dn.size.value=Jt.size*ur,dn.scale.value=.5*On,Jt.map&&(dn.map.value=Jt.map),Jt.alphaMap&&(dn.alphaMap.value=Jt.alphaMap),Jt.map?wo=Jt.map:Jt.alphaMap&&(wo=Jt.alphaMap),wo!==void 0&&(wo.matrixAutoUpdate===!0&&wo.updateMatrix(),dn.uvTransform.value.copy(wo.matrix))}(ti,Je):Je.isSpriteMaterial?function(dn,Jt){var wo;dn.diffuse.value.copy(Jt.color),dn.opacity.value=Jt.opacity,dn.rotation.value=Jt.rotation,Jt.map&&(dn.map.value=Jt.map),Jt.alphaMap&&(dn.alphaMap.value=Jt.alphaMap),Jt.map?wo=Jt.map:Jt.alphaMap&&(wo=Jt.alphaMap),wo!==void 0&&(wo.matrixAutoUpdate===!0&&wo.updateMatrix(),dn.uvTransform.value.copy(wo.matrix))}(ti,Je):Je.isShadowMaterial&&(ti.color.value.copy(Je.color),ti.opacity.value=Je.opacity),ti.ltc_1!==void 0&&(ti.ltc_1.value=bn.LTC_1),ti.ltc_2!==void 0&&(ti.ltc_2.value=bn.LTC_2),cs.upload(z,fn.uniformsList,ti,Ge),Je.isShaderMaterial&&(Je.uniformsNeedUpdate=!1)),Je.isShaderMaterial&&Je.uniformsNeedUpdate===!0&&(cs.upload(z,fn.uniformsList,ti,Ge),Je.uniformsNeedUpdate=!1),Je.isSpriteMaterial&&Ni.setValue(z,"center",ht.center),0<ya.numMultiviewViews?$i.updateObjectMatricesUniforms(ht,De,Ni):(Ni.setValue(z,"modelViewMatrix",ht.modelViewMatrix),Ni.setValue(z,"normalMatrix",ht.normalMatrix)),Ni.setValue(z,"modelMatrix",ht.matrixWorld),ya}function _a(De,Xe,Je){De.opacity.value=Xe.opacity,Xe.color&&De.diffuse.value.copy(Xe.color),Xe.emissive&&De.emissive.value.copy(Xe.emissive).multiplyScalar(Xe.emissiveIntensity),Xe.map&&(De.map.value=Xe.map),Xe.alphaMap&&(De.alphaMap.value=Xe.alphaMap),Xe.specularMap&&(De.specularMap.value=Xe.specularMap);var ht,bt,pn=Xe.envMap||Je;pn&&(De.envMap.value=pn,De.flipEnvMap.value=pn.isCubeTexture?-1:1,De.reflectivity.value=Xe.reflectivity,De.refractionRatio.value=Xe.refractionRatio,De.maxMipLevel.value=Le.get(pn).__maxMipLevel),Xe.lightMap&&(De.lightMap.value=Xe.lightMap,De.lightMapIntensity.value=Xe.lightMapIntensity),Xe.aoMap&&(De.aoMap.value=Xe.aoMap,De.aoMapIntensity.value=Xe.aoMapIntensity),Xe.map?ht=Xe.map:Xe.specularMap?ht=Xe.specularMap:Xe.displacementMap?ht=Xe.displacementMap:Xe.normalMap?ht=Xe.normalMap:Xe.bumpMap?ht=Xe.bumpMap:Xe.roughnessMap?ht=Xe.roughnessMap:Xe.metalnessMap?ht=Xe.metalnessMap:Xe.alphaMap?ht=Xe.alphaMap:Xe.emissiveMap&&(ht=Xe.emissiveMap),ht!==void 0&&(ht.isWebGLRenderTarget&&(ht=ht.texture),ht.matrixAutoUpdate===!0&&ht.updateMatrix(),De.uvTransform.value.copy(ht.matrix)),Xe.aoMap?bt=Xe.aoMap:Xe.lightMap&&(bt=Xe.lightMap),bt!==void 0&&(bt.isWebGLRenderTarget&&(bt=bt.texture),bt.matrixAutoUpdate===!0&&bt.updateMatrix(),De.uv2Transform.value.copy(bt.matrix))}function Mf(De,Xe,Je){De.roughness.value=Xe.roughness,De.metalness.value=Xe.metalness,Xe.roughnessMap&&(De.roughnessMap.value=Xe.roughnessMap),Xe.metalnessMap&&(De.metalnessMap.value=Xe.metalnessMap),Xe.emissiveMap&&(De.emissiveMap.value=Xe.emissiveMap),Xe.bumpMap&&(De.bumpMap.value=Xe.bumpMap,De.bumpScale.value=Xe.bumpScale,Xe.side===T&&(De.bumpScale.value*=-1)),Xe.normalMap&&(De.normalMap.value=Xe.normalMap,De.normalScale.value.copy(Xe.normalScale),Xe.side===T&&De.normalScale.value.negate()),Xe.displacementMap&&(De.displacementMap.value=Xe.displacementMap,De.displacementScale.value=Xe.displacementScale,De.displacementBias.value=Xe.displacementBias),(Xe.envMap||Je)&&(De.envMapIntensity.value=Xe.envMapIntensity)}nu.setAnimationLoop(function(De){ei.isPresenting||rh&&rh(De)}),typeof window<"u"&&nu.setContext(window),this.setAnimationLoop=function(De){rh=De,ei.setAnimationLoop(De),nu.start()},this.render=function(De,Xe){var Je,ht;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Je=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),ht=arguments[3]),Xe&&Xe.isCamera){if(!hn){ke.geometry=null,ke.program=null,ke.wireframe=!1,En=-1,!(et=null)===De.autoUpdate&&De.updateMatrixWorld(),Xe.parent===null&&Xe.updateMatrixWorld(),ei.enabled&&ei.isPresenting&&(Xe=ei.getCamera(Xe)),(re=_t.get(De,Xe)).init(),De.onBeforeRender(Mt,De,Xe,Je||Vn),Nr.multiplyMatrices(Xe.projectionMatrix,Xe.matrixWorldInverse),br.setFromProjectionMatrix(Nr),ma=this.localClippingEnabled,vi=Pr.init(this.clippingPlanes,ma,Xe),(Q=vt.get(De,Xe)).init(),function vn(Ft,tn,Fn,Un){if(Ft.visible!==!1){if(Ft.layers.test(tn.layers)){if(Ft.isGroup)Fn=Ft.renderOrder;else if(Ft.isLOD)Ft.autoUpdate===!0&&Ft.update(tn);else if(Ft.isLight)re.pushLight(Ft),Ft.castShadow&&re.pushShadow(Ft);else if(Ft.isSprite){if(!Ft.frustumCulled||br.intersectsSprite(Ft)){Un&&Ei.setFromMatrixPosition(Ft.matrixWorld).applyMatrix4(Nr);var un=ot.update(Ft);(sn=Ft.material).visible&&Q.push(Ft,un,sn,Fn,Ei.z,null)}}else if(Ft.isImmediateRenderObject)Un&&Ei.setFromMatrixPosition(Ft.matrixWorld).applyMatrix4(Nr),Q.push(Ft,null,Ft.material,Fn,Ei.z,null);else if((Ft.isMesh||Ft.isLine||Ft.isPoints)&&(Ft.isSkinnedMesh&&Ft.skeleton.frame!==Pe.render.frame&&(Ft.skeleton.update(),Ft.skeleton.frame=Pe.render.frame),!Ft.frustumCulled||br.intersectsObject(Ft))){Un&&Ei.setFromMatrixPosition(Ft.matrixWorld).applyMatrix4(Nr),un=ot.update(Ft);var sn=Ft.material;if(Array.isArray(sn))for(var Zn=un.groups,or=0,mr=Zn.length;or<mr;or++){var ii=Zn[or],Br=sn[ii.materialIndex];Br&&Br.visible&&Q.push(Ft,un,Br,Fn,Ei.z,ii)}else sn.visible&&Q.push(Ft,un,sn,Fn,Ei.z,null)}}var Io=Ft.children;for(or=0,mr=Io.length;or<mr;or++)vn(Io[or],tn,Fn,Un)}}(De,Xe,0,Mt.sortObjects),Mt.sortObjects===!0&&Q.sort(dt,_n),vi&&Pr.beginShadows();var bt=re.state.shadowsArray;ta.render(bt,De,Xe),re.setupLights(Xe),vi&&Pr.endShadows(),this.info.autoReset&&this.info.reset(),Je!==void 0&&this.setRenderTarget(Je),ei.enabled&&$i.isAvailable()&&$i.attachCamera(Xe),Dt.render(Q,De,Xe,ht);var pn=Q.opaque,fn=Q.transparent;if(De.overrideMaterial){var ln=De.overrideMaterial;pn.length&&ru(pn,De,Xe,ln),fn.length&&ru(fn,De,Xe,ln)}else pn.length&&ru(pn,De,Xe),fn.length&&ru(fn,De,Xe);De.onAfterRender(Mt,De,Xe),Vn!==null&&(Ge.updateRenderTargetMipmap(Vn),Ge.updateMultisampleRenderTarget(Vn)),ye.buffers.depth.setTest(!0),ye.buffers.depth.setMask(!0),ye.buffers.color.setMask(!0),ye.setPolygonOffset(!1),ei.enabled&&$i.isAvailable()&&$i.detachCamera(Xe),re=Q=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.mxRenderObject=function(De,Xe,Je,ht,bt){iu(De,Xe,Je,ot.update(De),ht,bt)},this.setFramebuffer=function(De){Mn!==De&&Vn===null&&z.bindFramebuffer(36160,De),Mn=De},this.getActiveCubeFace=function(){return Yn},this.getActiveMipmapLevel=function(){return qn},this.getRenderTarget=function(){return Vn},this.setRenderTarget=function(De,Xe,Je){Yn=Xe,qn=Je,(Vn=De)&&Le.get(De).__webglFramebuffer===void 0&&Ge.setupRenderTarget(De);var ht=Mn,bt=!1;if(De){var pn=Le.get(De).__webglFramebuffer;De.isWebGLCubeRenderTarget?(ht=pn[Xe||0],bt=!0):ht=De.isWebGLMultisampleRenderTarget?Le.get(De).__webglMultisampledFramebuffer:pn,Ht.copy(De.viewport),rr.copy(De.scissor),Pn=De.scissorTest}else Ht.copy(Cn).multiplyScalar(ur).floor(),rr.copy(ir).multiplyScalar(ur).floor(),Pn=cn;if(cr!==ht&&(z.bindFramebuffer(36160,ht),cr=ht),ye.viewport(Ht),ye.scissor(rr),ye.setScissorTest(Pn),bt){var fn=Le.get(De.texture);z.framebufferTexture2D(36160,36064,34069+(Xe||0),fn.__webglTexture,Je||0)}},this.readRenderTargetPixels=function(De,Xe,Je,ht,bt,pn,fn){if(De&&De.isWebGLRenderTarget){var ln=Le.get(De).__webglFramebuffer;if(De.isWebGLCubeRenderTarget&&fn!==void 0&&(ln=ln[fn]),ln){var vn=!1;ln!==cr&&(z.bindFramebuffer(36160,ln),vn=!0);try{var Ft=De.texture,tn=Ft.format,Fn=Ft.type;if(tn!==Or&&Ct.convert(tn)!==z.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(Fn===kr||Ct.convert(Fn)===z.getParameter(35738)||Fn===Ot&&(me.isWebGL2||ue.get("OES_texture_float")||ue.get("WEBGL_color_buffer_float"))||Fn===$t&&(me.isWebGL2?ue.get("EXT_color_buffer_float"):ue.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");z.checkFramebufferStatus(36160)===36053?0<=Xe&&Xe<=De.width-ht&&0<=Je&&Je<=De.height-bt&&z.readPixels(Xe,Je,ht,bt,Ct.convert(tn),Ct.convert(Fn),pn):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{vn&&z.bindFramebuffer(36160,cr)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(De,Xe,Je){Je===void 0&&(Je=0);var ht=Math.pow(2,-Je),bt=Math.floor(Xe.image.width*ht),pn=Math.floor(Xe.image.height*ht),fn=Ct.convert(Xe.format);Ge.setTexture2D(Xe,0),z.copyTexImage2D(3553,Je,fn,De.x,De.y,bt,pn,0),ye.unbindTexture()},this.copyTextureToTexture=function(De,Xe,Je,ht){var bt=Xe.image.width,pn=Xe.image.height,fn=Ct.convert(Je.format),ln=Ct.convert(Je.type);Ge.setTexture2D(Je,0),Xe.isDataTexture?z.texSubImage2D(3553,ht||0,De.x,De.y,bt,pn,fn,ln,Xe.image.data):z.texSubImage2D(3553,ht||0,De.x,De.y,fn,ln,Xe.image),ye.unbindTexture()},this.initTexture=function(De){Ge.setTexture2D(De,0),ye.unbindTexture()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function da(e,t){this.name="",this.color=new $e(e),this.density=t!==void 0?t:25e-5}function Xa(e,t,n){this.name="",this.color=new $e(e),this.near=t!==void 0?t:1,this.far=n!==void 0?n:1e3}function Ya(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Wr,this.updateRange={offset:0,count:-1},this.version=0}pc.prototype=Object.assign(Object.create(qi.prototype),{constructor:pc,isWebGLMultiviewRenderTarget:!0,copy:function(e){return qi.prototype.copy.call(this,e),this.numViews=e.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}}),fc.prototype=Object.assign(Object.create(Ii.prototype),{constructor:fc,isArrayCamera:!0}),rl.prototype=Object.assign(Object.create(Pt.prototype),{constructor:rl,isGroup:!0}),Object.assign(mc.prototype,ko.prototype),Object.assign(da.prototype,{isFogExp2:!0,clone:function(){return new da(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Xa.prototype,{isFog:!0,clone:function(){return new Xa(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Ya.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.assign(Ya.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,c=this.stride;i<c;i++)this.array[e+i]=t.array[n+i];return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});var Nl,il=new Ae;function gc(e,t,n,i){this.data=e,this.itemSize=t,this.offset=n,this.normalized=i===!0}function ol(e){It.call(this),this.type="SpriteMaterial",this.color=new $e(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(gc.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(gc.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,n=this.data.count;t<n;t++)il.x=this.getX(t),il.y=this.getY(t),il.z=this.getZ(t),il.applyMatrix4(e),this.setXYZ(t,il.x,il.y,il.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this},setXYZW:function(e,t,n,i,c){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=c,this}}),((ol.prototype=Object.create(It.prototype)).constructor=ol).prototype.isSpriteMaterial=!0,ol.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var Bl=new Ae,al=new Ae,sl=new Ae,Fl=new zt,yc=new zt,sd=new fr,Vo=new Ae,vc=new Ae,xc=new Ae,ld=new zt,wc=new zt,cd=new zt;function bc(e){if(Pt.call(this),this.type="Sprite",Nl===void 0){Nl=new Dn;var t=new Ya(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Nl.setIndex([0,1,2,0,2,3]),Nl.setAttribute("position",new gc(t,3,0,!1)),Nl.setAttribute("uv",new gc(t,2,3,!1))}this.geometry=Nl,this.material=e!==void 0?e:new ol,this.center=new zt(.5,.5)}function Du(e,t,n,i,c,d){Fl.subVectors(e,n).addScalar(.5).multiply(i),c!==void 0?(yc.x=d*Fl.x-c*Fl.y,yc.y=c*Fl.x+d*Fl.y):yc.copy(Fl),e.copy(t),e.x+=yc.x,e.y+=yc.y,e.applyMatrix4(sd)}bc.prototype=Object.assign(Object.create(Pt.prototype),{constructor:bc,isSprite:!0,raycast:function(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),al.setFromMatrixScale(this.matrixWorld),sd.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),sl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&al.multiplyScalar(-sl.z);var n,i,c=this.material.rotation;c!==0&&(i=Math.cos(c),n=Math.sin(c));var d=this.center;Du(Vo.set(-.5,-.5,0),sl,d,al,n,i),Du(vc.set(.5,-.5,0),sl,d,al,n,i),Du(xc.set(.5,.5,0),sl,d,al,n,i),ld.set(0,0),wc.set(1,0),cd.set(1,1);var m=e.ray.intersectTriangle(Vo,vc,xc,!1,Bl);if(m!==null||(Du(vc.set(-.5,.5,0),sl,d,al,n,i),wc.set(0,1),(m=e.ray.intersectTriangle(Vo,xc,vc,!1,Bl))!==null)){var x=e.ray.origin.distanceTo(Bl);x<e.near||x>e.far||t.push({distance:x,point:Bl.clone(),uv:Ri.getUV(Bl,Vo,vc,xc,ld,wc,cd,new zt),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return Pt.prototype.copy.call(this,e),e.center!==void 0&&this.center.copy(e.center),this}});var Vl=new Ae,Ah=new Ae;function Mc(){Pt.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function _c(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),_i.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new fr,this.bindMatrixInverse=new fr}Mc.prototype=Object.assign(Object.create(Pt.prototype),{constructor:Mc,isLOD:!0,copy:function(e){Pt.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,i=t.length;n<i;n++){var c=t[n];this.addLevel(c.object.clone(),c.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){t===void 0&&(t=0),t=Math.abs(t);for(var n=this.levels,i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){var t=this.levels;if(0<t.length){for(var n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(0<this.levels.length){Vl.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(Vl);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(1<t.length){Vl.setFromMatrixPosition(e.matrixWorld),Ah.setFromMatrixPosition(this.matrixWorld);var n=Vl.distanceTo(Ah);t[0].object.visible=!0;for(var i=1,c=t.length;i<c&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(;i<c;i++)t[i].object.visible=!1}},toJSON:function(e){var t=Pt.prototype.toJSON.call(this,e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];for(var n=this.levels,i=0,c=n.length;i<c;i++){var d=n[i];t.object.levels.push({object:d.object.uuid,distance:d.distance})}return t}}),_c.prototype=Object.assign(Object.create(_i.prototype),{constructor:_c,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new Jr,t=this.geometry.attributes.skinWeight,n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var c=1/e.manhattanLength();c!=1/0?e.multiplyScalar(c):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){_i.prototype.updateMatrixWorld.call(this,e),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var ud=new fr,Xd=new fr;function Eu(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,t===void 0)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new fr)}}function Rh(){Pt.call(this),this.type="Bone"}Object.assign(Eu.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new fr;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n;for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture,c=0,d=e.length;c<d;c++){var m=e[c]?e[c].matrixWorld:Xd;ud.multiplyMatrices(m,t[c]),ud.toArray(n,16*c)}i!==void 0&&(i.needsUpdate=!0)},clone:function(){return new Eu(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var i=this.bones[t];if(i.name===e)return i}}}),Rh.prototype=Object.assign(Object.create(Pt.prototype),{constructor:Rh,isBone:!0});var Lh=new fr,Tc=new fr,Gl=[],Cc=new _i;function Pu(e,t,n){_i.call(this,e,t),this.instanceMatrix=new en(new Float32Array(16*n),16),this.count=n,this.frustumCulled=!1}function ki(e){It.call(this),this.type="LineBasicMaterial",this.color=new $e(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}Pu.prototype=Object.assign(Object.create(_i.prototype),{constructor:Pu,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var n=this.matrixWorld,i=this.count;if(Cc.geometry=this.geometry,Cc.material=this.material,Cc.material!==void 0)for(var c=0;c<i;c++)this.getMatrixAt(c,Lh),Tc.multiplyMatrices(n,Lh),Cc.matrixWorld=Tc,Cc.raycast(e,Gl),0<Gl.length&&(Gl[0].instanceId=c,Gl[0].object=this,t.push(Gl[0]),Gl.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),((ki.prototype=Object.create(It.prototype)).constructor=ki).prototype.isLineBasicMaterial=!0,ki.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var Ih=new Ae,kh=new Ae,hd=new fr,Ou=new Ar,Au=new Kr;function Lo(e,t,n){n===1&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Pt.call(this),this.type="Line",this.geometry=e!==void 0?e:new Dn,this.material=t!==void 0?t:new ki}Lo.prototype=Object.assign(Object.create(Pt.prototype),{constructor:Lo,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(e.index===null){for(var t=e.attributes.position,n=[0],i=1,c=t.count;i<c;i++)Ih.fromBufferAttribute(t,i-1),kh.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=Ih.distanceTo(kh);e.setAttribute("lineDistance",new on(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var d=e.vertices;for((n=e.lineDistances)[0]=0,i=1,c=d.length;i<c;i++)n[i]=n[i-1],n[i]+=d[i-1].distanceTo(d[i])}return this},raycast:function(e,t){var n=e.linePrecision,i=this.geometry,c=this.matrixWorld;if(i.boundingSphere===null&&i.computeBoundingSphere(),Au.copy(i.boundingSphere),Au.applyMatrix4(c),Au.radius+=n,e.ray.intersectsSphere(Au)!==!1){hd.getInverse(c),Ou.copy(e.ray).applyMatrix4(hd);var d=n/((this.scale.x+this.scale.y+this.scale.z)/3),m=d*d,x=new Ae,A=new Ae,I=new Ae,X=new Ae,Q=this&&this.isLineSegments?2:1;if(i.isBufferGeometry){var re=i.index,z=i.attributes.position.array;if(re!==null)for(var ue=re.array,me=0,ye=ue.length-1;me<ye;me+=Q){var Pe=ue[me],Le=ue[me+1];x.fromArray(z,3*Pe),A.fromArray(z,3*Le),m<Ou.distanceSqToSegment(x,A,X,I)||(X.applyMatrix4(this.matrixWorld),(Ve=e.ray.origin.distanceTo(X))<e.near||Ve>e.far||t.push({distance:Ve,point:I.clone().applyMatrix4(this.matrixWorld),index:me,face:null,faceIndex:null,object:this}))}else for(me=0,ye=z.length/3-1;me<ye;me+=Q)x.fromArray(z,3*me),A.fromArray(z,3*me+3),m<Ou.distanceSqToSegment(x,A,X,I)||(X.applyMatrix4(this.matrixWorld),(Ve=e.ray.origin.distanceTo(X))<e.near||Ve>e.far||t.push({distance:Ve,point:I.clone().applyMatrix4(this.matrixWorld),index:me,face:null,faceIndex:null,object:this}))}else if(i.isGeometry){var Ge=i.vertices,Qe=Ge.length;for(me=0;me<Qe-1;me+=Q){var Ve;m<Ou.distanceSqToSegment(Ge[me],Ge[me+1],X,I)||(X.applyMatrix4(this.matrixWorld),(Ve=e.ray.origin.distanceTo(X))<e.near||Ve>e.far||t.push({distance:Ve,point:I.clone().applyMatrix4(this.matrixWorld),index:me,face:null,faceIndex:null,object:this}))}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ru=new Ae,Lu=new Ae;function fi(e,t){Lo.call(this,e,t),this.type="LineSegments"}function Sc(e,t){Lo.call(this,e,t),this.type="LineLoop"}function Za(e){It.call(this),this.type="PointsMaterial",this.color=new $e(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}fi.prototype=Object.assign(Object.create(Lo.prototype),{constructor:fi,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(e.index===null){for(var t=e.attributes.position,n=[],i=0,c=t.count;i<c;i+=2)Ru.fromBufferAttribute(t,i),Lu.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+Ru.distanceTo(Lu);e.setAttribute("lineDistance",new on(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var d=e.vertices;for(n=e.lineDistances,i=0,c=d.length;i<c;i+=2)Ru.copy(d[i]),Lu.copy(d[i+1]),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+Ru.distanceTo(Lu)}return this}}),Sc.prototype=Object.assign(Object.create(Lo.prototype),{constructor:Sc,isLineLoop:!0}),((Za.prototype=Object.create(It.prototype)).constructor=Za).prototype.isPointsMaterial=!0,Za.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var Iu=new fr,ku=new Ar,Dc=new Kr,ju=new Ae;function zl(e,t){Pt.call(this),this.type="Points",this.geometry=e!==void 0?e:new Dn,this.material=t!==void 0?t:new Za,this.updateMorphTargets()}function Ul(e,t,n,i,c,d,m){var x=ku.distanceSqToPoint(e);if(x<n){var A=new Ae;ku.closestPointToPoint(e,A),A.applyMatrix4(i);var I=c.ray.origin.distanceTo(A);if(I<c.near||I>c.far)return;d.push({distance:I,distanceToRay:Math.sqrt(x),point:A,index:t,face:null,object:m})}}function Hl(e,t,n,i,c,d,m,x,A){Yr.call(this,e,t,n,i,c,d,m,x,A),this.format=m!==void 0?m:Gr,this.minFilter=d!==void 0?d:xn,this.magFilter=c!==void 0?c:xn,this.generateMipmaps=!1}function Nu(e,t,n,i,c,d,m,x,A,I,X,Q){Yr.call(this,null,d,m,x,A,I,i,c,X,Q),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Ec(e,t,n,i,c,d,m,x,A){Yr.call(this,e,t,n,i,c,d,m,x,A),this.needsUpdate=!0}function Bu(e,t,n,i,c,d,m,x,A,I){if((I=I!==void 0?I:gr)!==gr&&I!==Wi)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&I===gr&&(n=lt),n===void 0&&I===Wi&&(n=qr),Yr.call(this,null,i,c,d,m,x,I,n,A),this.image={width:e,height:t},this.magFilter=m!==void 0?m:pt,this.minFilter=x!==void 0?x:pt,this.flipY=!1,this.generateMipmaps=!1}function Pc(e){Dn.call(this),this.type="WireframeGeometry";var t,n,i,c,d,m,x,A,I,X,Q=[],re=[0,0],z={},ue=["a","b","c"];if(e&&e.isGeometry){var me=e.faces;for(t=0,i=me.length;t<i;t++){var ye=me[t];for(n=0;n<3;n++)x=ye[ue[n]],A=ye[ue[(n+1)%3]],re[0]=Math.min(x,A),re[1]=Math.max(x,A),z[I=re[0]+","+re[1]]===void 0&&(z[I]={index1:re[0],index2:re[1]})}for(I in z)m=z[I],X=e.vertices[m.index1],Q.push(X.x,X.y,X.z),X=e.vertices[m.index2],Q.push(X.x,X.y,X.z)}else if(e&&e.isBufferGeometry){var Pe,Le,Ge,Qe,Ve,ot;if(X=new Ae,e.index!==null){for(Pe=e.attributes.position,Le=e.index,(Ge=e.groups).length===0&&(Ge=[{start:0,count:Le.count,materialIndex:0}]),c=0,d=Ge.length;c<d;++c)for(i=(t=(Qe=Ge[c]).start)+Qe.count;t<i;t+=3)for(n=0;n<3;n++)x=Le.getX(t+n),A=Le.getX(t+(n+1)%3),re[0]=Math.min(x,A),re[1]=Math.max(x,A),z[I=re[0]+","+re[1]]===void 0&&(z[I]={index1:re[0],index2:re[1]});for(I in z)m=z[I],X.fromBufferAttribute(Pe,m.index1),Q.push(X.x,X.y,X.z),X.fromBufferAttribute(Pe,m.index2),Q.push(X.x,X.y,X.z)}else for(t=0,i=(Pe=e.attributes.position).count/3;t<i;t++)for(n=0;n<3;n++)Ve=3*t+n,X.fromBufferAttribute(Pe,Ve),Q.push(X.x,X.y,X.z),ot=3*t+(n+1)%3,X.fromBufferAttribute(Pe,ot),Q.push(X.x,X.y,X.z)}this.setAttribute("position",new on(Q,3))}function $o(e,t,n){sr.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new Oc(e,t,n)),this.mergeVertices()}function Oc(e,t,n){Dn.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var i,c,d=[],m=[],x=[],A=[],I=new Ae,X=new Ae,Q=new Ae,re=new Ae,z=new Ae;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var ue=t+1;for(i=0;i<=n;i++){var me=i/n;for(c=0;c<=t;c++){var ye=c/t;e(ye,me,X),m.push(X.x,X.y,X.z),0<=ye-1e-5?(e(ye-1e-5,me,Q),re.subVectors(X,Q)):(e(1e-5+ye,me,Q),re.subVectors(Q,X)),0<=me-1e-5?(e(ye,me-1e-5,Q),z.subVectors(X,Q)):(e(ye,1e-5+me,Q),z.subVectors(Q,X)),I.crossVectors(re,z).normalize(),x.push(I.x,I.y,I.z),A.push(ye,me)}}for(i=0;i<n;i++)for(c=0;c<t;c++){var Pe=i*ue+c,Le=i*ue+c+1,Ge=(i+1)*ue+c+1,Qe=(i+1)*ue+c;d.push(Pe,Le,Qe),d.push(Le,Ge,Qe)}this.setIndex(d),this.setAttribute("position",new on(m,3)),this.setAttribute("normal",new on(x,3)),this.setAttribute("uv",new on(A,2))}function Fu(e,t,n,i){sr.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},this.fromBufferGeometry(new ro(e,t,n,i)),this.mergeVertices()}function ro(e,t,n,i){Dn.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},n=n||1;var c=[],d=[];function m(Q,re,z,ue){var me,ye,Pe=Math.pow(2,ue),Le=[];for(me=0;me<=Pe;me++){Le[me]=[];var Ge=Q.clone().lerp(z,me/Pe),Qe=re.clone().lerp(z,me/Pe),Ve=Pe-me;for(ye=0;ye<=Ve;ye++)Le[me][ye]=ye===0&&me===Pe?Ge:Ge.clone().lerp(Qe,ye/Ve)}for(me=0;me<Pe;me++)for(ye=0;ye<2*(Pe-me)-1;ye++){var ot=Math.floor(ye/2);ye%2==0?(x(Le[me][ot+1]),x(Le[me+1][ot]),x(Le[me][ot])):(x(Le[me][ot+1]),x(Le[me+1][ot+1]),x(Le[me+1][ot]))}}function x(Q){c.push(Q.x,Q.y,Q.z)}function A(Q,re){var z=3*Q;re.x=e[0+z],re.y=e[1+z],re.z=e[2+z]}function I(Q,re,z,ue){ue<0&&Q.x===1&&(d[re]=Q.x-1),z.x===0&&z.z===0&&(d[re]=ue/2/Math.PI+.5)}function X(Q){return Math.atan2(Q.z,-Q.x)}(function(Q){for(var re=new Ae,z=new Ae,ue=new Ae,me=0;me<t.length;me+=3)A(t[me+0],re),A(t[me+1],z),A(t[me+2],ue),m(re,z,ue,Q)})(i=i||0),function(Q){for(var re=new Ae,z=0;z<c.length;z+=3)re.x=c[z+0],re.y=c[z+1],re.z=c[z+2],re.normalize().multiplyScalar(Q),c[z+0]=re.x,c[z+1]=re.y,c[z+2]=re.z}(n),function(){for(var Q=new Ae,re=0;re<c.length;re+=3){Q.x=c[re+0],Q.y=c[re+1],Q.z=c[re+2];var z=X(Q)/2/Math.PI+.5,ue=(me=Q,Math.atan2(-me.y,Math.sqrt(me.x*me.x+me.z*me.z))/Math.PI+.5);d.push(z,1-ue)}var me;(function(){for(var ye=new Ae,Pe=new Ae,Le=new Ae,Ge=new Ae,Qe=new zt,Ve=new zt,ot=new zt,We=0,vt=0;We<c.length;We+=9,vt+=6){ye.set(c[We+0],c[We+1],c[We+2]),Pe.set(c[We+3],c[We+4],c[We+5]),Le.set(c[We+6],c[We+7],c[We+8]),Qe.set(d[vt+0],d[vt+1]),Ve.set(d[vt+2],d[vt+3]),ot.set(d[vt+4],d[vt+5]),Ge.copy(ye).add(Pe).add(Le).divideScalar(3);var _t=X(Ge);I(Qe,vt+0,ye,_t),I(Ve,vt+2,Pe,_t),I(ot,vt+4,Le,_t)}})(),function(){for(var ye=0;ye<d.length;ye+=6){var Pe=d[ye+0],Le=d[ye+2],Ge=d[ye+4],Qe=Math.max(Pe,Le,Ge),Ve=Math.min(Pe,Le,Ge);.9<Qe&&Ve<.1&&(Pe<.2&&(d[ye+0]+=1),Le<.2&&(d[ye+2]+=1),Ge<.2&&(d[ye+4]+=1))}}()}(),this.setAttribute("position",new on(c,3)),this.setAttribute("normal",new on(c.slice(),3)),this.setAttribute("uv",new on(d,2)),i===0?this.computeVertexNormals():this.normalizeNormals()}function yr(e,t){sr.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ac(e,t)),this.mergeVertices()}function Ac(e,t){ro.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Do(e,t){sr.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new mi(e,t)),this.mergeVertices()}function mi(e,t){ro.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ra(e,t){sr.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Rc(e,t)),this.mergeVertices()}function Rc(e,t){var n=(1+Math.sqrt(5))/2;ro.call(this,[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Wl(e,t){sr.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new pa(e,t)),this.mergeVertices()}function pa(e,t){var n=(1+Math.sqrt(5))/2,i=1/n;ro.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Lc(e,t,n,i,c,d){sr.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:c},d!==void 0&&console.warn("THREE.TubeGeometry: taper has been removed.");var m=new Os(e,t,n,i,c);this.tangents=m.tangents,this.normals=m.normals,this.binormals=m.binormals,this.fromBufferGeometry(m),this.mergeVertices()}function Os(e,t,n,i,c){Dn.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:c},t=t||64,n=n||1,i=i||8,c=c||!1;var d=e.computeFrenetFrames(t,c);this.tangents=d.tangents,this.normals=d.normals,this.binormals=d.binormals;var m,x,A=new Ae,I=new Ae,X=new zt,Q=new Ae,re=[],z=[],ue=[],me=[];function ye(Pe){Q=e.getPointAt(Pe/t,Q);var Le=d.normals[Pe],Ge=d.binormals[Pe];for(x=0;x<=i;x++){var Qe=x/i*Math.PI*2,Ve=Math.sin(Qe),ot=-Math.cos(Qe);I.x=ot*Le.x+Ve*Ge.x,I.y=ot*Le.y+Ve*Ge.y,I.z=ot*Le.z+Ve*Ge.z,I.normalize(),z.push(I.x,I.y,I.z),A.x=Q.x+n*I.x,A.y=Q.y+n*I.y,A.z=Q.z+n*I.z,re.push(A.x,A.y,A.z)}}(function(){for(m=0;m<t;m++)ye(m);ye(c===!1?t:0),function(){for(m=0;m<=t;m++)for(x=0;x<=i;x++)X.x=m/t,X.y=x/i,ue.push(X.x,X.y)}(),function(){for(x=1;x<=t;x++)for(m=1;m<=i;m++){var Pe=(i+1)*(x-1)+(m-1),Le=(i+1)*x+(m-1),Ge=(i+1)*x+m,Qe=(i+1)*(x-1)+m;me.push(Pe,Le,Qe),me.push(Le,Ge,Qe)}}()})(),this.setIndex(me),this.setAttribute("position",new on(re,3)),this.setAttribute("normal",new on(z,3)),this.setAttribute("uv",new on(ue,2))}function gi(e,t,n,i,c,d,m){sr.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:c,q:d},m!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new yi(e,t,n,i,c,d)),this.mergeVertices()}function yi(e,t,n,i,c,d){Dn.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:c,q:d},e=e||1,t=t||.4,n=Math.floor(n)||64,i=Math.floor(i)||8,c=c||2,d=d||3;var m,x,A=[],I=[],X=[],Q=[],re=new Ae,z=new Ae,ue=new Ae,me=new Ae,ye=new Ae,Pe=new Ae,Le=new Ae;for(m=0;m<=n;++m){var Ge=m/n*c*Math.PI*2;for(Et(Ge,c,d,e,ue),Et(.01+Ge,c,d,e,me),Pe.subVectors(me,ue),Le.addVectors(me,ue),ye.crossVectors(Pe,Le),Le.crossVectors(ye,Pe),ye.normalize(),Le.normalize(),x=0;x<=i;++x){var Qe=x/i*Math.PI*2,Ve=-t*Math.cos(Qe),ot=t*Math.sin(Qe);re.x=ue.x+(Ve*Le.x+ot*ye.x),re.y=ue.y+(Ve*Le.y+ot*ye.y),re.z=ue.z+(Ve*Le.z+ot*ye.z),I.push(re.x,re.y,re.z),z.subVectors(re,ue).normalize(),X.push(z.x,z.y,z.z),Q.push(m/n),Q.push(x/i)}}for(x=1;x<=n;x++)for(m=1;m<=i;m++){var We=(i+1)*(x-1)+(m-1),vt=(i+1)*x+(m-1),_t=(i+1)*x+m,Dt=(i+1)*(x-1)+m;A.push(We,vt,Dt),A.push(vt,_t,Dt)}function Et(Vt,Kt,Ct,Mt,hn){var Mn=Math.cos(Vt),Yn=Math.sin(Vt),qn=Ct/Kt*Vt,Vn=Math.cos(qn);hn.x=Mt*(2+Vn)*.5*Mn,hn.y=Mt*(2+Vn)*Yn*.5,hn.z=Mt*Math.sin(qn)*.5}this.setIndex(A),this.setAttribute("position",new on(I,3)),this.setAttribute("normal",new on(X,3)),this.setAttribute("uv",new on(Q,2))}function Ic(e,t,n,i,c){sr.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:c},this.fromBufferGeometry(new Jl(e,t,n,i,c)),this.mergeVertices()}function Jl(e,t,n,i,c){Dn.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:c},e=e||1,t=t||.4,n=Math.floor(n)||8,i=Math.floor(i)||6,c=c||2*Math.PI;var d,m,x=[],A=[],I=[],X=[],Q=new Ae,re=new Ae,z=new Ae;for(d=0;d<=n;d++)for(m=0;m<=i;m++){var ue=m/i*c,me=d/n*Math.PI*2;re.x=(e+t*Math.cos(me))*Math.cos(ue),re.y=(e+t*Math.cos(me))*Math.sin(ue),re.z=t*Math.sin(me),A.push(re.x,re.y,re.z),Q.x=e*Math.cos(ue),Q.y=e*Math.sin(ue),z.subVectors(re,Q).normalize(),I.push(z.x,z.y,z.z),X.push(m/i),X.push(d/n)}for(d=1;d<=n;d++)for(m=1;m<=i;m++){var ye=(i+1)*d+m-1,Pe=(i+1)*(d-1)+m-1,Le=(i+1)*(d-1)+m,Ge=(i+1)*d+m;x.push(ye,Pe,Ge),x.push(Pe,Le,Ge)}this.setIndex(x),this.setAttribute("position",new on(A,3)),this.setAttribute("normal",new on(I,3)),this.setAttribute("uv",new on(X,2))}function ql(e,t,n,i,c){var d,m;if(c===0<function(x,A,I,X){for(var Q=0,re=A,z=I-X;re<I;re+=X)Q+=(x[z]-x[re])*(x[re+1]+x[z+1]),z=re;return Q}(e,t,n,i))for(d=t;d<n;d+=i)m=jc(d,e[d],e[d+1],m);else for(d=n-i;t<=d;d-=i)m=jc(d,e[d],e[d+1],m);return m&&As(m,m.next)&&(Nc(m),m=m.next),m}function ll(e,t){if(!e)return e;t=t||e;var n,i=e;do if(n=!1,i.steiner||!As(i,i.next)&&oi(i.prev,i,i.next)!==0)i=i.next;else{if(Nc(i),(i=t=i.prev)===i.next)break;n=!0}while(n||i!==t);return t}function Xl(e,t,n,i,c,d,m){if(e){!m&&d&&function(X,Q,re,z){for(var ue=X;ue.z===null&&(ue.z=La(ue.x,ue.y,Q,re,z)),ue.prevZ=ue.prev,ue.nextZ=ue.next,(ue=ue.next)!==X;);ue.prevZ.nextZ=null,ue.prevZ=null,function(me){var ye,Pe,Le,Ge,Qe,Ve,ot,We,vt=1;do{for(Pe=me,Qe=me=null,Ve=0;Pe;){for(Ve++,Le=Pe,ye=ot=0;ye<vt&&(ot++,Le=Le.nextZ);ye++);for(We=vt;0<ot||0<We&&Le;)ot!==0&&(We===0||!Le||Pe.z<=Le.z)?(Pe=(Ge=Pe).nextZ,ot--):(Le=(Ge=Le).nextZ,We--),Qe?Qe.nextZ=Ge:me=Ge,Ge.prevZ=Qe,Qe=Ge;Pe=Le}Qe.nextZ=null,vt*=2}while(1<Ve)}(ue)}(e,i,c,d);for(var x,A,I=e;e.prev!==e.next;)if(x=e.prev,A=e.next,d?fa(e,i,c,d):Vu(e))t.push(x.i/n),t.push(e.i/n),t.push(A.i/n),Nc(e),e=A.next,I=A.next;else if((e=A)===I){m?m===1?Xl(e=Yl(e,t,n),t,n,i,c,d,2):m===2&&Yd(e,t,n,i,c,d):Xl(ll(e),t,n,i,c,d,1);break}}}function Vu(e){var t=e.prev,n=e,i=e.next;if(!(0<=oi(t,n,i))){for(var c=e.next.next;c!==e.prev;){if(cl(t.x,t.y,n.x,n.y,i.x,i.y,c.x,c.y)&&0<=oi(c.prev,c,c.next))return;c=c.next}return 1}}function fa(e,t,n,i){var c=e.prev,d=e,m=e.next;if(!(0<=oi(c,d,m))){for(var x=c.x<d.x?c.x<m.x?c.x:m.x:d.x<m.x?d.x:m.x,A=c.y<d.y?c.y<m.y?c.y:m.y:d.y<m.y?d.y:m.y,I=c.x>d.x?c.x>m.x?c.x:m.x:d.x>m.x?d.x:m.x,X=c.y>d.y?c.y>m.y?c.y:m.y:d.y>m.y?d.y:m.y,Q=La(x,A,t,n,i),re=La(I,X,t,n,i),z=e.prevZ,ue=e.nextZ;z&&z.z>=Q&&ue&&ue.z<=re;){if(z!==e.prev&&z!==e.next&&cl(c.x,c.y,d.x,d.y,m.x,m.y,z.x,z.y)&&0<=oi(z.prev,z,z.next)||(z=z.prevZ,ue!==e.prev&&ue!==e.next&&cl(c.x,c.y,d.x,d.y,m.x,m.y,ue.x,ue.y)&&0<=oi(ue.prev,ue,ue.next)))return;ue=ue.nextZ}for(;z&&z.z>=Q;){if(z!==e.prev&&z!==e.next&&cl(c.x,c.y,d.x,d.y,m.x,m.y,z.x,z.y)&&0<=oi(z.prev,z,z.next))return;z=z.prevZ}for(;ue&&ue.z<=re;){if(ue!==e.prev&&ue!==e.next&&cl(c.x,c.y,d.x,d.y,m.x,m.y,ue.x,ue.y)&&0<=oi(ue.prev,ue,ue.next))return;ue=ue.nextZ}return 1}}function Yl(e,t,n){var i=e;do{var c=i.prev,d=i.next.next;!As(c,d)&&Qr(c,i,i.next,d)&&kc(c,d)&&kc(d,c)&&(t.push(c.i/n),t.push(i.i/n),t.push(d.i/n),Nc(i),Nc(i.next),i=e=d),i=i.next}while(i!==e);return i}function Yd(e,t,n,i,c,d){var m,x,A=e;do{for(var I=A.next.next;I!==A.prev;){if(A.i!==I.i&&(x=I,(m=A).next.i!==x.i&&m.prev.i!==x.i&&!function(Q,re){var z=Q;do{if(z.i!==Q.i&&z.next.i!==Q.i&&z.i!==re.i&&z.next.i!==re.i&&Qr(z,z.next,Q,re))return 1;z=z.next}while(z!==Q)}(m,x)&&kc(m,x)&&kc(x,m)&&function(Q,re){for(var z=Q,ue=!1,me=(Q.x+re.x)/2,ye=(Q.y+re.y)/2;z.y>ye!=z.next.y>ye&&z.next.y!==z.y&&me<(z.next.x-z.x)*(ye-z.y)/(z.next.y-z.y)+z.x&&(ue=!ue),(z=z.next)!==Q;);return ue}(m,x))){var X=jh(A,I);return A=ll(A,A.next),X=ll(X,X.next),Xl(A,t,n,i,c,d),void Xl(X,t,n,i,c,d)}I=I.next}A=A.next}while(A!==e)}function Zd(e,t){return e.x-t.x}function dd(e,t){if(t=function(i,c){var d,m=c,x=i.x,A=i.y,I=-1/0;do{if(A<=m.y&&A>=m.next.y&&m.next.y!==m.y){var X=m.x+(A-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(X<=x&&I<X){if((I=X)===x){if(A===m.y)return m;if(A===m.next.y)return m.next}d=m.x<m.next.x?m:m.next}}m=m.next}while(m!==c);if(!d)return null;if(x===I)return d.prev;var Q,re=d,z=d.x,ue=d.y,me=1/0;for(m=d.next;m!==re;)x>=m.x&&m.x>=z&&x!==m.x&&cl(A<ue?x:I,A,z,ue,A<ue?I:x,A,m.x,m.y)&&((Q=Math.abs(A-m.y)/(x-m.x))<me||Q===me&&m.x>d.x)&&kc(m,i)&&(d=m,me=Q),m=m.next;return d}(e,t)){var n=jh(t,e);ll(n,n.next)}}function La(e,t,n,i,c){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*c)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*c)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Cr(e){for(var t=e,n=e;(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),(t=t.next)!==e;);return n}function cl(e,t,n,i,c,d,m,x){return 0<=(c-m)*(t-x)-(e-m)*(d-x)&&0<=(e-m)*(i-x)-(n-m)*(t-x)&&0<=(n-m)*(d-x)-(c-m)*(i-x)}function oi(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function As(e,t){return e.x===t.x&&e.y===t.y}function Qr(e,t,n,i){return As(e,n)&&As(t,i)||As(e,i)&&As(n,t)||0<oi(e,t,n)!=0<oi(e,t,i)&&0<oi(n,i,e)!=0<oi(n,i,t)}function kc(e,t){return oi(e.prev,e,e.next)<0?0<=oi(e,t,e.next)&&0<=oi(e,e.prev,t):oi(e,t,e.prev)<0||oi(e,e.next,t)<0}function jh(e,t){var n=new Nh(e.i,e.x,e.y),i=new Nh(t.i,t.x,t.y),c=e.next,d=t.prev;return(e.next=t).prev=e,(n.next=c).prev=n,(i.next=n).prev=i,(d.next=i).prev=d,i}function jc(e,t,n,i){var c=new Nh(e,t,n);return i?(c.next=i.next,(c.prev=i).next.prev=c,i.next=c):(c.prev=c).next=c,c}function Nc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Nh(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}zl.prototype=Object.assign(Object.create(Pt.prototype),{constructor:zl,isPoints:!0,raycast:function(e,t){var n=this.geometry,i=this.matrixWorld,c=e.params.Points.threshold;if(n.boundingSphere===null&&n.computeBoundingSphere(),Dc.copy(n.boundingSphere),Dc.applyMatrix4(i),Dc.radius+=c,e.ray.intersectsSphere(Dc)!==!1){Iu.getInverse(i),ku.copy(e.ray).applyMatrix4(Iu);var d=c/((this.scale.x+this.scale.y+this.scale.z)/3),m=d*d;if(n.isBufferGeometry){var x=n.index,A=n.attributes.position.array;if(x!==null)for(var I=x.array,X=0,Q=I.length;X<Q;X++){var re=I[X];ju.fromArray(A,3*re),Ul(ju,re,m,i,e,t,this)}else{X=0;for(var z=A.length/3;X<z;X++)ju.fromArray(A,3*X),Ul(ju,X,m,i,e,t,this)}}else{var ue=n.vertices;for(X=0,z=ue.length;X<z;X++)Ul(ue[X],X,m,i,e,t,this)}}},updateMorphTargets:function(){var e,t,n,i=this.geometry;if(i.isBufferGeometry){var c=i.morphAttributes,d=Object.keys(c);if(0<d.length){var m=c[d[0]];if(m!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=m.length;e<t;e++)n=m[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var x=i.morphTargets;x!==void 0&&0<x.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Hl.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Hl,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),((Nu.prototype=Object.create(Yr.prototype)).constructor=Nu).prototype.isCompressedTexture=!0,((Ec.prototype=Object.create(Yr.prototype)).constructor=Ec).prototype.isCanvasTexture=!0,((Bu.prototype=Object.create(Yr.prototype)).constructor=Bu).prototype.isDepthTexture=!0,(Pc.prototype=Object.create(Dn.prototype)).constructor=Pc,($o.prototype=Object.create(sr.prototype)).constructor=$o,(Oc.prototype=Object.create(Dn.prototype)).constructor=Oc,(Fu.prototype=Object.create(sr.prototype)).constructor=Fu,(ro.prototype=Object.create(Dn.prototype)).constructor=ro,(yr.prototype=Object.create(sr.prototype)).constructor=yr,(Ac.prototype=Object.create(ro.prototype)).constructor=Ac,(Do.prototype=Object.create(sr.prototype)).constructor=Do,(mi.prototype=Object.create(ro.prototype)).constructor=mi,(Ra.prototype=Object.create(sr.prototype)).constructor=Ra,(Rc.prototype=Object.create(ro.prototype)).constructor=Rc,(Wl.prototype=Object.create(sr.prototype)).constructor=Wl,(pa.prototype=Object.create(ro.prototype)).constructor=pa,(Lc.prototype=Object.create(sr.prototype)).constructor=Lc,((Os.prototype=Object.create(Dn.prototype)).constructor=Os).prototype.toJSON=function(){var e=Dn.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},(gi.prototype=Object.create(sr.prototype)).constructor=gi,(yi.prototype=Object.create(Dn.prototype)).constructor=yi,(Ic.prototype=Object.create(sr.prototype)).constructor=Ic,(Jl.prototype=Object.create(Dn.prototype)).constructor=Jl;var us={area:function(e){for(var t=e.length,n=0,i=t-1,c=0;c<t;i=c++)n+=e[i].x*e[c].y-e[c].x*e[i].y;return .5*n},isClockWise:function(e){return us.area(e)<0},triangulateShape:function(e,t){var n=[],i=[],c=[];pd(e),Gu(n,e);var d=e.length;t.forEach(pd);for(var m=0;m<t.length;m++)i.push(d),d+=t[m].length,Gu(n,t[m]);var x=function(A,I,X){X=X||2;var Q,re,z,ue,me,ye,Pe,Le=I&&I.length,Ge=Le?I[0]*X:A.length,Qe=ql(A,0,Ge,X,!0),Ve=[];if(!Qe||Qe.next===Qe.prev)return Ve;if(Le&&(Qe=function(We,vt,_t,Dt){var Et,Vt,Kt,Ct=[];for(Et=0,Vt=vt.length;Et<Vt;Et++)(Kt=ql(We,vt[Et]*Dt,Et<Vt-1?vt[Et+1]*Dt:We.length,Dt,!1))===Kt.next&&(Kt.steiner=!0),Ct.push(Cr(Kt));for(Ct.sort(Zd),Et=0;Et<Ct.length;Et++)dd(Ct[Et],_t),_t=ll(_t,_t.next);return _t}(A,I,Qe,X)),A.length>80*X){Q=z=A[0],re=ue=A[1];for(var ot=X;ot<Ge;ot+=X)(me=A[ot])<Q&&(Q=me),(ye=A[ot+1])<re&&(re=ye),z<me&&(z=me),ue<ye&&(ue=ye);Pe=(Pe=Math.max(z-Q,ue-re))!==0?1/Pe:0}return Xl(Qe,Ve,X,Q,re,Pe),Ve}(n,i);for(m=0;m<x.length;m+=3)c.push(x.slice(m,m+3));return c}};function pd(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function Gu(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function ul(e,t){sr.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Rs(e,t)),this.mergeVertices()}function Rs(e,t){Dn.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t};for(var n=this,i=[],c=[],d=0,m=(e=Array.isArray(e)?e:[e]).length;d<m;d++)x(e[d]);function x(A){var I=[],X=t.curveSegments!==void 0?t.curveSegments:12,Q=t.steps!==void 0?t.steps:1,re=t.depth!==void 0?t.depth:100,z=t.bevelEnabled===void 0||t.bevelEnabled,ue=t.bevelThickness!==void 0?t.bevelThickness:6,me=t.bevelSize!==void 0?t.bevelSize:ue-2,ye=t.bevelOffset!==void 0?t.bevelOffset:0,Pe=t.bevelSegments!==void 0?t.bevelSegments:3,Le=t.extrudePath,Ge=t.UVGenerator!==void 0?t.UVGenerator:Kd;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),re=t.amount);var Qe,Ve,ot,We,vt,_t,Dt,Et,Vt=!1;Le&&(Qe=Le.getSpacedPoints(Q),z=!(Vt=!0),Ve=Le.computeFrenetFrames(Q,!1),ot=new Ae,We=new Ae,vt=new Ae),z||(ye=me=ue=Pe=0);var Kt=A.extractPoints(X),Ct=Kt.shape,Mt=Kt.holes;if(!us.isClockWise(Ct))for(Ct=Ct.reverse(),Dt=0,Et=Mt.length;Dt<Et;Dt++)_t=Mt[Dt],us.isClockWise(_t)&&(Mt[Dt]=_t.reverse());var hn=us.triangulateShape(Ct,Mt),Mn=Ct;for(Dt=0,Et=Mt.length;Dt<Et;Dt++)_t=Mt[Dt],Ct=Ct.concat(_t);function Yn(Ir,ai,xi){return ai||console.error("THREE.ExtrudeGeometry: vec does not exist"),ai.clone().multiplyScalar(xi).add(Ir)}var qn,Vn,cr,En,ke,et,Yt=Ct.length,Ht=hn.length;function rr(Ir,ai,xi){var oo,ei,$i,ta=Ir.x-ai.x,ga=Ir.y-ai.y,ps=xi.x-Ir.x,Bs=xi.y-Ir.y,nh=ta*ta+ga*ga,kp=ta*Bs-ga*ps;if(Math.abs(kp)>Number.EPSILON){var rh=Math.sqrt(nh),nu=Math.sqrt(ps*ps+Bs*Bs),ru=ai.x-ga/rh,iu=ai.y+ta/rh,ou=((xi.x-Bs/nu-ru)*Bs-(xi.y+ps/nu-iu)*ps)/(ta*Bs-ga*ps),Vh=(oo=ru+ta*ou-Ir.x)*oo+(ei=iu+ga*ou-Ir.y)*ei;if(Vh<=2)return new zt(oo,ei);$i=Math.sqrt(Vh/2)}else{var _a=!1;ta>Number.EPSILON?ps>Number.EPSILON&&(_a=!0):ta<-Number.EPSILON?ps<-Number.EPSILON&&(_a=!0):Math.sign(ga)===Math.sign(Bs)&&(_a=!0),$i=_a?(oo=-ga,ei=ta,Math.sqrt(nh)):(oo=ta,ei=ga,Math.sqrt(nh/2))}return new zt(oo/$i,ei/$i)}for(var Pn=[],St=0,On=Mn.length,ur=On-1,dt=St+1;St<On;St++,ur++,dt++)ur===On&&(ur=0),dt===On&&(dt=0),Pn[St]=rr(Mn[St],Mn[ur],Mn[dt]);var _n,Cn,ir=[],cn=Pn.concat();for(Dt=0,Et=Mt.length;Dt<Et;Dt++){for(_t=Mt[Dt],_n=[],St=0,ur=(On=_t.length)-1,dt=St+1;St<On;St++,ur++,dt++)ur===On&&(ur=0),dt===On&&(dt=0),_n[St]=rr(_t[St],_t[ur],_t[dt]);ir.push(_n),cn=cn.concat(_n)}for(qn=0;qn<Pe;qn++){for(cr=qn/Pe,En=ue*Math.cos(cr*Math.PI/2),Vn=me*Math.sin(cr*Math.PI/2)+ye,St=0,On=Mn.length;St<On;St++)Pr((ke=Yn(Mn[St],Pn[St],Vn)).x,ke.y,-En);for(Dt=0,Et=Mt.length;Dt<Et;Dt++)for(_t=Mt[Dt],_n=ir[Dt],St=0,On=_t.length;St<On;St++)Pr((ke=Yn(_t[St],_n[St],Vn)).x,ke.y,-En)}for(Vn=me+ye,St=0;St<Yt;St++)ke=z?Yn(Ct[St],cn[St],Vn):Ct[St],Vt?(We.copy(Ve.normals[0]).multiplyScalar(ke.x),ot.copy(Ve.binormals[0]).multiplyScalar(ke.y),vt.copy(Qe[0]).add(We).add(ot),Pr(vt.x,vt.y,vt.z)):Pr(ke.x,ke.y,0);for(Cn=1;Cn<=Q;Cn++)for(St=0;St<Yt;St++)ke=z?Yn(Ct[St],cn[St],Vn):Ct[St],Vt?(We.copy(Ve.normals[Cn]).multiplyScalar(ke.x),ot.copy(Ve.binormals[Cn]).multiplyScalar(ke.y),vt.copy(Qe[Cn]).add(We).add(ot),Pr(vt.x,vt.y,vt.z)):Pr(ke.x,ke.y,re/Q*Cn);for(qn=Pe-1;0<=qn;qn--){for(cr=qn/Pe,En=ue*Math.cos(cr*Math.PI/2),Vn=me*Math.sin(cr*Math.PI/2)+ye,St=0,On=Mn.length;St<On;St++)Pr((ke=Yn(Mn[St],Pn[St],Vn)).x,ke.y,re+En);for(Dt=0,Et=Mt.length;Dt<Et;Dt++)for(_t=Mt[Dt],_n=ir[Dt],St=0,On=_t.length;St<On;St++)ke=Yn(_t[St],_n[St],Vn),Vt?Pr(ke.x,ke.y+Qe[Q-1].y,Qe[Q-1].x+En):Pr(ke.x,ke.y,re+En)}function br(Ir,ai){var xi,oo;for(St=Ir.length;0<=--St;){(oo=(xi=St)-1)<0&&(oo=Ir.length-1);var ei=0,$i=Q+2*Pe;for(ei=0;ei<$i;ei++){var ta=Yt*ei,ga=Yt*(ei+1);ma(ai+xi+ta,ai+oo+ta,ai+oo+ga,ai+xi+ga)}}}function Pr(Ir,ai,xi){I.push(Ir),I.push(ai),I.push(xi)}function vi(Ir,ai,xi){Nr(Ir),Nr(ai),Nr(xi);var oo=i.length/3,ei=Ge.generateTopUV(n,i,oo-3,oo-2,oo-1);Ei(ei[0]),Ei(ei[1]),Ei(ei[2])}function ma(Ir,ai,xi,oo){Nr(Ir),Nr(ai),Nr(oo),Nr(ai),Nr(xi),Nr(oo);var ei=i.length/3,$i=Ge.generateSideWallUV(n,i,ei-6,ei-3,ei-2,ei-1);Ei($i[0]),Ei($i[1]),Ei($i[3]),Ei($i[1]),Ei($i[2]),Ei($i[3])}function Nr(Ir){i.push(I[3*Ir+0]),i.push(I[3*Ir+1]),i.push(I[3*Ir+2])}function Ei(Ir){c.push(Ir.x),c.push(Ir.y)}(function(){var Ir=i.length/3;if(z){var ai=0,xi=Yt*ai;for(St=0;St<Ht;St++)vi((et=hn[St])[2]+xi,et[1]+xi,et[0]+xi);for(xi=Yt*(ai=Q+2*Pe),St=0;St<Ht;St++)vi((et=hn[St])[0]+xi,et[1]+xi,et[2]+xi)}else{for(St=0;St<Ht;St++)vi((et=hn[St])[2],et[1],et[0]);for(St=0;St<Ht;St++)vi((et=hn[St])[0]+Yt*Q,et[1]+Yt*Q,et[2]+Yt*Q)}n.addGroup(Ir,i.length/3-Ir,0)})(),function(){var Ir=i.length/3,ai=0;for(br(Mn,ai),ai+=Mn.length,Dt=0,Et=Mt.length;Dt<Et;Dt++)br(_t=Mt[Dt],ai),ai+=_t.length;n.addGroup(Ir,i.length/3-Ir,1)}()}this.setAttribute("position",new on(i,3)),this.setAttribute("uv",new on(c,2)),this.computeVertexNormals()}((ul.prototype=Object.create(sr.prototype)).constructor=ul).prototype.toJSON=function(){var e=sr.prototype.toJSON.call(this);return fd(this.parameters.shapes,this.parameters.options,e)},((Rs.prototype=Object.create(Dn.prototype)).constructor=Rs).prototype.toJSON=function(){var e=Dn.prototype.toJSON.call(this);return fd(this.parameters.shapes,this.parameters.options,e)};var Kd={generateTopUV:function(e,t,n,i,c){var d=t[3*n],m=t[3*n+1],x=t[3*i],A=t[3*i+1],I=t[3*c],X=t[3*c+1];return[new zt(d,m),new zt(x,A),new zt(I,X)]},generateSideWallUV:function(e,t,n,i,c,d){var m=t[3*n],x=t[3*n+1],A=t[3*n+2],I=t[3*i],X=t[3*i+1],Q=t[3*i+2],re=t[3*c],z=t[3*c+1],ue=t[3*c+2],me=t[3*d],ye=t[3*d+1],Pe=t[3*d+2];return Math.abs(x-X)<.01?[new zt(m,1-A),new zt(I,1-Q),new zt(re,1-ue),new zt(me,1-Pe)]:[new zt(x,1-A),new zt(X,1-Q),new zt(z,1-ue),new zt(ye,1-Pe)]}};function fd(e,t,n){if(n.shapes=[],Array.isArray(e))for(var i=0,c=e.length;i<c;i++){var d=e[i];n.shapes.push(d.uuid)}else n.shapes.push(e.uuid);return t.extrudePath!==void 0&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function Ui(e,t){sr.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new fo(e,t)),this.mergeVertices()}function fo(e,t){var n=(t=t||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new sr;var i=n.generateShapes(e,t.size);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),Rs.call(this,i,t),this.type="TextBufferGeometry"}function zu(e,t,n,i,c,d,m){sr.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:c,thetaStart:d,thetaLength:m},this.fromBufferGeometry(new hl(e,t,n,i,c,d,m)),this.mergeVertices()}function hl(e,t,n,i,c,d,m){Dn.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:c,thetaStart:d,thetaLength:m},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=i!==void 0?i:0,c=c!==void 0?c:2*Math.PI,d=d!==void 0?d:0,m=m!==void 0?m:Math.PI;var x,A,I=Math.min(d+m,Math.PI),X=0,Q=[],re=new Ae,z=new Ae,ue=[],me=[],ye=[],Pe=[];for(A=0;A<=n;A++){var Le=[],Ge=A/n,Qe=0;for(A==0&&d==0?Qe=.5/t:A==n&&I==Math.PI&&(Qe=-.5/t),x=0;x<=t;x++){var Ve=x/t;re.x=-e*Math.cos(i+Ve*c)*Math.sin(d+Ge*m),re.y=e*Math.cos(d+Ge*m),re.z=e*Math.sin(i+Ve*c)*Math.sin(d+Ge*m),me.push(re.x,re.y,re.z),z.copy(re).normalize(),ye.push(z.x,z.y,z.z),Pe.push(Ve+Qe,1-Ge),Le.push(X++)}Q.push(Le)}for(A=0;A<n;A++)for(x=0;x<t;x++){var ot=Q[A][x+1],We=Q[A][x],vt=Q[A+1][x],_t=Q[A+1][x+1];(A!==0||0<d)&&ue.push(ot,We,_t),(A!==n-1||I<Math.PI)&&ue.push(We,vt,_t)}this.setIndex(ue),this.setAttribute("position",new on(me,3)),this.setAttribute("normal",new on(ye,3)),this.setAttribute("uv",new on(Pe,2))}function Uu(e,t,n,i,c,d){sr.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:c,thetaLength:d},this.fromBufferGeometry(new Bc(e,t,n,i,c,d)),this.mergeVertices()}function Bc(e,t,n,i,c,d){Dn.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:c,thetaLength:d},e=e||.5,t=t||1,c=c!==void 0?c:0,d=d!==void 0?d:2*Math.PI,n=n!==void 0?Math.max(3,n):8;var m,x,A,I=[],X=[],Q=[],re=[],z=e,ue=(t-e)/(i=i!==void 0?Math.max(1,i):1),me=new Ae,ye=new zt;for(x=0;x<=i;x++){for(A=0;A<=n;A++)m=c+A/n*d,me.x=z*Math.cos(m),me.y=z*Math.sin(m),X.push(me.x,me.y,me.z),Q.push(0,0,1),ye.x=(me.x/t+1)/2,ye.y=(me.y/t+1)/2,re.push(ye.x,ye.y);z+=ue}for(x=0;x<i;x++){var Pe=x*(n+1);for(A=0;A<n;A++){var Le=m=A+Pe,Ge=m+n+1,Qe=m+n+2,Ve=m+1;I.push(Le,Ge,Ve),I.push(Ge,Qe,Ve)}}this.setIndex(I),this.setAttribute("position",new on(X,3)),this.setAttribute("normal",new on(Q,3)),this.setAttribute("uv",new on(re,2))}function Fc(e,t,n,i){sr.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},this.fromBufferGeometry(new Zl(e,t,n,i)),this.mergeVertices()}function Zl(e,t,n,i){Dn.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t)||12,n=n||0,i=i||2*Math.PI,i=vr.clamp(i,0,2*Math.PI);var c,d,m,x=[],A=[],I=[],X=1/t,Q=new Ae,re=new zt;for(d=0;d<=t;d++){var z=n+d*X*i,ue=Math.sin(z),me=Math.cos(z);for(m=0;m<=e.length-1;m++)Q.x=e[m].x*ue,Q.y=e[m].y,Q.z=e[m].x*me,A.push(Q.x,Q.y,Q.z),re.x=d/t,re.y=m/(e.length-1),I.push(re.x,re.y)}for(d=0;d<t;d++)for(m=0;m<e.length-1;m++){var ye=c=m+d*e.length,Pe=c+e.length,Le=c+e.length+1,Ge=c+1;x.push(ye,Pe,Ge),x.push(Pe,Le,Ge)}if(this.setIndex(x),this.setAttribute("position",new on(A,3)),this.setAttribute("uv",new on(I,2)),this.computeVertexNormals(),i===2*Math.PI){var Qe=this.attributes.normal.array,Ve=new Ae,ot=new Ae,We=new Ae;for(c=t*e.length*3,m=d=0;d<e.length;d++,m+=3)Ve.x=Qe[m+0],Ve.y=Qe[m+1],Ve.z=Qe[m+2],ot.x=Qe[c+m+0],ot.y=Qe[c+m+1],ot.z=Qe[c+m+2],We.addVectors(Ve,ot).normalize(),Qe[m+0]=Qe[c+m+0]=We.x,Qe[m+1]=Qe[c+m+1]=We.y,Qe[m+2]=Qe[c+m+2]=We.z}}function Kl(e,t){sr.call(this),this.type="ShapeGeometry",typeof t=="object"&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Ka(e,t)),this.mergeVertices()}function Ka(e,t){Dn.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var n=[],i=[],c=[],d=[],m=0,x=0;if(Array.isArray(e)===!1)I(e);else for(var A=0;A<e.length;A++)I(e[A]),this.addGroup(m,x,A),m+=x,x=0;function I(X){var Q,re,z,ue=i.length/3,me=X.extractPoints(t),ye=me.shape,Pe=me.holes;for(us.isClockWise(ye)===!1&&(ye=ye.reverse()),Q=0,re=Pe.length;Q<re;Q++)z=Pe[Q],us.isClockWise(z)===!0&&(Pe[Q]=z.reverse());var Le=us.triangulateShape(ye,Pe);for(Q=0,re=Pe.length;Q<re;Q++)z=Pe[Q],ye=ye.concat(z);for(Q=0,re=ye.length;Q<re;Q++){var Ge=ye[Q];i.push(Ge.x,Ge.y,0),c.push(0,0,1),d.push(Ge.x,Ge.y)}for(Q=0,re=Le.length;Q<re;Q++){var Qe=Le[Q],Ve=Qe[0]+ue,ot=Qe[1]+ue,We=Qe[2]+ue;n.push(Ve,ot,We),x+=3}}this.setIndex(n),this.setAttribute("position",new on(i,3)),this.setAttribute("normal",new on(c,3)),this.setAttribute("uv",new on(d,2))}function md(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var c=e[n];t.shapes.push(c.uuid)}else t.shapes.push(e.uuid);return t}function $l(e,t){Dn.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=t!==void 0?t:1;var n,i,c,d,m=[],x=Math.cos(vr.DEG2RAD*t),A=[0,0],I={},X=["a","b","c"];e.isBufferGeometry?(d=new sr).fromBufferGeometry(e):d=e.clone(),d.mergeVertices(),d.computeFaceNormals();for(var Q=d.vertices,re=d.faces,z=0,ue=re.length;z<ue;z++)for(var me=re[z],ye=0;ye<3;ye++)n=me[X[ye]],i=me[X[(ye+1)%3]],A[0]=Math.min(n,i),A[1]=Math.max(n,i),I[c=A[0]+","+A[1]]===void 0?I[c]={index1:A[0],index2:A[1],face1:z,face2:void 0}:I[c].face2=z;for(c in I){var Pe=I[c];if(Pe.face2===void 0||re[Pe.face1].normal.dot(re[Pe.face2].normal)<=x){var Le=Q[Pe.index1];m.push(Le.x,Le.y,Le.z),Le=Q[Pe.index2],m.push(Le.x,Le.y,Le.z)}}this.setAttribute("position",new on(m,3))}function dl(e,t,n,i,c,d,m,x){sr.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:c,openEnded:d,thetaStart:m,thetaLength:x},this.fromBufferGeometry(new Ls(e,t,n,i,c,d,m,x)),this.mergeVertices()}function Ls(e,t,n,i,c,d,m,x){Dn.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:c,openEnded:d,thetaStart:m,thetaLength:x};var A=this;e=e!==void 0?e:1,t=t!==void 0?t:1,n=n||1,i=Math.floor(i)||8,c=Math.floor(c)||1,d=d!==void 0&&d,m=m!==void 0?m:0,x=x!==void 0?x:2*Math.PI;var I=[],X=[],Q=[],re=[],z=0,ue=[],me=n/2,ye=0;function Pe(Le){var Ge,Qe,Ve,ot=new zt,We=new Ae,vt=0,_t=Le===!0?e:t,Dt=Le===!0?1:-1;for(Qe=z,Ge=1;Ge<=i;Ge++)X.push(0,me*Dt,0),Q.push(0,Dt,0),re.push(.5,.5),z++;for(Ve=z,Ge=0;Ge<=i;Ge++){var Et=Ge/i*x+m,Vt=Math.cos(Et),Kt=Math.sin(Et);We.x=_t*Kt,We.y=me*Dt,We.z=_t*Vt,X.push(We.x,We.y,We.z),Q.push(0,Dt,0),ot.x=.5*Vt+.5,ot.y=.5*Kt*Dt+.5,re.push(ot.x,ot.y),z++}for(Ge=0;Ge<i;Ge++){var Ct=Qe+Ge,Mt=Ve+Ge;Le===!0?I.push(Mt,Mt+1,Ct):I.push(Mt+1,Mt,Ct),vt+=3}A.addGroup(ye,vt,Le===!0?1:2),ye+=vt}(function(){var Le,Ge,Qe=new Ae,Ve=new Ae,ot=0,We=(t-e)/n;for(Ge=0;Ge<=c;Ge++){var vt=[],_t=Ge/c,Dt=_t*(t-e)+e;for(Le=0;Le<=i;Le++){var Et=Le/i,Vt=Et*x+m,Kt=Math.sin(Vt),Ct=Math.cos(Vt);Ve.x=Dt*Kt,Ve.y=-_t*n+me,Ve.z=Dt*Ct,X.push(Ve.x,Ve.y,Ve.z),Qe.set(Kt,We,Ct).normalize(),Q.push(Qe.x,Qe.y,Qe.z),re.push(Et,1-_t),vt.push(z++)}ue.push(vt)}for(Le=0;Le<i;Le++)for(Ge=0;Ge<c;Ge++){var Mt=ue[Ge][Le],hn=ue[Ge+1][Le],Mn=ue[Ge+1][Le+1],Yn=ue[Ge][Le+1];I.push(Mt,hn,Yn),I.push(hn,Mn,Yn),ot+=6}A.addGroup(ye,ot,0),ye+=ot})(),d===!1&&(0<e&&Pe(!0),0<t&&Pe(!1)),this.setIndex(I),this.setAttribute("position",new on(X,3)),this.setAttribute("normal",new on(Q,3)),this.setAttribute("uv",new on(re,2))}function Hu(e,t,n,i,c,d,m){dl.call(this,0,e,t,n,i,c,d,m),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:c,thetaStart:d,thetaLength:m}}function Wu(e,t,n,i,c,d,m){Ls.call(this,0,e,t,n,i,c,d,m),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:c,thetaStart:d,thetaLength:m}}function Ju(e,t,n,i){sr.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},this.fromBufferGeometry(new Vc(e,t,n,i)),this.mergeVertices()}function Vc(e,t,n,i){Dn.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},e=e||1,t=t!==void 0?Math.max(3,t):8,n=n!==void 0?n:0,i=i!==void 0?i:2*Math.PI;var c,d,m=[],x=[],A=[],I=[],X=new Ae,Q=new zt;for(x.push(0,0,0),A.push(0,0,1),I.push(.5,.5),d=0,c=3;d<=t;d++,c+=3){var re=n+d/t*i;X.x=e*Math.cos(re),X.y=e*Math.sin(re),x.push(X.x,X.y,X.z),A.push(0,0,1),Q.x=(x[c]/e+1)/2,Q.y=(x[c+1]/e+1)/2,I.push(Q.x,Q.y)}for(c=1;c<=t;c++)m.push(c,c+1,0);this.setIndex(m),this.setAttribute("position",new on(x,3)),this.setAttribute("normal",new on(A,3)),this.setAttribute("uv",new on(I,2))}(Ui.prototype=Object.create(sr.prototype)).constructor=Ui,(fo.prototype=Object.create(Rs.prototype)).constructor=fo,(zu.prototype=Object.create(sr.prototype)).constructor=zu,(hl.prototype=Object.create(Dn.prototype)).constructor=hl,(Uu.prototype=Object.create(sr.prototype)).constructor=Uu,(Bc.prototype=Object.create(Dn.prototype)).constructor=Bc,(Fc.prototype=Object.create(sr.prototype)).constructor=Fc,(Zl.prototype=Object.create(Dn.prototype)).constructor=Zl,((Kl.prototype=Object.create(sr.prototype)).constructor=Kl).prototype.toJSON=function(){var e=sr.prototype.toJSON.call(this);return md(this.parameters.shapes,e)},((Ka.prototype=Object.create(Dn.prototype)).constructor=Ka).prototype.toJSON=function(){var e=Dn.prototype.toJSON.call(this);return md(this.parameters.shapes,e)},($l.prototype=Object.create(Dn.prototype)).constructor=$l,(dl.prototype=Object.create(sr.prototype)).constructor=dl,(Ls.prototype=Object.create(Dn.prototype)).constructor=Ls,(Hu.prototype=Object.create(dl.prototype)).constructor=Hu,(Wu.prototype=Object.create(Ls.prototype)).constructor=Wu,(Ju.prototype=Object.create(sr.prototype)).constructor=Ju,(Vc.prototype=Object.create(Dn.prototype)).constructor=Vc;var Go=Object.freeze({__proto__:null,WireframeGeometry:Pc,ParametricGeometry:$o,ParametricBufferGeometry:Oc,TetrahedronGeometry:yr,TetrahedronBufferGeometry:Ac,OctahedronGeometry:Do,OctahedronBufferGeometry:mi,IcosahedronGeometry:Ra,IcosahedronBufferGeometry:Rc,DodecahedronGeometry:Wl,DodecahedronBufferGeometry:pa,PolyhedronGeometry:Fu,PolyhedronBufferGeometry:ro,TubeGeometry:Lc,TubeBufferGeometry:Os,TorusKnotGeometry:gi,TorusKnotBufferGeometry:yi,TorusGeometry:Ic,TorusBufferGeometry:Jl,TextGeometry:Ui,TextBufferGeometry:fo,SphereGeometry:zu,SphereBufferGeometry:hl,RingGeometry:Uu,RingBufferGeometry:Bc,PlaneGeometry:Rl,PlaneBufferGeometry:Qs,LatheGeometry:Fc,LatheBufferGeometry:Zl,ShapeGeometry:Kl,ShapeBufferGeometry:Ka,ExtrudeGeometry:ul,ExtrudeBufferGeometry:Rs,EdgesGeometry:$l,ConeGeometry:Hu,ConeBufferGeometry:Wu,CylinderGeometry:dl,CylinderBufferGeometry:Ls,CircleGeometry:Ju,CircleBufferGeometry:Vc,BoxGeometry:ah,BoxBufferGeometry:lc});function pl(e){It.call(this),this.type="ShadowMaterial",this.color=new $e(0),this.transparent=!0,this.setValues(e)}function Is(e){Yo.call(this,e),this.type="RawShaderMaterial"}function hs(e){It.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new $e(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=va,this.normalScale=new zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Gc(e){hs.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new zt(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function ks(e){It.call(this),this.type="MeshPhongMaterial",this.color=new $e(16777215),this.specular=new $e(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=va,this.normalScale=new zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=se,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function zc(e){It.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new $e(16777215),this.specular=new $e(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=va,this.normalScale=new zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Uc(e){It.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=va,this.normalScale=new zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function mo(e){It.call(this),this.type="MeshLambertMaterial",this.color=new $e(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=se,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function fl(e){It.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new $e(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=va,this.normalScale=new zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Hc(e){ki.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}((pl.prototype=Object.create(It.prototype)).constructor=pl).prototype.isShadowMaterial=!0,pl.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.color.copy(e.color),this},((Is.prototype=Object.create(Yo.prototype)).constructor=Is).prototype.isRawShaderMaterial=!0,((hs.prototype=Object.create(It.prototype)).constructor=hs).prototype.isMeshStandardMaterial=!0,hs.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Gc.prototype=Object.create(hs.prototype)).constructor=Gc).prototype.isMeshPhysicalMaterial=!0,Gc.prototype.copy=function(e){return hs.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new $e).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},((ks.prototype=Object.create(It.prototype)).constructor=ks).prototype.isMeshPhongMaterial=!0,ks.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((zc.prototype=Object.create(It.prototype)).constructor=zc).prototype.isMeshToonMaterial=!0,zc.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Uc.prototype=Object.create(It.prototype)).constructor=Uc).prototype.isMeshNormalMaterial=!0,Uc.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((mo.prototype=Object.create(It.prototype)).constructor=mo).prototype.isMeshLambertMaterial=!0,mo.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((fl.prototype=Object.create(It.prototype)).constructor=fl).prototype.isMeshMatcapMaterial=!0,fl.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Hc.prototype=Object.create(ki.prototype)).constructor=Hc).prototype.isLineDashedMaterial=!0,Hc.prototype.copy=function(e){return ki.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var $d=Object.freeze({__proto__:null,ShadowMaterial:pl,SpriteMaterial:ol,RawShaderMaterial:Is,ShaderMaterial:Yo,PointsMaterial:Za,MeshPhysicalMaterial:Gc,MeshStandardMaterial:hs,MeshPhongMaterial:ks,MeshToonMaterial:zc,MeshNormalMaterial:Uc,MeshLambertMaterial:mo,MeshDepthMaterial:qa,MeshDistanceMaterial:nl,MeshBasicMaterial:Mr,MeshMatcapMaterial:fl,LineDashedMaterial:Hc,LineBasicMaterial:ki,Material:It}),Di={arraySlice:function(e,t,n){return Di.isTypedArray(e)?new e.constructor(e.subarray(t,n!==void 0?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort(function(c,d){return e[c]-e[d]}),n},sortedArray:function(e,t,n){for(var i=e.length,c=new e.constructor(i),d=0,m=0;m!==i;++d)for(var x=n[d]*t,A=0;A!==t;++A)c[m++]=e[x+A];return c},flattenJSON:function(e,t,n,i){for(var c=1,d=e[0];d!==void 0&&d[i]===void 0;)d=e[c++];if(d!==void 0){var m=d[i];if(m!==void 0)if(Array.isArray(m))for(;(m=d[i])!==void 0&&(t.push(d.time),n.push.apply(n,m)),(d=e[c++])!==void 0;);else if(m.toArray!==void 0)for(;(m=d[i])!==void 0&&(t.push(d.time),m.toArray(n,n.length)),(d=e[c++])!==void 0;);else for(;(m=d[i])!==void 0&&(t.push(d.time),n.push(m)),(d=e[c++])!==void 0;);}},subclip:function(e,t,n,i,c){c=c||30;var d=e.clone();d.name=t;for(var m=[],x=0;x<d.tracks.length;++x){for(var A=d.tracks[x],I=A.getValueSize(),X=[],Q=[],re=0;re<A.times.length;++re){var z=A.times[re]*c;if(!(z<n||i<=z)){X.push(A.times[re]);for(var ue=0;ue<I;++ue)Q.push(A.values[re*I+ue])}}X.length!==0&&(A.times=Di.convertArray(X,A.times.constructor),A.values=Di.convertArray(Q,A.values.constructor),m.push(A))}d.tracks=m;var me=1/0;for(x=0;x<d.tracks.length;++x)me>d.tracks[x].times[0]&&(me=d.tracks[x].times[0]);for(x=0;x<d.tracks.length;++x)d.tracks[x].shift(-1*me);return d.resetDuration(),d}};function zo(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function qu(e,t,n,i){zo.call(this,e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Wc(e,t,n,i){zo.call(this,e,t,n,i)}function Xu(e,t,n,i){zo.call(this,e,t,n,i)}function go(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Di.convertArray(t,this.TimeBufferType),this.values=Di.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function Yu(e,t,n){go.call(this,e,t,n)}function Zu(e,t,n,i){go.call(this,e,t,n,i)}function js(e,t,n,i){go.call(this,e,t,n,i)}function Ql(e,t,n,i){zo.call(this,e,t,n,i)}function ml(e,t,n,i){go.call(this,e,t,n,i)}function Ku(e,t,n,i){go.call(this,e,t,n,i)}function ec(e,t,n,i){go.call(this,e,t,n,i)}function Ma(e,t,n){this.name=e,this.tracks=n,this.duration=t!==void 0?t:-1,this.uuid=vr.generateUUID(),this.duration<0&&this.resetDuration()}function Qd(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(c){switch(c.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return js;case"vector":case"vector2":case"vector3":case"vector4":return ec;case"color":return Zu;case"quaternion":return ml;case"bool":case"boolean":return Yu;case"string":return Ku}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+c)}(e.type);if(e.times===void 0){var n=[],i=[];Di.flattenJSON(e.keys,n,i,"value"),e.times=n,e.values=i}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(zo.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],c=t[n-1];e:{t:{var d;n:{o:if(!(e<i)){for(var m=n+2;;){if(i===void 0){if(e<c)break o;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,c)}if(n===m)break;if(c=i,e<(i=t[++n]))break t}d=t.length;break n}if(c<=e)break e;var x=t[1];for(e<x&&(n=2,c=x),m=n-2;;){if(c===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===m)break;if(i=c,(c=t[--n-1])<=e)break t}d=n,n=0}for(;n<d;){var A=n+d>>>1;e<t[A]?d=A:n=1+A}if(i=t[n],(c=t[n-1])===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(i===void 0)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,c,e)}this._cachedIndex=n,this.intervalChanged_(n,c,i)}return this.interpolate_(n,c,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,c=e*i,d=0;d!==i;++d)t[d]=n[c+d];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(zo.prototype,{beforeStart_:zo.prototype.copySampleValue_,afterEnd_:zo.prototype.copySampleValue_}),qu.prototype=Object.assign(Object.create(zo.prototype),{constructor:qu,DefaultSettings_:{endingStart:Ce,endingEnd:Ce},intervalChanged_:function(e,t,n){var i=this.parameterPositions,c=e-2,d=e+1,m=i[c],x=i[d];if(m===void 0)switch(this.getSettings_().endingStart){case ce:c=e,m=2*t-n;break;case Te:m=t+i[c=i.length-2]-i[c+1];break;default:c=e,m=n}if(x===void 0)switch(this.getSettings_().endingEnd){case ce:d=e,x=2*n-t;break;case Te:x=n+i[d=1]-i[0];break;default:d=e-1,x=t}var A=.5*(n-t),I=this.valueSize;this._weightPrev=A/(t-m),this._weightNext=A/(x-n),this._offsetPrev=c*I,this._offsetNext=d*I},interpolate_:function(e,t,n,i){for(var c=this.resultBuffer,d=this.sampleValues,m=this.valueSize,x=e*m,A=x-m,I=this._offsetPrev,X=this._offsetNext,Q=this._weightPrev,re=this._weightNext,z=(n-t)/(i-t),ue=z*z,me=ue*z,ye=-Q*me+2*Q*ue-Q*z,Pe=(1+Q)*me+(-1.5-2*Q)*ue+(-.5+Q)*z+1,Le=(-1-re)*me+(1.5+re)*ue+.5*z,Ge=re*me-re*ue,Qe=0;Qe!==m;++Qe)c[Qe]=ye*d[I+Qe]+Pe*d[A+Qe]+Le*d[x+Qe]+Ge*d[X+Qe];return c}}),Wc.prototype=Object.assign(Object.create(zo.prototype),{constructor:Wc,interpolate_:function(e,t,n,i){for(var c=this.resultBuffer,d=this.sampleValues,m=this.valueSize,x=e*m,A=x-m,I=(n-t)/(i-t),X=1-I,Q=0;Q!==m;++Q)c[Q]=d[A+Q]*X+d[x+Q]*I;return c}}),Xu.prototype=Object.assign(Object.create(zo.prototype),{constructor:Xu,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(go,{toJSON:function(e){var t,n=e.constructor;if(n.toJSON!==void 0)t=n.toJSON(e);else{t={name:e.name,times:Di.convertArray(e.times,Array),values:Di.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(go.prototype,{constructor:go,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:K,InterpolantFactoryMethodDiscrete:function(e){return new Xu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Wc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new qu(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case jr:t=this.InterpolantFactoryMethodDiscrete;break;case K:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(t!==void 0)return this.createInterpolant=t,this;var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return jr;case this.InterpolantFactoryMethodLinear:return K;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(e!==0)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this},scale:function(e){if(e!==1)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,i=n.length,c=0,d=i-1;c!==i&&n[c]<e;)++c;for(;d!==-1&&n[d]>t;)--d;if(++d,c!==0||d!==i){d<=c&&(c=(d=Math.max(d,1))-1);var m=this.getValueSize();this.times=Di.arraySlice(n,c,d),this.values=Di.arraySlice(this.values,c*m,d*m)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,c=n.length;c===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var d=null,m=0;m!==c;m++){var x=n[m];if(typeof x=="number"&&isNaN(x)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,m,x),e=!1;break}if(d!==null&&x<d){console.error("THREE.KeyframeTrack: Out of order keys.",this,m,x,d),e=!1;break}d=x}if(i!==void 0&&Di.isTypedArray(i)){m=0;for(var A=i.length;m!==A;++m){var I=i[m];if(isNaN(I)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,m,I),e=!1;break}}}return e},optimize:function(){for(var e=Di.arraySlice(this.times),t=Di.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===2302,c=1,d=e.length-1,m=1;m<d;++m){var x=!1,A=e[m];if(A!==e[m+1]&&(m!==1||A!==A[0]))if(i)x=!0;else for(var I=m*n,X=I-n,Q=I+n,re=0;re!==n;++re){var z=t[I+re];if(z!==t[X+re]||z!==t[Q+re]){x=!0;break}}if(x){if(m!==c){e[c]=e[m];var ue=m*n,me=c*n;for(re=0;re!==n;++re)t[me+re]=t[ue+re]}++c}}if(0<d){for(e[c]=e[d],ue=d*n,me=c*n,re=0;re!==n;++re)t[me+re]=t[ue+re];++c}return c!==e.length?(this.times=Di.arraySlice(e,0,c),this.values=Di.arraySlice(t,0,c*n)):(this.times=e,this.values=t),this},clone:function(){var e=Di.arraySlice(this.times,0),t=Di.arraySlice(this.values,0),n=new this.constructor(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),Yu.prototype=Object.assign(Object.create(go.prototype),{constructor:Yu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:jr,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Zu.prototype=Object.assign(Object.create(go.prototype),{constructor:Zu,ValueTypeName:"color"}),js.prototype=Object.assign(Object.create(go.prototype),{constructor:js,ValueTypeName:"number"}),Ql.prototype=Object.assign(Object.create(zo.prototype),{constructor:Ql,interpolate_:function(e,t,n,i){for(var c=this.resultBuffer,d=this.sampleValues,m=this.valueSize,x=e*m,A=(n-t)/(i-t),I=x+m;x!==I;x+=4)Bi.slerpFlat(c,0,d,x-m,d,x,A);return c}}),ml.prototype=Object.assign(Object.create(go.prototype),{constructor:ml,ValueTypeName:"quaternion",DefaultInterpolation:K,InterpolantFactoryMethodLinear:function(e){return new Ql(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Ku.prototype=Object.assign(Object.create(go.prototype),{constructor:Ku,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:jr,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ec.prototype=Object.assign(Object.create(go.prototype),{constructor:ec,ValueTypeName:"vector"}),Object.assign(Ma,{parse:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),c=0,d=n.length;c!==d;++c)t.push(Qd(n[c]).scale(i));return new Ma(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},c=0,d=n.length;c!==d;++c)t.push(go.toJSON(n[c]));return i},CreateFromMorphTargetSequence:function(e,t,n,i){for(var c=t.length,d=[],m=0;m<c;m++){var x=[],A=[];x.push((m+c-1)%c,m,(m+1)%c),A.push(0,1,0);var I=Di.getKeyframeOrder(x);x=Di.sortedArray(x,1,I),A=Di.sortedArray(A,1,I),i||x[0]!==0||(x.push(c),A.push(A[0])),d.push(new js(".morphTargetInfluences["+t[m].name+"]",x,A).scale(1/n))}return new Ma(e,-1,d)},findByName:function(e,t){var n=e;Array.isArray(e)||(n=e.geometry&&e.geometry.animations||e.animations);for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var i={},c=/^([\w-]*?)([\d]+)$/,d=0,m=e.length;d<m;d++){var x=e[d],A=x.name.match(c);if(A&&1<A.length){var I=i[Q=A[1]];I||(i[Q]=I=[]),I.push(x)}}var X=[];for(var Q in i)X.push(Ma.CreateFromMorphTargetSequence(Q,i[Q],t,n));return X},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(Le,Ge,Qe,Ve,ot){if(Qe.length!==0){var We=[],vt=[];Di.flattenJSON(Qe,We,vt,Ve),We.length!==0&&ot.push(new Le(Ge,We,vt))}},i=[],c=e.name||"default",d=e.length||-1,m=e.fps||30,x=e.hierarchy||[],A=0;A<x.length;A++){var I=x[A].keys;if(I&&I.length!==0)if(I[0].morphTargets){for(var X={},Q=0;Q<I.length;Q++)if(I[Q].morphTargets)for(var re=0;re<I[Q].morphTargets.length;re++)X[I[Q].morphTargets[re]]=-1;for(var z in X){var ue=[],me=[];for(re=0;re!==I[Q].morphTargets.length;++re){var ye=I[Q];ue.push(ye.time),me.push(ye.morphTarget===z?1:0)}i.push(new js(".morphTargetInfluence["+z+"]",ue,me))}d=X.length*(m||1)}else{var Pe=".bones["+t[A].name+"]";n(ec,Pe+".position",I,"pos",i),n(ml,Pe+".quaternion",I,"rot",i),n(ec,Pe+".scale",I,"scl",i)}}return i.length===0?null:new Ma(c,d,i)}}),Object.assign(Ma.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Ma(this.name,this.duration,e)}});var gl={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function Bh(e,t,n){var i=this,c=!1,d=0,m=0,x=void 0,A=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(I){m++,c===!1&&i.onStart!==void 0&&i.onStart(I,d,m),c=!0},this.itemEnd=function(I){d++,i.onProgress!==void 0&&i.onProgress(I,d,m),d===m&&(c=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(I){i.onError!==void 0&&i.onError(I)},this.resolveURL=function(I){return x?x(I):I},this.setURLModifier=function(I){return x=I,this},this.addHandler=function(I,X){return A.push(I,X),this},this.removeHandler=function(I){var X=A.indexOf(I);return X!==-1&&A.splice(X,2),this},this.getHandler=function(I){for(var X=0,Q=A.length;X<Q;X+=2){var re=A[X],z=A[X+1];if(re.global&&(re.lastIndex=0),re.test(I))return z}return null}}var gd=new Bh;function l(e){this.manager=e!==void 0?e:gd,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(l.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var p={};function O(e){l.call(this,e)}function ae(e){l.call(this,e)}function pe(e){l.call(this,e)}function Oe(e){l.call(this,e)}function qe(e){l.call(this,e)}function it(e){l.call(this,e)}function wt(e){l.call(this,e)}function mt(){this.type="Curve",this.arcLengthDivisions=200}function Nt(e,t,n,i,c,d,m,x){mt.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=i||1,this.aStartAngle=c||0,this.aEndAngle=d||2*Math.PI,this.aClockwise=m||!1,this.aRotation=x||0}function Qt(e,t,n,i,c,d){Nt.call(this,e,t,n,n,i,c,d),this.type="ArcCurve"}function An(){var e=0,t=0,n=0,i=0;function c(d,m,x,A){n=-3*(e=d)+3*m-2*(t=x)-A,i=2*d-2*m+x+A}return{initCatmullRom:function(d,m,x,A,I){c(m,x,I*(x-d),I*(A-m))},initNonuniformCatmullRom:function(d,m,x,A,I,X,Q){var re=(m-d)/I-(x-d)/(I+X)+(x-m)/X,z=(x-m)/X-(A-m)/(X+Q)+(A-x)/Q;c(m,x,re*=X,z*=X)},calc:function(d){var m=d*d;return e+t*d+n*m+i*(m*d)}}}O.prototype=Object.assign(Object.create(l.prototype),{constructor:O,load:function(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var c=this,d=gl.get(e);if(d!==void 0)return c.manager.itemStart(e),setTimeout(function(){t&&t(d),c.manager.itemEnd(e)},0),d;if(p[e]===void 0){var m=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(m){var x=m[1],A=!!m[2],I=m[3];I=decodeURIComponent(I),A&&(I=atob(I));try{var X,Q=(this.responseType||"").toLowerCase();switch(Q){case"arraybuffer":case"blob":for(var re=new Uint8Array(I.length),z=0;z<I.length;z++)re[z]=I.charCodeAt(z);X=Q==="blob"?new Blob([re.buffer],{type:x}):re.buffer;break;case"document":var ue=new DOMParser;X=ue.parseFromString(I,x);break;case"json":X=JSON.parse(I);break;default:X=I}setTimeout(function(){t&&t(X),c.manager.itemEnd(e)},0)}catch(Pe){setTimeout(function(){i&&i(Pe),c.manager.itemError(e),c.manager.itemEnd(e)},0)}}else{p[e]=[],p[e].push({onLoad:t,onProgress:n,onError:i});var me=new XMLHttpRequest;for(var ye in me.open("GET",e,!0),me.addEventListener("load",function(Pe){var Le=this.response,Ge=p[e];if(delete p[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),gl.add(e,Le);for(var Qe=0,Ve=Ge.length;Qe<Ve;Qe++)(ot=Ge[Qe]).onLoad&&ot.onLoad(Le);c.manager.itemEnd(e)}else{for(Qe=0,Ve=Ge.length;Qe<Ve;Qe++){var ot;(ot=Ge[Qe]).onError&&ot.onError(Pe)}c.manager.itemError(e),c.manager.itemEnd(e)}},!1),me.addEventListener("progress",function(Pe){for(var Le=p[e],Ge=0,Qe=Le.length;Ge<Qe;Ge++){var Ve=Le[Ge];Ve.onProgress&&Ve.onProgress(Pe)}},!1),me.addEventListener("error",function(Pe){var Le=p[e];delete p[e];for(var Ge=0,Qe=Le.length;Ge<Qe;Ge++){var Ve=Le[Ge];Ve.onError&&Ve.onError(Pe)}c.manager.itemError(e),c.manager.itemEnd(e)},!1),me.addEventListener("abort",function(Pe){var Le=p[e];delete p[e];for(var Ge=0,Qe=Le.length;Ge<Qe;Ge++){var Ve=Le[Ge];Ve.onError&&Ve.onError(Pe)}c.manager.itemError(e),c.manager.itemEnd(e)},!1),this.responseType!==void 0&&(me.responseType=this.responseType),this.withCredentials!==void 0&&(me.withCredentials=this.withCredentials),me.overrideMimeType&&me.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain"),this.requestHeader)me.setRequestHeader(ye,this.requestHeader[ye]);me.send(null)}return c.manager.itemStart(e),me}p[e].push({onLoad:t,onProgress:n,onError:i})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),ae.prototype=Object.assign(Object.create(l.prototype),{constructor:ae,load:function(e,t,n,i){var c=this,d=new O(c.manager);d.setPath(c.path),d.load(e,function(m){t(c.parse(JSON.parse(m)))},n,i)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var i=Ma.parse(e[n]);t.push(i)}return t}}),pe.prototype=Object.assign(Object.create(l.prototype),{constructor:pe,load:function(e,t,n,i){var c=this,d=[],m=new Nu;m.image=d;var x=new O(this.manager);function A(re){x.load(e[re],function(z){var ue=c.parse(z,!0);d[re]={width:ue.width,height:ue.height,format:ue.format,mipmaps:ue.mipmaps},(I+=1)===6&&(ue.mipmapCount===1&&(m.minFilter=xn),m.format=ue.format,m.needsUpdate=!0,t&&t(m))},n,i)}if(x.setPath(this.path),x.setResponseType("arraybuffer"),Array.isArray(e))for(var I=0,X=0,Q=e.length;X<Q;++X)A(X);else x.load(e,function(re){var z=c.parse(re,!0);if(z.isCubemap)for(var ue=z.mipmaps.length/z.mipmapCount,me=0;me<ue;me++){d[me]={mipmaps:[]};for(var ye=0;ye<z.mipmapCount;ye++)d[me].mipmaps.push(z.mipmaps[me*z.mipmapCount+ye]),d[me].format=z.format,d[me].width=z.width,d[me].height=z.height}else m.image.width=z.width,m.image.height=z.height,m.mipmaps=z.mipmaps;z.mipmapCount===1&&(m.minFilter=xn),m.format=z.format,m.needsUpdate=!0,t&&t(m)},n,i);return m}}),Oe.prototype=Object.assign(Object.create(l.prototype),{constructor:Oe,load:function(e,t,n,i){var c=this,d=new Al,m=new O(this.manager);return m.setResponseType("arraybuffer"),m.setPath(this.path),m.load(e,function(x){var A=c.parse(x);A&&(A.image!==void 0?d.image=A.image:A.data!==void 0&&(d.image.width=A.width,d.image.height=A.height,d.image.data=A.data),d.wrapS=A.wrapS!==void 0?A.wrapS:Rn,d.wrapT=A.wrapT!==void 0?A.wrapT:Rn,d.magFilter=A.magFilter!==void 0?A.magFilter:xn,d.minFilter=A.minFilter!==void 0?A.minFilter:xn,d.anisotropy=A.anisotropy!==void 0?A.anisotropy:1,A.format!==void 0&&(d.format=A.format),A.type!==void 0&&(d.type=A.type),A.mipmaps!==void 0&&(d.mipmaps=A.mipmaps,d.minFilter=er),A.mipmapCount===1&&(d.minFilter=xn),d.needsUpdate=!0,t&&t(d,A))},n,i),d}}),qe.prototype=Object.assign(Object.create(l.prototype),{constructor:qe,load:function(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var c=this,d=gl.get(e);if(d!==void 0)return c.manager.itemStart(e),setTimeout(function(){t&&t(d),c.manager.itemEnd(e)},0),d;var m=document.createElementNS("http://www.w3.org/1999/xhtml","img");function x(){m.removeEventListener("load",x,!1),m.removeEventListener("error",A,!1),gl.add(e,this),t&&t(this),c.manager.itemEnd(e)}function A(I){m.removeEventListener("load",x,!1),m.removeEventListener("error",A,!1),i&&i(I),c.manager.itemError(e),c.manager.itemEnd(e)}return m.addEventListener("load",x,!1),m.addEventListener("error",A,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(m.crossOrigin=this.crossOrigin),c.manager.itemStart(e),m.src=e,m}}),it.prototype=Object.assign(Object.create(l.prototype),{constructor:it,load:function(e,t,n,i){var c=new Ss,d=new qe(this.manager);d.setCrossOrigin(this.crossOrigin),d.setPath(this.path);var m=0;function x(I){d.load(e[I],function(X){c.images[I]=X,++m==6&&(c.needsUpdate=!0,t&&t(c))},void 0,i)}for(var A=0;A<e.length;++A)x(A);return c}}),wt.prototype=Object.assign(Object.create(l.prototype),{constructor:wt,load:function(e,t,n,i){var c=new Yr,d=new qe(this.manager);return d.setCrossOrigin(this.crossOrigin),d.setPath(this.path),d.load(e,function(m){c.image=m;var x=0<e.search(/\.jpe?g($|\?)/i)||e.search(/^data\:image\/jpeg/)===0;c.format=x?Gr:Or,c.needsUpdate=!0,t!==void 0&&t(c)},n,i),c}}),Object.assign(mt.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){e===void 0&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){e===void 0&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e===void 0&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,i=[],c=this.getPoint(0),d=0;for(i.push(0),n=1;n<=e;n++)d+=(t=this.getPoint(n/e)).distanceTo(c),i.push(d),c=t;return this.cacheArcLengths=i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,i=this.getLengths(),c=0,d=i.length;n=t||e*i[d-1];for(var m,x=0,A=d-1;x<=A;)if((m=i[c=Math.floor(x+(A-x)/2)]-n)<0)x=c+1;else{if(!(0<m)){A=c;break}A=c-1}if(i[c=A]===n)return c/(d-1);var I=i[c];return(c+(n-I)/(i[c+1]-I))/(d-1)},getTangent:function(e){var t=e-1e-4,n=e+1e-4;t<0&&(t=0),1<n&&(n=1);var i=this.getPoint(t);return this.getPoint(n).clone().sub(i).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var n,i,c,d=new Ae,m=[],x=[],A=[],I=new Ae,X=new fr;for(n=0;n<=e;n++)i=n/e,m[n]=this.getTangentAt(i),m[n].normalize();x[0]=new Ae,A[0]=new Ae;var Q=Number.MAX_VALUE,re=Math.abs(m[0].x),z=Math.abs(m[0].y),ue=Math.abs(m[0].z);for(re<=Q&&(Q=re,d.set(1,0,0)),z<=Q&&(Q=z,d.set(0,1,0)),ue<=Q&&d.set(0,0,1),I.crossVectors(m[0],d).normalize(),x[0].crossVectors(m[0],I),A[0].crossVectors(m[0],x[0]),n=1;n<=e;n++)x[n]=x[n-1].clone(),A[n]=A[n-1].clone(),I.crossVectors(m[n-1],m[n]),I.length()>Number.EPSILON&&(I.normalize(),c=Math.acos(vr.clamp(m[n-1].dot(m[n]),-1,1)),x[n].applyMatrix4(X.makeRotationAxis(I,c))),A[n].crossVectors(m[n],x[n]);if(t===!0)for(c=Math.acos(vr.clamp(x[0].dot(x[e]),-1,1)),c/=e,0<m[0].dot(I.crossVectors(x[0],x[e]))&&(c=-c),n=1;n<=e;n++)x[n].applyMatrix4(X.makeRotationAxis(m[n],c*n)),A[n].crossVectors(m[n],x[n]);return{tangents:m,normals:x,binormals:A}},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),((Nt.prototype=Object.create(mt.prototype)).constructor=Nt).prototype.isEllipseCurve=!0,Nt.prototype.getPoint=function(e,t){for(var n=t||new zt,i=2*Math.PI,c=this.aEndAngle-this.aStartAngle,d=Math.abs(c)<Number.EPSILON;c<0;)c+=i;for(;i<c;)c-=i;c<Number.EPSILON&&(c=d?0:i),this.aClockwise!==!0||d||(c===i?c=-i:c-=i);var m=this.aStartAngle+e*c,x=this.aX+this.xRadius*Math.cos(m),A=this.aY+this.yRadius*Math.sin(m);if(this.aRotation!==0){var I=Math.cos(this.aRotation),X=Math.sin(this.aRotation),Q=x-this.aX,re=A-this.aY;x=Q*I-re*X+this.aX,A=Q*X+re*I+this.aY}return n.set(x,A)},Nt.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Nt.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Nt.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},((Qt.prototype=Object.create(Nt.prototype)).constructor=Qt).prototype.isArcCurve=!0;var jn=new Ae,$n=new An,Ut=new An,an=new An;function Nn(e,t,n,i){mt.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=i||.5}function wn(e,t,n,i,c){var d=.5*(i-t),m=.5*(c-n),x=e*e;return(2*n-2*i+d+m)*(e*x)+(-3*n+3*i-2*d-m)*x+d*e+n}function pr(e,t,n,i){return(m=1-e)*m*t+2*(1-(d=e))*d*n+(c=e)*c*i;var c,d,m}function lr(e,t,n,i,c){return(I=1-e)*I*I*t+3*(A=1-(x=e))*A*x*n+3*(1-(m=e))*m*m*i+(d=e)*d*d*c;var d,m,x,A,I}function Er(e,t,n,i){mt.call(this),this.type="CubicBezierCurve",this.v0=e||new zt,this.v1=t||new zt,this.v2=n||new zt,this.v3=i||new zt}function Bn(e,t,n,i){mt.call(this),this.type="CubicBezierCurve3",this.v0=e||new Ae,this.v1=t||new Ae,this.v2=n||new Ae,this.v3=i||new Ae}function zn(e,t){mt.call(this),this.type="LineCurve",this.v1=e||new zt,this.v2=t||new zt}function ui(e,t){mt.call(this),this.type="LineCurve3",this.v1=e||new Ae,this.v2=t||new Ae}function ri(e,t,n){mt.call(this),this.type="QuadraticBezierCurve",this.v0=e||new zt,this.v1=t||new zt,this.v2=n||new zt}function ji(e,t,n){mt.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Ae,this.v1=t||new Ae,this.v2=n||new Ae}function zr(e){mt.call(this),this.type="SplineCurve",this.points=e||[]}((Nn.prototype=Object.create(mt.prototype)).constructor=Nn).prototype.isCatmullRomCurve3=!0,Nn.prototype.getPoint=function(e,t){var n,i,c,d,m=t||new Ae,x=this.points,A=x.length,I=(A-(this.closed?0:1))*e,X=Math.floor(I),Q=I-X;if(this.closed?X+=0<X?0:(Math.floor(Math.abs(X)/A)+1)*A:Q===0&&X===A-1&&(X=A-2,Q=1),n=this.closed||0<X?x[(X-1)%A]:(jn.subVectors(x[0],x[1]).add(x[0]),jn),i=x[X%A],c=x[(X+1)%A],d=this.closed||X+2<A?x[(X+2)%A]:(jn.subVectors(x[A-1],x[A-2]).add(x[A-1]),jn),this.curveType==="centripetal"||this.curveType==="chordal"){var re=this.curveType==="chordal"?.5:.25,z=Math.pow(n.distanceToSquared(i),re),ue=Math.pow(i.distanceToSquared(c),re),me=Math.pow(c.distanceToSquared(d),re);ue<1e-4&&(ue=1),z<1e-4&&(z=ue),me<1e-4&&(me=ue),$n.initNonuniformCatmullRom(n.x,i.x,c.x,d.x,z,ue,me),Ut.initNonuniformCatmullRom(n.y,i.y,c.y,d.y,z,ue,me),an.initNonuniformCatmullRom(n.z,i.z,c.z,d.z,z,ue,me)}else this.curveType==="catmullrom"&&($n.initCatmullRom(n.x,i.x,c.x,d.x,this.tension),Ut.initCatmullRom(n.y,i.y,c.y,d.y,this.tension),an.initCatmullRom(n.z,i.z,c.z,d.z,this.tension));return m.set($n.calc(Q),Ut.calc(Q),an.calc(Q)),m},Nn.prototype.copy=function(e){mt.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Nn.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Nn.prototype.fromJSON=function(e){mt.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(new Ae().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},((Er.prototype=Object.create(mt.prototype)).constructor=Er).prototype.isCubicBezierCurve=!0,Er.prototype.getPoint=function(e,t){var n=t||new zt,i=this.v0,c=this.v1,d=this.v2,m=this.v3;return n.set(lr(e,i.x,c.x,d.x,m.x),lr(e,i.y,c.y,d.y,m.y)),n},Er.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Er.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Er.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},((Bn.prototype=Object.create(mt.prototype)).constructor=Bn).prototype.isCubicBezierCurve3=!0,Bn.prototype.getPoint=function(e,t){var n=t||new Ae,i=this.v0,c=this.v1,d=this.v2,m=this.v3;return n.set(lr(e,i.x,c.x,d.x,m.x),lr(e,i.y,c.y,d.y,m.y),lr(e,i.z,c.z,d.z,m.z)),n},Bn.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Bn.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Bn.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},((zn.prototype=Object.create(mt.prototype)).constructor=zn).prototype.isLineCurve=!0,zn.prototype.getPoint=function(e,t){var n=t||new zt;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},zn.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},zn.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},zn.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},zn.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},zn.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((ui.prototype=Object.create(mt.prototype)).constructor=ui).prototype.isLineCurve3=!0,ui.prototype.getPoint=function(e,t){var n=t||new Ae;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},ui.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},ui.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ui.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ui.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((ri.prototype=Object.create(mt.prototype)).constructor=ri).prototype.isQuadraticBezierCurve=!0,ri.prototype.getPoint=function(e,t){var n=t||new zt,i=this.v0,c=this.v1,d=this.v2;return n.set(pr(e,i.x,c.x,d.x),pr(e,i.y,c.y,d.y)),n},ri.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ri.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ri.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((ji.prototype=Object.create(mt.prototype)).constructor=ji).prototype.isQuadraticBezierCurve3=!0,ji.prototype.getPoint=function(e,t){var n=t||new Ae,i=this.v0,c=this.v1,d=this.v2;return n.set(pr(e,i.x,c.x,d.x),pr(e,i.y,c.y,d.y),pr(e,i.z,c.z,d.z)),n},ji.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ji.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ji.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((zr.prototype=Object.create(mt.prototype)).constructor=zr).prototype.isSplineCurve=!0,zr.prototype.getPoint=function(e,t){var n=t||new zt,i=this.points,c=(i.length-1)*e,d=Math.floor(c),m=c-d,x=i[d===0?d:d-1],A=i[d],I=i[d>i.length-2?i.length-1:d+1],X=i[d>i.length-3?i.length-1:d+2];return n.set(wn(m,x.x,A.x,I.x,X.x),wn(m,x.y,A.y,I.y,X.y)),n},zr.prototype.copy=function(e){mt.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this},zr.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e},zr.prototype.fromJSON=function(e){mt.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(new zt().fromArray(i))}return this};var yo=Object.freeze({__proto__:null,ArcCurve:Qt,CatmullRomCurve3:Nn,CubicBezierCurve:Er,CubicBezierCurve3:Bn,EllipseCurve:Nt,LineCurve:zn,LineCurve3:ui,QuadraticBezierCurve:ri,QuadraticBezierCurve3:ji,SplineCurve:zr});function vo(){mt.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function xo(e){vo.call(this),this.type="Path",this.currentPoint=new zt,e&&this.setFromPoints(e)}function Qo(e){xo.call(this,e),this.uuid=vr.generateUUID(),this.type="Shape",this.holes=[]}function Vr(e,t){Pt.call(this),this.type="Light",this.color=new $e(e),this.intensity=t!==void 0?t:1,this.receiveShadow=void 0}function Jc(e,t,n){Vr.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Pt.DefaultUp),this.updateMatrix(),this.groundColor=new $e(t)}function Ia(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new zt(512,512),this.map=null,this.mapPass=null,this.matrix=new fr,this._frustum=new $s,this._frameExtents=new zt(1,1),this._viewportCount=1,this._viewports=[new Jr(0,0,1,1)]}function yl(){Ia.call(this,new Ii(50,1,.5,500))}function tc(e,t,n,i,c,d){Vr.call(this,e,t),this.type="SpotLight",this.position.copy(Pt.DefaultUp),this.updateMatrix(),this.target=new Pt,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(m){this.intensity=m/Math.PI}}),this.distance=n!==void 0?n:0,this.angle=i!==void 0?i:Math.PI/3,this.penumbra=c!==void 0?c:0,this.decay=d!==void 0?d:1,this.shadow=new yl}function nc(){Ia.call(this,new Ii(90,1,.5,500)),this._frameExtents=new zt(4,2),this._viewportCount=6,this._viewports=[new Jr(2,1,1,1),new Jr(0,1,1,1),new Jr(3,1,1,1),new Jr(1,1,1,1),new Jr(3,0,1,1),new Jr(1,0,1,1)],this._cubeDirections=[new Ae(1,0,0),new Ae(-1,0,0),new Ae(0,0,1),new Ae(0,0,-1),new Ae(0,1,0),new Ae(0,-1,0)],this._cubeUps=[new Ae(0,1,0),new Ae(0,1,0),new Ae(0,1,0),new Ae(0,1,0),new Ae(0,0,1),new Ae(0,0,-1)]}function vl(e,t,n,i){Vr.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(c){this.intensity=c/(4*Math.PI)}}),this.distance=n!==void 0?n:0,this.decay=i!==void 0?i:1,this.shadow=new nc}function xl(e,t,n,i,c,d){Aa.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e!==void 0?e:-1,this.right=t!==void 0?t:1,this.top=n!==void 0?n:1,this.bottom=i!==void 0?i:-1,this.near=c!==void 0?c:.1,this.far=d!==void 0?d:2e3,this.updateProjectionMatrix()}function wl(){Ia.call(this,new xl(-5,5,5,-5,.5,500))}function bl(e,t){Vr.call(this,e,t),this.type="DirectionalLight",this.position.copy(Pt.DefaultUp),this.updateMatrix(),this.target=new Pt,this.shadow=new wl}function yd(e,t){Vr.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function vd(e,t,n,i){Vr.call(this,e,t),this.type="RectAreaLight",this.width=n!==void 0?n:10,this.height=i!==void 0?i:10}function xd(e){l.call(this,e),this.textures={}}vo.prototype=Object.assign(Object.create(mt.prototype),{constructor:vo,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new zn(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),i=0;i<n.length;){if(n[i]>=t){var c=n[i]-t,d=this.curves[i],m=d.getLength(),x=m===0?0:1-c/m;return d.getPointAt(x)}i++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){e===void 0&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],i=0,c=this.curves;i<c.length;i++)for(var d=c[i],m=d&&d.isEllipseCurve?2*e:d&&(d.isLineCurve||d.isLineCurve3)?1:d&&d.isSplineCurve?e*d.points.length:e,x=d.getPoints(m),A=0;A<x.length;A++){var I=x[A];t&&t.equals(I)||(n.push(I),t=I)}return this.autoClose&&1<n.length&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){mt.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=mt.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){mt.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push(new yo[i.type]().fromJSON(i))}return this}}),xo.prototype=Object.assign(Object.create(vo.prototype),{constructor:xo,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var n=new zn(this.currentPoint.clone(),new zt(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,i){var c=new ri(this.currentPoint.clone(),new zt(e,t),new zt(n,i));return this.curves.push(c),this.currentPoint.set(n,i),this},bezierCurveTo:function(e,t,n,i,c,d){var m=new Er(this.currentPoint.clone(),new zt(e,t),new zt(n,i),new zt(c,d));return this.curves.push(m),this.currentPoint.set(c,d),this},splineThru:function(e){var t=new zr([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,i,c,d){var m=this.currentPoint.x,x=this.currentPoint.y;return this.absarc(e+m,t+x,n,i,c,d),this},absarc:function(e,t,n,i,c,d){return this.absellipse(e,t,n,n,i,c,d),this},ellipse:function(e,t,n,i,c,d,m,x){var A=this.currentPoint.x,I=this.currentPoint.y;return this.absellipse(e+A,t+I,n,i,c,d,m,x),this},absellipse:function(e,t,n,i,c,d,m,x){var A=new Nt(e,t,n,i,c,d,m,x);if(0<this.curves.length){var I=A.getPoint(0);I.equals(this.currentPoint)||this.lineTo(I.x,I.y)}this.curves.push(A);var X=A.getPoint(1);return this.currentPoint.copy(X),this},copy:function(e){return vo.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=vo.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return vo.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Qo.prototype=Object.assign(Object.create(xo.prototype),{constructor:Qo,getPointsHoles:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){xo.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){var e=xo.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){xo.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push(new xo().fromJSON(i))}return this}}),Vr.prototype=Object.assign(Object.create(Pt.prototype),{constructor:Vr,isLight:!0,copy:function(e){return Pt.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Pt.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}),Jc.prototype=Object.assign(Object.create(Vr.prototype),{constructor:Jc,isHemisphereLight:!0,copy:function(e){return Vr.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Ia.prototype,{_projScreenMatrix:new fr,_lightPositionWorld:new Ae,_lookTarget:new Ae,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,n=this.matrix,i=this._projScreenMatrix,c=this._lookTarget,d=this._lightPositionWorld;d.setFromMatrixPosition(e.matrixWorld),t.position.copy(d),c.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(c),t.updateMatrixWorld(),i.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e={};return this.bias!==0&&(e.bias=this.bias),this.radius!==1&&(e.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),yl.prototype=Object.assign(Object.create(Ia.prototype),{constructor:yl,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,n=2*vr.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,c=e.distance||t.far;n===t.fov&&i===t.aspect&&c===t.far||(t.fov=n,t.aspect=i,t.far=c,t.updateProjectionMatrix()),Ia.prototype.updateMatrices.call(this,e)}}),tc.prototype=Object.assign(Object.create(Vr.prototype),{constructor:tc,isSpotLight:!0,copy:function(e){return Vr.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),nc.prototype=Object.assign(Object.create(Ia.prototype),{constructor:nc,isPointLightShadow:!0,updateMatrices:function(e,t){t===void 0&&(t=0);var n=this.camera,i=this.matrix,c=this._lightPositionWorld,d=this._lookTarget,m=this._projScreenMatrix;c.setFromMatrixPosition(e.matrixWorld),n.position.copy(c),d.copy(n.position),d.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(d),n.updateMatrixWorld(),i.makeTranslation(-c.x,-c.y,-c.z),m.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(m)}}),vl.prototype=Object.assign(Object.create(Vr.prototype),{constructor:vl,isPointLight:!0,copy:function(e){return Vr.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),xl.prototype=Object.assign(Object.create(Aa.prototype),{constructor:xl,isOrthographicCamera:!0,copy:function(e,t){return Aa.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,i,c,d){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=c,this.view.height=d,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,c=n-e,d=n+e,m=i+t,x=i-t;if(this.view!==null&&this.view.enabled){var A=(this.right-this.left)/this.view.fullWidth/this.zoom,I=(this.top-this.bottom)/this.view.fullHeight/this.zoom;d=(c+=A*this.view.offsetX)+A*this.view.width,x=(m-=I*this.view.offsetY)-I*this.view.height}this.projectionMatrix.makeOrthographic(c,d,m,x,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Pt.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}),wl.prototype=Object.assign(Object.create(Ia.prototype),{constructor:wl,isDirectionalLightShadow:!0,updateMatrices:function(e){Ia.prototype.updateMatrices.call(this,e)}}),bl.prototype=Object.assign(Object.create(Vr.prototype),{constructor:bl,isDirectionalLight:!0,copy:function(e){return Vr.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),yd.prototype=Object.assign(Object.create(Vr.prototype),{constructor:yd,isAmbientLight:!0}),vd.prototype=Object.assign(Object.create(Vr.prototype),{constructor:vd,isRectAreaLight:!0,copy:function(e){return Vr.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Vr.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),xd.prototype=Object.assign(Object.create(l.prototype),{constructor:xd,load:function(e,t,n,i){var c=this,d=new O(c.manager);d.setPath(c.path),d.load(e,function(m){t(c.parse(JSON.parse(m)))},n,i)},parse:function(e){var t=this.textures;function n(A){return t[A]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",A),t[A]}var i=new $d[e.type];if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=new $e().setHex(e.sheen)),e.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular.setHex(e.specular),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.vertexColors!==void 0&&(i.vertexColors=e.vertexColors),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==1&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.skinning!==void 0&&(i.skinning=e.skinning),e.morphTargets!==void 0&&(i.morphTargets=e.morphTargets),e.morphNormals!==void 0&&(i.morphNormals=e.morphNormals),e.dithering!==void 0&&(i.dithering=e.dithering),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.uniforms!==void 0)for(var c in e.uniforms){var d=e.uniforms[c];switch(i.uniforms[c]={},d.type){case"t":i.uniforms[c].value=n(d.value);break;case"c":i.uniforms[c].value=new $e().setHex(d.value);break;case"v2":i.uniforms[c].value=new zt().fromArray(d.value);break;case"v3":i.uniforms[c].value=new Ae().fromArray(d.value);break;case"v4":i.uniforms[c].value=new Jr().fromArray(d.value);break;case"m3":i.uniforms[c].value=new Si().fromArray(d.value);case"m4":i.uniforms[c].value=new fr().fromArray(d.value);break;default:i.uniforms[c].value=d.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(var m in e.extensions)i.extensions[m]=e.extensions[m];if(e.shading!==void 0&&(i.flatShading=e.shading===1),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap),i.transparent=!0),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){var x=e.normalScale;Array.isArray(x)===!1&&(x=[x,x]),i.normalScale=new zt().fromArray(x)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new zt().fromArray(e.clearcoatNormalScale)),i},setTextures:function(e){return this.textures=e,this}});var ep={decodeText:function(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);for(var t="",n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}};function wd(){Dn.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function bd(e,t,n,i){typeof n=="number"&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),en.call(this,e,t,n),this.meshPerAttribute=i||1}function Md(e){l.call(this,e)}wd.prototype=Object.assign(Object.create(Dn.prototype),{constructor:wd,isInstancedBufferGeometry:!0,copy:function(e){return Dn.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e=Dn.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),bd.prototype=Object.assign(Object.create(en.prototype),{constructor:bd,isInstancedBufferAttribute:!0,copy:function(e){return en.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=en.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Md.prototype=Object.assign(Object.create(l.prototype),{constructor:Md,load:function(e,t,n,i){var c=this,d=new O(c.manager);d.setPath(c.path),d.load(e,function(m){t(c.parse(JSON.parse(m)))},n,i)},parse:function(e){var t=new(e.isInstancedBufferGeometry?wd:Dn),n=e.data.index;if(n!==void 0){var i=new tp[n.type](n.array);t.setIndex(new en(i,1))}var c=e.data.attributes;for(var d in c){var m=c[d],x=(i=new tp[m.type](m.array),new(m.isInstancedBufferAttribute?bd:en)(i,m.itemSize,m.normalized));m.name!==void 0&&(x.name=m.name),t.setAttribute(d,x)}var A=e.data.morphAttributes;if(A)for(var d in A){for(var I=A[d],X=[],Q=0,re=I.length;Q<re;Q++)m=I[Q],x=new en(i=new tp[m.type](m.array),m.itemSize,m.normalized),m.name!==void 0&&(x.name=m.name),X.push(x);t.morphAttributes[d]=X}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);var z=e.data.groups||e.data.drawcalls||e.data.offsets;if(z!==void 0){Q=0;for(var ue=z.length;Q!==ue;++Q){var me=z[Q];t.addGroup(me.start,me.count,me.materialIndex)}}var ye=e.data.boundingSphere;if(ye!==void 0){var Pe=new Ae;ye.center!==void 0&&Pe.fromArray(ye.center),t.boundingSphere=new Kr(Pe,ye.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var tp={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray<"u"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function _d(e){l.call(this,e)}_d.prototype=Object.assign(Object.create(l.prototype),{constructor:_d,load:function(e,t,n,i){var c=this,d=this.path===""?ep.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||d;var m=new O(c.manager);m.setPath(this.path),m.load(e,function(x){var A=null;try{A=JSON.parse(x)}catch(X){return i!==void 0&&i(X),void console.error("THREE:ObjectLoader: Can't parse "+e+".",X.message)}var I=A.metadata;I!==void 0&&I.type!==void 0&&I.type.toLowerCase()!=="geometry"?c.parse(A,t):console.error("THREE.ObjectLoader: Can't load "+e)},n,i)},parse:function(e,t){var n=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,n),c=this.parseImages(e.images,function(){t!==void 0&&t(x)}),d=this.parseTextures(e.textures,c),m=this.parseMaterials(e.materials,d),x=this.parseObject(e.object,i,m);return e.animations&&(x.animations=this.parseAnimations(e.animations)),e.images!==void 0&&e.images.length!==0||t!==void 0&&t(x),x},parseShape:function(e){var t={};if(e!==void 0)for(var n=0,i=e.length;n<i;n++){var c=new Qo().fromJSON(e[n]);t[c.uuid]=c}return t},parseGeometries:function(e,t){var n={};if(e!==void 0)for(var i=new Md,c=0,d=e.length;c<d;c++){var m,x=e[c];switch(x.type){case"PlaneGeometry":case"PlaneBufferGeometry":m=new Go[x.type](x.width,x.height,x.widthSegments,x.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":m=new Go[x.type](x.width,x.height,x.depth,x.widthSegments,x.heightSegments,x.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":m=new Go[x.type](x.radius,x.segments,x.thetaStart,x.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":m=new Go[x.type](x.radiusTop,x.radiusBottom,x.height,x.radialSegments,x.heightSegments,x.openEnded,x.thetaStart,x.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":m=new Go[x.type](x.radius,x.height,x.radialSegments,x.heightSegments,x.openEnded,x.thetaStart,x.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":m=new Go[x.type](x.radius,x.widthSegments,x.heightSegments,x.phiStart,x.phiLength,x.thetaStart,x.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":m=new Go[x.type](x.radius,x.detail);break;case"RingGeometry":case"RingBufferGeometry":m=new Go[x.type](x.innerRadius,x.outerRadius,x.thetaSegments,x.phiSegments,x.thetaStart,x.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":m=new Go[x.type](x.radius,x.tube,x.radialSegments,x.tubularSegments,x.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":m=new Go[x.type](x.radius,x.tube,x.tubularSegments,x.radialSegments,x.p,x.q);break;case"TubeGeometry":case"TubeBufferGeometry":m=new Go[x.type](new yo[x.path.type]().fromJSON(x.path),x.tubularSegments,x.radius,x.radialSegments,x.closed);break;case"LatheGeometry":case"LatheBufferGeometry":m=new Go[x.type](x.points,x.segments,x.phiStart,x.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":m=new Go[x.type](x.vertices,x.indices,x.radius,x.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var A=[],I=0,X=x.shapes.length;I<X;I++){var Q=t[x.shapes[I]];A.push(Q)}m=new Go[x.type](A,x.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(A=[],I=0,X=x.shapes.length;I<X;I++)Q=t[x.shapes[I]],A.push(Q);var re=x.options.extrudePath;re!==void 0&&(x.options.extrudePath=new yo[re.type]().fromJSON(re)),m=new Go[x.type](A,x.options);break;case"BufferGeometry":case"InstancedBufferGeometry":m=i.parse(x);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?m=new THREE.LegacyJSONLoader().parse(x,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+x.type+'"');continue}m.uuid=x.uuid,x.name!==void 0&&(m.name=x.name),m.isBufferGeometry===!0&&x.userData!==void 0&&(m.userData=x.userData),n[x.uuid]=m}return n},parseMaterials:function(e,t){var n={},i={};if(e!==void 0){var c=new xd;c.setTextures(t);for(var d=0,m=e.length;d<m;d++){var x=e[d];if(x.type==="MultiMaterial"){for(var A=[],I=0;I<x.materials.length;I++){var X=x.materials[I];n[X.uuid]===void 0&&(n[X.uuid]=c.parse(X)),A.push(n[X.uuid])}i[x.uuid]=A}else n[x.uuid]===void 0&&(n[x.uuid]=c.parse(x)),i[x.uuid]=n[x.uuid]}}return i},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],c=Ma.parse(i);i.uuid!==void 0&&(c.uuid=i.uuid),t.push(c)}return t},parseImages:function(e,t){var n=this,i={};function c(ue){return n.manager.itemStart(ue),d.load(ue,function(){n.manager.itemEnd(ue)},void 0,function(){n.manager.itemError(ue),n.manager.itemEnd(ue)})}if(e!==void 0&&0<e.length){var d=new qe(new Bh(t));d.setCrossOrigin(this.crossOrigin);for(var m=0,x=e.length;m<x;m++){var A=e[m],I=A.url;if(Array.isArray(I)){i[A.uuid]=[];for(var X=0,Q=I.length;X<Q;X++){var re=I[X],z=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(re)?re:n.resourcePath+re;i[A.uuid].push(c(z))}}else z=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(A.url)?A.url:n.resourcePath+A.url,i[A.uuid]=c(z)}}return i},parseTextures:function(e,t){function n(A,I){return typeof A=="number"?A:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",A),I[A])}var i={};if(e!==void 0)for(var c=0,d=e.length;c<d;c++){var m,x=e[c];x.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',x.uuid),t[x.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",x.image),(m=new(Array.isArray(t[x.image])?Ss:Yr)(t[x.image])).needsUpdate=!0,m.uuid=x.uuid,x.name!==void 0&&(m.name=x.name),x.mapping!==void 0&&(m.mapping=n(x.mapping,Tf)),x.offset!==void 0&&m.offset.fromArray(x.offset),x.repeat!==void 0&&m.repeat.fromArray(x.repeat),x.center!==void 0&&m.center.fromArray(x.center),x.rotation!==void 0&&(m.rotation=x.rotation),x.wrap!==void 0&&(m.wrapS=n(x.wrap[0],jp),m.wrapT=n(x.wrap[1],jp)),x.format!==void 0&&(m.format=x.format),x.type!==void 0&&(m.type=x.type),x.encoding!==void 0&&(m.encoding=x.encoding),x.minFilter!==void 0&&(m.minFilter=n(x.minFilter,Np)),x.magFilter!==void 0&&(m.magFilter=n(x.magFilter,Np)),x.anisotropy!==void 0&&(m.anisotropy=x.anisotropy),x.flipY!==void 0&&(m.flipY=x.flipY),x.premultiplyAlpha!==void 0&&(m.premultiplyAlpha=x.premultiplyAlpha),x.unpackAlignment!==void 0&&(m.unpackAlignment=x.unpackAlignment),i[x.uuid]=m}return i},parseObject:function(e,t,n){var i;function c(ye){return t[ye]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",ye),t[ye]}function d(ye){if(ye!==void 0){if(Array.isArray(ye)){for(var Pe=[],Le=0,Ge=ye.length;Le<Ge;Le++){var Qe=ye[Le];n[Qe]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Qe),Pe.push(n[Qe])}return Pe}return n[ye]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ye),n[ye]}}switch(e.type){case"Scene":i=new Hn,e.background!==void 0&&Number.isInteger(e.background)&&(i.background=new $e(e.background)),e.fog!==void 0&&(e.fog.type==="Fog"?i.fog=new Xa(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(i.fog=new da(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new Ii(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(i.focus=e.focus),e.zoom!==void 0&&(i.zoom=e.zoom),e.filmGauge!==void 0&&(i.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(i.filmOffset=e.filmOffset),e.view!==void 0&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new xl(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(i.zoom=e.zoom),e.view!==void 0&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new yd(e.color,e.intensity);break;case"DirectionalLight":i=new bl(e.color,e.intensity);break;case"PointLight":i=new vl(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new vd(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new tc(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new Jc(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var m=c(e.geometry),x=d(e.material);i=new(m.bones&&0<m.bones.length?_c:_i)(m,x);break;case"InstancedMesh":m=c(e.geometry),x=d(e.material);var A=e.count,I=e.instanceMatrix;(i=new Pu(m,x,A)).instanceMatrix=new en(new Float32Array(I.array),16);break;case"LOD":i=new Mc;break;case"Line":i=new Lo(c(e.geometry),d(e.material),e.mode);break;case"LineLoop":i=new Sc(c(e.geometry),d(e.material));break;case"LineSegments":i=new fi(c(e.geometry),d(e.material));break;case"PointCloud":case"Points":i=new zl(c(e.geometry),d(e.material));break;case"Sprite":i=new bc(d(e.material));break;case"Group":i=new rl;break;default:i=new Pt}if(i.uuid=e.uuid,e.name!==void 0&&(i.name=e.name),e.matrix!==void 0?(i.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(e.position!==void 0&&i.position.fromArray(e.position),e.rotation!==void 0&&i.rotation.fromArray(e.rotation),e.quaternion!==void 0&&i.quaternion.fromArray(e.quaternion),e.scale!==void 0&&i.scale.fromArray(e.scale)),e.castShadow!==void 0&&(i.castShadow=e.castShadow),e.receiveShadow!==void 0&&(i.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(i.shadow.bias=e.shadow.bias),e.shadow.radius!==void 0&&(i.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&i.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(i.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(i.visible=e.visible),e.frustumCulled!==void 0&&(i.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(i.renderOrder=e.renderOrder),e.userData!==void 0&&(i.userData=e.userData),e.layers!==void 0&&(i.layers.mask=e.layers),e.children!==void 0)for(var X=e.children,Q=0;Q<X.length;Q++)i.add(this.parseObject(X[Q],t,n));if(e.type==="LOD"){e.autoUpdate!==void 0&&(i.autoUpdate=e.autoUpdate);for(var re=e.levels,z=0;z<re.length;z++){var ue=re[z],me=i.getObjectByProperty("uuid",ue.object);me!==void 0&&i.addLevel(me,ue.distance)}}return i}});var Td,Tf={UVMapping:300,CubeReflectionMapping:Gt,CubeRefractionMapping:jt,EquirectangularReflectionMapping:Tn,EquirectangularRefractionMapping:mn,SphericalReflectionMapping:Qn,CubeUVReflectionMapping:gt,CubeUVRefractionMapping:ze},jp={RepeatWrapping:Zt,ClampToEdgeWrapping:Rn,MirroredRepeatWrapping:Xn},Np={NearestFilter:pt,NearestMipmapNearestFilter:st,NearestMipmapLinearFilter:qt,LinearFilter:xn,LinearMipmapNearestFilter:nn,LinearMipmapLinearFilter:er};function np(e){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),l.call(this,e),this.options=void 0}function rp(){this.type="ShapePath",this.color=new $e,this.subPaths=[],this.currentPath=null}function ip(e){this.type="Font",this.data=e}function Cf(e,t,n,i,c){var d=c.glyphs[e]||c.glyphs["?"];if(d){var m,x,A,I,X,Q,re,z,ue=new rp;if(d.o)for(var me=d._cachedOutline||(d._cachedOutline=d.o.split(" ")),ye=0,Pe=me.length;ye<Pe;)switch(me[ye++]){case"m":m=me[ye++]*t+n,x=me[ye++]*t+i,ue.moveTo(m,x);break;case"l":m=me[ye++]*t+n,x=me[ye++]*t+i,ue.lineTo(m,x);break;case"q":A=me[ye++]*t+n,I=me[ye++]*t+i,X=me[ye++]*t+n,Q=me[ye++]*t+i,ue.quadraticCurveTo(X,Q,A,I);break;case"b":A=me[ye++]*t+n,I=me[ye++]*t+i,X=me[ye++]*t+n,Q=me[ye++]*t+i,re=me[ye++]*t+n,z=me[ye++]*t+i,ue.bezierCurveTo(X,Q,re,z,A,I)}return{offsetX:d.ha*t,path:ue}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+c.familyName+".")}function op(e){l.call(this,e)}np.prototype=Object.assign(Object.create(l.prototype),{constructor:np,setOptions:function(e){return this.options=e,this},load:function(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var c=this,d=gl.get(e);if(d!==void 0)return c.manager.itemStart(e),setTimeout(function(){t&&t(d),c.manager.itemEnd(e)},0),d;fetch(e).then(function(m){return m.blob()}).then(function(m){return c.options===void 0?createImageBitmap(m):createImageBitmap(m,c.options)}).then(function(m){gl.add(e,m),t&&t(m),c.manager.itemEnd(e)}).catch(function(m){i&&i(m),c.manager.itemError(e),c.manager.itemEnd(e)}),c.manager.itemStart(e)}}),Object.assign(rp.prototype,{moveTo:function(e,t){return this.currentPath=new xo,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this},bezierCurveTo:function(e,t,n,i,c,d){return this.currentPath.bezierCurveTo(e,t,n,i,c,d),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(Mt){for(var hn=[],Mn=0,Yn=Mt.length;Mn<Yn;Mn++){var qn=Mt[Mn],Vn=new Qo;Vn.curves=qn.curves,hn.push(Vn)}return hn}function i(Mt,hn){for(var Mn=hn.length,Yn=!1,qn=Mn-1,Vn=0;Vn<Mn;qn=Vn++){var cr=hn[qn],En=hn[Vn],ke=En.x-cr.x,et=En.y-cr.y;if(Math.abs(et)>Number.EPSILON){if(et<0&&(cr=hn[Vn],ke=-ke,En=hn[qn],et=-et),Mt.y<cr.y||Mt.y>En.y)continue;if(Mt.y===cr.y){if(Mt.x===cr.x)return 1}else{var Yt=et*(Mt.x-cr.x)-ke*(Mt.y-cr.y);if(Yt==0)return 1;if(Yt<0)continue;Yn=!Yn}}else{if(Mt.y!==cr.y)continue;if(En.x<=Mt.x&&Mt.x<=cr.x||cr.x<=Mt.x&&Mt.x<=En.x)return 1}}return Yn}var c=us.isClockWise,d=this.subPaths;if(d.length===0)return[];if(t===!0)return n(d);var m,x,A,I=[];if(d.length===1)return x=d[0],(A=new Qo).curves=x.curves,I.push(A),I;var X=!c(d[0].getPoints());X=e?!X:X;var Q,re,z=[],ue=[],me=[],ye=0;ue[ye]=void 0,me[ye]=[];for(var Pe=0,Le=d.length;Pe<Le;Pe++)m=c(Q=(x=d[Pe]).getPoints()),(m=e?!m:m)?(!X&&ue[ye]&&ye++,ue[ye]={s:new Qo,p:Q},ue[ye].s.curves=x.curves,X&&ye++,me[ye]=[]):me[ye].push({h:x,p:Q[0]});if(!ue[0])return n(d);if(1<ue.length){for(var Ge=!1,Qe=[],Ve=0,ot=ue.length;Ve<ot;Ve++)z[Ve]=[];for(Ve=0,ot=ue.length;Ve<ot;Ve++)for(var We=me[Ve],vt=0;vt<We.length;vt++){for(var _t=We[vt],Dt=!0,Et=0;Et<ue.length;Et++)i(_t.p,ue[Et].p)&&(Ve!==Et&&Qe.push({froms:Ve,tos:Et,hole:vt}),Dt?(Dt=!1,z[Et].push(_t)):Ge=!0);Dt&&z[Ve].push(_t)}0<Qe.length&&(Ge||(me=z))}Pe=0;for(var Vt=ue.length;Pe<Vt;Pe++){A=ue[Pe].s,I.push(A);for(var Kt=0,Ct=(re=me[Pe]).length;Kt<Ct;Kt++)A.holes.push(re[Kt].h)}return I}}),Object.assign(ip.prototype,{isFont:!0,generateShapes:function(e,t){t===void 0&&(t=100);for(var n=[],i=function(m,x,A){for(var I=Array.from?Array.from(m):String(m).split(""),X=x/A.resolution,Q=(A.boundingBox.yMax-A.boundingBox.yMin+A.underlineThickness)*X,re=[],z=0,ue=0,me=0;me<I.length;me++){var ye=I[me];if(ye===`
`)z=0,ue-=Q;else{var Pe=Cf(ye,X,z,ue,A);z+=Pe.offsetX,re.push(Pe.path)}}return re}(e,t,this.data),c=0,d=i.length;c<d;c++)Array.prototype.push.apply(n,i[c].toShapes());return n}}),op.prototype=Object.assign(Object.create(l.prototype),{constructor:op,load:function(e,t,n,i){var c=this,d=new O(this.manager);d.setPath(this.path),d.load(e,function(m){var x;try{x=JSON.parse(m)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),x=JSON.parse(m.substring(65,m.length-2))}var A=c.parse(x);t&&t(A)},n,i)},parse:function(e){return new ip(e)}});var ap={getContext:function(){return Td===void 0&&(Td=new(window.AudioContext||window.webkitAudioContext)),Td},setContext:function(e){Td=e}};function Cd(e){l.call(this,e)}function Sd(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new Ae)}function ds(e,t){Vr.call(this,void 0,t),this.sh=e!==void 0?e:new Sd}function sp(e,t,n){ds.call(this,void 0,n);var i=new $e().set(e),c=new $e().set(t),d=new Ae(i.r,i.g,i.b),m=new Ae(c.r,c.g,c.b),x=Math.sqrt(Math.PI),A=x*Math.sqrt(.75);this.sh.coefficients[0].copy(d).add(m).multiplyScalar(x),this.sh.coefficients[1].copy(d).sub(m).multiplyScalar(A)}function lp(e,t){ds.call(this,void 0,t);var n=new $e().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}Cd.prototype=Object.assign(Object.create(l.prototype),{constructor:Cd,load:function(e,t,n,i){var c=new O(this.manager);c.setResponseType("arraybuffer"),c.setPath(this.path),c.load(e,function(d){var m=d.slice(0);ap.getContext().decodeAudioData(m,function(x){t(x)})},n,i)}}),Object.assign(Sd.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var n=e.x,i=e.y,c=e.z,d=this.coefficients;return t.copy(d[0]).multiplyScalar(.282095),t.addScale(d[1],.488603*i),t.addScale(d[2],.488603*c),t.addScale(d[3],.488603*n),t.addScale(d[4],n*i*1.092548),t.addScale(d[5],i*c*1.092548),t.addScale(d[6],.315392*(3*c*c-1)),t.addScale(d[7],n*c*1.092548),t.addScale(d[8],.546274*(n*n-i*i)),t},getIrradianceAt:function(e,t){var n=e.x,i=e.y,c=e.z,d=this.coefficients;return t.copy(d[0]).multiplyScalar(.886227),t.addScale(d[1],1.023328*i),t.addScale(d[2],1.023328*c),t.addScale(d[3],1.023328*n),t.addScale(d[4],.858086*n*i),t.addScale(d[5],.858086*i*c),t.addScale(d[6],.743125*c*c-.247708),t.addScale(d[7],.858086*n*c),t.addScale(d[8],.429043*(n*n-i*i)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return new this.constructor().copy(this)},fromArray:function(e,t){t===void 0&&(t=0);for(var n=this.coefficients,i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);for(var n=this.coefficients,i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}}),Object.assign(Sd,{getBasisAt:function(e,t){var n=e.x,i=e.y,c=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*c,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*c,t[6]=.315392*(3*c*c-1),t[7]=1.092548*n*c,t[8]=.546274*(n*n-i*i)}}),ds.prototype=Object.assign(Object.create(Vr.prototype),{constructor:ds,isLightProbe:!0,copy:function(e){return Vr.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return Vr.prototype.toJSON.call(this,e)}}),sp.prototype=Object.assign(Object.create(ds.prototype),{constructor:sp,isHemisphereLightProbe:!0,copy:function(e){return ds.prototype.copy.call(this,e),this},toJSON:function(e){return ds.prototype.toJSON.call(this,e)}}),lp.prototype=Object.assign(Object.create(ds.prototype),{constructor:lp,isAmbientLightProbe:!0,copy:function(e){return ds.prototype.copy.call(this,e),this},toJSON:function(e){return ds.prototype.toJSON.call(this,e)}});var Bp=new fr,Fp=new fr;function Vp(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ii,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ii,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function cp(e){this.autoStart=e===void 0||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(Vp.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n,i,c=e.projectionMatrix.clone(),d=t.eyeSep/2,m=d*t.near/t.focus,x=t.near*Math.tan(vr.DEG2RAD*t.fov*.5)/t.zoom;Fp.elements[12]=-d,Bp.elements[12]=d,n=-x*t.aspect+m,i=x*t.aspect+m,c.elements[0]=2*t.near/(i-n),c.elements[8]=(i+n)/(i-n),this.cameraL.projectionMatrix.copy(c),n=-x*t.aspect-m,i=x*t.aspect-m,c.elements[0]=2*t.near/(i-n),c.elements[8]=(i+n)/(i-n),this.cameraR.projectionMatrix.copy(c)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Fp),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Bp)}}),Object.assign(cp.prototype,{start:function(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=(typeof performance>"u"?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var qc=new Ae,Gp=new Bi,Sf=new Ae,Xc=new Ae;function up(){Pt.call(this),this.type="AudioListener",this.context=ap.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new cp}function $u(e){Pt.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}up.prototype=Object.assign(Object.create(Pt.prototype),{constructor:up,getInput:function(){return this.gain},removeFilter:function(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){Pt.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(qc,Gp,Sf),Xc.set(0,0,-1).applyQuaternion(Gp),t.positionX){var i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(qc.x,i),t.positionY.linearRampToValueAtTime(qc.y,i),t.positionZ.linearRampToValueAtTime(qc.z,i),t.forwardX.linearRampToValueAtTime(Xc.x,i),t.forwardY.linearRampToValueAtTime(Xc.y,i),t.forwardZ.linearRampToValueAtTime(Xc.z,i),t.upX.linearRampToValueAtTime(n.x,i),t.upY.linearRampToValueAtTime(n.y,i),t.upZ.linearRampToValueAtTime(n.z,i)}else t.setPosition(qc.x,qc.y,qc.z),t.setOrientation(Xc.x,Xc.y,Xc.z,n.x,n.y,n.z)}}),$u.prototype=Object.assign(Object.create(Pt.prototype),{constructor:$u,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(e===void 0&&(e=0),this.isPlaying!==!0){if(this.hasPlaybackControl!==!1){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(this.hasPlaybackControl!==!1)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e=e||[],this.isPlaying===!0?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var Yc=new Ae,zp=new Bi,Df=new Ae,Zc=new Ae;function hp(e){$u.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function dp(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t!==void 0?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function pp(e,t,n){this.binding=e,this.valueSize=n;var i,c=Float64Array;switch(t){case"quaternion":i=this._slerp;break;case"string":case"bool":c=Array,i=this._select;break;default:i=this._lerp}this.buffer=new c(4*n),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}hp.prototype=Object.assign(Object.create($u.prototype),{constructor:hp,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(e){if(Pt.prototype.updateMatrixWorld.call(this,e),this.hasPlaybackControl!==!0||this.isPlaying!==!1){this.matrixWorld.decompose(Yc,zp,Df),Zc.set(0,0,1).applyQuaternion(zp);var t=this.panner;if(t.positionX){var n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Yc.x,n),t.positionY.linearRampToValueAtTime(Yc.y,n),t.positionZ.linearRampToValueAtTime(Yc.z,n),t.orientationX.linearRampToValueAtTime(Zc.x,n),t.orientationY.linearRampToValueAtTime(Zc.y,n),t.orientationZ.linearRampToValueAtTime(Zc.z,n)}else t.setPosition(Yc.x,Yc.y,Yc.z),t.setOrientation(Zc.x,Zc.y,Zc.z)}}}),Object.assign(dp.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(pp.prototype,{accumulate:function(e,t){var n=this.buffer,i=this.valueSize,c=e*i+i,d=this.cumulativeWeight;if(d===0){for(var m=0;m!==i;++m)n[c+m]=n[m];d=t}else{var x=t/(d+=t);this._mixBufferRegion(n,c,0,x,i)}this.cumulativeWeight=d},apply:function(e){var t=this.valueSize,n=this.buffer,i=e*t+t,c=this.cumulativeWeight,d=this.binding;if(this.cumulativeWeight=0,c<1){var m=3*t;this._mixBufferRegion(n,i,m,1-c,t)}for(var x=t,A=t+t;x!==A;++x)if(n[x]!==n[x+t]){d.setValue(n,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,i=3*n;e.getValue(t,i);for(var c=n,d=i;c!==d;++c)t[c]=t[i+c%n];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,n,i,c){if(.5<=i)for(var d=0;d!==c;++d)e[t+d]=e[n+d]},_slerp:function(e,t,n,i){Bi.slerpFlat(e,t,e,t,e,n,i)},_lerp:function(e,t,n,i,c){for(var d=1-i,m=0;m!==c;++m){var x=t+m;e[x]=e[x]*d+e[n+m]*i}}});var fp="\\[\\]\\.:\\/",Ef=new RegExp("["+fp+"]","g"),mp="[^"+fp+"]",Pf="[^"+fp.replace("\\.","")+"]",Of=/((?:WC+[\/:])*)/.source.replace("WC",mp),Af=/(WCOD+)?/.source.replace("WCOD",Pf),Rf=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",mp),Lf=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",mp),If=new RegExp("^"+Of+Af+Rf+Lf+"$"),kf=["material","materials","bones"];function Up(e,t,n){var i=n||ea.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function ea(e,t,n){this.path=t,this.parsedPath=n||ea.parseTrackName(t),this.node=ea.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Hp(){this.uuid=vr.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}function Wp(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null;for(var i=t.tracks,c=i.length,d=new Array(c),m={endingStart:Ce,endingEnd:Ce},x=0;x!==c;++x){var A=i[x].createInterpolant(null);(d[x]=A).settings=m}this._interpolantSettings=m,this._interpolants=d,this._propertyBindings=new Array(c),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function gp(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Dd(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function yp(e,t,n){Ya.call(this,e,t),this.meshPerAttribute=n||1}function Jp(e,t,n,i){this.ray=new Ar(e,t),this.near=n||0,this.far=i||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function qp(e,t){return e.distance-t.distance}function vp(e,t,n,i){if(e.visible!==!1&&(e.raycast(t,n),i===!0))for(var c=e.children,d=0,m=c.length;d<m;d++)vp(c[d],t,n,!0)}function Xp(e,t,n){return this.radius=e!==void 0?e:1,this.phi=t!==void 0?t:0,this.theta=n!==void 0?n:0,this}function Yp(e,t,n){return this.radius=e!==void 0?e:1,this.theta=t!==void 0?t:0,this.y=n!==void 0?n:0,this}Object.assign(Up.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,c=n.length;i!==c;++i)n[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(ea,{Composite:Up,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new ea.Composite(e,t,n):new ea(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Ef,"")},parseTrackName:function(e){var t=If.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){var c=n.nodeName.substring(i+1);kf.indexOf(c)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=c)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||t===""||t==="root"||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){var i=function(d){for(var m=0;m<d.length;m++){var x=d[m];if(x.name===t||x.uuid===t)return x;var A=i(x.children);if(A)return A}return null},c=i(e.children);if(c)return c}return null}}),Object.assign(ea.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,i=0,c=n.length;i!==c;++i)e[t++]=n[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,i=0,c=n.length;i!==c;++i)n[i]=e[t++]},function(e,t){for(var n=this.resolvedProperty,i=0,c=n.length;i!==c;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,i=0,c=n.length;i!==c;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,c=t.propertyIndex;if(e||(e=ea.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var d=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var m=0;m<e.length;m++)if(e[m].name===d){d=m;break}break;default:if(e[n]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(d!==void 0){if(e[d]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[d]}}var x=e[i];if(x!==void 0){var A=this.Versioning.None;(this.targetObject=e).needsUpdate!==void 0?A=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(A=this.Versioning.MatrixWorldNeedsUpdate);var I=this.BindingType.Direct;if(c!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(m=0;m<this.node.geometry.morphAttributes.position.length;m++)if(e.geometry.morphAttributes.position[m].name===c){c=m;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(m=0;m<this.node.geometry.morphTargets.length;m++)if(e.geometry.morphTargets[m].name===c){c=m;break}}}I=this.BindingType.ArrayElement,this.resolvedProperty=x,this.propertyIndex=c}else x.fromArray!==void 0&&x.toArray!==void 0?(I=this.BindingType.HasFromToArray,this.resolvedProperty=x):Array.isArray(x)?(I=this.BindingType.EntireArray,this.resolvedProperty=x):this.propertyName=i;this.getValue=this.GetterByBindingType[I],this.setValue=this.SetterByBindingTypeAndVersioning[I][A]}else{var X=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+X+"."+i+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(ea.prototype,{_getValue_unbound:ea.prototype.getValue,_setValue_unbound:ea.prototype.setValue}),Object.assign(Hp.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,c=this._paths,d=this._parsedPaths,m=this._bindings,x=m.length,A=void 0,I=0,X=arguments.length;I!==X;++I){var Q=arguments[I],re=Q.uuid,z=i[re];if(z===void 0){z=t++,i[re]=z,e.push(Q);for(var ue=0,me=x;ue!==me;++ue)m[ue].push(new ea(Q,c[ue],d[ue]))}else if(z<n){A=e[z];var ye=--n,Pe=e[ye];for(e[i[Pe.uuid]=z]=Pe,e[i[re]=ye]=Q,ue=0,me=x;ue!==me;++ue){var Le=m[ue],Ge=Le[ye],Qe=Le[z];Le[z]=Ge,Qe===void 0&&(Qe=new ea(Q,c[ue],d[ue])),Le[ye]=Qe}}else e[z]!==A&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,c=i.length,d=0,m=arguments.length;d!==m;++d){var x=arguments[d],A=x.uuid,I=n[A];if(I!==void 0&&t<=I){var X=t++,Q=e[X];e[n[Q.uuid]=I]=Q,e[n[A]=X]=x;for(var re=0,z=c;re!==z;++re){var ue=i[re],me=ue[X],ye=ue[I];ue[I]=me,ue[X]=ye}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,c=this._bindings,d=c.length,m=0,x=arguments.length;m!==x;++m){var A=arguments[m].uuid,I=i[A];if(I!==void 0)if(delete i[A],I<n){var X=--n,Q=e[X],re=e[Pe=--t];e[i[Q.uuid]=I]=Q,e[i[re.uuid]=X]=re,e.pop();for(var z=0,ue=d;z!==ue;++z){var me=(Le=c[z])[X],ye=Le[Pe];Le[I]=me,Le[X]=ye,Le.pop()}}else{var Pe;for(e[i[(re=e[Pe=--t]).uuid]=I]=re,e.pop(),z=0,ue=d;z!==ue;++z){var Le;(Le=c[z])[I]=Le[Pe],Le.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,i=n[e],c=this._bindings;if(i!==void 0)return c[i];var d=this._paths,m=this._parsedPaths,x=this._objects,A=x.length,I=this.nCachedObjects_,X=new Array(A);i=c.length,n[e]=i,d.push(e),m.push(t),c.push(X);for(var Q=I,re=x.length;Q!==re;++Q){var z=x[Q];X[Q]=new ea(z,e,t)}return X},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){var i=this._paths,c=this._parsedPaths,d=this._bindings,m=d.length-1,x=d[m];d[t[e[m]]=n]=x,d.pop(),c[n]=c[m],c.pop(),i[n]=i[m],i.pop()}}}),Object.assign(Wp.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var i=this._clip.duration,c=e._clip.duration,d=c/i,m=i/c;e.warp(1,d,t),this.warp(m,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var i=this._mixer,c=i.time,d=this._timeScaleInterpolant,m=this.timeScale;d===null&&(d=i._lendControlInterpolant(),this._timeScaleInterpolant=d);var x=d.parameterPositions,A=d.sampleValues;return x[0]=c,x[1]=c+n,A[0]=e/m,A[1]=t/m,this},stopWarping:function(){var e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,i){if(this.enabled){var c=this._startTime;if(c!==null){var d=(e-c)*n;if(d<0||n===0)return;this._startTime=null,t=n*d}t*=this._updateTimeScale(e);var m=this._updateTime(t),x=this._updateWeight(e);if(0<x)for(var A=this._interpolants,I=this._propertyBindings,X=0,Q=A.length;X!==Q;++X)A[X].evaluate(m),I[X].accumulate(i,x)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(n!==null){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;n!==null&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t},_updateTime:function(e){var t=this.time+e,n=this._clip.duration,i=this.loop,c=this._loopCount,d=i===2202;if(e===0)return c!==-1&&d&&(1&c)==1?n-t:t;if(i===2200){c===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n<=t)t=n;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(c===-1&&(0<=e?(c=0,this._setEndings(!0,this.repetitions===0,d)):this._setEndings(this.repetitions===0,!0,d)),n<=t||t<0){var m=Math.floor(t/n);t-=n*m,c+=Math.abs(m);var x=this.repetitions-c;if(x<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=0<e?n:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1});else{if(x==1){var A=e<0;this._setEndings(A,!A,d)}else this._setEndings(!1,!1,d);this._loopCount=c,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:m})}}else this.time=t;if(d&&(1&c)==1)return n-t}return t},_setEndings:function(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=ce,i.endingEnd=ce):(i.endingStart=e?this.zeroSlopeAtStart?ce:Ce:Te,i.endingEnd=t?this.zeroSlopeAtEnd?ce:Ce:Te)},_scheduleFading:function(e,t,n){var i=this._mixer,c=i.time,d=this._weightInterpolant;d===null&&(d=i._lendControlInterpolant(),this._weightInterpolant=d);var m=d.parameterPositions,x=d.sampleValues;return m[0]=c,x[0]=t,m[1]=c+e,x[1]=n,this}}),gp.prototype=Object.assign(Object.create(ko.prototype),{constructor:gp,_bindAction:function(e,t){var n=e._localRoot||this._root,i=e._clip.tracks,c=i.length,d=e._propertyBindings,m=e._interpolants,x=n.uuid,A=this._bindingsByRootAndName,I=A[x];I===void 0&&(I={},A[x]=I);for(var X=0;X!==c;++X){var Q=i[X],re=Q.name,z=I[re];if(z!==void 0)d[X]=z;else{if((z=d[X])!==void 0){z._cacheIndex===null&&(++z.referenceCount,this._addInactiveBinding(z,x,re));continue}var ue=t&&t._propertyBindings[X].binding.parsedPath;++(z=new pp(ea.create(n,re,ue),Q.ValueTypeName,Q.getValueSize())).referenceCount,this._addInactiveBinding(z,x,re),d[X]=z}m[X].resultBuffer=z.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}for(var c=e._propertyBindings,d=0,m=c.length;d!==m;++d){var x=c[d];x.useCount++==0&&(this._lendBinding(x),x.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var c=t[n];--c.useCount==0&&(c.restoreOriginalState(),this._takeBackBinding(c))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return t!==null&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var i=this._actions,c=this._actionsByClip,d=c[t];if(d===void 0)d={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,c[t]=d;else{var m=d.knownActions;e._byClipCacheIndex=m.length,m.push(e)}e._cacheIndex=i.length,i.push(e),d.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex;t[n._cacheIndex=i]=n,t.pop(),e._cacheIndex=null;var c=e._clip.uuid,d=this._actionsByClip,m=d[c],x=m.knownActions,A=x[x.length-1],I=e._byClipCacheIndex;x[A._byClipCacheIndex=I]=A,x.pop(),e._byClipCacheIndex=null,delete m.actionByRoot[(e._localRoot||this._root).uuid],x.length===0&&delete d[c],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var c=t[n];--c.referenceCount==0&&this._removeInactiveBinding(c)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,c=t[i];t[e._cacheIndex=i]=e,t[c._cacheIndex=n]=c},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,c=t[i];t[e._cacheIndex=i]=e,t[c._cacheIndex=n]=c},_addInactiveBinding:function(e,t,n){var i=this._bindingsByRootAndName,c=i[t],d=this._bindings;c===void 0&&(c={},i[t]=c),(c[n]=e)._cacheIndex=d.length,d.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,c=n.path,d=this._bindingsByRootAndName,m=d[i],x=t[t.length-1],A=e._cacheIndex;t[x._cacheIndex=A]=x,t.pop(),delete m[c],Object.keys(m).length===0&&delete d[i]},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,c=t[i];t[e._cacheIndex=i]=e,t[c._cacheIndex=n]=c},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,c=t[i];t[e._cacheIndex=i]=e,t[c._cacheIndex=n]=c},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return n===void 0&&(e[(n=new Wc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,c=t[i];t[e.__cacheIndex=i]=e,t[c.__cacheIndex=n]=c},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var n=t||this._root,i=n.uuid,c=typeof e=="string"?Ma.findByName(n,e):e,d=c!==null?c.uuid:e,m=this._actionsByClip[d],x=null;if(m!==void 0){var A=m.actionByRoot[i];if(A!==void 0)return A;x=m.knownActions[0],c===null&&(c=x._clip)}if(c===null)return null;var I=new Wp(this,c,t);return this._bindAction(I,x),this._addInactiveAction(I,d,i),I},existingAction:function(e,t){var n=t||this._root,i=n.uuid,c=typeof e=="string"?Ma.findByName(n,e):e,d=c?c.uuid:e,m=this._actionsByClip[d];return m!==void 0&&m.actionByRoot[i]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,n=this._bindings,i=this._nActiveBindings;this._nActiveActions=0;for(var c=this._nActiveBindings=0;c!==t;++c)e[c].reset();for(c=0;c!==i;++c)n[c].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,i=this.time+=e,c=Math.sign(e),d=this._accuIndex^=1,m=0;m!==n;++m)t[m]._update(i,e,c,d);var x=this._bindings,A=this._nActiveBindings;for(m=0;m!==A;++m)x[m].apply(d);return this},setTime:function(e){for(var t=this.time=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,i=this._actionsByClip,c=i[n];if(c!==void 0){for(var d=c.knownActions,m=0,x=d.length;m!==x;++m){var A=d[m];this._deactivateAction(A);var I=A._cacheIndex,X=t[t.length-1];A._cacheIndex=null,A._byClipCacheIndex=null,t[X._cacheIndex=I]=X,t.pop(),this._removeInactiveBindingsForAction(A)}delete i[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var i in n){var c=n[i].actionByRoot[t];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}var d=this._bindingsByRootAndName[t];if(d!==void 0)for(var m in d){var x=d[m];x.restoreOriginalState(),this._removeInactiveBinding(x)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),Dd.prototype.clone=function(){return new Dd(this.value.clone===void 0?this.value:this.value.clone())},yp.prototype=Object.assign(Object.create(Ya.prototype),{constructor:yp,isInstancedInterleavedBuffer:!0,copy:function(e){return Ya.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Jp.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){var i=n||[];return vp(e,this,i,t),i.sort(qp),i},intersectObjects:function(e,t,n){var i=n||[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var c=0,d=e.length;c<d;c++)vp(e[c],this,i,t);return i.sort(qp),i}}),Object.assign(Xp.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(vr.clamp(t/this.radius,-1,1))),this}}),Object.assign(Yp.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}});var Zp=new zt;function xp(e,t){this.min=e!==void 0?e:new zt(1/0,1/0),this.max=t!==void 0?t:new zt(-1/0,-1/0)}Object.assign(xp.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=Zp.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new zt),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new zt),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new zt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new zt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Zp.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Kp=new Ae,Ed=new Ae;function wp(e,t){this.start=e!==void 0?e:new Ae,this.end=t!==void 0?t:new Ae}function bp(e){Pt.call(this),this.material=e,this.render=function(){}}Object.assign(wp.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return e===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Ae),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return e===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Ae),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return t===void 0&&(console.warn("THREE.Line3: .at() target is now required"),t=new Ae),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){Kp.subVectors(e,this.start),Ed.subVectors(this.end,this.start);var n=Ed.dot(Ed),i=Ed.dot(Kp)/n;return t&&(i=vr.clamp(i,0,1)),i},closestPointToPoint:function(e,t,n){var i=this.closestPointToPointParameter(e,t);return n===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Ae),this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),((bp.prototype=Object.create(Pt.prototype)).constructor=bp).prototype.isImmediateRenderObject=!0;var $p=new Ae;function Pd(e,t){Pt.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var n=new Dn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],c=0,d=1;c<32;c++,d++){var m=c/32*Math.PI*2,x=d/32*Math.PI*2;i.push(Math.cos(m),Math.sin(m),1,Math.cos(x),Math.sin(x),1)}n.setAttribute("position",new on(i,3));var A=new ki({fog:!1});this.cone=new fi(n,A),this.add(this.cone),this.update()}((Pd.prototype=Object.create(Pt.prototype)).constructor=Pd).prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Pd.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),$p.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt($p),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var rc=new Ae,Od=new fr,Mp=new fr;function Ad(e){for(var t=function X(Q){var re=[];Q&&Q.isBone&&re.push(Q);for(var z=0;z<Q.children.length;z++)re.push.apply(re,X(Q.children[z]));return re}(e),n=new Dn,i=[],c=[],d=new $e(0,0,1),m=new $e(0,1,0),x=0;x<t.length;x++){var A=t[x];A.parent&&A.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),c.push(d.r,d.g,d.b),c.push(m.r,m.g,m.b))}n.setAttribute("position",new on(i,3)),n.setAttribute("color",new on(c,3));var I=new ki({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});fi.call(this,n,I),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Rd(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;var i=new hl(t,4,2),c=new Mr({wireframe:!0,fog:!1});_i.call(this,i,c),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}((Ad.prototype=Object.create(fi.prototype)).constructor=Ad).prototype.updateMatrixWorld=function(e){var t=this.bones,n=this.geometry,i=n.getAttribute("position");Mp.getInverse(this.root.matrixWorld);for(var c=0,d=0;c<t.length;c++){var m=t[c];m.parent&&m.parent.isBone&&(Od.multiplyMatrices(Mp,m.matrixWorld),rc.setFromMatrixPosition(Od),i.setXYZ(d,rc.x,rc.y,rc.z),Od.multiplyMatrices(Mp,m.parent.matrixWorld),rc.setFromMatrixPosition(Od),i.setXYZ(d+1,rc.x,rc.y,rc.z),d+=2)}n.getAttribute("position").needsUpdate=!0,Pt.prototype.updateMatrixWorld.call(this,e)},((Rd.prototype=Object.create(_i.prototype)).constructor=Rd).prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Rd.prototype.update=function(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var jf=new Ae,Qp=new $e,ef=new $e;function Ld(e,t,n){Pt.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var i=new mi(t);i.rotateY(.5*Math.PI),this.material=new Mr({wireframe:!0,fog:!1}),this.color===void 0&&(this.material.vertexColors=2);var c=i.getAttribute("position"),d=new Float32Array(3*c.count);i.setAttribute("color",new en(d,3)),this.add(new _i(i,this.material)),this.update()}function Id(e,t,n,i){e=e||10,t=t||10,n=new $e(n!==void 0?n:4473924),i=new $e(i!==void 0?i:8947848);for(var c=t/2,d=e/t,m=e/2,x=[],A=[],I=0,X=0,Q=-m;I<=t;I++,Q+=d){x.push(-m,0,Q,m,0,Q),x.push(Q,0,-m,Q,0,m);var re=I===c?n:i;re.toArray(A,X),X+=3,re.toArray(A,X),X+=3,re.toArray(A,X),X+=3,re.toArray(A,X),X+=3}var z=new Dn;z.setAttribute("position",new on(x,3)),z.setAttribute("color",new on(A,3));var ue=new ki({vertexColors:2});fi.call(this,z,ue)}function _p(e,t,n,i,c,d){e=e||10,t=t||16,n=n||8,i=i||64,c=new $e(c!==void 0?c:4473924),d=new $e(d!==void 0?d:8947848);var m,x,A,I,X,Q,re,z=[],ue=[];for(I=0;I<=t;I++)A=I/t*(2*Math.PI),m=Math.sin(A)*e,x=Math.cos(A)*e,z.push(0,0,0),z.push(m,0,x),re=1&I?c:d,ue.push(re.r,re.g,re.b),ue.push(re.r,re.g,re.b);for(I=0;I<=n;I++)for(re=1&I?c:d,Q=e-e/n*I,X=0;X<i;X++)A=X/i*(2*Math.PI),m=Math.sin(A)*Q,x=Math.cos(A)*Q,z.push(m,0,x),ue.push(re.r,re.g,re.b),A=(X+1)/i*(2*Math.PI),m=Math.sin(A)*Q,x=Math.cos(A)*Q,z.push(m,0,x),ue.push(re.r,re.g,re.b);var me=new Dn;me.setAttribute("position",new on(z,3)),me.setAttribute("color",new on(ue,3));var ye=new ki({vertexColors:2});fi.call(this,me,ye)}((Ld.prototype=Object.create(Pt.prototype)).constructor=Ld).prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ld.prototype.update=function(){var e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");Qp.copy(this.light.color),ef.copy(this.light.groundColor);for(var n=0,i=t.count;n<i;n++){var c=n<i/2?Qp:ef;t.setXYZ(n,c.r,c.g,c.b)}t.needsUpdate=!0}e.lookAt(jf.setFromMatrixPosition(this.light.matrixWorld).negate())},Id.prototype=Object.assign(Object.create(fi.prototype),{constructor:Id,copy:function(e){return fi.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return new this.constructor().copy(this)}}),(_p.prototype=Object.create(fi.prototype)).constructor=_p;var tf=new Ae,kd=new Ae,nf=new Ae;function jd(e,t,n){Pt.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t===void 0&&(t=1);var i=new Dn;i.setAttribute("position",new on([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var c=new ki({fog:!1});this.lightPlane=new Lo(i,c),this.add(this.lightPlane),(i=new Dn).setAttribute("position",new on([0,0,0,0,0,1],3)),this.targetLine=new Lo(i,c),this.add(this.targetLine),this.update()}((jd.prototype=Object.create(Pt.prototype)).constructor=jd).prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},jd.prototype.update=function(){tf.setFromMatrixPosition(this.light.matrixWorld),kd.setFromMatrixPosition(this.light.target.matrixWorld),nf.subVectors(kd,tf),this.lightPlane.lookAt(kd),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(kd),this.targetLine.scale.z=nf.length()};var Nd=new Ae,Ki=new Aa;function Tp(e){var t=new Dn,n=new ki({color:16777215,vertexColors:1}),i=[],c=[],d={},m=new $e(16755200),x=new $e(16711680),A=new $e(43775),I=new $e(16777215),X=new $e(3355443);function Q(z,ue,me){re(z,me),re(ue,me)}function re(z,ue){i.push(0,0,0),c.push(ue.r,ue.g,ue.b),d[z]===void 0&&(d[z]=[]),d[z].push(i.length/3-1)}Q("n1","n2",m),Q("n2","n4",m),Q("n4","n3",m),Q("n3","n1",m),Q("f1","f2",m),Q("f2","f4",m),Q("f4","f3",m),Q("f3","f1",m),Q("n1","f1",m),Q("n2","f2",m),Q("n3","f3",m),Q("n4","f4",m),Q("p","n1",x),Q("p","n2",x),Q("p","n3",x),Q("p","n4",x),Q("u1","u2",A),Q("u2","u3",A),Q("u3","u1",A),Q("c","t",I),Q("p","c",X),Q("cn1","cn2",X),Q("cn3","cn4",X),Q("cf1","cf2",X),Q("cf3","cf4",X),t.setAttribute("position",new on(i,3)),t.setAttribute("color",new on(c,3)),fi.call(this,t,n),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=d,this.update()}function io(e,t,n,i,c,d,m){Nd.set(c,d,m).unproject(i);var x=t[e];if(x!==void 0)for(var A=n.getAttribute("position"),I=0,X=x.length;I<X;I++)A.setXYZ(x[I],Nd.x,Nd.y,Nd.z)}((Tp.prototype=Object.create(fi.prototype)).constructor=Tp).prototype.update=function(){var e=this.geometry,t=this.pointMap;Ki.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),io("c",t,e,Ki,0,0,-1),io("t",t,e,Ki,0,0,1),io("n1",t,e,Ki,-1,-1,-1),io("n2",t,e,Ki,1,-1,-1),io("n3",t,e,Ki,-1,1,-1),io("n4",t,e,Ki,1,1,-1),io("f1",t,e,Ki,-1,-1,1),io("f2",t,e,Ki,1,-1,1),io("f3",t,e,Ki,-1,1,1),io("f4",t,e,Ki,1,1,1),io("u1",t,e,Ki,.7,1.1,-1),io("u2",t,e,Ki,-.7,1.1,-1),io("u3",t,e,Ki,0,2,-1),io("cf1",t,e,Ki,-1,0,1),io("cf2",t,e,Ki,1,0,1),io("cf3",t,e,Ki,0,-1,1),io("cf4",t,e,Ki,0,1,1),io("cn1",t,e,Ki,-1,0,-1),io("cn2",t,e,Ki,1,0,-1),io("cn3",t,e,Ki,0,-1,-1),io("cn4",t,e,Ki,0,1,-1),e.getAttribute("position").needsUpdate=!0};var Bd=new Xi;function Kc(e,t){this.object=e,t===void 0&&(t=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),c=new Dn;c.setIndex(new en(n,1)),c.setAttribute("position",new en(i,3)),fi.call(this,c,new ki({color:t})),this.matrixAutoUpdate=!1,this.update()}function Cp(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Dn;i.setIndex(new en(n,1)),i.setAttribute("position",new on([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),fi.call(this,i,new ki({color:t})),this.geometry.computeBoundingSphere()}function Sp(e,t,n){this.type="PlaneHelper",this.plane=e,this.size=t===void 0?1:t;var i=n!==void 0?n:16776960,c=new Dn;c.setAttribute("position",new on([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),c.computeBoundingSphere(),Lo.call(this,c,new ki({color:i}));var d=new Dn;d.setAttribute("position",new on([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),d.computeBoundingSphere(),this.add(new _i(d,new Mr({color:i,opacity:.2,transparent:!0,depthWrite:!1})))}((Kc.prototype=Object.create(fi.prototype)).constructor=Kc).prototype.update=function(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Bd.setFromObject(this.object),!Bd.isEmpty()){var t=Bd.min,n=Bd.max,i=this.geometry.attributes.position,c=i.array;c[0]=n.x,c[1]=n.y,c[2]=n.z,c[3]=t.x,c[4]=n.y,c[5]=n.z,c[6]=t.x,c[7]=t.y,c[8]=n.z,c[9]=n.x,c[10]=t.y,c[11]=n.z,c[12]=n.x,c[13]=n.y,c[14]=t.z,c[15]=t.x,c[16]=n.y,c[17]=t.z,c[18]=t.x,c[19]=t.y,c[20]=t.z,c[21]=n.x,c[22]=t.y,c[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}},Kc.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Kc.prototype.copy=function(e){return fi.prototype.copy.call(this,e),this.object=e.object,this},Kc.prototype.clone=function(){return new this.constructor().copy(this)},((Cp.prototype=Object.create(fi.prototype)).constructor=Cp).prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Pt.prototype.updateMatrixWorld.call(this,e))},((Sp.prototype=Object.create(Lo.prototype)).constructor=Sp).prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?T:P,this.lookAt(this.plane.normal),Pt.prototype.updateMatrixWorld.call(this,e)};var Dp,rf,of=new Ae;function $c(e,t,n,i,c,d){Pt.call(this),e===void 0&&(e=new Ae(0,0,1)),t===void 0&&(t=new Ae(0,0,0)),n===void 0&&(n=1),i===void 0&&(i=16776960),c===void 0&&(c=.2*n),d===void 0&&(d=.2*c),Dp===void 0&&((Dp=new Dn).setAttribute("position",new on([0,0,0,0,1,0],3)),(rf=new Ls(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Lo(Dp,new ki({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new _i(rf,new Mr({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,c,d)}function Fd(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Dn;n.setAttribute("position",new on(t,3)),n.setAttribute("color",new on([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new ki({vertexColors:2});fi.call(this,n,i)}(($c.prototype=Object.create(Pt.prototype)).constructor=$c).prototype.setDirection=function(e){if(.99999<e.y)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{of.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(of,t)}},$c.prototype.setLength=function(e,t,n){t===void 0&&(t=.2*e),n===void 0&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},$c.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},$c.prototype.copy=function(e){return Pt.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},$c.prototype.clone=function(){return new this.constructor().copy(this)},(Fd.prototype=Object.create(fi.prototype)).constructor=Fd;var Qu=4,ic=8,Ns=Math.pow(2,ic),af=[.125,.215,.35,.446,.526,.582],sf=ic-Qu+1+af.length,eh=20,Uo={};Uo[Ze]=0,Uo[yt]=1,Uo[Xt]=2,Uo[Gn]=3,Uo[ar]=4,Uo[hi]=5,Uo[Bt]=6;var lf,cf,Ep=new xl,Vd=((cf=new Is({defines:{n:lf=eh},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(lf)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new Ae(0,1,0)},inputEncoding:{value:Uo[Ze]},outputEncoding:{value:Uo[Ze]}},vertexShader:`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx;
		direction.z *= -1.0;
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.z *= -1.0;
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.x *= -1.0;
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.y *= -1.0;
	} else if (face == 5.0) {
		direction.xz *= -1.0;
	}
	return direction;
}
void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`,fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform int samples;
uniform float weights[n];
uniform bool latitudinal;
uniform float dTheta;
uniform float mipInt;
uniform vec3 poleAxis;


uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	

#define ENVMAP_TYPE_CUBE_UV
#include <cube_uv_reflection_fragment>

void main() {
	gl_FragColor = vec4(0.0);
	for (int i = 0; i < n; i++) {
		if (i >= samples)
			break;
		for (int dir = -1; dir < 2; dir += 2) {
			if (i == 0 && dir == 1)
				continue;
			vec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);
			if (all(equal(axis, vec3(0.0))))
				axis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);
			axis = normalize(axis);
			float theta = dTheta * float(dir * i);
			float cosTheta = cos(theta);
			// Rodrigues' axis-angle rotation
			vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross(axis, vOutputDirection) * sin(theta)
					+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);
			gl_FragColor.rgb +=
					weights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);
		}
	}
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:R,depthTest:!1,depthWrite:!1})).type="SphericalGaussianBlur",cf),Qc=null,eu=null,Pp=function(){for(var e=[],t=[],n=[],i=ic,c=0;c<sf;c++){var d=Math.pow(2,i);t.push(d);var m=1/d;ic-Qu<c?m=af[c-ic+Qu-1]:c==0&&(m=0),n.push(m);for(var x=1/(d-1),A=-x/2,I=1+x/2,X=[A,A,I,A,I,I,A,A,I,I,A,I],Q=new Float32Array(108),re=new Float32Array(72),z=new Float32Array(36),ue=0;ue<6;ue++){var me=ue%3*2/3-1,ye=2<ue?0:-1,Pe=[me,ye,0,me+2/3,ye,0,me+2/3,1+ye,0,me,ye,0,me+2/3,1+ye,0,me,1+ye,0];Q.set(Pe,18*ue),re.set(X,12*ue);var Le=[ue,ue,ue,ue,ue,ue];z.set(Le,6*ue)}var Ge=new Dn;Ge.setAttribute("position",new en(Q,3)),Ge.setAttribute("uv",new en(re,2)),Ge.setAttribute("faceIndex",new en(z,1)),e.push(Ge),Qu<i&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}(),Fh=Pp._lodPlanes,uf=Pp._sizeLods,Gd=Pp._sigmas,zd=null,Ti=null,Op=null,tu=(1+Math.sqrt(5))/2,th=1/tu,hf=[new Ae(1,1,1),new Ae(-1,1,1),new Ae(1,1,-1),new Ae(-1,1,-1),new Ae(0,tu,th),new Ae(0,tu,-th),new Ae(th,0,tu),new Ae(-th,0,tu),new Ae(tu,th,0),new Ae(-tu,th,0)];function Ap(e){Ti=e,Rp(Vd)}function df(e){var t={magFilter:pt,minFilter:pt,generateMipmaps:!1,type:e?e.type:kr,format:e?e.format:si,encoding:e?e.encoding:Xt,depthBuffer:!1,stencilBuffer:!1},n=ff(t);return n.depthBuffer=!e,zd=ff(t),n}function pf(e){zd.dispose(),Ti.setRenderTarget(Op),e.scissorTest=!1,e.setSize(e.width,e.height)}function Rp(e){var t=new Hn;t.add(new _i(Fh[0],e)),Ti.compile(t,Ep)}function ff(e){var t=new qi(3*Ns,3*Ns,e);return t.texture.mapping=gt,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Lp(e,t,n,i,c){e.viewport.set(t,n,i,c),e.scissor.set(t,n,i,c)}function mf(e){var t=Ti.autoClear;Ti.autoClear=!1;for(var n=1;n<sf;n++)gf(e,n-1,n,Math.sqrt(Gd[n]*Gd[n]-Gd[n-1]*Gd[n-1]),hf[(n-1)%hf.length]);Ti.autoClear=t}function gf(e,t,n,i,c){yf(e,zd,t,n,i,"latitudinal",c),yf(zd,e,n,n,i,"longitudinal",c)}function yf(e,t,n,i,c,d,m){d!=="latitudinal"&&d!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");var x=new Hn;x.add(new _i(Fh[i],Vd));var A=Vd.uniforms,I=uf[n]-1,X=isFinite(c)?Math.PI/(2*I):2*Math.PI/(2*eh-1),Q=c/X,re=isFinite(c)?1+Math.floor(3*Q):eh;eh<re&&console.warn("sigmaRadians, "+c+", is too large and will clip, as it requested "+re+" samples when the maximum is set to "+eh);for(var z=[],ue=0,me=0;me<eh;++me){var ye=me/Q,Pe=Math.exp(-ye*ye/2);z.push(Pe),me==0?ue+=Pe:me<re&&(ue+=2*Pe)}for(me=0;me<z.length;me++)z[me]=z[me]/ue;A.envMap.value=e.texture,A.samples.value=re,A.weights.value=z,A.latitudinal.value=d==="latitudinal",m&&(A.poleAxis.value=m),A.dTheta.value=X,A.mipInt.value=ic-n,A.inputEncoding.value=Uo[e.texture.encoding],A.outputEncoding.value=Uo[e.texture.encoding];var Le=uf[i];Lp(t,ye=3*Math.max(0,Ns-2*Le),(i===0?0:2*Ns)+2*Le*(ic-Qu<i?i-ic+Qu:0),3*Le,2*Le),Ti.setRenderTarget(t),Ti.render(x,Ep)}function vf(){var e=new Is({uniforms:{envMap:{value:null},texelSize:{value:new zt(1,1)},inputEncoding:{value:Uo[Ze]},outputEncoding:{value:Uo[Ze]}},vertexShader:`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx;
		direction.z *= -1.0;
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.z *= -1.0;
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.x *= -1.0;
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.y *= -1.0;
	} else if (face == 5.0) {
		direction.xz *= -1.0;
	}
	return direction;
}
void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`,fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform vec2 texelSize;


uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	

#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494

void main() {
	gl_FragColor = vec4(0.0);
	vec3 outputDirection = normalize(vOutputDirection);
	vec2 uv;
	uv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;
	uv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;
	vec2 f = fract(uv / texelSize - 0.5);
	uv -= f * texelSize;
	vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x += texelSize.x;
	vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.y += texelSize.y;
	vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x -= texelSize.x;
	vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	vec3 tm = mix(tl, tr, f.x);
	vec3 bm = mix(bl, br, f.x);
	gl_FragColor.rgb = mix(tm, bm, f.y);
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:R,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function xf(){var e=new Is({uniforms:{envMap:{value:null},inputEncoding:{value:Uo[Ze]},outputEncoding:{value:Uo[Ze]}},vertexShader:`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx;
		direction.z *= -1.0;
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.z *= -1.0;
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.x *= -1.0;
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.y *= -1.0;
	} else if (face == 5.0) {
		direction.xz *= -1.0;
	}
	return direction;
}
void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`,fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform samplerCube envMap;


uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	

void main() {
	gl_FragColor = vec4(0.0);
	gl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:R,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function wf(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Nn.call(this,e),this.type="catmullrom",this.closed=!0}function bf(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Nn.call(this,e),this.type="catmullrom"}function Ip(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Nn.call(this,e),this.type="catmullrom"}Ap.prototype={constructor:Ap,fromScene:function(e,t,n,i){t===void 0&&(t=0),n===void 0&&(n=.1),i===void 0&&(i=100),Op=Ti.getRenderTarget();var c=df();return function(d,m,x,A){var I=new Ii(90,1,m,x),X=[1,1,1,1,-1,1],Q=[1,1,-1,-1,-1,1],re=Ti.outputEncoding,z=Ti.toneMapping,ue=Ti.toneMappingExposure,me=Ti.getClearColor(),ye=Ti.getClearAlpha();Ti.toneMapping=tt,Ti.toneMappingExposure=1,Ti.outputEncoding=Ze,d.scale.z*=-1;var Pe=d.background;if(Pe&&Pe.isColor){Pe.convertSRGBToLinear();var Le=Math.max(Pe.r,Pe.g,Pe.b),Ge=Math.min(Math.max(Math.ceil(Math.log2(Le)),-128),127);Pe=Pe.multiplyScalar(Math.pow(2,-Ge));var Qe=(Ge+128)/255;Ti.setClearColor(Pe,Qe),d.background=null}for(var Ve=0;Ve<6;Ve++){var ot=Ve%3;ot==0?(I.up.set(0,X[Ve],0),I.lookAt(Q[Ve],0,0)):ot==1?(I.up.set(0,0,X[Ve]),I.lookAt(0,Q[Ve],0)):(I.up.set(0,X[Ve],0),I.lookAt(0,0,Q[Ve])),Lp(A,ot*Ns,2<Ve?Ns:0,Ns,Ns),Ti.setRenderTarget(A),Ti.render(d,I)}Ti.toneMapping=z,Ti.toneMappingExposure=ue,Ti.outputEncoding=re,Ti.setClearColor(me,ye),d.scale.z*=-1}(e,n,i,c),0<t&&gf(c,0,0,t),mf(c),pf(c),c},fromEquirectangular:function(e){return e.magFilter=pt,e.minFilter=pt,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){Op=Ti.getRenderTarget();var t=df(e);return function(n,i){var c=new Hn;n.isCubeTexture?eu==null&&(eu=xf()):Qc==null&&(Qc=vf());var d=n.isCubeTexture?eu:Qc;c.add(new _i(Fh[0],d));var m=d.uniforms;(m.envMap.value=n).isCubeTexture||m.texelSize.value.set(1/n.image.width,1/n.image.height),m.inputEncoding.value=Uo[n.encoding],m.outputEncoding.value=Uo[n.encoding],Lp(i,0,0,3*Ns,2*Ns),Ti.setRenderTarget(i),Ti.render(c,Ep)}(e,t),mf(t),pf(t),t},compileCubemapShader:function(){eu==null&&Rp(eu=xf())},compileEquirectangularShader:function(){Qc==null&&Rp(Qc=vf())},dispose:function(){Vd.dispose(),eu!=null&&eu.dispose(),Qc!=null&&Qc.dispose();for(var e=0;e<Fh.length;e++)Fh[e].dispose()}},mt.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(mt.prototype),(e.prototype.constructor=e).prototype.getPoint=t,e},Object.assign(vo.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new sr,n=0,i=e.length;n<i;n++){var c=e[n];t.vertices.push(new Ae(c.x,c.y,c.z||0))}return t}}),Object.assign(xo.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),wf.prototype=Object.create(Nn.prototype),bf.prototype=Object.create(Nn.prototype),Ip.prototype=Object.create(Nn.prototype),Object.assign(Ip.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Id.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Ad.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(l.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ep.extractUrlBase(e)}}),l.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(_d.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(xp.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Xi.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),$s.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},wp.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(vr,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),vr.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),vr.ceilPowerOfTwo(e)}}),Object.assign(Si.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(fr.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new Ae().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,i,c,d){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,c,d)}}),no.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Bi.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Ar.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Ri.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Ri,{barycoordFromPoint:function(e,t,n,i,c){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ri.getBarycoord(e,t,n,i,c)},normal:function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ri.getNormal(e,t,n,i)}}),Object.assign(Qo.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ul(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Kl(this,e)}}),Object.assign(zt.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Ae.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Jr.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(sr.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(Pt.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Pt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(_i.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(_i.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Mc.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Eu.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),_c.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(mt.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Ii.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Vr.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(en.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===bo},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(bo)}}}),Object.assign(en.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?bo:Wr),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Dn.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?e==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new en(t,arguments[2])))},addDrawCall:function(e,t,n){n!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Dn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Ya.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===bo},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(Ya.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?bo:Wr),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Rs.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Dd.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(It.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new $e}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===1}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(ks.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Yo.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Su.prototype,{clearTarget:function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Su.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=e===!0?yt:Ze}}}),Object.defineProperties(Ph.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(qi.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties($u.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return new Cd().load(e,function(n){t.setBuffer(n)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),dp.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Xs.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var Nf={merge:function(e,t,n){var i;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};Ga.crossOrigin=void 0,Ga.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var c=new wt;c.setCrossOrigin(this.crossOrigin);var d=c.load(e,n,void 0,i);return t&&(d.mapping=t),d},Ga.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var c=new it;c.setCrossOrigin(this.crossOrigin);var d=c.load(e,n,void 0,i);return t&&(d.mapping=t),d},Ga.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Ga.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Bf={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"113"}})),u.ACESFilmicToneMapping=He,u.AddEquation=C,u.AddOperation=Ee,u.AdditiveBlending=ee,u.AlphaFormat=Ur,u.AlwaysDepth=J,u.AlwaysStencilFunc=Gs,u.AmbientLight=yd,u.AmbientLightProbe=lp,u.AnimationClip=Ma,u.AnimationLoader=ae,u.AnimationMixer=gp,u.AnimationObjectGroup=Hp,u.AnimationUtils=Di,u.ArcCurve=Qt,u.ArrayCamera=fc,u.ArrowHelper=$c,u.Audio=$u,u.AudioAnalyser=dp,u.AudioContext=ap,u.AudioListener=up,u.AudioLoader=Cd,u.AxesHelper=Fd,u.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Fd(e)},u.BackSide=T,u.BasicDepthPacking=aa,u.BasicShadowMap=0,u.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Oe(e)},u.Bone=Rh,u.BooleanKeyframeTrack=Yu,u.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Kc(e,t)},u.Box2=xp,u.Box3=Xi,u.Box3Helper=Cp,u.BoxBufferGeometry=lc,u.BoxGeometry=ah,u.BoxHelper=Kc,u.BufferAttribute=en,u.BufferGeometry=Dn,u.BufferGeometryLoader=Md,u.ByteType=ct,u.Cache=gl,u.Camera=Aa,u.CameraHelper=Tp,u.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},u.CanvasTexture=Ec,u.CatmullRomCurve3=Nn,u.CineonToneMapping=At,u.CircleBufferGeometry=Vc,u.CircleGeometry=Ju,u.ClampToEdgeWrapping=Rn,u.Clock=cp,u.ClosedSplineCurve3=wf,u.Color=$e,u.ColorKeyframeTrack=Zu,u.CompressedTexture=Nu,u.CompressedTextureLoader=pe,u.ConeBufferGeometry=Wu,u.ConeGeometry=Hu,u.CubeCamera=Xs,u.CubeGeometry=ah,u.CubeReflectionMapping=Gt,u.CubeRefractionMapping=jt,u.CubeTexture=Ss,u.CubeTextureLoader=it,u.CubeUVReflectionMapping=gt,u.CubeUVRefractionMapping=ze,u.CubicBezierCurve=Er,u.CubicBezierCurve3=Bn,u.CubicInterpolant=qu,u.CullFaceBack=L,u.CullFaceFront=U,u.CullFaceFrontBack=3,u.CullFaceNone=w,u.Curve=mt,u.CurvePath=vo,u.CustomBlending=W,u.CylinderBufferGeometry=Ls,u.CylinderGeometry=dl,u.Cylindrical=Yp,u.DataTexture=Al,u.DataTexture2DArray=mu,u.DataTexture3D=No,u.DataTextureLoader=Oe,u.DecrementStencilOp=7683,u.DecrementWrapStencilOp=34056,u.DefaultLoadingManager=gd,u.DepthFormat=gr,u.DepthStencilFormat=Wi,u.DepthTexture=Bu,u.DirectionalLight=bl,u.DirectionalLightHelper=jd,u.DirectionalLightShadow=wl,u.DiscreteInterpolant=Xu,u.DodecahedronBufferGeometry=pa,u.DodecahedronGeometry=Wl,u.DoubleSide=B,u.DstAlphaFactor=ie,u.DstColorFactor=be,u.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new en(e,t).setUsage(bo)},u.DynamicCopyUsage=35050,u.DynamicDrawUsage=bo,u.DynamicReadUsage=35049,u.EdgesGeometry=$l,u.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new fi(new $l(e.geometry),new ki({color:t!==void 0?t:16777215}))},u.EllipseCurve=Nt,u.EqualDepth=le,u.EqualStencilFunc=514,u.EquirectangularReflectionMapping=Tn,u.EquirectangularRefractionMapping=mn,u.Euler=g,u.EventDispatcher=ko,u.ExtrudeBufferGeometry=Rs,u.ExtrudeGeometry=ul,u.Face3=yn,u.Face4=function(e,t,n,i,c,d,m){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new yn(e,t,n,c,d,m)},u.FaceColors=1,u.FileLoader=O,u.FlatShading=1,u.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new on(e,t)},u.Float32BufferAttribute=on,u.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Tr(e,t)},u.Float64BufferAttribute=Tr,u.FloatType=Ot,u.Fog=Xa,u.FogExp2=da,u.Font=ip,u.FontLoader=op,u.FrontFaceDirectionCCW=1,u.FrontFaceDirectionCW=0,u.FrontSide=P,u.Frustum=$s,u.GammaEncoding=Bt,u.Geometry=sr,u.GeometryUtils=Nf,u.GreaterDepth=Ye,u.GreaterEqualDepth=Re,u.GreaterEqualStencilFunc=518,u.GreaterStencilFunc=516,u.GridHelper=Id,u.Group=rl,u.HalfFloatType=$t,u.HemisphereLight=Jc,u.HemisphereLightHelper=Ld,u.HemisphereLightProbe=sp,u.IcosahedronBufferGeometry=Rc,u.IcosahedronGeometry=Ra,u.ImageBitmapLoader=np,u.ImageLoader=qe,u.ImageUtils=Ga,u.ImmediateRenderObject=bp,u.IncrementStencilOp=7682,u.IncrementWrapStencilOp=34055,u.InstancedBufferAttribute=bd,u.InstancedBufferGeometry=wd,u.InstancedInterleavedBuffer=yp,u.InstancedMesh=Pu,u.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new bi(e,t)},u.Int16BufferAttribute=bi,u.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new we(e,t)},u.Int32BufferAttribute=we,u.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Rr(e,t)},u.Int8BufferAttribute=Rr,u.IntType=Wt,u.InterleavedBuffer=Ya,u.InterleavedBufferAttribute=gc,u.Interpolant=zo,u.InterpolateDiscrete=jr,u.InterpolateLinear=K,u.InterpolateSmooth=2302,u.InvertStencilOp=5386,u.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},u.KeepStencilOp=sa,u.KeyframeTrack=go,u.LOD=Mc,u.LatheBufferGeometry=Zl,u.LatheGeometry=Fc,u.Layers=S,u.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},u.LessDepth=ge,u.LessEqualDepth=oe,u.LessEqualStencilFunc=515,u.LessStencilFunc=513,u.Light=Vr,u.LightProbe=ds,u.LightShadow=Ia,u.Line=Lo,u.Line3=wp,u.LineBasicMaterial=ki,u.LineCurve=zn,u.LineCurve3=ui,u.LineDashedMaterial=Hc,u.LineLoop=Sc,u.LinePieces=1,u.LineSegments=fi,u.LineStrip=0,u.LinearEncoding=Ze,u.LinearFilter=xn,u.LinearInterpolant=Wc,u.LinearMipMapLinearFilter=1008,u.LinearMipMapNearestFilter=1007,u.LinearMipmapLinearFilter=er,u.LinearMipmapNearestFilter=nn,u.LinearToneMapping=tt,u.Loader=l,u.LoaderUtils=ep,u.LoadingManager=Bh,u.LogLuvEncoding=In,u.LoopOnce=2200,u.LoopPingPong=2202,u.LoopRepeat=2201,u.LuminanceAlphaFormat=Pi,u.LuminanceFormat=Qi,u.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},u.Material=It,u.MaterialLoader=xd,u.Math=vr,u.MathUtils=vr,u.Matrix3=Si,u.Matrix4=fr,u.MaxEquation=h,u.Mesh=_i,u.MeshBasicMaterial=Mr,u.MeshDepthMaterial=qa,u.MeshDistanceMaterial=nl,u.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},u.MeshLambertMaterial=mo,u.MeshMatcapMaterial=fl,u.MeshNormalMaterial=Uc,u.MeshPhongMaterial=ks,u.MeshPhysicalMaterial=Gc,u.MeshStandardMaterial=hs,u.MeshToonMaterial=zc,u.MinEquation=a,u.MirroredRepeatWrapping=Xn,u.MixOperation=ve,u.MultiMaterial=function(e){return e===void 0&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,(e.materials=e).clone=function(){return e.slice()},e},u.MultiplyBlending=E,u.MultiplyOperation=se,u.NearestFilter=pt,u.NearestMipMapLinearFilter=1005,u.NearestMipMapNearestFilter=1004,u.NearestMipmapLinearFilter=qt,u.NearestMipmapNearestFilter=st,u.NeverDepth=Fe,u.NeverStencilFunc=512,u.NoBlending=R,u.NoColors=G,u.NoToneMapping=rt,u.NormalBlending=_,u.NotEqualDepth=Be,u.NotEqualStencilFunc=517,u.NumberKeyframeTrack=js,u.Object3D=Pt,u.ObjectLoader=_d,u.ObjectSpaceNormalMap=Ca,u.OctahedronBufferGeometry=mi,u.OctahedronGeometry=Do,u.OneFactor=j,u.OneMinusDstAlphaFactor=he,u.OneMinusDstColorFactor=je,u.OneMinusSrcAlphaFactor=ne,u.OneMinusSrcColorFactor=q,u.OrthographicCamera=xl,u.PCFShadowMap=N,u.PCFSoftShadowMap=D,u.PMREMGenerator=Ap,u.ParametricBufferGeometry=Oc,u.ParametricGeometry=$o,u.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new bc(e)},u.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Za(e)},u.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new zl(e,t)},u.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Za(e)},u.Path=xo,u.PerspectiveCamera=Ii,u.Plane=no,u.PlaneBufferGeometry=Qs,u.PlaneGeometry=Rl,u.PlaneHelper=Sp,u.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new zl(e,t)},u.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Za(e)},u.PointLight=vl,u.PointLightHelper=Rd,u.Points=zl,u.PointsMaterial=Za,u.PolarGridHelper=_p,u.PolyhedronBufferGeometry=ro,u.PolyhedronGeometry=Fu,u.PositionalAudio=hp,u.PropertyBinding=ea,u.PropertyMixer=pp,u.QuadraticBezierCurve=ri,u.QuadraticBezierCurve3=ji,u.Quaternion=Bi,u.QuaternionKeyframeTrack=ml,u.QuaternionLinearInterpolant=Ql,u.REVISION="113",u.RGBADepthPacking=Ci,u.RGBAFormat=Or,u.RGBAIntegerFormat=Na,u.RGBA_ASTC_10x10_Format=rs,u.RGBA_ASTC_10x5_Format=Sr,u.RGBA_ASTC_10x6_Format=ns,u.RGBA_ASTC_10x8_Format=vs,u.RGBA_ASTC_12x10_Format=Fa,u.RGBA_ASTC_12x12_Format=Ji,u.RGBA_ASTC_4x4_Format=Vs,u.RGBA_ASTC_5x4_Format=ra,u.RGBA_ASTC_5x5_Format=gs,u.RGBA_ASTC_6x5_Format=Oo,u.RGBA_ASTC_6x6_Format=ys,u.RGBA_ASTC_8x5_Format=ia,u.RGBA_ASTC_8x6_Format=oa,u.RGBA_ASTC_8x8_Format=Xr,u.RGBA_PVRTC_2BPPV1_Format=Po,u.RGBA_PVRTC_4BPPV1_Format=Ba,u.RGBA_S3TC_DXT1_Format=es,u.RGBA_S3TC_DXT3_Format=fs,u.RGBA_S3TC_DXT5_Format=na,u.RGBDEncoding=hi,u.RGBEEncoding=Xt,u.RGBEFormat=si,u.RGBFormat=Gr,u.RGBIntegerFormat=ao,u.RGBM16Encoding=ar,u.RGBM7Encoding=Gn,u.RGB_ETC1_Format=ms,u.RGB_PVRTC_2BPPV1_Format=so,u.RGB_PVRTC_4BPPV1_Format=ts,u.RGB_S3TC_DXT1_Format=Fs,u.RGFormat=Eo,u.RGIntegerFormat=Kn,u.RawShaderMaterial=Is,u.Ray=Ar,u.Raycaster=Jp,u.RectAreaLight=vd,u.RedFormat=H,u.RedIntegerFormat=Hr,u.ReinhardToneMapping=xt,u.RepeatWrapping=Zt,u.ReplaceStencilOp=7681,u.ReverseSubtractEquation=M,u.RingBufferGeometry=Bc,u.RingGeometry=Uu,u.Scene=Hn,u.SceneUtils=Bf,u.ShaderChunk=Dr,u.ShaderLib=ba,u.ShaderMaterial=Yo,u.ShadowMaterial=pl,u.Shape=Qo,u.ShapeBufferGeometry=Ka,u.ShapeGeometry=Kl,u.ShapePath=rp,u.ShapeUtils=us,u.ShortType=Ue,u.Skeleton=Eu,u.SkeletonHelper=Ad,u.SkinnedMesh=_c,u.SmoothShading=2,u.Sphere=Kr,u.SphereBufferGeometry=hl,u.SphereGeometry=zu,u.Spherical=Xp,u.SphericalHarmonics3=Sd,u.SphericalReflectionMapping=Qn,u.Spline=Ip,u.SplineCurve=zr,u.SplineCurve3=bf,u.SpotLight=tc,u.SpotLightHelper=Pd,u.SpotLightShadow=yl,u.Sprite=bc,u.SpriteMaterial=ol,u.SrcAlphaFactor=V,u.SrcAlphaSaturateFactor=xe,u.SrcColorFactor=Y,u.StaticCopyUsage=35046,u.StaticDrawUsage=Wr,u.StaticReadUsage=35045,u.StereoCamera=Vp,u.StreamCopyUsage=35042,u.StreamDrawUsage=35040,u.StreamReadUsage=35041,u.StringKeyframeTrack=Ku,u.SubtractEquation=F,u.SubtractiveBlending=k,u.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},u.TangentSpaceNormalMap=va,u.TetrahedronBufferGeometry=Ac,u.TetrahedronGeometry=yr,u.TextBufferGeometry=fo,u.TextGeometry=Ui,u.Texture=Yr,u.TextureLoader=wt,u.TorusBufferGeometry=Jl,u.TorusGeometry=Ic,u.TorusKnotBufferGeometry=yi,u.TorusKnotGeometry=gi,u.Triangle=Ri,u.TriangleFanDrawMode=2,u.TriangleStripDrawMode=1,u.TrianglesDrawMode=0,u.TubeBufferGeometry=Os,u.TubeGeometry=Lc,u.UVMapping=300,u.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new pi(e,t)},u.Uint16BufferAttribute=pi,u.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Mi(e,t)},u.Uint32BufferAttribute=Mi,u.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new tr(e,t)},u.Uint8BufferAttribute=tr,u.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new ci(e,t)},u.Uint8ClampedBufferAttribute=ci,u.Uncharted2ToneMapping=Rt,u.Uniform=Dd,u.UniformsLib=bn,u.UniformsUtils=sh,u.UnsignedByteType=kr,u.UnsignedInt248Type=qr,u.UnsignedIntType=Ke,u.UnsignedShort4444Type=rn,u.UnsignedShort5551Type=hr,u.UnsignedShort565Type=_r,u.UnsignedShortType=lt,u.VSMShadowMap=f,u.Vector2=zt,u.Vector3=Ae,u.Vector4=Jr,u.VectorKeyframeTrack=ec,u.Vertex=function(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Ae(e,t,n)},u.VertexColors=2,u.VideoTexture=Hl,u.WebGLCubeRenderTarget=Ys,u.WebGLMultisampleRenderTarget=zs,u.WebGLRenderTarget=qi,u.WebGLRenderTargetCube=function(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Ys(e,n)},u.WebGLRenderer=Su,u.WebGLUtils=jl,u.WireframeGeometry=Pc,u.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new fi(new Pc(e.geometry),new ki({color:t!==void 0?t:16777215}))},u.WrapAroundEnding=Te,u.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new O(e)},u.ZeroCurvatureEnding=Ce,u.ZeroFactor=y,u.ZeroSlopeEnding=ce,u.ZeroStencilOp=0,u.sRGBEncoding=yt,Object.defineProperty(u,"__esModule",{value:!0})},typeof s=="object"&&r!==void 0?v(s):typeof define=="function"&&define.amd?define(["exports"],v):v((o=o||self).THREE={})},{}],20:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MrxDbgUtils=void 0;var o,v,u=b("three"),w=b("./Operate/MxEntSelJig"),L=b("./Operate/MxJigCmdManager"),U=b("./UI/MxUiVue"),N=b("./Operate/MrxDbgUiPrPoint"),D=b("./Operate/MrxDbgUiPrBase"),f=b("./MxThreeJS");(v=o||(s.MrxDbgUtils=o={})).findEntAtPoint=function(P,T,B,G,R){return B===void 0&&(B=null),G===void 0&&(G=!0),new Promise(function(_){for(var ee=P.findMxEntityAtPoint(T,G,R),k=[],E=ee.length,W=0;W<E;W++){var C=ee[W];if(!B||!B.type||B.type==C.getTypeName()){var F=C.objectId();k.push(F)}}_(k)})},v.selectEnt=function(P,T){return T===void 0&&(T=null),new Promise(function(B){var G=new w.MxEntSelJig;G.disableAllTrace(),G.setDynamicInputType(L.MxJigCmdManager.DynamicInputType.kDynTip),P&&U.MxUiVue.acutPrintf(P),G.filter=T,G.callRet=function(R){B(R)},L.MxJigCmdManager.runCmd(G)})},v.getCorner=function(P,T,B,G,R){return B===void 0&&(B=!1),R===void 0&&(R=!1),new Promise(function(_){var ee=new N.MrxDbgUiPrPoint;ee.setMessage(T),B?(ee.setDynamicInputType(L.MxJigCmdManager.DynamicInputType.kDynTip),ee.disableAllTrace()):(ee.setDynamicInputType(L.MxJigCmdManager.DynamicInputType.kXYCoordInput),R&&ee.disableAllTrace());var k=new D.McEdGetPointWorldDrawObject;k.setDraw(function(E,W){var C=new u.Vector3(P.x,E.y,E.z),F=new u.Vector3(E.x,P.y,E.z),M=[];M.push(P),M.push(C),M.push(E),M.push(F),M.push(P);var a=null,h=65280;if(B){if(E.x>P.x)a=f.MxThreeJS.createLines(M,16777215),h=255;else{var y=W.getMcEdJig().getMxObject().viewCoordLong2Cad(3);a=f.MxThreeJS.createDashedLines(M,16777215,2*y,y)}var j=[];j.push(P),j.push(C),j.push(E),j.push(P),j.push(E),j.push(F);var Y=f.MxThreeJS.createTriangle(j,h,.27);W.drawEntity(Y,30),W.drawEntity(a,31)}else a=f.MxThreeJS.createLines(M,16777215),W.drawEntity(a,31)}),ee.setUserDraw(k),ee.go(function(E){G&&G({status:E,detailedResult:ee.getDetailedResult()}),E!=0?_(null):(ee.clearLastInputPoint(),_(ee.value()))})})}},{"./MxThreeJS":36,"./Operate/MrxDbgUiPrBase":44,"./Operate/MrxDbgUiPrPoint":46,"./Operate/MxEntSelJig":49,"./Operate/MxJigCmdManager":53,"./UI/MxUiVue":64,three:19}],21:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxDrawCommands=void 0;var o,v=b("./MxFun"),u=b("./MxType"),w=b("./Operate/MxIntelliSelect"),L=b("./Operate/MxJigCmdManager");function U(B){B!=null&&B.grips!=null&&B.ids!=null&&v.MxFun.getCurrentMx().getMcObject().getGripManager().gripEditImp(B)}function N(B){if(B!=null&&B.pt!=null){var G=v.MxFun.getCurrentMx(),R=B.pt;if(!G.getMxDatabase().getGripManager().doPointSelect(R)){var _=!0;if(G.isValidMcObject()&&G.getMcObject().getGripManager().doPointSelect(R)&&(_=!1),v.MxFun.isPC()||(_=!1),_&&G.isMultipleSelect){var ee=G.screenCoord2Current(R.x,R.y,0),k=new w.MxIntelliSelectJig(ee);k.setDisableDynInput(!0),k.setDisableOsnap(!0),L.MxJigCmdManager.runCmd(k)}}}}function D(B){B!=null&&B.grips!=null&&B.ents!=null&&v.MxFun.getCurrentMx().getMxDatabase().getGripManager().gripEditImp(B)}function f(){v.MxFun.getCurrentMx().getMcObject().undo()}function P(){v.MxFun.getCurrentMx().getMcObject().redo()}function T(){v.MxFun.getCurrentMx().startPanCommand()}(o||(s.MxDrawCommands=o={})).registerCommand=function(){v.MxFun.addCommand("Mx_FrontEndWebpageIntelliSel",N,u.MxType.MxCommandFlag.MCRX_CMD_TRANSPARENT|u.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER|u.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT|u.MxType.MxCommandFlag.MCRX_CMD_NO_RECORD_PRVCMD),v.MxFun.addCommand("Mx_FrontEndWebpageGripEdit",D,u.MxType.MxCommandFlag.MCRX_CMD_TRANSPARENT|u.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER|u.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT|u.MxType.MxCommandFlag.MCRX_CMD_NO_RECORD_PRVCMD),v.MxFun.addCommand("McDraw_GripEdit",U,u.MxType.MxCommandFlag.MCRX_CMD_TRANSPARENT|u.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT|u.MxType.MxCommandFlag.MCRX_CMD_NO_RECORD_PRVCMD),v.MxFun.addCommand("Mx_Undo",f,u.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER),v.MxFun.addCommand("Mx_Redo",P,u.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER),v.MxFun.addCommand("Mx_Pan",T,u.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER)}},{"./MxFun":27,"./MxType":38,"./Operate/MxIntelliSelect":51,"./Operate/MxJigCmdManager":53}],22:[function(b,r,s){var o,v;Object.defineProperty(s,"__esModule",{value:!0}),s.MxDrawData=void 0,(v=o||(s.MxDrawData=o={})).m_dInputRectWidth=16,v.m_isEnableIntelliSelect=!0,v.m_isEnableGripEidt=!0,v.m_isForbiddenDynInput=!1,v.m_isMultipleSelect=!1,v.m_isAutoResetRenderer=!1,v.m_isCorrectLargeCoordinates=!0,v.m_isRequestHeaderCacheControl=!1,v.m_gripPointColor=3355443455,v.m_isMapBox=!1,v.setIniset=function(u){u.EnableIntelliSelect!==void 0&&typeof u.EnableIntelliSelect=="boolean"&&(v.m_isEnableIntelliSelect=u.EnableIntelliSelect),u.EnableGripEidt!==void 0&&typeof u.EnableGripEidt=="boolean"&&(v.m_isEnableGripEidt=u.EnableGripEidt),u.ForbiddenDynInput!==void 0&&typeof u.ForbiddenDynInput=="boolean"&&(v.m_isForbiddenDynInput=u.ForbiddenDynInput),u.multipleSelect!==void 0&&typeof u.multipleSelect=="boolean"&&(v.m_isMultipleSelect=u.multipleSelect),u.autoResetRenderer!==void 0&&typeof u.autoResetRenderer=="boolean"&&(v.m_isAutoResetRenderer=u.autoResetRenderer),u.correctLargeCoordinates!==void 0&&typeof u.correctLargeCoordinates=="boolean"&&(v.m_isCorrectLargeCoordinates=u.correctLargeCoordinates),u.requestHeaderCacheControl!==void 0&&typeof u.requestHeaderCacheControl=="boolean"&&(v.m_isRequestHeaderCacheControl=u.requestHeaderCacheControl),u.MapBox!==void 0&&typeof u.MapBox=="boolean"&&(v.m_isMapBox=u.MapBox),u.inputRectWidth!==void 0&&typeof u.inputRectWidth=="number"&&(v.m_dInputRectWidth=u.inputRectWidth),u.gripPointColor!==void 0&&typeof u.gripPointColor=="number"&&(v.m_gripPointColor=u.gripPointColor)}},{}],23:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxDrawObject=s.IniSetName=s.MxRunMode=void 0;var o,v,u,w=b("three"),L=b("./MxFun"),U=b("./View/MxBrowseLayerData"),N=b("./View/MxBrowseDisplay"),D=b("./MxNetData"),f=b("./MxNetData"),P=b("./MxManager"),T=b("./MxSystemVariable"),B=b("./MxLocalFileLoad"),G=b("./Operate/MxDrawObjectOsnap"),R=b("./View/MxDbDatabase"),_=b("./View/MxDrawMapBox"),ee=b("./MxDrawObjectEvent"),k=b("./View/MxDbEntityGrip"),E=b("./cpp/McDrawObject"),W=b("./UI/MxUiVue"),C=b("./MxDrawData");(v=o||(s.MxRunMode=o={}))[v.kBrowse=1]="kBrowse",v[v.kCPPMxCAD=4]="kCPPMxCAD",(u||(s.IniSetName=u={})).kEnableOsnapFunction="EnableOsnapFunction";var F=(M.prototype.getCurrentMousePostion=function(){return this.curMousePostion},M.prototype.isValidCurMousePostion=function(){return this.m_isValidCurMousePostion},M.prototype.setCurrentMousePostion=function(a){this.curMousePostion.x=a.offsetX,this.curMousePostion.y=a.offsetY,this.m_isValidCurMousePostion=!0},M.prototype.mapBoxRender=function(a,h,y){this.mcObject.updateDisplayMapBox(h),y||(this.camera.projectionMatrix=h,this.renderer.autoClear=!1,this.renderer.state.reset(),this.secenView&&this.renderer.render(this.secenView,this.cameraView),this.renderer.render(this.scene,this.camera),this._callCreateCanvasImageData!=null&&(this._callCreateCanvasImageData(this.renderer.domElement.toDataURL("image/png")),this._callCreateCanvasImageData=void 0)),this.callEvent("render",this.renderer)},M.prototype.mapBoxInitThreeJSObject=function(a,h,y,j){this.scene=a,this.camera=h,this.renderer=y,this.controls=j},M.prototype.getMxDrawThreeJs=function(){return this.mxdrawThreeJS},M.prototype.setPointMultipleSelect=function(a){this.isPointMultipleSelect=a},M.prototype.pointMultipleSelect=function(){return this.isPointMultipleSelect},M.prototype.getMcObject=function(){return this.mcObject},M.prototype.getSysVarLong=function(a){return this.mcObject.isValid()?this.mcObject.getSysVarLong(a):this.m_sysVariable.getSysVarNumber(a)},M.prototype.getSysVarDouble=function(a){return this.mcObject.isValid()?this.mcObject.getSysVarDouble(a):this.m_sysVariable.getSysVarNumber(a)},M.prototype.getSysVarPoint=function(a){return this.mcObject.isValid()?this.mcObject.getSysVarPoint(a):this.m_sysVariable.getSysVarPoint(a)},M.prototype.getCAD2DocMatrix=function(){return this._cad2Doc},M.prototype.isValidMcObject=function(){return this.mcObject.isValid()},M.prototype.getId=function(){return this.id},M.prototype.getEventManager=function(){return this.eventManager},M.prototype.setCurrentLoadUrl=function(a){this._sCurrentLoadURL=a},M.prototype.getCurrentLoadUrl=function(){return this._sCurrentLoadURL},M.prototype.isWebgl2=function(){return!(!this._rendererParam||this._rendererParam.retver!="webgl2")},M.prototype.getMxDatabase=function(){return this.m_mxDatabase},M.prototype.updateCanvasSize=function(){this._onResizeFun&&this._onResizeFun()},M.prototype.addMxEntity=function(a){return this.m_mxDatabase.addMxEntity(a)},M.prototype.getMxEntity=function(a){return this.m_mxDatabase.getEntity(a)},M.prototype.getMxEntityUserObject=function(a){var h=this.getMxEntity(a);return h?h.getUserObject():null},M.prototype.eraseAllMxEntity=function(){this.m_mxDatabase.eraseAllEntity()},M.prototype.eraseMxEntity=function(a){var h=this.m_mxDatabase.getEntity(a);return!!h&&h.erase()},M.prototype.getAllMxEntity=function(){var a=[];return this.m_mxDatabase.getAllEntity().forEach(function(h){h&&a.push(h.getUserObject())}),a},M.prototype.getMxAllSelect=function(){var a=this.m_mxDatabase.getSelectManager().getAllSelect(),h=this.m_mxDatabase.getGripManager().getAllSelect(),y=new Set;return a.forEach(function(j){y.add(j)}),h.forEach(function(j){y.has(j)||a.push(j)}),a},M.prototype.getPrvCommandSelect=function(){return this.m_mxDatabase.getSelectManager().getPrvCommandSelect()},M.prototype.getMxCADAllSelect=function(){return this.mcObject.isValid()?this.mcObject.getGripManager().getAllSelect():[]},M.prototype.getSelectPoints=function(){return this.mcObject.getGripManager().getSelectPoints()},M.prototype.getPrvCommandMxCADSelect=function(){return this.mcObject.isValid()?this.mcObject.getGripManager().getPrvCommandSelect():[]},M.prototype.addMxCurrentSelect=function(a,h,y){return h===void 0&&(h=!0),y===void 0&&(y=!0),this.m_mxDatabase.getGripManager().addSelect(a,h,y)},M.prototype.addMxCADCurrentSelect=function(a,h,y){return h===void 0&&(h=!0),y===void 0&&(y=!0),!!this.mcObject.isValid()&&this.mcObject.getGripManager().addSelect(a,h,y)},M.prototype.fireSelectChange=function(a){if(a){if(this.mcObject.isValid())return this.mcObject.getGripManager().fireSelectChange()}else this.m_mxDatabase.getGripManager().fireMxEntitySelectChange()},M.prototype.clearMxCurrentSelect=function(){var a=this.m_mxDatabase.clearMxCurrentSelect();return this.mcObject.isValid()&&this.mcObject.getGripManager().clearAll(),a},M.prototype.addViewObject=function(a){this.secenView?this.threejsselectObjectsView.add(a):console.log("this.secenView is null")},M.prototype.removeViewObject=function(a){L.MxFun.removeThreejsObject(a,this.threejsselectObjectsView)},M.prototype.setOtherRefFile=function(a){this._tzDwgStaticFile=a},M.prototype.setRequestHeader=function(a){this._requestHeader=a},M.prototype.initZoomW=function(a,h){this._initZoomwCoordPt1=a.clone(),this._initZoomWCoordPt2=h.clone()},M.prototype.setMouseRightRotate=function(a){this._mouseRightRotate=a,this.controls!=null&&(this.controls.mouseButtons.RIGHT=a?w.MOUSE.ROTATE:-1)},M.prototype.setZoomSpeed=function(a){var h=this.controls.zoomSpeed;return this.controls.zoomSpeed=a,h},M.prototype.resetRenderer=function(){this.renderer.info.reset()},M.prototype.getRenderer=function(){return this.renderer},M.prototype.isPaningCommand_call=function(){return this.bakControls!=null},M.prototype.startPanCommand_call=function(){this.bakControls={},this.bakControls.LEFT=this.controls.mouseButtons.LEFT,this.bakControls.RIGHT=this.controls.mouseButtons.RIGHT,this.bakControls.MIDDLE=this.controls.mouseButtons.MIDDLE,this.controls.mouseButtons.LEFT=w.MOUSE.PAN,this._mouseRightRotate?this.controls.mouseButtons.RIGHT=w.MOUSE.ROTATE:this.controls.mouseButtons.RIGHT=-1,this.controls.mouseButtons.MIDDLE=1,W.MxUiVue.setCursorType(W.MxUiVue.CursorType.kPan)},M.prototype.endPanCommand_call=function(){this.bakControls&&(this.controls.mouseButtons.LEFT=this.bakControls.LEFT,this.controls.mouseButtons.RIGHT=this.bakControls.RIGHT,this.controls.mouseButtons.MIDDLE=this.bakControls.MIDDLE,this.bakControls=void 0,W.MxUiVue.setCursorType(W.MxUiVue.CursorType.kNormal))},M.prototype.isPaningCommand=function(){return this.mxdrawThreeJS.isPaningCommand()},M.prototype.startPanCommand=function(){this.mxdrawThreeJS.startPanCommand()},M.prototype.endPanCommand=function(){this.mxdrawThreeJS.endPanCommand()},M.prototype.setMouseMiddlePan=function(a){this._isMouseMiddlePan=typeof a=="boolean"?a?1:0:a,this.controls!=null&&(this._isMouseMiddlePan==1?(this.controls.mouseButtons.LEFT=-1,this.controls.mouseButtons.RIGHT=-1,this.controls.mouseButtons.MIDDLE=w.MOUSE.PAN):this._isMouseMiddlePan==2?(this.controls.mouseButtons.LEFT=w.MOUSE.PAN,this.controls.mouseButtons.RIGHT=-1,this.controls.mouseButtons.MIDDLE=w.MOUSE.PAN):(this.controls.mouseButtons.LEFT=w.MOUSE.PAN,this._mouseRightRotate?this.controls.mouseButtons.RIGHT=w.MOUSE.ROTATE:this.controls.mouseButtons.RIGHT=-1,this.controls.mouseButtons.MIDDLE=1))},M.prototype.resetThreeJSControls=function(){this.controls&&(this.controls.saveState(),this.controls.reset())},M.prototype.enableZoom=function(a){this.controls!=null&&(this.controls.enableZoom=a)},M.prototype.enablePan=function(a){this.controls!=null&&(this.controls.enablePan=a)},M.prototype.getOrbitControls=function(){return this.controls},M.prototype.enableViewControls=function(a){this.controls.enabled=a},M.prototype.initRunMode=function(a){this._isCreate?console.log("iniRunMode failed,mxobject already created"):this._runMode=a},M.prototype.getRunMode=function(){return this._runMode},M.prototype.setStaticLocalLoad=function(a){this._isStaticLocalLoad=a},M.prototype.isStaticLocalLoad=function(){return this._isStaticLocalLoad},M.prototype.setStaticLocalLoadPath=function(a){this._staticLocalLoadPath=a},M.prototype.on=function(a,h){if(this._event[a])if(this._event[a]instanceof Array)this._event[a].includes(h)||this._event[a].push(h);else{var y=this._event[a];if(y==h)return;this._event[a]=[],this._event[a].push(y),this._event[a].push(h)}else this._event[a]=h},M.prototype.addEvent=function(a,h){this.on(a,h)},M.prototype.addControlsEvent=function(a,h,y){return y===void 0&&(y=!1),this.eventManager.addEventListener(a,h,y)},M.prototype.removeEvent=function(a){this._event[a]=void 0},M.prototype.removeEventFuction=function(a,h){if(this._event[a]){if(this._event[a]instanceof Array){var y=this._event[a].indexOf(h);if(y!=-1)return this._event[a].splice(y,1),this._event[a].length==0&&(this._event[a]=void 0),!0}else if(this._event[a]==h)return!(this._event[a]=void 0)}return!1},M.prototype.sysVariable=function(){return this.m_sysVariable},M.prototype.setIniset=function(a){var h=this;Object.keys(a).forEach(function(y){h.m_iniSet[y]=a[y]}),C.MxDrawData.setIniset(a),a.multipleSelect!==void 0&&typeof a.multipleSelect=="boolean"&&(this.isMultipleSelect=a.multipleSelect)},M.prototype.getInisetValue=function(a){return this.m_iniSet[a]},M.prototype.getViewColor=function(){return this._viewcolor},M.prototype.isWhiteViewColor=function(){return this._viewcolor==16777215},M.prototype.initUserLoginData=function(a,h){this._userIdentitySign=a,this._userRandomToken=h},M.prototype.initRendererParam=function(a){this._rendererParam=a},M.prototype.getRendererParam=function(){return this._rendererParam},M.prototype.automaticInversionColor=function(a){return this._viewcolor!=16777215||a!=16777215?a:0},M.prototype.automaticInversionColor2=function(a){return this._viewcolor==16777215&&(16777215&a)==16777215?4278190080&a:a},M.prototype.setViewColor=function(a){this._viewcolor=a,this._runMode!=o.kCPPMxCAD&&this.scene!=null&&(this.scene.background=new w.Color(a))},M.prototype.zoomScale=function(a,h){this.mxdrawThreeJS.zoomScale(a,h)},M.prototype.setViewAngle=function(a){this.mxdrawThreeJS.setViewAngle(a)},M.prototype.zoomW=function(a,h,y,j,Y){Y===void 0&&(Y=!1),this.mxdrawThreeJS.zoomW(a,h,y,j,Y)},M.prototype.zoomCenter=function(a,h,y){this.mxdrawThreeJS.zoomCenter(a,h,y)},M.prototype.getViewAngle=function(){return this._viewangle},M.prototype.callInitCompleteEvent=function(){this.callEvent("loadComplete")},M.prototype.callInitObjectEvent=function(){this.callEvent("initObject")},M.prototype.callInitSceneEvent=function(a,h,y){var j=this._event.initScene;if(!j)return 0;if(j instanceof Array){var Y=0;return j.forEach(function(q){Y=q(a,h,y)}),Y}return j(a,h,y)},M.prototype.callOpenFileComplete=function(a,h){h===void 0&&(h=0);try{var y=this._event.openFileComplete;if(!y)return;y instanceof Array?y.forEach(function(j){j(a,h)}):y(a,h)}catch(j){throw console.log(j),j}},M.prototype.hasEvent=function(a){return this._event[a]!=null},M.prototype.regenAllMxDbEntity=function(){return this.m_mxDatabase.regenAllMxDbEntity()},M.prototype.callEvent=function(a,h){try{var y=this._event[a];if(!y)return!1;if(y instanceof Array){var j=!1;return y.forEach(function(Y){j=Y(h)}),j}return y(h)}catch(Y){throw console.log(Y),Y}},M.prototype.callViewChange=function(){this.onViewChange(),this.callEvent("viewchange")},M.prototype.userLoginResult=function(a){this.callEvent("userLoginResult",a)},M.prototype.serverReturn=function(a){var h=JSON.parse(a);this.callEvent("serverReturn",h)},M.prototype.openFileResult=function(a){JSON.parse(a).linkServer||console.log("link mx serverobj error"),this.callEvent("openFileResult",a)},M.prototype.xzSize=function(a){var h=this._devicePixelRatio;if(h-1<=1e-4&&-1e-4<=h-1)return a;for(var y=9999999,j=a,Y=0,q=a;Y<100;Y++){if((ne=(V=q*h)-Math.floor(V))<=.001)return q;ne<y&&(y=ne,j=q),q+=1}for(q=a;Y<100;Y++){var V,ne;if((ne=(V=q*h)-Math.floor(V))<=.001)return q;ne<y&&(y=ne,j=q),--q}return j},M.prototype.setSize=function(a,h){this._viewWidth=a,this._viewHeight=h,this._userCanvas!=null&&(this._userCanvas.width=a,this._userCanvas.height=h,this._userCanvas.style.width=a+"px",this._userCanvas.style.height=h+"px"),this.onResizeImp(),this.updateDisplay()},M.prototype.getCurrentColor=function(){return this._color},M.prototype.setCurrentColor=function(a){this._color=a},M.prototype.call=function(a,h,y){this._net.getSend().CallServerJS(a,h,y)},M.prototype.zoomAll=function(){this._is2d&&this.call("getDatabaseBoundHelp",'{"isBackground":1}',function(a){if(a.length!=0){var h=JSON.parse(a);this.zoomW(new w.Vector3(h[0],h[1],0),new w.Vector3(h[2],h[3],0))}})},M.prototype.getViewCenterDocCoord=function(){return this._userCanvas!=null?this.screenCoord2Current(.5*this._userCanvas.clientWidth,.5*this._userCanvas.clientHeight,0):this.screenCoord2Current(.5*this._viewWidth,.5*this._viewHeight,0)},M.prototype.closeWebSocket=function(){this._net.closeWebSocket()},M.prototype.findMxEntityAtPoint=function(a,h,y){!h&&h!==void 0||(a=this.currentCoord2Screen(a.x,a.y,0));var j=[],Y=this.m_mxDatabase.getIntersectObjects(a);if(Y.length==0)return j;var q=new Map;return Y.forEach(function(V){var ne=(0,k.MxGetMxDbEntitForThreeJsObject)(V.object);if(ne){var ie=ne.objectId();if(!q.has(ie)){if(y){var he=(0,k.MxGetWordDrawxDataForThreeJsObject)(V.object);he&&y(ie,he)}q.set(ie,ne.getUserObject())}}}),q.forEach(function(V){j.push(V)}),j},M.prototype.isCppMxCAD=function(){return this._runMode==o.kCPPMxCAD},M.prototype.loadMxCADImage=function(a,h){var y=this;if(this.mcObject.isValid()){var j=a;j.lastIndexOf("/")!=-1&&(j=j.substring(j.lastIndexOf("/")+1).toLowerCase()),this.mcObject.getTextureManager().loadImage(a,j,function(Y,q){Y?(y.mcObject.getTextureManager().createOpenGLTexture(a),h(q)):h(void 0)})}else h(void 0)},M.prototype.onLoad=function(a){if(this._runMode==o.kCPPMxCAD)this.callInitCompleteEvent();else if(this._isStaticLocalLoad)this._net=new f.MxNet,this._net.init(this,!1),0<this._openFile.length&&(this._staticLocalNet=new B.MxLocalDwgFileLoad(this._net),this._staticLocalNet.load(encodeURIComponent(this._staticLocalLoadPath),encodeURIComponent(this._openFile)));else if(this._openFile.length==0)this.callInitCompleteEvent(),this.callOpenFileComplete(0);else if(this._net=new f.MxNet,this._net.init(this,!1),this._staticNet=new f.MxHFileLoad(this._net),this._staticNet.setRequestHeader(this._requestHeader),this._staticNet.setUrlParam(a),this._staticNet.load(this._openFile,this._staticLoadingOpenFiles),this._tzDwgStaticFile&&0<this._tzDwgStaticFile.length){var h=new f.MxNet;h.init(this,!1),this._extRefManager.createTzDwgExternalReferences(99999),h.setCurrentDatabaseId(99999),this._staticLoadTzNet=new f.MxHFileLoad(h),this._staticLoadTzNet.setShowloading(!1),this._staticLoadTzNet.setRequestHeader(this._requestHeader),this._staticLoadTzNet.load(this._tzDwgStaticFile,[])}},M.prototype.stopAllLoading=function(){this._staticNet&&this._staticNet.stopAllLoading()},M.prototype.getStaticNet=function(){return this._staticNet},M.prototype.isStaticFileNet=function(){return!this._isStaticLocalLoad&&this._staticNet!=null},M.prototype.getStaticLocalNet=function(){return this._staticLocalNet},M.prototype.getStaticLoadTzNet=function(){return this._staticLoadTzNet},M.prototype.getViewWidth=function(){return this._userCanvas!=null?this._userCanvas.clientWidth:this._viewWidth},M.prototype.getViewHeight=function(){return this._userCanvas!=null?this._userCanvas.clientHeight:this._viewHeight},M.prototype.makeCurrent=function(){P.MxManager.setCurrentMx(this)},M.prototype.createCanvasImageData=function(a,h){var y=0,j=0,Y=!1,q=!1,V=!1;h&&h.range_pt1&&h.range_pt2&&(V=q=!0,this.saveZoom()),h&&h.width&&h.height&&(y=this.getViewWidth(),j=this.getViewHeight(),Y=!0,this.setSize(h.width,h.height)),V&&this.zoomW(h.range_pt1,h.range_pt2);var ne=this;this._callCreateCanvasImageData=function(ie){Y&&ne.setSize(y,j),q&&ne.recoverZoom(),a(ie)},this.updateDisplay()},M.prototype.addObject=function(a){this.threejsselectObjects.add(a)},M.prototype.removeAllSelectObject=function(){for(;this.threejsselectObjects.children.length;)this.threejsselectObjects.remove(this.threejsselectObjects.children[0])},M.prototype.removeObject=function(a){this.threejsselectObjects.remove(a)},M.prototype.render=function(){this.secenView?(this.mcObject.updateDisplay()?(this.renderer.autoClear=!1,this.renderer.state.reset()):this.renderer.autoClear=!0,this.renderer.render(this.secenView,this.cameraView),this.renderer.autoClear=!1):this.mcObject.updateDisplay()?(this.renderer.autoClear=!1,this.renderer.state.reset()):this.renderer.autoClear=!0,this.renderer.render(this.scene,this.camera),this._callCreateCanvasImageData!=null&&(this._callCreateCanvasImageData(this.renderer.domElement.toDataURL("image/png")),this._callCreateCanvasImageData=void 0),this.callEvent("render",this.renderer)},M.prototype.updateDisplay=function(a){a===void 0&&(a=!1),this.mxdrawThreeJS.updateDisplay(a)},M.prototype.isRenderLoop=function(){return this._isAnimation},M.prototype.renderLoop=function(a){a===void 0&&(a=!0),this._isAnimation=a,this.updateDisplay()},M.prototype.updateDisplayImplement=function(a){a===void 0&&(a=!1);var h=this,y=function(){h.m_mxDatabase.upDirtyDisplay(),h._isAnimation?(h._isAnimationStarting=!0,requestAnimationFrame(y)):h._isWaiteCount=0,h.render()};a!==!0?this._isAnimationStarting||(this._isAnimation?requestAnimationFrame(y):((5<this._isWaiteCount||this._isWaiteCount<0)&&(this._isWaiteCount=0),this._isWaiteCount<=0&&requestAnimationFrame(y),this._isWaiteCount++)):y()},M.prototype.gotoLayoutOld=function(a){a=="Modle"&&(a="");var h=this._openFile;for(var y in this._iniParam)(V=(q=this._iniParam[y])[0])=="srcname"&&(h=q[1]);var j={},Y="";for(var y in this._iniParam){var q,V;if(j[V=(q=this._iniParam[y])[0]]==null){j[V]=!0;var ne=q[1];if(V=="file"){if(ne=h,0<a.length){var ie=ne.substring(ne.lastIndexOf(".")+1);ne=ne.substring(0,ne.lastIndexOf("."))+"%23"+a+"%23."+ie}}else if(V=="srcname")continue;Y.length==0?Y=V+"="+ne+"&srcname="+h:Y+="&"+V+"="+ne}}var he=L.MxFun.getLocationPageUrl()+"?"+Y;window.location.href=he},M.prototype.gotoLayout=function(a){var h=!1,y=!this.isStaticFileNet();for(var j in this._iniParam)if((he=this._iniParam[j])[0]=="dwgdir"){h=!0;break}if(h||y)this.gotoLayoutOld(a);else{a=="Model"&&(a="");var Y=this._openFile;if(!Y)return;var q=Y.lastIndexOf(".dwg");if(q===void 0||q===-1)return;if((Y=Y.substring(0,q))[Y.length-1]=="#"){var V=Y.substring(0,Y.length-1),ne=V.lastIndexOf("#");ne!==void 0&&ne!==-1&&(Y=V.substring(0,ne))}0<a.length?Y=Y+"#"+a+"#.dwg.mxb1.wgh":Y+=".dwg.mxb1.wgh";var ie={};for(var j in this._iniParam){var he,be=(he=this._iniParam[j])[0];if(ie[be]==null){ie[be]=!0;var je=he[1];be!="file"&&be!="srcname"&&(Y+="&"+be+"="+je)}}var xe=L.MxFun.getLocationPageUrl()+"?file="+Y;window.location.href=encodeURI(xe)}},M.prototype.addInitParam=function(a,h){var y=new Array;y.push(a),y.push(h),this._iniParam.push(y)},M.prototype.openFile=function(a,h){if(h===void 0&&(h=""),!this._isCreate)return console.log("mx: openFile Fialed mxasser(_isCreate == false)"),!1;if(this.stopAllLoading(),a.length==0)return!1;this.reInit(),this._devicePixelRatio=window.devicePixelRatio,a instanceof Array?(this._openFile=a[0],this._staticLoadingOpenFiles=a):this._openFile=a,this._openFileExtName=this._openFile.substring(this._openFile.lastIndexOf(".")+1),this._iniParam=[],this._initZoomwCoordPt1=null,this._initZoomWCoordPt2=null;var y=new Array;return y.push("file"),y.push(this._openFile),this._iniParam.push(y),this.onLoad(h),!0},M.prototype.updateCameraDisplayRange=function(a,h,y){this.mxdrawThreeJS.updateCameraDisplayRange(a,h,y)},M.prototype.clearAllObject=function(){this.reInit()},M.prototype.newFile=function(a,h,y,j){if(!this._isCreate)return console.log("mx: openFile Fialed mxasser(_isCreate == false)"),!1;var Y,q;if(q=a instanceof Object&&h instanceof Object?(Y=a,h):(Y=new w.Vector3(a,h,0),new w.Vector3(y,j,0)),Y.x>q.x){var V=Y.x;Y.x=q.x,q.x=V}if(Y.y>q.y){var ne=Y.y;Y.y=q.y,q.y=ne}this.reInit(),this._devicePixelRatio=window.devicePixelRatio,this._openFile="",this._openFileExtName="dwg",this._iniParam=[],this._initZoomwCoordPt1=null,this._initZoomWCoordPt2=null;var ie=new w.Matrix4;ie.identity(),this.intiDoc2Wold(ie),this.initCAD2Doc(ie),this.initializingObjectMatrix(),this.mxdrawThreeJS.updateCameraDisplayRange(Y,q,0),this.updateDisplay(!0);var he=L.MxFun.getUiObj();he!=null&&(he.SetLayoutData(this._allLayoutName),he.UpDisplayLayout())},M.prototype.calcViewsize=function(){if(this._userCanvas==null)return{viewWidth:window.innerWidth,viewHeight:window.innerHeight};var a=this._userCanvas.clientWidth,h=this._userCanvas.clientHeight;if(this._event.onResize!=null){var y=this._event.onResize;y instanceof Array&&(y=y[0]);var j=y();j!=null&&(a=parseInt(j.width),h=parseInt(j.height))}return{viewWidth:a,viewHeight:h}},M.prototype.initMxCpp=function(a){a&&a.getImp()?(this.mcObject.init(this,a),this.secenView!=null?this.secenView.background=null:this.scene.background=null):console.log("mxerror: mcppObjectImp is null")},M.prototype.create=function(a,h,y,j){if(this._is2d?this.mxdrawThreeJS=j?new _.MxDrawMapBoxThreeJS(j,this):new _.MxDrawObject2dThreeJS(this):this.mxdrawThreeJS=new _.MxDrawObject3dThreeJS(this),this._callCreateCanvasImageData=void 0,this._devicePixelRatio=window.devicePixelRatio,this._runMode==o.kCPPMxCAD)this._openFile="";else{if(h instanceof Array?(this._openFile=h[0],this._staticLoadingOpenFiles=h):this._openFile=h,this._iniParam=L.MxFun.getUrlParams(),this._openFileExtName=this._openFile.substring(this._openFile.lastIndexOf(".")+1),this._openFile!=""){var Y=new Array;Y.push("file"),Y.push(this._openFile),this._iniParam.push(Y)}this._userIdentitySign!=""&&(this.addInitParam("userIdentitySign",this._userIdentitySign),this.addInitParam("userRandomToken",this._userRandomToken)),this.addInitParam("runMode","browse")}this._userCanvas=a;var q=window.innerWidth,V=window.innerHeight;if(a!=null&&(q=a.clientWidth,V=a.clientHeight),this._viewWidth=q,this._viewHeight=V,this.m_mxDatabase.getSelectManager().setCanvasSize(q,V),this.mxdrawThreeJS.onInitThreejs(),this.eventManager.registEvent(this),this.onCreate(),this.m_mxDatabase.init(this),this._parentDocObject=new w.Object3D,this.scene.add(this._parentDocObject),this._parentDocObject_SmallCoord=new w.Object3D,this.scene.add(this._parentDocObject_SmallCoord),this.threejsselectObjects=new w.Object3D,this.scene.add(this.threejsselectObjects),this._objectsOsnap=new G.MxDrawObjectOsnap(this),P.MxManager.add(this),P.MxManager.setCurrentMx(this),this.mxdrawThreeJS.addControlsChangeEvent(),j||this.updateDisplay(),this.mxdrawThreeJS.getType()!=_.MxThreeJSType.kMapBox){var ne=this;if(a==null){var ie=function(){ne._viewWidth=window.innerWidth,ne._viewHeight=window.innerHeight,ne.onResizeImp(),ne.updateDisplay()};window.addEventListener("resize",ie,!1),this._onResizeFun=ie}else{var he=function(oe){oe&&oe.viewWidth&&oe.viewHeight||(oe=ne.calcViewsize()),ne._viewWidth=oe.viewWidth,ne._viewHeight=oe.viewHeight,ne.onResizeImp(ne._viewWidth,ne._viewHeight),ne.updateDisplay()};if(this._onResizeFun=he,this._event.addResizeEvent!=null){var be=this._event.addResizeEvent;be instanceof Array&&(be=be[0]),be(he,a)}else window.addEventListener("resize",he,!1);if(window.setTimeout(function(){he()},5),this._event.onResize!=null){var je=ne.calcViewsize();he(je);var xe=0,Fe=0,J=!0,ge=window.setInterval(function(){Fe++;var oe=ne.calcViewsize();if(oe.viewWidth==je.viewWidth&&oe.viewHeight==je.viewHeight&&0<oe.viewWidth&&0<oe.viewHeight){if(8<++xe)return clearInterval(ge),void he(oe);1<=xe&&J&&(he(oe),2<=xe&&(J=!1))}else xe=0;je=oe,50<Fe&&(clearInterval(ge),0<oe.viewWidth&&0<oe.viewHeight?he(oe):console.log("mxassert(0) error view size"))},50)}}}this.callInitObjectEvent(),this.onLoad(y),this._isCreate=!0},M.prototype.initResize=function(){if(this._userCanvas==null)this._viewWidth=window.innerWidth,this._viewHeight=window.innerHeight,this.onResizeImp();else{if(this._viewWidth=this._userCanvas.clientWidth,this._viewHeight=this._userCanvas.clientHeight,this._event.onResize!=null){var a=this._event.onResize;a instanceof Array&&(a=a[0]);var h=a();h!=null&&(this._viewWidth=h.width,this._viewHeight=h.height)}this.onResizeImp(this._viewWidth,this._viewHeight)}this.updateDisplay()},M.prototype.is2D=function(){return this._is2d},M.prototype.getOpenFile=function(){return this._openFile},M.prototype.getFileTitle=function(){var a=this._openFile;if(this._openFile.substring(this._openFile.lastIndexOf(".")+1).toLowerCase()=="wgh"){var h=this._openFile.substring(0,this._openFile.indexOf(".mxb1.wgh")).split("/");(a=h.length==1?h[0]:h[h.length-1])[0]=="$"&&(a=a.substring(1))}return a},M.prototype.getIniParam=function(){return this._iniParam},M.prototype.getOpenFileExtName=function(){return this._openFileExtName},M.prototype.loadCodeToServer=function(a,h){this._net.getSend().CallLoadCodeToServer(a,h)},M.prototype.userLogin=function(a,h){this._net.getSend().UserLogin(a,h)},M.prototype.getUserCanvas=function(){return this._userCanvas},M.prototype.getCanvas=function(){return this._userCanvas!=null?this._userCanvas:this.renderer.domElement},M.prototype.getScene=function(){return this.scene},M.prototype.getCamera=function(){return this.camera},M.prototype.callCommand=function(a,h,y){h===void 0&&(h=""),this._net.getSend().DoCommand(a,h,y)},M.prototype.deleteAll=function(){this.removeAllEntity(),this.callCommand("Mx_ClearAll"),this.updateDisplay()},M.prototype.initAllLayoutName=function(a){this._allLayoutName=a},M.prototype.getAllLayoutName=function(){return this._allLayoutName},M.prototype.updataClipMaterial=function(){this._blocks.updataClipMaterial(this)},M.prototype.getExtRefManager=function(){return this._extRefManager},M.prototype.showLayer=function(a,h){typeof a=="string"&&(a=this._layers.getLayerIdForName(a)),this._blocks.showLayer(a,h),this.updateDisplay()},M.prototype.addLayerInfo=function(a,h,y){h=this.automaticInversionColor(16777215&h),this._layers.add(a,h,y)},M.prototype.setZeroLayerId=function(a){this._layers.setZeroLayerId(a)},M.prototype.addLayerInfoComplete=function(){this._layers.initComplete()},M.prototype.addEntity=function(a,h){var y=this._mapId2Entity.get(a);y==null&&(y=new Array,this._mapId2Entity.set(a,y)),y.push(h)},M.prototype.getEntity=function(a){return this._mapId2Entity.get(a)},M.prototype.clearThreejsScence=function(){this.m_mxDatabase.getGripManager().reInit(),this.isValidMcObject()&&this.mcObject.getGripManager().reInit(),L.MxFun.removeThreejsObject(this.threejsselectObjects,this.scene),this.threejsselectObjects=new w.Object3D,L.MxFun.removeThreejsObject(this._parentDocObject,this.scene),this._parentDocObject=new w.Object3D,L.MxFun.removeThreejsObject(this._parentDocObject_SmallCoord,this.scene),this._parentDocObject_SmallCoord=new w.Object3D,this.scene.remove(),this.scene.dispose(),this.scene=new w.Scene,this.scene.add(this.threejsselectObjects),this.scene.add(this._parentDocObject),this.scene.add(this._parentDocObject_SmallCoord),this._objectsOsnap=new G.MxDrawObjectOsnap(this),this.m_mxDatabase.reInit(),this.mxdrawThreeJS.onInitScene(),L.MxFun.removeThreejsObject(this.threejsselectObjectsView,this.secenView),this.threejsselectObjectsView=null,this.secenView.remove(),this.secenView.dispose(),this.secenView=null,this.onInitViewScene(),this._runMode!=o.kCPPMxCAD&&this.mxdrawThreeJS.getType()!=_.MxThreeJSType.kMapBox||(this.secenView!=null?this.secenView.background=null:this.scene.background=null)},M.prototype.reInit=function(){this.clearThreejsScence(),this._openFile="",this._openFileExtName="",this._mapId2Entity=new Map,this._setAdyDelete=new Map,this._layers=new U.MxBrowseLayerData,this._blocks=new N.Blocks,this._extRefManager=new N.ExternalReferenceManager,this._doc2World=new w.Matrix4,this._word2doc=new w.Matrix4,this._allLayoutName=new Array,this._tzDwgStaticFile="",this._devicePixelRatio=window.devicePixelRatio,this._blocks.initRootBlockRef()},M.prototype.removeEntity=function(a){if(this._setAdyDelete[a]==null){this._setAdyDelete[a]=!0;var h=this._mapId2Entity.get(a);if(h!=null){for(var y in h)this.scene.remove(h[y]);this._mapId2Entity.delete(a)}}},M.prototype.removeEntityFromServer=function(a){for(var h=a.getInt32(4,!0),y=0;y<h;y++){var j=a.getInt32(4*(y+20),!0);this.removeEntity(j)}},M.prototype.removeAllEntity=function(){var a=this;this._mapId2Entity.forEach(function(h,y,j){for(var Y in h)a.scene.remove(h[Y])}),this._mapId2Entity.clear()},M.prototype.mxWebAddEntity=function(a){this._setAdyDelete.clear();var h=this.mxWebAddEntity_3DChild(a);this.mxWebAddEntity_Curve(a,h),this._setAdyDelete.clear()},M.prototype.getViewWorldCoord=function(){var a=new w.Vector3(-1,-1,1);a.unproject(this.camera);var h=new w.Vector3(-1,1,1);h.unproject(this.camera);var y=new w.Vector3(1,1,1);y.unproject(this.camera);var j=new w.Vector3(1,-1,1);return j.unproject(this.camera),{pt1:a,pt2:h,pt3:y,pt4:j}},M.prototype.getViewDocCoord=function(){var a=this.getViewWorldCoord();return a.pt1=this.docCoord2Cad2(this.worldCoord2Doc(a.pt1.x,a.pt1.y,0)),a.pt2=this.docCoord2Cad2(this.worldCoord2Doc(a.pt2.x,a.pt2.y,0)),a.pt3=this.docCoord2Cad2(this.worldCoord2Doc(a.pt3.x,a.pt3.y,0)),a.pt4=this.docCoord2Cad2(this.worldCoord2Doc(a.pt4.x,a.pt4.y,0)),a},M.prototype.screenCoord2World=function(a,h,y){return this.mxdrawThreeJS.screenCoord2World(a,h,y)},M.prototype.worldCoord2Screen=function(a,h,y){return this.mxdrawThreeJS.worldCoord2Screen(a,h,y)},M.prototype.screenCoord2World_mxdrawThreeJS_call=function(a,h,y){var j=this.getCanvas(),Y=j.clientWidth,q=j.clientHeight;y=.5;var V=this.camera;V&&V.isOrthographicCamera&&(y=(V.near+V.far)/(V.near-V.far));var ne=new w.Vector3(a/Y*2-1,-h/q*2+1,y);return ne.unproject(this.camera),ne.z=0,ne},M.prototype.worldCoord2Screen_mxdrawThreeJS_call=function(a,h,y){var j=new w.Vector3(a,h,y).project(this.camera),Y=this.getCanvas(),q=Y.clientWidth/2,V=Y.clientHeight/2,ne=Math.round(j.x*q+q),ie=Math.round(-j.y*V+V);return new w.Vector3(ne,ie,0)},M.prototype.worldCoordLong2Doc=function(a){var h=this.worldCoord2Doc(0,0,0),y=this.worldCoord2Doc(a,0,0);return h.distanceTo(y)},M.prototype.docCoordLong2World=function(a){var h=this.docCoord2World(0,0,0),y=this.docCoord2World(a,0,0);return h.distanceTo(y)},M.prototype.getDoc2CADMatrix=function(){return this._doc2CAD},M.prototype.docCoord2Cad=function(a,h,y){var j=new w.Vector3(a,h,y);return j.applyMatrix4(this._doc2CAD),j},M.prototype.toSmallcoord=function(a){return this._runMode==o.kCPPMxCAD?this.cadCoord2Doc2(a):a},M.prototype.toSmallcoord2=function(a,h,y){return y===void 0&&(y=0),this._runMode==o.kCPPMxCAD?this.cadCoord2Doc(a,h,y):new w.Vector3(a,h,y)},M.prototype.docCoord2Cad2=function(a){return(a=a.clone()).applyMatrix4(this._doc2CAD),a},M.prototype.cadCoord2Doc=function(a,h,y){var j=new w.Vector3(a,h,y);return j.applyMatrix4(this._cad2Doc),j},M.prototype.cadCoord2Doc2=function(a){return(a=a.clone()).applyMatrix4(this._cad2Doc),a},M.prototype.docCoordLong2Cad=function(a){var h=this.docCoord2Cad(0,0,0),y=this.docCoord2Cad(a,0,0);return h.distanceTo(y)},M.prototype.cadCoordLong2Doc=function(a){var h=this.cadCoord2Doc(0,0,0),y=this.cadCoord2Doc(a,0,0);return h.distanceTo(y)},M.prototype.viewCoordLong2Cad=function(a){return this.docCoordLong2Cad(this.screenCoordLong2Doc(a))},M.prototype.cadCoordLong2View=function(a){return this.docCoordLong2Screen(this.cadCoordLong2Doc(a))},M.prototype.viewCoord2Cad=function(a,h,y){var j=this.screenCoord2Doc(a,h,y);return this.docCoord2Cad(j.x,j.y,j.z)},M.prototype.cadCoord2View=function(a,h,y){var j=this.cadCoord2Doc(a,h,y);return this.docCoord2Screen(j.x,j.y,j.z)},M.prototype.docCoord2World=function(a,h,y){var j=new w.Vector3(a,h,y);return j.applyMatrix4(this._doc2World),j},M.prototype.getDoc2World=function(){return this._doc2World},M.prototype.getWorldToDoc=function(){return this._word2doc},M.prototype.worldCoord2Doc=function(a,h,y){var j=new w.Vector3(a,h,y);return j.applyMatrix4(this._word2doc),j},M.prototype.screenCoord2Doc=function(a,h,y){var j=this.screenCoord2World(a,h,y);return this.worldCoord2Doc(j.x,j.y,0)},M.prototype.worldCoord2Currnet=function(a,h,y){var j=new w.Vector3(a,h,y);return j.applyMatrix4(this._word2Current),j},M.prototype.currentCoord2World=function(a,h,y){var j=new w.Vector3(a,h,y);return j.applyMatrix4(this._current2word),j},M.prototype.screenCoord2Current=function(a,h,y){var j=this.screenCoord2World(a,h,y);return j.applyMatrix4(this._word2Current),j},M.prototype.currentCoord2Screen=function(a,h,y){var j=new w.Vector3(a,h,y);return j.applyMatrix4(this._current2word),this.worldCoord2Screen(j.x,j.y,j.z)},M.prototype.docCoord2Screen=function(a,h,y){var j=this.docCoord2World(a,h,y);return this.worldCoord2Screen(j.x,j.y,j.z)},M.prototype.screenCoordLong2Doc=function(a){var h=this.screenCoord2Doc(0,0,0),y=this.screenCoord2Doc(a,0,0);return h.distanceTo(y)},M.prototype.screenCoordLong2DocScale=function(){var a=this.screenCoord2Doc(0,0,0),h=this.screenCoord2Doc(1,0,0);return a.distanceTo(h)},M.prototype.docCoordLong2Screen=function(a){var h=this.docCoord2Screen(0,0,0),y=this.docCoord2Screen(0<a?a:-a,0,0);return 0<=a?h.distanceTo(y):-h.distanceTo(y)},M.prototype.screenCoordLong2World=function(a){var h=this.screenCoord2World(0,0,0),y=this.screenCoord2World(0<a?a:-a,0,0);return 0<=a?h.distanceTo(y):-h.distanceTo(y)},M.prototype.worldCoordLong2Screen=function(a){var h=this.worldCoord2Screen(0,0,0),y=this.worldCoord2Screen(a,0,0);return h.distanceTo(y)},M.prototype.initCAD2Doc=function(a){a instanceof Array?this._cad2Doc.fromArray(a):this._cad2Doc=a,this._doc2CAD.getInverse(this._cad2Doc),this.mcObject.initCAD2Doc(this._cad2Doc,this._doc2CAD)},M.prototype.intiDoc2Wold=function(a){a instanceof Array?this._doc2World.fromArray(a):this._doc2World=a,this._word2doc.getInverse(this._doc2World)},M.prototype.intiword2Current=function(a){this._word2Current=a.clone(),this._current2word.getInverse(this._word2Current)},M.prototype.initializingObjectMatrix=function(){this.isNewObjectMatrix&&this._runMode==o.kCPPMxCAD?(this.m_mxDatabase.initObjectMatrix(this._cad2Doc),this._parentDocObject.matrix=this._cad2Doc,this._parentDocObject.matrixAutoUpdate=!1,this._parentDocObject_SmallCoord.matrix=new w.Matrix4,this._parentDocObject_SmallCoord.matrixAutoUpdate=!1,this.threejsselectObjects.matrix=this._cad2Doc,this.threejsselectObjects.matrixAutoUpdate=!1,this.intiword2Current(this._doc2CAD)):(this.m_mxDatabase.initObjectMatrix(this._doc2World),this._parentDocObject.matrix=this._doc2World,this._parentDocObject.matrixAutoUpdate=!1,this._parentDocObject_SmallCoord.matrix=this._doc2World,this._parentDocObject_SmallCoord.matrixAutoUpdate=!1,this.threejsselectObjects.matrix=this._doc2World,this.threejsselectObjects.matrixAutoUpdate=!1,this.intiword2Current(this._word2doc))},M.prototype.getDrawContainer=function(){return this.threejsselectObjects},M.prototype.getTheTempDrawContainer=function(){return this._parentDocObject},M.prototype.getTheTempDrawContainer_SmallCoord=function(){return this._parentDocObject_SmallCoord},M.prototype.mxWebAddEntityFor2dPointMeshBuffers=function(a,h){var y=new D.MxNetData(a),j=y.getdPointMeshBuffersHead(),Y=j.zeroLayerIdIndex,q=j.databaseIndex;h!=-1&&(q=h);for(var V=j.datasize,ne=0;ne<j.datacount;ne++){var ie=y.getdPointMeshBufferDataHead(V);V=ie.offset;var he=ie.layerId,be=he==Y,je=ie.blkId,xe=ie.pointCount;if(!(xe<1)){for(var Fe=[],J=[],ge=[],oe=[],le=[],Re=0;Re<xe;Re++){var Ye=a.getFloat32(V,!0);V+=4;var Be=a.getFloat32(V,!0);V+=4;var se=a.getFloat32(V,!0);V+=4;var ve=a.getFloat32(V,!0);V+=4;var Ee=a.getFloat32(V,!0);V+=4;var rt=a.getFloat32(V,!0);V+=4;var tt=a.getInt32(V,!0);V+=4;var xt=tt>>24&255;xt==2?(oe.push(Ye,Be),oe.push(se,ve),oe.push(Ee,rt)):xt==1?je!=0&&be?(le.push(Ye,Be),le.push(se,ve),le.push(Ee,rt)):(ge.push(Ye,Be),ge.push(se,ve),ge.push(Ee,rt)):(tt=this.automaticInversionColor(16777215&tt),Fe.push(Ye,Be),Fe.push(se,ve),Fe.push(Ee,rt),J.push((255&tt)/255,(tt>>8&255)/255,(tt>>16&255)/255),J.push((255&tt)/255,(tt>>8&255)/255,(tt>>16&255)/255),J.push((255&tt)/255,(tt>>8&255)/255,(tt>>16&255)/255))}var Rt=this._blocks,At=this._layers;q!=0&&(Rt=this._extRefManager.getBlocks(q),At=this._extRefManager.getLayers(q));var He=Rt.crateBlock(je);He.addGeometryMesh(Fe,J,he,oe,ge,le),Rt.createThreejsObj(He,this,At)}}},M.prototype.mxWebAddEntityForMemorySections=function(a,h){var y=new D.MxNetData(a),j=y.getMemorySectionsHead(),Y=(j.zeroLayerIdIndex,j.databaseIndex);h!=-1&&(Y=h);var q=j.nOffset,V=this._blocks,ne=this._layers;Y!=0&&(V=this._extRefManager.getBlocks(Y),ne=this._extRefManager.getLayers(Y));for(var ie=0;ie<j.datacount;ie++){var he=y.getMemorySectionHead(q);q=he.offset;var be=new N.MxNewDisplayMemorySection;be.layerId=he.layerId,be.blockId=he.blkId,be.id=he.memId,be.color=he.memColor,be.type=he.memType;var je=!1;be.type==N.MxNewDisplayMemorySectionType.kLinesType_Float?(je=!0,be.type=N.MxNewDisplayMemorySectionType.kLinesType):be.type==N.MxNewDisplayMemorySectionType.kTriangleType_Float?(je=!0,be.type=N.MxNewDisplayMemorySectionType.kTriangleType):be.type==N.MxNewDisplayMemorySectionType.kPointType_Float&&(je=!0,be.type=N.MxNewDisplayMemorySectionType.kPointType);var xe=he.pointCount;if(!(xe<1)){for(var Fe=[],J=0;J<xe;J++)if(je){var ge=a.getFloat32(q,!0);q+=4;var oe=a.getFloat32(q,!0);q+=4,a.getFloat32(q,!0),q+=4,Fe.push(ge,oe,0)}else ge=a.getFloat64(q,!0),q+=8,oe=a.getFloat64(q,!0),q+=8,a.getFloat64(q,!0),q+=8,Fe.push(ge,oe,0);be.points=Fe;var le=V.crateBlock(be.blockId);le.addMemorySections(be),V.createThreejsObj(le,this,ne)}}},M.prototype.convertBytesToUTF8=function(a,h){var y=0;h=Math.min(h||a.length,a.length),a[0]===239&&a[1]===187&&a[2]===191&&(y=3);for(var j=[],Y=0;y<h;Y++){var q,V,ne,ie=a[y++];if(ie===0)break;ie<128?j[Y]=String.fromCharCode(ie):194<=ie&&ie<224?(q=a[y++],j[Y]=String.fromCharCode(((31&ie)<<6)+(63&q))):224<=ie&&ie<240?(q=a[y++],V=a[y++],j[Y]=String.fromCharCode(((15&ie)<<12)+((63&q)<<6)+(63&V))):240<=ie&&ie<245&&(ne=((7&ie)<<18)+((63&(q=a[y++]))<<12)+((63&(V=a[y++]))<<6)+(63&a[y++])-65536,j[Y]=String.fromCharCode(55296+(ne>>10),56320+(1023&ne)))}return j.join("")},M.prototype.mxWebAddEntityFor2dPointTextureBuffers=function(a,h){var y=new D.MxNetData(a),j=y.getdPointTextureBuffersHead(),Y=j.ver,q=(j.zeroLayerIdIndex,j.databaseIndex);h!=-1&&(q=h);for(var V=j.datasize,ne=0;ne<j.datacount;ne++){var ie=y.getdPointTextureBufferDataHead(V);V=ie.offset;var he=ie.layerId,be=ie.blkId,je=ie.dataCount;if(!(je<1)){var xe=0,Fe=this._blocks,J=this._layers;q!=0&&(Fe=this._extRefManager.getBlocks(q),J=this._extRefManager.getLayers(q));for(var ge=Fe.crateBlock(be);xe<je;xe++){var oe=a.getFloat64(V,!0);V+=8;var le=a.getFloat64(V,!0);V+=8;var Re=a.getFloat64(V,!0);V+=8;var Ye=a.getUint32(V,!0);V+=4;var Be=a.getUint32(V,!0);V+=4;var se=this.convertBytesToUTF8(new Uint8Array(a.buffer.slice(V,V+Be)),void 0);V+=Be;var ve=[],Ee=[],rt=[];if(!(Ye<1)){for(var tt=0;tt<Ye;tt++){if(5<=Y){var xt=a.getFloat64(V,!0);V+=8;var Rt=a.getFloat64(V,!0);V+=8,a.getFloat64(V,!0),V+=8;var At=a.getFloat64(V,!0);V+=8;var He=a.getFloat64(V,!0);V+=8,a.getFloat64(V,!0),V+=8;var Gt=a.getFloat64(V,!0);V+=8;var jt=a.getFloat64(V,!0);V+=8,a.getFloat64(V,!0),V+=8,ve.push(xt,Rt),ve.push(At,He),ve.push(Gt,jt)}else xt=a.getFloat32(V,!0),V+=4,Rt=a.getFloat32(V,!0),V+=4,At=a.getFloat32(V,!0),V+=4,He=a.getFloat32(V,!0),V+=4,Gt=a.getFloat32(V,!0),V+=4,jt=a.getFloat32(V,!0),V+=4,ve.push(xt,Rt),ve.push(At,He),ve.push(Gt,jt);var Tn=a.getInt32(V,!0);V+=4;var mn=a.getFloat32(V,!0);V+=4;var Qn=a.getFloat32(V,!0);V+=4;var gt=a.getFloat32(V,!0);V+=4;var ze=a.getFloat32(V,!0);V+=4;var Zt=a.getFloat32(V,!0);V+=4;var Rn=a.getFloat32(V,!0);V+=4;var Xn=Tn>>24&255;Tn=Xn==2||Xn==1?16777215:this.automaticInversionColor(16777215&Tn),rt.push(mn,Qn),rt.push(gt,ze),rt.push(Zt,Rn),Ee.push((255&Tn)/255,(Tn>>8&255)/255,(Tn>>16&255)/255),Ee.push((255&Tn)/255,(Tn>>8&255)/255,(Tn>>16&255)/255),Ee.push((255&Tn)/255,(Tn>>8&255)/255,(Tn>>16&255)/255)}ge.addGeometryTexture(ve,rt,Ee,he,se,oe,le,Re)}}Fe.createThreejsObj(ge,this,J)}}},M.prototype.mxWebAddEntityFor2dPointCurveBuffers=function(a,h){var y=new D.MxNetData(a),j=y.getdPointCurveBuffersHead(),Y=j.zeroLayerIdIndex,q=j.databaseIndex;h!=-1&&(q=h);for(var V=j.datasize,ne=0;ne<j.datacount;ne++){var ie=y.getdPointCurveBufferDataHead(V);V=ie.offset;var he=ie.layerId,be=he==Y,je=ie.blkId,xe=ie.pointCount;if(!(xe<1)){for(var Fe=[],J=[],ge=[],oe=[],le=[],Re=0;Re<xe;Re++){var Ye=a.getFloat32(V,!0);V+=4;var Be=a.getFloat32(V,!0);V+=4;var se=a.getFloat32(V,!0);V+=4;var ve=a.getFloat32(V,!0);V+=4;var Ee=a.getInt32(V,!0);V+=4;var rt=Ee>>24&255;rt==2?(oe.push(Ye,Be),oe.push(se,ve)):rt==1?je!=0&&be?(le.push(Ye,Be),le.push(se,ve)):(ge.push(Ye,Be),ge.push(se,ve)):(Fe.push(Ye,Be),Fe.push(se,ve),Ee=this.automaticInversionColor(16777215&Ee),J.push((255&Ee)/255,(Ee>>8&255)/255,(Ee>>16&255)/255),J.push((255&Ee)/255,(Ee>>8&255)/255,(Ee>>16&255)/255))}var tt=this._blocks,xt=this._layers;q!=0&&(tt=this._extRefManager.getBlocks(q),xt=this._extRefManager.getLayers(q));var Rt=tt.crateBlock(je);Rt.addGeometryCurve(Fe,J,he,oe,ge,le),tt.createThreejsObj(Rt,this,xt)}}},M.prototype.mxWebAddEntityFor2dPointCurveBuffer=function(a,h){var y=new D.MxNetData(a);if(!y.getIsSketchEntity()){var j,Y=y.getLayerId(),q=Y==y.getZeroLayerId(),V=y.getBlockId();if(!((j=a.getInt32(20,!0)/20)<1)){for(var ne=80,ie=[],he=[],be=[],je=[],xe=[],Fe=0;Fe<j;Fe++){var J=a.getFloat32(ne,!0);ne+=4;var ge=a.getFloat32(ne,!0);ne+=4;var oe=a.getFloat32(ne,!0);ne+=4;var le=a.getFloat32(ne,!0);ne+=4;var Re=a.getInt32(ne,!0);ne+=4;var Ye=Re>>24&255;Ye==2?(je.push(J,ge),je.push(oe,le)):Ye==1?V!=0&&q?(xe.push(J,ge),xe.push(oe,le)):(be.push(J,ge),be.push(oe,le)):(Re=this.automaticInversionColor(16777215&Re),ie.push(J,ge),ie.push(oe,le),he.push((255&Re)/255,(Re>>8&255)/255,(Re>>16&255)/255),he.push((255&Re)/255,(Re>>8&255)/255,(Re>>16&255)/255))}var Be=y.getDatabaseIndex();h!=-1&&(Be=h);var se=this._blocks,ve=this._layers;Be!=0&&(se=this._extRefManager.getBlocks(Be),ve=this._extRefManager.getLayers(Be));var Ee=se.crateBlock(V);Ee.addGeometryCurve(ie,he,Y,je,be,xe),se.createThreejsObj(Ee,this,ve)}}},M.prototype.mxWebAddEntityFor2dPointMeshBuffer=function(a,h){var y=new D.MxNetData(a);if(!y.getIsSketchEntity()){var j,Y=y.getLayerId(),q=y.getBlockId(),V=Y==y.getZeroLayerId();if(!((j=a.getInt32(12,!0)/28)<1)){for(var ne=80,ie=[],he=[],be=[],je=[],xe=[],Fe=0;Fe<j;Fe++){var J=a.getFloat32(ne,!0);ne+=4;var ge=a.getFloat32(ne,!0);ne+=4;var oe=a.getFloat32(ne,!0);ne+=4;var le=a.getFloat32(ne,!0);ne+=4;var Re=a.getFloat32(ne,!0);ne+=4;var Ye=a.getFloat32(ne,!0);ne+=4;var Be=a.getInt32(ne,!0);ne+=4;var se=Be>>24&255;se==2?(je.push(J,ge),je.push(oe,le),je.push(Re,Ye)):se==1?q!=0&&V?(xe.push(J,ge),xe.push(oe,le),xe.push(Re,Ye)):(be.push(J,ge),be.push(oe,le),be.push(Re,Ye)):(ie.push(J,ge),ie.push(oe,le),ie.push(Re,Ye),Be=this.automaticInversionColor(16777215&Be),he.push((255&Be)/255,(Be>>8&255)/255,(Be>>16&255)/255),he.push((255&Be)/255,(Be>>8&255)/255,(Be>>16&255)/255),he.push((255&Be)/255,(Be>>8&255)/255,(Be>>16&255)/255))}var ve=y.getDatabaseIndex();h!=-1&&(ve=h);var Ee=this._blocks,rt=this._layers;ve!=0&&(Ee=this._extRefManager.getBlocks(ve),rt=this._extRefManager.getLayers(ve));var tt=Ee.crateBlock(q);tt.addGeometryMesh(ie,he,Y,je,be,xe),Ee.createThreejsObj(tt,this,rt)}}},M.prototype.mxWebCreateAllBlocks=function(a,h){var y=new D.MxNetData(a).getDatabaseIndex();h!=-1&&(y=h);var j=this._blocks;y!=0&&(j=this._extRefManager.getBlocks(y)),j.createBlocks(a,this.scene)},M.prototype.mxWebEntitysData=function(a,h){h==-1&&this._objectsOsnap.mxWebEntitysData(a,h)},M.prototype.getObjectOsnap=function(){return this._objectsOsnap},M.prototype.saveMxEntityToJson=function(a){return this.m_mxDatabase.saveJson(a)},M.prototype.getDtabaseJsonString=function(){return JSON.stringify(this.m_mxDatabase.toJsonObject())},M.prototype.loadMxEntityFromJson=function(a){return this.m_mxDatabase.loadJson(a)},M);function M(a){this._is2d=!0,this._runMode=o.kBrowse,this._userCanvas=null,this._openFile="empty",this._staticLoadingOpenFiles=[],this._openFileExtName="",this._userIdentitySign="",this._rendererParam=void 0,this._userRandomToken="",this._isCreate=!1,this.m_iniSet={},this._net=null,this._staticNet=null,this._staticLoadTzNet=null,this._staticLocalNet=null,this._isStaticLocalLoad=!1,this._staticLocalLoadPath="",this._viewWidth=1,this._viewHeight=1,this.m_sysVariable=new T.MxSystemVariable,this._color="#FFFFFF",this._viewcolor=15790320,this._isAnimation=!1,this._isAnimationStarting=!1,this._isWaiteCount=0,this._callCreateCanvasImageData=void 0,this._event={},this.scene=null,this.camera=null,this.camera_recover=null,this.secenView=null,this.cameraView=null,this.renderer=null,this.controls=null,this.threejsselectObjectsView=null,this._mouseRightRotate=!1,this._isMouseMiddlePan=1,this._mapId2Entity=new Map,this._setAdyDelete=new Map,this._layers=new U.MxBrowseLayerData,this._blocks=new N.Blocks,this._extRefManager=new N.ExternalReferenceManager,this._doc2World=new w.Matrix4,this._word2doc=new w.Matrix4,this._cad2Doc=new w.Matrix4,this._doc2CAD=new w.Matrix4,this._word2Current=new w.Matrix4,this._current2word=new w.Matrix4,this._allLayoutName=new Array,this._devicePixelRatio=1,this._tzDwgStaticFile="",this._requestHeader="",this._objectsOsnap=null,this._initZoomwCoordPt1=null,this._initZoomWCoordPt2=null,this.m_mxDatabase=null,this._parentDocObject=null,this._parentDocObject_SmallCoord=null,this.threejsselectObjects=null,this._onResizeFun=null,this._sCurrentLoadURL="",this.eventManager=new ee.MxDrawObjectEvent,this._viewangle=0,this.id=0,this.mcObject=new E.McDrawObject,this.isPointMultipleSelect=!1,this.isNewObjectMatrix=!0,this.bakControls=void 0,this.isMultipleSelect=!1,this.mxdrawThreeJS=null,this.curMousePostion=new w.Vector2(0,0),this.m_isValidCurMousePostion=!1,this._is2d=a,this._blocks.initRootBlockRef(),this.m_iniSet[u.kEnableOsnapFunction]=!1,this.m_sysVariable.init(this),this.m_mxDatabase=new R.MxDbDatabase,this.id=P.MxManager.allocId(),this.isMultipleSelect=C.MxDrawData.m_isMultipleSelect}s.MxDrawObject=F},{"./MxDrawData":22,"./MxDrawObjectEvent":26,"./MxFun":27,"./MxLocalFileLoad":28,"./MxManager":29,"./MxNetData":31,"./MxSystemVariable":35,"./Operate/MxDrawObjectOsnap":48,"./UI/MxUiVue":64,"./View/MxBrowseDisplay":65,"./View/MxBrowseLayerData":66,"./View/MxDbDatabase":67,"./View/MxDbEntityGrip":69,"./View/MxDrawMapBox":74,"./cpp/McDrawObject":76,three:19}],24:[function(b,r,s){var o,v=this&&this.__extends||(o=function(R,_){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ee,k){ee.__proto__=k}||function(ee,k){for(var E in k)Object.prototype.hasOwnProperty.call(k,E)&&(ee[E]=k[E])})(R,_)},function(R,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function ee(){this.constructor=R}o(R,_),R.prototype=_===null?Object.create(_):(ee.prototype=_.prototype,new ee)});Object.defineProperty(s,"__esModule",{value:!0}),s.MxDrawObject2d=void 0;var u,w=b("three"),L=b("./MxFun"),U=b("./MxDrawObject"),N=b("three-orbitcontrols"),D=b("./MxNetData"),f=b("./MxMaterial"),P=b("./MxDrawData"),T=b("./View/MxDrawMapBox"),B=(v(G,u=U.MxDrawObject),G.prototype.set3DDraw=function(R){this.is3DDraw=R},G.prototype.getOrthographicCamera=function(){return this.camera instanceof w.OrthographicCamera?this.camera:null},G.prototype.getFullDisplayRange=function(){return{minPt:this._initMinDisplayPoint,maxPt:this._initMaxDisplayPoint}},G.prototype.saveZoom=function(){this.camera_recover=this.camera.clone(!1),this.controls.saveState()},G.prototype.recoverZoom=function(){this.camera_recover&&(this.camera.copy(this.camera_recover,!1),this.camera_recover=null,this.getOrthographicCamera().updateProjectionMatrix(),this.controls.reset(),this.mcObject.updateDisplayMatrixData())},G.prototype.zoomW_call=function(R,_,ee,k){if(R.distanceTo(_)<1e-7)console.log("Mx:ZoomW param invalid");else{if(ee!=null&&ee||(R=this.currentCoord2World(R.x,R.y,0),_=this.currentCoord2World(_.x,_.y,0)),R.x>_.x){var E=R.x;R.x=_.x,_.x=E}R.y>_.y&&(E=R.y,R.y=_.y,_.y=E);var W=this.getViewWidth(),C=this.getViewHeight();C<5&&(C=5),W<5&&(W=5);var F=Math.abs(R.x-_.x),M=Math.abs(R.y-_.y);F<1e-5&&(F=1e-5),M<1e-5&&(M=1e-5);var a=this.getOrthographicCamera();if(F/M<W/C){var h=.5*M,y=W/C;a.left=-h*y,a.right=h*y,a.top=h,a.bottom=-h}else h=.5*F,y=C/W,a.left=-h,a.right=h,a.top=h*y,a.bottom=-h*y;var j=F,Y=M,q=j;q<Y&&(q=Y),this._runMode==U.MxRunMode.kCPPMxCAD?(a.far=102400,a.near=-102400):(a.far=1e3*q,a.far<9e4&&(a.far=9e4),a.near=1e3*-q,-9e4<a.near&&(a.near=-9e4));var V=R.x+.5*j,ne=R.y+.5*Y;a.zoom=1,a.position.set(V,ne,100),a.lookAt(new w.Vector3(V,ne,0)),a.updateProjectionMatrix(),this.controls.target.x=V,this.controls.target.y=ne,this.controls.target.z=0,this.controls.update(),this.mcObject.updateDisplayMatrixData(k)}},G.prototype.zoomScale_call=function(R){var _=this.getOrthographicCamera();_.zoom=Math.max(this.controls.minZoom,Math.min(this.controls.maxZoom,_.zoom*R)),_.updateProjectionMatrix(),this.controls.update(),this.mcObject.updateDisplayMatrixData()},G.prototype.zoomCenter_call=function(R,_){var ee=this.getOrthographicCamera(),k=this.currentCoord2World(R,_,0);R=k.x,_=k.y,ee.position.set(R,_,ee.position.z),ee.lookAt(new w.Vector3(R,_,0)),ee.updateProjectionMatrix(),this.controls.target.x=R,this.controls.target.y=_,this.controls.target.z=0,this.controls.update(),this.mcObject.updateDisplayMatrixData()},G.prototype.calcCameraUp=function(R){var _=new w.Vector3(0,1,0),ee=new w.Matrix4;return ee.makeRotationZ(R),_.applyMatrix4(ee),_},G.prototype.updateCameraDisplayRangeImp=function(R,_,ee){this._initZoomwCoordPt1!=null&&this._initZoomWCoordPt2!=null?(this._initMinDisplayPoint=this.docCoord2World(this._initZoomwCoordPt1.x,this._initZoomwCoordPt1.y,0),this._initMaxDisplayPoint=this.docCoord2World(this._initZoomWCoordPt2.x,this._initZoomWCoordPt2.y,0)):(this._initMinDisplayPoint=R,this._initMaxDisplayPoint=_),this._viewangle=ee,this.camera.up=this.calcCameraUp(ee),this.cameraView.up=this.calcCameraUp(ee),this.cameraView.updateProjectionMatrix(),this.zoomW(this._initMinDisplayPoint,this._initMaxDisplayPoint,!0)},G.prototype.setViewAngle_call=function(R){this._viewangle=R;var _=this.getOrthographicCamera();_&&(_.up=this.calcCameraUp(R),_.updateProjectionMatrix()),this.cameraView.up=this.calcCameraUp(R),this.cameraView.updateProjectionMatrix(),this.controls.update(),this.mcObject.updateDisplayMatrixData()},G.prototype.zoomInitialStates=function(){this._initMinDisplayPoint!=null&&this._initMaxDisplayPoint!=null?(this.camera.up=this.calcCameraUp(this._viewangle),this.cameraView.up=this.calcCameraUp(this._viewangle),this.cameraView.updateProjectionMatrix(),this.zoomW(this._initMinDisplayPoint,this._initMaxDisplayPoint,!0)):console.log("mx assert(0)")},G.prototype.onInitScene=function(){if(this.callInitSceneEvent(this.scene,this.controls,!0)==0){var R=new w.AmbientLight(3355443,1);this.scene.add(R);var _=new w.DirectionalLight(16777215,1);_.position.set(-2,2,3).normalize(),this.scene.add(_)}},G.prototype.updataCameraView=function(R,_){var ee=R,k=_;this.cameraView.left=0,this.cameraView.right=ee,this.cameraView.top=k,this.cameraView.bottom=0,this.cameraView.updateProjectionMatrix()},G.prototype.onInitViewScene=function(){if(!this.secenView){this.secenView=new w.Scene,this._runMode!=U.MxRunMode.kCPPMxCAD&&this.mxdrawThreeJS.getType()!=T.MxThreeJSType.kMapBox&&(this.secenView.background=new w.Color(this._viewcolor));var R=this.getViewWidth(),_=this.getViewHeight();R=this.xzSize(R),_=this.xzSize(_),this.cameraView=new w.OrthographicCamera(0,R,_,0,1,2e3),this.cameraView.position.set(0,0,2e3),this.cameraView.lookAt(new w.Vector3(0,0,0)),this.cameraView.updateProjectionMatrix();var ee=new w.AmbientLight(3355443,1);this.secenView.add(ee);var k=new w.DirectionalLight(16777215,1);k.position.set(-2,2,3).normalize(),this.secenView.add(k),this.threejsselectObjectsView=new w.Object3D,this.secenView.add(this.threejsselectObjectsView)}},G.prototype.onInitThreejs=function(){var R=this.getViewWidth(),_=this.getViewHeight(),ee=(R=this.xzSize(R))/(_=this.xzSize(_))*50;this.onInitViewScene(),this.camera=new w.OrthographicCamera(ee/-2,ee/2,25,-25,1,1e3),this.camera.position.set(0,0,200),this.scene=new w.Scene;var k=this.getUserCanvas(),E=this._rendererParam;E=E||{},k==null?(E.antialias=!1,E.stencil=!0,this.renderer=new w.WebGLRenderer(E),this.renderer.setClearColor(0,1),this.renderer.setPixelRatio(this._devicePixelRatio),this.renderer.setSize(R,_),document.body.appendChild(this.renderer.domElement)):(E.canvas=k,E.stencil=!0,this.renderer=new w.WebGLRenderer(E),this.renderer.setClearColor(0,1),this.renderer.setPixelRatio(this._devicePixelRatio)),this.renderer.sortObjects=!0,this.renderer.info.autoReset=P.MxDrawData.m_isAutoResetRenderer,this.renderer.info.reset();var W=this.getUserCanvas();W==null&&(W=this.renderer.domElement),this.controls=new N.OrbitControls(this.camera,W),this.is3DDraw||(this.controls.enableZoom=!0),L.MxFun.isPC()?(this.controls.zoomSpeed=4,this.controls.screenSpacePanning=!0,this.setMouseMiddlePan(this._isMouseMiddlePan),this._mouseRightRotate&&(this.controls.mouseButtons.RIGHT=w.MOUSE.ROTATE)):(this.controls.zoomSpeed=1.5,this.controls.touches.ONE=w.TOUCH.PAN,this.controls.screenSpacePanning=!0)},G.prototype.onCreate=function(){this._is2d=!0,this.mxdrawThreeJS.onInitScene()},G.prototype.mxWebAddEntity_3DChild=function(R){var _=new D.MxNetData(R).getMesh();if(_.id==null)return _.size;var ee=new w.Mesh(_.geometry,f.MxMaterial.GetBaseColorMaterial(_.nColorIndex));return this.removeEntity(_.id),this.scene.add(ee),_.isSketchEntity&&this.addEntity(_.id,ee),_.size},G.prototype.mxWebAddEntity_Curve=function(R,_){var ee=new D.MxNetData(R).getCurve(_);if(ee.id!=null){var k=f.MxMaterial.GetCurveColorMaterial(ee.colorIndex),E=new w.LineSegments(ee.geometry,k);this.removeEntity(ee.id),this.scene.add(E),ee.isSketchEntity&&this.addEntity(ee.id,E)}},G.prototype.onViewChange=function(){this._onResizeImpCalling||(this._bakOnResizeViewWorldCoord=void 0)},G.prototype.mapBox_onResizeImp=function(R,_){var ee=R,k=_;this.mcObject.setSize(ee,k),this.callEvent("viewsizechange",{width:ee,height:k}),this.callEvent("viewchange"),this.m_mxDatabase.getSelectManager().setCanvasSize(ee,k)},G.prototype.onResizeImp=function(R,_){var ee;this._bakOnResizeViewWorldCoord?ee=this._bakOnResizeViewWorldCoord:(ee=this.getViewWorldCoord(),this._bakOnResizeViewWorldCoord=ee);var k=this.getViewWidth();R!=null&&(k=R);var E=this.getViewHeight();if(_!=null&&(E=_),!(E<5||k<5)){var W=ee.pt1.x+.5*(ee.pt3.x-ee.pt1.x),C=ee.pt1.y+.5*(ee.pt3.y-ee.pt1.y),F=new w.Matrix4;F.makeRotationZ(this._viewangle);var M=new w.Matrix4().makeTranslation(W,C,0).multiply(F).multiply(new w.Matrix4().makeTranslation(-W,-C,0)),a=ee.pt1.clone(),h=ee.pt2.clone(),y=ee.pt3.clone(),j=ee.pt4.clone();a.applyMatrix4(M),h.applyMatrix4(M),y.applyMatrix4(M),j.applyMatrix4(M);var Y=a.clone();Y.x>h.x&&(Y.x=h.x),Y.x>y.x&&(Y.x=y.x),Y.x>j.x&&(Y.x=j.x),Y.y>h.y&&(Y.y=h.y),Y.y>y.y&&(Y.y=y.y),Y.y>j.y&&(Y.y=j.y);var q=a.clone();q.x<h.x&&(q.x=h.x),q.x<y.x&&(q.x=y.x),q.x<j.x&&(q.x=j.x),q.y<h.y&&(q.y=h.y),q.y<y.y&&(q.y=y.y),q.y<j.y&&(q.y=j.y),k=this.xzSize(k),E=this.xzSize(E);var V=new w.Vector2;if(this.renderer.getSize(V),V.x!=k||V.y!=E){this._onResizeImpCalling=!0;var ne=this.getOrthographicCamera(),ie=Math.abs(q.x-Y.x),he=Math.abs(q.y-Y.y);if(ie<1e-5&&(ie=1e-5),he<1e-5&&(he=1e-5),ie/he<k/E){var be=.5*he,je=k/E;ne.left=-be*je,ne.right=be*je,ne.top=be,ne.bottom=-be}else be=.5*ie,je=E/k,ne.left=-be,ne.right=be,ne.top=be*je,ne.bottom=-be*je;var xe=Y.x+.5*ie,Fe=Y.y+.5*he;ne.zoom=1;var J=ne.position.z;ne.position.set(xe,Fe,J),ne.lookAt(new w.Vector3(xe,Fe,0)),ne.updateProjectionMatrix(),this.controls.target.x=xe,this.controls.target.y=Fe,this.controls.target.z=0,this.controls.update(),this.renderer.setSize(k,E),this.mcObject.setSize(k,E),this.updataClipMaterial(),this.updataCameraView(k,E),this.callEvent("viewsizechange",{width:k,height:E}),this.callEvent("viewchange"),this.m_mxDatabase.getSelectManager().setCanvasSize(k,E),this.m_mxDatabase.onViewChange(),this._onResizeImpCalling=!1}}},G);function G(){var R=u.call(this,!0)||this;return R._initMinDisplayPoint=null,R._initMaxDisplayPoint=null,R.is3DDraw=L.MxFun.is3DDwg(),R._bakOnResizeViewWorldCoord=void 0,R._onResizeImpCalling=!1,R}s.MxDrawObject2d=B},{"./MxDrawData":22,"./MxDrawObject":23,"./MxFun":27,"./MxMaterial":30,"./MxNetData":31,"./View/MxDrawMapBox":74,three:19,"three-orbitcontrols":17}],25:[function(b,r,s){var o,v=this&&this.__extends||(o=function(B,G){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,_){R.__proto__=_}||function(R,_){for(var ee in _)Object.prototype.hasOwnProperty.call(_,ee)&&(R[ee]=_[ee])})(B,G)},function(B,G){if(typeof G!="function"&&G!==null)throw new TypeError("Class extends value "+String(G)+" is not a constructor or null");function R(){this.constructor=B}o(B,G),B.prototype=G===null?Object.create(G):(R.prototype=G.prototype,new R)});Object.defineProperty(s,"__esModule",{value:!0}),s.MxDrawObject3d=void 0;var u,w=b("three"),L=b("./MxDrawObject"),U=b("three-orbitcontrols"),N=b("./MxNetData"),D=b("./MxMaterial"),f=b("./MxTools"),P=(v(T,u=L.MxDrawObject),T.prototype.mxWebAddEntity_Curve=function(B,G){var R,_=new N.MxNetData(B),ee=B.getInt32(32,!0)==0,k=_.getIsSketchEntity();if(!((R=ee?B.getInt32(20,!0)/4/3:B.getInt32(20,!0)/4/2)<2)){for(var E=new w.Geometry,W=G,C=0;C<R;C++){var F=B.getFloat32(W,!0);W+=4;var M=B.getFloat32(W,!0);W+=4;var a=0;ee&&(a=B.getFloat32(W,!0),W+=4),E.vertices.push(f.MxTools.AsThreeJsPoint(F,M,a))}var h=B.getInt32(28,!0),y=D.MxMaterial.GetCurveColorMaterial(h),j=new w.LineSegments(E,y),Y=B.getInt32(4,!0);this.removeEntity(Y),this.scene.add(j),k&&this.addEntity(Y,j)}},T.prototype.mxWebAddEntity_3DChild=function(B){var G=new N.MxNetData(B),R=G.getId(),_=(G.getColorIndex(),G.getBufferType()==0),ee=G.getIsSketchEntity();this.removeEntity(R);var k=new w.Mesh(new w.Geometry),E=this.mxWebUpdateEntity_3DChild(k,B,_);return this.scene.add(k),ee&&this.addEntity(R,k),k.geometry.computeBoundingBox(),k.geometry.computeBoundingSphere(),E},T.prototype.mxWebUpdateEntity_3DChild=function(B,G,R){var _=new N.MxNetData(G),ee=_.getVertexBufferSize(),k=_.getIndexBufferSize(),E=_.getColorIndex();if(ee===0||k===0)return _.getDrawDataOffset();var W=_.getMateria(),C=void 0,F=!0,M=!1,a=!1;W.length!=0&&((C=JSON.parse(W)).computeFaceNonmal!=null&&(F=C.computeFaceNonmal),C.castShadow!=null&&(M=C.castShadow),C.receiveShadow!=null&&(a=C.receiveShadow)),B.material=D.MxMaterial.createMaterial(C),B.material==null&&(B.material=D.MxMaterial.GetColorMaterial(E)),B.castShadow=M,B.receiveShadow=a;var h,y=_.getDrawDataOffset();h=R?ee/4/8:ee/4/2;var j=B.geometry;j.vertices=[],j.faces=[];for(var Y=0;Y<h;Y++){var q=G.getFloat32(y+0,!0),V=G.getFloat32(y+4,!0),ne=0,ie=0,he=0,be=0,je=0,xe=0;R?(ne=G.getFloat32(y+8,!0),ie=G.getFloat32(y+12,!0),he=G.getFloat32(y+16,!0),be=G.getFloat32(y+20,!0),je=G.getFloat32(y+24,!0),xe=G.getFloat32(y+28,!0),y+=32):y+=8;var Fe=f.MxTools.AsThreeJsPoint(q,V,ne);j.vertices.push(Fe),j.vertices[Y].normal=f.MxTools.AsThreeJsPoint(ie,he,be),j.vertices[Y].uv=new w.Vector2(je,xe)}var J=k/4;for(Y=0;Y<J;Y+=3){var ge=G.getInt32(y,!0);y+=4;var oe=G.getInt32(y,!0);y+=4;var le=G.getInt32(y,!0);y+=4;var Re=new w.Face3(ge,oe,le);F||Re.vertexNormals.push(j.vertices[ge].normal,j.vertices[oe].normal,j.vertices[le].normal),j.faces.push(Re),j.faceVertexUvs[0].push([j.vertices[ge].uv,j.vertices[oe].uv,j.vertices[le].uv])}return F&&j.computeFaceNormals(),y},T.prototype.updateUVs=function(B){B.faceVertexUvs[0]=[],B.faces.forEach(function(G){var R=["x","y","z"].sort(function(F,M){return Math.abs(G.normal[F])-Math.abs(G.normal[M])}),_=B.vertices[G.a],ee=B.vertices[G.b],k=B.vertices[G.c],E=new w.Vector2(_[R[0]],_[R[1]]),W=new w.Vector2(ee[R[0]],ee[R[1]]),C=new w.Vector2(k[R[0]],k[R[1]]);B.faceVertexUvs[0].push([E,W,C])}),B.uvsNeedUpdate=!0},T.prototype.onInitThreejs=function(){var B=this.getViewWidth(),G=this.getViewHeight(),R=(B=this.xzSize(B))/(G=this.xzSize(G))*50;this.camera=new w.OrthographicCamera(R/-2,R/2,25,-25,1,1e3),this.camera.position.set(-200,200,200),this.scene=new w.Scene,this.scene.background=new w.Color(this._viewcolor);var _=this.getUserCanvas();_==null?(this.renderer=new w.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(this._devicePixelRatio),this.renderer.setSize(B,G),document.body.appendChild(this.renderer.domElement)):(this.renderer=new w.WebGLRenderer({canvas:_,antialias:!0,alpha:!0}),this.renderer.setPixelRatio(this._devicePixelRatio));var ee=this.getUserCanvas();ee==null&&(ee=this.renderer.domElement),this.controls=new U.OrbitControls(this.camera,ee)},T.prototype.onInitViewScene=function(){},T.prototype.onInitScene=function(){if(this.callInitSceneEvent(this.scene,this.controls,!1)==0){var B=new w.AmbientLight(2236962);B.integrity=1,this.scene.add(B);var G=new w.DirectionalLight(16777215,1);G.position.set(-2,2,3).normalize(),this.scene.add(G);var R=new w.GridHelper(2e3,100);R.position.y=-199,R.material.opacity=.25,R.material.transparent=!0,this.scene.add(R);var _=new w.AxesHelper(20);this.scene.add(_)}},T.prototype.onCreate=function(){this._is2d=!1,this.callEvent("initRenderer",this.renderer),this.mxdrawThreeJS.onInitScene()},T.prototype.getOrthographicCamera=function(){return this.camera instanceof w.OrthographicCamera?this.camera:null},T.prototype.onViewChange=function(){},T.prototype.onResizeImp=function(B,G){var R=this.getViewWidth();B!=null&&(R=B);var _=this.getViewHeight();G!=null&&(_=G),R=this.xzSize(R),_=this.xzSize(_);var ee=this.getOrthographicCamera(),k=R/_;ee.left=50*k/-2,ee.right=50*k/2,ee.top=25,ee.bottom=-25,ee.updateProjectionMatrix(),this.renderer.setSize(R,_)},T.prototype.zoomInitialStates=function(){},T.prototype.saveZoom=function(){},T.prototype.recoverZoom=function(){},T.prototype.zoomScale_call=function(B){},T.prototype.zoomW_call=function(B,G,R,_){},T.prototype.zoomCenter_call=function(B,G){},T.prototype.setViewAngle_call=function(B){this._viewangle=B},T.prototype.getFullDisplayRange=function(){return{}},T);function T(){var B=u.call(this,!1)||this;return B._viewcolor=15790320,B}s.MxDrawObject3d=P},{"./MxDrawObject":23,"./MxMaterial":30,"./MxNetData":31,"./MxTools":37,three:19,"three-orbitcontrols":17}],26:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxDrawObjectEvent=s.MxDrawObjectEventDefautProc=void 0;var o=b("./MxFun"),v=b("./Operate/MxJigCmdManager"),u=b("three"),w=b("./UI/MxUiVue"),L=b("./MxDrawData"),U=(N.prototype.onMousemove=function(P){if(w.MxUiVue.isNull())return 0;var T=this.mxObj.screenCoord2Doc(P.offsetX,P.offsetY,0);return T=this.mxObj.docCoord2Cad(T.x,T.y,T.z),w.MxUiVue.setTipCoord(o.MxFun.formatString("{0},{1},0.000",T.x.toFixed(3),T.y.toFixed(3))),0},N.prototype.onTouchStart=function(P){if(L.MxDrawData.m_isEnableIntelliSelect&&!v.MxJigCmdManager.isRunning()&&!this.mxObj.isPaningCommand()&&P.touches.length==1){var T=P.target.getBoundingClientRect(),B=P.touches[0].clientX-T.left,G=P.touches[0].clientY-T.top,R=this.mxObj,_=R.screenCoord2Current(B,G,0);if(!(R.getMxDatabase().getGripManager().onMouseLBDown(_)||R.isValidMcObject()&&R.getMcObject().getGripManager().onMouseLBDown(_))){var ee=new u.Vector3(B,G,0);return o.MxFun.sendStringToExecute("Mx_FrontEndWebpageIntelliSel",{pt:ee}),1}}return 0},N.prototype.onMousdown=function(P){if(P.button==v.MxJigCmdManager.MouseButton.kRight&&v.MxJigCmdManager.isRunning())return v.MxJigCmdManager.OnEnter(-1),P.stopPropagation(),0;if(L.MxDrawData.m_isEnableIntelliSelect&&P.button==v.MxJigCmdManager.MouseButton.kLeft&&!v.MxJigCmdManager.isRunning()&&!this.mxObj.isPaningCommand()){var T=this.mxObj,B=T.screenCoord2Current(P.offsetX,P.offsetY,0);if(!(T.getMxDatabase().getGripManager().onMouseLBDown(B)||T.isValidMcObject()&&T.getMcObject().getGripManager().onMouseLBDown(B))){var G=new u.Vector3(P.offsetX,P.offsetY,0);return o.MxFun.sendStringToExecute("Mx_FrontEndWebpageIntelliSel",{pt:G}),1}}return 0},N.prototype.init=function(P,T){this.mxObj=P;var B=this;T.addEventListener("mousemove",function(G){return B.onMousemove(G)}),T.addEventListener("mousedown",function(G){return B.onMousdown(G)}),T.addEventListener("touchstart",function(G){return B.onTouchStart(G)})},N);function N(){}s.MxDrawObjectEventDefautProc=U;var D=(f.prototype.onMousedown=function(P,T){this.callEvent("mousedown",P,T)},f.prototype.onMousemove=function(P,T){this.callEvent("mousemove",P,T)},f.prototype.onMouseup=function(P,T){this.callEvent("mouseup",P,T)},f.prototype.registEvent=function(P){var T=P.getMxDrawThreeJs().getRegistEventObject();if(!T)return!1;var B=this;o.MxFun.isPC()?(T.addEventListener("mouseup",function(G){var R=P.getMxDrawThreeJs().getDomMousePos(G);B.onMouseup(G,R)},!0),T.addEventListener("mousemove",function(G){var R=P.getMxDrawThreeJs().getDomMousePos(G);P.setCurrentMousePostion(G),B.onMousemove(G,R)},!0),T.addEventListener("mousedown",function(G){var R=P.getMxDrawThreeJs().getDomMousePos(G);P.setCurrentMousePostion(G),B.onMousedown(G,R)},!0)):(T.addEventListener("touchstart",function(G){P.setCurrentMousePostion(G),B.callEvent("touchstart",G)},!0),T.addEventListener("touchend",function(G){B.callEvent("touchend",G)},!0),T.addEventListener("touchmove",function(G){P.setCurrentMousePostion(G),B.callEvent("touchmove",G)},!0)),this.defautProc.init(P,this)},f.prototype.getEventCall=function(P){var T;return P=="mousemove"?T=this.aryMousemoveEventCall:P=="mouseup"?T=this.aryMouseupEventCall:P=="mousedown"?T=this.aryMousedownEventCall:P=="touchstart"?T=this.aryTouchstartEventCall:P=="touchend"?T=this.aryTouchendEventCall:P=="touchmove"&&(T=this.aryTouchmoveEventCall),T},f.prototype.callEvent=function(P,T,B){var G=this.getEventCall(P);if(G){for(var R=G.slice(),_=0,ee=R.length;_<ee;_++){var k=R[_](T,B);if(k==1)return k}return 0}},f.prototype.addEventListener=function(P,T,B){B===void 0&&(B=!1);var G=this.getEventCall(P);return!!G&&(-1<G.indexOf(T)||(B?G.unshift(T):G.push(T)),!0)},f.prototype.removeEventListener=function(P,T){var B=this.getEventCall(P);if(!B)return!1;var G=B.indexOf(T);return-1<G&&(B.splice(G,1),!0)},f);function f(){this.aryMousedownEventCall=[],this.aryMouseupEventCall=[],this.aryMousemoveEventCall=[],this.aryTouchstartEventCall=[],this.aryTouchendEventCall=[],this.aryTouchmoveEventCall=[],this.defautProc=new U}s.MxDrawObjectEvent=D},{"./MxDrawData":22,"./MxFun":27,"./Operate/MxJigCmdManager":53,"./UI/MxUiVue":64,three:19}],27:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxFun=void 0;var o,v,u,w,L,U,N,D,f,P,T,B,G,R,_,ee=b("three"),k=b("./MxManager"),E=b("./MxDrawObject"),W=b("./MxDrawObject2d"),C=b("./MxDrawObject3d"),F=b("./UI/MxUiObjectMobile"),M=b("./UI/MxUiObjectPC"),a=b("./Operate/MxJigCmdManager"),h=b("./Operate/MxJigGetLine"),y=b("./Operate/MxCmdRunManager"),j=b("./UI/MxUiVue"),Y=b("./MxThreeJS"),q=b("./MxWindowsEvent"),V=b("./MxTools"),ne=b("./MxDrawCommands"),ie=b("./MxDrawData"),he=b("./MxLocalFileLoad"),be=b("./TempTest/MxTestJig"),je=b("./MxVersion"),xe=b("./MrxDbgUtils");function Fe(se){se.cmd&&Ye(se.cmd)}function J(se){var ve=new RegExp("(^|&)"+se+"=([^&]*)(&|$)"),Ee=window.location.href,rt=Ee.indexOf("?"),tt=(Ee=rt==-1?"":Ee.substring(rt)).substr(1).match(ve);return tt!=null?decodeURIComponent(tt[2]):""}function ge(){return k.MxManager.currentMx()}function oe(se,ve){var Ee={};if(se!=null)if(se instanceof Array)Ee.is2d=!0;else{se.length==0&&(se="empty");var rt=se.substring(se.lastIndexOf(".")+1).toLowerCase();if(rt!="dwg"&&rt!="dxf"&&rt!="dwf"&&rt!="mwg"&&rt!="wgh"||(Ee.is2d=!0),ve!=1&&ve!=null&&rt!="wgh"){var tt=void 0,xt=se.split("/");(tt=xt.length==1?xt[0]:xt[xt.length-1])[0]=="$"&&(tt=tt.substring(1));for(var Rt=void 0,At=0;At<xt.length-1;At++)Rt=At==0?xt[At]:Rt+"/"+xt[At];se=Rt?Rt+"/$"+tt+".mxb1.wgh":"$"+tt+".mxb1.wgh"}}else se="empty_template.dwg";return Ee.sFileName=se,Ee}function le(se){if(typeof se=="string"){var ve=se.substring(se.lastIndexOf(".")+1).toLowerCase();if(ve!="dwg"&&ve!="wgh"){var Ee=se.lastIndexOf("?");if(Ee!=-1){var rt=se.substring(Ee,se.length);return{sFileName:se=se.substring(0,Ee),sUrlParam:rt}}}}return null}function Re(){return a.MxJigCmdManager.stopCmd(a.MxJigCmdManager.DetailedResult.kUnknown)}function Ye(se,ve){if(se.length!=0){var Ee=ge();return y.MxCmdRunManager.runCmd(Ee,se,ve)}Re()}function Be(se){se!=null&&(se.init(),j.MxUiVue.init(se)),B||(console.log("MxDraw Version:"+je.MxBulid.getVersion()),B=!0,_=new he.MxLocalNodeJs,a.MxJigCmdManager.init(),q.MxWindowsEvent.registEvent(),ne.MxDrawCommands.registerCommand(),window.mxConfig_isLoadTest&&be.MxTest.registerCommand(),R.sendStringToExecute=Fe)}v=o||(s.MxFun=o={}),u=".",D=U=L=-1,T=null,B=!(P="ws://localhost:5090"),R={},_=G=f=N=w=void 0,v.getUiObj=function(){return T},v.on=function(se,ve){k.MxManager.on(se,ve)},v.callEvent=function(se,ve){return k.MxManager.callEvent(se,ve)},v.getNodeJs=function(){return _},v.setMxServer=function(se){P=se},v.getMxServer=function(){return P},v.isPC=function(){return!/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)},v.getClientPlatform=function(){return navigator.platform},v.getClientInfo=function(){return{width:document.body.clientWidth,height:document.body.clientHeight}},v.curPath=function(){return u},v.setCurPath=function(se){u=se},v.getQueryString=J,v.getLocationPageUrl=function(){var se=window.location.href,ve=se.lastIndexOf("?");return ve==-1?se:se.substring(0,ve)},v.getHostUrl=function(){var se=window.location.hostname;return se.substring(0,4)!="http"&&(se="http://"+se),se},v.isAbsoluteWebPath=function(se){return se.substring(0,4)=="http"},v.getUrlParams=function(){var se=window.location.search,ve=se.substr(1,se.length).split("&"),Ee=new Array;if(ve!=null)for(var rt=0;rt<ve.length;rt++){var tt=ve[rt].replace(/[=|^==]/,"&").split("&");if(1<tt.length){var xt=new Array;xt.push(decodeURIComponent(tt[0])),xt.push(decodeURIComponent(tt[1])),Ee.push(xt)}}return Ee},v.call=function(se,ve,Ee){ve==null?ve="{}":typeof ve=="string"?ve.length==0?ve="{}":ve[0]=="["&&ve[ve.length-1]=="]"||ve[0]=="{"&&ve[ve.length-1]=="}"||(ve='"'+(ve=ve.replace(/"/g,"'"))+'"'):ve=typeof ve=="object"?JSON.stringify(ve):"{}",k.MxManager.currentMx().call(se,ve,Ee)},v.loadCodeToServer=function(se,ve){k.MxManager.currentMx().loadCodeToServer(se,ve)},v.getCurrentMx=function(){return k.MxManager.currentMx()},v.isEnableSelect=function(){if(L!=-1)return L==1;var se=J("select");return L=0,se!=null&&se.toLowerCase()=="y"&&(L=1),L==1},v.is3DDwg=function(){if(D!=-1)return D==1;var se=J("3ddwg");return D=0,se!=null&&se.toLowerCase()=="y"&&(D=1),D==1},v.isStaticLoad=function(){if(U!=-1)return U==1;var se=J("static");return U=0,se!=null&&se.toLowerCase()=="y"&&(U=1),U==1},v.enableSelect=function(se){L=se?1:0},v.enablStaticLoad=function(se){U=se==null||se?1:0},v.dwgDir=function(){return N!=null||(N=J("dwgdir"))==null&&(N=""),N},v.setDwgDir=function(se){N=se},v.getStaticServer=function(){return f!=null||(f=J("staticServer"))==null&&(f=""),f},v.setStaticServer=function(se){f=se},v.is2dParam=function(){if(w!=null)return w;var se=J("file");if(w=!1,se!=null){var ve=se.substring(se.lastIndexOf(".")+1);ve.toLowerCase()!="dwg"&&ve.toLowerCase()!="dxf"&&ve.toLowerCase()!="dwf"&&ve.toLowerCase()!="mwg"||(w=!0)}return w},v.set2dParam=function(se){w=se},v.showLayer=function(se,ve){return k.MxManager.currentMx().showLayer(se,ve)},v.screenCoord2World=function(se,ve,Ee){return se instanceof Object?k.MxManager.currentMx().screenCoord2World(se.x,se.y,se.z):k.MxManager.currentMx().screenCoord2World(se,ve,Ee)},v.worldCoord2Screen=function(se,ve,Ee){return se instanceof Object?k.MxManager.currentMx().worldCoord2Screen(se.x,se.y,se.z):k.MxManager.currentMx().worldCoord2Screen(se,ve,Ee)},v.docCoord2Cad=function(se,ve,Ee){return se instanceof Object?k.MxManager.currentMx().docCoord2Cad(se.x,se.y,se.z):k.MxManager.currentMx().docCoord2Cad(se,ve,Ee)},v.cadCoord2Doc=function(se,ve,Ee){return se instanceof Object?k.MxManager.currentMx().cadCoord2Doc(se.x,se.y,se.z):k.MxManager.currentMx().cadCoord2Doc(se,ve,Ee)},v.docCoord2World=function(se,ve,Ee){return se instanceof Object?k.MxManager.currentMx().docCoord2World(se.x,se.y,se.z):k.MxManager.currentMx().docCoord2World(se,ve,Ee)},v.worldCoord2Doc=function(se,ve,Ee){return se instanceof Object?k.MxManager.currentMx().worldCoord2Doc(se.x,se.y,se.z):k.MxManager.currentMx().worldCoord2Doc(se,ve,Ee)},v.screenCoord2Doc=function(se,ve,Ee){return se instanceof Object?k.MxManager.currentMx().screenCoord2Doc(se.x,se.y,se.z):k.MxManager.currentMx().screenCoord2Doc(se,ve,Ee)},v.docCoord2Screen=function(se,ve,Ee){return se instanceof Object?k.MxManager.currentMx().docCoord2Screen(se.x,se.y,se.z):k.MxManager.currentMx().docCoord2Screen(se,ve,Ee)},v.docCoordLong2Cad=function(se){return k.MxManager.currentMx().docCoordLong2Cad(se)},v.cadCoordLong2Doc=function(se){return k.MxManager.currentMx().cadCoordLong2Doc(se)},v.viewCoordLong2Cad=function(se){return k.MxManager.currentMx().viewCoordLong2Cad(se)},v.cadCoordLong2View=function(se){return k.MxManager.currentMx().cadCoordLong2View(se)},v.zoomCenter=function(se,ve){k.MxManager.currentMx().is2D()&&(k.MxManager.currentMx().zoomCenter(se,ve),k.MxManager.currentMx().updateDisplay())},v.zoomW=function(se,ve,Ee,rt,tt){k.MxManager.currentMx().is2D()&&(k.MxManager.currentMx().zoomW(new ee.Vector3(se,ve,0),new ee.Vector3(Ee,rt,0),tt),k.MxManager.currentMx().updateDisplay())},v.zoomScale=function(se){k.MxManager.currentMx().is2D()&&(k.MxManager.currentMx().zoomScale(se),k.MxManager.currentMx().updateDisplay())},v.zoomAll=function(){k.MxManager.currentMx().is2D()&&(k.MxManager.currentMx().zoomAll(),k.MxManager.currentMx().updateDisplay())},v.deleteAll=function(){return k.MxManager.currentMx().deleteAll()},v.callCommand=function(se,ve,Ee){k.MxManager.currentMx().callCommand(se,ve,Ee)},v.getCurrentColor=function(){return k.MxManager.currentMx().getCurrentColor()},v.setCurrentColor=function(se){k.MxManager.currentMx().setCurrentColor(se)},v.showLoading=function(){T!=null&&T.ShowLoading()},v.hideLoading=function(){T!=null&&T.HideLoading()},v.showProp=function(se){T!=null&&T.ShowObjectProperty(se)},v.hideProp=function(){T!=null&&T.HideObjectProp()},v.getUiObject=function(){return T},v.getViewCenterDocCoord=function(){return k.MxManager.currentMx().is2D()?k.MxManager.currentMx().getViewCenterDocCoord():new ee.Vector3(0,0,0)},v.screenCoordLong2Doc=function(se){return k.MxManager.currentMx().is2D()?k.MxManager.currentMx().screenCoordLong2Doc(se):se},v.docCoordLong2Screen=function(se){return k.MxManager.currentMx().is2D()?k.MxManager.currentMx().docCoordLong2Screen(se):se},v.worldCoordLong2Doc=function(se){return k.MxManager.currentMx().is2D()?k.MxManager.currentMx().worldCoordLong2Doc(se):se},v.docCoordLong2World=function(se){return k.MxManager.currentMx().is2D()?k.MxManager.currentMx().docCoordLong2World(se):se},v.screenCoordLong2World=function(se){return k.MxManager.currentMx().is2D()?k.MxManager.currentMx().screenCoordLong2World(se):se},v.worldCoordLong2Screen=function(se){return k.MxManager.currentMx().is2D()?k.MxManager.currentMx().worldCoordLong2Screen(se):se},v.addSelectEvent=function(se){k.MxManager.addSelectEvent(se)},v.clearSelectEvent=function(){k.MxManager.clearSelectEvent()},v.removeThreejsObject=function(se,ve,Ee){se&&(se.traverse(function(rt){(rt instanceof ee.Mesh||rt instanceof ee.Line||rt instanceof ee.LineLoop)&&(rt.geometry.dispose(),Ee&&(rt.material instanceof Array?rt.material.forEach(function(tt){tt.dispose()}):rt.material.dispose()))}),ve.remove(se))},v.setOutServerDebugCall=function(se){k.MxManager.setOutDebugCall(se)},v.updateDisplay=function(){k.MxManager.updateDisplay()},v.getCurrentDraw=ge,v.formatString=function(se){for(var ve=[],Ee=1;Ee<arguments.length;Ee++)ve[Ee-1]=arguments[Ee];for(var rt=0;rt<ve.length;rt++)se=se.replace("{".concat(rt,"}"),ve[rt]);return se},v.createMxUiObject=function(se){var ve;return ve=this.isPC()?new M.MxUiObjectPC:new F.MxUiObjectMobile,se(T=ve),ve.create(),ve},v.openFile=function(se,ve){var Ee="";if(typeof se=="string"){var rt=le(se);rt&&(Ee=rt.sUrlParam,se=rt.sFileName)}ve==null&&(ve=!1);var tt=oe(se,ve);return tt.is2d&&(w=tt.is2d),se=tt.sFileName,k.MxManager.currentMx().openFile(se,Ee)},v.createMxObject=function(se,ve,Ee,rt,tt,xt,Rt,At){B||Be(),typeof se=="string"&&(se=se.length==0?void 0:document.getElementById(se));var He=null,Gt="";if(At)ve="",(He=new W.MxDrawObject2d).initRunMode(E.MxRunMode.kCPPMxCAD),He.setViewColor(0);else{if(ve==null)ve=v.getQueryString("file");else{var jt=le(ve);jt&&(Gt=jt.sUrlParam,ve=jt.sFileName)}var Tn=rt==null||rt;if(ve===void 0||ve.length==0||ve=="empty")Tn=!0,ve=ve=="empty"?"":"empty_template.dwg";else{var mn=oe(ve,xt);mn.is2d&&(Tn=mn.is2d),ve=mn.sFileName}tt==1&&(ve=""),Tn?(He=new W.MxDrawObject2d).setViewColor(0):(He=new C.MxDrawObject3d).setViewColor(15790320)}return Ee!=null&&Ee(He),He.create(se,ve,Gt,Rt),He},v.getMxObjectFormElement=function(se){return k.MxManager.getMxObject(se)},v.initMxCpp=function(se){k.MxManager.initMxCpp(se)},v.isRunningCommand=function(){return a.MxJigCmdManager.isRunning()},v.stopRunCommand=Re,v.runCommand=function(se){return a.MxJigCmdManager.runCmd(se)},v.getTHREE=function(){return ee},v.getLine=function(se){var ve=new h.MxJigGetLine;ve.setRetCall(se),a.MxJigCmdManager.runCmd(ve)},v.addCommand=function(se,ve,Ee){y.MxCmdRunManager.addCommand(se,ve,Ee)},v.sendStringToExecute=Ye,v.getMxEntity=function(se){var ve=ge();return ve?ve.getMxEntityUserObject(se):null},v.initUiDataObject=function(se){j.MxUiVue.isNull()&&(se.init(v),j.MxUiVue.init(se))},v.init=Be,v.addWindowsEvent=function(se){q.MxWindowsEvent.addEvent(se)},v.getCurrentMousePostion=function(){return ge().getCurrentMousePostion()},v.getMxThreeJS=function(){return Y.MxThreeJS},v.getMxTools=function(){return V.MxTools},v.getMxCmdRunManager=function(){return y.MxCmdRunManager},v.getMxJigCmdManager=function(){return a.MxJigCmdManager},v.initQuickCommand=function(se){y.MxCmdRunManager.InitQuickCommand(se)},v.InitLanguageString=function(se){y.MxCmdRunManager.InitLanguageString(se)},v.getLanguageString=function(se,ve){return ve===void 0&&(ve=""),y.MxCmdRunManager.getLanguageString(se,ve)},v.Assert=function(se){se||console.log("MxAssert error")},v.setIniset=function(se){ie.MxDrawData.setIniset(se)},v.setPostMessageToParentFrameFunction=function(se){G=se},v.postMessageToParentFrame=function(se){return G!=null&&(G(se),!0)},v.onParentFrameMessage=function(se){se!=null&&se.type!=null&&R[se.type]&&R[se.type](se)},v.acutPrintf=function(se){for(var ve=[],Ee=1;Ee<arguments.length;Ee++)ve[Ee-1]=arguments[Ee];if(!j.MxUiVue.isNull()){for(var rt=arguments,tt=rt[0],xt=0;xt<rt.length-1;xt++){var Rt=new RegExp("\\{"+xt+"\\}","gm");tt=tt.replace(Rt,rt[xt+1])}j.MxUiVue.AcutPrintfNoFormat(tt,!0)}},v.loadImageMaterial=function(se,ve){k.MxManager.getMxDbTextureManager().loadImage(se,ve)},v.loadSVG=function(se,ve,Ee,rt){k.MxManager.getMxDbSvgManager().loadSVG(se,ve,Ee,rt)},v.initMxDbEntityType=function(se){k.MxManager.getMxDbEntityClassHierarchy().init(se)},v.initDynamicCreate=function(se){k.MxManager.getMxDbEntityClassHierarchy().initDynamic(se)},v.ceneratecursor=function(se,ve,Ee,rt){se===void 0&&(se=128),ve===void 0&&(ve=10),Ee===void 0&&(Ee=!0);var tt=document.createElement("canvas");tt.width=tt.height=se,tt.style.background="transparent";var xt=tt.getContext("2d"),Rt=se%2==0?-.5:0,At=ve%2==0?-.5:0;xt.strokeStyle=rt||"#fff",Ee&&(xt.beginPath(),xt.moveTo(tt.width/2+Rt,Rt),xt.lineTo(tt.width/2+Rt,tt.height+Rt),xt.stroke(),xt.beginPath(),xt.moveTo(Rt,tt.height/2+Rt),xt.lineTo(tt.width+Rt,tt.height/2+Rt),xt.stroke()),xt.beginPath(),xt.strokeRect(se/2-ve/2+At,se/2-ve/2+At,ve,ve),xt.stroke();var He=new Image;return He.src=tt.toDataURL("image/png"),He.src},v.getMrxDbgUtilsClass=function(){return xe.MrxDbgUtils},v.getNumberColor=function(se){return se instanceof Object?se.getHex&&(se=se.getHex()):typeof se=="string"&&(se=parseInt(se)),se}},{"./MrxDbgUtils":20,"./MxDrawCommands":21,"./MxDrawData":22,"./MxDrawObject":23,"./MxDrawObject2d":24,"./MxDrawObject3d":25,"./MxLocalFileLoad":28,"./MxManager":29,"./MxThreeJS":36,"./MxTools":37,"./MxVersion":39,"./MxWindowsEvent":40,"./Operate/MxCmdRunManager":47,"./Operate/MxJigCmdManager":53,"./Operate/MxJigGetLine":54,"./TempTest/MxTestJig":60,"./UI/MxUiObjectMobile":62,"./UI/MxUiObjectPC":63,"./UI/MxUiVue":64,three:19}],28:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxLocalDwgFileLoad=s.MxLocalFileLoad=s.MxLocalNodeJs=void 0;var o=b("./MxFun"),v=(u.prototype.init=function(D){this.loadFileCall=D.loadFileFun},u.prototype.loadFile=function(D,f,P,T,B){this.loadFileCall!=null?this.loadFileCall(D,f,P,T,B):B(void 0)},u);function u(){this.loadFileCall=null}s.MxLocalNodeJs=v;var w=(L.prototype.setPath=function(D){this.path=D},L.prototype.setBinary=function(D){this.isBinary=D},L.prototype.load=function(D,f,P,T){o.MxFun.getNodeJs().loadFile(this.path+D,this.isBinary,f,P,T)},L);function L(){this.path="",this.isBinary=!1}s.MxLocalFileLoad=w;var U=(N.prototype.setShowloading=function(D){this._isShowLoading=D},N.prototype.load=function(D,f){var P="$"+f+".mxb1.wgh";this._path=D,this._filename=f;var T=this;this.getFile(this._path,P,!1,function(B){typeof B=="string"?T.net.onStaticHeadMessage(B):console.log("mx error h1")},function(){console.log("mx get "+P+" faild")})},N.prototype.getDatas=function(){if(this._iGet>=this._dataNum)this._isShowLoading&&o.MxFun.hideLoading();else{var D=this._dataType[this._iGet];this._iGet++;var f=this,P=this._iGet+1,T="$"+this._filename+".mxb"+P+".wgh",B=D!=0;this.getFile(this._path,T,B,function(G){f.net.onStaticMessage(G),f.getDatas()},function(){f._dataNum=0,f._iGet=0,f._isShowLoading&&o.MxFun.hideLoading(),console.log("mx get "+T+" faild")})}},N.prototype.onRenderHead=function(D){var f=JSON.parse(D);this._dataType=f.type,this._dataNum=f.count,this._iGet=0,this._isShowLoading&&o.MxFun.showLoading(),this.getDatas()},N.prototype.getFile=function(D,f,P,T,B){var G=new w;G.setPath(D),G.setBinary(P),G.load(f,T,function(){},B)},N);function N(D){this.net=null,this._dataNum=0,this._iGet=0,this._dataType=[],this._path="",this._filename="",this._isShowLoading=!0,this.net=D}s.MxLocalDwgFileLoad=U},{"./MxFun":27}],29:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxManager=s.MxCpp=s.MxData=void 0;var o,v,u=b("./View/MxDbEntity"),w=b("./View/MxDbTextureManager"),L=b("./SVGLoader/MxSVGLoader");(v=o||(s.MxData=o={})).iSelectRenderOrder=5,v.iCADMeshRenderOrder=10,v.iCADCurveRenderOrder=20,v.iMxEntityRenderOrder=30,v.iGripRenderOrder=110,v.iDynJigRenderOrder=120;var U,N,D,f,P,T,B,G,R,_,ee,k,E=(W.prototype.init=function(C){this.imp=C},W.prototype.getMxCAD_MxCpp=function(){return this.imp},W.prototype.getMxCAD_App=function(){return this.imp.App},W.prototype.newMcGePoint3d=function(C){return this.imp?this.imp.newMcGePoint3d(C):null},W.prototype.decodeFromGb2312=function(C){return this.imp.decodeFromGb2312(C)},W.prototype.encodeToGb2312=function(C){return this.imp.encodeToGb2312(C)},W.prototype.getMcDbCurve=function(C){if(this.imp.App.objectIdIsKindOf(C,"McDbCurve"))return this.imp.App.objectIdToObject(C)},W);function W(){}s.MxCpp=E,N=U||(s.MxManager=U={}),D=[],f=null,T=[],B=void(P=0),G=new w.MxDbTextureManager,R=new L.MxSvgManager,_=new u.MxDbEntityClassHierarchy,ee=new E,k={},N.add=function(C){D.push(C)},N.on=function(C,F){k[C]||(k[C]=[]),k[C].push(F)},N.callEvent=function(C,F){var M;if(k[C])return k[C].forEach(function(a){var h=a(F);M=M||h}),M},N.initMxCpp=function(C){ee.init(C)},N.getMxCpp=function(){return ee},N.allocId=function(){return++P},N.getMxDbEntityClassHierarchy=function(){return _},N.getMxDbTextureManager=function(){return G},N.getMxDbSvgManager=function(){return R},N.outDebugString=function(C){B==null?console.log(C):B(C)},N.setOutDebugCall=function(C){B=C},N.onLoad=function(){for(var C in D)D[C].onLoad("")},N.updateDisplay=function(){for(var C in D)D[C].updateDisplay()},N.currentMx=function(){return f},N.setCurrentMx=function(C){f=C},N.initResize=function(){for(var C in D)D[C].initResize()},N.addSelectEvent=function(C){T.push(C)},N.clearSelectEvent=function(){T=[]},N.callSelectObject=function(C){for(var F in T)if(T[F](C)==1)break},N.getMxObject=function(C){if(typeof C=="number"){for(var F in D)if(D[F].getId()===C)return D[F]}else for(var F in D)if(D[F].getCanvas()===C)return D[F];return null}},{"./SVGLoader/MxSVGLoader":58,"./View/MxDbEntity":68,"./View/MxDbTextureManager":73}],30:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxMaterial=void 0;var o,v=b("three");(function(u){u.shaderUniforms={crAmbient:{value:new v.Vector3(1,0,0)},crDiffuse:{value:new v.Vector3(1,0,0)},crSpecular:{value:new v.Vector3(1,0,0)}},u.m_arrSystemColors=new Array(0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10066176,10066252,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510272,8755532,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019904,7510348,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529536,6265164,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,39168,5019980,32512,4161343,19456,2509862,65343,8388511,52275,6737023,39206,5019999,32543,4161359,19475,2509871,65407,8388543,52326,6737049,39244,5020018,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39282,5020037,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39321,5020057,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29337,5014937,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19609,5010073,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9881,5005209,8063,4149119,4940,2502476,255,8355839,204,6710988,153,5000345,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490521,6245529,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980889,7490713,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471257,8735897,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,10027161,10046617,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,10027122,10046597,8323167,8339311,4980793,4990530,16711807,16744383,13369446,13395609,10027084,10046578,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,10027046,10046559,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215),u.m_arrDefUseMaterials=new Array(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null),u.m_arrDefUseCurveMaterials=new Array(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null),u.m_arrDefUseBasicMaterials=new Array(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null),u.m_selectMaterial=new v.MeshPhongMaterial({color:255,opacity:.2,transparent:!0,side:v.DoubleSide}),u.m_mouseMoveMaterial=new v.MeshPhongMaterial({color:16776960,side:v.DoubleSide}),u.m_lockedMaterial=new v.MeshPhongMaterial({color:197379,side:v.DoubleSide}),u.m_samplePoints=new v.PointsMaterial({color:255,depthTest:!1,size:8}),u.m_samplePointsMouseMove=new v.PointsMaterial({color:16711680,depthTest:!1,size:12});var w=new v.MeshBasicMaterial({color:16777215,transparent:!0,depthTest:!1,side:v.DoubleSide,opacity:1,stencilWrite:!1,colorWrite:!1});u.getStencilMaterial=function(){return w},u.GetColorByIndex=function(L){return u.m_arrSystemColors[L]},u.GetColorMaterial=function(L){var U=u.m_arrDefUseMaterials[L];return U===null&&(U=new v.MeshLambertMaterial({color:u.m_arrSystemColors[L],side:v.DoubleSide}),u.m_arrDefUseMaterials[L]=U),U},u.GetBaseColorMaterial=function(L){var U=u.m_arrDefUseBasicMaterials[L];return U===null&&(U=new v.MeshBasicMaterial({color:u.m_arrSystemColors[L],side:v.DoubleSide}),u.m_arrDefUseMaterials[L]=U),U},u.GetCurveColorMaterial=function(L){var U=u.m_arrDefUseCurveMaterials[L];return U===null&&(U=new v.LineBasicMaterial({color:u.m_arrSystemColors[L],linewidth:1}),u.m_arrDefUseCurveMaterials[L]=U),U},u.GetSelectMaterial=function(){return u.m_selectMaterial},u.GetMouseMoveMaterial=function(){return u.m_mouseMoveMaterial},u.GetLockedMaterial=function(){return u.m_lockedMaterial},u.GetSamplePointsMaterial=function(){return u.m_samplePoints},u.GetSamplePointsMouseMoveMaterial=function(){return u.m_samplePointsMouseMove},u.createMaterial=function(L){var U=void 0;if(L==null)return U;function N(D,f){if(f.map!=null){var P=f.map,T=new v.TextureLoader().load(P);T.wrapS=T.wrapT=v.RepeatWrapping,D.map=T,D.side=v.DoubleSide}}return L.transparent!=0?L.transparent=!0:L.transparent=!1,L.name=="MeshPhongMaterial"?N(U=new v.MeshPhongMaterial(L),L):L.name=="MeshBasicMaterial"?N(U=new v.MeshBasicMaterial(L),L):L.name=="MeshDepthMaterial"?N(U=new v.MeshDepthMaterial(L),L):L.name=="MeshNormalMaterial"?N(U=new v.MeshNormalMaterial(L),L):L.name=="MeshLambertMaterial"?N(U=new v.MeshLambertMaterial(L),L):L.name=="MeshStandardMaterial"&&N(U=new v.MeshStandardMaterial(L),L),U}})(o||(s.MxMaterial=o={}))},{three:19}],31:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxHFileLoad=s.MxNet=s.MxNetBinMessageType=s.MxNetSend=s.MxNetMessage=s.MxNetMessageType=s.MxNetData=void 0;var o,v,u=b("three"),w=b("./MxFun"),L=b("pako"),U=b("./MxManager"),N=b("./MxDrawData"),D=(f.prototype.getId=function(){return this._dataView.getInt32(4,!0)},f.prototype.getVersion_MwBlobHead=function(){return this._dataView.getInt32(60,!0)},f.prototype.getVersion_MwBlobHeadDynLen=function(){return this._dataView.getInt32(4,!0)},f.prototype.getdPointCurveBuffersHead=function(){var C={};return C.ver=this._dataView.getInt32(4,!0),C.databaseIndex=this._dataView.getInt32(8,!0),C.zeroLayerIdIndex=this._dataView.getInt32(16,!0),C.datacount=this._dataView.getInt32(20,!0),C.datasize=this._dataView.getInt32(24,!0),C},f.prototype.getdPointMeshBuffersHead=function(){var C={};return C.ver=this._dataView.getInt32(4,!0),C.databaseIndex=this._dataView.getInt32(8,!0),C.id=this._dataView.getInt32(12,!0),C.zeroLayerIdIndex=this._dataView.getInt32(16,!0),C.datacount=this._dataView.getInt32(20,!0),C.datasize=this._dataView.getInt32(24,!0),C},f.prototype.getdPointTextureBuffersHead=function(){var C={};return C.ver=this._dataView.getInt32(4,!0),C.databaseIndex=this._dataView.getInt32(8,!0),C.zeroLayerIdIndex=this._dataView.getInt32(16,!0),C.datacount=this._dataView.getInt32(20,!0),C.datasize=this._dataView.getInt32(24,!0),C},f.prototype.getBlobHeadForMemorySectionsHead=function(C){var F={};return F.type=this._dataView.getInt32(C,!0),C+=4,F.ver=this._dataView.getInt32(C,!0),C+=4,F.databaseIndex=this._dataView.getInt32(C,!0),C+=4,F.nOffset=C,F},f.prototype.getMemorySectionsHead=function(){var C=this.getBlobHeadForMemorySectionsHead(0);return C.zeroLayerIdIndex=this._dataView.getInt32(C.nOffset,!0),C.nOffset+=4,C.datacount=this._dataView.getInt32(C.nOffset,!0),C.nOffset+=4,C.datasize=this._dataView.getInt32(C.nOffset,!0),C.nOffset+=4,C.datasize!=C.nOffset&&console.log("mx: sectionshead size assert(0)"),C},f.prototype.getMemorySectionHead=function(C){var F=this.getBlobHeadForMemorySectionsHead(C);return C=F.nOffset,F.pointCount=this._dataView.getInt32(C,!0),C+=4,F.layerId=this._dataView.getInt32(C,!0),C+=4,F.blkId=this._dataView.getInt32(C,!0),C+=4,F.memColor=this._dataView.getInt32(C,!0),C+=4,F.memId=this._dataView.getInt32(C,!0),C+=4,F.memType=this._dataView.getInt32(C,!0),C+=4,F.offset=C,F},f.prototype.getdPointTextureBufferDataHead=function(C){C+=4,C+=4,C+=4;var F={};return F.dataCount=this._dataView.getInt32(C,!0),C+=4,F.layerId=this._dataView.getInt32(C,!0),C+=4,F.blkId=this._dataView.getInt32(C,!0),C+=4,F.offset=C,F},f.prototype.getdPointCurveBufferDataHead=function(C){C+=4,C+=4,C+=4;var F={};return F.pointCount=this._dataView.getInt32(C,!0),C+=4,F.layerId=this._dataView.getInt32(C,!0),C+=4,F.blkId=this._dataView.getInt32(C,!0),C+=4,F.offset=C,F},f.prototype.getdPointMeshBufferDataHead=function(C){C+=4,C+=4,C+=4;var F={};return F.pointCount=this._dataView.getInt32(C,!0),C+=4,F.layerId=this._dataView.getInt32(C,!0),C+=4,F.blkId=this._dataView.getInt32(C,!0),C+=4,F.offset=C,F},f.prototype.getDatabaseIndex=function(){return this._dataView.getInt32(8,!0)},f.prototype.getColorIndex=function(){return this._dataView.getInt32(24,!0)},f.prototype.getBufferType=function(){return this._dataView.getInt32(32,!0)},f.prototype.getIsSketchEntity=function(){return this._dataView.getInt32(40,!0)},f.prototype.getLayerId=function(){return this._dataView.getInt32(44,!0)},f.prototype.getBlockId=function(){return this._dataView.getInt32(48,!0)},f.prototype.getVertexBufferSize=function(){return this._dataView.getInt32(12,!0)},f.prototype.getIndexBufferSize=function(){return this._dataView.getInt32(16,!0)},f.prototype.getZeroLayerId=function(){return this._dataView.getInt32(52,!0)},f.prototype.getSelectMark=function(){return this._dataView.getInt32(56,!0)},f.prototype.getMateria=function(){var C=this._dataView.getInt32(36,!0);if(C==0)return"";for(var F=[],M=0;M<C;M++){var a=String.fromCharCode(this._dataView.getUint8(80+M));F.push(a)}return F.join("")},f.prototype.getDrawDataOffset=function(){return this._dataView.getInt32(36,!0)+80},f.prototype.getMesh=function(){var C=this._dataView.getInt32(4,!0),F=this._dataView.getInt32(32,!0)==0,M={},a=this._dataView.getInt32(12,!0),h=this._dataView.getInt32(16,!0);if(a===0||h===0)return M.size=80,M;var y,j=new u.Geometry,Y=80;y=F?a/4/8:a/4/2;for(var q=0;q<y;q++){var V=this._dataView.getFloat32(Y+0,!0),ne=this._dataView.getFloat32(Y+4,!0),ie=0;F?(ie=this._dataView.getFloat32(Y+8,!0),this._dataView.getFloat32(Y+12,!0),this._dataView.getFloat32(Y+16,!0),this._dataView.getFloat32(Y+20,!0),this._dataView.getFloat32(Y+24,!0),this._dataView.getFloat32(Y+28,!0),Y+=32):Y+=8;var he=new u.Vector3(V,ne,ie);j.vertices.push(he)}var be=h/4;for(q=0;q<be;q+=3){var je=this._dataView.getInt32(Y,!0);Y+=4;var xe=this._dataView.getInt32(Y,!0);Y+=4;var Fe=this._dataView.getInt32(Y,!0);Y+=4;var J=new u.Face3(je,xe,Fe);j.faces.push(J)}var ge=this.getIsSketchEntity();return M.size=Y,M.geometry=j,M.id=C,M.isSketchEntity=ge,M.nColorIndex=this._dataView.getInt32(24,!0),M},f.prototype.getCurve=function(C){var F,M=this._dataView.getInt32(32,!0),a=this.getIsSketchEntity(),h=M==0,y={};if((F=h?this._dataView.getInt32(20,!0)/4/3:this._dataView.getInt32(20,!0)/4/2)<2)return y;for(var j=new u.Geometry,Y=C,q=0;q<F;q++){var V=this._dataView.getFloat32(Y,!0);Y+=4;var ne=this._dataView.getFloat32(Y,!0);Y+=4;var ie=0;h&&(ie=this._dataView.getFloat32(Y,!0),Y+=4),j.vertices.push(new u.Vector3(V,ne,ie))}var he=this._dataView.getInt32(4,!0);return y.size=Y,y.geometry=j,y.id=he,y.isSketchEntity=a,y.colorIndex=this._dataView.getInt32(28,!0),y},f);function f(C){this._dataView=C}s.MxNetData=D,(v=o||(s.MxNetMessageType=o={})).kAddLayer="00000007",v.kClearLayer="00000008",v.kHideLayer="00000009",v.kShowLayer="00000010",v.kUpdateDisplayRange="00000011",v.kCallJsReturn="00000012",v.kLayerData="00000013",v.kSendDebugString="00000014",v.kShowLoading="00000015",v.kHideLoading="00000016",v.kSelectObject="00000017",v.kGlRenderHead="00000018",v.kUserLoginResult="00000019",v.kOpenFileResult="00000020",v.kServerReturn="00000021",v.kMxCADLayerData="00000056",v.kMxCADSystemVariable="00000057";var P=(T.prototype.setJsRetCall=function(C,F,M){this.serverJsRetCall.set(F+M,C)},T.prototype.onSocketErrort=function(){this.serverJsRetCall.forEach(function(C){C(void 0)}),this.serverJsRetCall=new Map},T.prototype.Do=function(C){var F=this.net.getCurrentDatabaseId();if(F==-1){var M=C.substring(0,4);F=parseInt(M)}var a=C.substring(4,12),h=C.substring(12);return this.messageCall[a]!=null&&(this.messageCall[a](h,F),!0)},T);function T(C,F){this.messageCall=new Map,this.serverJsRetCall=new Map,this.net=null,this.net=F;var M=this;this.messageCall[o.kUpdateDisplayRange]=function(a){if(!M.net.isTzDwgStaticFile()){a=a.replace(/\\/g,"\\\\");try{var h=JSON.parse(a);if(h!=null&&C.is2D()){C.initCAD2Doc(new u.Matrix4),h.newbrownermode?h.DToSMat?N.MxDrawData.m_isCorrectLargeCoordinates?(C.intiDoc2Wold(new u.Matrix4),C.initCAD2Doc(h.DToSMat)):C.intiDoc2Wold(h.DToSMat):C.intiDoc2Wold(new u.Matrix4):C.intiDoc2Wold(h.DToWMat),C.initializingObjectMatrix(),C.updateCameraDisplayRange(new u.Vector3(+h.pt1[0],+h.pt1[1],+h.pt1[2]),new u.Vector3(+h.pt2[0],+h.pt2[1],+h.pt2[2]),+h.viewangle),C.initAllLayoutName(h.layout),C.updateDisplay(!0);var y=w.MxFun.getUiObj();y!=null&&(y.SetLayoutData(h.layout),y.UpDisplayLayout())}}catch{console.log("UpdateDisplayRange exception")}}},this.messageCall[o.kCallJsReturn]=function(a){if(a.length!=0){var h=JSON.parse(a);h.cmd.length==0&&(h.cmd="__mx_loadcode");var y=h.cmd+h.count,j=M.serverJsRetCall.get(y);j&&(M.serverJsRetCall.delete(y),typeof h.ret=="string"&&(h.ret=h.ret.replace(/\'/g,'"')),j(h.ret))}else console.log("assert(0),kCallJsReturn return empty")},this.messageCall[o.kSendDebugString]=function(a){U.MxManager.outDebugString(a)},this.messageCall[o.kUserLoginResult]=function(a){C.userLoginResult(a)},this.messageCall[o.kOpenFileResult]=function(a){C.openFileResult(a)},this.messageCall[o.kServerReturn]=function(a){C.serverReturn(a)},this.messageCall[o.kShowLoading]=function(a){M.net.isTzDwgStaticFile()||w.MxFun.showLoading()},this.messageCall[o.kHideLoading]=function(a){M.net.isTzDwgStaticFile()||(w.MxFun.hideLoading(),C.callInitCompleteEvent())},this.messageCall[o.kSelectObject]=function(a){var h=JSON.parse(a);U.MxManager.callSelectObject(parseInt(h.id))},this.messageCall[o.kGlRenderHead]=function(a){C.isStaticLocalLoad()?C.getStaticLocalNet().onRenderHead(a):(M.net.isTzDwgStaticFile()?C.getStaticLoadTzNet():C.getStaticNet()).onRenderHead(a)},this.messageCall[o.kMxCADSystemVariable]=function(a,h){C.sysVariable().OnMessageMxCADSystemVariable(a)},this.messageCall[o.kLayerData]=function(a,h){if(h==0){if(C.addLayerInfoComplete(),(q=JSON.parse(a))!=null){if(!q.isSketch){var y=q.list;for(var j in y)C.addLayerInfo(y[j].id,y[j].colorvalue,y[j].name),y[j].zerolayer==1&&C.setZeroLayerId(y[j].id)}q.isSketch||C.callEvent("uiSetLayerData",q.list);var Y=w.MxFun.getUiObj();Y!=null&&(q.isSketch?Y.SetSketchLayerData(q.list):Y.SetLayerData(q.list),Y.UpDisplayLayer())}}else{var q,V=C.getExtRefManager().getLayers(h);if(V.initComplete(),(q=JSON.parse(a))!=null)for(var j in y=q.list)V.add(y[j].id,y[j].colorvalue,y[j].name),y[j].zerolayer==1&&V.setZeroLayerId(y[j].id)}}}s.MxNetMessage=P;var B,G,R=(_.prototype.setWebSocket=function(C){this._webSocket=C},_.prototype.UndoMark=function(){this._webSocket!=null&&this._webSocket.send(this.SendType.kUndoMark+"")},_.prototype.DoCommand=function(C,F,M){this._webSocket!=null&&(M!=null?(this._callCount++,200<this._callCount&&(this._callCount=1),this._msg.setJsRetCall(M,C,this._callCount),F==null&&(F=""),this._webSocket.send(this.SendType.kCmdEx+","+C+","+this._callCount+","+F)):F==null?this._webSocket.send(this.SendType.kCmd+","+C):this._webSocket.send(this.SendType.kCmd+","+C+","+F))},_.prototype.OpenFile=function(C){this._webSocket!=null&&this._webSocket.send(this.SendType.kOpenFile+","+C)},_.prototype.UserLogin=function(C,F,M){if(this._webSocket!=null){var a={};a.IdentitySign=C,a.RandomToken=F??"",a.Init=M??"",this._webSocket.send(this.SendType.kUserLogin+","+JSON.stringify(a))}},_.prototype.Init=function(C){this._webSocket!=null&&this._webSocket.send(this.SendType.kInit+","+C)},_.prototype.CallServerJS=function(C,F,M){this._webSocket!=null&&(M==null?F==null||F==null||F.length==0?this._webSocket.send(this.SendType.kCallJS+',{"command":"'+C+'","param":"{}"}'):this._webSocket.send(this.SendType.kCallJS+',{"command":"'+C+'","param":'+F+"}"):(this._callCount++,200<this._callCount&&(this._callCount=1),this._msg.setJsRetCall(M,C,this._callCount),F==null||F==null||F.length==0?this._webSocket.send(this.SendType.kCallJS+',{"command":"'+C+'","param":"{}","count":"'+this._callCount+'"}'):this._webSocket.send(this.SendType.kCallJS+',{"command":"'+C+'","param":'+F+',"count":"'+this._callCount+'"}')))},_.prototype.CallLoadCodeToServer=function(C,F){this._webSocket!=null&&(this._msg.setJsRetCall(F,"__mx_loadcode",0),C!=null&&C!=null&&C.length!=0&&this._webSocket.send(this.SendType.kCallJS+","+C))},_.prototype.DeleteObject=function(C){this._webSocket!=null&&this._webSocket.send(this.SendType.kDelete+","+C)},_.prototype.SelectObject=function(C){this._webSocket!=null&&this._webSocket.send(this.SendType.kSelect+","+C)},_.prototype.QuitSelectObject=function(C){this._webSocket!=null&&this._webSocket.send(this.SendType.kQuitSelect+","+C)},_.prototype.SendDragDrawEntity=function(C){this._webSocket!=null&&this._webSocket.send(this.SendType.kAddDragDraw+","+C)},_.prototype.SendDragDrawRequest=function(){this._webSocket!=null&&(this.SendMousePickRay(),this._webSocket.send(this.SendType.kRequestDragDraw))},_.prototype.SendDragDrawDetermine=function(){this._webSocket!=null&&(this.SendMousePickRay(),this._webSocket.send(this.SendType.kDetermineDragDraw))},_.prototype.SendDragDrawCancel=function(){this._webSocket!=null&&this._webSocket.send(this.SendType.kCancelDragDraw)},_.prototype.SendMousePickRay=function(){this._webSocket},_);function _(C,F){this.SendType={},this._callCount=1,this._webSocket=C,this._msg=F,this.SendType.kCmd=0,this.SendType.kDelete=1,this.SendType.kSelect=2,this.SendType.kOpenFile=3,this.SendType.kGetDemoList=4,this.SendType.kCallJS=5,this.SendType.kAddDragDraw=6,this.SendType.kRequestDragDraw=7,this.SendType.kMousePickRay=8,this.SendType.kDetermineDragDraw=9,this.SendType.kCancelDragDraw=10,this.SendType.kQuitSelect=11,this.SendType.kInit=12,this.SendType.kCmdEx=13,this.SendType.kUserLogin=14,this.SendType.kUndoMark=15}s.MxNetSend=R,(G=B||(s.MxNetBinMessageType=B={})).eBlockRef=10,G.eEntitysData=14,G.eAddEntityFor2dPointTextureBuffers=15,G.eMxNewMemorySections=16,G.kMxCADBlockRef=56,G.kMxCADMemorySections=57,G.kMxCADMemorySectionsFromChange=59,G.kMxCADNotUseMemorySectionsForChage=61,G.kMxCADEntityDisplayDatas=62;var ee=(k.prototype.setCurrentDatabaseId=function(C){this._iCurrentDatabaseId=C},k.prototype.getMxDrawObject=function(){return this._mx},k.prototype.getCurrentDatabaseId=function(){return this._iCurrentDatabaseId},k.prototype.isTzDwgStaticFile=function(){return this._iCurrentDatabaseId!=-1},k.prototype.onBinMessage=function(C){var F=this._mx,M=L.inflate(C),a=new DataView(M.buffer),h=a.getInt32(0,!0);this._binMessageCall.has(h)?this._binMessageCall.get(h)(a,this._iCurrentDatabaseId):(this._iCurrentDatabaseId==-1&&(h==0?F.mxWebAddEntity(a):h==6?F.removeEntityFromServer(a):h==11&&F.getExtRefManager().createExternalReferences(a)),h==12?F.mxWebAddEntityFor2dPointCurveBuffers(a,this._iCurrentDatabaseId):h==13?F.mxWebAddEntityFor2dPointMeshBuffers(a,this._iCurrentDatabaseId):h==8?F.mxWebAddEntityFor2dPointCurveBuffer(a,this._iCurrentDatabaseId):h==9?F.mxWebAddEntityFor2dPointMeshBuffer(a,this._iCurrentDatabaseId):h==B.eBlockRef&&F.mxWebCreateAllBlocks(a,this._iCurrentDatabaseId))},k.prototype.socket_onErrort=function(){this._msg.onSocketErrort()},k.prototype.socket_onMessageImp=function(C,F){if(F===void 0&&(F=!1),typeof C=="string")this._msg.Do(C);else if(F)this.onBinMessage(C);else{var M=new FileReader;M.readAsArrayBuffer(C);var a=this;M.onload=function(h){a._mx.updateDisplay(),a.onBinMessage(M.result)}}this._mx.updateDisplay()},k.prototype.initBinMessage=function(){var C=this._mx;this._binMessageCall.set(B.eEntitysData,function(F,M){C.mxWebEntitysData(F,M)}),this._binMessageCall.set(B.eAddEntityFor2dPointTextureBuffers,function(F,M){C.mxWebAddEntityFor2dPointTextureBuffers(F,M)}),this._binMessageCall.set(B.eMxNewMemorySections,function(F,M){C.mxWebAddEntityForMemorySections(F,M)})},k.prototype.init=function(C,F){var M=this;this._mx=C,this._msg=new P(C,this),this.initBinMessage(),F&&(this._webSocket=new WebSocket(w.MxFun.getMxServer()),this._webSocket.onopen=function(){var a=M._mx.getIniParam();if(a.length!=0){for(var h="{",y=a.length,j=0;j<y;j++)h=j==0?h+'"'+a[j][0]+'":"'+a[j][1]+'"':h+',"'+a[j][0]+'":"'+a[j][1]+'"';h+="}",M._send.Init(h)}},this._webSocket.onmessage=function(a){M.socket_onMessageImp(a.data)},this._webSocket.onerror=function(){console.log("mx: socket error"),M.socket_onErrort()}),this._send=new R(this._webSocket,this._msg)},k.prototype.closeWebSocket=function(){this._webSocket&&(this._send.setWebSocket(null),this._webSocket.close(),this._webSocket=null)},k.prototype.getOnMessage=function(){return this._msg},k.prototype.getSend=function(){return this._send},k.prototype.onStaticMessage=function(C){try{return this.socket_onMessageImp(C,!0),!0}catch(F){return console.log("mx file data error!"),console.log(F),!1}},k.prototype.onStaticHeadMessage=function(C){return typeof C=="string"&&this._msg.Do(C)},k);function k(){this._webSocket=null,this._send=null,this._msg=null,this._mx=null,this._binMessageCall=new Map,this._iCurrentDatabaseId=-1}s.MxNet=ee;var E=(W.prototype.stopAllLoading=function(){this._isStopLoading||(this._isStopLoading=!0,this._isShowLoading&&w.MxFun.hideLoading())},W.prototype.setShowloading=function(C){this._isShowLoading=C},W.prototype.showLoading=function(){this._isShowLoading&&w.MxFun.showLoading()},W.prototype.hideLoading=function(C){this._isStopLoading||(this._isShowLoading&&w.MxFun.hideLoading(),this.net.getMxDrawObject().callInitCompleteEvent(),this.net.getMxDrawObject().callOpenFileComplete(C))},W.prototype.setRequestHeader=function(C){this._requestHeader=C},W.prototype.setUrlParam=function(C){this._urlParam=C},W.prototype.load=function(C,F){var M=w.MxFun.curPath(),a=w.MxFun.dwgDir(),h=w.MxFun.getStaticServer(),y="/buf/";if(C.substring(C.lastIndexOf(".")+1).toLowerCase()=="wgh"){y="/";var j=C.substring(0,C.indexOf(".mxb1.wgh")).split("/");(C=j.length==1?j[0]:(h=C.substring(0,C.lastIndexOf("/")),j[j.length-1]))[0]=="$"&&(C=C.substring(1))}var Y="$"+(C=encodeURIComponent(C))+".mxb1.wgh";h.length!=0?M=h+y:a.length!=0?M=M+"/"+a+y:M+=y,this._path=M,this._filename=C,1<(this._staticLoadingOpenFiles=F).length&&(Y=F[0],this._path=void 0);var q=this;this.getFile(this._path,Y,function(V){if(!q._isStopLoading)return typeof V!="string"?(console.log("mx error h1"),void q.hideLoading(4)):q.net.onStaticHeadMessage(V)?void 0:(console.log("mx error h1:"+V),void q.hideLoading(2))},function(){q.hideLoading(3),console.log("mx get "+Y+" faild")})},W.prototype.getData=function(){if(this._isStopLoading)this.hideLoading(5);else if(this._iGet>=this._dataNum)this.hideLoading(0);else{var C=this._dataType[this._iGet];this._iGet++;var F=this,M=this._iGet+1,a="$"+this._filename+".mxb"+M+".wgh";if(1<this._staticLoadingOpenFiles.length){if(this._iGet>=this._staticLoadingOpenFiles.length)return console.log("Mx staticLoadingOpenFiles error!"),void this.hideLoading(7);a=this._staticLoadingOpenFiles[this._iGet]}var h=a;this._path&&(h=this._path+a);var y=h.substring(0,h.lastIndexOf("/")+1);if(this.net.getMxDrawObject().setCurrentLoadUrl(y),C==0)this.getFile(this._path,a,function(q){F._isStopLoading||(F.net.onStaticMessage(q)||(console.log(this._path),console.log(a)),F.getData())},function(){F._dataNum=0,F._iGet=0,F.hideLoading(8),console.log("mx get "+a+" faild")});else{var j=new XMLHttpRequest,Y=a;this._path&&(Y=this._path+a),this._urlParam.length!=0?j.open("GET",Y+this._urlParam):j.open("GET",Y),N.MxDrawData.m_isRequestHeaderCacheControl&&j.setRequestHeader("Cache-Control","max-age=7200"),this._requestHeader.length!=0&&j.setRequestHeader("usertoken",this._requestHeader),j.responseType="arraybuffer",j.onload=function(){F._isStopLoading||(F.net.onStaticMessage(j.response)||console.log(Y),F.getData())},j.addEventListener("error",function(q){F._dataNum=0,F._iGet=0,F.hideLoading(9),console.log("mx get "+a+" faild")},!1),j.send()}}},W.prototype.onRenderHead=function(C){if(!this._isStopLoading){var F=JSON.parse(C);this._dataType=F.type,this._dataNum=F.count,this._iGet=0,this.showLoading(),this.getData()}},W.prototype.getFile=function(C,F,M,a){var h=new u.FileLoader(this.manager);h.setPath(C);var y=F;this._urlParam.length!=0&&(y=F+this._urlParam),this._requestHeader.length!=0&&(h.requestHeader={usertoken:this._requestHeader}),h.load(y,M,function(){},a)},W);function W(C,F){this.net=null,this.manager=null,this._dataNum=0,this._iGet=0,this._dataType=[],this._path="",this._filename="",this._staticLoadingOpenFiles=[],this._isShowLoading=!0,this._requestHeader="",this._isStopLoading=!1,this._urlParam="",this.net=C,this.manager=F!==void 0?F:u.DefaultLoadingManager}s.MxHFileLoad=E},{"./MxDrawData":22,"./MxFun":27,"./MxManager":29,pako:1,three:19}],32:[function(b,r,s){var o,v;Object.defineProperty(s,"__esModule",{value:!0}),s.MxShader=void 0,(v=o||(s.MxShader=o={})).VSHADER_COLOR_POINT=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
attribute vec2 position; 
attribute vec3 color; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,v.VSHADER_COLOR_POINT_BYLAYER=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec3 color; 
attribute vec2 position; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,v.FSHADER_COLOR_POINT=` precision highp float; 
varying vec4 vColor; 
void main() { 
gl_FragColor = vColor; 
} 
`,v.VSHADER_COLOR_POINT_TEXTURE=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
attribute vec2 position; 
attribute vec2 uv; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
varying vec2 vUv; 
void main(){ 
vUv = uv; 
mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,v.FSHADER_COLOR_POINT_TEXTURE=` precision highp float; 
varying vec2 vUv; 
uniform sampler2D texture; 
void main() { 
gl_FragColor = texture2D( texture, vUv ); 
} 
`,v.VSHADER_COLOR_POINT_CLIP=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec2 clippt1; 
uniform vec2 clippt2; 
uniform float vieww; 
uniform float viewh; 
attribute vec2 position; 
attribute vec3 color; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
vec4 pt1 = projectionMatrix * modelViewMatrix * vec4( clippt1.x,clippt1.y,0.0, 1.0 ); 
vec4 pt2 = projectionMatrix * modelViewMatrix * vec4( clippt2.x,clippt2.y,0.0, 1.0 ); 
vCp1 = vec2(pt1.x * vieww + vieww,pt1.y * viewh + viewh); 
vCp2 = vec2(pt2.x * vieww + vieww,pt2.y * viewh + viewh); 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,v.VSHADER_COLOR_POINT_BYLAYER_CLIP=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec3 color; 
uniform vec2 clippt1; 
uniform vec2 clippt2; 
uniform float vieww; 
uniform float viewh; 
attribute vec2 position; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
vec4 pt1 = projectionMatrix * modelViewMatrix * vec4( clippt1.x,clippt1.y,0.0, 1.0 ); 
vec4 pt2 = projectionMatrix * modelViewMatrix * vec4( clippt2.x,clippt2.y,0.0, 1.0 ); 
vCp1 = vec2(pt1.x * vieww + vieww,pt1.y * viewh + viewh); 
vCp2 = vec2(pt2.x * vieww + vieww,pt2.y * viewh + viewh); 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,v.FSHADER_COLOR_POINT_CLIP=`precision highp float; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main() { 
if(gl_FragCoord.x > vCp1.x && gl_FragCoord.x < vCp2.x && gl_FragCoord.y > vCp1.y && gl_FragCoord.y < vCp2.y) 
gl_FragColor = vColor; 
else 
discard; 
} 
`,v.VSHADER_COLOR_POINT_FORMXCAD=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec3 color; 
attribute vec2 position; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
gl_PointSize = 1.0;
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,v.FSHADER_COLOR_POINT_FORMXCAD=` precision highp float; 
varying vec4 vColor; 
void main() { 
gl_FragColor = vColor; 
} 
`,v.VSHADER_COLOR_POINT_CLIP_FORMXCAD=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec3 color; 
uniform vec2 clippt1; 
uniform vec2 clippt2; 
uniform float vieww; 
uniform float viewh; 
attribute vec2 position; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
vec4 pt1 = projectionMatrix * modelViewMatrix * vec4( clippt1.x,clippt1.y,0.0, 1.0 ); 
vec4 pt2 = projectionMatrix * modelViewMatrix * vec4( clippt2.x,clippt2.y,0.0, 1.0 ); 
vCp1 = vec2(pt1.x * vieww + vieww,pt1.y * viewh + viewh); 
vCp2 = vec2(pt2.x * vieww + vieww,pt2.y * viewh + viewh); 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,v.FSHADER_COLOR_POINT_CLIP_FORMXCAD=`precision highp float; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main() { 
if(gl_FragCoord.x > vCp1.x && gl_FragCoord.x < vCp2.x && gl_FragCoord.y > vCp1.y && gl_FragCoord.y < vCp2.y) 
gl_FragColor = vColor; 
else 
discard; 
} 
`},{}],33:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxStencilObject=void 0;var o=b("three"),v=b("./MxMaterial"),u=(w.prototype.object_onAfterRender=function(L){var U=this.aryMeshStencil;if(U&&0<U.length){L.getContext();var N=L.state.buffers;N.stencil.setLocked(!1),N.depth.setTest(!0),N.stencil.setTest(!1)}},w.prototype.object_onBeforeRender=function(L,U,N){var D=this.aryMeshStencil;if(D&&0<D.length){var f=L.getContext(),P=L.state.buffers;P.color.setMask(!1),P.color.setLocked(!0),P.depth.setTest(!1),P.stencil.setTest(!0),P.stencil.setMask(255),P.stencil.setClear(0),L.clearStencil(),P.stencil.setLocked(!0);var T=1,B=!0;D.forEach(function(G){B?(B=!1,P.stencil.setFunc(f.ALWAYS,T,255),P.stencil.setOp(f.KEEP,f.KEEP,f.REPLACE)):(P.stencil.setFunc(f.EQUAL,T,255),P.stencil.setOp(f.KEEP,f.KEEP,f.INCR),T++),L.mxRenderObject(G,U,N,G.material,null)}),P.color.setLocked(!1),P.color.setMask(!0),P.stencil.setMask(0),P.stencil.setFunc(f.EQUAL,T,255)}},w.prototype.associateObject=function(L,U){var N=this;U.forEach(function(f){if(3<=f.length){var P=new o.Shape(f),T=new o.ShapeGeometry(P),B=new o.Mesh(T,v.MxMaterial.getStencilMaterial());N.aryMeshStencil.push(B)}});var D=this;L.onBeforeRender=function(f,P,T){D.object_onBeforeRender(f,P,T)},L.onAfterRender=function(f){D.object_onAfterRender(f)}},w);function w(){this.aryMeshStencil=[]}s.MxStencilObject=u},{"./MxMaterial":30,three:19}],34:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxString=void 0;var o=(v.prototype.Find=function(u){return this.m_val.indexOf(u)},v.prototype.Left=function(u){return this.m_val.substring(0,u)},v.prototype.Right=function(u){return this.m_val.substring(this.m_val.length-u,this.m_val.length)},v.prototype.TrimLeft=function(u){for(;0<this.m_val.length&&this.m_val[0]==u;)this.m_val=this.m_val.slice(1)},v.prototype.TrimRight=function(u){for(;0<this.m_val.length&&this.m_val[this.m_val.length-1]==u;)this.m_val=this.m_val.slice(0,-1)},v.prototype.AnalyzeString=function(u){return this.m_val.split(u)},v.prototype.IsEmpty=function(){return this.m_val.length==0},v.prototype.MakeUpper=function(){this.m_val=this.m_val.toUpperCase()},v.prototype.MakeLower=function(){this.m_val=this.m_val.toLowerCase()},v.prototype.GetLength=function(){return this.m_val.length},v);function v(u){this.m_val="",u!=null&&(this.m_val=u)}s.MxString=o},{}],35:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxSystemVariable=void 0;var o=b("three"),v=b("./Operate/McEdJigOsnap"),u=(w.prototype.init=function(L){this.m_mxObj=L},w.prototype.getAllLinetypeName=function(){return this.m_vecLinetype},w.prototype.getSysVarBool=function(L){return this.m_data[L]!=null&&this.m_data[L]},w.prototype.setSysVarBool=function(L,U){this.m_data[L]=U},w.prototype.setSysVarPoint=function(L,U){this.m_data[L]=U},w.prototype.OnMessageMxCADSystemVariable=function(L){this.m_vecLinetype=[];var U=JSON.parse(L);if(U!=null){var N=U.vecLinetypeName;for(var D in N)this.m_vecLinetype.push(N[D]);this.m_data.CELTYPE=U.curLinetypeName,this.m_data.CLAYER=U.clayer,this.m_data.CECOLOR=U.cecolor,this.m_data.CECOLORINDEX=U.cecolorindex}this.m_mxObj.callEvent("loadSystmeVariableComplete")},w.prototype.getSysVarPoint=function(L){return this.m_data[L]==null?new o.Vector3(0,0,0):this.m_data[L]},w.prototype.setSysVarNumber=function(L,U){this.m_data[L]=U},w.prototype.getSysVarNumber=function(L){return this.m_data[L]==null?0:this.m_data[L]},w.prototype.getSysVar=function(L){return this.m_data[L]},w.prototype.setSysVar=function(L,U){this.m_data[L]=U},w);function w(){this.m_data={},this.m_mxObj=null,this.m_vecLinetype=[],this.m_data.GETPOINTSTATUS=0,this.m_data.LASTPOINT=void 0,this.m_data.LASTMOVEPOINT=void 0,this.m_data.CELTYPE="Continuous",this.m_data.CLAYER="0",this.m_data.CECOLOR=67108863,this.m_data.CECOLORINDEX=7,this.m_data.OSMODE=v.MxOsnapDefine.OsModeAll}s.MxSystemVariable=u},{"./Operate/McEdJigOsnap":42,three:19}],36:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxThreeJS=void 0;var o,v,u=b("three"),w=b("./MxFun");function L(U){return Math.pow(2,Math.floor(Math.log(U)/Math.LN2))}(v=o||(s.MxThreeJS=o={})).createLine=function(U,N,D,f){var P,T=new u.Geometry;return P=f&&f!=1||f==0?new u.LineBasicMaterial({color:D,transparent:!0,depthTest:!1,opacity:f}):new u.LineBasicMaterial({color:D,transparent:!0,depthTest:!1}),T.vertices.push(U,N),new u.Line(T,P)},v.createSolid=function(U,N,D){if(U.length<3)return null;var f,P=new u.Shape(U.map(function(B){var G=B.x,R=B.y;return new u.Vector2(G,R)})),T=new u.ShapeGeometry(P);return f=D&&D!=1||D==0?new u.MeshPhongMaterial({color:N,side:u.DoubleSide,transparent:!0,depthTest:!1,opacity:D}):new u.MeshPhongMaterial({color:N,side:u.DoubleSide,transparent:!0,depthTest:!1}),new u.Mesh(T,f)},v.createPoint=function(U,N,D){D===void 0&&(D=3);var f=new u.Geometry;f.vertices.push(U);var P=new u.PointsMaterial({color:N,size:D});return new u.Points(f,P)},v.createDashedLine=function(U,N,D,f,P){var T=new u.Geometry;T.vertices.push(U,N);var B=new u.Line(T,new u.LineDashedMaterial({color:D,dashSize:f,gapSize:P,transparent:!0,depthTest:!1}));return B.computeLineDistances(),B},v.createCircle=function(U,N,D){var f=new u.CircleGeometry(N,64,3,2*Math.PI),P=new u.LineBasicMaterial({color:D,transparent:!0,depthTest:!1});f.vertices.shift();var T=new u.LineLoop(f,P);return T.position.x=U.x,T.position.y=U.y,T.position.z=U.z,T},v.createSolidCircle=function(U,N,D){var f=new u.MeshBasicMaterial({color:D,transparent:!0,depthTest:!1}),P=new u.CircleGeometry(N,64,3,2*Math.PI),T=new u.Mesh(P,f);return T.position.x=U.x,T.position.y=U.y,T.position.z=U.z,T},v.clacTextSize=function(U,N){var D=document.createElement("canvas").getContext("2d");if(D==null)return N;var f=w.MxFun.formatString("normal {0}px Arial","256");return D.font=f,D.measureText(U).width*N/256},v.clacTextSpriteSize=function(U,N,D){N<=1e-8&&(N=1);var f=document.createElement("canvas"),P=f.getContext("2d"),T=w.MxFun.formatString("normal {0}px Arial","256");P.font=T;var B=N/256,G=0,R=[],_=!0,ee=0;if(D){G=D;for(var k=0,E=0,W=0;E<U.length;E++)(C=P.measureText(U.substring(k,E+1))).width*B>G&&(ee+=(C.fontBoundingBoxAscent+C.fontBoundingBoxDescent)*B,R.push(U.substring(k,E)),k=E,W++);if(k<E){var C=P.measureText(U.substring(k,E));R.push(U.substring(k,E)),ee+=(C.fontBoundingBoxAscent+C.fontBoundingBoxDescent)*B,W++}_=W<=1}else ee=N,G=(C=P.measureText(U)).width*B,R.push(U),_=!1;var F=ee/G*(f.width=1024);return f.height=L(F),f.height<F&&(f.height*=2),f.height==0&&(f.height=512),{spritewidth:G,spriteheight:G*f.height/f.width,textwidth:G,allTextHeight:ee,singleline:_}},v.creatTextSprite=function(U,N,D,f,P,T,B){D<=1e-8&&(D=1);var G=document.createElement("canvas"),R=G.getContext("2d");B?(R.font=B(256),R.font.length==0&&(R.font=w.MxFun.formatString("normal {0}px Arial","256"))):R.font=w.MxFun.formatString("normal {0}px Arial","256");var _=D/256,ee=0,k=[],E=[],W=0;if(T){ee=T;for(var C=0,F=0;F<U.length;F++)(a=R.measureText(U.substring(C,F+1))).width*_>ee&&(W+=M=(a.fontBoundingBoxAscent+a.fontBoundingBoxDescent)*_,k.push(U.substring(C,F)),E.push(M),C=F);if(C<F){var M,a=R.measureText(U.substring(C,F));k.push(U.substring(C,F)),W+=M=(a.fontBoundingBoxAscent+a.fontBoundingBoxDescent)*_,E.push(M)}}else W=D,ee=(a=R.measureText(U)).width*_,k.push(U),E.push(W);var h=W/ee*(G.width=1024);G.height=L(h),G.height<h&&(G.height*=2),G.height==0&&(G.height=512);var y=1024/ee,j=y*D;B?(R.font=B(j),R.font.length==0&&(R.font=w.MxFun.formatString("normal {0}px Arial",""+j))):R.font=w.MxFun.formatString("normal {0}px Arial",""+j);var Y=w.MxFun.formatString("rgba({0}, {1}, {2}, 1.0)",(P>>16&255)+"",(P>>8&255)+"",(255&P)+"");R.fillStyle=Y,R.textAlign="left",R.textBaseline="bottom";for(var q=0,V=0;q<k.length;q++)V+=y*E[q];for(q=0,V=.5*(G.height-V);q<k.length;q++)V+=y*E[q],R.fillText(k[q],0,V);var ne=new u.Texture(G);ne.needsUpdate=!0;var ie=new u.SpriteMaterial({transparent:!0,depthTest:!1,map:ne});ie.rotation=f;var he=new u.Sprite(ie);return he.scale.set(ee,ee/G.width*G.height,1),he.position.set(N.x,N.y,N.z),he},v.createTriangle=function(U,N,D){if(!(U.length<3)){for(var f=U.length,P=new u.Geometry,T=0;T+2<f;T+=3){P.vertices.push(U[T]),P.vertices.push(U[T+1]),P.vertices.push(U[T+2]);var B=new u.Face3(T,T+1,T+2);P.faces.push(B)}P.computeFaceNormals(),P.computeVertexNormals(),D==null&&(D=1);var G=new u.MeshBasicMaterial({color:N,transparent:!0,depthTest:!1,side:u.DoubleSide,opacity:D});return new u.Mesh(P,G)}},v.createLines=function(U,N,D){var f,P=new u.Geometry;return P.vertices=U,f=D&&D!=1||D==0?new u.LineBasicMaterial({color:N,transparent:!0,depthTest:!1,opacity:D}):new u.LineBasicMaterial({color:N,transparent:!0,depthTest:!1}),new u.Line(P,f)},v.createDashedArc=function(U,N,D,f,P,T,B){var G=new u.CircleGeometry(N,64,D,f),R=new u.LineDashedMaterial({color:P,dashSize:T,gapSize:B,transparent:!0,depthTest:!1});G.vertices.shift();var _=new u.Line(G,R);return _.position.x=U.x,_.position.y=U.y,_.position.z=U.z,_},v.createDashedLines=function(U,N,D,f){var P=new u.Geometry;return P.vertices=U,new u.Line(P,new u.LineDashedMaterial({color:N,dashSize:D,gapSize:f,transparent:!0,depthTest:!1}))}},{"./MxFun":27,three:19}],37:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxPair=s.MxTools=void 0;var o,v,u=b("three");(v=o||(s.MxTools=o={})).AsMxWebPoint=function(w,L,U){return new u.Vector3(-w,U,L)},v.AsMxWebPoint_pt=function(w){return new u.Vector3(-w.x,w.z,w.y)},v.AsThreeJsPoint=function(w,L,U){return new u.Vector3(-w,U,L)},v.stringTrimLeftSpace=function(w){return w.replace(/^\s*/g,"")},v.stringDeleteAllSpace=function(w){return w.replace(/\s*/g,"")},v.stringTrimLeftRightSpace=function(w){return w.replace(/^\s*|\s*$/g,"")},v.stringTrimRightSpace=function(w){return w.replace(/(\s*$)/g,"")},v.IsNumerical=function(w){if(typeof w=="string"){var L=/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/;return!(!/^\d+(\.\d+)?$/.test(w)&&!L.test(w))}var U=w.m_val;return L=/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/,!(!/^\d+(\.\d+)?$/.test(U)&&!L.test(U))},v.formatString=function(w){for(var L=[],U=1;U<arguments.length;U++)L[U-1]=arguments[U];for(var N=0;N<L.length;N++)w=w.replace("{".concat(N,"}"),L[N]);return w},v._tstof=function(w){return parseFloat(w)},v._tstoi=function(w){return parseInt(w)},v.IsZero=function(w){return-1e-7<w&&w<1e-7},v.MillimeterToPixels=function(w){return 10*w},v.getXYPlanDistance=function(w,L){var U=new u.Vector2(w.x,w.y),N=new u.Vector2(L.x,L.y);return U.distanceTo(N)},v.MxASSERT=function(w,L){w||console.log("MxASSERT(0):"+L)},v.generateUUID=function(){return u.MathUtils.generateUUID()},v.MxMax=function(w,L){return L<w?w:L},v.getOpacity=function(w){var L=(4278190080&w)>>24&255;return L<=0&&(L=255),L/255},v.getColor=function(w){return 16777215&w},s.MxPair=function(w,L){this.first=w,this.second=L}},{three:19}],38:[function(b,r,s){var o,v,u,w;Object.defineProperty(s,"__esModule",{value:!0}),s.MxType=void 0,(u=(v=o||(s.MxType=o={})).MxCommandFlag||(v.MxCommandFlag={}))[u.MCRX_CMD_MODAL=0]="MCRX_CMD_MODAL",u[u.MCRX_CMD_TRANSPARENT=1]="MCRX_CMD_TRANSPARENT",u[u.MCRX_CMD_NO_UNDO_MARKER=2]="MCRX_CMD_NO_UNDO_MARKER",u[u.MCRX_CMD_NOPRV=4]="MCRX_CMD_NOPRV",u[u.MCRX_CMD_NO_RECORD_PRVCMD=8]="MCRX_CMD_NO_RECORD_PRVCMD",u[u.MCRX_CMD_NO_CLEAR_SELECT=16]="MCRX_CMD_NO_CLEAR_SELECT",(w=v.MxCloneType||(v.MxCloneType={}))[w.kClone=1]="kClone",w[w.kDragClone=2]="kDragClone",w[w.kMxFileClone=3]="kMxFileClone",w[w.kSaveDwgClone=4]="kSaveDwgClone"},{}],39:[function(b,r,s){var o;Object.defineProperty(s,"__esModule",{value:!0}),s.MxBulid=void 0,window.MxDrawVersion="1.0(2024-06-09 11:58)",(o||(s.MxBulid=o={})).getVersion=function(){return window.MxDrawVersion?window.MxDrawVersion:"inalid version"}},{}],40:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxWindowsEvent=void 0;var o,v,u,w,L=b("./MxFun"),U=b("./Operate/MxJigCmdManager"),N=b("./MxDrawData"),D=b("./UI/MxUiVue");function f(_,ee){for(var k=0,E=w.length;k<E;k++){var W=w[k](_,ee);if(W!=0)return W}}function P(_){f("mousemove",_)}function T(_){f("mouseup",_)}function B(_){f("dblclick",_)}function G(_){f("mousedown",_)}function R(_){var ee=_||window.event||arguments.callee.caller.arguments[0];if(ee&&ee.keyCode==27){var k=L.MxFun.getCurrentMx();if(k.isPaningCommand())return void k.endPanCommand();if(U.MxJigCmdManager.isRunning()){if(U.MxJigCmdManager.getCurCmd().getDynImput().onKeyEcsDown()!=0)return;U.MxJigCmdManager.stopCmd(U.MxJigCmdManager.DetailedResult.kEcsIn)}else{var E=!1;if(N.MxDrawData.m_isEnableIntelliSelect){var W=!1;k.getMxDatabase().getGripManager().removeAllGrips()&&(W=!0),k.getMxDatabase().getSelectManager().removeAllEntity()&&(W=!0),k.isValidMcObject()&&k.getMcObject().getGripManager().clearAll()&&(W=!0),W&&(k.updateDisplay(),k.getMxDatabase().getGripManager().fireMxEntitySelectChange(),E=!0)}E||D.MxUiVue.acutPrintf(` **
:`)}}}v=o||(s.MxWindowsEvent=o={}),u=!1,w=new Array,v.addEvent=function(_){w.push(_)},v.registEvent=function(){u||(u=!0,L.MxFun.isPC()&&(document.addEventListener("mousemove",P,!1),document.addEventListener("mouseup",T,!1),document.addEventListener("mousedown",G,!1),document.addEventListener("dblclick",B,!1),document.onkeydown=R))}},{"./MxDrawData":22,"./MxFun":27,"./Operate/MxJigCmdManager":53,"./UI/MxUiVue":64}],41:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.McEdJigDynamicTrace=void 0;var o=b("three"),v=b("./MxJigCmdManager"),u=b("../MxFun"),w=b("../MxDrawData"),L=b("../MxTools"),U=b("../MxManager"),N=b("../MxThreeJS"),D=b("./McEdJigOsnap"),f=(P.prototype.IsEqual=function(_){return this.m_snapObjectId==_.m_snapObjectId&&this.m_pt.distanceTo(_.m_pt)<1e-6},P.prototype.drawLine=function(_,ee,k){var E=N.MxThreeJS.createLine(new o.Vector3(_.x,_.y,_.z),new o.Vector3(ee.x,ee.y,ee.z),this.m_iColor);k.add(E),this.m_aryDynDrawObject.push(E)},P.prototype.clearDraw=function(_){for(var ee=this.m_aryDynDrawObject.length,k=0;k<ee;k++)u.MxFun.removeThreejsObject(this.m_aryDynDrawObject[k],_);this.m_aryDynDrawObject=[]},P.prototype.draw=function(_,ee){var k=_.toSmallcoord(this.m_pt),E=new o.Vector3(k.x,k.y+this.m_iGripWidth,0),W=new o.Vector3(k.x,k.y-this.m_iGripWidth,0);this.drawLine(E,W,ee);var C=new o.Vector3(k.x+this.m_iGripWidth,k.y,0),F=new o.Vector3(k.x-this.m_iGripWidth,k.y,0);this.drawLine(C,F,ee)},P);function P(){this.m_snapObjectId=0,this.m_pt=new o.Vector3,this.m_osmode=0,this.m_iColor=16760703,this.m_iGripWidth=10,this.m_aryDynDrawObject=new Array}var T=(B.prototype.clearDraw=function(_){for(var ee=this.m_aryDynDrawObject.length,k=0;k<ee;k++)u.MxFun.removeThreejsObject(this.m_aryDynDrawObject[k],_);this.m_aryDynDrawObject=[]},B.prototype.draw=function(_,ee){this.m_draw.setWidth(this.m_iGripWidth),this.m_draw.draw(_.toSmallcoord(this.m_pt),this.m_ostype,ee)},B);function B(_,ee){var k=this;this.m_aryDynDrawObject=new Array,this.m_iGripWidth=10,this.m_draw=new D.McEdJigOsnapDraw,this.m_pt=_,this.m_ostype=ee,this.m_draw.setAddDynDrawObject_call(function(E){k.m_aryDynDrawObject.push(E)})}var G=(R.prototype.DynamicTraceTimeCall=function(_){if(!this.m_mxJig.isExit()&&this.m_iTimeCallId==_&&this.m_isDynTrace&&this.m_snapObjectId!=0){var ee=new f;ee.m_osmode=this.m_osmode,ee.m_snapObjectId=this.m_snapObjectId,ee.m_pt=this.m_ptSnapPoint,ee.m_iGripWidth=.5*this.m_mxJig.getMxObject().screenCoordLong2Doc(w.MxDrawData.m_dInputRectWidth);for(var k=this.m_aryTraceObject.length,E=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),W=0;W<k;W++)if(this.m_aryTraceObject[W].IsEqual(ee))return this.m_aryTraceObject[W].clearDraw(E),void this.m_aryTraceObject.splice(W,1);this.m_aryTraceObject.push(ee),ee.draw(this.m_mxJig.getMxObject(),E),this.m_mxJig.getMxObject().updateDisplay()}},R.prototype.OnDynamicTrace=function(_,ee,k){if(this.m_isDynTrace)if(_==0)this.m_iTimeCallId++,this.m_snapObjectId=0;else{if(k==v.MxJigCmdManager.OsnapMode.kOsModeNear)return;var E=.5*this.m_mxJig.getMxObject().screenCoordLong2Doc(w.MxDrawData.m_dInputRectWidth);if(this.m_snapObjectId!=0&&this.m_ptSnapPoint.distanceTo(ee)<E)return;var W=this.m_iTimeCallId,C=this;setTimeout(function(){C.DynamicTraceTimeCall(W)},400),this.m_snapObjectId=_,this.m_ptSnapPoint=ee,this.m_osmode=k}},R.prototype.ClearOsmodeObjectDisplay=function(){for(var _=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),ee=this.m_aryTraceOsmodeObject.length,k=0;k<ee;k++)this.m_aryTraceOsmodeObject[k].clearDraw(_);this.m_aryTraceOsmodeObject=[]},R.prototype.ClearTraceObject=function(){for(var _=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),ee=this.m_aryTraceObject.length,k=0;k<ee;k++)this.m_aryTraceObject[k].clearDraw(_);this.m_aryTraceObject=[]},R.prototype.ClearDisplay=function(){this.ClearTraceObject(),this.ClearOsmodeObjectDisplay(),this.ClearDynDrawEntity()},R.prototype.GetTraceLine=function(_,ee,k,E){var W=ee.m_pt;if(W.distanceTo(_)<2*k)return[];var C={pt1:new o.Vector3(W.x-E,W.y),pt2:new o.Vector3(W.x+E,W.y)},F={pt1:new o.Vector3(W.x,W.y-E),pt2:new o.Vector3(W.x,W.y+E)},M=[];M.push(C),M.push(F);for(var a=U.MxManager.getMxCpp().getMcDbCurve(ee.m_snapObjectId);a;){var h=a.getFirstDeriv(U.MxManager.getMxCpp().newMcGePoint3d(W));if(h.ret!=0||h.val.isZeroLength())break;h.val.normalize(),h.val.mult(E);var y={pt1:new o.Vector3(W.x-h.val.x,W.y-h.val.y),pt2:new o.Vector3(W.x+h.val.x,W.y+h.val.y)};M.push(y),h.val.rotateBy(Math.PI/2);var j={pt1:new o.Vector3(W.x-h.val.x,W.y-h.val.y),pt2:new o.Vector3(W.x+h.val.x,W.y+h.val.y)};M.push(j);break}return M},R.prototype.ClearDynDrawEntity=function(){for(var _=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),ee=this.m_vecDynDrawEntity.length,k=0;k<ee;k++)u.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[k],_);this.m_vecDynDrawEntity=[]},R.prototype.DoMouseMove=function(_){if(this.ClearDynDrawEntity(),this.ClearOsmodeObjectDisplay(),this.m_isValidTracePoint=!1,!this.m_isDynTrace)return[];if(this.m_aryTraceObject.length==0)return[];for(var ee=[],k=this.m_mxJig.getMxObject(),E=k.viewCoordLong2Cad(w.MxDrawData.m_dInputRectWidth),W=2*E,C=k.viewCoordLong2Cad(k.getViewWidth()),F=k.viewCoordLong2Cad(k.getViewHeight()),M=L.MxTools.MxMax(C,F),a=U.MxManager.getMxCpp().getMxCAD_App(),h=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),y=this.m_mxJig.getMxObject().viewCoordLong2Cad(this.m_dashedLineLen),j=0;j<this.m_aryTraceObject.length-1;j++){var Y=this.m_aryTraceObject[j],q=Y.m_pt,V=this.GetTraceLine(_,Y,W,M);if(V.length!=0)for(var ne=j+1;ne<this.m_aryTraceObject.length&&!this.m_isValidTracePoint;ne++){var ie=this.m_aryTraceObject[j],he=ie.m_pt,be=this.GetTraceLine(_,ie,W,M);if(V.length!=0)for(var je=0;je<be.length&&!this.m_isValidTracePoint;je++)for(var xe=be[je],Fe=0;Fe<V.length&&!this.m_isValidTracePoint;Fe++){var J=V[Fe],ge=a.MxCADAssist.IntersectWith(J.pt1.x,J.pt1.y,J.pt2.x,J.pt2.y,xe.pt1.x,xe.pt1.y,xe.pt2.x,xe.pt2.y,3);if(0<ge.length()){var oe=ge.at(0),le=new o.Vector3(oe.x,oe.y,oe.z);if(le.distanceTo(_)<W){var Re=N.MxThreeJS.createDashedLine(k.toSmallcoord(J.pt1),k.toSmallcoord(J.pt2),this.m_iDashedLineLenColor,y,y);h.add(Re),this.m_vecDynDrawEntity.push(Re);var Ye=N.MxThreeJS.createDashedLine(k.toSmallcoord(xe.pt1),k.toSmallcoord(xe.pt2),this.m_iDashedLineLenColor,y,y);h.add(Ye),this.m_vecDynDrawEntity.push(Ye),je=be.length,this.m_isValidTracePoint=!0,this.m_ptTracePoint=le,this.CreteTracePoint(le,E),ee.push({pt:q,ostype:Y.m_osmode}),ee.push({pt:he,ostype:ie.m_osmode});break}}}}}if(this.m_isValidTracePoint||this.TracekPerpLine(_,ee,W,M,E)||this.TracekTangLine(_,ee,W,M,E))return ee;for(j=0;j<this.m_aryTraceObject.length;j++)if(q=this.m_aryTraceObject[j].m_pt,this.m_aryTraceObject[j].m_osmode!=v.MxJigCmdManager.OsnapMode.kOsModePerp&&!(q.distanceTo(_)<2*W)){var Be={pt1:new o.Vector3(q.x-M,q.y),pt2:new o.Vector3(q.x+M,q.y)};if(0<(Ee=a.MxCADAssist.GetClosestPointTo(Be.pt1.x,Be.pt1.y,Be.pt2.x,Be.pt2.y,_.x,_.y,!0)).length()){var se=Ee.at(0);if((rt=new o.Vector3(se.x,se.y,se.z)).distanceTo(_)<W){var ve=N.MxThreeJS.createDashedLine(k.toSmallcoord(Be.pt1),k.toSmallcoord(Be.pt2),this.m_iDashedLineLenColor,y,y);h.add(ve),this.m_vecDynDrawEntity.push(ve),this.m_isValidTracePoint=!0,this.m_ptTracePoint=rt,ee.push({pt:q,ostype:this.m_aryTraceObject[j].m_osmode}),this.CreteTracePoint(rt,E);break}}var Ee,rt,tt={pt1:new o.Vector3(q.x,q.y-M),pt2:new o.Vector3(q.x,q.y+M)};if(0<(Ee=a.MxCADAssist.GetClosestPointTo(tt.pt1.x,tt.pt1.y,tt.pt2.x,tt.pt2.y,_.x,_.y,!0)).length()&&(se=Ee.at(0),(rt=new o.Vector3(se.x,se.y,se.z)).distanceTo(_)<W)){ve=N.MxThreeJS.createDashedLine(k.toSmallcoord(tt.pt1),k.toSmallcoord(tt.pt2),this.m_iDashedLineLenColor,y,y),h.add(ve),this.m_vecDynDrawEntity.push(ve),this.m_isValidTracePoint=!0,this.m_ptTracePoint=rt,ee.push({pt:q,ostype:this.m_aryTraceObject[j].m_osmode}),this.CreteTracePoint(rt,E);break}}return ee},R.prototype.MouseMove=function(_){var ee=this.DoMouseMove(_);if(this.m_isValidTracePoint)for(var k=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),E=this.m_mxJig.getMxObject().screenCoordLong2Doc(w.MxDrawData.m_dInputRectWidth),W=0;W<ee.length;W++){var C=new T(ee[W].pt,ee[W].ostype);C.m_iGripWidth=E,C.draw(this.m_mxJig.getMxObject(),k),this.m_aryTraceOsmodeObject.push(C)}},R.prototype.Init=function(){var _=this.m_mxJig.getMxObject();_.getMcObject().isValid()?(this.m_isDynTrace=_.getSysVarLong("DYNTRACE")!=0,_.sysVariable().getSysVarNumber("GETPOINTSTATUS")&v.MxJigCmdManager.GETPOINTSTATUS.OsModeDynTraceTempDisable&&(this.m_isDynTrace=!1),this.m_mxJig.isDisableDynamicTrace()&&(this.m_isDynTrace=!1),this.m_isDynTrace):this.m_isDynTrace=!1},R.prototype.GetTracePoint=function(){if(this.m_isDynTrace)return this.m_isValidTracePoint?this.m_ptTracePoint:void 0},R.prototype.ReSetTempDisplay=function(){this.ClearDynDrawEntity(),this.ClearOsmodeObjectDisplay(),this.m_isValidTracePoint=!1},R.prototype.CreteTracePoint=function(_,ee){var k=this.m_mxJig.getMxObject(),E=k.getTheTempDrawContainer_SmallCoord();ee/=2;var W=N.MxThreeJS.createLine(k.toSmallcoord2(_.x+ee,_.y+ee,0),k.toSmallcoord2(_.x-ee,_.y-ee,0),16711680);E.add(W),this.m_vecDynDrawEntity.push(W);var C=N.MxThreeJS.createLine(k.toSmallcoord2(_.x-ee,_.y+ee,0),k.toSmallcoord2(_.x+ee,_.y-ee,0),16711680);E.add(C),this.m_vecDynDrawEntity.push(C)},R.prototype.TracekPerpLine=function(_,ee,k,E,W){for(var C=this.m_aryTraceObject,F=C.length,M=U.MxManager.getMxCpp().getMxCAD_App(),a=this.m_mxJig.getMxObject(),h=a.getTheTempDrawContainer_SmallCoord(),y=a.viewCoordLong2Cad(this.m_dashedLineLen),j=0;j<F;j++){var Y=C[j].m_pt;if(!(Y.distanceTo(_)<2*k)){var q=U.MxManager.getMxCpp().getMcDbCurve(C[j].m_snapObjectId);if(q){var V=q.getFirstDeriv(U.MxManager.getMxCpp().newMcGePoint3d(Y));if(V.ret==0&&!V.val.isZeroLength()){V.val.normalize(),V.val.rotateBy(Math.PI/2),V.val.mult(E);var ne={pt1:new o.Vector3(Y.x-V.val.x,Y.y-V.val.y),pt2:new o.Vector3(Y.x+V.val.x,Y.y+V.val.y)},ie=M.MxCADAssist.GetClosestPointTo(ne.pt1.x,ne.pt1.y,ne.pt2.x,ne.pt2.y,_.x,_.y,!0);if(0<ie.length()){var he=ie.at(0),be=new o.Vector3(he.x,he.y,he.z);if(be.distanceTo(_)<k){var je=N.MxThreeJS.createDashedLine(a.toSmallcoord2(Y.x-V.val.x,Y.y-V.val.y,0),a.toSmallcoord2(Y.x+V.val.x,Y.y+V.val.y,0),this.m_iDashedLineLenColor,y,y);h.add(je),this.m_vecDynDrawEntity.push(je),this.m_isValidTracePoint=!0,this.m_ptTracePoint=be,ee.push({pt:Y,ostype:C[j].m_osmode}),this.CreteTracePoint(be,W);break}}}}}}return this.m_isValidTracePoint},R.prototype.TracekTangLine=function(_,ee,k,E,W){for(var C=this.m_aryTraceObject,F=C.length,M=U.MxManager.getMxCpp().getMxCAD_App(),a=this.m_mxJig.getMxObject(),h=a.getTheTempDrawContainer_SmallCoord(),y=a.viewCoordLong2Cad(this.m_dashedLineLen),j=0;j<F;j++){var Y=C[j].m_pt;if(!(Y.distanceTo(_)<2*k)){var q=U.MxManager.getMxCpp().getMcDbCurve(C[j].m_snapObjectId);if(q){var V=q.getFirstDeriv(U.MxManager.getMxCpp().newMcGePoint3d(Y));if(V.ret==0&&!V.val.isZeroLength()){V.val.normalize(),V.val.mult(E);var ne={pt1:new o.Vector3(Y.x-V.val.x,Y.y-V.val.y),pt2:new o.Vector3(Y.x+V.val.x,Y.y+V.val.y)},ie=M.MxCADAssist.GetClosestPointTo(ne.pt1.x,ne.pt1.y,ne.pt2.x,ne.pt2.y,_.x,_.y,!0);if(0<ie.length()){var he=ie.at(0),be=new o.Vector3(he.x,he.y,he.z);if(be.distanceTo(_)<k){var je=N.MxThreeJS.createDashedLine(a.toSmallcoord2(Y.x-V.val.x,Y.y-V.val.y),a.toSmallcoord2(Y.x+V.val.x,Y.y+V.val.y),this.m_iDashedLineLenColor,y,y);h.add(je),this.m_vecDynDrawEntity.push(je),this.m_isValidTracePoint=!0,this.m_ptTracePoint=be,ee.push({pt:Y,ostype:C[j].m_osmode}),this.CreteTracePoint(be,W);break}}}}}}return this.m_isValidTracePoint},R);function R(_){this.m_snapObjectId=0,this.m_ptSnapPoint=new o.Vector3,this.m_osmode=0,this.m_ptTracePoint=new o.Vector3,this.m_isValidTracePoint=!1,this.m_isDynTrace=!1,this.m_iTimeCallId=0,this.m_mxJig=null,this.m_aryTraceObject=[],this.m_aryTraceOsmodeObject=[],this.m_vecDynDrawEntity=[],this.m_dashedLineLen=1.5,this.m_iDashedLineLenColor=11184810,this.m_mxJig=_}s.McEdJigDynamicTrace=G},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxThreeJS":36,"../MxTools":37,"./McEdJigOsnap":42,"./MxJigCmdManager":53,three:19}],42:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.McEdJigOsnap=s.McEdJigOsnapDraw=s.McEdJigOrtho=s.McEdImpJigGlobalData=s.MxOsnapDefine=void 0;var o,v,u,w,L,U,N,D,f,P,T=b("three"),B=b("../MxDrawObject"),G=b("../MxFun"),R=b("./MxJigCmdManager"),_=b("../MxTools"),ee=b("../MxDrawData");(v=o||(s.MxOsnapDefine=o={}))[v.OsModeInvalid=0]="OsModeInvalid",v[v.OsModeEnd=1]="OsModeEnd",v[v.OsModeMid=2]="OsModeMid",v[v.OsModeCen=4]="OsModeCen",v[v.OsModeNode=8]="OsModeNode",v[v.OsModeQuad=16]="OsModeQuad",v[v.OsModeInt=32]="OsModeInt",v[v.OsModeIns=64]="OsModeIns",v[v.OsModePerp=128]="OsModePerp",v[v.OsModeTan=256]="OsModeTan",v[v.OsModeNear=512]="OsModeNear",v[v.OsModeApp=2048]="OsModeApp",v[v.OsModeExt=4096]="OsModeExt",v[v.OsModePar=8192]="OsModePar",v[v.OsModeOff=16384]="OsModeOff",v[v.OsModeAll=16383]="OsModeAll",w=u||(s.McEdImpJigGlobalData=u={}),L=!1,U=new T.Vector3,N=new T.Vector3,f=D=!1,P=new Array,w.setPrvPoint=function(a){U=a,f=!0},w.isOsnapZValue=function(){return!1},w.setIsValidPrvpoint=function(a){f=a},w.isValidPrvpoint=function(){return f},w.getPrvPoint=function(){return U},w.setIsValidBasepoint=function(a){L=a},w.isValidBasepoint=function(){return L},w.setBasepoint=function(a){L=!0,N=a},w.getBasepoint=function(){return N},w.initStartCommand=function(){D=L=!1},w.setIsTmpDisableOsmode=function(a){D=a},w.isTmpDisableOsmode=function(){return D},w.addDynDrawObject=function(a){P.push(a)},w.clearDisplay=function(a){for(var h=P.length,y=0;y<h;y++)G.MxFun.removeThreejsObject(P[y],a);P=[]};var k=(E.prototype.Init=function(){this.m_isTrace=!this.m_mxJig.isDisableOrthoTrace(),this.m_isValid=!1},E.prototype.OnViewMouseMove=function(a){if(this.m_isTrace){var h=this.m_mxJig.getMxObject(),y=h.sysVariable().getSysVarNumber("GETPOINTSTATUS");if(!(h.getSysVarLong("ORTHOMODE")==0||y&R.MxJigCmdManager.GETPOINTSTATUS.OsModeOrthoTempDisable)&&y&R.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint){var j=h.sysVariable().getSysVarPoint("LASTPOINT");Math.abs(a.x-j.x)>Math.abs(a.y-j.y)?(this.m_ptOrtho.x=a.x,this.m_ptOrtho.y=j.y):(this.m_ptOrtho.x=j.x,this.m_ptOrtho.y=a.y),this.m_isValid=!0}else this.m_isValid=!1}},E.prototype.GetCurOrthoPoint=function(){return{pt:this.m_ptOrtho,isValid:this.m_isValid}},E);function E(a){this.m_mxJig=null,this.m_ptOrtho=new T.Vector3,this.m_isValid=!1,this.m_isTrace=!0,this.m_mxJig=a}s.McEdJigOrtho=k;var W=(C.prototype.setAddDynDrawObject_call=function(a){this.m_addDynDrawObject_call=a},C.prototype.addDynDrawObject=function(a){this.m_addDynDrawObject_call?this.m_addDynDrawObject_call(a):u.addDynDrawObject(a)},C.prototype.drawLine=function(a,h,y){var j=new T.Geometry,Y=new T.LineBasicMaterial({color:this.m_iColor});j.vertices.push(new T.Vector3(a.x,a.y,a.z),new T.Vector3(h.x,h.y,h.z));var q=new T.Line(j,Y);y.add(q),this.addDynDrawObject(q)},C.prototype.drawPolyline=function(a,h){for(var y=new T.Geometry,j=new T.LineBasicMaterial({color:this.m_iColor}),Y=a.length,q=0;q<Y;q++)y.vertices.push(new T.Vector3(a[q].x,a[q].y,a[q].z));var V=new T.Line(y,j);h.add(V),this.addDynDrawObject(V)},C.prototype.setWidth=function(a){this.m_dOsmodeWdith=a},C.prototype.GetDrawRect=function(){var a=.5*this.m_dOsmodeWdith,h={};return h.left=this.m_pt.x-a,h.right=this.m_pt.x+a,h.top=this.m_pt.y-a,h.bottom=this.m_pt.y+a,h},C.prototype.DrawNear=function(a){var h=this.GetDrawRect(),y=[new T.Vector3,new T.Vector3];y[0].x=h.left,y[0].y=h.top,y[1].x=h.right,y[1].y=h.top,this.drawLine(y[0],y[1],a),y[0].x=h.left,y[0].y=h.bottom,y[1].x=h.right,y[1].y=h.bottom,this.drawLine(y[0],y[1],a),y[0].x=h.right,y[0].y=h.top,y[1].x=h.left,y[1].y=h.bottom,this.drawLine(y[0],y[1],a),y[0].x=h.right,y[0].y=h.bottom,y[1].x=h.left,y[1].y=h.top,this.drawLine(y[0],y[1],a)},C.prototype.DrawEnd=function(a){var h=this.GetDrawRect(),y=[new T.Vector3,new T.Vector3,new T.Vector3,new T.Vector3];y[0].x=h.left,y[0].y=h.top,y[1].x=h.right,y[1].y=h.top,y[2].x=h.right,y[2].y=h.bottom,y[3].x=h.left,y[3].y=h.bottom,this.drawLine(y[0],y[1],a),this.drawLine(y[1],y[2],a),this.drawLine(y[2],y[3],a),this.drawLine(y[3],y[0],a)},C.prototype.DrawMid=function(a){var h=this.GetDrawRect(),y=1.2*(h.right-h.left),j=y/2/Math.sin(60*3.14159265/180),Y=j*Math.sin(.5235987750000001),q=new T.Vector3(this.m_pt.x,this.m_pt.y,this.m_pt.z);q.y-=j;var V=new T.Vector3;V.x=this.m_pt.x+y/2,V.y=this.m_pt.y+Y;var ne=new T.Vector3;ne.x=this.m_pt.x-y/2,ne.y=this.m_pt.y+Y;var ie=[new T.Vector3,new T.Vector3,new T.Vector3,new T.Vector3];ie[0].x=q.x,ie[0].y=q.y,ie[1].x=V.x,ie[1].y=V.y,ie[2].x=ne.x,ie[2].y=ne.y,ie[3].x=q.x,ie[3].y=q.y,this.drawLine(ie[0],ie[1],a),this.drawLine(ie[1],ie[2],a),this.drawLine(ie[2],ie[3],a)},C.prototype.DrawPerp=function(a){var h=this.GetDrawRect(),y=[new T.Vector3,new T.Vector3,new T.Vector3];y[0].x=h.left,y[0].y=h.top,y[1].x=h.left,y[1].y=h.bottom,y[2].x=h.right,y[2].y=h.bottom,this.drawPolyline(y,a),y[0].x=h.left,y[0].y=this.m_pt.y,y[1].x=this.m_pt.x,y[1].y=this.m_pt.y,y[2].x=this.m_pt.x,y[2].y=h.bottom,this.drawPolyline(y,a)},C.prototype.DrawCircle=function(a,h,y){y==null&&(y=.5*this.m_dOsmodeWdith);for(var j=[],Y=0,q=3.14159265/180;Y<=360;Y+=15){var V=y*Math.cos(Y*q)+a.x,ne=y*Math.sin(Y*q)+a.y;j.push(new T.Vector3(V,ne))}this.drawPolyline(j,h)},C.prototype.DrawInt=function(a){var h=this.GetDrawRect(),y=[new T.Vector3,new T.Vector3];y[0].x=h.right,y[0].y=h.top,y[1].x=h.left,y[1].y=h.bottom,this.drawLine(y[0],y[1],a),y[0].x=h.right,y[0].y=h.bottom,y[1].x=h.left,y[1].y=h.top,this.drawLine(y[0],y[1],a)},C.prototype.DrawCen=function(a){this.DrawInt(a),this.DrawCircle(this.m_pt,a)},C.prototype.DrawTan=function(a){this.DrawEnd(a)},C.prototype.DrawIns=function(a){var h=this.GetDrawRect(),y={},j=(h.right-h.left)/1.5;y.left=this.m_pt.x-j,y.right=this.m_pt.x+j,y.top=this.m_pt.y-j,y.bottom=this.m_pt.y+j;var Y=this.m_pt.x,q=this.m_pt.y,V=[new T.Vector3,new T.Vector3,new T.Vector3,new T.Vector3,new T.Vector3,new T.Vector3,new T.Vector3,new T.Vector3,new T.Vector3];V[0].x=y.left,V[0].y=y.top,V[1].x=y.left,V[1].y=q+2,V[2].x=Y,V[2].y=q+2,V[3].x=Y,V[3].y=y.bottom,V[4].x=y.right,V[4].y=y.bottom,V[5].x=y.right,V[5].y=q-2,V[6].x=Y,V[6].y=q-2,V[7].x=Y,V[7].y=y.top,V[8].x=y.left,V[8].y=y.top,this.drawPolyline(V,a)},C.prototype.DrawNode=function(a){var h=this.GetDrawRect(),y={},j=(h.right-h.left)/1.5;y.left=this.m_pt.x-j,y.right=this.m_pt.x+j,y.top=this.m_pt.y-j,y.bottom=this.m_pt.y+j;var Y=this.m_dOsmodeWdith/1.3;this.m_pt.x,this.m_pt.x,this.m_pt.y,this.m_pt.y;var q=[new T.Vector3,new T.Vector3,new T.Vector3,new T.Vector3];q[0].x=y.left,q[0].y=y.top,q[1].x=y.right,q[1].y=y.bottom,q[2].x=y.left,q[2].y=y.bottom,q[3].x=y.right,q[3].y=y.top,this.drawLine(q[0],q[1],a),this.drawLine(q[2],q[3],a),this.DrawCircle(this.m_pt,a,Y)},C.prototype.draw=function(a,h,y){this.m_pt=a,this.m_osmode=h;var j=.5*this.m_dOsmodeWdith;if(this.m_osmode!=R.MxJigCmdManager.OsnapMode.kOsModekInValid)if(this.m_osmode==R.MxJigCmdManager.OsnapMode.kOsModeNear)this.DrawNear(y);else if(this.m_osmode==R.MxJigCmdManager.OsnapMode.kOsModeEnd)this.DrawEnd(y);else if(this.m_osmode==R.MxJigCmdManager.OsnapMode.kOsModeMid)this.DrawMid(y);else if(this.m_osmode==R.MxJigCmdManager.OsnapMode.kOsModePerp)this.DrawPerp(y);else if(this.m_osmode==R.MxJigCmdManager.OsnapMode.kOsModeInt)this.DrawInt(y);else if(this.m_osmode==R.MxJigCmdManager.OsnapMode.kOsModeCen)this.DrawCen(y);else if(this.m_osmode==R.MxJigCmdManager.OsnapMode.kOsModeTan)this.DrawTan(y);else if(this.m_osmode==R.MxJigCmdManager.OsnapMode.kOsModeIns)this.DrawIns(y);else if(this.m_osmode==R.MxJigCmdManager.OsnapMode.kOsModeNode)this.DrawNode(y);else{var Y=new T.Vector3(a.x-j,a.y-j,0),q=new T.Vector3(a.x+j,a.y+j,0);this.drawLine(Y,q,y);var V=new T.Vector3(a.x-j,a.y+j,0),ne=new T.Vector3(a.x+j,a.y-j,0);this.drawLine(V,ne,y)}},C.prototype.upDisplay=function(a,h,y){this.clearDisplay(y);var j=y.getMxObject();this.setWidth(j.screenCoordLong2Doc(ee.MxDrawData.m_dInputRectWidth)),a=j.toSmallcoord(a),this.draw(a,h,j.getTheTempDrawContainer_SmallCoord())},C.prototype.clearDisplay=function(a){var h=a.getMxObject().getTheTempDrawContainer_SmallCoord();u.clearDisplay(h)},C);function C(){this.m_iColor=16711935,this.m_addDynDrawObject_call=void 0,this.m_pt=new T.Vector3,this.m_osmode=R.MxJigCmdManager.OsnapMode.kOsModekInValid,this.m_dOsmodeWdith=10}s.McEdJigOsnapDraw=W;var F=(M.prototype.resetData=function(){this.m_osmode=R.MxJigCmdManager.OsnapMode.kOsModekInValid,this.m_isValidPrvInputPoint=!1,this.m_lOSmode=0,this.m_vecOffset.set(0,0,0),this.m_isValid=!1,this.m_iLongprogressStatus=-1,this.reComputeOffset()},M.prototype.notifyOsnapToServer=function(){var a=this;if(this.m_isRuning){var h={ptx:this.m_pt.x,pty:this.m_pt.y,osmode:this.m_lOSmode,isValidPrvInputPoint:this.m_isValidPrvInputPoint};this.m_isValidPrvInputPoint&&(h.prvPtx=this.m_prvInputPoint.x,h.prvPty=this.m_prvInputPoint.y);var y=this.m_mxJig.getMxObject();if(y.getRunMode()==B.MxRunMode.kBrowse){var j=this,Y=y.getCurrentMousePostion();y.getObjectOsnap().getOsnapData(Y,function(ne,ie){ne=y.worldCoord2Doc(ne.x,ne.y,ne.z),j.m_ptSnapPoint.x=ne.x,j.m_ptSnapPoint.y=ne.y,j.m_ptSnapPoint.z=0,j.m_ptSnapSrcPoint.x=j.m_pt.x,j.m_ptSnapSrcPoint.y=j.m_pt.y,j.m_ptSnapSrcPoint.z=0,j.m_osmode=ie,j.m_draw.upDisplay(new T.Vector3(ne.x,ne.y,0),ie,j.m_mxJig)})}else if(y.getRunMode()==B.MxRunMode.kCPPMxCAD){var q=this;h.SearchRnge=y.viewCoordLong2Cad(ee.MxDrawData.m_dInputRectWidth),y.getMcObject().onNotifyOsnap(h,function(ne){q.m_ptSnapPoint.x=ne.ptsx,q.m_ptSnapPoint.y=ne.ptsy,q.m_ptSnapPoint.z=ne.ptsz,q.m_ptSnapSrcPoint.x=ne.ptx,q.m_ptSnapSrcPoint.y=ne.pty,q.m_ptSnapSrcPoint.z=0,q.m_osmode=ne.osmode,q.m_snapObjectId=ne.id,q.m_draw.upDisplay(new T.Vector3(ne.ptsx,ne.ptsy,ne.ptsz),ne.osmode,q.m_mxJig),q.m_mxJig.onGetOsnapData(ne)})}else{h.SearchRnge=y.viewCoordLong2Cad(ee.MxDrawData.m_dInputRectWidth);var V=this;y.callCommand("MxCAD_NotifyOsnap",JSON.stringify(h),function(ne){if(!(typeof ne!="string"||ne.length<1)&&V.m_isRuning){var ie=JSON.parse(ne);a.m_ptSnapPoint.x=ie.ptsx,a.m_ptSnapPoint.y=ie.ptsy,a.m_ptSnapPoint.z=ie.ptsz,a.m_ptSnapSrcPoint.x=ie.ptx,a.m_ptSnapSrcPoint.y=ie.pty,a.m_ptSnapSrcPoint.z=0,a.m_osmode=ie.osmode,V.m_draw.upDisplay(new T.Vector3(ie.ptsx,ie.ptsy,ie.ptsz),ie.osmode,V.m_mxJig)}})}}},M.prototype.startDrag=function(a,h){this.m_mxJig=h;var y,j,Y=this.m_mxJig.getMxObject();function q(){y.notifyOsnapToServer()}return h.isDisableOsnap()?this.m_isEnable=!1:this.m_isEnable=Y.getInisetValue(B.IniSetName.kEnableOsnapFunction)===!0,this.m_isOffsetInputPostion=a,this.m_isRuning=!0,this.resetData(),this.m_notifyOsnap_delayCall=(y=this,j=null,function(){clearTimeout(j),j=setTimeout(q,20)}),!0},M.prototype.endDrag=function(){return this.m_isRuning=!1,this.m_draw.clearDisplay(this.m_mxJig),!0},M.prototype.reCompteCurrentPoint=function(a){return this.m_isOffsetInputPostion&&a.add(this.m_vecOffset),a},M.prototype.isEnable=function(){var a,h=this.m_mxJig.getMxObject().getSysVarLong("OSMODE");return a=!(h==0||h&o.OsModeOff||u.isTmpDisableOsmode()),this.m_isEnable&&a},M.prototype.notifyOsnap=function(a,h){this.m_lOSmode=a,h==null?this.m_isValidPrvInputPoint=!1:(this.m_isValidPrvInputPoint=!0,this.m_prvInputPoint=h),this.m_osmode==R.MxJigCmdManager.OsnapMode.kOsModekInValid&&this.m_draw.clearDisplay(this.m_mxJig),this.m_notifyOsnap_delayCall()},M.prototype.setPoint=function(a,h){if(this.isEnable()){a==null?(this.m_isValid=!1,this.m_osmode=R.MxJigCmdManager.OsnapMode.kOsModekInValid):(this.m_iLongprogressStatus==-1||this.m_iLongprogressStatus,this.m_pt=a,this.m_inPoint=a,this.m_isValid=!0,(h==null||this.m_osmode!=R.MxJigCmdManager.OsnapMode.kOsModekInValid&&_.MxTools.getXYPlanDistance(this.m_ptSnapSrcPoint,a)>h)&&(this.m_osmode=R.MxJigCmdManager.OsnapMode.kOsModekInValid));var y=this.m_mxJig.getMxObject().getSysVarLong("OSMODE"),j=u.getPrvPoint();this.notifyOsnap(y,u.isValidPrvpoint()?j:void 0)}},M.prototype.seInValidPoint=function(){this.setPoint(void 0)},M.prototype.getCurrentOSnapPoint=function(a){var h={isSnapPoint:!1};return this.isEnable()?(h.pt=a,h.osmode=this.m_osmode,this.m_osmode!=R.MxJigCmdManager.OsnapMode.kOsModekInValid?(h.isSnapPoint=!0,h.pt.x=this.m_ptSnapPoint.x,h.pt.y=this.m_ptSnapPoint.y,h.pt.z=this.m_ptSnapPoint.z,u.isOsnapZValue()||(a.z=0)):h.pt=a):(h.pt=a,h.osmode=R.MxJigCmdManager.OsnapMode.kOsModekInValid),h},M.prototype.setLongprogressStatus=function(a){this.m_iLongprogressStatus=a},M.prototype.reComputeOffset=function(){if(this.m_isOffsetInputPostion){var a=this.m_mxJig.getMxObject(),h=_.MxTools.MillimeterToPixels(14);h=a.screenCoordLong2Doc(h),this.m_vecOffset.set(0,h,0),this.m_vecOffset.applyAxisAngle(new T.Vector3(0,0,1),20*Math.PI/180)}},M);function M(a){this.m_inPoint=new T.Vector3,this.m_vecOffset=new T.Vector3,this.m_pt=new T.Vector3,this.m_isValid=!1,this.m_ptSnapPoint=new T.Vector3,this.m_ptSnapSrcPoint=new T.Vector3,this.m_snapObjectId=0,this.m_osmode=R.MxJigCmdManager.OsnapMode.kOsModekInValid,this.m_prvInputPoint=new T.Vector3,this.m_isValidPrvInputPoint=!1,this.m_lOSmode=0,this.m_iLongprogressStatus=-1,this.m_isOffsetInputPostion=!1,this.m_mxJig=null,this.m_notifyOsnap_delayCall=void 0,this.m_isRuning=!1,this.m_isEnable=!1,this.m_mxJig=a,this.m_draw=new W}s.McEdJigOsnap=F},{"../MxDrawData":22,"../MxDrawObject":23,"../MxFun":27,"../MxTools":37,"./MxJigCmdManager":53,three:19}],43:[function(b,r,s){var o,v=this&&this.__extends||(o=function(_,ee){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,E){k.__proto__=E}||function(k,E){for(var W in E)Object.prototype.hasOwnProperty.call(E,W)&&(k[W]=E[W])})(_,ee)},function(_,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Class extends value "+String(ee)+" is not a constructor or null");function k(){this.constructor=_}o(_,ee),_.prototype=ee===null?Object.create(ee):(k.prototype=ee.prototype,new k)});Object.defineProperty(s,"__esModule",{value:!0}),s.McGiWorldDrawSelect=s.McGiWorldDraw=s.McGiWorldDrawType=void 0;var u,w,L=b("three"),U=b("../MxThreeJS"),N=b("../MxManager"),D=b("three.meshline"),f=b("../MxFun");(w=u||(s.McGiWorldDrawType=u={}))[w.kWorldDraw=1]="kWorldDraw",w[w.kDynDragDraw=2]="kDynDragDraw",w[w.kSelectDraw=3]="kSelectDraw";var P=(T.prototype.getType=function(){return this.worldDrawType},T.prototype.setXData=function(_){this.xData=_},T.prototype.setMatrix=function(_){this.matrix=_},T.prototype.getMatrix=function(){return this.matrix},T.prototype.setOpacity=function(_){this.opacity=_},T.prototype.getOpacity=function(){return this.opacity},T.prototype.setColor=function(_){_=f.MxFun.getNumberColor(_),this.iColor!=_&&(this.widthMaterial=null),this.iColor=_},T.prototype.setDash=function(_,ee){this.dDashArray=_,this.dDashRatio=ee},T.prototype.getDash=function(){return{dDashArray:this.dDashArray,dDashRatio:this.dDashRatio}},T.prototype.setDashLineDisplay=function(_){_?(this.dDashArray=.03,this.dDashRatio=.1,this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0)):(this.dDashArray=0,this.dDashRatio=0)},T.prototype.isDashLineDisplay=function(){return 0<this.dDashArray&&0<this.dDashRatio},T.prototype.getColor=function(){return this.iColor},T.prototype.setRenderOrder=function(_){this.iRenderOrder=_},T.prototype.getRenderOrder=function(){return this.iRenderOrder},T.prototype.setLineWidthByPixels=function(_){this.lineWidthByPixels!=_&&(this.widthMaterial=null),this.lineWidthByPixels=_},T.prototype.getLineWidthByPixels=function(){return this.lineWidthByPixels},T.prototype.setLineWidth=function(_){this.dLineWidth!=_&&(this.widthMaterial=null),this.dLineWidth=_},T.prototype.getLineWidth=function(){return this.dLineWidth},T.prototype.drawEntity=function(_){var ee=this.iRenderOrder;_.type=="Group"?_.traverse(function(k){k.type!="Group"&&(k.renderOrder=ee)}):_.renderOrder=ee,this.matrix!=null&&_.applyMatrix4(this.matrix),this.aryEntity.push(_),this.xData&&(_.MxWordDrawXData=this.xData,this.xData=null)},T.prototype.getEntitys=function(){return this.aryEntity},T.prototype.getMxObject=function(){return this.mxObj},T.prototype.createWidthMaterial=function(){this.widthMaterial==null&&(0<this.dDashArray&&0<this.dDashRatio?this.widthMaterial=new D.MeshLineMaterial({useMap:!1,color:this.iColor,opacity:1,resolution:new L.Vector2(this.mxObj.getViewWidth(),this.mxObj.getViewHeight()),sizeAttenuation:!this.lineWidthByPixels,lineWidth:this.dLineWidth,transparent:!0,depthTest:!1,dashArray:this.dDashArray,dashRatio:this.dDashRatio}):this.widthMaterial=new D.MeshLineMaterial({useMap:!1,color:this.iColor,opacity:1,resolution:new L.Vector2(this.mxObj.getViewWidth(),this.mxObj.getViewHeight()),sizeAttenuation:!this.lineWidthByPixels,lineWidth:this.dLineWidth,transparent:!0,depthTest:!1}))},T.prototype.drawSolid=function(_){if(!(_.length<3)){var ee=new L.Shape(_.map(function(W){var C=W.x,F=W.y;return new L.Vector2(C,F)})),k=new L.ShapeGeometry(ee),E=new L.Mesh(k,new L.MeshPhongMaterial({color:this.getColor(),side:L.DoubleSide,transparent:!0,opacity:this.getOpacity()}));this.drawEntity(E)}},T.prototype.drawLines=function(_){if(!(_.length<2))if(this.dLineWidth!=0){this.createWidthMaterial();var ee=new L.Geometry;ee.vertices=_;var k=new D.MeshLine;k.setGeometry(ee);var E=new L.Mesh(k.geometry,this.widthMaterial);this.drawEntity(E),this.drawEntity(U.MxThreeJS.createLines(_.slice(0),this.iColor,0))}else this.drawEntity(U.MxThreeJS.createLines(_.slice(0),this.iColor,this.opacity))},T.prototype.drawGeometryLines=function(_){if(!(_.vertices.length<2))if(this.dLineWidth!=0){this.createWidthMaterial();var ee=new D.MeshLine;if(!(_ instanceof L.Geometry)){var k=new L.Geometry;k.vertices=_.vertices,_=k}ee.setGeometry(_);var E=new L.Mesh(ee.geometry,this.widthMaterial);this.drawEntity(E);var W=new L.LineBasicMaterial({color:this.iColor,transparent:!0,depthTest:!1,opacity:0}),C=new L.Line(_,W);this.drawEntity(C)}else W=void 0,W=this.opacity&&this.opacity!=1||this.opacity==0?new L.LineBasicMaterial({color:this.iColor,transparent:!0,depthTest:!1,opacity:this.opacity}):new L.LineBasicMaterial({color:this.iColor,transparent:!0,depthTest:!1}),C=new L.Line(_,W),this.drawEntity(C)},T.prototype.drawSelectLine=function(_,ee,k,E){_ instanceof Object&&ee instanceof Object?this.drawEntity(U.MxThreeJS.createLine(_,ee,this.iColor,0)):typeof _=="number"&&typeof ee=="number"&&this.drawEntity(U.MxThreeJS.createLine(new L.Vector3(_,ee,0),new L.Vector3(k,E,0),this.iColor,0))},T.prototype.drawLine=function(_,ee,k,E){var W,C;if(_ instanceof Object&&ee instanceof Object?(W=_,C=ee):typeof _=="number"&&typeof ee=="number"&&(W=new L.Vector3(_,ee,0),C=new L.Vector3(k,E,0)),this.dLineWidth!=0){this.createWidthMaterial();var F=new Float32Array(6);F[0]=W.x,F[1]=W.y,F[2]=0,F[3]=C.x,F[4]=C.y,F[5]=0;var M=new D.MeshLine;M.setGeometry(F);var a=new L.Mesh(M.geometry,this.widthMaterial);a.renderOrder=this.iRenderOrder,this.drawEntity(a),this.drawSelectLine(W,C)}else this.drawEntity(U.MxThreeJS.createLine(W,C,this.iColor,this.opacity))},T.prototype.drawCircle=function(_,ee){this.drawEntity(U.MxThreeJS.createCircle(_,ee,this.iColor))},T.prototype.drawText=function(_,ee,k,E,W,C){var F=U.MxThreeJS.creatTextSprite(_,E,ee,k,this.iColor,W,C);return this.drawEntity(F),F},T.prototype.setupForEntity=function(_){this.iColor=f.MxFun.getNumberColor(_.getColor()),this.iRenderOrder=_.getRenderOrder(),this.opacity=_.opacity,this.dLineWidth=_.getLineWidth(),this.lineWidthByPixels=_.getLineWidthByPixels(),this.dDashArray=_.getDash().dDashArray,this.dDashRatio=_.getDash().dDashRatio},T);function T(_,ee){this.aryEntity=[],this.iColor=16777215,this.dLineWidth=0,this.lineWidthByPixels=!0,this.iRenderOrder=N.MxData.iMxEntityRenderOrder,this.worldDrawType=1,this.widthMaterial=null,this.dDashArray=0,this.dDashRatio=0,this.matrix=null,this.opacity=1,this.xData=null,this.mxObj=_,this.worldDrawType=ee}s.McGiWorldDraw=P;var B,G=(v(R,B=P),R.prototype.setSmallCoordDraw=function(_){this.isSmallCorrdDraw=_},R.prototype.setCurEntityId=function(_){this.curEntityId=_},R.prototype.drawEntity=function(_){},R.prototype.drawText=function(_,ee,k,E,W,C){return null},R.prototype.drawSelectLine=function(_,ee,k,E){},R.prototype.isValid=function(){return this.curEntityId!=0||(console.log("this.curEntityId == 0"),!1)},R.prototype.drawLine=function(_,ee,k,E){var W,C;this.isValid()&&(_ instanceof Object&&ee instanceof Object?(W=_,C=ee):typeof _=="number"&&typeof ee=="number"&&(W=new L.Vector3(_,ee,0),C=new L.Vector3(k,E,0)),this.selectManager.addLineDisplay(this.curEntityId,W,C,this.isSmallCorrdDraw))},R.prototype.drawCircle=function(_,ee){this.isValid()&&this.selectManager.addCircleDisplay(this.curEntityId,_,ee,this.isSmallCorrdDraw)},R.prototype.drawLines=function(_){if(!(_.length<2))for(var ee=_.length,k=0;k<ee-1;k++)this.selectManager.addLineDisplay(this.curEntityId,_[k],_[k+1],this.isSmallCorrdDraw)},R);function R(_,ee){var k=B.call(this,_,u.kSelectDraw)||this;return k.isSmallCorrdDraw=!1,k.selectManager=ee,k.curEntityId=0,k.isSmallCorrdDraw=!1,k}s.McGiWorldDrawSelect=G},{"../MxFun":27,"../MxManager":29,"../MxThreeJS":36,three:19,"three.meshline":18}],44:[function(b,r,s){var o,v=this&&this.__extends||(o=function(F,M){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,h){a.__proto__=h}||function(a,h){for(var y in h)Object.prototype.hasOwnProperty.call(h,y)&&(a[y]=h[y])})(F,M)},function(F,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function a(){this.constructor=F}o(F,M),F.prototype=M===null?Object.create(M):(a.prototype=M.prototype,new a)});Object.defineProperty(s,"__esModule",{value:!0}),s.MrxDbgUiPrBase=s.MrxDbgUiPrBase_Return=s.McEdGetPointWorldDrawObject=s.McEdGetPointWorldDraw=void 0;var u=b("three"),w=b("./MxJig"),L=b("./MxJigCmdManager"),U=b("../MxThreeJS"),N=b("../UI/MxUiVue"),D=b("../MxString"),f=b("./McGiWorldDraw"),P=b("../MxManager"),T=(B.prototype.setMcEdJig=function(F){this.m_pJig=F},B.prototype.getMcEdJig=function(){return this.m_pJig},B.prototype.setColor=function(F){this.m_iColor=F},B.prototype.getColor=function(){return this.m_iColor},B.prototype.getDrawColor=function(){return this.m_pJig.getMxObject().automaticInversionColor(this.m_iColor)},B.prototype.drawLine=function(F,M){this.m_pJig.drawEntity(U.MxThreeJS.createLine(F,M,this.getDrawColor()))},B.prototype.drawRect=function(F,M){var a=new u.Vector3(F.x,M.y,0),h=new u.Vector3(M.x,F.y,0);this.drawLine(F,a),this.drawLine(a,M),this.drawLine(M,h),this.drawLine(h,F)},B.prototype.drawMcDbEntity=function(F,M){this.m_pJig.drawMcDbEntity(F,M?0:this.getDrawColor(),M)},B.prototype.drawMcDbLine=function(F,M,a,h,y,j){this.m_pJig.drawMcDbLine(F,M,a,h,y,j,this.getDrawColor())},B.prototype.drawCircle=function(F,M){this.m_pJig.drawEntity(U.MxThreeJS.createCircle(F,M,this.getDrawColor()))},B.prototype.drawEntity=function(F,M,a){a===void 0&&(a=!1),this.m_pJig.drawEntity(F,M,a)},B.prototype.drawText=function(F,M,a,h){var y=U.MxThreeJS.creatTextSprite(F,h,M,a,this.getDrawColor());this.drawEntity(y)},B.prototype.drawSolid=function(F,M){var a=U.MxThreeJS.createSolid(F,this.getDrawColor(),M);a&&this.drawEntity(a)},B.prototype.drawCustomEntity=function(F,M){var a=new f.McGiWorldDraw(this.m_pJig.getMxObject(),f.McGiWorldDrawType.kDynDragDraw);a.setupForEntity(F),F.worldDraw(a);for(var h=a.getEntitys(),y=h.length,j=0;j<y;j++)this.drawEntity(h[j],M,F.isUseSmallcoordDisplay())},B);function B(){this.m_pJig=null,this.m_iColor=16777215}s.McEdGetPointWorldDraw=T;var G,R,_,ee=(v(k,G=T),k.prototype.setDraw=function(F){this.m_callDraw=F},k.prototype.worldDraw=function(F){this.m_callDraw!=null&&this.m_callDraw(F,this)},k);function k(){var F=G!==null&&G.apply(this,arguments)||this;return F.m_callDraw=void 0,F}s.McEdGetPointWorldDrawObject=ee,(_=R||(s.MrxDbgUiPrBase_Return=R={}))[_.kCancel=-2]="kCancel",_[_.kNone=-1]="kNone",_[_.kOk=0]="kOk",_[_.kKeyWord=1]="kKeyWord";var E,W=(v(C,E=w.McEdJigCommand),C.prototype.procInKeyword=function(F){F.status>=L.MxJigCmdManager.DragStatus.kKW1&&0<F.sKeyValue.length?this.m_keyWordPicked=F.sKeyValue.toUpperCase():this.m_keyWordPicked=""},C.prototype.getReturnStatus=function(F){switch(F){case L.MxJigCmdManager.DragStatus.kNoChange:return R.kNone;case L.MxJigCmdManager.DragStatus.kCancel:return R.kCancel;case L.MxJigCmdManager.DragStatus.kNull:return R.kNone;case L.MxJigCmdManager.DragStatus.kNormal:return R.kOk}return 1<=F?R.kKeyWord:R.kCancel},C.prototype.SetLASTPOINT=function(F){var M=this._mxObject;if((M=M||P.MxManager.currentMx()).sysVariable().setSysVarPoint("LASTPOINT",F),F){var a=M.sysVariable().getSysVarNumber("GETPOINTSTATUS");a|=L.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint,M.sysVariable().setSysVarNumber("GETPOINTSTATUS",a)}else a=M.sysVariable().getSysVarNumber("GETPOINTSTATUS"),a&=~L.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint,M.sysVariable().setSysVarNumber("GETPOINTSTATUS",a)},C.prototype.clearLastInputPoint=function(){this._mxObject||(this._mxObject=P.MxManager.currentMx()),this.SetLASTPOINT(void 0)},C.prototype.setCursorType=function(F){this.m_cursorType=F},C.prototype.getCursorType=function(){return this.m_cursorType},C.prototype.setInputToucheType=function(F){this.m_toucheType=F},C.prototype.getInputToucheType=function(){return this.m_toucheType},C.prototype.keyWords=function(){return this.m_keyWords},C.prototype.setKeyWords=function(F){this.m_keyWords=F},C.prototype.message=function(){return this.m_message},C.prototype.setMessage=function(F){this.m_message=F},C.prototype.keyWordPicked=function(){return this.m_keyWordPicked},C.prototype.isKeyWordPicked=function(F){return F=F.toUpperCase(),this.m_keyWordPicked==F},C.prototype.setUserDraw=function(F){F.setMcEdJig(this),this.m_pWorldDraw=F},C.prototype.printMessage=function(){var F=new D.MxString(this.m_message);F.TrimRight(":"),1<this.m_keyWords.length&&this.m_keyWords[0]=="["&&this.m_keyWords[this.m_keyWords.length-1]=="]"?F.m_val.indexOf(`
`)==-1?N.MxUiVue.acutPrintf(`
`+F.m_val+" "+this.m_keyWords+":"):N.MxUiVue.acutPrintf(F.m_val+" "+this.m_keyWords+":"):F.m_val.indexOf(`
`)==-1?N.MxUiVue.acutPrintf(`
`+F.m_val+":"):N.MxUiVue.acutPrintf(F.m_val+":")},C);function C(){var F=E!==null&&E.apply(this,arguments)||this;return F.m_keyWords="",F.m_message="",F.m_keyWordPicked="",F.m_pWorldDraw=null,F.m_toucheType=L.MxJigCmdManager.InType.kGetBegan,F.m_cursorType=N.MxUiVue.CursorType.kNormal,F}s.MrxDbgUiPrBase=W},{"../MxManager":29,"../MxString":34,"../MxThreeJS":36,"../UI/MxUiVue":64,"./McGiWorldDraw":43,"./MxJig":52,"./MxJigCmdManager":53,three:19}],45:[function(b,r,s){var o,v=this&&this.__extends||(o=function(y,j){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Y,q){Y.__proto__=q}||function(Y,q){for(var V in q)Object.prototype.hasOwnProperty.call(q,V)&&(Y[V]=q[V])})(y,j)},function(y,j){if(typeof j!="function"&&j!==null)throw new TypeError("Class extends value "+String(j)+" is not a constructor or null");function Y(){this.constructor=y}o(y,j),y.prototype=j===null?Object.create(j):(Y.prototype=j.prototype,new Y)});Object.defineProperty(s,"__esModule",{value:!0}),s.MrxDbgUiPrAngle=s.MrxDbgUiPrKeyWord=s.MrxDbgUiPrString=s.MrxDbgUiPrInt=s.MrxDbgUiPrDist=void 0;var u,w=b("three"),L=b("./MxJigCmdManager"),U=b("../MxFun"),N=b("./MrxDbgUiPrBase"),D=b("../UI/MxUiVue"),f=b("../MxThreeJS"),P=b("../MxString"),T=(v(B,u=N.MrxDbgUiPrBase),B.prototype.value=function(){return this.m_value},B.prototype.basePt=function(){return new w.Vector3(this.m_basePt.x,this.m_basePt.y,0)},B.prototype.setBasePt=function(y){this.m_basePt==null?this.m_basePt=new w.Vector3(y.x,y.y,0):(this.m_basePt.x=y.x,this.m_basePt.y=y.y),this.m_useBasePt=!0},B.prototype.setUseBasePt=function(y){this.m_useBasePt=y},B.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null,this.clearLastInputPoint(),this.m_useBasePt&&this.SetLASTPOINT(this.m_basePt)},B.prototype.go=function(y){this.initGo(),this.m_retcall=y,this.m_previousInPoint=null,this.m_currentInPoint=null,this.m_value=0,L.MxJigCmdManager.runCmd(this)},B.prototype.onExitCommand=function(){var y=this;D.MxUiVue.setCursorType(D.MxUiVue.CursorType.kNormal);var j=!1;this.m_retcall!=null&&(L.MxJigCmdManager.setRunCmdEvent(function(){u.prototype.onExitCommand.call(y,!1),j=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),L.MxJigCmdManager.setRunCmdEvent(void 0)),!j&&L.MxJigCmdManager.isWaitCmdNull()&&D.MxUiVue.restoreCmdStatus(),j||u.prototype.onExitCommand.call(this,!0)},B.prototype.onStartCommand=function(){D.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),L.MxJigCmdManager.setKeywordList(this.keyWords()),u.prototype.onStartCommand.call(this)},B.prototype.sampler=function(){var y,j=L.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);return j.status==L.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new w.Vector3(j.pt.x,j.pt.y,0):(this.m_currSamplerPoint.x=j.pt.x,this.m_currSamplerPoint.y=j.pt.y)),y=this.m_useBasePt?this.acquireDist(this.m_toucheType,this.m_basePt):this.acquireDist(this.m_toucheType,this.m_currentInPoint),this.procInKeyword(y),y.status==L.MxJigCmdManager.DragStatus.kNormal?(this.m_value=y.dist,y.status):y.status==L.MxJigCmdManager.DragStatus.kKW1?y.status:this.m_useBasePt||this.m_currentInPoint?j.status:((y=this.acquirePoint(this.m_toucheType,!1)).status==L.MxJigCmdManager.DragStatus.kNormal&&y.exit&&(this.m_previousInPoint==null?this.m_previousInPoint=new w.Vector3(y.pt.x,y.pt.y,0):(this.m_previousInPoint.x=y.pt.x,this.m_previousInPoint.y=y.pt.y)),y.status)},B.prototype.done=function(y){if(this.m_retcall!=null)return this.m_resultDragStatus=y,this.m_useBasePt||y!=L.MxJigCmdManager.DragStatus.kNormal||!this.m_previousInPoint||this.m_currentInPoint?L.MxJigCmdManager.DoneStatius.kExitCommand:(this.m_currentInPoint=this.m_previousInPoint,this.m_previousInPoint=null,L.MxJigCmdManager.DoneStatius.kContinueCommand);U.MxFun.Assert(0)},B.prototype.upDisplay=function(){this.m_currSamplerPoint&&(this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint)),this.m_useBasePt&&this.m_basePt?this.drawEntity(f.MxThreeJS.createLine(this.m_currSamplerPoint,this.m_basePt,16777215)):this.m_currentInPoint&&this.drawEntity(f.MxThreeJS.createLine(this.m_currSamplerPoint,this.m_currentInPoint,16777215)))},B);function B(){var y=u.call(this)||this;return y.m_useBasePt=!1,y.m_basePt=null,y.m_previousInPoint=null,y.m_currentInPoint=null,y.m_value=0,y.m_currSamplerPoint=null,y.m_retcall=null,y.m_resultDragStatus=L.MxJigCmdManager.DragStatus.kCancel,y.m_cursorType=D.MxUiVue.CursorType.kCross,y}s.MrxDbgUiPrDist=T;var G,R=(v(_,G=N.MrxDbgUiPrBase),_.prototype.value=function(){return this.m_value},_.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null,this.clearLastInputPoint()},_.prototype.go=function(y){this.initGo(),this.m_retcall=y,this.m_value=0,this.m_currSamplerPoint=null,L.MxJigCmdManager.runCmd(this)},_.prototype.onExitCommand=function(){var y=this;D.MxUiVue.setCursorType(D.MxUiVue.CursorType.kNormal);var j=!1;this.m_retcall!=null&&(L.MxJigCmdManager.setRunCmdEvent(function(){G.prototype.onExitCommand.call(y,!1),j=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),L.MxJigCmdManager.setRunCmdEvent(void 0)),!j&&L.MxJigCmdManager.isWaitCmdNull()&&D.MxUiVue.restoreCmdStatus(),j||G.prototype.onExitCommand.call(this,!0)},_.prototype.onStartCommand=function(){D.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),L.MxJigCmdManager.setKeywordList(this.keyWords()),G.prototype.onStartCommand.call(this)},_.prototype.sampler=function(){var y=L.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);y.status==L.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new w.Vector3(y.pt.x,y.pt.y,0):(this.m_currSamplerPoint.x=y.pt.x,this.m_currSamplerPoint.y=y.pt.y));var j=this.acquireInt();return this.procInKeyword(j),j.status==L.MxJigCmdManager.DragStatus.kNormal?this.m_value=j.iVal:(j.status,L.MxJigCmdManager.DragStatus.kKW1),j.status},_.prototype.done=function(y){if(this.m_retcall!=null)return this.m_resultDragStatus=y,L.MxJigCmdManager.DoneStatius.kExitCommand;U.MxFun.Assert(0)},_.prototype.upDisplay=function(){this.m_currSamplerPoint&&this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint))},_);function _(){var y=G.call(this)||this;return y.m_value=0,y.m_currSamplerPoint=null,y.m_retcall=null,y.m_resultDragStatus=L.MxJigCmdManager.DragStatus.kCancel,y.m_cursorType=D.MxUiVue.CursorType.kNormal,y.setDynamicInputType(L.MxJigCmdManager.DynamicInputType.kNoInput),y}s.MrxDbgUiPrInt=R;var ee,k=(v(E,ee=N.MrxDbgUiPrBase),E.prototype.value=function(){return this.m_value},E.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null},E.prototype.go=function(y){this.initGo(),this.m_retcall=y,this.m_value="",this.m_currSamplerPoint=null,L.MxJigCmdManager.runCmd(this)},E.prototype.onExitCommand=function(){var y=this;D.MxUiVue.setCursorType(D.MxUiVue.CursorType.kNormal);var j=!1;this.m_retcall!=null&&(L.MxJigCmdManager.setRunCmdEvent(function(){ee.prototype.onExitCommand.call(y,!1),j=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),L.MxJigCmdManager.setRunCmdEvent(void 0)),!j&&L.MxJigCmdManager.isWaitCmdNull()&&D.MxUiVue.restoreCmdStatus(),j||ee.prototype.onExitCommand.call(this,!0)},E.prototype.onStartCommand=function(){D.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),L.MxJigCmdManager.setKeywordList(this.keyWords()),ee.prototype.onStartCommand.call(this)},E.prototype.sampler=function(){var y=L.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);y.status==L.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new w.Vector3(y.pt.x,y.pt.y,0):(this.m_currSamplerPoint.x=y.pt.x,this.m_currSamplerPoint.y=y.pt.y));var j=this.acquireString();return this.procInKeyword(j),j.status==L.MxJigCmdManager.DragStatus.kNormal?this.m_value=j.sValue:(j.status,L.MxJigCmdManager.DragStatus.kKW1),j.status},E.prototype.done=function(y){if(this.m_retcall!=null)return this.m_resultDragStatus=y,L.MxJigCmdManager.DoneStatius.kExitCommand;U.MxFun.Assert(0)},E.prototype.upDisplay=function(){this.m_currSamplerPoint&&this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint))},E);function E(){var y=ee.call(this)||this;return y.m_value="",y.m_currSamplerPoint=null,y.m_retcall=null,y.m_resultDragStatus=L.MxJigCmdManager.DragStatus.kCancel,y.m_cursorType=D.MxUiVue.CursorType.kCross,y}s.MrxDbgUiPrString=k;var W,C=(v(F,W=N.MrxDbgUiPrBase),F.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null},F.prototype.printMessage=function(){var y=new P.MxString(this.m_message);y.TrimRight(":"),1<this.m_keyWords.length&&this.m_keyWords[0]=="["&&this.m_keyWords[this.m_keyWords.length-1]=="]"?y.m_val.indexOf(`
`)==-1?D.MxUiVue.acutPrintf(`
`+y.m_val+" "+this.m_keyWords+":"):D.MxUiVue.acutPrintf(y.m_val+" "+this.m_keyWords+":"):y.m_val.indexOf(`
`)==-1?D.MxUiVue.acutPrintf(`
`+y.m_val+":"):D.MxUiVue.acutPrintf(y.m_val+":")},F.prototype.go=function(y){this.initGo(),this.m_retcall=y,this.m_currSamplerPoint=null,L.MxJigCmdManager.runCmd(this)},F.prototype.onExitCommand=function(){var y=this;D.MxUiVue.setCursorType(D.MxUiVue.CursorType.kNormal);var j=!1;this.m_retcall!=null&&(L.MxJigCmdManager.setRunCmdEvent(function(){W.prototype.onExitCommand.call(y,!1),j=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),L.MxJigCmdManager.setRunCmdEvent(void 0)),!j&&L.MxJigCmdManager.isWaitCmdNull()&&D.MxUiVue.restoreCmdStatus(),j||W.prototype.onExitCommand.call(this,!0)},F.prototype.onStartCommand=function(){D.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),L.MxJigCmdManager.setKeywordList(this.keyWords()),W.prototype.onStartCommand.call(this)},F.prototype.sampler=function(){var y=L.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);y.status==L.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new w.Vector3(y.pt.x,y.pt.y,0):(this.m_currSamplerPoint.x=y.pt.x,this.m_currSamplerPoint.y=y.pt.y));var j=this.acquireKeyword();return this.procInKeyword(j),j.status,L.MxJigCmdManager.DragStatus.kKW1,j.status},F.prototype.done=function(y){if(this.m_retcall!=null)return y>=L.MxJigCmdManager.DragStatus.kKW1&&(y=L.MxJigCmdManager.DragStatus.kNormal),this.m_resultDragStatus=y,L.MxJigCmdManager.DoneStatius.kExitCommand;U.MxFun.Assert(0)},F.prototype.upDisplay=function(){this.m_currSamplerPoint&&this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint))},F);function F(){var y=W.call(this)||this;return y.m_currSamplerPoint=null,y.m_retcall=null,y.m_resultDragStatus=L.MxJigCmdManager.DragStatus.kCancel,y.m_cursorType=D.MxUiVue.CursorType.kCross,y.setUserInputControls(0),y.setDisableDynInput(!0),y}s.MrxDbgUiPrKeyWord=C;var M,a=(v(h,M=N.MrxDbgUiPrBase),h.prototype.value=function(){return this.m_value},h.prototype.basePt=function(){return new w.Vector3(this.m_basePt.x,this.m_basePt.y,0)},h.prototype.setBasePt=function(y){this.m_basePt==null?this.m_basePt=new w.Vector3(y.x,y.y,0):(this.m_basePt.x=y.x,this.m_basePt.y=y.y),this.m_useBasePt=!0},h.prototype.setUseBasePt=function(y){this.m_useBasePt=y},h.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null,this.clearLastInputPoint(),this.m_useBasePt&&this.SetLASTPOINT(this.m_basePt)},h.prototype.go=function(y){this.initGo(),this.m_retcall=y,this.m_previousInPoint=null,this.m_currentInPoint=null,this.m_value=0,L.MxJigCmdManager.runCmd(this)},h.prototype.onExitCommand=function(){var y=this;D.MxUiVue.setCursorType(D.MxUiVue.CursorType.kNormal);var j=!1;this.m_retcall!=null&&(L.MxJigCmdManager.setRunCmdEvent(function(){M.prototype.onExitCommand.call(y,!1),j=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),L.MxJigCmdManager.setRunCmdEvent(void 0)),!j&&L.MxJigCmdManager.isWaitCmdNull()&&D.MxUiVue.restoreCmdStatus(),j||M.prototype.onExitCommand.call(this,!0)},h.prototype.onStartCommand=function(){D.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),L.MxJigCmdManager.setKeywordList(this.keyWords()),M.prototype.onStartCommand.call(this)},h.prototype.sampler=function(){var y,j=L.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);return j.status==L.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new w.Vector3(j.pt.x,j.pt.y,0):(this.m_currSamplerPoint.x=j.pt.x,this.m_currSamplerPoint.y=j.pt.y)),y=this.m_useBasePt?this.acquireAngle(this.m_toucheType,this.m_basePt):this.acquireAngle(this.m_toucheType,this.m_currentInPoint),this.procInKeyword(y),y.status==L.MxJigCmdManager.DragStatus.kNormal?(this.m_value=y.ang,y.status):y.status==L.MxJigCmdManager.DragStatus.kKW1?y.status:this.m_useBasePt||this.m_currentInPoint?j.status:((y=this.acquirePoint(this.m_toucheType,!1)).status==L.MxJigCmdManager.DragStatus.kNormal&&y.exit&&(this.m_previousInPoint==null?this.m_previousInPoint=new w.Vector3(y.pt.x,y.pt.y,0):(this.m_previousInPoint.x=y.pt.x,this.m_previousInPoint.y=y.pt.y)),y.status)},h.prototype.done=function(y){if(this.m_retcall!=null)return this.m_resultDragStatus=y,this.m_useBasePt||y!=L.MxJigCmdManager.DragStatus.kNormal||!this.m_previousInPoint||this.m_currentInPoint?L.MxJigCmdManager.DoneStatius.kExitCommand:(this.m_currentInPoint=this.m_previousInPoint,this.m_previousInPoint=null,L.MxJigCmdManager.DoneStatius.kContinueCommand);U.MxFun.Assert(0)},h.prototype.upDisplay=function(){this.m_currSamplerPoint&&(this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint)),this.m_useBasePt&&this.m_basePt?this.drawEntity(f.MxThreeJS.createLine(this.m_currSamplerPoint,this.m_basePt,16777215)):this.m_currentInPoint&&this.drawEntity(f.MxThreeJS.createLine(this.m_currSamplerPoint,this.m_currentInPoint,16777215)))},h);function h(){var y=M.call(this)||this;return y.m_useBasePt=!1,y.m_basePt=null,y.m_previousInPoint=null,y.m_currentInPoint=null,y.m_value=0,y.m_currSamplerPoint=null,y.m_retcall=null,y.m_resultDragStatus=L.MxJigCmdManager.DragStatus.kCancel,y.m_cursorType=D.MxUiVue.CursorType.kCross,y}s.MrxDbgUiPrAngle=a},{"../MxFun":27,"../MxString":34,"../MxThreeJS":36,"../UI/MxUiVue":64,"./MrxDbgUiPrBase":44,"./MxJigCmdManager":53,three:19}],46:[function(b,r,s){var o,v=this&&this.__extends||(o=function(G,R){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,ee){_.__proto__=ee}||function(_,ee){for(var k in ee)Object.prototype.hasOwnProperty.call(ee,k)&&(_[k]=ee[k])})(G,R)},function(G,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");function _(){this.constructor=G}o(G,R),G.prototype=R===null?Object.create(R):(_.prototype=R.prototype,new _)});Object.defineProperty(s,"__esModule",{value:!0}),s.MrxDbgUiPrPoint=void 0;var u,w=b("three"),L=b("./MxJigCmdManager"),U=b("../MxFun"),N=b("./MrxDbgUiPrBase"),D=b("../UI/MxUiVue"),f=b("../MxThreeJS"),P=b("../MxManager"),T=(v(B,u=N.MrxDbgUiPrBase),B.prototype.value=function(){return new w.Vector3(this.m_value.x,this.m_value.y,0)},B.prototype.getCADValue=function(){return P.MxManager.getMxCpp().newMcGePoint3d(new w.Vector3(this.m_value.x,this.m_value.y,0))},B.prototype.basePt=function(){return new w.Vector3(this.m_basePt.x,this.m_basePt.y,0)},B.prototype.setBasePt=function(G){this.m_basePt==null?this.m_basePt=new w.Vector3(G.x,G.y,0):(this.m_basePt.x=G.x,this.m_basePt.y=G.y),this.m_useBasePt=!0},B.prototype.setUseBasePt=function(G){this.m_useBasePt=G},B.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null,this.m_retWhileCall=null,this.m_exitCall=null,this.m_useBasePt&&this.SetLASTPOINT(this.m_basePt)},B.prototype.go=function(G){this.initGo(),this.m_retcall=G,L.MxJigCmdManager.runCmd(this)},B.prototype.goWhile=function(G,R){this.initGo(),this.m_retWhileCall=G,R&&(this.m_exitCall=R),L.MxJigCmdManager.runCmd(this)},B.prototype.onExitCommand=function(){var G=this;D.MxUiVue.setCursorType(D.MxUiVue.CursorType.kNormal);var R=!1;this.m_retcall!=null&&(L.MxJigCmdManager.setRunCmdEvent(function(){u.prototype.onExitCommand.call(G,!1),R=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),L.MxJigCmdManager.setRunCmdEvent(void 0)),!R&&L.MxJigCmdManager.isWaitCmdNull()&&D.MxUiVue.restoreCmdStatus(),R||u.prototype.onExitCommand.call(this,!0)},B.prototype.onStartCommand=function(){D.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),L.MxJigCmdManager.setKeywordList(this.keyWords()),this.m_useBasePt&&this.SetLASTPOINT(this.m_basePt),u.prototype.onStartCommand.call(this)},B.prototype.sampler=function(){var G=this.acquirePoint(this.m_toucheType);return this.procInKeyword(G),G.status==L.MxJigCmdManager.DragStatus.kNormal&&(this.m_value==null?this.m_value=new w.Vector3(G.pt.x,G.pt.y,0):(this.m_value.x=G.pt.x,this.m_value.y=G.pt.y)),G.status},B.prototype.done=function(G){if(this.m_retcall!=null)return this.m_resultDragStatus=G,this.m_exitCall&&this.m_exitCall(this.getReturnStatus(this.m_resultDragStatus)),L.MxJigCmdManager.DoneStatius.kExitCommand;if(this.m_retWhileCall!=null){if((this.m_resultDragStatus=G)==L.MxJigCmdManager.DragStatus.kCancel)return this.m_exitCall&&this.m_exitCall(this.getReturnStatus(this.m_resultDragStatus)),L.MxJigCmdManager.DoneStatius.kExitCommand;var R=!1;G==L.MxJigCmdManager.DragStatus.kNull&&(R=!0);var _=this.m_retWhileCall(this.getReturnStatus(this.m_resultDragStatus));return _!=null&&_.exit!=null&&(R=_.exit),R?(this.m_exitCall&&this.m_exitCall(this.getReturnStatus(this.m_resultDragStatus)),L.MxJigCmdManager.DoneStatius.kExitCommand):(L.MxJigCmdManager.setKeywordList(this.keyWords()),this.printMessage(),L.MxJigCmdManager.DoneStatius.kContinueCommand)}U.MxFun.Assert(0)},B.prototype.upDisplay=function(){if(this.m_value&&(this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_value)),this.m_useBasePt&&this.m_basePt)){var G=16777215;this._mxObject.isWhiteViewColor()&&(G=0);var R=this._mxObject;this.drawEntity(f.MxThreeJS.createLine(R.toSmallcoord(this.m_value),R.toSmallcoord(this.m_basePt),G),void 0,!0)}},B);function B(){var G=u.call(this)||this;return G.m_useBasePt=!1,G.m_basePt=null,G.m_value=null,G.m_retcall=null,G.m_retWhileCall=null,G.m_exitCall=null,G.m_resultDragStatus=L.MxJigCmdManager.DragStatus.kCancel,G.m_cursorType=D.MxUiVue.CursorType.kCross,G}s.MrxDbgUiPrPoint=T},{"../MxFun":27,"../MxManager":29,"../MxThreeJS":36,"../UI/MxUiVue":64,"./MrxDbgUiPrBase":44,"./MxJigCmdManager":53,three:19}],47:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxCmdRunManager=void 0;var o,v,u,w,L,U,N,D,f,P=b("../MxFun"),T=b("../MxType"),B=b("./MxJigCmdManager"),G=b("../UI/MxUiVue"),R=b("../MxDrawData");v=o||(s.MxCmdRunManager=o={}),u={},w=new Array,L=0,U=!1,N="",D={},f={},v.InitQuickCommand=function(_){if(_)if(_ instanceof Array)for(var ee=_.length,k=0;k<ee;k++){var E=_[k];if(!(E.length<2)){var W=E[0];if(W.length!=0)for(var C=E.length,F=1;F<C;F++)E[F].length!=0&&(D[E[F].toUpperCase()]=W)}}else console.log("Mx:QuickCommand data error,Not an array");else console.log("Mx:QuickCommand data error")},v.InitLanguageString=function(_){this.m_mapLanguageString=_},v.getLanguageString=function(_,ee){var k=f[_];return k===void 0&&(k=ee),k},v.MoveUpKey=function(){return U?++L>=w.length&&(L=0):U=!0,!0},v.MoveDownKey=function(){return!!U&&(--L<0&&(L=w.length-1),!0)},v.GetListCommad=function(){return L<0||L>=w.length?"":w[L]},v.ClearPrvCmd=function(){N=""},v.GetPrvCmd=function(){return N},v.SetPrvCmd=function(_){N=_},v.runCmd=function(_,ee,k){var E=ee.toUpperCase(),W=u[E];if(_&&W==null){var C=D[E];if(C!=null&&(W=u[C.toUpperCase()]),W==null)return G.MxUiVue.isNull()?console.log(P.MxFun.formatString('"{0}"',ee)):G.MxUiVue.acutPrintf(`"{0}"
:`,ee),!1}if(!W)return!1;_.endPanCommand();var F=w.indexOf(W.cmd);-1<F&&w.splice(F,1),U=!(L=0),w.push(W.cmd),!(W.flag&T.MxType.MxCommandFlag.MCRX_CMD_NO_RECORD_PRVCMD)&&(N=W.cmd);var M=W.fun;_&&!(W.flag&T.MxType.MxCommandFlag.MCRX_CMD_TRANSPARENT)&&G.MxUiVue.acutPrintf(`{0}
`,W.cmd),B.MxJigCmdManager.stopCmd(B.MxJigCmdManager.DetailedResult.kNewCommadIn),_.callEvent("commandWillStart",{cmd:W.cmd}),_.getMcObject().fireStartRunCommand(W.cmd,W.flag);var a=_.sysVariable().getSysVarNumber("GETPOINTSTATUS");if(a&=~B.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint,a&=~B.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastMovePoint,_.sysVariable().setSysVarNumber("GETPOINTSTATUS",a),_&&(W.flag&T.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT)==0){var h=!1,y=_.getMxAllSelect();if(_.getMxDatabase().getGripManager().removeAllGrips()&&(h=!0),_.getMxDatabase().getSelectManager().removeAllEntity()&&(h=!0),_.isValidMcObject()){var j=_.getMcObject().getGripManager().getAllSelect();_.getMcObject().getGripManager().setPrvCommandSelect(j),_.getMcObject().getGripManager().clearAll()&&(h=!0)}_.getMxDatabase().getSelectManager().setPrvCommandSelect(y),h&&(_.getMxDatabase().getGripManager().fireMxEntitySelectChange(),_.updateDisplay())}try{M(k)}catch(Y){console.log("mx: run cmd error"),console.log(Y)}return _.getMcObject().fireEndRunCommand(W.cmd,W.flag),_&&(B.MxJigCmdManager.isRunning()||G.MxUiVue.restoreCmdStatus(),_.updateDisplay(),R.MxDrawData.m_isAutoResetRenderer||_.resetRenderer()),!0},v.addCommand=function(_,ee,k){k==null&&(k=T.MxType.MxCommandFlag.MCRX_CMD_MODAL);var E=_.toUpperCase();u[E]={fun:ee,cmd:_,flag:k}}},{"../MxDrawData":22,"../MxFun":27,"../MxType":38,"../UI/MxUiVue":64,"./MxJigCmdManager":53}],48:[function(b,r,s){var o,v=this&&this.__extends||(o=function(C,F){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,a){M.__proto__=a}||function(M,a){for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(M[h]=a[h])})(C,F)},function(C,F){if(typeof F!="function"&&F!==null)throw new TypeError("Class extends value "+String(F)+" is not a constructor or null");function M(){this.constructor=C}o(C,F),C.prototype=F===null?Object.create(F):(M.prototype=F.prototype,new M)});Object.defineProperty(s,"__esModule",{value:!0}),s.MxDrawObjectOsnap=s.McDbLine=s.McDbCurve=s.McDbEntity=s.McDbType=void 0;var u,w,L=b("three"),U=b("../MxThreeJS"),N=b("../MxDrawData"),D=b("./MxJigCmdManager"),f=b("./McEdJigOsnap");(w=u||(s.McDbType=u={}))[w.kInValid=0]="kInValid",w[w.kLine=1]="kLine";var P=(T.prototype.getType=function(){return this.m_type},T);function T(){this.m_type=u.kInValid}s.McDbEntity=P;var B,G=(v(R,B=P),R);function R(){return B!==null&&B.apply(this,arguments)||this}s.McDbCurve=G;var _,ee=(v(k,_=G),k);function k(){var C=_.call(this)||this;return C.m_type=u.kLine,C}s.McDbLine=ee;var E=(W.prototype.getBlobHead=function(C,F){var M={};return M.type=C.getInt32(F,!0),F+=4,M.ver=C.getInt32(F,!0),F+=4,M.databaseIndex=C.getInt32(F,!0),F+=4,M.nOffset=F,M},W.prototype.clearData=function(){this.threejsObjects=new L.Object3D},W.prototype.calculateDistance=function(C,F,M){var a=new L.Vector3().subVectors(F,C),h=new L.Vector3().subVectors(M,C),y=a.clone().normalize(),j=h.clone().normalize(),Y=y.dot(j),q=new L.Vector3().subVectors(M,F),V=new L.Vector3().subVectors(C,F),ne=q.clone().normalize(),ie=V.clone().normalize();if(0<ne.dot(ie)&&0<Y){var he=Math.sqrt(1-Y*Y),be=C.distanceTo(M),je=be*he,xe=be*Y,Fe=a.clone().normalize().multiplyScalar(xe),J=C.clone().add(Fe),ge=a.clone().normalize().multiplyScalar(200+xe);return{pt1:C,pt2:F,pt:M,distance:je,targetPt:J,warningPt:C.clone().add(ge)}}return null},W.prototype.getOsnapData=function(C,F){if(this.threejsObjects){var M=new L.Raycaster,a=N.MxDrawData.m_dInputRectWidth;M.linePrecision=this.mxObj.screenCoordLong2World(a);var h=this.mxObj.getCanvas(),y=h.clientWidth,j=h.clientHeight,Y=this.mxObj.screenCoord2World(C.x,C.y);Y.z=0,C=new L.Vector2(C.x/y*2-1,-C.y/j*2+1),M.setFromCamera(C,this.mxObj.getCamera());var q=M.intersectObjects(this.threejsObjects.children,!0),V=this.mxObj.getSysVarLong("OSMODE"),ne=new Map;if(q.length)for(var ie=0;ie<q.length;ie++){var he=q[ie];if(he.object.userData&&he.object.userData.obj.getType()==u.kLine){var be=he.object.userData.obj;if(V&f.MxOsnapDefine.OsModeEnd){var je=Y.distanceTo(be.pt1);be.pt1.type=D.MxJigCmdManager.OsnapMode.kOsModeEnd,ne.set(je,be.pt1);var xe=Y.distanceTo(be.pt2);be.pt2.type=D.MxJigCmdManager.OsnapMode.kOsModeEnd,ne.set(xe,be.pt2)}if(V&f.MxOsnapDefine.OsModeNear&&(!be.bulge||be.bulge==0)){var Fe=this.calculateDistance(be.pt1,be.pt2,Y);Fe&&(Fe.targetPt.type=D.MxJigCmdManager.OsnapMode.kOsModeNear,ne.set(Fe.distance,Fe.targetPt))}}}if(ne.size){var J=this.mxObj.screenCoordLong2World(a),ge=Array.from(ne);ge.sort(function(oe,le){return oe[0]-le[0]}),ge[0][0]<J&&F(ge[0][1],ge[0][1].type)}}},W.prototype.mxWebEntitysData=function(C,F){var M=this.getBlobHead(C,0);C.getInt32(M.nOffset,!0),M.nOffset+=4;var a=C.getInt32(M.nOffset,!0);M.nOffset+=4;var h=C.getInt32(M.nOffset,!0);if(M.nOffset+=4,1<h)console.log("mx:error mxfun.js version is old!");else{var y=C.getInt32(M.nOffset,!0);if(M.nOffset+=4,y==M.nOffset){this.threejsObjects=new L.Object3D;for(var j=0;j<a;j++){var Y=C.getInt8(M.nOffset);M.nOffset+=1;var q=C.getInt32(M.nOffset,!0);if(M.nOffset+=4,Y==1){var V=C.getFloat32(M.nOffset,!0);M.nOffset+=4;var ne=C.getFloat32(M.nOffset,!0);M.nOffset+=4;var ie=C.getFloat32(M.nOffset,!0);M.nOffset+=4;var he=C.getFloat32(M.nOffset,!0);M.nOffset+=4,(le=new ee).pt1=new L.Vector3(V,ne,0),le.pt2=new L.Vector3(ie,he,0),(Re=U.MxThreeJS.createLine(le.pt1,le.pt2,16777215)).userData.obj=le,this.threejsObjects.add(Re)}else if(Y==2){var be=C.getInt8(M.nOffset);M.nOffset+=1;var je=C.getInt32(M.nOffset,!0);M.nOffset+=4;for(var xe=new L.Vector3,Fe=0,J=null,ge=0;ge<je;ge++){var oe=new L.Vector3;oe.x=C.getFloat32(M.nOffset,!0),M.nOffset+=4,oe.y=C.getFloat32(M.nOffset,!0),M.nOffset+=4;var le,Re,Ye=C.getFloat32(M.nOffset,!0);M.nOffset+=4,0<ge&&((le=new ee).pt1=xe.clone(),le.pt2=oe.clone(),le.bulge=Ye,(Re=U.MxThreeJS.createLine(le.pt1,le.pt2,16777215)).userData.obj=le,this.threejsObjects.add(Re)),xe=oe,Fe=Ye,ge==0&&(J=oe)}be&&2<je&&((le=new ee).pt1=J.clone(),le.pt2=xe.clone(),le.bulge=Fe,(Re=U.MxThreeJS.createLine(le.pt1,le.pt2,16777215)).userData.obj=le,this.threejsObjects.add(Re))}else console.log("mx:error mxWebEntitysData type"),M.nOffset=M.nOffset-5+q}}else console.log("mx: mxWebEntitysData size assert(0)")}},W);function W(C){this.threejsObjects=null,this.mxObj=null,this.mxObj=C}s.MxDrawObjectOsnap=E},{"../MxDrawData":22,"../MxThreeJS":36,"./McEdJigOsnap":42,"./MxJigCmdManager":53,three:19}],49:[function(b,r,s){var o,v=this&&this.__extends||(o=function(P,T){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(B,G){B.__proto__=G}||function(B,G){for(var R in G)Object.prototype.hasOwnProperty.call(G,R)&&(B[R]=G[R])})(P,T)},function(P,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function B(){this.constructor=P}o(P,T),P.prototype=T===null?Object.create(T):(B.prototype=T.prototype,new B)});Object.defineProperty(s,"__esModule",{value:!0}),s.MxEntSelJig=void 0;var u,w=b("./MxJig"),L=b("./MxJigCmdManager"),U=b("../UI/MxUiVue"),N=b("../MrxDbgUtils"),D=(v(f,u=w.McEdJigCommand),f.prototype.sampler=function(){var P=L.MxJigCmdManager.InType.kGetBegan,T=this.acquirePoint(P);return T.status==L.MxJigCmdManager.DragStatus.kNormal&&(this.point=T.pt),T.status},f.prototype.done=function(P){if(P==L.MxJigCmdManager.DragStatus.kNormal){var T=this;N.MrxDbgUtils.findEntAtPoint(this.getMxObject(),this.point,this.filter).then(function(B){T.callRet(B)})}else this.callRet([]);return L.MxJigCmdManager.DoneStatius.kExitCommand},f.prototype.onStartCommand=function(){U.MxUiVue.setCursorType(U.MxUiVue.CursorType.kRect),u.prototype.onStartCommand.call(this)},f.prototype.onExitCommand=function(){U.MxUiVue.setCursorType(U.MxUiVue.CursorType.kNormal),L.MxJigCmdManager.isWaitCmdNull()&&U.MxUiVue.restoreCmdStatus(),u.prototype.onExitCommand.call(this,!0)},f.prototype.upDisplay=function(){},f);function f(){return u!==null&&u.apply(this,arguments)||this}s.MxEntSelJig=D},{"../MrxDbgUtils":20,"../UI/MxUiVue":64,"./MxJig":52,"./MxJigCmdManager":53}],50:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxGridTrace=void 0;var o=b("three"),v=b("./MxJigCmdManager"),u=b("../MxFun"),w=b("../MxDrawData"),L=b("../MxThreeJS"),U=(N.prototype.ClearDynDrawEntity=function(){for(var D=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),f=this.m_vecDynDrawEntity.length,P=0;P<f;P++)u.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[P],D);this.m_vecDynDrawEntity=[]},N.prototype.GetSanpValue=function(D,f){var P=D%f;return 0<=P?f/2<P?D+=f-P:D-=P:f/2<(P=Math.abs(P))?D-=f-P:D+=P,D},N.prototype.CreteTracePoint=function(D,f){var P=this.m_mxJig.getMxObject(),T=P.getTheTempDrawContainer_SmallCoord();f/=2;var B=L.MxThreeJS.createLine(P.toSmallcoord2(D.x+f,D.y+f,0),P.toSmallcoord2(D.x-f,D.y-f,0),16711680);T.add(B),this.m_vecDynDrawEntity.push(B);var G=L.MxThreeJS.createLine(P.toSmallcoord2(D.x-f,D.y+f,0),P.toSmallcoord2(D.x+f,D.y-f,0),16711680);T.add(G),this.m_vecDynDrawEntity.push(G)},N.prototype.MouseMove=function(D){var f=this.m_mxJig.getMxObject();if(f.getMcObject().isValid()){if(this.ClearDynDrawEntity(),this.m_isValidTracePoint=!1,this.m_isTrace){var P=f.getSysVarPoint("SNAPUNIT");if(!(P.x<1e-6||P.y<1e-6)){D.z=0;var T=new o.Vector3;T.x=this.GetSanpValue(D.x,P.x),T.y=this.GetSanpValue(D.y,P.y);var B=f.viewCoordLong2Cad(w.MxDrawData.m_dInputRectWidth),G=2*B;T.distanceTo(D)<G&&(this.m_isValidTracePoint=!0,this.m_ptTracePoint=T,this.CreteTracePoint(T,B))}}}else this.m_isTrace=!1},N.prototype.Init=function(){var D=this.m_mxJig.getMxObject();D.getMcObject().isValid()?(this.m_isValidTracePoint=!1,this.m_isTrace=!1,D.getSysVarLong("GRIDMODE")!=0&&(this.m_isTrace=!0),D.sysVariable().getSysVarNumber("GETPOINTSTATUS")&v.MxJigCmdManager.GETPOINTSTATUS.OsModeGridSnapTempDisable&&(this.m_isTrace=!1),this.m_mxJig.isDisableGridTrace()&&(this.m_isTrace=!1),this.m_isTrace):this.m_isTrace=!1},N.prototype.GetTracePoint=function(){if(this.m_isTrace)return this.m_isValidTracePoint?this.m_ptTracePoint:void 0},N.prototype.ClearDisplay=function(){this.ClearDynDrawEntity()},N.prototype.ReSetTempDisplay=function(){this.ClearDynDrawEntity(),this.m_isValidTracePoint=!1},N);function N(D){this.m_vecDynDrawEntity=[],this.m_ptTracePoint=new o.Vector3,this.m_isValidTracePoint=!1,this.m_isTrace=!1,this.m_mxJig=null,this.m_mxJig=D}s.MxGridTrace=U},{"../MxDrawData":22,"../MxFun":27,"../MxThreeJS":36,"./MxJigCmdManager":53,three:19}],51:[function(b,r,s){var o,v=this&&this.__extends||(o=function(P,T){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(B,G){B.__proto__=G}||function(B,G){for(var R in G)Object.prototype.hasOwnProperty.call(G,R)&&(B[R]=G[R])})(P,T)},function(P,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function B(){this.constructor=P}o(P,T),P.prototype=T===null?Object.create(T):(B.prototype=T.prototype,new B)});Object.defineProperty(s,"__esModule",{value:!0}),s.MxIntelliSelectJig=void 0;var u,w=b("three"),L=b("./MxJig"),U=b("./MxJigCmdManager"),N=b("../MxThreeJS"),D=(v(f,u=L.McEdJigCommand),f.prototype.sampler=function(){var P=U.MxJigCmdManager.InType.kGetBegan,T=this.acquirePoint(P);return T.status==U.MxJigCmdManager.DragStatus.kNormal&&(this.m_pt2=T.pt),T.status},f.prototype.getTypeName=function(){return"MxIntelliSelect"},f.prototype.done=function(P){if(P==U.MxJigCmdManager.DragStatus.kNormal){var T=this.getMxObject();T.getMxDatabase().getGripManager().doWindowsSelect(this.m_pt1,this.m_pt2),T.getMcObject().getGripManager().doRangeSelect(this.m_pt1,this.m_pt2)}return U.MxJigCmdManager.DoneStatius.kExitCommand},f.prototype.doPointSelect=function(P,T,B){var G=P.viewCoordLong2Cad(16),R={x:T.x,y:T.y,tol:G};P.callCommand("MxCAD_IntelliSelect_Point",JSON.stringify(R),function(_){B(_)})},f.prototype.upDisplay=function(){var P=new w.Vector3(this.m_pt1.x,this.m_pt2.y,this.m_pt2.z),T=new w.Vector3(this.m_pt2.x,this.m_pt1.y,this.m_pt2.z),B=[];B.push(this.m_pt1),B.push(P),B.push(this.m_pt2),B.push(T),B.push(this.m_pt1);var G=null,R=65280;if(this.m_pt2.x>this.m_pt1.x)G=N.MxThreeJS.createLines(B,16777215),R=255;else{var _=this.getMxObject().viewCoordLong2Cad(3);G=N.MxThreeJS.createDashedLines(B,16777215,2*_,_)}var ee=[];ee.push(this.m_pt1),ee.push(P),ee.push(this.m_pt2),ee.push(this.m_pt1),ee.push(this.m_pt2),ee.push(T);var k=N.MxThreeJS.createTriangle(ee,R,.27);this.drawEntity(k,30),this.drawEntity(G,31)},f);function f(P){var T=u.call(this)||this;return T.m_pt1=P,T.m_pt2=P,T}s.MxIntelliSelectJig=D},{"../MxThreeJS":36,"./MxJig":52,"./MxJigCmdManager":53,three:19}],52:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.McEdJigCommand=s.MxDynamicInput=void 0;var o=b("three"),v=b("../MxFun"),u=b("./MxJigCmdManager"),w=b("../MxManager"),L=b("../MxTools"),U=b("../UI/MxUiVue"),N=b("./McEdJigOsnap"),D=b("./McEdJigDynamicTrace"),f=b("./MxPolarAxisTrace"),P=b("./MxGridTrace"),T=b("../MxThreeJS"),B=b("../MxDrawData"),G=b("./MxOffsetArrow"),R=(_.prototype.getFocusIndex=function(){return this.m_isShowDynInput?this.m_iFocusIndex:-1},_.prototype.ClearDynDrawEntity=function(){for(var E=this.m_jig.getMxObject().getTheTempDrawContainer_SmallCoord(),W=this.m_vecDynDrawEntity.length,C=0;C<W;C++)v.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[C],E);this.m_vecDynDrawEntity=[]},_.prototype.ClearDisplay=function(){this.ClearDynDrawEntity()},_.prototype.onKeyEcsDown=function(){return this.m_isShowDynInput&&this.m_isInputStatus?(this.m_isInputStatus=!1,U.MxUiVue.OnMxEvent({name:"dynInputReSet"}),1):0},_.prototype.onKeyDonw=function(E){if(!this.m_isShowDynInput||E==27||E==16||E==17||E==18)return 0;if(E!=32&&E!=13)return this.m_isInputStatus=!0,0;if(this.m_isInputStatus&&U.MxUiVue.DynamicInput_isShow())if(U.MxUiVue.DynamicInput_getType()==u.MxJigCmdManager.DynamicInputType.kXYCoordInput){var W=U.MxUiVue.DynamicInput_getValue1(),C=U.MxUiVue.DynamicInput_getValue2(),F=U.MxUiVue.DynamicInput_getFocusValue(),M=U.MxUiVue.DynamicInput_getFocusIndex(),a="";F.length!=0?a=L.MxTools.IsNumerical(F)?M==0?v.MxFun.formatString("{0},{1}",F,C):v.MxFun.formatString("{0},{1}",W,F):F:L.MxTools.IsNumerical(W)&&L.MxTools.IsNumerical(C)&&(a=v.MxFun.formatString("{0},{1}",W,C)),this.m_iFocusIndex=M,U.MxUiVue.setCmdText(a)}else U.MxUiVue.DynamicInput_getType()==u.MxJigCmdManager.DynamicInputType.kDistanceInput&&(F=U.MxUiVue.DynamicInput_getFocusValue(),this.m_iFocusIndex=U.MxUiVue.DynamicInput_getFocusIndex(),U.MxUiVue.setCmdText(F));return this.m_isInputStatus=!1,0},_.prototype.isInputStatus=function(){return this.m_isInputStatus},_.prototype.isTruncatedInput=function(){return this.m_isShowDynInput&&this.m_isInputStatus},_.prototype.initDynInput=function(E){this.m_jig=E;var W=this.m_jig.getMxObject();if(this.m_iFocusIndex=-1,this.m_isShowDynInput=!1,!U.MxUiVue.isNull()){U.MxUiVue.DynamicInput_setType(this.m_dynType);var C=W.sysVariable().getSysVarNumber("GETPOINTSTATUS");C&u.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint&&U.MxUiVue.SetLasetPoint(W.sysVariable().getSysVarPoint("LASTPOINT")),this.m_dynType==u.MxJigCmdManager.DynamicInputType.kAutoInput&&(C&u.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint?U.MxUiVue.DynamicInput_setType(u.MxJigCmdManager.DynamicInputType.kDistanceInput):U.MxUiVue.DynamicInput_setType(u.MxJigCmdManager.DynamicInputType.kXYCoordInput))}},_.prototype.setFocus=function(E){U.MxUiVue.OnMxEvent({name:"dynInputSetFocus",param:{isFocus:E}})},_.prototype.exitDynInput=function(){U.MxUiVue.DynamicInput_setShow(!1),U.MxUiVue.DynamicInput_upDisplay()},_.prototype.isShow=function(){return U.MxUiVue.DynamicInput_isShow()},_.prototype.drawSolidPoint=function(E,W,C,F){var M=T.MxThreeJS.createPoint(F.toSmallcoord(E),this.m_iDashedLineLenColor,W);C.add(M),this.m_vecDynDrawEntity.push(M)},_.prototype.drawDashedLine=function(E,W,C,F,M,a){var h=T.MxThreeJS.createDashedLine(a.toSmallcoord2(E.x,E.y,E.z),a.toSmallcoord2(W.x,W.y,W.z),this.m_iDashedLineLenColor,F,F);C.add(h),this.m_vecDynDrawEntity.push(h)},_.prototype.worldDrawDistanceInput=function(E,W){var C=this.m_jig.getMxObject();if(C.getMcObject().isValid()&&((E=E.clone()).z=0,(W=W.clone()).z=0,!(C.docCoordLong2Screen(E.distanceTo(W))<20))){var F=C.getTheTempDrawContainer_SmallCoord(),M=C.viewCoordLong2Cad(this.m_dashedLineLen),a=E.clone().sub(W),h=a.clone();h.applyAxisAngle(new o.Vector3(0,0,1),.5*Math.PI),h.normalize(),h.multiplyScalar(C.viewCoordLong2Cad(50));var y=new o.Vector3(0,1,0),j=new o.Vector3(1,0,0);h.dot(y)<0&&h.multiplyScalar(-1),a.dot(y)<0&&h.multiplyScalar(-1),a.dot(j)<0&&h.multiplyScalar(-1);var Y=W.clone().add(h),q=E.clone().add(h),V=W.distanceTo(E),ne=new o.Vector3(W.x+V,W.y,W.z);this.drawSolidPoint(W.clone().add(h),3,F,C),this.drawSolidPoint(E.clone().add(h),3,F,C),this.drawSolidPoint(ne,3,F,C),this.drawDashedLine(Y,q,F,M,M,C),this.drawDashedLine(W,Y,F,M,M,C),this.drawDashedLine(E,q,F,M,M,C),this.drawDashedLine(W,ne,F,M,M,C);var ie=E.clone().sub(W),he=0;1e-6<ie.length()&&(he=ie.angleTo(new o.Vector3(1,0,0)));var be=0,je=he;ie.dot(y)<0&&(be=2*Math.PI-he,je=he);var xe=T.MxThreeJS.createDashedArc(C.toSmallcoord(W),V,be,je,this.m_iDashedLineLenColor,M,M);F.add(xe),this.m_vecDynDrawEntity.push(xe)}},_.prototype.upDynInput=function(){if(!U.MxUiVue.isNull()){var E=this.m_jig.getMxObject(),W=!1;if(W=!this.m_jig.isDisableDynInput()&&E.getSysVarLong("DYNINPUT")==1,B.MxDrawData.m_isForbiddenDynInput&&(W=!1),v.MxFun.isPC()||(W=!1),U.MxUiVue.DynamicInput_setShow(W),this.m_isShowDynInput=W){if(U.MxUiVue.DynamicInput_setTip(U.MxUiVue.getCmdTip()),u.MxJigCmdManager.getAcquireStatus()==u.MxJigCmdManager.AcquireStatus.kMove){var C=u.MxJigCmdManager.getAcquirePoint();if(U.MxUiVue.DynamicInput_setPos(E.currentCoord2Screen(C.x,C.y,C.z)),U.MxUiVue.DynamicInput_getType()==u.MxJigCmdManager.DynamicInputType.kXYCoordInput)U.MxUiVue.DynamicInput_setValue1(C.x.toFixed(3)),U.MxUiVue.DynamicInput_setValue2(C.y.toFixed(3));else if(U.MxUiVue.DynamicInput_getType()==u.MxJigCmdManager.DynamicInputType.kDistanceInput){var F=u.MxJigCmdManager.getAcquirePoint(),M=U.MxUiVue.GetLasetPoint();this.worldDrawDistanceInput(F,M);var a=new o.Vector3(M.x+.5*(F.x-M.x),M.y+.5*(F.y-M.y),M.z+.5*(F.z-M.z)),h=F.clone().sub(M);h.length()<1e-8&&(h=new o.Vector3(1,0,0));var y=h.clone();y.applyAxisAngle(new o.Vector3(0,0,1),.5*Math.PI),y.normalize(),y.multiplyScalar(E.viewCoordLong2Cad(50));var j=new o.Vector3(0,1,0),Y=new o.Vector3(1,0,0);y.dot(j)<0&&y.multiplyScalar(-1),h.dot(j)<0&&y.multiplyScalar(-1),h.dot(Y)<0&&y.multiplyScalar(-1),a.add(y);var q=M.distanceTo(F);U.MxUiVue.DynamicInput_setValue1(q.toFixed(3)),U.MxUiVue.DynamicInput_setValue1Pos(E.currentCoord2Screen(a.x,a.y,C.z)),q=M.distanceTo(F);var V=M.clone();V.x+=q;var ne=(a=new o.Vector3(V.x+.5*(F.x-V.x),V.y+.5*(F.y-V.y),V.z+.5*(F.z-V.z))).clone().sub(M);ne.normalize(),ne.multiplyScalar(q),a=M.clone().add(ne);var ie=F.clone().sub(M),he=0;1e-6<ie.length()&&(he=ie.angleTo(new o.Vector3(1,0,0))),he=180*he/Math.PI,U.MxUiVue.DynamicInput_setValue2(he.toFixed(3)+""),U.MxUiVue.DynamicInput_setValue2Pos(E.currentCoord2Screen(a.x,a.y,C.z))}}U.MxUiVue.DynamicInput_upDisplay()}}},_.prototype.setDynamicInputType=function(E){this.m_dynType=E},_.prototype.getDynamicInputType=function(){return this.m_dynType},_);function _(E){this.m_dynType=u.MxJigCmdManager.DynamicInputType.kAutoInput,this.m_isInputStatus=!1,this.m_vecDynDrawEntity=[],this.m_dashedLineLen=1.5,this.m_iDashedLineLenColor=8421504,this.m_iFocusIndex=-1,this.m_isShowDynInput=!1,this.m_jig=E}s.MxDynamicInput=R;var ee=(k.prototype.getTypeName=function(){return""},k.prototype.isExit=function(){return this._isExit},k.prototype.getDetailedResult=function(){return this.m_DetailedResult},k.prototype.getParentGroup=function(){return this.drawGroup||(this.drawGroup=new o.Group,this.drawGroup.renderOrder=w.MxData.iGripRenderOrder,this._mxObject.getTheTempDrawContainer().add(this.drawGroup)),this.drawGroup},k.prototype.getParentGroup_smallCoord=function(){return this.drawGroup_smallCoord||(this.drawGroup_smallCoord=new o.Group,this.drawGroup_smallCoord.renderOrder=w.MxData.iGripRenderOrder,this._mxObject.getTheTempDrawContainer_SmallCoord().add(this.drawGroup_smallCoord)),this.drawGroup_smallCoord},k.prototype.onExitCommand=function(E){E&&this.m_dynInput.exitDynInput(),this.m_osnap.endDrag(),this.m_dynamicTrace.ClearDisplay(),this.m_polarAxisTrace.ClearDisplay(),this.m_offsetArrow.ClearDisplay(),this.m_gridTrace.ClearDisplay(),this.m_dynInput.ClearDisplay(),this._mxObject.getMcObject().onJigCommandEnd()},k.prototype.getOsnap=function(){return this.m_osnap},k.prototype.getOrtho=function(){return this.m_ortho},k.prototype.getDynamicTrace=function(){return this.m_dynamicTrace},k.prototype.getPolarAxisTrace=function(){return this.m_polarAxisTrace},k.prototype.getOffsetArrow=function(){return this.m_offsetArrow},k.prototype.getGridTrace=function(){return this.m_gridTrace},k.prototype.onGetOsnapData=function(E){this.m_dynamicTrace.OnDynamicTrace(E.id,new o.Vector3(E.ptsx,E.ptsy,E.ptsz),E.osmode)},k.prototype.isDisableDynInput=function(){return this.m_isDisableDynInput},k.prototype.setDisableDynInput=function(E){this.m_isDisableDynInput=E},k.prototype.setDisableOsnap=function(E){this.m_isDisableOsnap=E},k.prototype.setOffsetInputPostion=function(E){this.m_isOffsetInputPostion=E},k.prototype.isOffsetInputPostion=function(){return this.m_isOffsetInputPostion},k.prototype.isDisableOsnap=function(){return this.m_isDisableOsnap},k.prototype.setDisableDynamicTrace=function(E){this.m_isDisableDynamicTrace=E},k.prototype.isDisableDynamicTrace=function(){return this.m_isDisableDynamicTrace},k.prototype.setDisablePolarAxisTrace=function(E){this.m_isDisablePolarAxisTrace=E},k.prototype.isDisablePolarAxisTrace=function(){return this.m_isDisablePolarAxisTrace},k.prototype.setDisableGridTrace=function(E){this.m_isDisableGridTrace=E},k.prototype.isDisableGridTrace=function(){return this.m_isDisableGridTrace},k.prototype.setDisableOrthoTrace=function(E){this.m_isDisableOrtho=E},k.prototype.isDisableOrthoTrace=function(){return this.m_isDisableOrtho},k.prototype.disableAllTrace=function(E){E===void 0&&(E=!0),this.m_isDisableOsnap=E,this.m_isDisableDynamicTrace=E,this.m_isDisablePolarAxisTrace=E,this.m_isDisableGridTrace=E,this.m_isDisableOrtho=E},k.prototype.onStartCommand=function(){this._isCancle=!1,this._isExit=!1,this.m_DetailedResult=u.MxJigCmdManager.DetailedResult.kUnknown,this.m_dynInput.initDynInput(this),this.m_osnap.startDrag(this.m_isOffsetInputPostion,this);var E=this._mxObject.getCurrentMousePostion();this._mxObject.isValidCurMousePostion()||(E.x=.5*this._mxObject.getViewWidth(),E.y=.5*this._mxObject.getViewHeight());var W=this._mxObject.screenCoord2Current(E.x,E.y,0);this.m_osnap.setPoint(W),this.m_dynamicTrace.Init(),this.m_polarAxisTrace.Init(),this.m_offsetArrow.Init(),this.m_gridTrace.Init(),this.m_ortho.Init(),u.MxJigCmdManager.doMouseMoveImp(),this.m_dynInput.setFocus(!0)},k.prototype.getDynImput=function(){return this.m_dynInput},k.prototype.setMxObject=function(E){this._mxObject=E},k.prototype.getMxObject=function(){return this._mxObject},k.prototype.setColor=function(E){this._iColor=E},k.prototype.getColor=function(){return this._iColor},k.prototype.setDynamicInputType=function(E){this.m_dynInput.setDynamicInputType(E)},k.prototype.getDynamicInputType=function(){return this.m_dynInput.getDynamicInputType()},k.prototype.createTriangle=function(E,W,C){var F=new o.MeshBasicMaterial({color:this._iColor,side:o.DoubleSide}),M=new o.Geometry;M.vertices.push(E),M.vertices.push(W),M.vertices.push(C);var a=new o.Vector3(1,1,1),h=new o.Color(this._iColor),y=new o.Face3(0,1,2,a,h,0);return M.faces.push(y),M.computeFaceNormals(),M.computeVertexNormals(),new o.Mesh(M,F)},k.prototype.createPoint=function(E){var W=new o.Geometry;W.vertices.push(E);var C=new o.PointsMaterial({color:this._iColor,size:3});return new o.Points(W,C)},k.prototype.createLine=function(E,W){var C=new o.Geometry,F=new o.LineBasicMaterial({color:this._iColor});return C.vertices.push(E,W),new o.Line(C,F)},k.prototype.drawReserve=function(E){this.m_isReserveDrawStatus=!0,this.m_callReserveDrawAddEntity=E,this.upDisplay(),this.m_isReserveDrawStatus=!1,this.m_callReserveDrawAddEntity=null},k.prototype.drawMcDbEntity=function(E,W,C){this.m_isReserveDrawStatus?this._mxObject.getMcObject().DrawEntity(E.getImp(),W,C):this._mxObject.getMcObject().onJigDrawEntityDisplay(E.getImp(),W,C)},k.prototype.drawMcDbLine=function(E,W,C,F,M,a,h){this.m_isReserveDrawStatus?this._mxObject.getMcObject().DrawLine(E,W,C,F,M,a,h):this._mxObject.getMcObject().onJigDrawEntityDisplay_line(E,W,C,F,M,a,h)},k.prototype.drawEntity=function(E,W,C){if(C===void 0&&(C=!1),E!=null)if(this.m_isReserveDrawStatus)E.renderOrder=W??w.MxData.iDynJigRenderOrder,this._mxObject.addObject(E),this.m_callReserveDrawAddEntity&&this.m_callReserveDrawAddEntity(E);else{var F="MxDynDraw_"+this._DynNameId.toString();E.name=F,E.renderOrder=W??w.MxData.iDynJigRenderOrder,this._aryDynDrawObjectNamesId==null&&(this._aryDynDrawObjectNamesId=new Array),this._aryDynDrawObjectNamesId.push(this._DynNameId),this._DynNameId++,C?this.getParentGroup_smallCoord().add(E):this.getParentGroup().add(E)}},k.prototype.floorPowerOfTwo=function(E){return Math.pow(2,Math.floor(Math.log(E)/Math.LN2))},k.prototype.makeTextSprite=function(E,W,C,F,M){var a,h=document.createElement("canvas"),y=h.getContext("2d"),j=v.MxFun.formatString("normal {0}px Arial","256");y.font=j;var Y=y.measureText(E);a=2*this.floorPowerOfTwo(Y.width),h.width=a,h.height=256,y.font=j,y.textAlign="center",y.textBaseline="middle";var q=v.MxFun.formatString("#{0}",M.toString(16));y.fillStyle=q,y.fillText(E,a/2,128);var V=new o.Texture(h);V.needsUpdate=!0;var ne=new o.SpriteMaterial({map:V});ne.transparent=!1,ne.rotation=F;var ie=new o.Sprite(ne);return ie.scale.set(a/256*C,C,1),ie.position.set(W.x,W.y,0),ie},k.prototype.drawText=function(E,W,C,F){var M=this.makeTextSprite(E,F,W,C,this._iColor);this.drawEntity(M)},k.prototype.drawPoints=function(E){for(var W=0;W<E.length;W++){var C=new o.Geometry;C.vertices.push(E[W]);var F=new o.PointsMaterial({color:this._iColor,size:3}),M=new o.Points(C,F);this.drawEntity(M)}},k.prototype.drawPoint=function(E){var W=new o.Geometry;W.vertices.push(E);var C=new o.PointsMaterial({color:this._iColor,size:3}),F=new o.Points(W,C);this.drawEntity(F)},k.prototype.drawPolyline=function(E){for(var W=new o.Geometry,C=0;C<E.length;C++)W.vertices.push(E[C]);var F=new o.LineBasicMaterial({color:this._iColor}),M=new o.Line(W,F);this.drawEntity(M)},k.prototype.drawSpline=function(E){},k.prototype.drawCircle=function(E,W){var C=new o.CircleGeometry(W,64,3,2*Math.PI),F=new o.LineBasicMaterial({color:this._iColor});C.vertices.shift();var M=new o.LineLoop(C,F);M.position.x=E.x,M.position.y=E.y,M.position.z=E.z,this.drawEntity(M)},k.prototype.drawArc=function(E,W,C,F){var M=new o.CircleGeometry(W,64,C,F),a=new o.LineBasicMaterial({color:this._iColor});M.vertices.shift();var h=new o.Line(M,a);h.position.x=E.x,h.position.y=E.y,h.position.z=E.z,this.drawEntity(h)},k.prototype.drawLine=function(E,W){var C=new o.Geometry,F=new o.LineBasicMaterial({color:this._iColor});C.vertices.push(E,W);var M=new o.Line(C,F);this.drawEntity(M)},k.prototype.removeDynDrawObject=function(){if(this._aryDynDrawObjectNamesId!=null){for(var E=0;E<this._aryDynDrawObjectNamesId.length;E++){var W,C="MxDynDraw_"+this._aryDynDrawObjectNamesId[E].toString();(W=this.getParentGroup().getObjectByName(C))?v.MxFun.removeThreejsObject(W,this.getParentGroup()):(W=this.getParentGroup_smallCoord().getObjectByName(C))&&v.MxFun.removeThreejsObject(W,this.getParentGroup_smallCoord())}this._aryDynDrawObjectNamesId=[],this._mxObject.getMcObject().onJigClearDisplay()}},k.prototype.acquirePoint=function(E,W){W===void 0&&(W=!0);var C=u.MxJigCmdManager.acquirePoint(E,W);return this._isExit=C.exit,this._isExit&&(this.m_DetailedResult=C.DetailedResult),C},k.prototype.acquireDist=function(E,W){var C=u.MxJigCmdManager.acquireDist(E,W);return this._isExit=C.exit,this._isExit&&(this.m_DetailedResult=C.DetailedResult),C},k.prototype.acquireAngle=function(E,W){var C=u.MxJigCmdManager.acquireAngle(E,W);return this._isExit=C.exit,this._isExit&&(this.m_DetailedResult=C.DetailedResult),C},k.prototype.acquireInt=function(){var E=u.MxJigCmdManager.acquireInt();return this._isExit=E.exit,this._isExit&&(this.m_DetailedResult=E.DetailedResult),E},k.prototype.acquireString=function(){var E=u.MxJigCmdManager.acquireString();return this._isExit=E.exit,this._isExit&&(this.m_DetailedResult=E.DetailedResult),E},k.prototype.acquireKeyword=function(){var E=u.MxJigCmdManager.acquireKeyword();return this._isExit=E.exit,this._isExit&&(this.m_DetailedResult=E.DetailedResult),E},k.prototype.notifyCancleExit=function(E){this.m_DetailedResult=E,this._isCancle=!0,this.removeDynDrawObject(),this.done(u.MxJigCmdManager.DragStatus.kCancel),this.onExitCommand(!0),u.MxJigCmdManager.commandRunComplete(this)},k.prototype.notifySampler=function(){var E=this.sampler();if(this.m_dynInput.upDynInput(),E==u.MxJigCmdManager.DragStatus.kNormal&&(this.removeDynDrawObject(),this.upDisplay()),this._isExit){var W=this.done(E);this._isCancle||(W==u.MxJigCmdManager.DoneStatius.kContinueCommand?(this._isExit=!1,u.MxJigCmdManager.doMouseMoveImp(),U.MxUiVue.OnMxEvent({name:"dynInputReSet"})):(this.removeDynDrawObject(),u.MxJigCmdManager.commandRunComplete(this),this.onExitCommand(!0)))}this._mxObject.updateDisplay()},k.prototype.getCurrentMouseButton=function(){return u.MxJigCmdManager.getCurrentMouseButton()},k.prototype.userInputControls=function(){return this._userInputContros},k.prototype.setUserInputControls=function(E){this._userInputContros=E},k.prototype.abort=function(E){u.MxJigCmdManager.stopCmd(E)},k);function k(){this._isExit=!1,this._aryDynDrawObjectNamesId=void 0,this._DynNameId=1,this._iColor=16777215,this._isCancle=!1,this.m_isDisableDynInput=!1,this.m_isDisableOsnap=!1,this.m_isDisableDynamicTrace=!1,this.m_isDisablePolarAxisTrace=!1,this.m_isDisableGridTrace=!1,this.m_isDisableOrtho=!1,this.m_dynInput=new R(this),this.m_dynamicTrace=new D.McEdJigDynamicTrace(this),this.m_polarAxisTrace=new f.MxPolarAxisTrace(this),this.m_offsetArrow=new G.MxOffsetArrow(this),this.m_gridTrace=new P.MxGridTrace(this),this.m_osnap=new N.McEdJigOsnap(this),this.m_ortho=new N.McEdJigOrtho(this),this._userInputContros=u.MxJigCmdManager.UserInputControls.kNullResponseAccepted,this.m_isOffsetInputPostion=!1,this.m_isReserveDrawStatus=!1,this.m_callReserveDrawAddEntity=null,this.drawGroup=null,this.drawGroup_smallCoord=null,this._mxObject=null,this.m_DetailedResult=u.MxJigCmdManager.DetailedResult.kUnknown}s.McEdJigCommand=ee},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxThreeJS":36,"../MxTools":37,"../UI/MxUiVue":64,"./McEdJigDynamicTrace":41,"./McEdJigOsnap":42,"./MxGridTrace":50,"./MxJigCmdManager":53,"./MxOffsetArrow":55,"./MxPolarAxisTrace":56,three:19}],53:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxJigCmdManager=s.AcquireReturn=void 0;var o,v=b("three"),u=b("../MxFun"),w=b("./MxJig"),L=b("../MxManager"),U=b("./MrxDbgUiPrPoint"),N=b("./MrxDbgUiPrBase"),D=b("../UI/MxUiVue"),f=b("../MxTools"),P=b("../MxString"),T=b("./McEdJigOsnap"),B=b("../MxDrawData"),G=b("./MrxDbgUiPrDist"),R=function(){this.status=o.DragStatus.kNoChange,this.exit=!0,this.DetailedResult=o.DetailedResult.kUnknown,this.sKeyValue="",this.dist=0,this.iVal=0,this.sValue="",this.ang=0};s.AcquireReturn=R,function(_){var ee,k,E,W,C,F,M,a,h,y,j,Y,q,V,ne,ie,he,be,je,xe;(k=ee=_.UserInputControls||(_.UserInputControls={}))[k.kGovernedByOrthoMode=1]="kGovernedByOrthoMode",k[k.kNullResponseAccepted=2]="kNullResponseAccepted",k[k.kDontEchoCancelForCtrlC=4]="kDontEchoCancelForCtrlC",k[k.kDontUpdateLastPoint=8]="kDontUpdateLastPoint",k[k.kNoDwgLimitsChecking=16]="kNoDwgLimitsChecking",k[k.kNoZeroResponseAccepted=32]="kNoZeroResponseAccepted",k[k.kNoNegativeResponseAccepted=64]="kNoNegativeResponseAccepted",k[k.kAccept3dCoordinates=128]="kAccept3dCoordinates",k[k.kAcceptMouseUpAsPoint=256]="kAcceptMouseUpAsPoint",k[k.kAnyBlankTerminatesInput=512]="kAnyBlankTerminatesInput",k[k.kInitialBlankTerminatesInput=1024]="kInitialBlankTerminatesInput",k[k.kAcceptOtherInputString=2048]="kAcceptOtherInputString",k[k.kGovernedByUCSDetect=4096]="kGovernedByUCSDetect",k[k.kNoZDirectionOrtho=8192]="kNoZDirectionOrtho",k[k.kSpacesInAccepted=16384]="kSpacesInAccepted",(W=E=_.AcquireStatus||(_.AcquireStatus={}))[W.kNoChange=0]="kNoChange",W[W.kMove=1]="kMove",W[W.kBegan=2]="kBegan",W[W.kEnd=3]="kEnd",W[W.kMouseUp=4]="kMouseUp",W[W.kMouseDown=5]="kMouseDown",W[W.kCancle=6]="kCancle",(F=C=_.DragStatus||(_.DragStatus={}))[F.kNoChange=-6]="kNoChange",F[F.kCancel=-4]="kCancel",F[F.kOther=-3]="kOther",F[F.kNull=-1]="kNull",F[F.kNormal=0]="kNormal",F[F.kKW1=1]="kKW1",(a=M=_.DetailedResult||(_.DetailedResult={}))[a.kUnknown=1]="kUnknown",a[a.kTouchDownIn=2]="kTouchDownIn",a[a.kTouchUpIn=3]="kTouchUpIn",a[a.kMouseLeftIn=4]="kMouseLeftIn",a[a.kMouseLeftUpIn=5]="kMouseLeftUpIn",a[a.kMouseRightIn=6]="kMouseRightIn",a[a.kKeyIn=7]="kKeyIn",a[a.kCoordIn=8]="kCoordIn",a[a.kNullEnterIn=9]="kNullEnterIn",a[a.kNullSpaceIn=10]="kNullSpaceIn",a[a.kEcsIn=11]="kEcsIn",a[a.kNewCommadIn=12]="kNewCommadIn",(h=_.DoneStatius||(_.DoneStatius={}))[h.kContinueCommand=0]="kContinueCommand",h[h.kExitCommand=1]="kExitCommand",(j=y=_.InType||(_.InType={}))[j.kGetBegan=1]="kGetBegan",j[j.kGetEnd=2]="kGetEnd",(q=Y=_.MouseButton||(_.MouseButton={}))[q.kInvalid=-1]="kInvalid",q[q.kLeft=0]="kLeft",q[q.kMid=1]="kMid",q[q.kRight=2]="kRight",(ne=V=_.COMMAND_IN||(_.COMMAND_IN={}))[ne.COMMAND_IN_NO_ENTITY=0]="COMMAND_IN_NO_ENTITY",ne[ne.COMMAND_IN_EMTPY=1]="COMMAND_IN_EMTPY",ne[ne.COMMAND_IN_KEY=2]="COMMAND_IN_KEY",ne[ne.COMMAND_IN_STRING=3]="COMMAND_IN_STRING",ne[ne.COMMAND_IN_COORD=5]="COMMAND_IN_COORD",ne[ne.COMMAND_IN_DIST=6]="COMMAND_IN_DIST",ne[ne.COMMAND_IN_INVALID=7]="COMMAND_IN_INVALID",ne[ne.COMMAND_IN_INVALID_ZERO=8]="COMMAND_IN_INVALID_ZERO",ne[ne.COMMAND_IN_INVALID_NEG=9]="COMMAND_IN_INVALID_NEG",ne[ne.COMMAND_IN_INT=10]="COMMAND_IN_INT",(he=ie=_.COMMAND_GET||(_.COMMAND_GET={}))[he.COMMAND_GET_STRING=1]="COMMAND_GET_STRING",he[he.COMMAND_GET_KEY=2]="COMMAND_GET_KEY",he[he.COMMAND_GET_DIST=4]="COMMAND_GET_DIST",he[he.COMMAND_GET_COORD=8]="COMMAND_GET_COORD",he[he.COMMAND_GET_INT=16]="COMMAND_GET_INT",(be=_.DynamicInputType||(_.DynamicInputType={}))[be.kNoInput=0]="kNoInput",be[be.kXYCoordInput=1]="kXYCoordInput",be[be.kDistanceInput=2]="kDistanceInput",be[be.kDynTip=3]="kDynTip",be[be.kAutoInput=4]="kAutoInput",be[be.kAngleInput=5]="kAngleInput",(je=_.GETPOINTSTATUS||(_.GETPOINTSTATUS={}))[je.OsModeSValidLastPoint=1]="OsModeSValidLastPoint",je[je.OsModeSTempDisable=2]="OsModeSTempDisable",je[je.OsModeOrthoTempDisable=4]="OsModeOrthoTempDisable",je[je.OsModeSValidLastMovePoint=8]="OsModeSValidLastMovePoint",je[je.OsModePoloarTempDisable=16]="OsModePoloarTempDisable",je[je.OsModeDynTraceTempDisable=32]="OsModeDynTraceTempDisable",je[je.OsModeGridSnapTempDisable=64]="OsModeGridSnapTempDisable",(xe=_.OsnapMode||(_.OsnapMode={}))[xe.kOsModekInValid=0]="kOsModekInValid",xe[xe.kOsModeEnd=1]="kOsModeEnd",xe[xe.kOsModeMid=2]="kOsModeMid",xe[xe.kOsModeCen=3]="kOsModeCen",xe[xe.kOsModeNode=4]="kOsModeNode",xe[xe.kOsModeQuad=5]="kOsModeQuad",xe[xe.kOsModeIns=7]="kOsModeIns",xe[xe.kOsModePerp=8]="kOsModePerp",xe[xe.kOsModeTan=9]="kOsModeTan",xe[xe.kOsModeNear=10]="kOsModeNear",xe[xe.kOsModeInt=11]="kOsModeInt";var Fe,J=void 0,ge=void 0,oe=E.kNoChange,le=Y.kInvalid,Re=-9999999,Ye=new v.Vector2(Re,Re),Be=!1,se=void 0,ve=!1,Ee=0,rt=new Map,tt=new Array,xt=new P.MxString,Rt=void 0,At=-2;function He(){J!=null&&J.notifySampler()}function Gt(ct,Ue){var lt=ct.srcElement;if(lt&&(B.MxDrawData.m_isMapBox||lt.tagName=="CANVAS")){if(J==null||J.getDynImput().isTruncatedInput())return 0;Ye.x=ct.offsetX,Ye.y=ct.offsetY,Ue&&(Ye.x=Ue.x,Ye.y=Ue.y),Zt(Ye)}return 0}function jt(ct,Ue){if(ct.button!=Y.kLeft)return 0;var lt=ct.srcElement;if(!lt||!B.MxDrawData.m_isMapBox&&lt.tagName!="CANVAS"||J==null||J.getDynImput().isTruncatedInput())return 0;Ye.x=ct.offsetX,Ye.y=ct.offsetY,Ue&&(Ye.x=Ue.x,Ye.y=Ue.y),Fe=J.getMxObject().screenCoord2Current(ct.offsetX,ct.offsetY,0);var Wt=J.getOsnap();return Fe=Wt.reCompteCurrentPoint(Fe),oe=E.kMouseUp,le=ct.button,He(),ct.stopPropagation(),1}function Tn(ct,Ue,lt){var Wt=J.getMxObject().screenCoord2Current(ct,Ue,lt),Ke=J.getOsnap();Wt=Ke.reCompteCurrentPoint(Wt);var Ot=Ke.getCurrentOSnapPoint(Wt);Wt=Ot.pt;var $t,rn=!1;if(Ot.isSnapPoint&&(rn=!0),rn||($t=J.getDynamicTrace().GetTracePoint())&&(Wt.copy($t),rn=!0),rn||($t=J.getPolarAxisTrace().GetTracePoint())&&(Wt.copy($t),rn=!0),!rn){var hr=J.getOrtho();hr.OnViewMouseMove(Wt);var _r=hr.GetCurOrthoPoint();_r.isValid&&(Wt.copy(_r.pt),rn=!0)}return rn||($t=J.getGridTrace().GetTracePoint())&&(Wt.copy($t),rn=!0),Wt}function mn(ct,Ue){if(ct.button!=Y.kLeft)return 0;J!=null&&J.getDynImput().isShow()&&J.getDynImput().setFocus(!0);var lt=ct.srcElement;if(!lt||!B.MxDrawData.m_isMapBox&&lt.tagName!="CANVAS"||J==null||J.getDynImput().isTruncatedInput())return 0;Ye.x=ct.offsetX,Ye.y=ct.offsetY,Ue&&(Ye.x=Ue.x,Ye.y=Ue.y);var Wt=Tn(ct.offsetX,ct.offsetY,0);return T.McEdImpJigGlobalData.setPrvPoint(Wt),J.getOsnap().seInValidPoint(),Fe=Wt,oe=E.kMouseDown,le=ct.button,He(),ct.stopPropagation(),1}function Qn(ct){if(ct.stopPropagation(),ct.preventDefault(),ct.touches.length!=0){J!=null&&J.getDynImput().isShow()&&J.getDynImput().setFocus(!0);var Ue=ct.srcElement;if(Ue&&(B.MxDrawData.m_isMapBox||Ue.tagName=="CANVAS")){if(J==null)return;var lt=ct.target.getBoundingClientRect();Ye.x=ct.touches[0].clientX-lt.left,Ye.y=ct.touches[0].clientY-lt.top;var Wt=Tn(Ye.x,Ye.y,0);return T.McEdImpJigGlobalData.setPrvPoint(Wt),J.getOsnap().seInValidPoint(),Fe=Wt,oe=E.kBegan,le=Y.kInvalid,He(),1}}}function gt(ct){ct.stopPropagation(),ct.preventDefault();var Ue=ct.srcElement;if(Ue&&(B.MxDrawData.m_isMapBox||Ue.tagName=="CANVAS")){if(J==null||Ye.x==Re||Ye.y==Re)return;if(0<ct.touches.length){var lt=ct.target.getBoundingClientRect();Ye.x=ct.touches[0].clientX-lt.left,Ye.y=ct.touches[0].clientY-lt.top}var Wt=Tn(Ye.x,Ye.y,0);return T.McEdImpJigGlobalData.setPrvPoint(Wt),J.getOsnap().seInValidPoint(),Fe=Wt,oe=E.kEnd,le=Y.kInvalid,He(),1}}function ze(ct){ct.stopPropagation(),ct.preventDefault();var Ue=ct.srcElement;if(Ue&&(B.MxDrawData.m_isMapBox||Ue.tagName=="CANVAS")){if(J==null)return;var lt=ct.target.getBoundingClientRect();Ye.x=ct.touches[0].clientX-lt.left,Ye.y=ct.touches[0].clientY-lt.top,Zt(Ye)}}function Zt(ct){if(ve=!1,ct==null){if(Ye.x==Re||Ye.y==Re)return;ct=Ye}J.getDynImput().ClearDisplay();var Ue=J.getMxObject().screenCoord2Current(ct.x,ct.y,0),lt=J.getOffsetArrow();lt.ReSetTempDisplay(),lt.MouseMove(Ue);var Wt=J.getOsnap();Ue=Wt.reCompteCurrentPoint(Ue);var Ke=J.getMxObject().viewCoordLong2Cad(.5*B.MxDrawData.m_dInputRectWidth);Wt.setPoint(Ue,Ke);var Ot=J.getDynamicTrace();Ot.ReSetTempDisplay(),Ot.OnDynamicTrace(0,Ue,_.OsnapMode.kOsModekInValid),Ot.MouseMove(Ue);var $t=!1,rn=Ot.GetTracePoint();rn&&(Ue.x=rn.x,Ue.y=rn.y,Ue.z=rn.z,$t=!0);var hr=J.getPolarAxisTrace();if(hr.ReSetTempDisplay(),$t||(hr.MouseMove(Ue),(rn=hr.GetTracePoint())&&(Ue.x=rn.x,Ue.y=rn.y,Ue.z=rn.z,$t=!0)),!$t){var _r=J.getOrtho();_r.OnViewMouseMove(Ue);var qr=_r.GetCurOrthoPoint();qr.isValid&&Ue.copy(qr.pt)}var Ur=J.getGridTrace();Ur.ReSetTempDisplay(),$t||(Ur.MouseMove(Ue),(rn=Ur.GetTracePoint())&&(Ue.x=rn.x,Ue.y=rn.y,Ue.z=rn.z,$t=!0)),Fe=Ue,oe=E.kMove;var Gr=J.getMxObject();Gr.sysVariable().setSysVarPoint("LASTMOVEPOINT",Ue);var Or=Gr.sysVariable().getSysVarNumber("GETPOINTSTATUS");Or|=_.GETPOINTSTATUS.OsModeSValidLastMovePoint,Gr.sysVariable().setSysVarNumber("GETPOINTSTATUS",Or),He.call(this)}function Rn(){J&&(Rt=J.getMxObject().getEventManager(),u.MxFun.isPC()?(Rt.addEventListener("mouseup",jt,!0),Rt.addEventListener("mousemove",Gt,!0),Rt.addEventListener("mousedown",mn,!0)):(Rt.addEventListener("touchstart",Qn,!0),Rt.addEventListener("touchend",gt,!0),Rt.addEventListener("touchmove",ze,!0)))}function Xn(){Rt&&(u.MxFun.isPC()?(Rt.removeEventListener("mouseup",jt,!0),Rt.removeEventListener("mousemove",Gt,!0),Rt.removeEventListener("mousedown",mn,!0)):(Rt.removeEventListener("touchstart",Qn,!0),Rt.removeEventListener("touchend",gt,!0),Rt.removeEventListener("touchmove",ze,!0)),Rt=void 0)}function pt(ct){var Ue=ct.getOrbitControls();u.MxFun.isPC()?(At=Ue.mouseButtons.LEFT,Ue.mouseButtons.LEFT=-1):Ue.enabled=!1,Ue.resetStatusValue(),ct.callEvent("dragWillStart"),ct.updateDisplay()}function st(ct){var Ue=new v.Vector3,lt=!1,Wt=new P.MxString(ct),Ke=Wt.AnalyzeString(",");if(Ke.length<2)for(;;){var Ot=J.getDynImput().getFocusIndex();if(Ot==-1||Wt.IsEmpty()||!f.MxTools.IsNumerical(Wt))break;if(Ot==0){var $t=f.MxTools._tstof(Wt.m_val);if(f.MxTools.IsZero($t)||!((Gr=(Or=J.getMxObject()).sysVariable().getSysVarNumber("GETPOINTSTATUS"))&_.GETPOINTSTATUS.OsModeSValidLastPoint)||!(Gr&_.GETPOINTSTATUS.OsModeSValidLastMovePoint))break;var rn=Or.sysVariable().getSysVarPoint("LASTPOINT");if((_r=Or.sysVariable().getSysVarPoint("LASTMOVEPOINT").clone().sub(rn)).length()<1e-7)break;_r.normalize(),_r.multiplyScalar($t);var hr=(Ue=rn.add(_r)).clone().add(_r.multiplyScalar(10));Or.sysVariable().setSysVarPoint("LASTMOVEPOINT",hr),lt=!0}else if(Ot==1){var _r,qr=f.MxTools._tstof(Wt.m_val);if(!((Gr=(Or=J.getMxObject()).sysVariable().getSysVarNumber("GETPOINTSTATUS"))&_.GETPOINTSTATUS.OsModeSValidLastPoint)||!(Gr&_.GETPOINTSTATUS.OsModeSValidLastMovePoint)||(rn=Or.sysVariable().getSysVarPoint("LASTPOINT"),(_r=Or.sysVariable().getSysVarPoint("LASTMOVEPOINT").clone().sub(rn)).length()<1e-7))break;var Ur=new v.Vector3(_r.length(),0,0);Ur.applyAxisAngle(new v.Vector3(0,0,1),qr*Math.PI/180),hr=(Ue=rn.add(Ur)).clone().add(Ur.multiplyScalar(2)),Or.sysVariable().setSysVarPoint("LASTMOVEPOINT",hr),lt=!0}break}else{var Gr,Or=J.getMxObject(),Qi=new P.MxString(Ke[0]),Pi=new P.MxString(Ke[1]),si=new P.MxString("0");if(2<Ke.length&&(si.m_val=Ke[2]),Qi.IsEmpty()||Qi.Left(1)!="@")f.MxTools.IsNumerical(Qi)&&f.MxTools.IsNumerical(Pi)&&f.MxTools.IsNumerical(si)?(lt=!0,Ue.x=f.MxTools._tstof(Qi.m_val),Ue.y=f.MxTools._tstof(Pi.m_val),Ue.z=f.MxTools._tstof(si.m_val)):lt=!1;else if(Qi.m_val=Qi.m_val.substring(1,Qi.m_val.length),f.MxTools.IsNumerical(Qi)&&f.MxTools.IsNumerical(Pi)&&f.MxTools.IsNumerical(si))if((Gr=Or.sysVariable().getSysVarNumber("GETPOINTSTATUS"))&_.GETPOINTSTATUS.OsModeSValidLastPoint){lt=!0;var gr=f.MxTools._tstof(Qi.m_val),Wi=f.MxTools._tstof(Pi.m_val),H=f.MxTools._tstof(si.m_val);rn=Or.sysVariable().getSysVarPoint("LASTPOINT"),Ue.x=rn.x+gr,Ue.y=rn.y+Wi,Ue.z=rn.z+H}else lt=!1;else lt=!1}return lt?Ue:null}function qt(ct,Ue){Ue===void 0&&(Ue=!1),D.MxUiVue.AcutPrintfNoFormat(ct,Ue)}function xn(ct,Ue){if(ct==V.COMMAND_IN_INVALID){var lt=D.MxUiVue.getCmdTip();return qt(Ue),qt(lt),C.kNoChange}return ct==V.COMMAND_IN_INVALID_ZERO?(lt=D.MxUiVue.getCmdTip(),J.userInputControls()&ee.kNoNegativeResponseAccepted?qt(`
   
`):qt(`
  
`),qt(lt),C.kOther):ct!=V.COMMAND_IN_INVALID_NEG?C.kNoChange:(lt=D.MxUiVue.getCmdTip(),J.userInputControls()&ee.kNoZeroResponseAccepted?qt(`
   
`):qt(`
  
`),qt(lt),C.kOther)}function nn(ct){var Ue={iRet:V.COMMAND_IN_NO_ENTITY,sValue:"",iKey:C.kNull,dDist:0,iVal:0,pt:null,cmdText:""};if(!ve)return Ue;var lt=J.userInputControls(),Wt=D.MxUiVue.getCmdText();if((Ue.cmdText=Wt).length==0)return lt&ee.kNullResponseAccepted?Ue.iRet=V.COMMAND_IN_EMTPY:Ue.iRet=V.COMMAND_IN_INVALID,Ue;if(ct&ie.COMMAND_GET_KEY&&0<rt.size){var Ke=new P.MxString(Wt);Ke.MakeUpper(),Ke.TrimLeft(" "),Ke.TrimRight(" ");var Ot=rt.get(Ke.m_val);if(Ot!=null)return Ue.iRet=V.COMMAND_IN_KEY,Ue.iKey=Ot,Ue.sValue=Ke.m_val,Ue}if(ct&ie.COMMAND_GET_DIST&&f.MxTools.IsNumerical(Wt))return Ue.dDist=f.MxTools._tstof(Wt),lt&ee.kNoZeroResponseAccepted&&f.MxTools.IsZero(Ue.dDist)?Ue.iRet=V.COMMAND_IN_INVALID_ZERO:lt&ee.kNoNegativeResponseAccepted&&Ue.dDist<0?Ue.iRet=V.COMMAND_IN_INVALID_NEG:(Ue.sValue=Wt,Ue.iRet=V.COMMAND_IN_DIST),Ue;if(ct&ie.COMMAND_GET_INT&&f.MxTools.IsNumerical(Wt))return Ue.iVal=f.MxTools._tstoi(Wt),lt&ee.kNoZeroResponseAccepted&&Ue.iVal==0?Ue.iRet=V.COMMAND_IN_INVALID_ZERO:lt&ee.kNoNegativeResponseAccepted&&Ue.iVal<0?Ue.iRet=V.COMMAND_IN_INVALID_NEG:(Ue.sValue=Wt,Ue.iRet=V.COMMAND_IN_INT),Ue;if(ct&ie.COMMAND_GET_COORD){var $t=st(Wt);if($t!=null)return Ue.sValue=Wt,Ue.iRet=V.COMMAND_IN_COORD,Ue.pt=$t,Ue}return ct&ie.COMMAND_GET_STRING?(Ue.sValue=Wt,Ue.iRet=V.COMMAND_IN_STRING):Ue.iRet=V.COMMAND_IN_INVALID,Ue}function er(ct){var Ue=J.getMxObject();if(Ue.sysVariable().setSysVarPoint("LASTPOINT",ct),ct){var lt=Ue.sysVariable().getSysVarNumber("GETPOINTSTATUS");lt|=_.GETPOINTSTATUS.OsModeSValidLastPoint,Ue.sysVariable().setSysVarNumber("GETPOINTSTATUS",lt)}else lt=Ue.sysVariable().getSysVarNumber("GETPOINTSTATUS"),lt&=~_.GETPOINTSTATUS.OsModeSValidLastPoint,Ue.sysVariable().setSysVarNumber("GETPOINTSTATUS",lt)}function kr(ct){var Ue=new R;return oe==E.kMove?(Ue.status=C.kNormal,Ue.pt=Fe,Ue.exit=!1):oe==E.kEnd?ct&y.kGetEnd?(Ue.status=C.kNormal,Ue.pt=Fe,Ue.exit=!0,Ue.DetailedResult=M.kTouchUpIn,er(Ue.pt)):(Ue.status=C.kNormal,Ue.pt=Fe,Ue.exit=!1):oe==E.kCancle?(Ue.status=C.kCancel,Ue.pt=Fe,Ue.exit=!0):oe==E.kBegan?ct&y.kGetBegan?(Ue.status=C.kNormal,Ue.pt=Fe,Ue.exit=!0,Ue.DetailedResult=M.kTouchDownIn,er(Ue.pt)):(Ue.status=C.kNormal,Ue.pt=Fe,Ue.exit=!1):oe==E.kMouseDown?(Ue.status=C.kNormal,Ue.pt=Fe,Ue.exit=!0,Ue.DetailedResult=M.kMouseLeftIn,er(Ue.pt)):(Ue.status=C.kNoChange,Ue.pt=void 0,Ue.exit=!1),Ue}_.getInputKeyword=function(ct){if(ct<1)return"";for(var Ue,lt=rt.entries();!(Ue=lt.next()).done;)if(Ue.value==ct)return Ue.key;return""},_.GetKeyWordToString=function(){return tt},_.keywordList=function(){return xt.m_val},_.setKeywordList=function(ct){if(xt.m_val=ct,rt.clear(),tt.length=0,!xt.IsEmpty())if(xt.TrimLeft(" "),xt.TrimRight(" "),xt.m_val[0]=="["&&xt.m_val[xt.m_val.length-1]=="]"){xt.TrimLeft("["),xt.TrimRight("]");for(var Ue=xt.AnalyzeString("/"),lt=1,Wt=0;Wt<Ue.length;Wt++){var Ke=(rn=new P.MxString(Ue[Wt])).Find("(");if(Ke!=-1){var Ot=new P.MxString(rn.Left(Ke)),$t=new P.MxString(rn.Right(rn.GetLength()-Ke-1));$t.TrimRight(")"),Ot.IsEmpty()||$t.IsEmpty()||($t.MakeUpper(),rt.set($t.m_val,lt),lt++,tt.push(new f.MxPair($t.m_val,Ot.m_val)))}}}else for(Ue=xt.AnalyzeString(" "),lt=1,Wt=0;Wt<Ue.length;Wt++){var rn;(rn=new P.MxString(Ue[Wt])).IsEmpty()||(rn.MakeUpper(),rt.set(rn.m_val,lt),lt++)}},_.getAcquirePoint=function(){return Fe},_.getAcquireStatus=function(){return oe},_.doMouseMoveImp=Zt,_.OnThreeControlsChage=function(){if(J!=null)return J.getOsnap().reComputeOffset(),void(Ye.x!=Re&&Ye.y!=Re&&Zt(Ye))},_.OnEnter=function(ct){Ee=ct,ve=!0,oe=E.kNoChange,He(),ve=!1},_.Test=function(){ve=!0},_.registEvent=Rn,_.unRegistEvent=Xn,_.getCurrentMouseButton=function(){return le},_.isRunning=function(){return J!=null},_.getCurCmd=function(){return J},_.commandRunComplete=function(ct){J!=ct&&console.log("aseert:_curCmd == cmd");var Ue,lt,Wt=L.MxManager.currentMx();J!=null&&(Wt=J.getMxObject()),ge!=null?(J=ge,ge=void 0,le=Y.kInvalid,Rn(),J.onStartCommand(),pt(Wt)):(Xn(),J=void 0,lt=(Ue=Wt).getOrbitControls(),u.MxFun.isPC()?At!=-2&&(lt.mouseButtons.LEFT=At,At=-2,lt.resetStatusValue()):(lt.enabled=!0,lt.resetStatusValue()),Ue.callEvent("dragWillEnd"),Ue.updateDisplay(),B.MxDrawData.m_isAutoResetRenderer||Ue.resetRenderer())},_.isWaitCmdNull=function(){return ge==null},_.stopCmd=function(ct){L.MxManager.currentMx().endPanCommand(),J!=null&&(Be=!0,J.notifyCancleExit(ct),Be=!1)},_.setRunCmdEvent=function(ct){se=ct},_.runCmd=function(ct){if(!Be){var Ue=L.MxManager.currentMx();ct.setMxObject(Ue),Ue.isValidCurMousePostion()?Ye=Ue.getCurrentMousePostion():u.MxFun.isPC()?(Ye.x=Re,Ye.y=Re):(Ye.x=.5*Ue.getViewWidth(),Ye.y=.5*Ue.getViewHeight()),se&&se(),J==null?(J=ct,le=Y.kInvalid,Rn(),J.onStartCommand(),pt(Ue)):(ge=ct,Be=!0,J.notifyCancleExit(M.kNewCommadIn),Be=!1)}},_.GetAcqurePointFromStringTo=st,_.ProcCommandRetResult=xn,_.GetCommandLineContent=nn,_.acquireKeyword=function(){var ct=new R;if(J==null)return ct.status=C.kCancel,ct.exit=!0,ct;var Ue=nn(ie.COMMAND_GET_STRING|ie.COMMAND_GET_KEY);return Ue.iRet==V.COMMAND_IN_EMTPY?(ct.status=C.kNull,ct.exit=!0,Ee==13?ct.DetailedResult=M.kNullEnterIn:Ee==32?ct.DetailedResult=M.kNullSpaceIn:Ee==-1&&(ct.DetailedResult=M.kMouseRightIn)):Ue.iRet==V.COMMAND_IN_KEY?(ct.status=Ue.iKey,ct.exit=!0,ct.sKeyValue=Ue.sValue,ct.DetailedResult=M.kKeyIn):(Ue.cmdText.length==0?ct.status=C.kNoChange:ct.status=xn(Ue.iRet,`
 
`),ct.exit=!1),ct},_.acquireString=function(){var ct=new R;if(J==null)return ct.status=C.kCancel,ct.exit=!0,ct;var Ue=nn(ie.COMMAND_GET_STRING|ie.COMMAND_GET_KEY);return Ue.iRet==V.COMMAND_IN_EMTPY?(ct.status=C.kNull,ct.exit=!0,Ee==13?ct.DetailedResult=M.kNullEnterIn:Ee==32?ct.DetailedResult=M.kNullSpaceIn:Ee==-1&&(ct.DetailedResult=M.kMouseRightIn)):Ue.iRet==V.COMMAND_IN_KEY?(ct.status=Ue.iKey,ct.exit=!0,ct.sKeyValue=Ue.sValue,ct.DetailedResult=M.kKeyIn):Ue.iRet==V.COMMAND_IN_STRING?(ct.status=C.kNormal,ct.sValue=Ue.sValue,ct.exit=!0,ct.DetailedResult=M.kKeyIn):(ct.status=xn(Ue.iRet,`
 
`),ct.exit=!1),ct},_.acquireInt=function(){var ct=new R;if(J==null)return ct.status=C.kCancel,ct.exit=!0,ct;var Ue=nn(ie.COMMAND_GET_INT|ie.COMMAND_GET_KEY);return Ue.iRet==V.COMMAND_IN_EMTPY?(ct.status=C.kNull,ct.exit=!0,Ee==13?ct.DetailedResult=M.kNullEnterIn:Ee==32?ct.DetailedResult=M.kNullSpaceIn:Ee==-1&&(ct.DetailedResult=M.kMouseRightIn)):Ue.iRet==V.COMMAND_IN_KEY?(ct.status=Ue.iKey,ct.exit=!0,ct.sKeyValue=Ue.sValue,ct.DetailedResult=M.kKeyIn):Ue.iRet==V.COMMAND_IN_INT?(ct.status=C.kNormal,ct.iVal=Ue.iVal,ct.exit=!0,ct.DetailedResult=M.kKeyIn):(ct.status=xn(Ue.iRet,`
  
`),ct.exit=!1),ct},_.acquireDist=function(ct,Ue){var lt=new R;if(J==null)return lt.status=C.kCancel,lt.exit=!0,lt;var Wt=nn(ie.COMMAND_GET_DIST|ie.COMMAND_GET_KEY);if(Wt.iRet==V.COMMAND_IN_EMTPY)return lt.status=C.kNull,lt.exit=!0,Ee==13?lt.DetailedResult=M.kNullEnterIn:Ee==32?lt.DetailedResult=M.kNullSpaceIn:Ee==-1&&(lt.DetailedResult=M.kMouseRightIn),lt;if(Wt.iRet==V.COMMAND_IN_KEY)return lt.status=Wt.iKey,lt.exit=!0,lt.sKeyValue=Wt.sValue,lt.DetailedResult=M.kKeyIn,lt;if(Wt.iRet==V.COMMAND_IN_DIST)return lt.status=C.kNormal,lt.dist=Wt.dDist,lt.exit=!0,lt.DetailedResult=M.kCoordIn,lt;if(lt.status=xn(Wt.iRet,`
  
`),!Ue||Wt.iRet==V.COMMAND_IN_INVALID_ZERO||Wt.iRet==V.COMMAND_IN_INVALID_NEG)return lt.exit=!1,lt;var Ke=kr(ct);if(Ke.status==C.kNormal&&Ke.exit){var Ot=Ke.pt.clone(),$t=Ue.clone();Ot.z=$t.z=0;var rn=Ot.distanceTo($t);return J.userInputControls()&ee.kNoZeroResponseAccepted&&f.MxTools.IsZero(rn)?(xn(V.COMMAND_IN_INVALID_ZERO,`
  
`),lt.status=C.kOther,lt.exit=!1,lt):(lt.status=C.kNormal,lt.dist=rn,lt.exit=!0,lt.DetailedResult=Ke.DetailedResult,lt)}return lt.exit=!1,lt.status=C.kNoChange,lt},_.acquirePoint=function(ct,Ue){Ue===void 0&&(Ue=!0);var lt=new R;if(J==null)return lt.status=C.kCancel,lt;var Wt=nn(ie.COMMAND_GET_COORD|ie.COMMAND_GET_KEY);return Wt.iRet==V.COMMAND_IN_EMTPY?(lt.status=C.kNull,lt.exit=!0,Ee==13?lt.DetailedResult=M.kNullEnterIn:Ee==32?lt.DetailedResult=M.kNullSpaceIn:Ee==-1&&(lt.DetailedResult=M.kMouseRightIn),lt):Wt.iRet==V.COMMAND_IN_KEY?(lt.status=Wt.iKey,lt.exit=!0,lt.sKeyValue=Wt.sValue,lt.DetailedResult=M.kKeyIn,lt):Wt.iRet==V.COMMAND_IN_COORD?(lt.status=C.kNormal,lt.pt=new v.Vector3(Wt.pt.x,Wt.pt.y,Wt.pt.z),lt.exit=!0,lt.DetailedResult=M.kCoordIn,lt):(Ue&&xn(Wt.iRet,`
  
`),kr(ct))},_.acquireAngle=function(ct,Ue){var lt=new R;if(J==null)return lt.status=C.kCancel,lt.exit=!0,lt;var Wt=nn(ie.COMMAND_GET_DIST|ie.COMMAND_GET_KEY);if(Wt.iRet==V.COMMAND_IN_EMTPY)return lt.status=C.kNull,lt.exit=!0,Ee==13?lt.DetailedResult=M.kNullEnterIn:Ee==32?lt.DetailedResult=M.kNullSpaceIn:Ee==-1&&(lt.DetailedResult=M.kMouseRightIn),lt;if(Wt.iRet==V.COMMAND_IN_KEY)return lt.status=Wt.iKey,lt.exit=!0,lt.sKeyValue=Wt.sValue,lt.DetailedResult=M.kKeyIn,lt;if(Wt.iRet==V.COMMAND_IN_DIST)return lt.status=C.kNormal,lt.ang=3.14159265*Wt.dDist/180,lt.exit=!0,lt.DetailedResult=M.kCoordIn,lt;if(lt.status=xn(Wt.iRet,`
  
`),!Ue||Wt.iRet==V.COMMAND_IN_INVALID_ZERO||Wt.iRet==V.COMMAND_IN_INVALID_NEG)return lt.exit=!1,lt;var Ke=kr(ct);if(Ke.status==C.kNormal&&Ke.exit){var Ot=new v.Vector3(Ke.pt.x-Ue.x,Ke.pt.y-Ue.y,0),$t=Ot.angleTo(new v.Vector3(1,0,0));Ot.dot(new v.Vector3(0,1,0))<-1e-11&&($t=2*Math.PI-$t);var rn=J.userInputControls();return rn&ee.kNoZeroResponseAccepted&&f.MxTools.IsZero($t)?(xn(V.COMMAND_IN_INVALID_ZERO,`
  
`),lt.status=C.kOther,lt.exit=!1,lt):(rn&ee.kNoNegativeResponseAccepted&&$t<0?(xn(V.COMMAND_IN_INVALID_NEG,`
  
`),lt.status=C.kOther,lt.exit=!1):(lt.status=C.kNormal,lt.ang=$t,lt.exit=!0,lt.DetailedResult=Ke.DetailedResult),lt)}return lt.exit=!1,lt.status=C.kNoChange,lt},_.getMcEdJigCommandClass=function(){return w.McEdJigCommand},_.getMrxDbgUiPrPointClass=function(){return U.MrxDbgUiPrPoint},_.getMrxDbgUiPrDistClass=function(){return G.MrxDbgUiPrDist},_.getMrxDbgUiPrIntClass=function(){return G.MrxDbgUiPrInt},_.getMrxDbgUiPrStringClass=function(){return G.MrxDbgUiPrString},_.getMrxDbgUiPrKeyWordClass=function(){return G.MrxDbgUiPrKeyWord},_.getMrxDbgUiPrAngleClass=function(){return G.MrxDbgUiPrAngle},_.getMcEdGetPointWorldDrawClass=function(){return N.McEdGetPointWorldDraw},_.McEdGetPointWorldDrawObjectClass=function(){return N.McEdGetPointWorldDrawObject},_.init=function(){this._curCmd=void 0}}(o||(s.MxJigCmdManager=o={}))},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxString":34,"../MxTools":37,"../UI/MxUiVue":64,"./McEdJigOsnap":42,"./MrxDbgUiPrBase":44,"./MrxDbgUiPrDist":45,"./MrxDbgUiPrPoint":46,"./MxJig":52,three:19}],54:[function(b,r,s){var o,v=this&&this.__extends||(o=function(D,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,T){P.__proto__=T}||function(P,T){for(var B in T)Object.prototype.hasOwnProperty.call(T,B)&&(P[B]=T[B])})(D,f)},function(D,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function P(){this.constructor=D}o(D,f),D.prototype=f===null?Object.create(f):(P.prototype=f.prototype,new P)});Object.defineProperty(s,"__esModule",{value:!0}),s.MxJigGetLine=void 0;var u,w=b("./MxJig"),L=b("./MxJigCmdManager"),U=(v(N,u=w.McEdJigCommand),N.prototype.sampler=function(){var D=L.MxJigCmdManager.InType.kGetBegan;this._isGetPt1||(D=L.MxJigCmdManager.InType.kGetEnd);var f=this.acquirePoint(D);return f.status==L.MxJigCmdManager.DragStatus.kNormal&&(this._isGetPt1?this._pt1=f.pt:this._pt2=f.pt),f.status},N.prototype.setRetCall=function(D){this._retCall=D},N.prototype.done=function(D){if(this._isGetPt1)return this._isGetPt1=!1,L.MxJigCmdManager.DoneStatius.kContinueCommand;var f={};return f.pt1=this.getMxObject().worldCoord2Currnet(this._pt1.x,this._pt1.y,this._pt1.z),f.pt2=this.getMxObject().worldCoord2Currnet(this._pt2.x,this._pt2.y,this._pt2.z),this._retCall(f),L.MxJigCmdManager.DoneStatius.kExitCommand},N.prototype.upDisplay=function(){this._isGetPt1||this._pt1==null||this._pt2==null||this.drawLine(this._pt1,this._pt2)},N);function N(){var D=u!==null&&u.apply(this,arguments)||this;return D._isGetPt1=!0,D}s.MxJigGetLine=U},{"./MxJig":52,"./MxJigCmdManager":53}],55:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxOffsetArrow=void 0;var o=b("three"),v=b("../MxFun"),u=b("../MxThreeJS"),w=b("../MxTools"),L=(U.prototype.ClearDynDrawEntity=function(){var N=this.m_vecDynDrawEntity.length;if(N!=0){for(var D=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),f=0;f<N;f++)v.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[f],D);this.m_vecDynDrawEntity=[]}},U.prototype.MouseMove=function(N){var D=this.m_mxJig.getMxObject();if(D.getMcObject().isValid()&&(this.ClearDynDrawEntity(),this.m_mxJig.isOffsetInputPostion())){var f=N.clone(),P=this.m_mxJig.getOsnap().reCompteCurrentPoint(f.clone()),T=u.MxThreeJS.createLine(D.toSmallcoord(f),D.toSmallcoord(P),16777215),B=D.getTheTempDrawContainer_SmallCoord();B.add(T),this.m_vecDynDrawEntity.push(T);var G=w.MxTools.MillimeterToPixels(2.9);G=D.screenCoordLong2Doc(G);var R=u.MxThreeJS.createSolidCircle(D.toSmallcoord(f),.85*G,16777215);B.add(R),this.m_vecDynDrawEntity.push(R);var _=u.MxThreeJS.createCircle(D.toSmallcoord(f),G,16777215);B.add(_),this.m_vecDynDrawEntity.push(_);var ee=f.sub(P);ee.normalize().multiplyScalar(.8*G);var k=ee.clone().applyAxisAngle(new o.Vector3(0,0,1),15*Math.PI/180),E=ee.clone().applyAxisAngle(new o.Vector3(0,0,1),15*-Math.PI/180),W=P.clone().add(k),C=P.clone().add(E),F=u.MxThreeJS.createLine(D.toSmallcoord(W),D.toSmallcoord(P),16777215);D.getTheTempDrawContainer_SmallCoord().add(F),this.m_vecDynDrawEntity.push(F);var M=u.MxThreeJS.createLine(D.toSmallcoord(C),D.toSmallcoord(P),16777215);D.getTheTempDrawContainer_SmallCoord().add(M),this.m_vecDynDrawEntity.push(M)}},U.prototype.ClearDisplay=function(){this.ClearDynDrawEntity()},U.prototype.ReSetTempDisplay=function(){this.ClearDynDrawEntity()},U.prototype.Init=function(){},U);function U(N){this.m_vecDynDrawEntity=[],this.m_mxJig=null,this.m_mxJig=N}s.MxOffsetArrow=L},{"../MxFun":27,"../MxThreeJS":36,"../MxTools":37,three:19}],56:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxPolarAxisTrace=void 0;var o=b("three"),v=b("./MxJigCmdManager"),u=b("../MxFun"),w=b("../MxDrawData"),L=b("../MxTools"),U=b("../MxManager"),N=b("../MxThreeJS"),D=(f.prototype.ClearDynDrawEntity=function(){for(var P=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord(),T=this.m_vecDynDrawEntity.length,B=0;B<T;B++)u.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[B],P);this.m_vecDynDrawEntity=[]},f.prototype.CreteTracePoint=function(P,T){var B=this.m_mxJig.getMxObject(),G=B.getTheTempDrawContainer_SmallCoord();T/=2;var R=N.MxThreeJS.createLine(B.toSmallcoord2(P.x+T,P.y+T,0),B.toSmallcoord2(P.x-T,P.y-T,0),16711680);G.add(R),this.m_vecDynDrawEntity.push(R);var _=N.MxThreeJS.createLine(B.toSmallcoord2(P.x-T,P.y+T,0),B.toSmallcoord2(P.x+T,P.y-T,0),16711680);G.add(_),this.m_vecDynDrawEntity.push(_)},f.prototype.MouseMove=function(P){var T=this.m_mxJig.getMxObject();if(T.getMcObject().isValid()){if(this.ClearDynDrawEntity(),this.m_isValidTracePoint=!1,this.m_isTrace&&T.sysVariable().getSysVarNumber("GETPOINTSTATUS")&v.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint){var B=T.sysVariable().getSysVarPoint("LASTPOINT"),G=T.getSysVarDouble("POLARANG");if(G=180*G/Math.PI,!((G=Math.abs(G))<.001)){var R=T.viewCoordLong2Cad(w.MxDrawData.m_dInputRectWidth),_=2*R,ee=P.clone().sub(B);if(!(ee.length()<_)){ee.normalize();var k=U.MxManager.getMxCpp().getMxCAD_MxCpp(),E=U.MxManager.getMxCpp().getMxCAD_App(),W=T.getTheTempDrawContainer_SmallCoord(),C=T.viewCoordLong2Cad(this.m_dashedLineLen);ee=k.newMcGeVector3d(ee);var F=k.newMcGeVector3d(new o.Vector3(1,0,0)),M=ee.angleTo2(F),a=(M=180*M/Math.PI)%G;a<G/2?M-=a:M+=G-a;var h=T.viewCoordLong2Cad(T.getViewWidth()),y=T.viewCoordLong2Cad(T.getViewHeight()),j=L.MxTools.MxMax(h,y);(ee=F.clone()).rotateBy(M*Math.PI/180),ee.mult(j);var Y=new o.Vector3(B.x+ee.x,B.y+ee.y,B.z+ee.z),q={pt1:Y,pt2:B},V=E.MxCADAssist.GetClosestPointTo(q.pt1.x,q.pt1.y,q.pt2.x,q.pt2.y,P.x,P.y,!0);if(0<V.length()){var ne=V.at(0),ie=new o.Vector3(ne.x,ne.y,ne.z);if(ie.distanceTo(P)<_){var he=N.MxThreeJS.createDashedLine(T.toSmallcoord2(B.x-ee.x,B.y-ee.y,B.z-ee.z),T.toSmallcoord(Y),this.m_iDashedLineLenColor,C,C);W.add(he),this.m_vecDynDrawEntity.push(he),this.m_isValidTracePoint=!0,this.m_ptTracePoint=ie,this.CreteTracePoint(ie,R)}}}}}}else this.m_isTrace=!1},f.prototype.Init=function(){var P=this.m_mxJig.getMxObject();P.getMcObject().isValid()?(this.m_isValidTracePoint=!1,this.m_isTrace=!1,8&P.getSysVarLong("AUTOSNAP")&&(this.m_isTrace=!0),P.sysVariable().getSysVarNumber("GETPOINTSTATUS")&v.MxJigCmdManager.GETPOINTSTATUS.OsModePoloarTempDisable&&(this.m_isTrace=!1),this.m_mxJig.isDisablePolarAxisTrace()&&(this.m_isTrace=!1),this.m_isTrace):this.m_isTrace=!1},f.prototype.GetTracePoint=function(){if(this.m_isTrace)return this.m_isValidTracePoint?this.m_ptTracePoint:void 0},f.prototype.ClearDisplay=function(){this.ClearDynDrawEntity()},f.prototype.ReSetTempDisplay=function(){this.ClearDynDrawEntity(),this.m_isValidTracePoint=!1},f);function f(P){this.m_vecDynDrawEntity=[],this.m_ptTracePoint=new o.Vector3,this.m_isValidTracePoint=!1,this.m_isTrace=!1,this.m_mxJig=null,this.m_dashedLineLen=1.5,this.m_iDashedLineLenColor=11184810,this.m_mxJig=P}s.MxPolarAxisTrace=D},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxThreeJS":36,"../MxTools":37,"./MxJigCmdManager":53,three:19}],57:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0});var o=b("./MxFun");window.MXFUN_THREE=o.MxFun.getTHREE();var v=b("./MxManager");function u(){}(u.CreateMx=function(){o.MxFun.init(),typeof MxMain<"u"&&MxMain(b)==0||o.MxFun.createMxObject(),v.MxManager.callEvent("init");var w=o.MxFun.getUiObject();w!=null&&(w.sTitle=o.MxFun.getCurrentDraw().getFileTitle(),setTimeout(function(){w.init()},400))},u.Main=function(){if(typeof MxUiMain<"u"){MxUiMain(b);var w=o.MxFun.getUiObject();w!=null&&w.writeUICSS()}typeof MxDocumentReady>"u"?$(document).ready(function(){u.CreateMx()}):MxDocumentReady(b,u.CreateMx)},u).Main()},{"./MxFun":27,"./MxManager":29}],58:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxSvgManager=void 0;var o=b("three"),v=b("three"),u=b("./SVGLoader"),w=function(){this.svg=new o.Group,this.aryMeterial=[],this.boxSize=new v.Vector3(1,1,1)},L=(U.prototype.loadSVGImp=function(f,P,T,B){new u.SVGLoader().load(f,function(G){if(G.paths.length){var R=[],_=G.paths,ee=new o.Group,k=!0,E=!0,W=!1,C=!1;B&&(B.drawStrokes&&(k=B.drawStrokes),B.drawFillShapes&&(E=B.drawFillShapes),B.fillShapesWireframe&&(W=B.fillShapesWireframe),B.strokesWireframe&&(C=B.strokesWireframe));for(var F=0;F<_.length;F++){var M=_[F],a=M.userData.style.fill;if(E&&a!==void 0&&a!=="none"){for(var h=new o.MeshBasicMaterial({color:P||new o.Color().setStyle(a),opacity:M.userData.style.fillOpacity,transparent:M.userData.style.fillOpacity<1,side:o.DoubleSide,depthWrite:!1,wireframe:W}),y=u.SVGLoader.createShapes(M),j=0;j<y.length;j++){var Y=y[j],q=new o.ShapeBufferGeometry(Y),V=new o.Mesh(q,h);ee.add(V)}R.push(h)}var ne=M.userData.style.stroke;if(k&&ne!==void 0&&ne!=="none"){h=new o.MeshBasicMaterial({color:P||new o.Color().setStyle(ne),opacity:M.userData.style.strokeOpacity,transparent:M.userData.style.strokeOpacity<1,side:o.DoubleSide,depthWrite:!1,wireframe:C}),j=0;for(var ie=M.subPaths.length;j<ie;j++){var he=M.subPaths[j];(q=u.SVGLoader.pointsToStroke(he.getPoints(),M.userData.style,12,.001))&&(V=new o.Mesh(q,h),ee.add(V))}R.push(h)}}T&&T(ee,R)}else console.log("mx svg:"+f+" data.paths.length == 0"),T&&T(null,null)},void 0,function(){T&&T(null,null)})},U.prototype.loadSVG=function(f,P,T,B){var G=this,R=this.mapSvgUrlToData.get(f),_=!B||!B.useBuffer||B.useBuffer;if(R&&_){if(T)if(R==null)T(null,null);else{var ee=R.svg.clone();ee.boxSize=R.boxSize,T(ee,R.aryMeterial)}}else this.loadSVGImp(f,P,function(k,E){if(k&&E){var W=new w;W.svg=k,W.aryMeterial=E;var C=new v.Box3().setFromObject(k);W.boxSize.x=C.max.x-C.min.x,W.boxSize.y=C.max.y-C.min.y,W.boxSize.x!==-1/0&&W.boxSize.y!==-1/0||console.log("mx svg:"+f+" boxSize invalid"),G.mapSvgUrlToData.set(f,W);var F=W.svg.clone();F.boxSize=W.boxSize,T&&T(F,W.aryMeterial)}else G.mapSvgUrlToData.set(f,null),T&&T(null,null)},B)},U);function U(){this.mapSvgUrlToData=new Map}var N=(D.prototype.loadSVG=function(f,P,T,B){T&&this.mxThreeJsBuffer.loadSVG(f,P,T,B)},D);function D(){this.mxThreeJsBuffer=new L}s.MxSvgManager=N},{"./SVGLoader":59,three:19}],59:[function(b,r,s){var o,v=this&&this.__extends||(o=function(N,D){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,P){f.__proto__=P}||function(f,P){for(var T in P)Object.prototype.hasOwnProperty.call(P,T)&&(f[T]=P[T])})(N,D)},function(N,D){if(typeof D!="function"&&D!==null)throw new TypeError("Class extends value "+String(D)+" is not a constructor or null");function f(){this.constructor=N}o(N,D),N.prototype=D===null?Object.create(D):(f.prototype=D.prototype,new f)});Object.defineProperty(s,"__esModule",{value:!0}),s.SVGLoader=void 0;var u,w=b("three"),L=(v(U,u=w.Loader),U.prototype.load=function(N,D,f,P){var T=this,B=new w.FileLoader(T.manager);B.setPath(T.path),B.setRequestHeader(T.requestHeader),B.setWithCredentials(T.withCredentials),B.load(N,function(G){try{D(T.parse(G))}catch(R){P?P(R):console.error(R),T.manager.itemError(N)}},f,P)},U.prototype.parse=function(N){var D=this;function f(q,V,ne,ie,he,be,je,xe){if(V!=0&&ne!=0){ie=ie*Math.PI/180,V=Math.abs(V),ne=Math.abs(ne);var Fe=(je.x-xe.x)/2,J=(je.y-xe.y)/2,ge=Math.cos(ie)*Fe+Math.sin(ie)*J,oe=-Math.sin(ie)*Fe+Math.cos(ie)*J,le=V*V,Re=ne*ne,Ye=ge*ge,Be=oe*oe,se=Ye/le+Be/Re;if(1<se){var ve=Math.sqrt(se);le=(V*=ve)*V,Re=(ne*=ve)*ne}var Ee=le*Be+Re*Ye,rt=(le*Re-Ee)/Ee,tt=Math.sqrt(Math.max(0,rt));he===be&&(tt=-tt);var xt=tt*V*oe/ne,Rt=-tt*ne*ge/V,At=Math.cos(ie)*xt-Math.sin(ie)*Rt+(je.x+xe.x)/2,He=Math.sin(ie)*xt+Math.cos(ie)*Rt+(je.y+xe.y)/2,Gt=P(1,0,(ge-xt)/V,(oe-Rt)/ne),jt=P((ge-xt)/V,(oe-Rt)/ne,(-ge-xt)/V,(-oe-Rt)/ne)%(2*Math.PI);q.currentPath.absellipse(At,He,V,ne,Gt,Gt+jt,be===0,ie)}else q.lineTo(xe.x,xe.y)}function P(q,V,ne,ie){var he=q*ne+V*ie,be=Math.sqrt(q*q+V*V)*Math.sqrt(ne*ne+ie*ie),je=Math.acos(Math.max(-1,Math.min(1,he/be)));return q*ie-V*ne<0&&(je=-je),je}function T(q,V){V=Object.assign({},V);var ne={};if(q.hasAttribute("class"))for(var ie=q.getAttribute("class").split(/\s/).filter(Boolean).map(function(Fe){return Fe.trim()}),he=0;he<ie.length;he++)ne=Object.assign(ne,E["."+ie[he]]);function be(Fe,J,ge){ge===void 0&&(ge=function(oe){return oe.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),oe}),q.hasAttribute(Fe)&&(V[J]=ge(q.getAttribute(Fe))),ne[Fe]&&(V[J]=ge(ne[Fe])),q.style&&q.style[Fe]!==""&&(V[J]=ge(q.style[Fe]))}function je(Fe){return Math.max(0,Math.min(1,ee(Fe)))}function xe(Fe){return Math.max(0,ee(Fe))}return q.hasAttribute("id")&&(ne=Object.assign(ne,E["#"+q.getAttribute("id")])),be("fill","fill"),be("fill-opacity","fillOpacity",je),be("fill-rule","fillRule"),be("opacity","opacity",je),be("stroke","stroke"),be("stroke-opacity","strokeOpacity",je),be("stroke-width","strokeWidth",xe),be("stroke-linejoin","strokeLineJoin"),be("stroke-linecap","strokeLineCap"),be("stroke-miterlimit","strokeMiterLimit",xe),be("visibility","visibility"),V}function B(q,V){return q-(V-q)}function G(q,V,ne){if(typeof q!="string")throw new TypeError("Invalid input: "+typeof q);var ie,he={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},be=0,je=!0,xe="",Fe="",J=[];function ge(Ye,Be,se){var ve=new SyntaxError('Unexpected character "'+Ye+'" at index '+Be+".");throw ve.partial=se,ve}function oe(){xe!==""&&(Fe===""?J.push(Number(xe)):J.push(Number(xe)*Math.pow(10,Number(Fe)))),Fe=xe=""}for(var le=q.length,Re=0;Re<le;Re++)if(ie=q[Re],Array.isArray(V)&&V.includes(J.length%ne)&&he.FLAGS.test(ie))be=1,xe=ie,oe();else{if(be===0){if(he.WHITESPACE.test(ie))continue;if(he.DIGIT.test(ie)||he.SIGN.test(ie)){be=1,xe=ie;continue}if(he.POINT.test(ie)){be=2,xe=ie;continue}he.COMMA.test(ie)&&(je&&ge(ie,Re,J),je=!0)}if(be===1){if(he.DIGIT.test(ie)){xe+=ie;continue}if(he.POINT.test(ie)){xe+=ie,be=2;continue}if(he.EXP.test(ie)){be=3;continue}he.SIGN.test(ie)&&xe.length===1&&he.SIGN.test(xe[0])&&ge(ie,Re,J)}if(be===2){if(he.DIGIT.test(ie)){xe+=ie;continue}if(he.EXP.test(ie)){be=3;continue}he.POINT.test(ie)&&xe[xe.length-1]==="."&&ge(ie,Re,J)}if(be===3){if(he.DIGIT.test(ie)){Fe+=ie;continue}if(he.SIGN.test(ie)){if(Fe===""){Fe+=ie;continue}Fe.length===1&&he.SIGN.test(Fe)&&ge(ie,Re,J)}}he.WHITESPACE.test(ie)?(oe(),be=0,je=!1):he.COMMA.test(ie)?(oe(),je=!(be=0)):he.SIGN.test(ie)?(oe(),be=1,xe=ie):he.POINT.test(ie)?(oe(),be=2,xe=ie):ge(ie,Re,J)}return oe(),J}var R=["mm","cm","in","pt","pc","px"],_={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function ee(q){var V="px";if(typeof q=="string"||q instanceof String)for(var ne=0,ie=R.length;ne<ie;ne++){var he=R[ne];if(q.endsWith(he)){V=he,q=q.substring(0,q.length-he.length);break}}var be=void 0;return V==="px"&&D.defaultUnit!=="px"?be=_.in[D.defaultUnit]/D.defaultDPI:(be=_[V][D.defaultUnit])<0&&(be=_[V].in*D.defaultDPI),be*parseFloat(q)}var k=[],E={},W=[],C=new w.Matrix3,F=new w.Matrix3,M=new w.Matrix3,a=new w.Matrix3,h=new w.Vector2,y=new w.Vector3,j=new w.Matrix3,Y=new DOMParser().parseFromString(N,"image/svg+xml");return function q(V,ne){if(V.nodeType===1){var ie,he,be,je,xe,Fe,J,ge,oe,le,Re,Ye,Be=function(Rt){if(!(Rt.hasAttribute("transform")||Rt.nodeName==="use"&&(Rt.hasAttribute("x")||Rt.hasAttribute("y"))))return null;var At=function(He){var Gt=new w.Matrix3,jt=C;if(He.nodeName==="use"&&(He.hasAttribute("x")||He.hasAttribute("y"))){var Tn=ee(He.getAttribute("x")),mn=ee(He.getAttribute("y"));Gt.translate(Tn,mn)}if(He.hasAttribute("transform"))for(var Qn=He.getAttribute("transform").split(")"),gt=Qn.length-1;0<=gt;gt--){var ze=Qn[gt].trim();if(ze!==""){var Zt=ze.indexOf("("),Rn=ze.length;if(0<Zt&&Zt<Rn){var Xn=ze.substr(0,Zt),pt=G(ze.substr(Zt+1,Rn-Zt-1));switch(jt.identity(),Xn){case"translate":1<=pt.length&&(mn=Tn=pt[0],2<=pt.length&&(mn=pt[1]),jt.translate(Tn,mn));break;case"rotate":if(1<=pt.length){var st,qt=0,xn=0;st=-pt[0]*Math.PI/180,3<=pt.length&&(qt=pt[1],xn=pt[2]),F.identity().translate(-qt,-xn),M.identity().rotate(st),a.multiplyMatrices(M,F),F.identity().translate(qt,xn),jt.multiplyMatrices(F,a)}break;case"scale":if(1<=pt.length){var nn=pt[0],er=nn;2<=pt.length&&(er=pt[1]),jt.scale(nn,er)}break;case"skewX":pt.length===1&&jt.set(1,Math.tan(pt[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":pt.length===1&&jt.set(1,0,0,Math.tan(pt[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":pt.length===6&&jt.set(pt[0],pt[2],pt[4],pt[1],pt[3],pt[5],0,0,1)}}Gt.premultiply(jt)}}return Gt}(Rt);return 0<W.length&&At.premultiply(W[W.length-1]),j.copy(At),W.push(At),At}(V),se=!0,ve=null;switch(V.nodeName){case"svg":break;case"style":(function(Rt){if(Rt.sheet&&Rt.sheet.cssRules&&Rt.sheet.cssRules.length)for(var At=0;At<Rt.sheet.cssRules.length;At++){var He=Rt.sheet.cssRules[At];if(He.type===1)for(var Gt=He.selectorText.split(/,/gm).filter(Boolean).map(function(Tn){return Tn.trim()}),jt=0;jt<Gt.length;jt++)E[Gt[jt]]=Object.assign(E[Gt[jt]]||{},He.style)}})(V);break;case"g":ne=T(V,ne);break;case"path":ne=T(V,ne),V.hasAttribute("d")&&(ve=function(Rt){for(var At=new w.ShapePath,He=new w.Vector2,Gt=new w.Vector2,jt=new w.Vector2,Tn=!0,mn=!1,Qn=Rt.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),gt=0,ze=Qn.length;gt<ze;gt++){var Zt=Qn[gt],Rn=Zt.charAt(0),Xn=Zt.substr(1).trim();Tn===!0&&(Tn=!(mn=!0));var pt=void 0;switch(Rn){case"M":for(var st=0,qt=(pt=G(Xn)).length;st<qt;st+=2)He.x=pt[st+0],He.y=pt[st+1],Gt.x=He.x,Gt.y=He.y,st===0?At.moveTo(He.x,He.y):At.lineTo(He.x,He.y),st===0&&jt.copy(He);break;case"H":for(st=0,qt=(pt=G(Xn)).length;st<qt;st++)He.x=pt[st],Gt.x=He.x,Gt.y=He.y,At.lineTo(He.x,He.y),st===0&&mn===!0&&jt.copy(He);break;case"V":for(st=0,qt=(pt=G(Xn)).length;st<qt;st++)He.y=pt[st],Gt.x=He.x,Gt.y=He.y,At.lineTo(He.x,He.y),st===0&&mn===!0&&jt.copy(He);break;case"L":for(st=0,qt=(pt=G(Xn)).length;st<qt;st+=2)He.x=pt[st+0],He.y=pt[st+1],Gt.x=He.x,Gt.y=He.y,At.lineTo(He.x,He.y),st===0&&mn===!0&&jt.copy(He);break;case"C":for(st=0,qt=(pt=G(Xn)).length;st<qt;st+=6)At.bezierCurveTo(pt[st+0],pt[st+1],pt[st+2],pt[st+3],pt[st+4],pt[st+5]),Gt.x=pt[st+2],Gt.y=pt[st+3],He.x=pt[st+4],He.y=pt[st+5],st===0&&mn===!0&&jt.copy(He);break;case"S":for(st=0,qt=(pt=G(Xn)).length;st<qt;st+=4)At.bezierCurveTo(B(He.x,Gt.x),B(He.y,Gt.y),pt[st+0],pt[st+1],pt[st+2],pt[st+3]),Gt.x=pt[st+0],Gt.y=pt[st+1],He.x=pt[st+2],He.y=pt[st+3],st===0&&mn===!0&&jt.copy(He);break;case"Q":for(st=0,qt=(pt=G(Xn)).length;st<qt;st+=4)At.quadraticCurveTo(pt[st+0],pt[st+1],pt[st+2],pt[st+3]),Gt.x=pt[st+0],Gt.y=pt[st+1],He.x=pt[st+2],He.y=pt[st+3],st===0&&mn===!0&&jt.copy(He);break;case"T":for(st=0,qt=(pt=G(Xn)).length;st<qt;st+=2){var xn=B(He.x,Gt.x),nn=B(He.y,Gt.y);At.quadraticCurveTo(xn,nn,pt[st+0],pt[st+1]),Gt.x=xn,Gt.y=nn,He.x=pt[st+0],He.y=pt[st+1],st===0&&mn===!0&&jt.copy(He)}break;case"A":for(st=0,qt=(pt=G(Xn,[3,4],7)).length;st<qt;st+=7)if(pt[st+5]!=He.x||pt[st+6]!=He.y){var er=He.clone();He.x=pt[st+5],He.y=pt[st+6],Gt.x=He.x,Gt.y=He.y,f(At,pt[st],pt[st+1],pt[st+2],pt[st+3],pt[st+4],er,He),st===0&&mn===!0&&jt.copy(He)}break;case"m":for(st=0,qt=(pt=G(Xn)).length;st<qt;st+=2)He.x+=pt[st+0],He.y+=pt[st+1],Gt.x=He.x,Gt.y=He.y,st===0?At.moveTo(He.x,He.y):At.lineTo(He.x,He.y),st===0&&jt.copy(He);break;case"h":for(st=0,qt=(pt=G(Xn)).length;st<qt;st++)He.x+=pt[st],Gt.x=He.x,Gt.y=He.y,At.lineTo(He.x,He.y),st===0&&mn===!0&&jt.copy(He);break;case"v":for(st=0,qt=(pt=G(Xn)).length;st<qt;st++)He.y+=pt[st],Gt.x=He.x,Gt.y=He.y,At.lineTo(He.x,He.y),st===0&&mn===!0&&jt.copy(He);break;case"l":for(st=0,qt=(pt=G(Xn)).length;st<qt;st+=2)He.x+=pt[st+0],He.y+=pt[st+1],Gt.x=He.x,Gt.y=He.y,At.lineTo(He.x,He.y),st===0&&mn===!0&&jt.copy(He);break;case"c":for(st=0,qt=(pt=G(Xn)).length;st<qt;st+=6)At.bezierCurveTo(He.x+pt[st+0],He.y+pt[st+1],He.x+pt[st+2],He.y+pt[st+3],He.x+pt[st+4],He.y+pt[st+5]),Gt.x=He.x+pt[st+2],Gt.y=He.y+pt[st+3],He.x+=pt[st+4],He.y+=pt[st+5],st===0&&mn===!0&&jt.copy(He);break;case"s":for(st=0,qt=(pt=G(Xn)).length;st<qt;st+=4)At.bezierCurveTo(B(He.x,Gt.x),B(He.y,Gt.y),He.x+pt[st+0],He.y+pt[st+1],He.x+pt[st+2],He.y+pt[st+3]),Gt.x=He.x+pt[st+0],Gt.y=He.y+pt[st+1],He.x+=pt[st+2],He.y+=pt[st+3],st===0&&mn===!0&&jt.copy(He);break;case"q":for(st=0,qt=(pt=G(Xn)).length;st<qt;st+=4)At.quadraticCurveTo(He.x+pt[st+0],He.y+pt[st+1],He.x+pt[st+2],He.y+pt[st+3]),Gt.x=He.x+pt[st+0],Gt.y=He.y+pt[st+1],He.x+=pt[st+2],He.y+=pt[st+3],st===0&&mn===!0&&jt.copy(He);break;case"t":for(st=0,qt=(pt=G(Xn)).length;st<qt;st+=2)xn=B(He.x,Gt.x),nn=B(He.y,Gt.y),At.quadraticCurveTo(xn,nn,He.x+pt[st+0],He.y+pt[st+1]),Gt.x=xn,Gt.y=nn,He.x=He.x+pt[st+0],He.y=He.y+pt[st+1],st===0&&mn===!0&&jt.copy(He);break;case"a":for(st=0,qt=(pt=G(Xn,[3,4],7)).length;st<qt;st+=7)pt[st+5]==0&&pt[st+6]==0||(er=He.clone(),He.x+=pt[st+5],He.y+=pt[st+6],Gt.x=He.x,Gt.y=He.y,f(At,pt[st],pt[st+1],pt[st+2],pt[st+3],pt[st+4],er,He),st===0&&mn===!0&&jt.copy(He));break;case"Z":case"z":At.currentPath.autoClose=!0,0<At.currentPath.curves.length&&(He.copy(jt),At.currentPath.currentPoint.copy(He),Tn=!0);break;default:console.warn(Zt)}mn=!1}return At}(V));break;case"rect":ne=T(V,ne),ve=function(Rt){var At=ee(Rt.getAttribute("x")||0),He=ee(Rt.getAttribute("y")||0),Gt=ee(Rt.getAttribute("rx")||Rt.getAttribute("ry")||0),jt=ee(Rt.getAttribute("ry")||Rt.getAttribute("rx")||0),Tn=ee(Rt.getAttribute("width")),mn=ee(Rt.getAttribute("height")),Qn=.448084975506,gt=new w.ShapePath;return gt.moveTo(At+Gt,He),gt.lineTo(At+Tn-Gt,He),Gt===0&&jt===0||gt.bezierCurveTo(At+Tn-Gt*Qn,He,At+Tn,He+jt*Qn,At+Tn,He+jt),gt.lineTo(At+Tn,He+mn-jt),Gt===0&&jt===0||gt.bezierCurveTo(At+Tn,He+mn-jt*Qn,At+Tn-Gt*Qn,He+mn,At+Tn-Gt,He+mn),gt.lineTo(At+Gt,He+mn),Gt===0&&jt===0||gt.bezierCurveTo(At+Gt*Qn,He+mn,At,He+mn-jt*Qn,At,He+mn-jt),gt.lineTo(At,He+jt),Gt===0&&jt===0||gt.bezierCurveTo(At,He+jt*Qn,At+Gt*Qn,He,At+Gt,He),gt}(V);break;case"polygon":ne=T(V,ne),le=V,Re=new w.ShapePath,Ye=0,le.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,function(Rt,At,He){var Gt=ee(At),jt=ee(He);Ye===0?Re.moveTo(Gt,jt):Re.lineTo(Gt,jt),Ye++}),Re.currentPath.autoClose=!0,ve=Re;break;case"polyline":ne=T(V,ne),J=V,ge=new w.ShapePath,oe=0,J.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,function(Rt,At,He){var Gt=ee(At),jt=ee(He);oe===0?ge.moveTo(Gt,jt):ge.lineTo(Gt,jt),oe++}),ge.currentPath.autoClose=!1,ve=ge;break;case"circle":ne=T(V,ne),ve=function(Rt){var At=ee(Rt.getAttribute("cx")||0),He=ee(Rt.getAttribute("cy")||0),Gt=ee(Rt.getAttribute("r")||0),jt=new w.Path;jt.absarc(At,He,Gt,0,2*Math.PI,!1);var Tn=new w.ShapePath;return Tn.subPaths.push(jt),Tn}(V);break;case"ellipse":ne=T(V,ne),ve=function(Rt){var At=ee(Rt.getAttribute("cx")||0),He=ee(Rt.getAttribute("cy")||0),Gt=ee(Rt.getAttribute("rx")||0),jt=ee(Rt.getAttribute("ry")||0),Tn=new w.Path;Tn.absellipse(At,He,Gt,jt,0,2*Math.PI,void 0,void 0);var mn=new w.ShapePath;return mn.subPaths.push(Tn),mn}(V);break;case"line":ne=T(V,ne),he=ee((ie=V).getAttribute("x1")||0),be=ee(ie.getAttribute("y1")||0),je=ee(ie.getAttribute("x2")||0),xe=ee(ie.getAttribute("y2")||0),(Fe=new w.ShapePath).moveTo(he,be),Fe.lineTo(je,xe),Fe.currentPath.autoClose=!1,ve=Fe;break;case"defs":se=!1;break;case"use":ne=T(V,ne);var Ee=V.href.baseVal.substring(1),rt=V.viewportElement.getElementById(Ee);rt?q(rt,ne):console.warn("SVGLoader: 'use node' references non-existent node id: "+Ee)}if(ve&&(ne.fill!==void 0&&ne.fill!=="none"&&ve.color.setStyle(ne.fill),function(Rt,At){function He(Xn){y.set(Xn.x,Xn.y,1).applyMatrix3(At),Xn.set(y.x,y.y)}for(var Gt=function(Xn){return Xn.elements[1]!==0||Xn.elements[3]!==0}(At),jt=Rt.subPaths,Tn=0,mn=jt.length;Tn<mn;Tn++)for(var Qn=jt[Tn].curves,gt=0;gt<Qn.length;gt++){var ze=Qn[gt];ze.isLineCurve?(He(ze.v1),He(ze.v2)):ze.isCubicBezierCurve?(He(ze.v0),He(ze.v1),He(ze.v2),He(ze.v3)):ze.isQuadraticBezierCurve?(He(ze.v0),He(ze.v1),He(ze.v2)):ze.isEllipseCurve&&(Gt&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),h.set(ze.aX,ze.aY),He(h),ze.aX=h.x,ze.aY=h.y,ze.xRadius*=(Rn=At.elements,Math.sqrt(Rn[0]*Rn[0]+Rn[1]*Rn[1])),ze.yRadius*=(Zt=At.elements,Math.sqrt(Zt[3]*Zt[3]+Zt[4]*Zt[4])))}var Zt,Rn}(ve,j),k.push(ve),ve.userData={node:V,style:ne}),se)for(var tt=V.childNodes,xt=0;xt<tt.length;xt++)q(tt[xt],ne);Be&&(W.pop(),0<W.length?j.copy(W[W.length-1]):j.identity())}}(Y.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:k,xml:Y.documentElement}},U.createShapes=function(N){var D=999999999,f={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},P={loc:f.ORIGIN,t:0};function T(C,F,M,a){var h=C.x,y=F.x,j=M.x,Y=a.x,q=C.y,V=F.y,ne=M.y,ie=a.y,he=(Y-j)*(q-ne)-(ie-ne)*(h-j),be=(ie-ne)*(y-h)-(Y-j)*(V-q),je=he/be,xe=((y-h)*(q-ne)-(V-q)*(h-j))/be;if(be==0&&he!=0||je<=0||1<=je||xe<0||1<xe)return null;if(he==0&&be==0){for(var Fe=0;Fe<2;Fe++){if(B(Fe===0?M:a,C,F),P.loc==f.ORIGIN)return{x:(J=Fe===0?M:a).x,y:J.y,t:P.t};if(P.loc==f.BETWEEN)return{x:+(h+P.t*(y-h)).toPrecision(10),y:+(q+P.t*(V-q)).toPrecision(10),t:P.t}}return null}for(Fe=0;Fe<2;Fe++){var J;if(B(Fe===0?M:a,C,F),P.loc==f.ORIGIN)return{x:(J=Fe===0?M:a).x,y:J.y,t:P.t}}return{x:+(h+je*(y-h)).toPrecision(10),y:+(q+je*(V-q)).toPrecision(10),t:je}}function B(C,F,M){var a,h=M.x-F.x,y=M.y-F.y,j=C.x-F.x,Y=C.y-F.y,q=h*Y-j*y;return C.x===F.x&&C.y===F.y?(P.loc=f.ORIGIN,P.t=0):C.x===M.x&&C.y===M.y?(P.loc=f.DESTINATION,P.t=1,0):void(q<-Number.EPSILON?P.loc=f.LEFT:q>Number.EPSILON?P.loc=f.RIGHT:h*j<0||y*Y<0?P.loc=f.BEHIND:Math.sqrt(h*h+y*y)<Math.sqrt(j*j+Y*Y)?P.loc=f.BEYOND:(a=h!=0?j/h:Y/y,P.loc=f.BETWEEN,P.t=a))}function G(C,F,M){var a=new w.Vector2;F.getCenter(a);var h=[];return M.forEach(function(y){y.boundingBox.containsPoint(a)&&function(j,Y){for(var q=[],V=[],ne=1;ne<j.length;ne++)for(var ie=j[ne-1],he=j[ne],be=function(xe){var Fe=Y[xe-1],J=Y[xe],ge=T(ie,he,Fe,J);ge!==null&&q.find(function(oe){return oe.t<=ge.t+Number.EPSILON&&oe.t>=ge.t-Number.EPSILON})===void 0&&(q.push(ge),V.push(new w.Vector2(ge.x,ge.y)))},je=1;je<Y.length;je++)be(je);return V}(C,y.points).forEach(function(j){h.push({identifier:y.identifier,isCW:y.isCW,point:j})})}),h.sort(function(y,j){return y.point.x-j.point.x}),h}var R=0,_=D,ee=-D,k=N.subPaths.map(function(C){for(var F=C.getPoints(),M=-D,a=D,h=-D,y=D,j=0;j<F.length;j++){var Y=F[j];Y.y>M&&(M=Y.y),Y.y<a&&(a=Y.y),Y.x>h&&(h=Y.x),Y.x<y&&(y=Y.x)}return ee<=h&&(ee=h+1),y<=_&&(_=y-1),{curves:C.curves,points:F,isCW:w.ShapeUtils.isClockWise(F),identifier:R++,boundingBox:new w.Box2(new w.Vector2(y,a),new w.Vector2(h,M))}});k=k.filter(function(C){return 1<C.points.length}),R=0;var E=(k=k.map(function(C){return C.identifier=R,R++,C})).map(function(C){return function(F,M,a,h,y){y!=null&&y!==""||(y="nonzero");var j=new w.Vector2;F.boundingBox.getCenter(j);var Y=G([new w.Vector2(a,j.y),new w.Vector2(h,j.y)],F.boundingBox,M);Y.sort(function(ge,oe){return ge.point.x-oe.point.x});var q=[],V=[];Y.forEach(function(ge){ge.identifier===F.identifier?q.push(ge):V.push(ge)});for(var ne=q[0].point.x,ie=[],he=0;he<V.length&&V[he].point.x<ne;)0<ie.length&&ie[ie.length-1]===V[he].identifier?ie.pop():ie.push(V[he].identifier),he++;if(ie.push(F.identifier),y==="evenodd"){var be=ie.length%2==0,je=ie[ie.length-2];return{identifier:F.identifier,isHole:be,for:je}}if(y==="nonzero"){be=!0;for(var xe=je=null,Fe=0;Fe<ie.length;Fe++){var J=ie[Fe];be?(xe=M[J].isCW,be=!1,je=J):xe!==M[J].isCW&&(xe=M[J].isCW,be=!0)}return{identifier:F.identifier,isHole:be,for:je}}console.warn('fill-rule: "'+y+'" is currently not implemented.')}(C,k,_,ee,N.userData.style.fillRule)}),W=[];return k.forEach(function(C){if(!E[C.identifier].isHole){var F=new w.Shape;F.curves=C.curves,E.filter(function(M){return M.isHole&&M.for===C.identifier}).forEach(function(M){var a=k[M.identifier],h=new w.Path;h.curves=a.curves,F.holes.push(h)}),W.push(F)}}),W},U.getStrokeStyle=function(N,D,f,P,T){return{strokeColor:D=D!==void 0?D:"#000",strokeWidth:N=N!==void 0?N:1,strokeLineJoin:f=f!==void 0?f:"miter",strokeLineCap:P=P!==void 0?P:"butt",strokeMiterLimit:T=T!==void 0?T:4}},U.pointsToStroke=function(N,D,f,P){var T=[],B=[],G=[];if(U.pointsToStrokeWithBuffers(N,D,f,P,T,B,G)===0)return null;var R=new w.BufferGeometry;return R.setAttribute("position",new w.Float32BufferAttribute(T,3)),R.setAttribute("normal",new w.Float32BufferAttribute(B,3)),R.setAttribute("uv",new w.Float32BufferAttribute(G,2)),R},U.pointsToStrokeWithBuffers=function(N,D,f,P,T,B,G,R){var _=new w.Vector2,ee=new w.Vector2,k=new w.Vector2,E=new w.Vector2,W=new w.Vector2,C=new w.Vector2,F=new w.Vector2,M=new w.Vector2,a=new w.Vector2,h=new w.Vector2,y=new w.Vector2,j=new w.Vector2,Y=new w.Vector2,q=new w.Vector2,V=new w.Vector2,ne=new w.Vector2,ie=new w.Vector2;f=f!==void 0?f:12,P=P!==void 0?P:.001,R=R!==void 0?R:0;var he=(N=function(qt){for(var xn=!1,nn=1,er=qt.length-1;nn<er;nn++)if(qt[nn].distanceTo(qt[nn+1])<P){xn=!0;break}if(!xn)return qt;var kr=[];for(kr.push(qt[0]),nn=1,er=qt.length-1;nn<er;nn++)qt[nn].distanceTo(qt[nn+1])>=P&&kr.push(qt[nn]);return kr.push(qt[qt.length-1]),kr}(N)).length;if(he<2)return 0;var be,je,xe,Fe,J,ge,oe=N[0].equals(N[he-1]),le=N[0],Re=D.strokeWidth/2,Ye=1/(he-1),Be=0,se=!1,ve=0,Ee=3*R,rt=2*R;gt(N[0],N[1],_).multiplyScalar(Re),M.copy(N[0]).sub(_),a.copy(N[0]).add(_),h.copy(M),y.copy(a);for(var tt=1;tt<he;tt++){be=N[tt],je=tt===he-1?oe?N[1]:void 0:N[tt+1];var xt=_;if(gt(le,be,xt),k.copy(xt).multiplyScalar(Re),j.copy(be).sub(k),Y.copy(be).add(k),xe=Be+Ye,Fe=!1,je!==void 0){gt(be,je,ee),k.copy(ee).multiplyScalar(Re),q.copy(be).sub(k),V.copy(be).add(k),J=!0,k.subVectors(je,le),xt.dot(k)<0&&(J=!1),tt===1&&(se=J),k.subVectors(je,be),k.normalize();var Rt=Math.abs(xt.dot(k));if(Rt!==0){var At=Re/Rt;k.multiplyScalar(-At),E.subVectors(be,le),W.copy(E).setLength(At).add(k),ne.copy(W).negate();var He=W.length(),Gt=E.length();E.divideScalar(Gt),C.subVectors(je,be);var jt=C.length();switch(C.divideScalar(jt),E.dot(ne)<Gt&&C.dot(ne)<jt&&(Fe=!0),ie.copy(W).add(be),ne.add(be),ge=!1,Fe?J?(V.copy(ne),Y.copy(ne)):(q.copy(ne),j.copy(ne)):Rn(),D.strokeLineJoin){case"bevel":Xn(J,Fe,xe);break;case"round":pt(J,Fe),J?Zt(be,j,q,xe,0):Zt(be,V,Y,xe,1);break;default:var Tn=Re*D.strokeMiterLimit/He;if(Tn<1){if(D.strokeLineJoin!=="miter-clip"){Xn(J,Fe,xe);break}pt(J,Fe),J?(C.subVectors(ie,j).multiplyScalar(Tn).add(j),F.subVectors(ie,q).multiplyScalar(Tn).add(q),ze(j,xe,0),ze(C,xe,0),ze(be,xe,.5),ze(be,xe,.5),ze(C,xe,0),ze(F,xe,0),ze(be,xe,.5),ze(F,xe,0),ze(q,xe,0)):(C.subVectors(ie,Y).multiplyScalar(Tn).add(Y),F.subVectors(ie,V).multiplyScalar(Tn).add(V),ze(Y,xe,1),ze(C,xe,1),ze(be,xe,.5),ze(be,xe,.5),ze(C,xe,1),ze(F,xe,1),ze(be,xe,.5),ze(F,xe,1),ze(V,xe,1))}else Fe?(J?(ze(a,Be,1),ze(M,Be,0),ze(ie,xe,0),ze(a,Be,1),ze(ie,xe,0),ze(ne,xe,1)):(ze(a,Be,1),ze(M,Be,0),ze(ie,xe,1),ze(M,Be,0),ze(ne,xe,0),ze(ie,xe,1)),J?q.copy(ie):V.copy(ie)):J?(ze(j,xe,0),ze(ie,xe,0),ze(be,xe,.5),ze(be,xe,.5),ze(ie,xe,0),ze(q,xe,0)):(ze(Y,xe,1),ze(ie,xe,1),ze(be,xe,.5),ze(be,xe,.5),ze(ie,xe,1),ze(V,xe,1)),ge=!0}}else Rn()}else Rn();oe||tt!==he-1||st(N[0],h,y,J,!0,Be),Be=xe,le=be,M.copy(q),a.copy(V)}if(oe){if(Fe&&T){var mn=ie,Qn=ne;se!==J&&(mn=ne,Qn=ie),J?(ge||se)&&(Qn.toArray(T,0),Qn.toArray(T,9),ge&&mn.toArray(T,3)):!ge&&se||(Qn.toArray(T,3),Qn.toArray(T,9),ge&&mn.toArray(T,0))}}else st(be,j,Y,J,!1,xe);return ve;function gt(qt,xn,nn){return nn.subVectors(xn,qt),nn.set(-nn.y,nn.x).normalize()}function ze(qt,xn,nn){T&&(T[Ee]=qt.x,T[Ee+1]=qt.y,T[Ee+2]=0,B&&(B[Ee]=0,B[Ee+1]=0,B[Ee+2]=1),Ee+=3,G&&(G[rt]=xn,G[rt+1]=nn,rt+=2)),ve+=3}function Zt(qt,xn,nn,er,kr){_.copy(xn).sub(qt).normalize(),ee.copy(nn).sub(qt).normalize();var ct=Math.PI,Ue=_.dot(ee);Math.abs(Ue)<1&&(ct=Math.abs(Math.acos(Ue))),ct/=f,k.copy(xn);for(var lt=0,Wt=f-1;lt<Wt;lt++)E.copy(k).rotateAround(qt,ct),ze(k,er,kr),ze(E,er,kr),ze(qt,er,.5),k.copy(E);ze(E,er,kr),ze(nn,er,kr),ze(qt,er,.5)}function Rn(){ze(a,Be,1),ze(M,Be,0),ze(j,xe,0),ze(a,Be,1),ze(j,xe,1),ze(Y,xe,0)}function Xn(qt,xn,nn){xn?(qt?(ze(a,Be,1),ze(M,Be,0),ze(j,xe,0),ze(a,Be,1),ze(j,xe,0),ze(ne,xe,1),ze(j,nn,0),ze(q,nn,0)):(ze(a,Be,1),ze(M,Be,0),ze(Y,xe,1),ze(M,Be,0),ze(ne,xe,0),ze(Y,xe,1),ze(Y,nn,1),ze(V,nn,0)),ze(ne,nn,.5)):(qt?(ze(j,nn,0),ze(q,nn,0)):(ze(Y,nn,1),ze(V,nn,0)),ze(be,nn,.5))}function pt(qt,xn){xn&&(qt?(ze(a,Be,1),ze(M,Be,0),ze(j,xe,0),ze(a,Be,1),ze(j,xe,0),ze(ne,xe,1),ze(j,Be,0),ze(be,xe,.5),ze(ne,xe,1),ze(be,xe,.5),ze(q,Be,0),ze(ne,xe,1)):(ze(a,Be,1),ze(M,Be,0),ze(Y,xe,1),ze(M,Be,0),ze(ne,xe,0),ze(Y,xe,1),ze(Y,Be,1),ze(ne,xe,0),ze(be,xe,.5),ze(be,xe,.5),ze(ne,xe,0),ze(V,Be,1)))}function st(qt,xn,nn,er,kr,ct){switch(D.strokeLineCap){case"round":kr?Zt(qt,nn,xn,ct,.5):Zt(qt,xn,nn,ct,.5);break;case"square":if(kr)_.subVectors(xn,qt),ee.set(_.y,-_.x),k.addVectors(_,ee).add(qt),E.subVectors(ee,_).add(qt),er?(k.toArray(T,3),E.toArray(T,0),E.toArray(T,9)):(k.toArray(T,3),k.toArray(T,9),E.toArray(T,0));else{_.subVectors(nn,qt),ee.set(_.y,-_.x),k.addVectors(_,ee).add(qt),E.subVectors(ee,_).add(qt);var Ue=T.length;er?(k.toArray(T,Ue-3),E.toArray(T,Ue-6)):(k.toArray(T,Ue-6),E.toArray(T,Ue-3)),E.toArray(T,Ue-12)}}}},U);function U(N){var D=u.call(this,N)||this;return D.defaultDPI=90,D.defaultUnit="px",D}s.SVGLoader=L},{three:19}],60:[function(b,r,s){var o,v=this&&this.__extends||(o=function(a,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,j){y.__proto__=j}||function(y,j){for(var Y in j)Object.prototype.hasOwnProperty.call(j,Y)&&(y[Y]=j[Y])})(a,h)},function(a,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function y(){this.constructor=a}o(a,h),a.prototype=h===null?Object.create(h):(y.prototype=h.prototype,new y)});Object.defineProperty(s,"__esModule",{value:!0}),s.MxTest=void 0;var u,w,L,U=b("../Operate/MrxDbgUiPrBase"),N=b("../Operate/MrxDbgUiPrPoint"),D=b("../MxThreeJS"),f=b("three"),P=b("../MxFun"),T=b("../View/MxDbEntity"),B=b("../MrxDbgUtils"),G=b("../Operate/MrxDbgUiPrDist"),R=(b("../MxString"),v(_,u=T.MxDbEntityUserObject),_.prototype.worldDraw=function(a){var h=new f.Vector3(this.pt.x-this.r,this.pt.y-this.r,0),y=new f.Vector3(this.pt.x+this.r,this.pt.y+this.r,0);new f.Vector3(h.x,y.y);var j=new f.Vector3(y.x,h.y);a.setDashLineDisplay(!0),a.setDash(.1,.2),a.drawLine(j,h)},_.prototype.setPoint=function(a){this.pt=a},_.prototype.setR=function(a){this.r=a},_.prototype.getTypeName=function(){return"MxDbTest"},_.prototype.getGripPoints=function(){var a=[];return a.push(this.pt),a},_.prototype.moveGripPointsAt=function(a,h){return a==0&&this.pt.add(h),!0},_.prototype.dwgIn=function(a){return u.prototype.dwgIn.call(this,a),this.pt.copy(a.pt),this.r=a.r,!0},_.prototype.dwgOut=function(a){return u.prototype.dwgOut.call(this,a),a.pt=this.pt,a.r=this.r,a},_.prototype.create=function(){return new _},_);function _(){var a=u!==null&&u.apply(this,arguments)||this;return a.pt=new f.Vector3,a.r=100,a}function ee(a){var h=new N.MrxDbgUiPrPoint;h.setMessage(`
:`),h.go(function(y){if(y==0){var j=h.value(),Y=new f.Vector3;Y.x=j.x,Y.y=j.y;var q=new U.McEdGetPointWorldDrawObject;q.setDraw(function(V,ne){ne.setColor(255),ne.drawLine(V,Y)}),h.setUserDraw(q),h.setMessage(`
:`),h.go(function(V){if(V==0){var ne=h.value(),ie=P.MxFun.getCurrentDraw(),he=D.MxThreeJS.createLine(j,ne,16777215);ie.addObject(he)}})}})}function k(){var a=new N.MrxDbgUiPrPoint;a.setMessage(`
:`),a.go(function(h){if(h==0){var y=P.MxFun.getCurrentDraw(),j=new R;j.setColor(16711680),j.setPoint(a.value()),j.setR(y.viewCoordLong2Cad(100)),y.addMxEntity(j),y.addMxCurrentSelect(j.objectId())}})}function E(){B.MrxDbgUtils.selectEnt("Test").then(function(a){console.log(a)})}function W(){var a=P.MxFun.getCurrentDraw();L?(a.eraseAllMxEntity(),a.loadMxEntityFromJson(L)):(L=a.saveMxEntityToJson(),console.log(L))}function C(){P.MxFun.openFile("demo/buf/hhhh.dwg?token=123456")}function F(){var a=new N.MrxDbgUiPrPoint;a.setMessage(`
:`),a.go(function(h){if(h==0){var y=a.value();B.MrxDbgUtils.getCorner(y,"Test",!0).then(function(j){console.log("xxxdddd"),console.log(j)})}})}function M(){var a=new G.MrxDbgUiPrDist;a.setMessage(`
:`),a.go(function(h){if(h==0){var y=a.value();console.log(y)}})}(w||(s.MxTest=w={})).registerCommand=function(){console.log("regist mx test"),new R().init(),P.MxFun.addCommand("MxTest_GetPoint",ee),P.MxFun.addCommand("MxTest_GetDist",M),P.MxFun.addCommand("MxTest_DrawCustomEntity",k),P.MxFun.addCommand("MxTest_EntSel",E),P.MxFun.addCommand("MxTest_SaveMxDbEntityToJson",W),P.MxFun.addCommand("MxTest_OpenFile",C),P.MxFun.addCommand("MxTest_GetCorner",F),P.MxFun.addWindowsEvent(function(a,h){if(a=="mouseup"){if(P.MxFun.isRunningCommand()||h.button!=0)return 0;var y=h.srcElement;if(y&&y.tagName=="CANVAS"){var j=P.MxFun.getCurrentDraw(),Y=new f.Vector3(h.offsetX,h.offsetY,0);j.findMxEntityAtPoint(Y,!1).length&&h.preventDefault()}return 0}})}},{"../MrxDbgUtils":20,"../MxFun":27,"../MxString":34,"../MxThreeJS":36,"../Operate/MrxDbgUiPrBase":44,"../Operate/MrxDbgUiPrDist":45,"../Operate/MrxDbgUiPrPoint":46,"../View/MxDbEntity":68,three:19}],61:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.MxUiObject=exports.MxToolBarItem=exports.MxMenuItem=void 0;var MxFun_1=require("../MxFun"),MxMenuItem=function(){this.id=-1,this.text="",this.evalString="",this.parentId=-1};exports.MxMenuItem=MxMenuItem;var MxToolBarItem=function(){this.isMxCommand=!1,this.itemid=""};exports.MxToolBarItem=MxToolBarItem;var MxUiObject=function(){function MxUiObject(){this.vecMenuItem=new Array,this.vecToolBarItem=new Array,this.uiPath="./ui",this.idMenuItemCount=100,this.isShowTitle=!1,this.isShowStructTree=!1,this.isEnableLoading=!0,this.isShowLayer=!1,this.isShowTakeColor=!1,this.isShowLayout=!1,this.isEnableObjectProperty=!1,this.isShowToolbar=!1,this.isShowMainMenu=!1,this.sTitle="",this.sLanguageTable={layout:"",layer:"",visible:"",color:"",name:"",status:"",openComplete:""}}return MxUiObject.prototype.SetLayoutData=function(b){this.vecLayoutData=b},MxUiObject.prototype.CallMxCommand=function(b){MxFun_1.MxFun.callCommand(b,"")},MxUiObject.prototype.EvalJs=function(value){eval(value)},MxUiObject.prototype.SetLayerData=function(b){this.vecLayerData=b},MxUiObject.prototype.SetSketchLayerData=function(b){this.vecSketchLayerData=b},MxUiObject.prototype.init=function(){this.onInit()},MxUiObject.prototype.addMenuItem=function(b,r,s,o){r===void 0&&(r=""),s===void 0&&(s=-1),o===void 0&&(o=-1);var v=new MxMenuItem;v.text=b,v.evalString=r,o==-1&&(o=this.idMenuItemCount,this.idMenuItemCount++),v.id=o,v.parentId=s,this.vecMenuItem.push(v)},MxUiObject.prototype.addToolBarItem=function(b,r,s,o,v){r===void 0&&(r=""),s===void 0&&(s=""),o===void 0&&(o=!1),v===void 0&&(v="");var u=new MxToolBarItem;u.image=b,u.evalString=s,u.text=r,u.isMxCommand=o,u.itemid=v,this.vecToolBarItem.push(u)},MxUiObject.prototype.setPath=function(b){this.uiPath=b},MxUiObject.prototype.getPath=function(){return this.uiPath},MxUiObject.prototype.create=function(){this.onCreate()},MxUiObject.prototype.writeUICSS=function(){var b=this.uiPath;MxFun_1.MxFun.isPC()?(document.write("<link rel='stylesheet' href='"+b+"/css/mxbimpcm.css'>"),this.isShowMainMenu&&(document.write("<link rel='stylesheet' href='"+b+"/css/rightfacefonts2.css'>"),document.write("<link rel='stylesheet' href='"+b+"/css/rightmnu.css'>"),document.write("<script type='text/javascript' src='"+b+"/hc-mobile-nav.js'><\/script>"))):(document.write("<link rel='stylesheet' href='"+b+"/css/mxmobile.css'>"),this.isShowMainMenu&&(document.write("<link href='"+b+"/css/font-awesome.min.css' rel='stylesheet'>"),document.write("<link rel='stylesheet' href='"+b+"/css/rightfacefonts1.css'>"),document.write("<link rel='stylesheet' href='"+b+"/css/rightfacefonts2.css'>"),document.write("<link rel='stylesheet' href='"+b+"/css/rightmnu.css'>"),document.write("<script type='text/javascript' src='"+b+"/hc-mobile-nav.js'><\/script>")))},MxUiObject}();exports.MxUiObject=MxUiObject},{"../MxFun":27}],62:[function(b,r,s){var o,v=this&&this.__extends||(o=function(D,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,T){P.__proto__=T}||function(P,T){for(var B in T)Object.prototype.hasOwnProperty.call(T,B)&&(P[B]=T[B])})(D,f)},function(D,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function P(){this.constructor=D}o(D,f),D.prototype=f===null?Object.create(f):(P.prototype=f.prototype,new P)});Object.defineProperty(s,"__esModule",{value:!0}),s.MxUiObjectMobile=void 0;var u,w=b("./MxUiObject"),L=b("../MxFun"),U=(v(N,u=w.MxUiObject),N.prototype.onCreate=function(){this.isShowTitle&&this.WriteTitle(),this.WriteStructTree(),this.isEnableLoading&&this.WriteLoading(),this.WriteLayer(),this.WriteTakeColor(),this.WriteLayout(),this.isEnableObjectProperty&&this.WriteObjectProperty(),this.isShowToolbar&&this.WriteToolbar()},N.prototype.onInit=function(){this.InitEvent()},N.prototype.ShowLoading=function(){this.isEnableLoading&&($(".Prompt").css("background","rgba(0, 0, 0, 0)"),$(".Prompt").fadeIn(100),$(".Prompt span").css("display","none"))},N.prototype.HideLoading=function(){this.isEnableLoading&&($(".Prompt").css("background","rgba(0, 0, 0, 0.8)"),$(".Prompt div").fadeOut(100),$(".Prompt span").fadeIn(200),setTimeout(function(){$(".Prompt").fadeOut(1e3)},1e3))},N.prototype.ShowObjectProperty=function(D){if(D.length!=0){var f;f=typeof D=="string"?JSON.parse(D):D;var P="";for(var T in f){var B=f[T];for(var G in P+='<tbody class="bf-group undefined bf-collapse">',P+='<tr class="bf-group-title">',P+='<td colspan="2"><i class="bf-icon" style=" padding: 12px;"></i>'+B.name+"</td>",P+="</tr>",B.datas){var R=B.datas[G];P+="<tr class='bf-group-content'>",P+="<td class='bf-key'>"+R.name+"</td>",P+="<td class='bf-value'>"+R.value+"</td>",P+="</tr>"}P+="</tbody>"}document.getElementById("ComponentContent").innerHTML=P,$(".bf-group").click(function(){$(this).hasClass("bf-collapse")?$(this).removeClass("bf-collapse"):$(this).addClass("bf-collapse")})}},N.prototype.HideObjectProp=function(){},N.prototype.SwitchShowLayer=function(){var D=document.getElementById("LayerInterface");D.style.display=="none"?(D.style.display="block",D.style.left="80px",D.style.top="50px"):D.style.display="none"},N.prototype.SwitchShowStructTree=function(){},N.prototype.Chosecolor=function(){document.getElementById("color-picker").click()},N.prototype.ColorChange=function(D){document.getElementById("colorbox").style.backgroundColor=D,L.MxFun.setCurrentColor(D)},N.prototype.SwitchShowLayout=function(){var D=document.getElementById("LayerOutInterface");D.style.display=="none"?D.style.display="block":D.style.display="none"},N.prototype.WriteTitle=function(){var D=this.uiPath;document.write("<div class='bar1'>"),document.write("<img src='"+D+"/image/mxcad.png' style='height: 50%;position: absolute;top: 12px;left: 10px;'>"),document.write("<span  class='barspan'  style='position: absolute;left: 45px;'>"),document.write("</span>"),document.write("<div id='container'>"),this.isShowMainMenu&&(document.write("<header>"),document.write("<div class='wrapper cf'style='z-index: 999'>"),document.write("<nav id='main-nav' >"),document.write("</nav>"),document.write("<a class='toggle'>"),document.write("<span></span>"),document.write("</a>"),document.write("</div>"),document.write("</header>")),document.write("</div>"),document.write("</div>")},N.prototype.WriteToolbar=function(){document.write("<div id='MainMenuContent' class='bf-toolbar bf-toolbar-bottom'>"),document.write("</div>")},N.prototype.WriteLoading=function(){var D=this.uiPath;document.write("<div class='Prompt' style='width: 100px;height:30px;position:"),document.write("absolute;top: 60px;left: 50%;margin-left: -50px;color: #fff;text-align: center;'>"),document.write("<div style='text-align: center;'>"),document.write("<img src='"+D+"/image/loading.gif' alt='' style='width:30px;height:30px;float: left'>"),document.write("<p style='color:black;vertical-align: middle;float: left;  margin-top: 5px;margin-left: 5px;'>.....</p>"),document.write("</div>"),document.write("<span style='vertical-align: middle;display: none'></span>"),document.write("</div>")},N.prototype.WriteLayer=function(){var D=this.uiPath;this.isShowLayer&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' title='ModelTree' style='position: absolute; top:111px;left: 0px;' onclick='uiObj.SwitchShowLayer()'>"),document.write("<div class='bf-button mxbim-bf-tree' title=''>"),document.write("<img src='"+D+"/image/layer.png.gif' alt='' style='width: 24px;'>"),document.write("</div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='LayerInterface' title=''"),document.write("style='left: 0px;"),document.write("top: 0px;"),document.write("width: 100%;"),document.write("height: 100%;"),document.write("display: none;'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowLayer()' style='text-align: center;'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;'></div>"),document.write("<div>"),document.write("<div class='layer-title' style='width: 12.5%;'></div>"),document.write("<div class='layer-title' style='width: 12.5%;'></div>"),document.write("<div class='layer-title' style='width: 62.5%'></div>"),document.write("<div class='layer-title' style='width: 12.5%'></div>"),document.write("</div>"),document.write("<div id='Layer-Info'  style='margin-top: 26px;height: 79%;width: 100%; position: absolute;overflow-y: auto;'>"),document.write("</div>"),document.write("</div>")},N.prototype.WriteStructTree=function(){this.isShowStructTree&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='Fmj' title='ModelTree'"),document.write("style='position: absolute; top:60px;left: 0px;' onclick='uiObj.SwitchShowStructTree()'>"),document.write("<div class='bf-button mxbim-bf-tree' title=''><i class='fa fa-sitemap' aria-hidden='true' style='font-size: 24px;'></i></div>"),document.write("</div>")),document.write("<div class='bf-panel  bf-has-title bf-sizable tree-panel' id='dv' title='' style='left: 0px; top: 0px; width: 100%; height: 100%; display: none;'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowStructTree()'><i class='fa fa-times fa-2x' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;'></div>"),document.write("<div class='bf-panel-body' style='padding-top: 57px;overflow-y: scroll;'>"),document.write("<div class='bf-panel-header'>"),document.write("<div class='bf-panel-header'>"),document.write("<div class='bf-tree-header' style='margin-top: -57px;'>"),document.write("<div class='bf-tabs bf-tabs-tree'>"),document.write("<ul class='bf-tabs-list'>"),document.write("<li class='bf-tabs-option my-option undefined active' id='component'></li>"),document.write("<li class='bf-tabs-option my-option undefined' id='area'></li>"),document.write("<li class='bf-tabs-option my-option undefined' id='drawing'></li>"),document.write("</ul>"),document.write("</div>"),document.write("</div>"),document.write("</div>"),document.write("</div>"),document.write("<div class='' style='margin-bottom: 100px;' id='DirectoryContent'>"),document.write("</div>"),document.write("</div>"),document.write("</div>")},N.prototype.WriteTakeColor=function(){var D=this.uiPath;this.isShowTakeColor&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='TakeColor'"),document.write("style='position: absolute;left: 0px; top: 162px;width: 45px; '>"),document.write("<div class='bf-button' onclick='uiObj.Chosecolor()' style='opacity: 1;width: 45px;'>"),document.write("<div  style='position: relative;margin-left: 10px;margin-top: -5px;'>"),document.write("<img src='"+D+"/image/color.png' alt='' style='width: 40px;margin-left: -21px;'>"),document.write("</div>"),document.write("<div id='colorbox' style='width: 30px;height: 5px;background-color: #cccccc;margin-left: -3px;margin-top: -5px;'>"),document.write("</div>"),document.write("<div style='width: 18px;height: 40px;float: right;margin-top: -38px;margin-left: 14px;position: absolute;'>"),document.write("<img src='"+D+"/image/daojiao.png' alt='' style='width: 15px;margin-top: 10px;z-index: 999;position: relative'>"),document.write("<input id='color-picker' type='color' value='#c0c0c0'   style='display: none' onchange='colorChange(value)'>"),document.write("</div>"),document.write("</div>"),document.write("</div>"))},N.prototype.WriteLayout=function(){var D=this.uiPath;this.isShowLayout&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='LayerOut'"),document.write("style='position: absolute;left: 0px; top: 213px; ' onclick='uiObj.SwitchShowLayout()'>"),document.write("<div class='bf-button'>"),document.write("<img src='"+D+"/image/layout.png' alt='' style='width: 24px;'>"),document.write("</div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='LayerOutInterface'"),document.write("style='left: 0; top: 0; width: 100%;display:none'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowLayout()'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' id='buju' style='cursor: move; user-select: none;'></div>"),document.write("<div>"),document.write("</div>"),document.write("<div id=''>"),document.write("<div>"),document.write("<table  class='bf-table'>"),document.write("<tbody class='bf-group'>"),document.write("<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>"),document.write("<td class='bf_layerout_td'  style='width: 60px' >"),document.write("<div class='bf_layer_div layer_on'></div>"),document.write("</td>"),document.write("<td  style='width: 238px' >"),document.write("<span  style='color: white;cursor: pointer;'>LayerOut</span>"),document.write("</td>"),document.write("</tr>"),document.write("<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>"),document.write("<td class='bf_layerout_td'  style='width: 60px' >"),document.write("<div class='bf_layer_div' ></div>"),document.write("</td>"),document.write("<td  style='width: 238px' >"),document.write("<span  style='color: white;cursor: pointer;'>LayerOut</span>"),document.write("</td>"),document.write("</tr>"),document.write("<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>"),document.write("<td class='bf_layerout_td'  style='width: 60px' >"),document.write("<div class='bf_layer_div' ></div>"),document.write("</td>"),document.write("<td  style='width: 238px' >"),document.write("<span  style='color: white;cursor: pointer;'>LayerOut</span>"),document.write("</td>"),document.write("</tr>"),document.write("<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>"),document.write("<td class='bf_layerout_td'  style='width: 60px' >"),document.write("<div class='bf_layer_div'></div>"),document.write("</td>"),document.write("<td  style='width: 238px' >"),document.write("<span  style='color: white;cursor: pointer;'>LayerOut</span>"),document.write("</td>"),document.write("</tr>"),document.write("</tbody>"),document.write("</table>"),document.write("</div>"),document.write("</div>"),document.write("</div>")},N.prototype.WriteObjectProperty=function(){document.write("<div class='bf-panel bf-has-title bf-sizable property-panel' id='fmj2' title='' style='left: 0px; top: 0px; width: 100%; height: 100%;display: none;'>"),document.write("<div class='bf-close' id='close2' style='top:4.0em;'><i class='fa fa-times fa-2x' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;'></div>"),document.write("<div class='bf-panel-body' style='padding-top: 41px;'>"),document.write("<div class='bf-panel-container bf-scroll-bar' style='top:0;width: 100%;height: 100%;overflow-y: auto;position: relative;'>"),document.write("<table class='bf-table' id='ComponentContent'>"),document.write("</table>"),document.write("</div>"),document.write("</div>"),document.write("</div>")},N.prototype.UpDisplayLayout=function(){},N.prototype.UpDisplayLayer=function(){var D=this.uiPath,f=this.vecLayerData,P=this.vecSketchLayerData,T="";if(P!=null){var B=P;for(var G in B){T+="<div>";var R="hide.png";B[G].off==0&&(R="show.png");var _="unlock.png";T+="<table class='bf-table'>",T+="<tbody class='bf-group'>",T+="<tr class='bf-group-title'>",T+='<td><img class="layer-enable" sketch=1 id='+B[G].id+' src="'+D+"/image/"+R+'"/></td>',T+='<td><span class="layer-color" style="background-color:'+B[G].color+'"></span></td>',T+='<td><span class="layer-text">_'+B[G].name+"</span></td>",T+='<td><img class="layer-state" src="'+D+"/image/"+_+'"/></td>',T+="</tr>",T+="</tbody>",T+="</table>",T+="</div>"}}if(f!=null)for(var G in B=f)T+="<div>",R="hide.png",B[G].off==0&&(R="show.png"),_="lock.png",T+="<table class='bf-table'>",T+="<tbody class='bf-group'>",T+="<tr class='bf-group-title'>",T+='<td><img class="layer-enable" sketch=0 id='+B[G].id+' src="'+D+"/image/"+R+'"/></td>',T+='<td><span class="layer-color" style="background-color:'+B[G].color+'"></span></td>',T+='<td><span class="layer-text">'+B[G].name+"</span></td>",T+='<td><img class="layer-state" src="'+D+"/image/"+_+'"/></td>',T+="</tr>",T+="</tbody>",T+="</table>",T+="</div>";var ee=document.getElementById("Layer-Info");ee!=null&&(ee.innerHTML=T)},N.prototype.WriteFooter=function(){document.write("<div class='footer' style='background: rgba(0, 0, 0, 0.7);min-width: auto;position: fixed;left: 0;bottom: 0;width: 100%;'>"),document.write("<div style='line-height: 40px;font-size: 12px;color: #999;padding: 0 10px;'>"),document.write("<p style='float: right;line-height: 15px;font-size: 12px;color: #999;display: block;'>"),document.write("<a style='color: #4a90e2;text-decoration: none;outline: none;' href='http://www.mxdraw.com/' target='_blank'>CAD</a>"),document.write("</p>"),document.write("<a style='color: #4a90e2;text-decoration: none;outline: none;' href='http://www.mxdraw.com' target='_blank'>MX3D</a> ICP15011727"),document.write("</div>"),document.write("</div>")},N.prototype.CreateToolBar=function(D){if(this.isShowToolbar){var f="";for(var P in D){var T=D[P],B="uiObj.CallMxCommand";T.isMxCommand||(B="uiObj.EvalJs"),0<T.itemid.length?f+='<div class="bf-button" onclick="'+B+"('"+D[P].evalString+`')"><img class="mainimage-bf-butto" id="`+T.itemid+'" src="'+this.uiPath+"\\image\\"+T.image+'" title="'+D[P].text+'"></div>':f+='<div class="bf-button" onclick="'+B+"('"+D[P].evalString+`')"><img class="mainimage-bf-butto" src="`+this.uiPath+"\\image\\"+T.image+'" title="'+D[P].text+'"></div>'}document.getElementById("MainMenuContent").innerHTML=f}},N.prototype.InitEvent=function(){var D=document.getElementById("LayerInterface");this.CreateToolBar(this.vecToolBarItem),D.style.display="none";var f=this.vecMenuItem;this.isShowMainMenu&&function(R){var _="";(function F(M,a){var h=function(j,Y){var q=new Array;for(var V in Y)Y[V].parentId==j&&q.push(Y[V]);return q}(M,a);if(0<h.length){for(var y in _+="<ul>",h)h[y].evalString.length!=0?(_+='<li><p class="li_option" ',_+=`onclick="uiObj.EvalJs('`+h[y].evalString+`')"`,_+=">"+h[y].text+"</p>"):(_+="<li><a ",_+=">"+h[y].text+"</a>"),F(h[y].id,a),_+="</li>";_+="</br>",_+="</br>",_+="</br>",_+="</ul>"}})(-1,f),R("#main-nav").append(_);var ee=R("#main-nav"),k=R(".toggle"),E={maxWidth:!1,customToggle:k,levelTitles:!0},W=null,C={};W&&W.remove(),k.off("click"),W=ee.clone(),R.extend(C,{side:"right"}),W.hcMobileNav(R.extend({},E,C))}(jQuery);var P=window.location.href,T=P.length,B=P.indexOf("?"),G=P.substr(B,T).split("=")[1];$(".barspan").html(decodeURIComponent(G)),$("#close2").click(function(){$(this).parent("div").fadeOut(200)}),$(".bf-select-current").click(function(){$(this).hasClass("bf-open")?$(this).removeClass("bf-open"):$(this).addClass("bf-open")}),$(".my-option").click(function(){var R=$(this);$(".my-option").each(function(){$(this).removeClass("active")}),R.addClass("active")}),$(".bf-select-option").click(function(){$(this).parent("ul").prev("span").html($(this).text()),$(this).parent("ul").prev("span").removeClass("bf-open")}),$(document).on("click",".layer-enable",function(){var R=L.MxFun.getUiObj().getPath(),_=parseInt($(this).attr("id")),ee=!0;$(this).attr("src")==R+"/image/show.png"?($(this).attr("src",R+"/image/hide.png"),ee=!1):$(this).attr("src",R+"/image/show.png"),L.MxFun.showLayer(_,ee)})},N.prototype.Fullscreen=function(){var D=document.documentElement;D.requestFullscreen?D.requestFullscreen():D.mozRequestFullScreen?D.mozRequestFullScreen():D.webkitRequestFullScreen&&D.webkitRequestFullScreen(),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),this.IsFullStatus()?($("img[title='']").attr("src",this.uiPath+"/image\\fullscreen1.gif"),$("img[title='']").attr("title","")):($("img[title='']").attr("src",this.uiPath+"/image\\escscreen1.gif"),$("img[title='']").attr("title",""))},N.prototype.IsFullStatus=function(){return(document.fullscreenEnabled||document.mozFullscreenElement||document.webkitFullscreenElement)!=null},N);function N(){return u!==null&&u.apply(this,arguments)||this}s.MxUiObjectMobile=U},{"../MxFun":27,"./MxUiObject":61}],63:[function(b,r,s){var o,v=this&&this.__extends||(o=function(D,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,T){P.__proto__=T}||function(P,T){for(var B in T)Object.prototype.hasOwnProperty.call(T,B)&&(P[B]=T[B])})(D,f)},function(D,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function P(){this.constructor=D}o(D,f),D.prototype=f===null?Object.create(f):(P.prototype=f.prototype,new P)});Object.defineProperty(s,"__esModule",{value:!0}),s.MxUiObjectPC=void 0;var u,w=b("./MxUiObject"),L=b("../MxFun"),U=(v(N,u=w.MxUiObject),N.prototype.onCreate=function(){this.isShowTitle&&this.WriteTitle(),this.WriteStructTree(),this.isEnableLoading&&this.WriteLoading(),this.WriteLayer(),this.WriteTakeColor(),this.WriteLayout(),this.isEnableObjectProperty&&this.WriteObjectProperty(),this.isShowToolbar&&this.WriteToolbar()},N.prototype.onInit=function(){this.InitEvent()},N.prototype.WriteTitle=function(){var D=this.uiPath;document.write("<div id='all'>"),document.write("   <div class='bar1'>"),document.write("   <img src="+D+"/image/mxcad.png style='height: 50%;position: absolute;top: 12px;left: 10px;'>"),document.write("   <span  class='barspan' style='position: absolute;left: 45px;'>"),document.write("   </span>"),document.write("   <div id='container'>"),this.isShowMainMenu&&(document.write("   <header>"),document.write("    <div class='wrapper cf'style='z-index: 999'>"),document.write("   <nav id='main-nav' >"),document.write("    </nav>"),document.write("    <a class='toggle'>"),document.write("   <span></span>"),document.write("    </a>"),document.write("    </div>"),document.write("    </header>")),document.write("    </div>"),document.write("    </div>")},N.prototype.WriteStructTree=function(){this.isShowStructTree&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='ModelTreeThumbnail' title=''"),document.write("style='position: absolute;left: 10px; top: 97px; ' onclick='uiObj.SwitchShowStructTree()'>"),document.write("<div class='bf-button mxbim-bf-tree' title=''><i class='fa fa-sitemap' aria-hidden='true'></i></div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='ModelTreeInterface' title=''"),document.write("style='left:0px; top: 0px; width: 300px; height: 416px;display: none'>"),document.write("   <div class='bf-close' onclick='uiObj.SwitchShowStructTree()'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;' id='mulushu'></div>"),document.write("<div class='bf-panel-body' style='padding-top: 36px;'>"),document.write("<div class='bf-panel-header'>"),document.write("<div class='bf-tree-header' style='margin-top: -36px;'>"),document.write("<div class='bf-select bf-select-tree'>"),document.write("<span class='bf-select-current'></span>"),document.write("<ul class='bf-select-list'>"),document.write("<li class='bf-select-option' id='type'></li>"),document.write("<li class='bf-select-option' id='file'></li>"),document.write("<li class='bf-select-option' id='area'></li>"),document.write("<li class='bf-select-option' id='drawing'></li>"),document.write("</ul>"),document.write("</div>"),document.write("</div>"),document.write("</div>"),document.write("<div id='DirectoryContent' class='bf-panel-container TreeInfo'>"),document.write("</div>"),document.write("</div>"),document.write("</div>")},N.prototype.WriteLoading=function(){var D=this.uiPath;document.write("<div class='Prompt'>"),document.write("<div style='text-align: center;'>"),document.write("<img src='"+D+"/image/loading.gif' alt='' style='width:30px;height:30px;float: left'>"),document.write("<p  style='color:black;vertical-align: middle;float: left; margin-top: 5px;margin-left: 5px;'>.....</p>"),document.write("</div>"),document.write("<span style='display: none'>"+this.sLanguageTable.openComplete+"</span>"),document.write("</div>")},N.prototype.WriteLayer=function(){var D=this.uiPath;this.isShowLayer&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='LayerThumbnail' title='"+this.sLanguageTable.layer+"'"),document.write("style='position: absolute;left: 10px; top: 45px; ' onclick='uiObj.SwitchShowLayer()'>"),document.write("<div class='bf-button'>"),document.write("<img src='"+D+"/image/layer.png.gif' alt='' style='width: 32px;'>"),document.write("</div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='LayerInterface'"),document.write("style='left: 10px; top: 50px; width: 300px; height: 416px;display: none'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowLayer(false)'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' id='tuceng' style='cursor: move; user-select: none;'>"+this.sLanguageTable.layer+"</div>"),document.write("<div>"),document.write("<div class='layer-title' style='width: 50px;font-size: 14px'>"+this.sLanguageTable.visible+"</div>"),document.write("<div class='layer-title' style='width: 50px;font-size: 14px'>"+this.sLanguageTable.color+"</div>"),document.write("<div class='layer-title' style='width: 148px;font-size: 14px'>"+this.sLanguageTable.name+"</div>"),document.write("<div class='layer-title' style='width: 50px;font-size: 14px'>"+this.sLanguageTable.status+"</div>"),document.write("</div>"),document.write("<div id='Layer-Info' style='margin-top: 25px;height: 349px;position: absolute;overflow-y: auto;'>"),document.write("</div>"),document.write("</div>")},N.prototype.WriteTakeColor=function(){var D=this.uiPath;this.isShowTakeColor&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='TakeColor' title=''"),document.write("style='position: absolute;left: 10px; top: 149px; '>"),document.write("<div class='bf-button' onclick='uiObj.Chosecolor()' style='opacity: 1;'>"),document.write("<img src='"+D+"/image/color.png' alt='' style='width: 40px;margin-left: -10px;'>"),document.write("<div id='colorbox' style='width: 35px;height: 5px;background-color: #cccccc;margin-left: -3px'>"),document.write("</div>"),document.write("<div style='width: 18px;height: 40px;float: right;margin-top: -42px;margin-left: 14px;'>"),document.write("<img src='"+D+"/image/daojiao.png' alt='' style='width: 15px;margin-top: 10px;z-index: 999;position: relative'>"),document.write("<input id='color-picker' type='color' value='#c0c0c0'   style='display: none' onchange='uiObj.ColorChange(value)'>"),document.write("</div>"),document.write("</div>"),document.write("</div>"))},N.prototype.WriteLayout=function(){var D=this.uiPath;this.isShowLayout&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='LayerOut' title='"+this.sLanguageTable.layout+"'"),document.write("style='position: absolute;left: 10px; top: 97px; ' onclick='uiObj.SwitchShowLayout()'>"),document.write("<div class='bf-button'>"),document.write("<img src='"+D+"/image/layout.png' alt='' style='width: 32px;'>"),document.write("</div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='LayerOutInterface'"),document.write("style='left: 10px; top: 50px; width: 300px;display:none'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowLayout()'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' id='buju' style='cursor: move; user-select: none;'>"+this.sLanguageTable.layout+"</div>"),document.write("<div>"),document.write("</div>"),document.write("<div id='layout-Info'>"),document.write("</div>"),document.write("</div>")},N.prototype.WriteObjectProperty=function(){document.write("<div class='bf-panel bf-has-title bf-sizable' id='StrcutInfoBase' title=''"),document.write("style='right: 10px; top: 45px; width: 300px; height: 416px;display: none'>"),document.write("<div class='bf-close' id='close2'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;'></div>"),document.write("<div id='ComponentContent' class='bf-panel-body StructInfo'></div>"),document.write("<div class='bf-resize'></div>"),document.write("</div>")},N.prototype.WriteToolbar=function(){document.write("<div id='MainMenuContent' class='bf-toolbar bf-toolbar-bottom' style='position: fixed'></div>")},N.prototype.CreateToolBar=function(D){if(this.isShowToolbar){var f="";for(var P in D){var T=D[P],B="uiObj.CallMxCommand";T.isMxCommand||(B="uiObj.EvalJs"),0<T.itemid.length?f+='<div class="bf-button" onclick="'+B+"('"+D[P].evalString+`')"><img class="mainimage-bf-butto" id="`+T.itemid+'" src="'+this.uiPath+"\\image\\"+T.image+'" title="'+D[P].text+'"></div>':f+='<div class="bf-button" onclick="'+B+"('"+D[P].evalString+`')"><img class="mainimage-bf-butto" src="`+this.uiPath+"\\image\\"+T.image+'" title="'+D[P].text+'"></div>'}document.getElementById("MainMenuContent").innerHTML=f}},N.prototype.UpDisplayLayer=function(){var D=this.uiPath,f=this.vecLayerData,P=this.vecSketchLayerData,T="";if(P!=null){var B=P;for(var G in B){T+="<div>";var R="hide.png";B[G].off==0&&(R="show.png");var _="unlock.png";T+="<table class='bf-table'>",T+="<tbody class='bf-group'>",T+="<tr class='bf-group-title'>",T+='<td><img class="layer-enable" sketch=1 id='+B[G].id+' src="'+D+"/image/"+R+'"/></td>',T+='<td><span class="layer-color" style="background-color:'+B[G].color+'"></span></td>',T+='<td><span class="layer-text">_'+B[G].name+"</span></td>",T+='<td><img class="layer-state" src="'+D+"/image/"+_+'"/></td>',T+="</tr>",T+="</tbody>",T+="</table>",T+="</div>"}}if(f!=null)for(var G in B=f)T+="<div>",R="hide.png",B[G].off==0&&(R="show.png"),_="lock.png",T+="<table class='bf-table'>",T+="<tbody class='bf-group'>",T+="<tr class='bf-group-title'>",T+='<td><img class="layer-enable" sketch=0 id='+B[G].id+' src="'+D+"/image/"+R+'"/></td>',T+='<td><span class="layer-color" style="background-color:'+B[G].color+'"></span></td>',T+='<td><span class="layer-text">'+B[G].name+"</span></td>",T+='<td><img class="layer-state" src="'+D+"/image/"+_+'"/></td>',T+="</tr>",T+="</tbody>",T+="</table>",T+="</div>";var ee=document.getElementById("Layer-Info");ee!=null&&(ee.innerHTML=T)},N.prototype.UpDisplayLayout=function(){var D=this.vecLayoutData,f="";if(f+="<div>",f+="<table  class='bf-table'>",f+="<tbody class='bf-group'>",f+="<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>",f+="<td class='bf_layerout_td'  style='width: 60px' >",f+="<div class='bf_layer_div layer_on'></div>",f+="</td>",f+="<td  style='width: 238px' >",f+="<span  class='layout-name' name='Model' style='color: white;cursor: pointer;'>Model</span>",f+="</td>",f+="</tr>",D!=null){var P=D;for(var T in P)f+="<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>",f+="<td class='bf_layerout_td'  style='width: 60px' >",f+="<div class='bf_layer_div layer_on'></div>",f+="</td>",f+="<td style='width: 238px' >",f+="<span class='layout-name' name='"+P[T]+"' style='color: white;cursor: pointer;'>"+P[T]+"</span>",f+="</td>",f+="</tr>"}f+="</tbody>",f+="</table>",f+="</div>";var B=document.getElementById("layout-Info");B!=null&&(B.innerHTML=f)},N.prototype.InitEvent=function(){var D=document.getElementById("ModelTreeInterface"),f=document.getElementById("LayerInterface"),P=document.getElementById("LayerOutInterface"),T=document.getElementById("tuceng"),B=document.getElementById("mulushu"),G=document.getElementById("buju"),R=0,_=0,ee=0,k=0,E=!1;B.onmousedown=function(y){R=y.clientX,_=y.clientY,ee=D.offsetLeft,k=D.offsetTop,E=!0,D.style.cursor="move"},T.onmousedown=function(y){R=y.clientX,_=y.clientY,ee=f.offsetLeft,k=f.offsetTop,E=!0,f.style.cursor="move"},G.onmousedown=function(y){R=y.clientX,_=y.clientY,ee=P.offsetLeft,k=P.offsetTop,E=!0,P.style.cursor="move"},window.onmousemove=function(y){if(E!=0){var j=y.clientX,Y=y.clientY,q=j-(R-ee),V=Y-(_-k);D.style.left=q+"px",D.style.top=V+"px",f.style.left=q+"px",f.style.top=V+"px",P.style.left=q+"px",P.style.top=V+"px"}},B.onmouseup=function(){E=!1,D.style.cursor="default"},T.onmouseup=function(){E=!1,f.style.cursor="default"},G.onmouseup=function(){E=!1,P.style.cursor="default"},$("#close2").click(function(){$(this).parent("div").fadeOut(200)}),$("#menu4").click(function(){$("#StrcutInfoBase").hasClass("hide")?($("#StrcutInfoBase").fadeIn(200),$("#StrcutInfoBase").removeClass("hide")):($("#StrcutInfoBase").fadeOut(200),$("#StrcutInfoBase").addClass("hide"))}),$(".bf-select-current").click(function(){$(this).hasClass("bf-open")?$(this).removeClass("bf-open"):$(this).addClass("bf-open")}),$(".bf-select-option").click(function(){$(this).parent("ul").prev("span").html($(this).text()),$(this).parent("ul").prev("span").removeClass("bf-open")});var W=$("#StrcutInfoBase");W.bind("mousedown",function(y){var j=$(this)[0].offsetLeft,Y=$(this)[0].offsetTop,q=y.pageX,V=y.pageY;$(document).bind("mousemove",function(ne){var ie=ne.pageX-q,he=ne.pageY-V,be=j+ie+"px",je=Y+he+"px";W.css({top:je,left:be})})}),$(document).bind("mouseup",function(){$(this).unbind("mousemove")}),this.CreateToolBar(this.vecToolBarItem);var C=this.vecMenuItem;if(this.isShowMainMenu&&function(y){var j="";(function he(be,je){var xe=function(J,ge){var oe=new Array;for(var le in ge)ge[le].parentId==J&&oe.push(ge[le]);return oe}(be,je);if(0<xe.length){for(var Fe in j+="<ul>",xe)xe[Fe].evalString.length!=0?(j+='<li><p class="li_option" ',j+=`onclick="uiObj.EvalJs('`+xe[Fe].evalString+`')"`,j+=">"+xe[Fe].text+"</p>"):(j+="<li><a ",j+=">"+xe[Fe].text+"</a>"),he(xe[Fe].id,je),j+="</li>";j+="</br>",j+="</br>",j+="</br>",j+="</ul>"}})(-1,C),y("#main-nav").append(j);var Y=y("#main-nav"),q=y(".toggle"),V={maxWidth:!1,customToggle:q,levelTitles:!0},ne=null,ie={};ne&&ne.remove(),q.off("click"),ne=Y.clone(),y.extend(ie,{side:"right"}),ne.hcMobileNav(y.extend({},V,ie))}(jQuery),$(".li_option").click(function(){var y=$(this);$(".li_option").each(function(){$(this).removeClass("active")}),y.addClass("active")}),this.sTitle==""){var F=window.location.href,M=F.length,a=F.indexOf("?"),h=F.substr(a,M).split("=")[1];h!=null&&(this.sTitle=h)}$(".barspan").html(decodeURIComponent(this.sTitle)),$(document).on("click",".layer-enable",function(){var y=L.MxFun.getUiObj().getPath(),j=parseInt($(this).attr("id")),Y=(parseInt($(this).attr("sketch")),!0);$(this).attr("src")==y+"/image/show.png"?($(this).attr("src",y+"/image/hide.png"),Y=!1):$(this).attr("src",y+"/image/show.png"),L.MxFun.showLayer(j,Y)}),$(document).on("click",".layout-name",function(){var y=$(this).attr("name");y=="Model"&&(y=""),L.MxFun.getCurrentDraw().gotoLayout(y)})},N.prototype.WriteFooter=function(){document.write("<div class='footer' style='background: rgba(0, 0, 0, 0.7);position: fixed;left: 0;bottom: 0;width: 100%;'>"),document.write("   <div style='line-height: 40px;font-size: 12px;color: #999;padding: 0 10px;'>"),document.write("    <p style='float: right;line-height: 15px;font-size: 12px;color: #999;display: block;'>"),document.write("    <a style='color: #4a90e2;text-decoration: none;outline: none;' href='http://www.mxdraw.com/' target='_blank'>MxDraw </a>"),document.write("    </p>"),document.write("    <a style='color: #4a90e2;text-decoration: none;outline: none;' href='http://www.mxdraw.com' target='_blank'>MX3D </a> ICP15011727"),document.write("    </div>"),document.write("   </div>")},N.prototype.ShowLoading=function(){this.isEnableLoading&&($(".Prompt").css("background","rgba(0, 0, 0, 0)"),$(".Prompt").fadeIn(100),$(".Prompt span").css("display","none"))},N.prototype.HideLoading=function(){this.isEnableLoading&&($(".Prompt").css("background","rgba(0, 0, 0, 0.8)"),$(".Prompt div").fadeOut(100),$(".Prompt span").fadeIn(200),setTimeout(function(){$(".Prompt").fadeOut(1e3)},1e3))},N.prototype.ShowObjectProperty=function(D){if(D.length!=0){var f;f=typeof D=="string"?JSON.parse(D):D;var P="";for(var T in f){var B=f[T];for(var G in P+="<table class='bf-table'>",P+="<tbody class='bf-group'>",P+="<tr class='bf-group-title'>",P+="<td colspan='2'><i class='bf-icon'></i>"+B.name+"</td>",P+="</tr>",B.datas){var R=B.datas[G];P+="<tr class='bf-group-content'>",P+="<td class='bf-key'>"+R.name+"</td>",P+="<td class='bf-value'>"+R.value+"</td>",P+="</tr>"}P+="</tbody>",P+="</table>"}document.getElementById("ComponentContent").innerHTML=P,$(".bf-group").click(function(){$(this).hasClass("bf-collapse")?$(this).removeClass("bf-collapse"):$(this).addClass("bf-collapse")}),$("#StrcutInfoBase").fadeIn(200),$("#StrcutInfoBase").removeClass("hide")}},N.prototype.HideObjectProp=function(){$("#StrcutInfoBase").hasClass("hide")||($("#StrcutInfoBase").fadeOut(200),$("#StrcutInfoBase").addClass("hide"))},N.prototype.SwitchShowLayer=function(){var D=document.getElementById("ModelTreeInterface"),f=document.getElementById("ModelTreeThumbnail"),P=document.getElementById("LayerThumbnail"),T=document.getElementById("LayerInterface"),B=document.getElementById("LayerOut"),G=document.getElementById("LayerOutInterface");D.style.display="none",(G.style.display="none")==T.style.display?(P.style.display="block",T.style.display="block",T.style.left="80px",T.style.top="50px",f!=null&&(f.style.display="block"),B!=null&&(B.style.display="block"),D.style.display="none",G.style.display="none"):(T.style.display="none",f!=null&&(f.style.display="block"),P.style.display="block",B!=null&&(B.style.display="block"))},N.prototype.SwitchShowStructTree=function(){var D=document.getElementById("ModelTreeInterface"),f=document.getElementById("ModelTreeThumbnail"),P=document.getElementById("LayerThumbnail"),T=document.getElementById("LayerInterface"),B=document.getElementById("LayerOut"),G=document.getElementById("LayerOutInterface");T.style.display="none",(G.style.display="none")==D.style.display?(f!=null&&(f.style.display="block"),D.style.display="block",D.style.left="80px",D.style.top="50px",P.style.display="block",B!=null&&(B.style.display="block"),T.style.display="none",G.style.display="none"):(D.style.display="none",f!=null&&(f.style.display="block"),P.style.display="block",B!=null&&(B.style.display="block"))},N.prototype.Chosecolor=function(){document.getElementById("color-picker").click()},N.prototype.ColorChange=function(D){document.getElementById("colorbox").style.backgroundColor=D,L.MxFun.setCurrentColor(D)},N.prototype.SwitchShowLayout=function(){var D=document.getElementById("ModelTreeInterface"),f=document.getElementById("ModelTreeThumbnail"),P=document.getElementById("LayerThumbnail"),T=document.getElementById("LayerInterface"),B=document.getElementById("LayerOut"),G=document.getElementById("LayerOutInterface");D.style.display="none",T.style.display="none",G&&G.style.display=="none"?(B&&(B.style.display="block"),G.style.display="block",G.style.left="80px",G.style.top="120px",f!=null&&(f.style.display="block"),P&&(P.style.display="block"),D.style.display="none",T.style.display="none"):(G&&(G.style.display="none"),f!=null&&(f.style.display="block"),P&&(P.style.display="block"),B&&(B.style.display="block"))},N.prototype.Fullscreen=function(){var D=document.documentElement;D.requestFullscreen?D.requestFullscreen():D.mozRequestFullScreen?D.mozRequestFullScreen():D.webkitRequestFullScreen&&D.webkitRequestFullScreen(),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),this.IsFullStatus()?($("img[title='']").attr("src",this.uiPath+"/image\\fullscreen1.gif"),$("img[title='']").attr("title","")):($("img[title='']").attr("src",this.uiPath+"/image\\escscreen1.gif"),$("img[title='']").attr("title",""))},N.prototype.IsFullStatus=function(){return(document.fullscreenEnabled||document.mozFullscreenElement||document.webkitFullscreenElement)!=null},N);function N(){return u!==null&&u.apply(this,arguments)||this}s.MxUiObjectPC=U},{"../MxFun":27,"./MxUiObject":61}],64:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxUiVue=void 0;var o,v,u,w,L,U=b("three"),N=b("../MxFun"),D=b("../Operate/MxJigCmdManager"),f=b("../MxTools"),P=b("../Operate/MxCmdRunManager");function T(E){if(E==32||E==13)if(D.MxJigCmdManager.isRunning())D.MxJigCmdManager.OnEnter(E);else{var W=_(),C="";C=W.length==0?P.MxCmdRunManager.GetPrvCmd():W,ee(""),C=f.MxTools.stringTrimLeftSpace(C),N.MxFun.sendStringToExecute(C)}else if(E==38)D.MxJigCmdManager.isRunning()||(P.MxCmdRunManager.MoveUpKey(),(F=P.MxCmdRunManager.GetListCommad()).length!=0&&(ee(F),R()));else if(E==40){var F;D.MxJigCmdManager.isRunning()||(P.MxCmdRunManager.MoveDownKey(),(F=P.MxCmdRunManager.GetListCommad()).length!=0&&(ee(F),R()))}}function B(E,W){W===void 0&&(W=!0);var C=E.length;if(!(C<1)){for(var F=w.getCmdLine(),M=F.getCmdTip(),a=F.getCmdText(),h=E.indexOf(`
`),y=0,j=!0;h!=-1&&(j?(F.addCmdDisplay(`
`+M+a+E.substring(y,h-y)),a=M="",j=!1):F.addCmdDisplay(`
`+E.substring(y,h-y)),(y=h+1)<C);)h=E.indexOf(`
`,y);if(j){var Y=E.substring(y,C-y),q=Y.indexOf("\r"),V=Y.length;M=q==-1?M+a+Y:q+1<V?Y.substring(q+1,V-q-1):""}else y<C&&(M=E.substring(y,C));a="",W&&(M+=" "),F.setCmdTip(M),F.setCmdText(a),F.upDisplay()}}function G(E){for(var W=[],C=1;C<arguments.length;C++)W[C-1]=arguments[C];if(w!=null){for(var F=arguments,M=F[0],a=0;a<F.length-1;a++){var h=new RegExp("\\{"+a+"\\}","gm");M=M.replace(h,F[a+1])}B(M,!0)}}function R(){w!=null&&w.getCmdLine().upDisplay()}function _(){if(w==null)return"";var E=w.getCmdLine();return f.MxTools.stringTrimLeftRightSpace(E.getCmdText())}function ee(E){if(w!=null)return w.getCmdLine().setCmdText(E)}function k(E){var W=D.MxJigCmdManager.getCurCmd();W!=null&&(W.getDynImput().onKeyDonw(E)||T(E))}v=o||(s.MxUiVue=o={}),w=void 0,L=new U.Vector3,v.SetLasetPoint=function(E){L=E},v.GetLasetPoint=function(){return L},(u=v.CursorType||(v.CursorType={}))[u.kNormal=0]="kNormal",u[u.kRect=1]="kRect",u[u.kCross=2]="kCross",u[u.kPan=3]="kPan",v.isNull=function(){return w==null},v.init=function(E){(w=E).mountKeydownEvent(T),w.getDynamicInput().mountKeydownEvent(k)},v.setTipCoord=function(E){w!=null&&w.setTipCoord(E)},v.setCursorType=function(E){w!=null&&w.setCursorType(E)},v.AcutPrintfNoFormat=B,v.acutPrintf=G,v.cmdLineUpDisplay=R,v.getCmdText=_,v.setCmdText=ee,v.getCmdDisplay=function(){return w==null?"":w.getCmdLine().getCmdDisplay()},v.setCmdDisplay=function(E){if(w!=null)return w.getCmdLine().setCmdDisplay(E)},v.getCmdTip=function(){return w==null?"":w.getCmdLine().getCmdTip()},v.setCmdTip=function(E){if(w!=null)return w.getCmdLine().setCmdTip(E)},v.restoreCmdStatus=function(){if(w!=null){var E=w.getCmdLine();E.getCmdTip()==" "&&E.getCmdText().length==0?(E.setCmdTip(""),G("{0}:","")):G(`
{0}:`,"")}},v.DynamicInput_upDisplay=function(){w!=null&&v.OnMxEvent({name:"dynInputUpDisplay"})},v.DynamicInput_setType=function(E){w!=null&&w.getDynamicInput().setType(E)},v.DynamicInput_getType=function(){return w==null?D.MxJigCmdManager.DynamicInputType.kNoInput:w.getDynamicInput().getType()},v.DynamicInput_setPos=function(E){w!=null&&w.getDynamicInput().setPos([E.x,E.y])},v.DynamicInput_setTip=function(E){w!=null&&w.getDynamicInput().setTip(E)},v.DynamicInput_setValue1=function(E){w!=null&&w.getDynamicInput().setValue1(E)},v.DynamicInput_getValue1=function(){return w==null?"":w.getDynamicInput().getValue1()},v.DynamicInput_setValue1Pos=function(E){w!=null&&w.getDynamicInput().setValue1Pos([E.x,E.y])},v.DynamicInput_setValue2=function(E){w!=null&&w.getDynamicInput().setValue2(E)},v.DynamicInput_getValue2=function(){return w==null?"":w.getDynamicInput().getValue2()},v.DynamicInput_getFocusValue=function(){return w==null?"":w.getDynamicInput().getFocusValue()},v.DynamicInput_getFocusIndex=function(){return w==null?0:w.getDynamicInput().getFocusIndex()},v.DynamicInput_setValue2Pos=function(E){w!=null&&w.getDynamicInput().setValue2Pos([E.x,E.y])},v.DynamicInput_setShow=function(E){w!=null&&w.getDynamicInput().setShow(E)},v.DynamicInput_isShow=function(){return w!=null&&w.getDynamicInput().isShow()},v.OnMxEvent=function(E){if(w==null)return!1;w.OnMxEvent(E)}},{"../MxFun":27,"../MxTools":37,"../Operate/MxCmdRunManager":47,"../Operate/MxJigCmdManager":53,three:19}],65:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.ExternalReferenceManager=s.ExternalReferenceDatabase=s.Blocks=s.Block=s.Layer=s.MxNewDisplayMemorySection=s.MxNewDisplayMemorySectionType=s.TextureData=s.BlockInstance=s.BlockRef=s.ClipPlans=s.ClipPlan=void 0;var o=b("three"),v=b("../MxShader"),u=b("./MxBrowseLayerData"),w=b("../MxManager"),L=b("../MxNetData"),U=b("../MxStencilObject"),N=b("../MxFun"),D=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0};s.ClipPlan=D;var f=function(){this.ver=4,this.id=1,this.clipPlanArray=new Array,this.clipPoints=[],this.instansClipePoints=[]};s.ClipPlans=f;var P=function(){this.ver=4,this.mat=new o.Matrix4,this.blkRecId=-1,this.blkOwnerId=0,this.layerId=-1,this.color=16777215,this.clipPlans=new f};s.BlockRef=P;var T=function(){this.mat=new o.Matrix4,this.color=new Array,this.topLayerColor=new Array,this.clipPlans=new f,this.clipMat=new o.Matrix4};s.BlockInstance=T;var B,G,R=function(){};s.TextureData=R,(G=B||(s.MxNewDisplayMemorySectionType=B={}))[G.kLinesType=1]="kLinesType",G[G.kTriangleType=2]="kTriangleType",G[G.kLinesType_Float=3]="kLinesType_Float",G[G.kTriangleType_Float=4]="kTriangleType_Float",G[G.kPointType_Float=5]="kPointType_Float",G[G.kPointType=6]="kPointType",s.MxNewDisplayMemorySection=function(){this.id=0,this.type=B.kLinesType,this.blockId=0,this.layerId=0,this.color=0,this.points=[]};var _=(ee.prototype.Show=function(h){for(var y=0,j=this._entitys.length;y<j;y++)this._entitys[y].visible=h},ee.prototype.updataClipMaterial=function(h){for(var y=this._material_clip.length,j=.5*h.width,Y=.5*h.height,q=0;q<y;q++)this._material_clip[q].uniforms.vieww.value=j,this._material_clip[q].uniforms.viewh.value=Y},ee.prototype.createThreejsObjForMesh_Clip=function(h,y,j){h.size!=0&&h.forEach(function(Y){var q=Y;if(q.length!=0){var V=[],ne=[],ie=q[0].clipPlans;ie.ver<=3&&(V.push(ie.clipPlanArray[0].x1,ie.clipPlanArray[0].y1),ne.push(ie.clipPlanArray[0].x2,ie.clipPlanArray[0].y2));for(var he=[],be=[],je=[],xe=[],Fe=[],J=[],ge=[],oe=0;oe<q.length;oe++){var le=q[oe];he=he.concat(le.mat.elements.slice(0,4)),be=be.concat(le.mat.elements.slice(4,8)),je=je.concat(le.mat.elements.slice(8,12)),xe=xe.concat(le.mat.elements.slice(12,16)),Fe.push(0),J=J.concat(q[oe].color)}if(0<this._geometryMeshPositionsByBlock.length)for(oe=0;oe<q.length;oe++)J=J.concat(q[oe].color);if(0<this._geometryMeshPositionsByBlock_ZeroLayer.length)for(oe=0;oe<q.length;oe++)ge=ge.concat(q[oe].topLayerColor);var Re,Ye=.5*j.width,Be=.5*j.height;ie.ver<=3?(Re=new o.RawShaderMaterial({uniforms:{clippt1:{value:V},clippt2:{value:ne},vieww:{value:Ye},viewh:{value:Be}},vertexShader:v.MxShader.VSHADER_COLOR_POINT_CLIP,fragmentShader:v.MxShader.FSHADER_COLOR_POINT_CLIP,linewidth:1,transparent:!0,side:o.DoubleSide}),this._material_clip.push(Re)):Re=new o.RawShaderMaterial({vertexShader:v.MxShader.VSHADER_COLOR_POINT,fragmentShader:v.MxShader.FSHADER_COLOR_POINT,linewidth:1,transparent:!0,side:o.DoubleSide});for(var se=0;se<this._geometryMeshPostion.length;se++)(Ee=new o.InstancedBufferGeometry).maxInstancedCount=q.length,Ee.setAttribute("position",new o.Float32BufferAttribute(this._geometryMeshPostion[se],2)),Ee.setAttribute("color",new o.Float32BufferAttribute(this._geometryMeshColor[se],3)),Ee.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(he),4)),Ee.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(be),4)),Ee.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(je),4)),Ee.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(xe),4)),Ee.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(Fe),1)),(rt=new o.Mesh(Ee,Re)).frustumCulled=!1,rt.renderOrder=w.MxData.iCADMeshRenderOrder,y.add(rt),this._entitys.push(rt),4<=ie.ver&&0<ie.instansClipePoints.length&&new U.MxStencilObject().associateObject(rt,ie.instansClipePoints);for(se=0;se<this._geometryMeshPositionsByBlock.length;se++)(Ee=new o.InstancedBufferGeometry).maxInstancedCount=q.length,Ee.setAttribute("position",new o.Float32BufferAttribute(this._geometryMeshPositionsByBlock[se],2)),Ee.setAttribute("color",new o.InstancedBufferAttribute(new Float32Array(J),3)),Ee.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(he),4)),Ee.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(be),4)),Ee.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(je),4)),Ee.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(xe),4)),Ee.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(Fe),1)),(rt=new o.Mesh(Ee,Re)).frustumCulled=!1,rt.renderOrder=w.MxData.iCADMeshRenderOrder,y.add(rt),this._entitys.push(rt),4<=ie.ver&&0<ie.instansClipePoints.length&&new U.MxStencilObject().associateObject(rt,ie.instansClipePoints);for(se=0;se<this._geometryMeshPositionsByBlock_ZeroLayer.length;se++)(Ee=new o.InstancedBufferGeometry).maxInstancedCount=q.length,Ee.setAttribute("position",new o.Float32BufferAttribute(this._geometryMeshPositionsByBlock_ZeroLayer[se],2)),Ee.setAttribute("color",new o.InstancedBufferAttribute(new Float32Array(ge),3)),Ee.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(he),4)),Ee.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(be),4)),Ee.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(je),4)),Ee.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(xe),4)),Ee.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(Fe),1)),(rt=new o.Mesh(Ee,Re)).frustumCulled=!1,rt.renderOrder=w.MxData.iCADMeshRenderOrder,y.add(rt),this._entitys.push(rt),4<=ie.ver&&0<ie.instansClipePoints.length&&new U.MxStencilObject().associateObject(rt,ie.instansClipePoints);var ve=new o.RawShaderMaterial({uniforms:{color:{value:this._color},clippt1:{value:V},clippt2:{value:ne},vieww:{value:Ye},viewh:{value:Be}},vertexShader:v.MxShader.VSHADER_COLOR_POINT_BYLAYER_CLIP,fragmentShader:v.MxShader.FSHADER_COLOR_POINT_CLIP,linewidth:1,transparent:!0,side:o.DoubleSide});for(this._material_clip.push(ve),se=0;se<this._geometryMeshPositionsByLayer.length;se++){var Ee,rt;(Ee=new o.InstancedBufferGeometry).maxInstancedCount=q.length,Ee.setAttribute("position",new o.Float32BufferAttribute(this._geometryMeshPositionsByLayer[se],2)),Ee.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(he),4)),Ee.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(be),4)),Ee.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(je),4)),Ee.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(xe),4)),Ee.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(Fe),1)),(rt=new o.Mesh(Ee,ve)).frustumCulled=!1,rt.renderOrder=w.MxData.iCADMeshRenderOrder,y.add(rt),this._entitys.push(rt),4<=ie.ver&&0<ie.instansClipePoints.length&&new U.MxStencilObject().associateObject(rt,ie.instansClipePoints)}}},this)},ee.prototype.createThreejsObjForCurve_Clip=function(h,y,j){h.size!=0&&h.forEach(function(Y,q,V){var ne=Y;if(ne.length!=0){var ie=[],he=[],be=ne[0].clipPlans;be.ver<=3&&(ie.push(be.clipPlanArray[0].x1,be.clipPlanArray[0].y1),he.push(be.clipPlanArray[0].x2,be.clipPlanArray[0].y2));for(var je=[],xe=[],Fe=[],J=[],ge=[],oe=[],le=[],Re=0;Re<ne.length;Re++){var Ye=ne[Re];je=je.concat(Ye.mat.elements.slice(0,4)),xe=xe.concat(Ye.mat.elements.slice(4,8)),Fe=Fe.concat(Ye.mat.elements.slice(8,12)),J=J.concat(Ye.mat.elements.slice(12,16)),ge.push(0)}if(0<this._geometryCurvePositionsByBlock.length)for(Re=0;Re<ne.length;Re++)oe=oe.concat(ne[Re].color);if(0<this._geometryCurvePositionsByBlock_ZeroLayer.length)for(Re=0;Re<ne.length;Re++)le=le.concat(ne[Re].topLayerColor);var Be,se=.5*j.width,ve=.5*j.height;be.ver<=3?(Be=new o.RawShaderMaterial({uniforms:{clippt1:{value:ie},clippt2:{value:he},vieww:{value:se},viewh:{value:ve}},vertexShader:v.MxShader.VSHADER_COLOR_POINT_CLIP,fragmentShader:v.MxShader.FSHADER_COLOR_POINT_CLIP,linewidth:1,transparent:!0,side:o.DoubleSide}),this._material_clip.push(Be)):Be=new o.RawShaderMaterial({vertexShader:v.MxShader.VSHADER_COLOR_POINT,fragmentShader:v.MxShader.FSHADER_COLOR_POINT,linewidth:1,transparent:!0,side:o.DoubleSide});for(var Ee=0;Ee<this._geometryCurvePostion.length;Ee++)(tt=new o.InstancedBufferGeometry).maxInstancedCount=ne.length,tt.setAttribute("position",new o.Float32BufferAttribute(this._geometryCurvePostion[Ee],2)),tt.setAttribute("color",new o.Float32BufferAttribute(this._geometryCurveColor[Ee],3)),tt.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(je),4)),tt.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(xe),4)),tt.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(Fe),4)),tt.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(J),4)),tt.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ge),1)),(xt=new o.LineSegments(tt,Be)).frustumCulled=!1,xt.renderOrder=w.MxData.iCADCurveRenderOrder,y.add(xt),this._entitys.push(xt),4<=be.ver&&0<be.instansClipePoints.length&&new U.MxStencilObject().associateObject(xt,be.instansClipePoints);for(Ee=0;Ee<this._geometryCurvePositionsByBlock.length;Ee++)(tt=new o.InstancedBufferGeometry).maxInstancedCount=ne.length,tt.setAttribute("position",new o.Float32BufferAttribute(this._geometryCurvePositionsByBlock[Ee],2)),tt.setAttribute("color",new o.InstancedBufferAttribute(new Float32Array(oe),3)),tt.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(je),4)),tt.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(xe),4)),tt.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(Fe),4)),tt.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(J),4)),tt.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ge),1)),(xt=new o.LineSegments(tt,Be)).frustumCulled=!1,xt.renderOrder=w.MxData.iCADCurveRenderOrder,y.add(xt),this._entitys.push(xt),4<=be.ver&&0<be.instansClipePoints.length&&new U.MxStencilObject().associateObject(xt,be.instansClipePoints);for(Ee=0;Ee<this._geometryCurvePositionsByBlock_ZeroLayer.length;Ee++)(tt=new o.InstancedBufferGeometry).maxInstancedCount=ne.length,tt.setAttribute("position",new o.Float32BufferAttribute(this._geometryCurvePositionsByBlock_ZeroLayer[Ee],2)),tt.setAttribute("color",new o.InstancedBufferAttribute(new Float32Array(le),3)),tt.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(je),4)),tt.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(xe),4)),tt.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(Fe),4)),tt.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(J),4)),tt.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ge),1)),(xt=new o.LineSegments(tt,Be)).frustumCulled=!1,xt.renderOrder=w.MxData.iCADCurveRenderOrder,y.add(xt),this._entitys.push(xt),4<=be.ver&&0<be.instansClipePoints.length&&new U.MxStencilObject().associateObject(xt,be.instansClipePoints);var rt=new o.RawShaderMaterial({uniforms:{color:{value:this._color},clippt1:{value:ie},clippt2:{value:he},vieww:{value:se},viewh:{value:ve}},vertexShader:v.MxShader.VSHADER_COLOR_POINT_BYLAYER_CLIP,fragmentShader:v.MxShader.FSHADER_COLOR_POINT_CLIP,linewidth:1,transparent:!0,side:o.DoubleSide});for(this._material_clip.push(rt),Ee=0;Ee<this._geometryCurvePositionsByLayer.length;Ee++){var tt,xt;(tt=new o.InstancedBufferGeometry).maxInstancedCount=ne.length,tt.setAttribute("position",new o.Float32BufferAttribute(this._geometryCurvePositionsByLayer[Ee],2)),tt.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(je),4)),tt.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(xe),4)),tt.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(Fe),4)),tt.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(J),4)),tt.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ge),1)),(xt=new o.LineSegments(tt,rt)).frustumCulled=!1,xt.renderOrder=w.MxData.iCADCurveRenderOrder,y.add(xt),this._entitys.push(xt),4<=be.ver&&0<be.instansClipePoints.length&&new U.MxStencilObject().associateObject(xt,be.instansClipePoints)}}},this)},ee.prototype.createThreejsObjForCurve=function(h,y){if(h.length!=0){for(var j=[],Y=[],q=[],V=[],ne=[],ie=[],he=[],be=0;be<h.length;be++){var je=h[be];j=j.concat(je.mat.elements.slice(0,4)),Y=Y.concat(je.mat.elements.slice(4,8)),q=q.concat(je.mat.elements.slice(8,12)),V=V.concat(je.mat.elements.slice(12,16)),ne.push(0)}if(0<this._geometryCurvePositionsByBlock.length)for(be=0;be<h.length;be++)ie=ie.concat(h[be].color);if(0<this._geometryCurvePositionsByBlock_ZeroLayer.length)for(be=0;be<h.length;be++)he=he.concat(h[be].topLayerColor);for(var xe=new o.RawShaderMaterial({vertexShader:v.MxShader.VSHADER_COLOR_POINT,fragmentShader:v.MxShader.FSHADER_COLOR_POINT,linewidth:1,transparent:!0,side:o.DoubleSide}),Fe=0;Fe<this._geometryCurvePostion.length;Fe++)(ge=new o.InstancedBufferGeometry).maxInstancedCount=h.length,ge.setAttribute("position",new o.Float32BufferAttribute(this._geometryCurvePostion[Fe],2)),ge.setAttribute("color",new o.Float32BufferAttribute(this._geometryCurveColor[Fe],3)),ge.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(j),4)),ge.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(Y),4)),ge.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(q),4)),ge.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(V),4)),ge.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ne),1)),(oe=new o.LineSegments(ge,xe)).frustumCulled=!1,oe.renderOrder=w.MxData.iCADCurveRenderOrder,y.add(oe),this._entitys.push(oe);for(Fe=0;Fe<this._geometryCurvePositionsByBlock.length;Fe++)(ge=new o.InstancedBufferGeometry).maxInstancedCount=h.length,ge.setAttribute("position",new o.Float32BufferAttribute(this._geometryCurvePositionsByBlock[Fe],2)),ge.setAttribute("color",new o.InstancedBufferAttribute(new Float32Array(ie),3)),ge.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(j),4)),ge.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(Y),4)),ge.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(q),4)),ge.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(V),4)),ge.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ne),1)),(oe=new o.LineSegments(ge,xe)).frustumCulled=!1,oe.renderOrder=w.MxData.iCADCurveRenderOrder,y.add(oe),this._entitys.push(oe);for(Fe=0;Fe<this._geometryCurvePositionsByBlock_ZeroLayer.length;Fe++)(ge=new o.InstancedBufferGeometry).maxInstancedCount=h.length,ge.setAttribute("position",new o.Float32BufferAttribute(this._geometryCurvePositionsByBlock_ZeroLayer[Fe],2)),ge.setAttribute("color",new o.InstancedBufferAttribute(new Float32Array(he),3)),ge.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(j),4)),ge.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(Y),4)),ge.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(q),4)),ge.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(V),4)),ge.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ne),1)),(oe=new o.LineSegments(ge,xe)).frustumCulled=!1,oe.renderOrder=w.MxData.iCADCurveRenderOrder,y.add(oe),this._entitys.push(oe);var J=new o.RawShaderMaterial({uniforms:{color:{value:this._color}},vertexShader:v.MxShader.VSHADER_COLOR_POINT_BYLAYER,fragmentShader:v.MxShader.FSHADER_COLOR_POINT,linewidth:1,transparent:!0,side:o.DoubleSide});for(Fe=0;Fe<this._geometryCurvePositionsByLayer.length;Fe++){var ge,oe;(ge=new o.InstancedBufferGeometry).maxInstancedCount=h.length,ge.setAttribute("position",new o.Float32BufferAttribute(this._geometryCurvePositionsByLayer[Fe],2)),ge.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(j),4)),ge.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(Y),4)),ge.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(q),4)),ge.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(V),4)),ge.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ne),1)),(oe=new o.LineSegments(ge,J)).frustumCulled=!1,oe.renderOrder=w.MxData.iCADCurveRenderOrder,y.add(oe),this._entitys.push(oe)}}},ee.prototype.createThreejsObjForMemorySections_clip=function(h,y,j){h.size!=0&&h.forEach(function(Y){var q=Y;if(q.length!=0){for(var V=q[0].clipPlans,ne=[],ie=[],he=[],be=[],je=[],xe=0;xe<q.length;xe++){var Fe=q[xe];ne.push.apply(ne,Fe.mat.elements.slice(0,4)),ie.push.apply(ie,Fe.mat.elements.slice(4,8)),he.push.apply(he,Fe.mat.elements.slice(8,12)),be.push.apply(be,Fe.mat.elements.slice(12,16)),je.push(0)}for(var J=this._MemorySections.length,ge=0;ge<J;ge++){var oe=this._MemorySections[ge],le=j.automaticInversionColor2(oe.color),Re=[];if((4278190080&le)==16777216?Re=this._color:Re.push((255&le)/255,(le>>8&255)/255,(le>>16&255)/255),oe.type==B.kLinesType){var Ye=new o.RawShaderMaterial({uniforms:{color:{value:Re}},vertexShader:v.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:v.MxShader.FSHADER_COLOR_POINT_FORMXCAD,linewidth:1,transparent:!0,side:o.DoubleSide});(se=new o.InstancedBufferGeometry).maxInstancedCount=q.length,se.setAttribute("position",new o.Float32BufferAttribute(oe.points,3)),se.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(ne),4)),se.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(ie),4)),se.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(he),4)),se.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(be),4)),se.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(je),1)),(ve=new o.LineSegments(se,Ye)).frustumCulled=!1,ve.renderOrder=w.MxData.iCADCurveRenderOrder,4<=V.ver&&0<V.instansClipePoints.length&&new U.MxStencilObject().associateObject(ve,V.instansClipePoints),y.add(ve),this._entitys.push(ve)}else if(oe.type==B.kTriangleType){Ye=new o.RawShaderMaterial({uniforms:{color:{value:Re}},vertexShader:v.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:v.MxShader.FSHADER_COLOR_POINT_FORMXCAD,transparent:!0,side:o.DoubleSide}),(se=new o.InstancedBufferGeometry).maxInstancedCount=q.length,se.setAttribute("position",new o.Float32BufferAttribute(oe.points,3)),se.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(ne),4)),se.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(ie),4)),se.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(he),4)),se.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(be),4)),se.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(je),1));var Be=new o.Mesh(se,Ye);Be.frustumCulled=!1,Be.renderOrder=w.MxData.iCADMeshRenderOrder,4<=V.ver&&0<V.instansClipePoints.length&&new U.MxStencilObject().associateObject(Be,V.instansClipePoints),y.add(Be),this._entitys.push(Be)}else if(oe.type==B.kPointType){var se,ve;Ye=new o.RawShaderMaterial({uniforms:{color:{value:Re}},vertexShader:v.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:v.MxShader.FSHADER_COLOR_POINT_FORMXCAD,transparent:!0,side:o.DoubleSide}),(se=new o.InstancedBufferGeometry).maxInstancedCount=q.length,se.setAttribute("position",new o.Float32BufferAttribute(oe.points,3)),se.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(ne),4)),se.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(ie),4)),se.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(he),4)),se.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(be),4)),se.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(je),1)),(ve=new o.Points(se,Ye)).frustumCulled=!1,ve.renderOrder=w.MxData.iCADCurveRenderOrder,4<=V.ver&&0<V.instansClipePoints.length&&new U.MxStencilObject().associateObject(ve,V.instansClipePoints),y.add(ve),this._entitys.push(ve)}}}},this)},ee.prototype.createThreejsObjForMemorySections=function(h,y,j){if(h.length!=0){for(var Y=[],q=[],V=[],ne=[],ie=[],he=0;he<h.length;he++){var be=h[he];Y.push.apply(Y,be.mat.elements.slice(0,4)),q.push.apply(q,be.mat.elements.slice(4,8)),V.push.apply(V,be.mat.elements.slice(8,12)),ne.push.apply(ne,be.mat.elements.slice(12,16)),ie.push(0)}for(var je=this._MemorySections.length,xe=0;xe<je;xe++){var Fe=this._MemorySections[xe],J=j.automaticInversionColor2(Fe.color),ge=[];if((4278190080&J)==16777216?(ge=this._color,this._colorValue):ge.push((255&J)/255,(J>>8&255)/255,(J>>16&255)/255),Fe.type==B.kLinesType){var oe=new o.RawShaderMaterial({uniforms:{color:{value:ge}},vertexShader:v.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:v.MxShader.FSHADER_COLOR_POINT_FORMXCAD,linewidth:1,transparent:!0,side:o.DoubleSide});(Re=new o.InstancedBufferGeometry).maxInstancedCount=h.length,Re.setAttribute("position",new o.Float32BufferAttribute(Fe.points,3)),Re.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(Y),4)),Re.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(q),4)),Re.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(V),4)),Re.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(ne),4)),Re.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ie),1)),(Ye=new o.LineSegments(Re,oe)).frustumCulled=!1,Ye.renderOrder=w.MxData.iCADCurveRenderOrder,y.add(Ye),this._entitys.push(Ye)}else if(Fe.type==B.kTriangleType){oe=new o.RawShaderMaterial({uniforms:{color:{value:ge}},vertexShader:v.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:v.MxShader.FSHADER_COLOR_POINT_FORMXCAD,transparent:!0,side:o.DoubleSide}),(Re=new o.InstancedBufferGeometry).maxInstancedCount=h.length,Re.setAttribute("position",new o.Float32BufferAttribute(Fe.points,3)),Re.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(Y),4)),Re.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(q),4)),Re.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(V),4)),Re.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(ne),4)),Re.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ie),1));var le=new o.Mesh(Re,oe);le.frustumCulled=!1,le.renderOrder=w.MxData.iCADMeshRenderOrder,y.add(le),this._entitys.push(le)}else if(Fe.type==B.kPointType){var Re,Ye;oe=new o.RawShaderMaterial({uniforms:{color:{value:ge},size:1},vertexShader:v.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:v.MxShader.FSHADER_COLOR_POINT_FORMXCAD,transparent:!0,side:o.DoubleSide}),(Re=new o.InstancedBufferGeometry).maxInstancedCount=h.length,Re.setAttribute("position",new o.Float32BufferAttribute(Fe.points,3)),Re.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(Y),4)),Re.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(q),4)),Re.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(V),4)),Re.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(ne),4)),Re.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ie),1)),(Ye=new o.Points(Re,oe)).frustumCulled=!1,Ye.renderOrder=w.MxData.iCADCurveRenderOrder,y.add(Ye),this._entitys.push(Ye)}}}},ee.prototype.createThreejsObjForTexture=function(h,y,j){if(h.length!=0){var Y=[],q=[],V=[],ne=[],ie=[],he=j.getCurrentLoadUrl(),be=N.MxFun.dwgDir();be.length!=0&&he.substring(he.lastIndexOf("/buf/")).toLowerCase()!="/buf/"&&(he=he+be+"/buf/");for(var je=0;je<h.length;je++){var xe=h[je];Y=Y.concat(xe.mat.elements.slice(0,4)),q=q.concat(xe.mat.elements.slice(4,8)),V=V.concat(xe.mat.elements.slice(8,12)),ne=ne.concat(xe.mat.elements.slice(12,16)),ie.push(0)}for(var Fe=0;Fe<this._TextureData.length;Fe++){var J=this._TextureData[Fe],ge=new o.InstancedBufferGeometry;ge.maxInstancedCount=h.length,ge.setAttribute("position",new o.Float32BufferAttribute(J.pos,2)),ge.setAttribute("uv",new o.Float32BufferAttribute(J.textureCoord,2)),ge.setAttribute("color",new o.Float32BufferAttribute(J.color,3)),ge.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(Y),4)),ge.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(q),4)),ge.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(V),4)),ge.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(ne),4)),ge.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ie),1));var oe=he+J.sFileName,le={texture:{value:new o.TextureLoader().load(oe,function(Be){Be&&j.updateDisplay()})}};le.texture.value.wrapS=le.texture.value.wrapT=o.RepeatWrapping;var Re=new o.RawShaderMaterial({uniforms:le,vertexShader:v.MxShader.VSHADER_COLOR_POINT_TEXTURE,fragmentShader:v.MxShader.FSHADER_COLOR_POINT_TEXTURE,transparent:!0,side:o.DoubleSide}),Ye=new o.Mesh(ge,Re);Ye.renderOrder=w.MxData.iCADMeshRenderOrder,Ye.frustumCulled=!1,y.add(Ye),this._entitys.push(Ye)}}},ee.prototype.createThreejsObjForTexture_Clip=function(h,y,j){if(h.size!=0){var Y=j.getCurrentLoadUrl(),q=N.MxFun.dwgDir();q.length!=0&&Y.substring(Y.lastIndexOf("/buf/")).toLowerCase()!="/buf/"&&(Y=Y+q+"/buf/"),h.forEach(function(V){var ne=V;if(ne.length!=0){for(var ie=ne[0].clipPlans,he=[],be=[],je=[],xe=[],Fe=[],J=0;J<ne.length;J++){var ge=ne[J];he=he.concat(ge.mat.elements.slice(0,4)),be=be.concat(ge.mat.elements.slice(4,8)),je=je.concat(ge.mat.elements.slice(8,12)),xe=xe.concat(ge.mat.elements.slice(12,16)),Fe.push(0)}for(var oe=0;oe<this._TextureData.length;oe++){var le=this._TextureData[oe],Re=new o.InstancedBufferGeometry;Re.maxInstancedCount=ne.length,Re.setAttribute("position",new o.Float32BufferAttribute(le.pos,2)),Re.setAttribute("uv",new o.Float32BufferAttribute(le.textureCoord,2)),Re.setAttribute("color",new o.Float32BufferAttribute(le.color,3)),Re.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(he),4)),Re.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(be),4)),Re.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(je),4)),Re.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(xe),4)),Re.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(Fe),1));var Ye=Y+le.sFileName,Be={texture:{value:new o.TextureLoader().load(Ye,function(Ee){Ee&&j.updateDisplay()})}};Be.texture.value.wrapS=Be.texture.value.wrapT=o.RepeatWrapping;var se=new o.RawShaderMaterial({uniforms:Be,vertexShader:v.MxShader.VSHADER_COLOR_POINT_TEXTURE,fragmentShader:v.MxShader.FSHADER_COLOR_POINT_TEXTURE,transparent:!0,side:o.DoubleSide}),ve=new o.Mesh(Re,se);ve.renderOrder=w.MxData.iCADMeshRenderOrder,ve.frustumCulled=!1,4<=ie.ver&&0<ie.instansClipePoints.length&&new U.MxStencilObject().associateObject(ve,ie.instansClipePoints),y.add(ve),this._entitys.push(ve)}}},this)}},ee.prototype.createThreejsObjForMesh=function(h,y){if(h.length!=0){for(var j=[],Y=[],q=[],V=[],ne=[],ie=[],he=[],be=0;be<h.length;be++){var je=h[be];j=j.concat(je.mat.elements.slice(0,4)),Y=Y.concat(je.mat.elements.slice(4,8)),q=q.concat(je.mat.elements.slice(8,12)),V=V.concat(je.mat.elements.slice(12,16)),ne.push(0),ie=ie.concat(h[be].color)}if(0<this._geometryMeshPositionsByBlock.length)for(be=0;be<h.length;be++)ie=ie.concat(h[be].color);if(0<this._geometryMeshPositionsByBlock_ZeroLayer.length)for(be=0;be<h.length;be++)he=he.concat(h[be].topLayerColor);for(var xe=new o.RawShaderMaterial({vertexShader:v.MxShader.VSHADER_COLOR_POINT,fragmentShader:v.MxShader.FSHADER_COLOR_POINT,transparent:!0,side:o.DoubleSide}),Fe=0;Fe<this._geometryMeshPostion.length;Fe++)(ge=new o.InstancedBufferGeometry).maxInstancedCount=h.length,ge.setAttribute("position",new o.Float32BufferAttribute(this._geometryMeshPostion[Fe],2)),ge.setAttribute("color",new o.Float32BufferAttribute(this._geometryMeshColor[Fe],3)),ge.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(j),4)),ge.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(Y),4)),ge.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(q),4)),ge.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(V),4)),ge.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ne),1)),(oe=new o.Mesh(ge,xe)).frustumCulled=!1,oe.renderOrder=w.MxData.iCADMeshRenderOrder,y.add(oe),this._entitys.push(oe);for(Fe=0;Fe<this._geometryMeshPositionsByBlock.length;Fe++)(ge=new o.InstancedBufferGeometry).maxInstancedCount=h.length,ge.setAttribute("position",new o.Float32BufferAttribute(this._geometryMeshPositionsByBlock[Fe],2)),ge.setAttribute("color",new o.InstancedBufferAttribute(new Float32Array(ie),3)),ge.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(j),4)),ge.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(Y),4)),ge.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(q),4)),ge.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(V),4)),ge.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ne),1)),(oe=new o.Mesh(ge,xe)).frustumCulled=!1,oe.renderOrder=w.MxData.iCADMeshRenderOrder,y.add(oe),this._entitys.push(oe);for(Fe=0;Fe<this._geometryMeshPositionsByBlock_ZeroLayer.length;Fe++)(ge=new o.InstancedBufferGeometry).maxInstancedCount=h.length,ge.setAttribute("position",new o.Float32BufferAttribute(this._geometryMeshPositionsByBlock_ZeroLayer[Fe],2)),ge.setAttribute("color",new o.InstancedBufferAttribute(new Float32Array(he),3)),ge.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(j),4)),ge.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(Y),4)),ge.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(q),4)),ge.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(V),4)),ge.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ne),1)),(oe=new o.Mesh(ge,xe)).frustumCulled=!1,oe.renderOrder=w.MxData.iCADMeshRenderOrder,y.add(oe),this._entitys.push(oe);var J=new o.RawShaderMaterial({uniforms:{color:{value:this._color}},vertexShader:v.MxShader.VSHADER_COLOR_POINT,fragmentShader:v.MxShader.FSHADER_COLOR_POINT,transparent:!0,side:o.DoubleSide});for(Fe=0;Fe<this._geometryMeshPositionsByLayer.length;Fe++){var ge,oe;(ge=new o.InstancedBufferGeometry).maxInstancedCount=h.length,ge.setAttribute("position",new o.Float32BufferAttribute(this._geometryMeshPositionsByLayer[Fe],2)),ge.setAttribute("tran1",new o.InstancedBufferAttribute(new Float32Array(j),4)),ge.setAttribute("tran2",new o.InstancedBufferAttribute(new Float32Array(Y),4)),ge.setAttribute("tran3",new o.InstancedBufferAttribute(new Float32Array(q),4)),ge.setAttribute("tran4",new o.InstancedBufferAttribute(new Float32Array(V),4)),ge.setAttribute("ishide",new o.InstancedBufferAttribute(new Float32Array(ne),1)),(oe=new o.Mesh(ge,J)).frustumCulled=!1,oe.renderOrder=w.MxData.iCADMeshRenderOrder,y.add(oe),this._entitys.push(oe)}}},ee.prototype.addGeometryCurve=function(h,y,j,Y,q){0<h.length&&(this._geometryCurvePostion.push(h),this._geometryCurveColor.push(y)),0<j.length&&this._geometryCurvePositionsByBlock.push(j),0<Y.length&&this._geometryCurvePositionsByLayer.push(Y),0<q.length&&this._geometryCurvePositionsByBlock_ZeroLayer.push(q)},ee.prototype.addGeometryMesh=function(h,y,j,Y,q){0<h.length&&(this._geometryMeshPostion.push(h),this._geometryMeshColor.push(y)),0<j.length&&this._geometryMeshPositionsByBlock.push(j),0<Y.length&&this._geometryMeshPositionsByLayer.push(Y),0<q.length&&this._geometryMeshPositionsByBlock_ZeroLayer.push(q)},ee.prototype.addGeometryTexture=function(h,y,j,Y,q,V,ne){var ie=new R;ie.pos=h,ie.textureCoord=y,ie.color=j,ie.sFileName=Y,ie.dAngel=q,ie.ptRotationPostionX=V,ie.ptRotationPostionY=ne,this._TextureData.push(ie)},ee.prototype.addMemorySections=function(h){this._MemorySections.push(h)},ee.prototype.createThreejsObj=function(h,y,j,Y,q){var V=j.getScene(),ne=j.getCanvas();if(h.length!=0){if(this._color==null){var ie=Y.getColor(q);this._color=[],this._color.push((255&ie)/255,(ie>>8&255)/255,(ie>>16&255)/255),this._colorValue=16777215&ie}this._geometryCurvePostion.length==0&&this._geometryCurvePositionsByBlock.length==0&&this._geometryCurvePositionsByLayer.length==0&&this._geometryCurvePositionsByBlock_ZeroLayer.length==0||this.createThreejsObjForCurve(h,V),this._geometryMeshPostion.length==0&&this._geometryMeshPositionsByBlock.length==0&&this._geometryMeshPositionsByLayer.length==0&&this._geometryMeshPositionsByBlock_ZeroLayer.length==0||this.createThreejsObjForMesh(h,V),this._TextureData.length!=0&&this.createThreejsObjForTexture(h,V,j),this._MemorySections.length!=0&&this.createThreejsObjForMemorySections(h,V,j)}y.size!=0&&(this._color==null&&(ie=Y.getColor(q),this._color=[],this._color.push((255&ie)/255,(ie>>8&255)/255,(ie>>16&255)/255),this._colorValue=16777215&ie),this._geometryCurvePostion.length==0&&this._geometryCurvePositionsByBlock.length==0&&this._geometryCurvePositionsByLayer.length==0&&this._geometryCurvePositionsByBlock_ZeroLayer.length==0||this.createThreejsObjForCurve_Clip(y,V,ne),this._geometryMeshPostion.length==0&&this._geometryMeshPositionsByBlock.length==0&&this._geometryMeshPositionsByLayer.length==0&&this._geometryMeshPositionsByBlock_ZeroLayer.length==0||this.createThreejsObjForMesh_Clip(y,V,ne),this._TextureData.length!=0&&this.createThreejsObjForTexture_Clip(y,V,j),this._MemorySections.length!=0&&this.createThreejsObjForMemorySections_clip(y,V,j)),this._geometryCurvePostion=[],this._geometryCurvePositionsByBlock=[],this._geometryCurvePositionsByLayer=[],this._geometryCurvePositionsByBlock_ZeroLayer=[],this._geometryCurveColor=[],this._geometryMeshPostion=[],this._geometryMeshPositionsByBlock=[],this._geometryMeshPositionsByLayer=[],this._geometryMeshPositionsByBlock_ZeroLayer=[],this._geometryMeshColor=[],this._TextureData=[],this._MemorySections=[]},ee);function ee(h){this._blockRecId=0,this._TextureData=[],this._MemorySections=[],this._geometryCurvePostion=new Array,this._geometryCurveColor=new Array,this._geometryMeshPostion=new Array,this._geometryMeshColor=new Array,this._geometryCurvePositionsByBlock=new Array,this._geometryMeshPositionsByBlock=new Array,this._geometryCurvePositionsByLayer=new Array,this._geometryMeshPositionsByLayer=new Array,this._geometryCurvePositionsByBlock_ZeroLayer=new Array,this._geometryMeshPositionsByBlock_ZeroLayer=new Array,this._entitys=new Array,this._color=void 0,this._colorValue=16777215,this._material_clip=[],this._blockRecId=h}s.Layer=_;var k=(E.prototype.showLayer=function(h,y){var j=this._layerTogeometry.get(h);j!=null&&j.Show(y)},E.prototype.updataClipMaterial=function(h){var y=h.getCanvas();this._layerTogeometry.forEach(function(j,Y,q){j.updataClipMaterial(y)})},E.prototype.getId=function(){return this._id},E.prototype.getBlkRef=function(){return this._blkRef},E.prototype.createThreejsObj=function(h,y){var j=this;this._layerTogeometry.forEach(function(Y,q,V){Y.createThreejsObj(j._instance,j._instance_clip,h,y,q)})},E.prototype.addGeometryCurve=function(h,y,j,Y,q,V){var ne=this._layerTogeometry.get(j);ne==null&&(ne=new _(this._id),this._layerTogeometry.set(j,ne)),ne.addGeometryCurve(h,y,Y,q,V)},E.prototype.addMemorySections=function(h){var y=this._layerTogeometry.get(h.layerId);y==null&&(y=new _(this._id),this._layerTogeometry.set(h.layerId,y)),y.addMemorySections(h)},E.prototype.addGeometryTexture=function(h,y,j,Y,q,V,ne,ie){var he=this._layerTogeometry.get(Y);he==null&&(he=new _(this._id),this._layerTogeometry.set(Y,he)),he.addGeometryTexture(h,y,j,q,V,ne,ie)},E.prototype.addGeometryMesh=function(h,y,j,Y,q,V){var ne=this._layerTogeometry.get(j);ne==null&&(ne=new _(this._id),this._layerTogeometry.set(j,ne)),ne.addGeometryMesh(h,y,Y,q,V)},E.prototype.addInstance=function(h){var y;h.clipPlans.ver<=3?h.clipPlans.clipPlanArray.length==0?this._instance.length<5e4&&this._instance.push(h):((y=this._instance_clip.get(h.clipPlans.id))==null&&(y=[],this._instance_clip.set(h.clipPlans.id,y)),y.push(h)):h.clipPlans.instansClipePoints.length==0||100<this._instance_clip.size?this._instance.length<5e4&&this._instance.push(h):((y=this._instance_clip.get(h.clipPlans.id))==null&&(y=[],this._instance_clip.set(h.clipPlans.id,y)),y.push(h))},E.prototype.addBlkRef=function(h){this._blkRef.push(h)},E);function E(h){this._id=0,this._layerTogeometry=new Map,this._blkRef=[],this._instance=[],this._instance_clip=new Map,this._id=h}s.Block=k;var W=(C.prototype.crateBlock=function(h){var y=this._mapBlock.get(h);return y==null&&(y=new k(h),this._mapBlock.set(h,y)),y},C.prototype.getBlock=function(h){return this._mapBlock.get(h)},C.prototype.addBlockRef=function(h){this.crateBlock(h.blkOwnerId).addBlkRef(h)},C.prototype.showLayer=function(h,y){this._mapBlock.forEach(function(j,Y){var q=j,V=Y;return function(ne,ie,he){ne.showLayer(q,V)}}.call(this,h,y))},C.prototype.createBlocks_30=function(h,y){if(!this._isCreate){this.crateBlock(0);for(var j=1,Y=h.getInt32(12,!0),q=80,V=0;V<Y;V++){var ne=h.getInt32(q,!0);q+=4;var ie=h.getInt32(q,!0);q+=4;var he=h.getInt32(q,!0);q+=4;var be=h.getInt32(q,!0);q+=4;for(var je=new Array,xe=0;xe<16;xe++){var Fe=h.getFloat32(q,!0);q+=4,je.push(Fe)}var J=h.getInt32(q,!0);q+=4;var ge=new f;ge.id=j,ge.ver=3,j++,ge.clipPlanArray=[];for(var oe=0;oe<J;oe++){var le=h.getFloat32(q,!0);q+=4;var Re=h.getFloat32(q,!0);q+=4;var Ye=h.getFloat32(q,!0);q+=4;var Be=h.getFloat32(q,!0);q+=4;var se=new D;se.x1=le,se.y1=Re,se.x2=Ye,se.y2=Be,ge.clipPlanArray.push(se)}var ve=new P;ve.ver=3,ve.mat=new o.Matrix4,ve.mat.fromArray(je),ve.blkRecId=he,ve.blkOwnerId=ne,ve.layerId=ie,ve.color=be,ve.clipPlans=ge,this.crateBlock(he),this.addBlockRef(ve)}this._isGetAllBlocks=!0,this._isCreate=!0}},C.prototype.createBlocks_40=function(h,y){if(!this._isCreate){this.crateBlock(0);for(var j=1,Y=h.getInt32(12,!0),q=80,V=0;V<Y;V++){var ne=h.getInt32(q,!0);q+=4;var ie=h.getInt32(q,!0);q+=4;var he=h.getInt32(q,!0);q+=4;var be=h.getInt32(q,!0);q+=4;for(var je=new Array,xe=0;xe<16;xe++){var Fe=h.getFloat32(q,!0);q+=4,je.push(Fe)}var J=h.getInt32(q,!0);q+=4;var ge=new f;ge.id=j,ge.ver=4,j++,ge.clipPoints=[];for(var oe=0;oe<J;oe++){var le=new o.Vector2;le.x=h.getFloat32(q,!0),q+=4,le.y=h.getFloat32(q,!0),q+=4,ge.clipPoints.push(le)}var Re=new P;Re.ver=4,Re.mat=new o.Matrix4,Re.mat.fromArray(je),Re.blkRecId=he,Re.blkOwnerId=ne,Re.layerId=ie,Re.color=be,Re.clipPlans=ge,this.crateBlock(he),this.addBlockRef(Re)}this._isGetAllBlocks=!0,this._isCreate=!0}},C.prototype.createBlocks=function(h,y){this._isCreate||(new L.MxNetData(h).getVersion_MwBlobHead()<=3?this.createBlocks_30(h,y):this.createBlocks_40(h,y))},C.prototype.updataClipMaterial=function(h){this._mapBlock.forEach(function(y,j,Y){y.updataClipMaterial(h)})},C.prototype.createAllInstance=function(h){var y=this.getBlock(0);if(y==null||this._rootBlockRef==null)return!1;var j=new o.Matrix4,Y=new Map,q=new f;return this._iClipIdCount=1,q.id=this._iClipIdCount,this._iClipIdCount++,this.createAllInstanceCall(y,this._rootBlockRef,j,Y,16777215,h,void 0,q),!0},C.prototype.createThreejsObj=function(h,y,j){this._mapNeedCreateThreejsObj.get(h.getId())==null&&this._mapNeedCreateThreejsObj.set(h.getId(),h),this._isCreateAllInstance||this._isGetAllBlocks&&j.isInitComplete()&&(this._isCreateAllInstance=this.createAllInstance(j)),this._isCreateAllInstance&&(this._mapNeedCreateThreejsObj.forEach(function(Y,q,V){Y.createThreejsObj(y,j)}),this._mapNeedCreateThreejsObj.clear())},C.prototype.createAllInstanceCall=function(h,y,j,Y,q,V,ne,ie){if(Y[h.getId()]!=1){Y[h.getId()]=!0;var he=new T;if(he.mat=new o.Matrix4,he.mat.copy(j),he.mat.multiply(y.mat),y.ver<=3)if(y.clipPlans.clipPlanArray.length==0)he.clipPlans=ie;else{he.clipPlans=y.clipPlans,he.clipPlans.ver=3;for(var be,je,xe,Fe,J=he.clipPlans.clipPlanArray.length,ge=function(){be=new o.Vector3(he.clipPlans.clipPlanArray[oe].x1,he.clipPlans.clipPlanArray[oe].y1,0),je=new o.Vector3(he.clipPlans.clipPlanArray[oe].x2,he.clipPlans.clipPlanArray[oe].y2,0),xe=new o.Vector3(he.clipPlans.clipPlanArray[oe].x1,he.clipPlans.clipPlanArray[oe].y2,0),Fe=new o.Vector3(he.clipPlans.clipPlanArray[oe].x2,he.clipPlans.clipPlanArray[oe].y1,0),be.applyMatrix4(he.mat),je.applyMatrix4(he.mat),xe.applyMatrix4(he.mat),Fe.applyMatrix4(he.mat);var xt=be.x,Rt=be.x,At=be.y,He=be.y,Gt=[];Gt.push(je),Gt.push(xe),Gt.push(Fe),Gt.forEach(function(jt){xt>jt.x&&(xt=jt.x),Rt<jt.x&&(Rt=jt.x),At>jt.y&&(At=jt.y),He<jt.y&&(He=jt.y)}),he.clipPlans.clipPlanArray[oe].x1=xt,he.clipPlans.clipPlanArray[oe].y1=At,he.clipPlans.clipPlanArray[oe].x2=Rt,he.clipPlans.clipPlanArray[oe].y2=He},oe=0;oe<J;oe++)ge()}else if(y.clipPlans.clipPoints.length==0)he.clipPlans=ie;else{he.clipPlans=new f,he.clipPlans.ver=4,he.clipPlans.id=this._iClipIdCount,this._iClipIdCount++,he.clipPlans.instansClipePoints=ie.instansClipePoints.slice(0);var le=[],Re=y.clipPlans.clipPoints;for(J=Re.length,oe=0;oe<J;oe++){var Ye=new o.Vector3(Re[oe].x,Re[oe].y,0);Ye.applyMatrix4(he.mat),le.push(new o.Vector2(Ye.x,Ye.y))}he.clipPlans.instansClipePoints.push(le)}ne==null?he.topLayerColor.push(1,1,1):he.topLayerColor.push(ne[0],ne[1],ne[2]);var Be=y.color>>24&255;if(Be==2)he.color.push((255&q)/255,(q>>8&255)/255,(q>>16&255)/255);else if(Be==1){var se=V.getColor(y.layerId);he.color.push((255&se)/255,(se>>8&255)/255,(se>>16&255)/255),q=se}else he.color.push((255&y.color)/255,(y.color>>8&255)/255,(y.color>>16&255)/255),q=y.color;h.addInstance(he);for(var ve=h.getBlkRef(),Ee=ne==null,rt=0;rt<ve.length;rt++)if(ve[rt].blkRecId!=0){var tt=this.getBlock(ve[rt].blkRecId);if(tt==null)return;Ee&&(ne=[],se=V.getColor(ve[rt].layerId),ne.push((255&se)/255,(se>>8&255)/255,(se>>16&255)/255)),this.createAllInstanceCall(tt,ve[rt],he.mat,Y,q,V,ne,he.clipPlans)}Y[h.getId()]=!1}},C.prototype.initRootBlockRef=function(h){h==null&&((h=new P).mat=new o.Matrix4,h.blkRecId=0,h.blkOwnerId=-1,h.layerId=-1,h.color=16777215),this._rootBlockRef=h},C);function C(){this._mapBlock=new Map,this._mapNeedCreateThreejsObj=new Map,this._isCreate=!1,this._isGetAllBlocks=!1,this._isCreateAllInstance=!1,this._rootBlockRef=void 0,this._iClipIdCount=1}s.Blocks=W;var F=function(){this.blocks=new W,this.layers=new u.MxBrowseLayerData};s.ExternalReferenceDatabase=F;var M=(a.prototype.createTzDwgExternalReferences=function(h){this._mapId2ExternalDatabase.get(h)||this.getBlocks(h).initRootBlockRef()},a.prototype.createExternalReferences=function(h){for(var y=h.getInt32(12,!0),j=80,Y=0;Y<y;Y++){for(var q=new Array,V=0;V<16;V++){var ne=h.getFloat32(j,!0);j+=4,q.push(ne)}var ie=h.getInt32(j,!0);j+=4;var he=h.getInt32(j,!0);if(j+=4,h.getInt32(j,!0),j+=4,ie!=0){var be=this.getBlocks(ie),je=new P;je.mat=new o.Matrix4,je.mat.fromArray(q),je.blkRecId=0,je.blkOwnerId=-1,je.layerId=-1,je.color=he,be.initRootBlockRef(je)}else console.log("mx error iDatabaseIndex")}},a.prototype.getBlocks=function(h){if(h!=0){var y=this._mapId2ExternalDatabase.get(h);return y==null&&(y=new F,this._mapId2ExternalDatabase.set(h,y)),y.blocks}console.log("mx error iDatabaseIndex")},a.prototype.getLayers=function(h){if(h!=0){var y=this._mapId2ExternalDatabase.get(h);return y==null&&(y=new F,this._mapId2ExternalDatabase.set(h,y)),y.layers}console.log("mx error iDatabaseIndex")},a);function a(){this._mapId2ExternalDatabase=new Map}s.ExternalReferenceManager=M},{"../MxFun":27,"../MxManager":29,"../MxNetData":31,"../MxShader":32,"../MxStencilObject":33,"./MxBrowseLayerData":66,three:19}],66:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxBrowseLayerData=void 0;var o=(v.prototype.add=function(u,w,L){this._layerColor[u]=w,this._nametoId[L]=u},v.prototype.setZeroLayerId=function(u){this._zeroLayerId=u},v.prototype.getZeroLayerId=function(){return this._zeroLayerId},v.prototype.getLayerIdForName=function(u){return this._nametoId[u]==null?0:this._nametoId[u]},v.prototype.getColor=function(u){return this._layerColor[u]==null?16777215:this._layerColor[u]},v.prototype.initComplete=function(){this._isSetInstanceComplete=!0},v.prototype.isInitComplete=function(){return this._isSetInstanceComplete},v);function v(){this._isSetInstanceComplete=!1,this._layerColor=new Map,this._nametoId=new Map,this._zeroLayerId=0}s.MxBrowseLayerData=o},{}],67:[function(b,r,s){var o=this&&this.__awaiter||function(_,ee,k,E){return new(k=k||Promise)(function(W,C){function F(h){try{a(E.next(h))}catch(y){C(y)}}function M(h){try{a(E.throw(h))}catch(y){C(y)}}function a(h){var y;h.done?W(h.value):((y=h.value)instanceof k?y:new k(function(j){j(y)})).then(F,M)}a((E=E.apply(_,ee||[])).next())})},v=this&&this.__generator||function(_,ee){var k,E,W,C,F={label:0,sent:function(){if(1&W[0])throw W[1];return W[1]},trys:[],ops:[]};return C={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(C[Symbol.iterator]=function(){return this}),C;function M(a){return function(h){return function(y){if(k)throw new TypeError("Generator is already executing.");for(;C&&y[C=0]&&(F=0),F;)try{if(k=1,E&&(W=2&y[0]?E.return:y[0]?E.throw||((W=E.return)&&W.call(E),0):E.next)&&!(W=W.call(E,y[1])).done)return W;switch(E=0,W&&(y=[2&y[0],W.value]),y[0]){case 0:case 1:W=y;break;case 4:return F.label++,{value:y[1],done:!1};case 5:F.label++,E=y[1],y=[0];continue;case 7:y=F.ops.pop(),F.trys.pop();continue;default:if(!(W=0<(W=F.trys).length&&W[W.length-1])&&(y[0]===6||y[0]===2)){F=0;continue}if(y[0]===3&&(!W||y[1]>W[0]&&y[1]<W[3])){F.label=y[1];break}if(y[0]===6&&F.label<W[1]){F.label=W[1],W=y;break}if(W&&F.label<W[2]){F.label=W[2],F.ops.push(y);break}W[2]&&F.ops.pop(),F.trys.pop();continue}y=ee.call(_,F)}catch(j){y=[6,j],E=0}finally{k=W=0}if(5&y[0])throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}([a,h])}}};Object.defineProperty(s,"__esModule",{value:!0}),s.MxDbDatabase=void 0;var u=b("three"),w=b("../MxFun"),L=b("./MxDbEntity"),U=b("./MxDbEntityGrip"),N=b("./MxDbEntitySelect"),D=b("../MxManager"),f=b("../MxType"),P=b("./MxDbLayerTable"),T=b("./MxDbGroup"),B=b("../MxTools"),G=(R.prototype.getAllEntity=function(){return this.mapIdToEntity},R.prototype.getGroupDictionary=function(){return this.groupDictionary},R.prototype.regenAllMxDbEntity=function(){return this.mapIdToEntity.forEach(function(_){_.upDisplay(),_.setDirtyDisplay(!1)}),!0},R.prototype.upDirtyDisplay=function(){var _=!1;return this.mapIdToEntity.forEach(function(ee){ee.getDirtyDisplay()&&(ee.upDisplay(),ee.setDirtyDisplay(!1),_=!0)}),_},R.prototype.onViewChange=function(){var _=!1;return this.mapIdToEntity.forEach(function(ee){ee.onViewChange()&&(_=!0)}),_},R.prototype.toJsonObject=function(_){var ee={ver:1},k=new u.Vector3(0,0,0),E=new u.Vector3(this.mxObj.getViewWidth(),this.mxObj.getViewHeight(),0),W=f.MxType.MxCloneType.kMxFileClone;_&&(W=f.MxType.MxCloneType.kSaveDwgClone);var C=this.mxObj.screenCoord2Current(k.x,k.y,0),F=this.mxObj.screenCoord2Current(E.x,E.y,0);ee.view={ptView1:C,ptView2:F};var M=[];return this.mapNameToLayer.forEach(function(a){var h={type:W};a.dwgOut(h),h.TypeName="MxDbLayerTableRecord",M.push(h)}),ee.layers=M,this.groupDictionary.dwgOut(ee),ee},R.prototype.saveJson=function(_){var ee=this,k=this.toJsonObject(_),E=f.MxType.MxCloneType.kMxFileClone;_&&(E=f.MxType.MxCloneType.kSaveDwgClone);var W=[];return this.mapIdToEntity.forEach(function(C){var F=C.getUserObject(),M={type:E};F.dwgOut(M),M.TypeName=F.getTypeName(),M.group=ee.groupDictionary.getEntityInGroupName(C.objectId()),W.push(M)}),k.entitys=W,k},R.prototype.reInit=function(){this.eraseAllEntity(),this.groupDictionary=new T.MxDbGroupDictionary;var _=this.parentObject.matrix;this.init(this.mxObj),this.initObjectMatrix(_)},R.prototype.init=function(_){this.mxObj=_,this.scene=_.getScene(),w.MxFun.removeThreejsObject(this.parentObject,this.scene),w.MxFun.removeThreejsObject(this.parentObject_SmallCoord,this.scene),this.parentObject=new u.Object3D,this.parentObject.renderOrder=D.MxData.iMxEntityRenderOrder,this.scene.add(this.parentObject),this.parentObject_SmallCoord=new u.Object3D,this.parentObject_SmallCoord.renderOrder=D.MxData.iMxEntityRenderOrder,this.scene.add(this.parentObject_SmallCoord),this.initLayerTable()},R.prototype.loadJson=function(_){return o(this,void 0,void 0,function(){var ee,k,E,W,C,F,M,a,h,y,j=this;return v(this,function(Y){switch(Y.label){case 0:if(this.reInit(),(ee=_).view&&(k=ee.view,this.mxObj.zoomW(new u.Vector3(k.ptView1.x,k.ptView1.y,0),new u.Vector3(k.ptView2.x,k.ptView2.y,0),!1)),E=ee.layers)for(W=E.length,y=0;y<W;y++)C=E[y],this.addLayer(C.name).dwgIn(C);this.groupDictionary.dwgIn(ee),F=ee.entitys,M=F.length,a=function(q){var V,ne,ie,he;return v(this,function(be){switch(be.label){case 0:return V=F[q],[4,D.MxManager.getMxDbEntityClassHierarchy().createMxEntity(V.TypeName)];case 1:return(ne=be.sent())?(ne.dwgIn(V),(ie=new L.MxDbEntity).initUserObject(ne),h.addEntityImp(ie),(he=V.group)&&0<he.length&&he.forEach(function(je){j.groupDictionary.add(je).append(ie.objectId())}),[2]):[2,"continue"]}})},h=this,y=0,Y.label=1;case 1:return y<M?[5,a(y)]:[3,4];case 2:Y.sent(),Y.label=3;case 3:return y++,[3,1];case 4:return[2,new Promise(function(q){q(!0)})]}})})},R.prototype.getMxObject=function(){return this.mxObj},R.prototype.getGripManager=function(){return this.gripManager},R.prototype.getSelectManager=function(){return this.selectManager},R.prototype.clearMxCurrentSelect=function(){var _=!1;return this.gripManager.removeAllGrips()&&(_=!0),this.selectManager.removeAllEntity()&&(_=!0),_},R.prototype.eraseAllEntity=function(){this.mapIdToEntity.forEach(function(_){_.clearDisplayImp()}),this.mapIdToEntity=new Map,this.clearMxCurrentSelect()},R.prototype.initObjectMatrix=function(_){this.parentObject.matrix=_,this.parentObject.matrixAutoUpdate=!1,this.parentObject_SmallCoord.matrix=new u.Matrix4,this.parentObject_SmallCoord.matrixAutoUpdate=!1},R.prototype.initLayerTable=function(){this.mapNameToLayer=new Map,this.curLayer="0";var _=new P.MxDbLayerTableRecord;_.init(this.curLayer,this.parentObject,this.parentObject_SmallCoord),this.mapNameToLayer.set(this.curLayer,_)},R.prototype.getEntity=function(_){return this.mapIdToEntity.get(_)},R.prototype.isValidId=function(_){return this.mapIdToEntity.has(_)},R.prototype.setRenderOrder=function(_){var ee=this.parentObject.renderOrder;return this.parentObject.renderOrder=_,this.parentObject_SmallCoord.renderOrder=_,ee},R.prototype.eraseEntity=function(_){this.gripManager.deleteGripData(_),this.selectManager.deleteSelect(_),this.mapIdToEntity.delete(_)},R.prototype.showLayer=function(_,ee){var k=this.getLayer(_);k&&k.setVisible(ee)},R.prototype.setCurrentLayer=function(_){if(_.length!=0)return this.curLayer=_,this.addLayer(_)},R.prototype.addLayer=function(_){var ee=this.mapNameToLayer.get(_);return ee||((ee=new P.MxDbLayerTableRecord).init(_,this.parentObject,this.parentObject_SmallCoord),this.mapNameToLayer.set(_,ee),ee)},R.prototype.getLayer=function(_){return this.mapNameToLayer.get(_)},R.prototype.addMxEntity=function(_){if(_.getImp())return _.objectId();var ee=new L.MxDbEntity;return ee.initUserObject(_),_.initGuid(B.MxTools.generateUUID()),this.addEntityImp(ee)},R.prototype.addEntityImp=function(_){return this.mapIdToEntity.set(this.idCount,_),_.setMxDatabase(this),_.setObjectId(this.idCount),_.getLayer().length==0&&_.setLayer(this.curLayer),_.upDisplay(),this.idCount++},R.prototype.getThreeJSParentObject=function(){return this.parentObject},R.prototype.getThreeJSParentObject_SmallCoord=function(){return this.parentObject_SmallCoord},R.prototype.getIntersectObjects=function(_){var ee=this.getIntersectObjects_imp(_),k=this.getIntersectObjects_SmallCoord_imp(_);return ee.concat(k)},R.prototype.getIntersectObjects_imp=function(_){return this.mxObj.getMxDrawThreeJs().createRaycaster(_).intersectObjects(this.parentObject.children,!0)},R.prototype.getIntersectObjects_SmallCoord_imp=function(_){return this.mxObj.getMxDrawThreeJs().createRaycaster(_).intersectObjects(this.parentObject_SmallCoord.children,!0)},R);function R(){this.mapIdToEntity=new Map,this.mxObj=null,this.scene=null,this.idCount=1,this.parentObject=null,this.parentObject_SmallCoord=null,this.mapNameToLayer=new Map,this.curLayer="0",this.gripManager=new U.MxDbEntityGrip(this),this.selectManager=new N.MxDbEntitySelect(this),this.groupDictionary=new T.MxDbGroupDictionary}s.MxDbDatabase=G},{"../MxFun":27,"../MxManager":29,"../MxTools":37,"../MxType":38,"./MxDbEntity":68,"./MxDbEntityGrip":69,"./MxDbEntitySelect":70,"./MxDbGroup":71,"./MxDbLayerTable":72,three:19}],68:[function(b,r,s){var o=this&&this.__awaiter||function(R,_,ee,k){return new(ee=ee||Promise)(function(E,W){function C(a){try{M(k.next(a))}catch(h){W(h)}}function F(a){try{M(k.throw(a))}catch(h){W(h)}}function M(a){var h;a.done?E(a.value):((h=a.value)instanceof ee?h:new ee(function(y){y(h)})).then(C,F)}M((k=k.apply(R,_||[])).next())})},v=this&&this.__generator||function(R,_){var ee,k,E,W,C={label:0,sent:function(){if(1&E[0])throw E[1];return E[1]},trys:[],ops:[]};return W={next:F(0),throw:F(1),return:F(2)},typeof Symbol=="function"&&(W[Symbol.iterator]=function(){return this}),W;function F(M){return function(a){return function(h){if(ee)throw new TypeError("Generator is already executing.");for(;W&&h[W=0]&&(C=0),C;)try{if(ee=1,k&&(E=2&h[0]?k.return:h[0]?k.throw||((E=k.return)&&E.call(k),0):k.next)&&!(E=E.call(k,h[1])).done)return E;switch(k=0,E&&(h=[2&h[0],E.value]),h[0]){case 0:case 1:E=h;break;case 4:return C.label++,{value:h[1],done:!1};case 5:C.label++,k=h[1],h=[0];continue;case 7:h=C.ops.pop(),C.trys.pop();continue;default:if(!(E=0<(E=C.trys).length&&E[E.length-1])&&(h[0]===6||h[0]===2)){C=0;continue}if(h[0]===3&&(!E||h[1]>E[0]&&h[1]<E[3])){C.label=h[1];break}if(h[0]===6&&C.label<E[1]){C.label=E[1],E=h;break}if(E&&C.label<E[2]){C.label=E[2],C.ops.push(h);break}E[2]&&C.ops.pop(),C.trys.pop();continue}h=_.call(R,C)}catch(y){h=[6,y],k=0}finally{ee=E=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([M,a])}}};Object.defineProperty(s,"__esModule",{value:!0}),s.MxDbEntity=s.MxDbEntityClassHierarchy=s.MxDbEntityUserObject=void 0;var u=b("three"),w=b("../Operate/McGiWorldDraw"),L=b("../MxManager"),U=b("../MxTools"),N=b("../MxType"),D=(f.prototype.getClosestPointTo=function(R,_){return null},f.prototype.getTypeName=function(){return""},f.prototype.isUseSmallcoordDisplay=function(){return this.use_smallcoord_display},f.prototype.toSmallcoord=function(R,_){return this.use_smallcoord_display?R.toSmallcoord(_):_},f.prototype.initGuid=function(R){0<this.sGuid.length?console.log("mx: init guid error"):this.sGuid=R},f.prototype.guid=function(){return this.sGuid},f.prototype.setGuid=function(R){this.sGuid=R},f.prototype.setLayer=function(R){var _=this.getImp();_&&_.nodifySetLayer(),this.layer=R},f.prototype.getLayer=function(){return this.layer},f.prototype.setDash=function(R,_){this.dDashArray=R,this.dDashRatio=_,this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0)},f.prototype.getDash=function(){return{dDashArray:this.dDashArray,dDashRatio:this.dDashRatio}},f.prototype.setDashLineDisplay=function(R){R?(this.dDashArray=.03,this.dDashRatio=.1,this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0)):(this.dDashArray=0,this.dDashRatio=0)},f.prototype.isDashLineDisplay=function(){return 0<this.dDashArray&&0<this.dDashRatio},f.prototype.setLineWidthByPixels=function(R){this.lineWidthByPixels=R},f.prototype.getLineWidthByPixels=function(){return this.lineWidthByPixels},f.prototype.setLineWidth=function(R){this.dLineWidth=R},f.prototype.getLineWidth=function(){return this.dLineWidth},f.prototype.getMxObject=function(){var R=this.getImp();return R?R.getMxObject():null},f.prototype.onViewChange=function(){return!1},f.prototype.getImp=function(){return this.MxDbEntityImp},f.prototype.upDisplay=function(){var R=this.getImp();return!!R&&R.upDisplay()},f.prototype.erase=function(){var R=this.getImp();return!!R&&R.erase()},f.prototype.setColor=function(R){this.iColor=R},f.prototype.getColor=function(){return this.iColor},f.prototype.setRenderOrder=function(R){this.iRenderOrder=R},f.prototype.getRenderOrder=function(){return this.iRenderOrder},f.prototype.onEndGripEidt=function(){},f.prototype.onStartGripEidt=function(){},f.prototype.dwgIn=function(R){return this.iColor=R.iColor,this.iRenderOrder=R.iRenderOrder,this.opacity=R.opacity,this.visible=R.visible,this.dLineWidth=R.lineWidth,this.lineWidthByPixels=R.lineWidthByPixels,this.dDashArray=R.dashArray,this.dDashRatio=R.dashRatio,this.layer=R.layer,R.guid&&(this.sGuid=R.guid),!0},f.prototype.dwgOut=function(R){return R.iColor=this.iColor,R.iRenderOrder=this.iRenderOrder,R.opacity=this.opacity,R.visible=this.visible,R.lineWidth=this.dLineWidth,R.lineWidthByPixels=this.lineWidthByPixels,R.dashArray=this.dDashArray,R.dashRatio=this.dDashRatio,R.layer=this.layer,R.guid=this.sGuid,R},f.prototype.clone=function(R){var _=this.create(),ee={type:R||N.MxType.MxCloneType.kClone};return this.dwgOut(ee),_.dwgIn(ee),_.sGuid="",_},f.prototype.init=function(){L.MxManager.getMxDbEntityClassHierarchy().init(this)},f.prototype.transformBy=function(R){},f.prototype.objectId=function(){var R=this.getImp();return R?R.objectId():0},f);function f(){this.iColor=16777215,this.iRenderOrder=L.MxData.iMxEntityRenderOrder,this.opacity=1,this.visible=!0,this.dLineWidth=0,this.lineWidthByPixels=!0,this.dDashArray=0,this.dDashRatio=0,this.layer="",this.sGuid="",this.use_smallcoord_display=!1}s.MxDbEntityUserObject=D;var P=(T.prototype.init=function(R){var _=R.getTypeName();this.mapType2Create.get(_)&&console.log("MxError:already has this class name "+_),this.mapType2Create.set(_,{type:0,createfun:R})},T.prototype.initDynamic=function(R){this.dynmaicCreate=R},T.prototype.createMxEntity=function(R){return o(this,void 0,void 0,function(){var _,ee;return v(this,function(k){switch(k.label){case 0:return(_=this.mapType2Create.get(R))?[3,3]:this.dynmaicCreate?[4,this.dynmaicCreate(R)]:[3,2];case 1:return(ee=k.sent())?(this.mapType2Create.set(R,{type:1,createfun:ee}),[2,new Promise(function(E,W){E(new ee)})]):[2,new Promise(function(E,W){E(null)})];case 2:return[2,new Promise(function(E,W){E(null)})];case 3:return _.type==0?[2,new Promise(function(E,W){E(_.createfun.create())})]:_.type==1?[2,new Promise(function(E,W){E(new _.createfun)})]:[2,new Promise(function(E,W){E(null)})]}})})},T);function T(){this.mapType2Create=new Map,this.dynmaicCreate=null}s.MxDbEntityClassHierarchy=P;var B=(G.prototype.setObjectId=function(R){this.id=R},G.prototype.nodifySetLayer=function(){this.layerObjectGroup&&this.clearDisplayImp()},G.prototype.setLayer=function(R){this.userObject.setLayer(R)},G.prototype.getLayer=function(){return this.userObject.getLayer()},G.prototype.setDirtyDisplay=function(R){this.isDirtyDisplay=R},G.prototype.getDirtyDisplay=function(){return this.isDirtyDisplay},G.prototype.setMxDatabase=function(R){this.mxDatabase=R},G.prototype.objectId=function(){return this.id},G.prototype.initUserObject=function(R){(this.userObject=R).MxDbEntityImp=this},G.prototype.upDisplay=function(){if(!this.mxDatabase)return console.log("mxassert(0) this.mxDatabase is null"),!1;this.updateDisplayImp(this.mxDatabase.getMxObject())},G.prototype.erase=function(){if(this.id==0)return!1;this.clearDisplayImp(),this.userObject=null,this.mxDatabase.eraseEntity(this.id),this.id=0,this.mxDatabase=null},G.prototype.clearDisplayImp=function(){this.layerObjectGroup&&(this.threeObjectGroup&&(this.threeObjectGroup.traverse(function(R){R.type==="Mesh"&&(R.geometry.dispose(),R.material.dispose())}),this.layerObjectGroup.remove(this.threeObjectGroup)),this.threeObjectGroup=null,this.layerObjectGroup=null)},G.prototype.updateDisplayImp=function(R){if(this.clearDisplayImp(),this.userObject){if(this.userObject.visible){var _=this.mxDatabase.addLayer(this.userObject.getLayer());if(!_)return console.log("mxassert(0) this.layerRecord is null"),!1;this.threeObjectGroup=new u.Object3D;var ee=new w.McGiWorldDraw(R,w.McGiWorldDrawType.kWorldDraw);ee.setupForEntity(this.userObject),this.worldDraw(ee);for(var k=ee.getEntitys(),E=k.length,W=0;W<E;W++){var C=k[W];(C.MxDbEntity=this).threeObjectGroup.add(C)}this.userObject.isUseSmallcoordDisplay()?this.layerObjectGroup=_.getGroup_SmallCoord():this.layerObjectGroup=_.getGroup(),this.layerObjectGroup.add(this.threeObjectGroup)}}else U.MxTools.MxASSERT(!1,"this.userObject == null")},G.prototype.worldDraw=function(R){this.userObject.worldDraw(R)},G.prototype.getGripPoints=function(){return this.userObject.getGripPoints()},G.prototype.getClosestPointTo=function(R,_){return this.userObject.getClosestPointTo(R,_)},G.prototype.getUserObject=function(){return this.userObject},G.prototype.clone=function(R){var _=new G;return _.initUserObject(this.userObject.clone(R)),_},G.prototype.transformBy=function(R){this.userObject.transformBy(R)},G.prototype.setColor=function(R){this.userObject.setColor(R)},G.prototype.onEndGripEidt=function(){this.userObject.onEndGripEidt()},G.prototype.onStartGripEidt=function(){return this.userObject.onStartGripEidt()},G.prototype.getColor=function(){return this.userObject.getColor()},G.prototype.getMxObject=function(){return this.mxDatabase?this.mxDatabase.getMxObject():null},G.prototype.onViewChange=function(){return!!this.userObject&&this.userObject.onViewChange()},G);function G(){this.threeObjectGroup=null,this.userObject=null,this.mxDatabase=null,this.isDirtyDisplay=!1,this.layerObjectGroup=null,this.id=0}s.MxDbEntity=B},{"../MxManager":29,"../MxTools":37,"../MxType":38,"../Operate/McGiWorldDraw":43,three:19}],69:[function(b,r,s){var o,v=this&&this.__extends||(o=function(E,W){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,F){C.__proto__=F}||function(C,F){for(var M in F)Object.prototype.hasOwnProperty.call(F,M)&&(C[M]=F[M])})(E,W)},function(E,W){if(typeof W!="function"&&W!==null)throw new TypeError("Class extends value "+String(W)+" is not a constructor or null");function C(){this.constructor=E}o(E,W),E.prototype=W===null?Object.create(W):(C.prototype=W.prototype,new C)});Object.defineProperty(s,"__esModule",{value:!0}),s.MxDbEntityGrip=s.MxDbEntityGripJig=s.MxGetWordDrawxDataForThreeJsObject=s.MxGetMxDbEntitForThreeJsObject=s.MxDbEntityGripData=void 0;var u=b("three"),w=b("../MxFun"),L=b("../MxDrawData"),U=b("../Operate/MxJig"),N=b("../Operate/MxJigCmdManager"),D=b("../Operate/McGiWorldDraw"),f=b("../MxManager"),P=b("../MxType"),T=function(){this.threeObject=null};function B(E){for(var W=null;E&&!(W=E.MxDbEntity)&&E.parent;)E=E.parent;return W}s.MxDbEntityGripData=T,s.MxGetMxDbEntitForThreeJsObject=B,s.MxGetWordDrawxDataForThreeJsObject=function(E){for(var W=null;E&&!(W=E.MxWordDrawXData)&&E.parent;)E=E.parent;return W};var G,R=(v(_,G=U.McEdJigCommand),_.prototype.sampler=function(){var E=N.MxJigCmdManager.InType.kGetBegan|N.MxJigCmdManager.InType.kGetEnd,W=this.acquirePoint(E);return W.status==N.MxJigCmdManager.DragStatus.kNormal&&(this.currPt=W.pt),W.status},_.prototype.getTypeName=function(){return"MxGripEdit"},_.prototype.onStartCommand=function(){this.iscallOnStartCommand=!0,G.prototype.onStartCommand.call(this)},_.prototype.done=function(E){if(E==N.MxJigCmdManager.DragStatus.kNormal){var W=this.currPt.clone();W.sub(this.dragBasePt);for(var C=this.getMxObject(),F=C.getMxDatabase(),M=C.getMxDatabase().getGripManager(),a=this.grips.length,h=new Set,y=[],j=0;j<a;j++){var Y=this.grips[j],q=this.ents[j];M.deleteGripData(q.objectId()),q.getUserObject().moveGripPointsAt(Y.iIndex,W),M.addGripFromEntity(q),q.upDisplay(),h.add(q.objectId());var V={id:q.objectId(),index:Y.iIndex,curentPoint:this.currPt};y.push(V)}C.updateDisplay(),0<y.length&&C.callEvent("objectGripEdit",y),F.getSelectManager().upSelectDilsplay(h)}var ne=this.ents.length;for(j=0;j<ne;j++)(q=this.ents[j]).onEndGripEidt(),E!=N.MxJigCmdManager.DragStatus.kNormal&&q.upDisplay();return N.MxJigCmdManager.DoneStatius.kExitCommand},_.prototype.upDisplay=function(){var E=this.currPt.clone();if(E.sub(this.dragBasePt),!(E.length()<.001)){if(this.iscallOnStartCommand){for(var W=this.ents.length,C=0;C<W;C++){var F=this.ents[C];this.aryParam.push(F.onStartGripEidt())}this.iscallOnStartCommand=!1}var M=this.getMxObject(),a=this.grips.length;for(C=0;C<a;C++){var h=this.grips[C],y=(F=this.ents[C],this.aryParam[C]),j=F.clone(P.MxType.MxCloneType.kDragClone);j.getUserObject().moveGripPointsAt(h.iIndex,E);var Y=new D.McGiWorldDraw(M,D.McGiWorldDrawType.kDynDragDraw);Y.setupForEntity(j.getUserObject()),j.worldDraw(Y);var q=Y.getEntitys(),V=q.length,ne=31;y&&y.renderOrder&&(ne=y.renderOrder);for(var ie=0;ie<V;ie++)this.drawEntity(q[ie],ne,j.getUserObject().isUseSmallcoordDisplay())}}},_);function _(E,W,C){var F=G.call(this)||this;return F.aryParam=[],F.iscallOnStartCommand=!0,F.dragBasePt=E,F.grips=W,F.ents=C,F.currPt=E,F.iscallOnStartCommand=!0,F}s.MxDbEntityGripJig=R;var ee=(k.prototype.getAllSelect=function(){var E=[];return this.mapGrips.forEach(function(W,C){E.push(C)}),E},k.prototype.getParentGroup=function(){return this.drawGroup||(this.drawGroup=new u.Group,this.drawGroup.renderOrder=f.MxData.iGripRenderOrder,this.database.getMxObject().getTheTempDrawContainer_SmallCoord().add(this.drawGroup)),this.drawGroup},k.prototype.reInit=function(){this.removeAllGrips(),this.drawGroup&&w.MxFun.removeThreejsObject(this.drawGroup,this.database.getMxObject().getTheTempDrawContainer_SmallCoord()),this.drawGroup=null},k.prototype.removeAllGrips=function(){if(this.mapGrips.size==0)return!1;var E=this.getParentGroup();return this.mapGrips.forEach(function(W,C,F){for(var M=W.length,a=0;a<M;a++){var h=W[a];w.MxFun.removeThreejsObject(h.threeObject,E)}}),this.mapGrips=new Map,!0},k.prototype.deleteGripData=function(E){var W=this.getParentGroup(),C=this.mapGrips.get(E);if(C)for(var F=C.length,M=0;M<F;M++){var a=C[M];w.MxFun.removeThreejsObject(a.threeObject,W)}this.mapGrips.delete(E)},k.prototype.createGripDisplayObject=function(E){var W=this.database.getMxObject(),C=this.getParentGroup();E.geometry=new u.Geometry;var F=W.toSmallcoord2(E.point.x,E.point.y,E.point.z),M=W.screenCoordLong2World(L.MxDrawData.m_dInputRectWidth/2);E.geometry.vertices.push(new u.Vector3(F.x-M,F.y-M,0)),E.geometry.vertices.push(new u.Vector3(F.x-M,F.y+M,0)),E.geometry.vertices.push(new u.Vector3(F.x+M,F.y+M,0)),E.geometry.vertices.push(new u.Vector3(F.x+M,F.y-M,0)),E.geometry.faces.push(new u.Face3(0,1,2)),E.geometry.faces.push(new u.Face3(2,3,0)),E.geometry.computeFaceNormals(),E.geometry.computeVertexNormals();var a=new u.MeshBasicMaterial({color:255,transparent:!0,depthTest:!1,side:u.DoubleSide,opacity:.9}),h=new u.Mesh(E.geometry,a);C.add(h),E.threeObject=h},k.prototype.addGripData=function(E,W,C){var F=this.mapGrips.get(E);F==null&&(F=new Array,this.mapGrips.set(E,F));var M=new T;return M.iIndex=W,M.point=new u.Vector3(C.x,C.y,0),F.push(M),M},k.prototype.hitTest=function(E){var W=this,C={grips:new Array,ents:new Array,pt:E},F=new u.Vector3(E.x,E.y,0),M=this.database.getMxObject(),a=M.viewCoordLong2Cad(L.MxDrawData.m_dInputRectWidth/2);return this.mapGrips.forEach(function(h,y){for(var j=h.length,Y=0;Y<j;Y++){var q=h[Y];if(q.point.distanceTo(F)<=a){var V=W.database.getEntity(y),ne=!0;M.hasEvent("whetherEditTheGripPoint")&&(ne=M.callEvent("whetherEditTheGripPoint",{entity:V.getUserObject(),index:q.iIndex})),ne&&(C.grips.push(q),C.ents.push(V));break}}}),C},k.prototype.onMouseLBDown=function(E){if(!L.MxDrawData.m_isEnableGripEidt)return!1;var W=this.hitTest(E);return W.grips.length!=0&&(w.MxFun.sendStringToExecute("Mx_FrontEndWebpageGripEdit",W),!0)},k.prototype.gripEditImp=function(E){var W=E.grips,C=E.ents,F=E.pt,M=new R(F,W,C);M.setDisableDynInput(!0),M.setDisableOsnap(!0),N.MxJigCmdManager.runCmd(M)},k.prototype.doWindowsSelect=function(E,W){},k.prototype.addGripFromEntity=function(E){if(L.MxDrawData.m_isEnableGripEidt){var W=E.getGripPoints(),C=E.objectId();this.deleteGripData(C);for(var F=0;F<W.length;F++){var M=this.addGripData(C,F,W[F]);this.createGripDisplayObject(M)}}},k.prototype.addSelect=function(E,W,C){C===void 0&&(C=!0);var F=this.database.getSelectManager(),M=!1;if(this.getAllSelect().forEach(function(y){y==E&&(M=!0)}),M)return!1;var a=this.database.getMxObject().getMxEntity(E);if(!a)return!1;var h=new Set;return h.add(E),C&&this.addGripFromEntity(a),F.upSelectDilsplay(h),W&&this.fireMxEntitySelectChange(),!0},k.prototype.fireMxEntitySelectChange=function(){var E=this.database.getMxObject();this.isCallingMxEntitySelectChange||(this.isCallingMxEntitySelectChange=!0,E.callEvent("mxdrawSelectChange",this.getAllSelect()),this.isCallingMxEntitySelectChange=!1)},k.prototype.doPointSelect=function(E){for(var W=!1,C=this.database.getSelectManager(),F=this.database.getMxObject(),M=C.isEmptySelect(),a=!1,h=F.viewCoordLong2Cad(.5*L.MxDrawData.m_dInputRectWidth),y=function(){F.pointMultipleSelect()||(j.removeAllGrips()&&(a=!0),C.removeAllEntity()&&(a=!0),F.getMcObject().isValid()&&(a=F.getMcObject().getGripManager().clearAll()));var Y=j.database.getIntersectObjects(E);if(Y.length==0)return F.updateDisplay(),"break";var q=F.screenCoord2Current(E.x,E.y,E.z),V=j,ne=new Set;Y.forEach(function(be){var je=B(be.object);if(je){var xe=je.objectId();if(V.database.isValidId(xe)&&!ne.has(xe)){var Fe=je.getClosestPointTo(q,1),J=!1;(!Fe||Fe.distanceTo(q)<h)&&(J=!0),J&&(ne.add(xe),V.addGripFromEntity(je))}}});var ie=new Set,he=j.database.getGroupDictionary();return ne.forEach(function(be){ie.add(be),he.getEntityInGroup(be).forEach(function(je){je.getAll().forEach(function(xe){V.database.isValidId(xe)&&ie.add(xe)})})}),a=!0,C.upSelectDilsplay(ie),F.updateDisplay(),W=!0,"break"},j=this;y()!=="break";);return!a&&M==C.isEmptySelect()||this.fireMxEntitySelectChange(),W},k);function k(E){this.database=null,this.mapGrips=new Map,this.isCallingMxEntitySelectChange=!1,this.drawGroup=null,this.database=E}s.MxDbEntityGrip=ee},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxType":38,"../Operate/McGiWorldDraw":43,"../Operate/MxJig":52,"../Operate/MxJigCmdManager":53,three:19}],70:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxDbEntitySelect=void 0;var o=b("three"),v=b("../MxFun"),u=b("three.meshline"),w=b("../Operate/McGiWorldDraw"),L=b("../MxManager"),U=(N.prototype.setRenderOrder=function(D){this.iRenderOrder=D},N.prototype.getRenderOrder=function(){return this.iRenderOrder},N.prototype.setCanvasSize=function(D,f){this.canvasWidth==D&&this.canvasHeight==f||(this.canvasWidth=D,this.canvasHeight=f,this.material.resolution=new o.Vector2(this.canvasWidth,this.canvasHeight),this.material.needsUpdate=!0)},N.prototype.removeAllEntity=function(){return this.mapIdToThreeObject.size!=0&&(this.mapIdToThreeObject.forEach(function(D){for(var f=D.length,P=0;P<f;P++){var T=D[P];v.MxFun.removeThreejsObject(T,T.parentObject)}}),this.mapIdToThreeObject.clear(),!0)},N.prototype.isEmptySelect=function(){return this.mapIdToThreeObject.size==0},N.prototype.getParentObject=function(D){return D?this.mxDatabase.getMxObject().getTheTempDrawContainer_SmallCoord():this.mxDatabase.getMxObject().getTheTempDrawContainer()},N.prototype.getAllSelect=function(){var D=[];return this.mapIdToThreeObject.forEach(function(f,P){D.push(P)}),D},N.prototype.setPrvCommandSelect=function(D){this.aryPrvCommandSelect=D},N.prototype.getPrvCommandSelect=function(){return this.aryPrvCommandSelect},N.prototype.deleteSelect=function(D){var f=this.mapIdToThreeObject.get(D);if(f){for(var P=f.length,T=0;T<P;T++){var B=f[T];v.MxFun.removeThreejsObject(B,B.parentObject)}this.mapIdToThreeObject.delete(D)}},N.prototype.upSelectDilsplayFromId=function(D){var f=new Set;f.add(D),this.upSelectDilsplay(f)},N.prototype.upSelectDilsplay=function(D){var f=this,P=new w.McGiWorldDrawSelect(this.mxDatabase.getMxObject(),this);D.forEach(function(T){f.deleteSelect(T);var B=f.mxDatabase.getEntity(T);B&&(P.setSmallCoordDraw(B.getUserObject().isUseSmallcoordDisplay()),P.setCurEntityId(T),B.worldDraw(P))})},N.prototype.addCircleDisplay=function(D,f,P,T){var B=new o.CircleGeometry(P,64,3,2*Math.PI);if(B.vertices.shift(),B.vertices.length!=0){B.vertices.push(B.vertices[0]);var G=3*B.vertices.length;if(G!=0){for(var R=this.getParentObject(T),_=new Float32Array(G),ee=0,k=0;ee+2<G;ee+=3,k++)_[ee]=B.vertices[k].x+f.x,_[ee+1]=B.vertices[k].y+f.y,_[ee+2]=f.z;var E=new u.MeshLine;E.setGeometry(_);var W=new o.Mesh(E.geometry,this.material);W.renderOrder=this.iRenderOrder,(W.parentObject=R).add(W);var C=this.mapIdToThreeObject.get(D);C||(C=new Array,this.mapIdToThreeObject.set(D,C)),C.push(W)}}},N.prototype.addLineDisplay=function(D,f,P,T){var B=this.getParentObject(T),G=new Float32Array(6);G[0]=f.x,G[1]=f.y,G[2]=0,G[3]=P.x,G[4]=P.y,G[5]=0;var R=new u.MeshLine;R.setGeometry(G);var _=new o.Mesh(R.geometry,this.material);_.renderOrder=this.iRenderOrder,(_.parentObject=B).add(_);var ee=this.mapIdToThreeObject.get(D);ee||(ee=new Array,this.mapIdToThreeObject.set(D,ee)),ee.push(_)},N);function N(D){this.mapIdToThreeObject=new Map,this.canvasWidth=800,this.canvasHeight=500,this.mxDatabase=null,this.material=new u.MeshLineMaterial({useMap:!1,color:new o.Color(2641557),opacity:.8,resolution:new o.Vector2(800,500),sizeAttenuation:!1,lineWidth:10,transparent:!0,depthTest:!1}),this.iRenderOrder=L.MxData.iSelectRenderOrder,this.aryPrvCommandSelect=[],this.mxDatabase=D}s.MxDbEntitySelect=U},{"../MxFun":27,"../MxManager":29,"../Operate/McGiWorldDraw":43,three:19,"three.meshline":18}],71:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxDbGroupDictionary=s.MxDbGroup=void 0;var o=(v.prototype.name=function(){return this.sName},v.prototype.append=function(L){this.has(L)||this.setId.add(L)},v.prototype.clear=function(){this.setId=new Set},v.prototype.getAll=function(){var L=[];return this.setId.forEach(function(U){L.push(U)}),L},v.prototype.has=function(L){return this.setId.has(L)},v.prototype.delete=function(L){return this.setId.delete(L)},v);function v(L){this.setId=new Set,this.sName="",this.sName=L}s.MxDbGroup=o;var u=(w.prototype.getAt=function(L){return this.mapNameToGroup.get(L)},w.prototype.delete=function(L){return!!this.mapNameToGroup.has(L)&&this.mapNameToGroup.delete(L)},w.prototype.add=function(L){var U=this.mapNameToGroup.get(L);return U||(U=new o(L),this.mapNameToGroup.set(L,U),U)},w.prototype.dwgOut=function(L){var U=[];return this.mapNameToGroup.forEach(function(N,D){U.push(D)}),L.groups=U,L},w.prototype.dwgIn=function(L){var U=this;return L.groups.forEach(function(N){var D=new o(N);U.mapNameToGroup.set(N,D)}),!0},w.prototype.getEntityInGroup=function(L){var U=[];return this.mapNameToGroup.forEach(function(N){N.has(L)&&U.push(N)}),U},w.prototype.getEntityInGroupName=function(L){var U=[];return this.mapNameToGroup.forEach(function(N,D){N.has(L)&&U.push(D)}),U},w);function w(){this.mapNameToGroup=new Map}s.MxDbGroupDictionary=u},{}],72:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxDbLayerTableRecord=void 0;var o=b("three"),v=(u.prototype.getGroup=function(){return this.group},u.prototype.getGroup_SmallCoord=function(){return this.group_SmallCoord},u.prototype.getName=function(){return this.name},u.prototype.setName=function(w){this.name=w},u.prototype.setVisible=function(w){this.visible=w,this.group.visible=w,this.group_SmallCoord.visible=w},u.prototype.getVisible=function(){return this.visible},u.prototype.init=function(w,L,U){return this.name=w,L.add(this.group),U.add(this.group_SmallCoord),!0},u.prototype.dwgIn=function(w){return this.visible=w.visible,this.name=w.name,this.group.visible=this.visible,this.group_SmallCoord.visible=this.visible,!0},u.prototype.dwgOut=function(w){return w.visible=this.visible,w.name=this.name,w},u);function u(){this.group=new o.Group,this.group_SmallCoord=new o.Group,this.name="",this.visible=!0}s.MxDbLayerTableRecord=v},{three:19}],73:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MxDbTextureManager=void 0;var o=b("three"),v=(u.prototype.loadImage=function(w,L){var U=this.mapImageUrlToMaterialTexture.get(w);if(U)L(U);else{var N=this;new o.TextureLoader().load(w,function(D){var f=new o.MeshLambertMaterial({map:D,transparent:!0,side:o.DoubleSide});f.map&&(f.map.needsUpdate=!0),N.mapImageUrlToMaterialTexture.set(w,f),L&&L(f)},void 0,function(D){console.log(D),L&&L(null)})}},u);function u(){this.mapImageUrlToMaterialTexture=new Map}s.MxDbTextureManager=v},{three:19}],74:[function(b,r,s){var o,v=this&&this.__extends||(o=function(a,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,j){y.__proto__=j}||function(y,j){for(var Y in j)Object.prototype.hasOwnProperty.call(j,Y)&&(y[Y]=j[Y])})(a,h)},function(a,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function y(){this.constructor=a}o(a,h),a.prototype=h===null?Object.create(h):(y.prototype=h.prototype,new y)});Object.defineProperty(s,"__esModule",{value:!0}),s.MxDrawObject3dThreeJS=s.MxDrawMapBoxThreeJS=s.MxDrawObject2dThreeJS=s.MxDrawThreeJS=s.MxThreeJSType=void 0;var u,w,L,U=b("three"),N=b("../Operate/MxJigCmdManager"),D=b("three-orbitcontrols"),f=b("../UI/MxUiVue"),P=(v(T,u=D.OrbitControls),T.prototype.update=function(){},T);function T(a,h){return u.call(this,a,h)||this}(L=w||(s.MxThreeJSType=w={}))[L.k2d=0]="k2d",L[L.k3d=1]="k3d",L[L.kMapBox=2]="kMapBox";var B=(G.prototype.screenCoord2World=function(a,h,y){return this.mxObject.screenCoord2World_mxdrawThreeJS_call(a,h,y)},G.prototype.worldCoord2Screen=function(a,h,y){return this.mxObject.worldCoord2Screen_mxdrawThreeJS_call(a,h,y)},G.prototype.getDomMousePos=function(a){},G.prototype.createRaycaster=function(a){var h=new U.Raycaster;h.linePrecision=this.mxObject.screenCoordLong2World(10);var y=this.mxObject.getCanvas(),j=y.clientWidth,Y=y.clientHeight,q=new U.Vector2(a.x/j*2-1,-a.y/Y*2+1);return h.setFromCamera(q,this.mxObject.getCamera()),h},G.prototype.zoomW=function(a,h,y,j,Y){return this.mxObject.zoomW_call(a,h,y,Y)},G.prototype.zoomCenter=function(a,h,y){return this.mxObject.zoomCenter_call(a,h)},G.prototype.zoomScale=function(a,h){return this.mxObject.zoomScale_call(a)},G.prototype.setViewAngle=function(a){return this.mxObject.setViewAngle_call(a)},G.prototype.startPanCommand=function(){return this.mxObject.startPanCommand_call()},G.prototype.endPanCommand=function(){return this.mxObject.endPanCommand_call()},G.prototype.isPaningCommand=function(){return this.mxObject.isPaningCommand_call()},G);function G(a){this.mxObject=a}s.MxDrawThreeJS=B;var R,_=(v(ee,R=B),ee.prototype.onInitThreejs=function(){this.proxyObj.onInitThreejs()},ee.prototype.onInitScene=function(){this.proxyObj.onInitScene()},ee.prototype.getType=function(){return w.k2d},ee.prototype.updateCameraDisplayRange=function(a,h,y){this.proxyObj.updateCameraDisplayRangeImp(a,h,y)},ee.prototype.addControlsChangeEvent=function(){var a=this.mxObject;this.mxObject.getOrbitControls().addEventListener("change",function(){N.MxJigCmdManager.OnThreeControlsChage(),a.callViewChange(),a.getMxDatabase().onViewChange(),a.getMcObject().isValid()&&a.getMcObject().getGripManager().onControlsChage(),a.updateDisplay()})},ee.prototype.updateDisplay=function(a){a===void 0&&(a=!1),this.mxObject.updateDisplayImplement(a)},ee.prototype.getRegistEventObject=function(){return this.mxObject.getCanvas()},ee);function ee(a){var h=R.call(this,a)||this;return h.proxyObj=a,h}s.MxDrawObject2dThreeJS=_;var k,E=(v(W,k=B),W.prototype.startPanCommand=function(){this.mapBox.map&&(this.isPaning=!0,this.bakPan=this.mapBox.map.dragPan.useMouseMiddle(!1),f.MxUiVue.setCursorType(f.MxUiVue.CursorType.kPan))},W.prototype.endPanCommand=function(){this.mapBox.map&&this.isPaning&&(this.isPaning=!1,this.mapBox.map.dragPan.useMouseMiddle(this.bakPan),f.MxUiVue.setCursorType(f.MxUiVue.CursorType.kNormal))},W.prototype.isPaningCommand=function(){return this.mapBox.map,this.isPaning},W.prototype.mercatorCoord2CAD=function(a,h){var y=new U.Vector3(a,h,0);return y.applyMatrix4(this.mapBox.matMapToCad),y},W.prototype.cadToMercatorCoord=function(a){return a.applyMatrix4(this.mapBox.matCadToMap),a},W.prototype.setViewAngle=function(a){this.mapBox.map&&this.mapBox.map.setBearing(180*a/Math.PI)},W.prototype.zoomCenter=function(a,h,y){if(this.mapBox.map){var j=this.cadToMercatorCoord(new U.Vector3(a,h,0)),Y=this.mapBox.map.mercator_to_lnglat(j.x,j.y,0),q=this.mapBox.map.getBounds(),V=.5*(q._ne.wrap().lng-q._sw.wrap().lng),ne=.5*(q._ne.wrap().lat-q._sw.wrap().lat);this.mapBox.map.fitBounds([[Y.lng-V,Y.lat-ne],[Y.lng+V,Y.lat+ne]],{animate:!!y})}},W.prototype.zoomScale=function(a,h){if(this.mapBox.map){var y=this.mapBox.map.getBounds(),j=.5*(y._ne.wrap().lng-y._sw.wrap().lng),Y=.5*(y._ne.wrap().lat-y._sw.wrap().lat),q=y._sw.wrap().lng+j,V=y._sw.wrap().lat+Y;j*=a,Y*=a,this.mapBox.map.fitBounds([[q-j,V-Y],[q+j,V+Y]],{animate:!!h})}},W.prototype.zoomW=function(a,h,y,j,Y){if(this.mapBox.map)if(a.distanceTo(h)<1e-7)console.log("Mx:ZoomW param invalid");else{y!==void 0&&y&&(a=this.mxObject2d.docCoord2Cad(a.x,a.y,0),h=this.mxObject2d.docCoord2Cad(h.x,h.y,0));var q=this.cadToMercatorCoord(a),V=this.cadToMercatorCoord(h),ne=this.mapBox.map.mercator_to_lnglat(q.x,q.y,0),ie=this.mapBox.map.mercator_to_lnglat(V.x,V.y,0),he=Math.min(ne.lng,ie.lng),be=Math.max(ne.lng,ie.lng),je=Math.min(ne.lat,ie.lat),xe=Math.max(ne.lat,ie.lat);this.mapBox.map.fitBounds([[he,je],[be,xe]],{animate:!!j})}},W.prototype.onInitScene=function(){},W.prototype.addControlsChangeEvent=function(){},W.prototype.updateDisplay=function(a){this.mapBox.map&&(this.mapBox.map.repaint=!0)},W.prototype.createRaycaster=function(a){if(this.mapBox.map){var h=a.x/this.mapBox.map.transform.width*2-1,y=-a.y/this.mapBox.map.transform.height*2+1,j=this.mxObject2d.getCamera(),Y=new U.Raycaster;Y.linePrecision=this.mxObject2d.screenCoordLong2World(10);var q=new U.Matrix4().getInverse(j.projectionMatrix),V=new U.Vector3().applyMatrix4(q),ne=new U.Vector3(h,y,1).applyMatrix4(q).clone().sub(V).normalize();return Y.setFromCamera(new U.Vector2(h,y),j),Y.set(V,ne),Y}return k.prototype.createRaycaster.call(this,a)},W.prototype.getRegistEventObject=function(){return this.mapBox.canvasContainer},W.prototype.getType=function(){return w.kMapBox},W.prototype.getDomMousePos=function(a){return this.mapBox.map?this.mapBox.map.dom_mousePos(a):void 0},W.prototype.screenCoord2World=function(a,h,y){if(this.mapBox.map){var j=this.mapBox.map.unproject({x:a,y:h}),Y=this.mapBox.map.lnglat_to_mercator(j.lng,j.lat),q=new U.Vector3(Y.x,Y.y,0);return q.applyMatrix4(this.mapBox.matMapToCADDrawCoord),q}return k.prototype.screenCoord2World.call(this,a,h,y)},W.prototype.worldCoord2Screen=function(a,h,y){if(this.mapBox.map){var j=new U.Vector3(a,h,y);j.applyMatrix4(this.mapBox.matCADDrawCoordToMap);var Y=this.mapBox.map.mercator_to_lnglat(j.x,j.y,0),q=this.mapBox.map.project([Y.lng,Y.lat]);return new U.Vector3(q.x,q.y,0)}k.prototype.worldCoord2Screen.call(this,a,h,y)},W.prototype.onInitThreejs=function(){var a=this,h=this.mapBox.threebox;if(h){var y=h.camera,j=h.scene,Y=this.mapBox.canvas,q=h.renderer;this.canvas=Y,q.autoClear=!1;var V=new P(y,Y);this.mxObject2d.mapBoxInitThreeJSObject(j,y,q,V)}else{this.mxObject2d.onInitViewScene(),j=new U.Scene;var ne=(Y=this.mapBox.canvas).clientHeight,ie=Y.clientWidth;y=new U.OrthographicCamera(ie/-2,ie/2,ne/2,ne/-2,.1,1e21),this.canvas=Y;var he=new U.DirectionalLight(16777215);he.position.set(0,-70,100).normalize(),j.add(he);var be=new U.DirectionalLight(16777215);be.position.set(0,70,100).normalize(),j.add(be);var je=this.mxObject2d.getRendererParam();(je=je||{}).canvas=Y,je.context=this.mapBox.gl,(q=new U.WebGLRenderer(je)).autoClear=!1,(V=new P(new U.Camera,Y)).enabled=!1,this.mxObject2d.mapBoxInitThreeJSObject(j,y,q,V)}this.mxObject2d.initRendererParam({retver:"webgl2",webgl2:!0});var xe=this;this.mapBox.render=function(Fe,J){var ge=new U.Matrix4().fromArray(J);ge.multiply(a.matCADDrawCoordToMap);var oe=new U.Vector3(0,0,0);if(oe.applyMatrix4(ge),1<oe.z){var le=1-oe.z-1e-5;ge=new U.Matrix4().makeTranslation(0,0,le).multiply(ge)}xe.mxObject2d.mapBoxRender(Fe,ge,!!xe.mapBox.threebox),xe.mxObject2d.isRenderLoop()&&a.mapBox.map&&(a.mapBox.map.repaint=!0)},this.mapBox.onResize=function(){xe.mxObject2d.mapBox_onResizeImp(xe.canvas.clientWidth,xe.canvas.clientHeight)}},W.prototype.updateCameraDisplayRange=function(a,h,y){if(this.mxObject2d.isCppMxCAD()){(q=new U.Matrix4).makeTranslation(-this.mapBox.cadOrigin.x,-this.mapBox.cadOrigin.y,-this.mapBox.cadOrigin.z),(V=new U.Matrix4).makeTranslation(this.mapBox.mapOrigin.x,this.mapBox.mapOrigin.y,this.mapBox.elevation),(ne=new U.Matrix4).makeScale(this.mapBox.mapLenInCADUnits,-this.mapBox.mapLenInCADUnits,this.mapBox.mapLenInCADUnits);var j=V.multiply(ne).multiply(q),Y=this.mxObject2d.getDoc2CADMatrix();this.matCADDrawCoordToMap=j.clone().multiply(Y),this.mapBox.matcadtsmall=new U.Matrix4,this.mapBox.matcadtsmall.getInverse(Y),this.mapBox.matCADDrawCoordToMap=this.matCADDrawCoordToMap,this.mapBox.matMapToCADDrawCoord=new U.Matrix4,this.mapBox.matMapToCADDrawCoord.getInverse(this.matCADDrawCoordToMap),this.mapBox.matCadToMap=j,this.mapBox.matMapToCad=new U.Matrix4,this.mapBox.matMapToCad.getInverse(j),1e-5<Math.abs(y)&&this.setViewAngle(y),this.zoomW(a,h,!0,!1)}else{var q,V,ne;(q=new U.Matrix4).makeTranslation(-this.mapBox.cadOrigin.x,-this.mapBox.cadOrigin.y,-this.mapBox.cadOrigin.z),(V=new U.Matrix4).makeTranslation(this.mapBox.mapOrigin.x,this.mapBox.mapOrigin.y,this.mapBox.elevation),(ne=new U.Matrix4).makeScale(this.mapBox.mapLenInCADUnits,-this.mapBox.mapLenInCADUnits,this.mapBox.mapLenInCADUnits);var ie=V.multiply(ne).multiply(q),he=this.mxObject2d.getWorldToDoc();this.matCADDrawCoordToMap=ie.clone().multiply(he),this.mapBox.matcadtsmall=new U.Matrix4,this.mapBox.matcadtsmall.getInverse(he),this.mapBox.matCADDrawCoordToMap=this.matCADDrawCoordToMap,this.mapBox.matMapToCADDrawCoord=new U.Matrix4,this.mapBox.matMapToCADDrawCoord.getInverse(this.matCADDrawCoordToMap),this.mapBox.matCadToMap=ie,this.mapBox.matMapToCad=new U.Matrix4,this.mapBox.matMapToCad.getInverse(ie)}},W);function W(a,h){var y=k.call(this,h)||this;return y.matCADDrawCoordToMap=new U.Matrix4,y.isPaning=!1,y.bakPan=!0,y.mapBox=a,y.mxObject2d=h,y.mapBox.matMapToCad=y.mapBox.matCadToMap=y.mapBox.matCADDrawCoordToMap=y.mapBox.matMapToCADDrawCoord=new U.Matrix4,y}s.MxDrawMapBoxThreeJS=E;var C,F=(v(M,C=B),M.prototype.onInitThreejs=function(){this.proxyObj.onInitThreejs()},M.prototype.onInitScene=function(){this.proxyObj.onInitScene()},M.prototype.getType=function(){return w.k3d},M.prototype.updateCameraDisplayRange=function(a,h,y){},M.prototype.addControlsChangeEvent=function(){var a=this.mxObject;this.mxObject.getOrbitControls().addEventListener("change",function(){N.MxJigCmdManager.OnThreeControlsChage(),a.callViewChange(),a.getMxDatabase().onViewChange(),a.getMcObject().isValid()&&a.getMcObject().getGripManager().onControlsChage(),a.updateDisplay()})},M.prototype.updateDisplay=function(a){a===void 0&&(a=!1),this.mxObject.updateDisplayImplement(a)},M.prototype.getRegistEventObject=function(){return this.mxObject.getCanvas()},M);function M(a){var h=C.call(this,a)||this;return h.proxyObj=a,h}s.MxDrawObject3dThreeJS=F},{"../Operate/MxJigCmdManager":53,"../UI/MxUiVue":64,three:19,"three-orbitcontrols":17}],75:[function(b,r,s){var o,v=this&&this.__extends||(o=function(E,W){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,F){C.__proto__=F}||function(C,F){for(var M in F)Object.prototype.hasOwnProperty.call(F,M)&&(C[M]=F[M])})(E,W)},function(E,W){if(typeof W!="function"&&W!==null)throw new TypeError("Class extends value "+String(W)+" is not a constructor or null");function C(){this.constructor=E}o(E,W),E.prototype=W===null?Object.create(W):(C.prototype=W.prototype,new C)});Object.defineProperty(s,"__esModule",{value:!0}),s.McDrawGripJig=s.McDrawGrip=s.McDrawSlect=s.McDrawGripData=void 0;var u=b("three"),w=b("../MxFun"),L=b("../Operate/MxJig"),U=b("../Operate/MxJigCmdManager"),N=b("../MxManager"),D=b("../MxDrawData"),f=b("../MxTools"),P=function(){this.threeObject=null};s.McDrawGripData=P;var T=(B.prototype.add=function(E){return!this.setId.has(E)&&(this.setId.add(E),this.mcObj.HighlightEntity(E,!0),!0)},B.prototype.remove=function(E){this.setId.has(E)&&(this.setId.delete(E),this.mcObj.HighlightEntity(E,!1))},B.prototype.removeAll=function(){var E=this;this.setId.forEach(function(W){E.mcObj.HighlightEntity(W,!1)}),this.setId.clear()},B.prototype.getAllSelect=function(){var E=[];return this.setId.forEach(function(W,C){E.push(C)}),E},B.prototype.getSelectCount=function(){return this.setId.size},B.prototype.isEmpty=function(){return this.setId.size==0},B);function B(E){this.mcObj=null,this.setId=new Set,this.mcObj=E}s.McDrawSlect=T;var G=(R.prototype.fireSelectChange=function(){this.isCallingSelectChange||(this.isCallingSelectChange=!0,this.mxObj.callEvent("selectChange",this.getAllSelect()),this.isCallingSelectChange=!1)},R.prototype.getParentGroup=function(){return this.drawGroup||(this.drawGroup=new u.Group,this.drawGroup.renderOrder=N.MxData.iGripRenderOrder,this.mxObj.getTheTempDrawContainer_SmallCoord().add(this.drawGroup)),this.drawGroup},R.prototype.reInit=function(){this.clearAll(),this.drawGroup&&w.MxFun.removeThreejsObject(this.drawGroup,this.mxObj.getTheTempDrawContainer_SmallCoord()),this.drawGroup=null,this.selectPoint1=null,this.selectPoint2=null},R.prototype.removeAllEntity=function(){var E=this.getParentGroup();this.mapGrips.forEach(function(W,C,F){for(var M=W.length,a=0;a<M;a++){var h=W[a];w.MxFun.removeThreejsObject(h.threeObject,E)}}),this.mapGrips=new Map},R.prototype.deleteGripData=function(E){var W=this.getParentGroup(),C=this.mapGrips.get(E);if(C)for(var F=C.length,M=0;M<F;M++){var a=C[M];w.MxFun.removeThreejsObject(a.threeObject,W)}this.mapGrips.delete(E)},R.prototype.addGripData=function(E,W,C,F){var M=this.mapGrips.get(E);M==null&&(M=new Array,this.mapGrips.set(E,M));var a=new P;return a.iIndex=W,a.point=new u.Vector3(C,F),M.push(a),a},R.prototype.createGripDisplayObject=function(E){var W=this.getParentGroup();E.geometry=new u.Geometry;var C=this.mxObj.toSmallcoord2(E.point.x,E.point.y,E.point.z),F=this.mxObj.screenCoordLong2World(.5*D.MxDrawData.m_dInputRectWidth);E.geometry.vertices.push(new u.Vector3(C.x-F,C.y-F,0)),E.geometry.vertices.push(new u.Vector3(C.x-F,C.y+F,0)),E.geometry.vertices.push(new u.Vector3(C.x+F,C.y+F,0)),E.geometry.vertices.push(new u.Vector3(C.x+F,C.y-F,0)),E.geometry.faces.push(new u.Face3(0,1,2)),E.geometry.faces.push(new u.Face3(2,3,0)),E.geometry.computeFaceNormals(),E.geometry.computeVertexNormals();var M=f.MxTools.getColor(D.MxDrawData.m_gripPointColor),a=f.MxTools.getOpacity(D.MxDrawData.m_gripPointColor),h=new u.MeshBasicMaterial({color:M,transparent:!0,depthTest:!1,side:u.DoubleSide,opacity:a}),y=new u.Mesh(E.geometry,h);W.add(y),E.threeObject=y},R.prototype.setPrvCommandSelect=function(E){this.aryPrvCommandSelect=E},R.prototype.getPrvCommandSelect=function(){return this.aryPrvCommandSelect},R.prototype.getAllSelect=function(){return this.mcSelect.getAllSelect()},R.prototype.getSelectPoints=function(){var E=this.selectPoint1!==null;return E&&this.mcSelect.getSelectCount()==0&&this.aryPrvCommandSelect.length==0&&(E=!1),{point1:this.selectPoint1,point2:this.selectPoint2,isvalid:E}},R.prototype.clearAll=function(){var E=this.mcSelect.isEmpty();return this.mcSelect.removeAll(),this.mapGrips.size==0?!E:(this.removeAllEntity(),!0)},R.prototype.onControlsChage=function(){var E=this;if(this.mapGrips.size!=0){var W=this.mxObj.screenCoordLong2World(.5*D.MxDrawData.m_dInputRectWidth),C=!1;this.mapGrips.forEach(function(F,M,a){for(var h=F.length,y=0;y<h;y++){var j=F[y];if(j.geometry.vertices.length==4){var Y=E.mxObj.cadCoord2Doc(j.point.x,j.point.y,j.point.z);j.geometry.vertices[0].x=Y.x-W,j.geometry.vertices[0].y=Y.y-W,j.geometry.vertices[1].x=Y.x-W,j.geometry.vertices[1].y=Y.y+W,j.geometry.vertices[2].x=Y.x+W,j.geometry.vertices[2].y=Y.y+W,j.geometry.vertices[3].x=Y.x+W,j.geometry.vertices[3].y=Y.y-W,j.geometry.computeFaceNormals(),j.geometry.computeVertexNormals(),j.geometry.verticesNeedUpdate=!0,C=!0}}}),C&&this.mxObj.resetRenderer()}},R.prototype.hitTest=function(E){var W={grips:new Array,ids:new Array,pt:E},C=new u.Vector3(E.x,E.y,0),F=this.mxObj.viewCoordLong2Cad(32);return this.mapGrips.forEach(function(M,a){for(var h=M.length,y=0;y<h;y++){var j=M[y];if(j.point.distanceTo(C)<=F){W.grips.push(j),W.ids.push(a),W.pt=j.point;break}}}),W},R.prototype.onMouseLBDown=function(E){if(!D.MxDrawData.m_isEnableGripEidt)return!1;var W=this.hitTest(E);return W.grips.length!=0&&(w.MxFun.sendStringToExecute("McDraw_GripEdit",W),!0)},R.prototype.gripEditImp=function(E){var W=E.grips,C=E.ids,F=E.pt,M=new ee(F,W,C,this.mcObj);U.MxJigCmdManager.runCmd(M)},R.prototype.addGridDisplay=function(E,W){var C=this;E&&E.length()!=0&&(this.deleteGripData(W),E.forEach(function(F,M){var a=C.addGripData(W,M,F.x,F.y);C.createGripDisplayObject(a)}))},R.prototype.upEntityGridDisplay=function(E){if(!D.MxDrawData.m_isEnableGripEidt||E==0)return!1;var W=this.mcObj.ObjectIdToObject(E);if(!W)return!1;var C=W.getGripPoints();return this.addGridDisplay(C,E),!0},R.prototype.doPointSelect=function(E){if(!this.mcObj.mcObjectImp)return!1;var W=this.mxObj.screenCoord2Doc(E.x,E.y,0),C=this.mxObj.docCoord2Cad(W.x,W.y,W.z),F=this.mcObj.mcObjectImp.IntelliSelect_PointSelect(C.x,C.y),M=F.length();if(M==0)return this.mcObj.mxappimp.DestroyMdGeLongArray(F),!1;this.mxObj.pointMultipleSelect()||(this.mxObj.getMxDatabase().clearMxCurrentSelect(),this.clearAll());for(var a=M+this.mcSelect.getSelectCount(),h=0;h<M;h++){var y=F.at(h);this.mcSelect.add(y),a<100&&this.upEntityGridDisplay(y)}return this.selectPoint1=C,this.selectPoint2=C,this.fireSelectChange(),this.mcObj.mxappimp.DestroyMdGeLongArray(F),!0},R.prototype.doRangeSelect=function(E,W){if(this.mcObj.mcObjectImp){var C,F=E.clone(),M=W.clone();C=W.x<E.x?0:1;for(var a=this.mcObj.mcObjectImp.IntelliSelect_RangeSelect(F.x,F.y,M.x,M.y,C),h=a.length(),y=h+this.mcSelect.getSelectCount(),j=0;j<h;j++){var Y=a.at(j);this.mcSelect.add(Y),y<100&&this.upEntityGridDisplay(Y)}0<h&&(this.selectPoint1=F,this.selectPoint2=M,this.fireSelectChange()),this.mcObj.mxappimp.DestroyMdGeLongArray(a)}},R.prototype.addSelect=function(E,W,C){if(C===void 0&&(C=!0),E==0)return!1;var F=this.mcSelect.add(E);return C&&this.upEntityGridDisplay(E),W&&this.fireSelectChange(),F},R);function R(E,W){this.mxObj=null,this.mcObj=null,this.mcSelect=null,this.mapGrips=new Map,this.aryPrvCommandSelect=[],this.drawGroup=null,this.isCallingSelectChange=!1,this.selectPoint1=null,this.selectPoint2=null,this.mxObj=E,this.mcObj=W,this.mcSelect=new T(W)}s.McDrawGrip=G;var _,ee=(v(k,_=L.McEdJigCommand),k.prototype.onExitCommand=function(E){this.tempEntity=null,this.tempEntityWordDraw=null,_.prototype.onExitCommand.call(this,E)},k.prototype.sampler=function(){var E=U.MxJigCmdManager.InType.kGetBegan|U.MxJigCmdManager.InType.kGetEnd,W=this.acquirePoint(E);if(W.status==U.MxJigCmdManager.DragStatus.kNormal&&(this.currPt=W.pt,this.tempEntity)){var C=new u.Vector3(W.pt.x,W.pt.y,W.pt.z),F=new u.Vector3(this.pt.x,this.pt.y,this.pt.z);this.tempEntityWordDraw=this.tempEntity.clone(),this.tempEntityWordDraw&&this.tempEntityWordDraw.moveGripPointsAt(this.grips[0].iIndex,C.x-F.x,C.y-F.y,C.z-F.z)}return W.status},k.prototype.getTypeName=function(){return"McDrawGripEdit"},k.prototype.done=function(E){if(E==U.MxJigCmdManager.DragStatus.kNormal)for(var W=new u.Vector3(this.pt.x,this.pt.y,this.pt.z),C=new u.Vector3(this.currPt.x,this.currPt.y,this.currPt.z),F=C.x-W.x,M=C.y-W.y,a=this.getMxObject().getMcObject().getGripManager(),h=this.grips.length,y=0;y<h;y++){var j=this.grips[y],Y=this.ids[y],q=this.mcObj.ObjectIdToObject(Y);q&&q.moveGripPointsAt(j.iIndex,F,M,0),a.upEntityGridDisplay(Y)}return U.MxJigCmdManager.DoneStatius.kExitCommand},k.prototype.upDisplay=function(){this.mcObj.onReadyJigUpdateDispla(),this.tempEntityWordDraw.tempRelationObject(),this.mcObj.onJigDrawEntityDisplay(this.tempEntityWordDraw.getImp()),this.tempEntityWordDraw.freeTempRelationObject()},k);function k(E,W,C,F){var M=_.call(this)||this;return M.pt=E,M.grips=W,M.ids=C,M.currPt=E,M.mcObj=F,M.ids.length&&(M.tempEntity=F.ObjectIdToObject(M.ids[0])),M}s.McDrawGripJig=ee},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxTools":37,"../Operate/MxJig":52,"../Operate/MxJigCmdManager":53,three:19}],76:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.McDrawObject=void 0;var o=b("../MxManager"),v=b("three"),u=b("../MxFun"),w=b("./McDrawGrip"),L=b("./McTextureManager"),U=window;U.McDrawObjectEvent_openFileComplete=function(f,P,T){var B=o.MxManager.getMxObject(P);B&&B.getMcObject().openFileComplete(f,T)},U.McDrawObjectEvent_call=function(f,P,T){if(P=="mxpost")try{var B=JSON.parse(T);if(B&&B.url&&B.data){var G=new XMLHttpRequest;G.open("POST",B.url,!0),G.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),G.onreadystatechange=function(){G.readyState===4&&G.status},G.send(B.data)}}catch{}else if(P=="regen_complete"){if(!(R=o.MxManager.getMxObject(f)))return;R.regenAllMxDbEntity()}else{var R;if(!(R=o.MxManager.getMxObject(f)))return;R.callEvent(P,T)}},U.McDrawObjectEvent_synchronizeuUdateDisplayRange=function(f,P){var T=o.MxManager.getMxObject(f);T&&T.getMcObject().updateDisplayRange(P==1)},U.McDrawObjectEvent_osnapComplete=function(f,P){var T=o.MxManager.getMxObject(f);T&&T.getMcObject().callOsnapComplete(P)},U.McDrawObjectEvent_mcutPrintf=function(f){u.MxFun.acutPrintf(f)},U.McDrawObjectEvent_updateDisplay=function(f){var P=o.MxManager.getMxObject(f);P&&P.updateDisplay()},U.McDrawObjectEvent_loadImages=function(f,P,T,B){var G=o.MxManager.getMxObject(f);if(G){G.getMcObject().getTextureManager().clear();var R=0,_=[];B.substring(0,5)=="blob:"&&(B=B.substring(5)),P.forEach(function(ee){var k=o.MxManager.getMxCpp().decodeFromGb2312(ee),E=k;k.lastIndexOf("/")==-1?(T&&0<T.length&&(E=T+"/"+E),B&&0<B.length&&(E=B+"/"+E)):k=k.substring(k.lastIndexOf("/")+1).toLowerCase(),_.push(E),G.getMcObject().getTextureManager().loadImage(E,k,function(){++R==P.length&&(_.forEach(function(W){G.getMcObject().getTextureManager().createOpenGLTexture(W)}),G.updateDisplay(!1))})})}},U.McDrawObjectEvent_loadImagesBase64=function(f,P){var T=o.MxManager.getMxObject(f);if(T){var B=P.indexOf("data:image/png;base64");if(B!=-1){var G=P.substring(0,B);P=P.substring(B),T.getMcObject().getTextureManager().loadImageBase64(G,P,function(){T.getMcObject().getTextureManager().createOpenGLTexture(G),T.updateDisplay(!1)})}}};var N=(D.prototype.getTextureManager=function(){return this.textureManager},D.prototype.isValid=function(){return this.mcObjectImp!==null},D.prototype.fireStartRunCommand=function(f,P){this.mcObjectImp&&this.mcObjectImp.fireStartRunCommand(f,P)},D.prototype.fireEndRunCommand=function(f,P){this.mcObjectImp&&this.mcObjectImp.fireEndRunCommand(f,P)},D.prototype.undo=function(){this.mcObjectImp&&this.mcObjectImp.undo()},D.prototype.redo=function(){this.mcObjectImp&&this.mcObjectImp.redo()},D.prototype.initCAD2Doc=function(f,P){this.matCad2doc=f,this.matDoc2cad=P},D.prototype.getSysVarLong=function(f){return this.mcObjectImp.GetSysVarLong(f)},D.prototype.getSysVarDouble=function(f){return this.mcObjectImp.GetSysVarDouble(f)},D.prototype.getSysVarPoint=function(f){var P=this.mcObjectImp.GetSysVarPoint(f);return new v.Vector3(P.x,P.y,P.z)},D.prototype.ObjectIdToMdObjectImp=function(f){return this.mcObjectImp?this.mxcpp.App.getImp().ObjectIdToMdObject(f):null},D.prototype.DestroyObject=function(f){if(!this.mcObjectImp)return null;this.mcObject.destroyObject(f)},D.prototype.onJigCommandEnd=function(){this.mcObjectImp&&this.mcObjectImp.EntityTempWordDraw_onJigCommandEnd()},D.prototype.callOsnapComplete=function(f){if(this.m_retCall&&f)try{var P=f;if(typeof f=="string"&&(P=JSON.parse(f)),P.callId!=this.m_lOsnapCallCount)return;this.m_retCall(P)}catch{}},D.prototype.doc2cad1=function(f){return f},D.prototype.doc2cad2=function(f,P){return new v.Vector3(f,P,0)},D.prototype.cad2doc1=function(f){return f},D.prototype.cad2doc2=function(f,P){return new v.Vector3(f,P,0)},D.prototype.onNotifyOsnap=function(f,P){if(this.mcObjectImp){this.m_lOsnapCallCount++,this.m_retCall=P,1e5<this.m_lOsnapCallCount&&(this.m_lOsnapCallCount=1);var T,B=this.doc2cad2(f.ptx,f.pty);f.isValidPrvInputPoint&&(T=this.doc2cad2(f.prvPtx,f.prvPty)),this.mcObjectImp.Osnap_NotifyOsnap(B.x,B.y,f.isValidPrvInputPoint,f.isValidPrvInputPoint?T.x:0,f.isValidPrvInputPoint?T.y:0,f.osmode,f.SearchRnge,this.m_lOsnapCallCount)}},D.prototype.DrawEntity=function(f,P,T){f&&this.mcObjectImp&&(P&&f.SetTrueColor(this.THREEColor2MdCmColor(P)),this.mcObjectImp.DrawEntity(f,T))},D.prototype.onJigDrawEntityDisplay=function(f,P,T){f&&this.mcObjectImp&&(P&&f.SetTrueColor(this.THREEColor2MdCmColor(P)),this.mcObjectImp.EntityTempWordDraw_onJigDrawEntityDisplay(f,T===!0))},D.prototype.THREEColor2MdCmColor=function(f){var P=new v.Color(f),T=new this.mxcppImp.MdCmColor;return T.setRGB(255*P.r,255*P.g,255*P.b),T},D.prototype.onJigDrawEntityDisplay_line=function(f,P,T,B,G,R,_){if(this.mcObjectImp){var ee=new this.mxcppImp.MdDbLine,k=new this.mxcppImp.MdGePoint3d;k.x=f,k.y=P,k.z=T,ee.setStartPoint(k);var E=new this.mxcppImp.MdGePoint3d;E.x=B,E.y=G,E.z=R,ee.setEndPoint(E),ee.SetTrueColor(this.THREEColor2MdCmColor(_)),this.mcObjectImp.EntityTempWordDraw_onJigDrawEntityDisplay(ee,!1)}},D.prototype.DrawLine=function(f,P,T,B,G,R,_){if(this.mcObjectImp){var ee=new this.mxcppImp.MdDbLine,k=new this.mxcppImp.MdGePoint3d;k.x=f,k.y=P,k.z=T,ee.setStartPoint(k);var E=new this.mxcppImp.MdGePoint3d;E.x=B,E.y=G,E.z=R,ee.setEndPoint(E),ee.SetTrueColor(this.THREEColor2MdCmColor(_)),this.mcObjectImp.DrawEntity(ee,!1)}},D.prototype.HighlightEntity=function(f,P){if(!this.mcDrawUtility)return!1;this.mcDrawUtility.highlightEntity(f,P)},D.prototype.onReadyJigUpdateDispla=function(){this.mcObjectImp&&this.mcObjectImp.EntityTempWordDraw_onReadyJigUpdateDispla()},D.prototype.onJigClearDisplay=function(){this.mcObjectImp&&this.mcObjectImp.EntityTempWordDraw_onJigClearDisplay()},D.prototype.ObjectIdToObject=function(f){return this.mcObject?this.mxcpp.App.objectIdToObject(f):null},D.prototype.init=function(f,P){P.initMxObject(f),this.mxObject=f,this.mcObject=P,this.mcObjectImp=P.getImp(),this.mxcpp=P.getMxCpp(),this.mxcppImp=this.mxcpp.mxcadassemblyimp,this.mxapp=this.mxcpp.App,this.mxappimp=this.mxapp.getImp(),this.grip=new w.McDrawGrip(f,this),this.mcDrawUtility=new this.mxcppImp.McDrawUtility,this.textureManager=new L.McTextureManager(this,f.getRenderer().getContext());var T=this;this.mxObject.addEvent("dragWillEnd",function(){T.mcObjectImp.fireEventDragWillEnd()})},D.prototype.setSize=function(f,P){if(!this.mcObjectImp)return!1;this.mcObjectImp.fireEventWindowSize(f,P)},D.prototype.getGripManager=function(){return this.grip},D.prototype.updateDisplayRange=function(f){if(f===void 0&&(f=!1),this.mcObjectImp){var P=this.mcObjectImp.getViewDataJsonParam(f);P=P.replace(/\\/g,"\\\\");try{var T=JSON.parse(P),B=this.mxObject;if(T!=null){B.intiDoc2Wold(new v.Matrix4),B.initCAD2Doc(JSON.parse(T.DToSMat)),B.initializingObjectMatrix(),B.updateCameraDisplayRange(new v.Vector3(T.pt1x,T.pt1y,0),new v.Vector3(T.pt2x,T.pt2y,0),T.viewangle),B.initAllLayoutName(JSON.parse(T.layout)),B.updateDisplay(!0);var G=u.MxFun.getUiObj();G!=null&&(G.SetLayoutData(T.layout),G.UpDisplayLayout())}}catch{console.log("getViewDataJsonParam exception")}}},D.prototype.openFileComplete=function(f,P){this.updateDisplayRange(),this.mxObject.callOpenFileComplete(f,P)},D.prototype.updateDisplayMapBox=function(f){return!!this.mcObjectImp&&(this.mxObject.getScene().background!==null&&console.log("mxerror: background must be empty"),this.mcObjectImp.updateDisplay(new v.Matrix4().elements,f.elements))},D.prototype.updateDisplay=function(){if(!this.mcObjectImp)return!1;var f=this.mxObject.getCamera();this.mxObject.getScene().background!==null&&console.log("mxerror: background must be empty");var P=new v.Matrix4;P.multiplyMatrices(f.matrixWorldInverse,this.mxObject.getDoc2World());var T=f.projectionMatrix;return this.mcObjectImp.updateDisplay(P.elements,T.elements)},D.prototype.updateDisplayMatrixData=function(f){if(this.mcObjectImp){var P=this.mxObject.getCamera(),T=new v.Matrix4;T.multiplyMatrices(P.matrixWorldInverse,this.mxObject.getDoc2World());var B=P.projectionMatrix;return this.mcObjectImp.updateDisplayMatrixData(T.elements,B.elements,!!f)}},D.prototype.createTexture=function(){return this.mcObjectImp.createTexture()},D.prototype.deleteTexture=function(f){return this.mcObjectImp.deleteTexture(f)},D.prototype.bindTexture=function(f,P){return this.mcObjectImp.bindTexture(f,P)},D.prototype.allocTextureHandle=function(f){return this.mcObjectImp.allocTextureHandle(f)},D.prototype.registTexture=function(f,P){return this.mcObjectImp.registTexture(f,P)},D);function D(){this.grip=null,this.mcObjectImp=null,this.mxcppImp=null,this.mxcpp=null,this.mcObject=null,this.mxapp=null,this.mxappimp=null,this.mcDrawUtility=null,this.m_lOsnapCallCount=1,this.m_retCall=null,this.matCad2doc=new v.Matrix4,this.matDoc2cad=new v.Matrix4}s.McDrawObject=N},{"../MxFun":27,"../MxManager":29,"./McDrawGrip":75,"./McTextureManager":77,three:19}],77:[function(b,r,s){Object.defineProperty(s,"__esModule",{value:!0}),s.McTextureManager=void 0;var o=b("three"),v=b("../MxManager"),u=(w.prototype.get=function(N){if(this.extensions[N]!==void 0)return this.extensions[N];var D;switch(N){case"WEBGL_depth_texture":D=this.gl.getExtension("WEBGL_depth_texture")||this.gl.getExtension("MOZ_WEBGL_depth_texture")||this.gl.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":D=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":D=this.gl.getExtension("WEBGL_compressed_texture_s3tc")||this.gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||this.gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":D=this.gl.getExtension("WEBGL_compressed_texture_pvrtc")||this.gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:D=this.gl.getExtension(N)}return D===null&&console.warn("THREE.WebGLRenderer: "+N+" extension not supported."),this.extensions[N]=D},w);function w(N){this.extensions={},this.gl=N}var L=(U.prototype.allocHandle=function(N){return this.mcObject.allocTextureHandle(v.MxManager.getMxCpp().encodeToGb2312(N))},U.prototype.convert=function(N){var D;if(N===o.UnsignedByteType)return 5121;if(N===o.UnsignedShort4444Type)return 32819;if(N===o.UnsignedShort5551Type)return 32820;if(N===o.UnsignedShort565Type)return 33635;if(N===o.ByteType)return 5120;if(N===o.ShortType)return 5122;if(N===o.UnsignedShortType)return 5123;if(N===o.IntType)return 5124;if(N===o.UnsignedIntType)return 5125;if(N===o.FloatType)return 5126;if(N===o.HalfFloatType)return this.isWebGL2?5131:(D=this.extensions.get("OES_texture_half_float"))!==null?D.HALF_FLOAT_OES:null;if(N===o.AlphaFormat)return 6406;if(N===o.RGBFormat)return 6407;if(N===o.RGBAFormat)return 6408;if(N===o.LuminanceFormat)return 6409;if(N===o.LuminanceAlphaFormat)return 6410;if(N===o.DepthFormat)return 6402;if(N===o.DepthStencilFormat)return 34041;if(N===o.RedFormat)return 6403;if(N===o.RedIntegerFormat)return 36244;if(N===o.RGFormat)return 33319;if(N===o.RGIntegerFormat)return 33320;if(N===o.RGBIntegerFormat)return 36248;if(N===o.RGBAIntegerFormat)return 36249;if(N===o.RGB_S3TC_DXT1_Format||N===o.RGBA_S3TC_DXT1_Format||N===o.RGBA_S3TC_DXT3_Format||N===o.RGBA_S3TC_DXT5_Format){if((D=this.extensions.get("WEBGL_compressed_texture_s3tc"))===null)return null;if(N===o.RGB_S3TC_DXT1_Format)return D.COMPRESSED_RGB_S3TC_DXT1_EXT;if(N===o.RGBA_S3TC_DXT1_Format)return D.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(N===o.RGBA_S3TC_DXT3_Format)return D.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(N===o.RGBA_S3TC_DXT5_Format)return D.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(N===o.RGB_PVRTC_4BPPV1_Format||N===o.RGB_PVRTC_2BPPV1_Format||N===o.RGBA_PVRTC_4BPPV1_Format||N===o.RGBA_PVRTC_2BPPV1_Format){if((D=this.extensions.get("WEBGL_compressed_texture_pvrtc"))===null)return null;if(N===o.RGB_PVRTC_4BPPV1_Format)return D.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(N===o.RGB_PVRTC_2BPPV1_Format)return D.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(N===o.RGBA_PVRTC_4BPPV1_Format)return D.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(N===o.RGBA_PVRTC_2BPPV1_Format)return D.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return N===o.RGB_ETC1_Format?(D=this.extensions.get("WEBGL_compressed_texture_etc1"))!==null?D.COMPRESSED_RGB_ETC1_WEBGL:null:N===o.RGBA_ASTC_4x4_Format||N===o.RGBA_ASTC_5x4_Format||N===o.RGBA_ASTC_5x5_Format||N===o.RGBA_ASTC_6x5_Format||N===o.RGBA_ASTC_6x6_Format||N===o.RGBA_ASTC_8x5_Format||N===o.RGBA_ASTC_8x6_Format||N===o.RGBA_ASTC_8x8_Format||N===o.RGBA_ASTC_10x5_Format||N===o.RGBA_ASTC_10x6_Format||N===o.RGBA_ASTC_10x8_Format||N===o.RGBA_ASTC_10x10_Format||N===o.RGBA_ASTC_12x10_Format||N===o.RGBA_ASTC_12x12_Format?(D=this.extensions.get("WEBGL_compressed_texture_astc"))!==null?N:null:N===o.UnsignedInt248Type?this.isWebGL2?34042:(D=this.extensions.get("WEBGL_depth_texture"))!==null?D.UNSIGNED_INT_24_8_WEBGL:null:void 0},U.prototype.textureNeedsPowerOfTwo=function(N){return N.wrapS!==1001||N.wrapT!==1001||N.minFilter!==1003&&N.minFilter!==1006},U.prototype.createCanvas=function(N,D){return document.createElementNS("http://www.w3.org/1999/xhtml","canvas")},U.prototype.floorPowerOfTwo=function(N){return Math.pow(2,Math.floor(Math.log(N)/Math.LN2))},U.prototype.resizeImage=function(N,D,f,P){var T=1;if((N.width>P||N.height>P)&&(T=P/Math.max(N.width,N.height)),T<1||D===!0){if(typeof HTMLImageElement<"u"&&N instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&N instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&N instanceof ImageBitmap){var B=D?this.floorPowerOfTwo:Math.floor,G=B(T*N.width),R=B(T*N.height);this._canvas===void 0&&(this._canvas=this.createCanvas(G,R));var _=f?this.createCanvas(G,R):this._canvas;return _.width=G,_.height=R,_.getContext("2d").drawImage(N,0,0,G,R),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+N.width+"x"+N.height+") to ("+G+"x"+R+")."),_}return"data"in N&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+N.width+"x"+N.height+")."),N}return N},U.prototype.mathIsPowerOfTwo=function(N){return(N&N-1)==0&&N!==0},U.prototype.isPowerOfTwo=function(N){return this.mathIsPowerOfTwo(N.width)&&this.mathIsPowerOfTwo(N.height)},U.prototype.getInternalFormat=function(N,D,f){if(this.isWebGL2===!1)return D;if(N!==null){if(this._gl[N]!==void 0)return this._gl[N];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+N+"'")}var P=D;return D===6403&&(f===5126&&(P=33326),f===5131&&(P=33325),f===5121&&(P=33321)),D===6407&&(f===5126&&(P=34837),f===5131&&(P=34843),f===5121&&(P=32849)),D===6408&&(f===5126&&(P=34836),f===5131&&(P=34842),f===5121&&(P=32856)),P===33325||P===33326||P===34842||P===34836?this.extensions.get("EXT_color_buffer_float"):P!==34843&&P!==34837||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),P},U.prototype.filterFallback=function(N){return N===o.NearestFilter||N===o.NearestMipmapNearestFilter||N===o.NearestMipmapLinearFilter?9728:9729},U.prototype.setTextureParameters=function(N,D,f){var P={};P[o.RepeatWrapping]=10497,P[o.ClampToEdgeWrapping]=33071,P[o.MirroredRepeatWrapping]=33648;var T={};T[o.NearestFilter]=9728,T[o.NearestMipmapNearestFilter]=9984,T[o.NearestMipmapLinearFilter]=9986,T[o.LinearFilter]=9729,T[o.LinearMipmapNearestFilter]=9985,T[o.LinearMipmapLinearFilter]=9987,f?(this._gl.texParameteri(N,10242,P[D.wrapS]),this._gl.texParameteri(N,10243,P[D.wrapT]),N!==32879&&N!==35866||this._gl.texParameteri(N,32882,P[D.wrapR]),this._gl.texParameteri(N,10240,T[D.magFilter]),this._gl.texParameteri(N,10241,T[D.minFilter])):(this._gl.texParameteri(N,10242,33071),this._gl.texParameteri(N,10243,33071),N!==32879&&N!==35866||this._gl.texParameteri(N,32882,33071),D.wrapS===o.ClampToEdgeWrapping&&D.wrapT===o.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),this._gl.texParameteri(N,10240,this.filterFallback(D.magFilter)),this._gl.texParameteri(N,10241,this.filterFallback(D.minFilter)),D.minFilter!==o.NearestFilter&&D.minFilter!==o.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."))},U.prototype.textureNeedsGenerateMipmaps=function(N,D){return N.generateMipmaps&&D&&N.minFilter!==o.NearestFilter&&N.minFilter!==o.LinearFilter},U.prototype.generateMipmap=function(N,D,f,P,T){this._gl.generateMipmap(D)},U.prototype.clear=function(){var N=this;Object.keys(this.mapImagePathToTexture).forEach(function(D){var f=N.mapImagePathToTexture[D];f&&f.webglTexture&&N.mcObject.deleteTexture(f.webglTexture)}),this.mapImagePathToTexture={}},U.prototype.loadImage=function(N,D,f){if(this.mapImagePathToTexture[N]){var P=this.mapImagePathToTexture[N];return P&&P.isload&&P.texture?f(!0,P.texture.image):f(!1,void 0),0}var T={isload:!1,texture:null,handle:this.allocHandle(D),webglTexture:void 0};return this.mapImagePathToTexture[N]=T,new o.TextureLoader().load(N,function(B){T.isload=!0,T.texture=B,f(!0,B.image)},void 0,function(B){T.isload=!1,f(!1,void 0)}),T.handle},U.prototype.loadImageBase64=function(N,D,f){if(this.mapImagePathToTexture[N]){var P=this.mapImagePathToTexture[N];return P&&P.isload&&P.texture?f(!0,P.texture.image):f(!1,void 0),0}var T={isload:!1,texture:null,handle:this.allocHandle(N),webglTexture:void 0};return this.mapImagePathToTexture[N]=T,new o.TextureLoader().load(D,function(B){T.isload=!0,T.texture=B,f(!0,B.image)},void 0,function(B){T.isload=!1,f(!1,void 0)}),T.handle},U.prototype.createOpenGLTexture=function(N){var D=this.mapImagePathToTexture[N];if(!D||!D.isload||D.webglTexture)return!1;var f=D.texture;D.webglTexture=this.mcObject.createTexture(),this._gl.activeTexture(33984),this.mcObject.bindTexture(3553,D.webglTexture),this._gl.pixelStorei(37440,f.flipY),this._gl.pixelStorei(37441,f.premultiplyAlpha),this._gl.pixelStorei(3317,f.unpackAlignment);var P=this._gl.getParameter(3379),T=this.textureNeedsPowerOfTwo(f)&&this.isPowerOfTwo(f.image)===!1,B=this.resizeImage(f.image,T,!1,P),G=this.isPowerOfTwo(B)||this.isWebGL2,R=this.convert(f.format),_=this.convert(f.type),ee=this.getInternalFormat(f.internalFormat,R,_);this.setTextureParameters(3553,f,G);var k,E=f.mipmaps;if(0<E.length&&G){for(var W=0,C=E.length;W<C;W++)k=E[W],this._gl.texImage2D(3553,W,ee,R,_,k);f.generateMipmaps=!1}else this._gl.texImage2D(3553,0,ee,R,_,B);this.textureNeedsGenerateMipmaps(f,G)&&this.generateMipmap(D,3553,f,B.width,B.height),this.mcObject.registTexture(D.handle,D.webglTexture)},U);function U(N,D){this.mapImagePathToTexture={},this.mcObject=N,this._gl=D,this.extensions=new u(D),this.isWebGL2=typeof WebGL2RenderingContext<"u"&&D instanceof WebGL2RenderingContext}s.McTextureManager=L},{"../MxManager":29,three:19}]},{},[57])}function registerMxDbEntity(){store.events.emit("MxDbEntityRegister")}let registerList=[];function addRegisterMxDbEntity(b){b.isRegister=!1;const r=()=>{!b.isRegister&&b.register&&b.register(),store.events.off("stateChange",r)};registerList.push(r)}const callRegisterMxDbEntityLists=()=>{registerList.forEach(b=>{b&&b()}),registerList=[]};store.events.on("MxDbEntityRegister",callRegisterMxDbEntityLists);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function unwrapExports(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}function createCommonjsModule(b,r){return b(r={exports:{}},r.exports),r.exports}var jquery=createCommonjsModule(function(b){var r,s;r=typeof window<"u"?window:commonjsGlobal,s=function(o,v){var u=[],w=Object.getPrototypeOf,L=u.slice,U=u.flat?function(g){return u.flat.call(g)}:function(g){return u.concat.apply([],g)},N=u.push,D=u.indexOf,f={},P=f.toString,T=f.hasOwnProperty,B=T.toString,G=B.call(Object),R={},_=function(g){return typeof g=="function"&&typeof g.nodeType!="number"&&typeof g.item!="function"},ee=function(g){return g!=null&&g===g.window},k=o.document,E={type:!0,src:!0,nonce:!0,noModule:!0};function W(g,S,Z){var te,de,fe=(Z=Z||k).createElement("script");if(fe.text=g,S)for(te in E)(de=S[te]||S.getAttribute&&S.getAttribute(te))&&fe.setAttribute(te,de);Z.head.appendChild(fe).parentNode.removeChild(fe)}function C(g){return g==null?g+"":typeof g=="object"||typeof g=="function"?f[P.call(g)]||"object":typeof g}var F="3.7.0",M=/HTML$/i,a=function(g,S){return new a.fn.init(g,S)};function h(g){var S=!!g&&"length"in g&&g.length,Z=C(g);return!_(g)&&!ee(g)&&(Z==="array"||S===0||typeof S=="number"&&S>0&&S-1 in g)}function y(g,S){return g.nodeName&&g.nodeName.toLowerCase()===S.toLowerCase()}a.fn=a.prototype={jquery:F,constructor:a,length:0,toArray:function(){return L.call(this)},get:function(g){return g==null?L.call(this):g<0?this[g+this.length]:this[g]},pushStack:function(g){var S=a.merge(this.constructor(),g);return S.prevObject=this,S},each:function(g){return a.each(this,g)},map:function(g){return this.pushStack(a.map(this,function(S,Z){return g.call(S,Z,S)}))},slice:function(){return this.pushStack(L.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(a.grep(this,function(g,S){return(S+1)%2}))},odd:function(){return this.pushStack(a.grep(this,function(g,S){return S%2}))},eq:function(g){var S=this.length,Z=+g+(g<0?S:0);return this.pushStack(Z>=0&&Z<S?[this[Z]]:[])},end:function(){return this.prevObject||this.constructor()},push:N,sort:u.sort,splice:u.splice},a.extend=a.fn.extend=function(){var g,S,Z,te,de,fe,_e=arguments[0]||{},Me=1,Se=arguments.length,Ne=!1;for(typeof _e=="boolean"&&(Ne=_e,_e=arguments[Me]||{},Me++),typeof _e=="object"||_(_e)||(_e={}),Me===Se&&(_e=this,Me--);Me<Se;Me++)if((g=arguments[Me])!=null)for(S in g)te=g[S],S!=="__proto__"&&_e!==te&&(Ne&&te&&(a.isPlainObject(te)||(de=Array.isArray(te)))?(Z=_e[S],fe=de&&!Array.isArray(Z)?[]:de||a.isPlainObject(Z)?Z:{},de=!1,_e[S]=a.extend(Ne,fe,te)):te!==void 0&&(_e[S]=te));return _e},a.extend({expando:"jQuery"+(F+Math.random()).replace(/\D/g,""),isReady:!0,error:function(g){throw new Error(g)},noop:function(){},isPlainObject:function(g){var S,Z;return!(!g||P.call(g)!=="[object Object]"||(S=w(g))&&(typeof(Z=T.call(S,"constructor")&&S.constructor)!="function"||B.call(Z)!==G))},isEmptyObject:function(g){var S;for(S in g)return!1;return!0},globalEval:function(g,S,Z){W(g,{nonce:S&&S.nonce},Z)},each:function(g,S){var Z,te=0;if(h(g))for(Z=g.length;te<Z&&S.call(g[te],te,g[te])!==!1;te++);else for(te in g)if(S.call(g[te],te,g[te])===!1)break;return g},text:function(g){var S,Z="",te=0,de=g.nodeType;if(de){if(de===1||de===9||de===11)return g.textContent;if(de===3||de===4)return g.nodeValue}else for(;S=g[te++];)Z+=a.text(S);return Z},makeArray:function(g,S){var Z=S||[];return g!=null&&(h(Object(g))?a.merge(Z,typeof g=="string"?[g]:g):N.call(Z,g)),Z},inArray:function(g,S,Z){return S==null?-1:D.call(S,g,Z)},isXMLDoc:function(g){var S=g&&g.namespaceURI,Z=g&&(g.ownerDocument||g).documentElement;return!M.test(S||Z&&Z.nodeName||"HTML")},merge:function(g,S){for(var Z=+S.length,te=0,de=g.length;te<Z;te++)g[de++]=S[te];return g.length=de,g},grep:function(g,S,Z){for(var te=[],de=0,fe=g.length,_e=!Z;de<fe;de++)!S(g[de],de)!==_e&&te.push(g[de]);return te},map:function(g,S,Z){var te,de,fe=0,_e=[];if(h(g))for(te=g.length;fe<te;fe++)(de=S(g[fe],fe,Z))!=null&&_e.push(de);else for(fe in g)(de=S(g[fe],fe,Z))!=null&&_e.push(de);return U(_e)},guid:1,support:R}),typeof Symbol=="function"&&(a.fn[Symbol.iterator]=u[Symbol.iterator]),a.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(g,S){f["[object "+S+"]"]=S.toLowerCase()});var j=u.pop,Y=u.sort,q=u.splice,V="[\\x20\\t\\r\\n\\f]",ne=new RegExp("^"+V+"+|((?:^|[^\\\\])(?:\\\\.)*)"+V+"+$","g");a.contains=function(g,S){var Z=S&&S.parentNode;return g===Z||!(!Z||Z.nodeType!==1||!(g.contains?g.contains(Z):g.compareDocumentPosition&&16&g.compareDocumentPosition(Z)))};var ie=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function he(g,S){return S?g==="\0"?"":g.slice(0,-1)+"\\"+g.charCodeAt(g.length-1).toString(16)+" ":"\\"+g}a.escapeSelector=function(g){return(g+"").replace(ie,he)};var be=k,je=N;(function(){var g,S,Z,te,de,fe,_e,Me,Se,Ne,nt=je,ft=a.expando,ut=0,Lt=0,kn=li(),Pt=li(),Hn=li(),Zr=li(),Fr=function(Ie,at){return Ie===at&&(de=!0),0},lo="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",_o="(?:\\\\[\\da-fA-F]{1,6}"+V+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",dr="\\["+V+"*("+_o+")(?:"+V+"*([*^$|!~]?=)"+V+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+_o+"))|)"+V+"*\\]",To=":("+_o+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+dr+")*)|.*)\\)|)",xr=new RegExp(V+"+","g"),Wn=new RegExp("^"+V+"*,"+V+"*"),la=new RegExp("^"+V+"*([>+~]|"+V+")"+V+"*"),za=new RegExp(V+"|>"),co=new RegExp(To),Ua=new RegExp("^"+_o+"$"),Co={ID:new RegExp("^#("+_o+")"),CLASS:new RegExp("^\\.("+_o+")"),TAG:new RegExp("^("+_o+"|[*])"),ATTR:new RegExp("^"+dr),PSEUDO:new RegExp("^"+To),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+V+"*(even|odd|(([+-]|)(\\d*)n|)"+V+"*(?:([+-]|)"+V+"*(\\d+)|))"+V+"*\\)|)","i"),bool:new RegExp("^(?:"+lo+")$","i"),needsContext:new RegExp("^"+V+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+V+"*((?:-\\d)?\\d*)"+V+"*\\)|)(?=[^-]|$)","i")},Xi=/^(?:input|select|textarea|button)$/i,ca=/^h\d$/i,Fi=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Kr=/[+~]/,$r=new RegExp("\\\\[\\da-fA-F]{1,6}"+V+"?|\\\\([^\\r\\n\\f])","g"),Oi=function(Ie,at){var $e="0x"+Ie.slice(1)-65536;return at||($e<0?String.fromCharCode($e+65536):String.fromCharCode($e>>10|55296,1023&$e|56320))},Ho=function(){Vi()},wi=Ea(function(Ie){return Ie.disabled===!0&&y(Ie,"fieldset")},{dir:"parentNode",next:"legend"});try{nt.apply(u=L.call(be.childNodes),be.childNodes),u[be.childNodes.length].nodeType}catch{nt={apply:function(at,$e){je.apply(at,L.call($e))},call:function(at){je.apply(at,L.call(arguments,1))}}}function Jn(Ie,at,$e,Tt){var kt,gn,yn,Ln,It,Mr,Sn,en=at&&at.ownerDocument,Rr=at?at.nodeType:9;if($e=$e||[],typeof Ie!="string"||!Ie||Rr!==1&&Rr!==9&&Rr!==11)return $e;if(!Tt&&(Vi(at),at=at||fe,Me)){if(Rr!==11&&(It=Fi.exec(Ie)))if(kt=It[1]){if(Rr===9){if(!(yn=at.getElementById(kt)))return $e;if(yn.id===kt)return nt.call($e,yn),$e}else if(en&&(yn=en.getElementById(kt))&&Jn.contains(at,yn)&&yn.id===kt)return nt.call($e,yn),$e}else{if(It[2])return nt.apply($e,at.getElementsByTagName(Ie)),$e;if((kt=It[3])&&at.getElementsByClassName)return nt.apply($e,at.getElementsByClassName(kt)),$e}if(!(Zr[Ie+" "]||Se&&Se.test(Ie))){if(Sn=Ie,en=at,Rr===1&&(za.test(Ie)||la.test(Ie))){for((en=Kr.test(Ie)&&uo(at.parentNode)||at)==at&&R.scope||((Ln=at.getAttribute("id"))?Ln=a.escapeSelector(Ln):at.setAttribute("id",Ln=ft)),gn=(Mr=Wo(Ie)).length;gn--;)Mr[gn]=(Ln?"#"+Ln:":scope")+" "+xa(Mr[gn]);Sn=Mr.join(",")}try{return nt.apply($e,en.querySelectorAll(Sn)),$e}catch{Zr(Ie,!0)}finally{Ln===ft&&at.removeAttribute("id")}}}return Sl(Ie.replace(ne,"$1"),at,$e,Tt)}function li(){var Ie=[];return function at($e,Tt){return Ie.push($e+" ")>S.cacheLength&&delete at[Ie.shift()],at[$e+" "]=Tt}}function ni(Ie){return Ie[ft]=!0,Ie}function Ar(Ie){var at=fe.createElement("fieldset");try{return!!Ie(at)}catch{return!1}finally{at.parentNode&&at.parentNode.removeChild(at),at=null}}function So(Ie){return function(at){return y(at,"input")&&at.type===Ie}}function Ms(Ie){return function(at){return(y(at,"input")||y(at,"button"))&&at.type===Ie}}function Tl(Ie){return function(at){return"form"in at?at.parentNode&&at.disabled===!1?"label"in at?"label"in at.parentNode?at.parentNode.disabled===Ie:at.disabled===Ie:at.isDisabled===Ie||at.isDisabled!==!Ie&&wi(at)===Ie:at.disabled===Ie:"label"in at&&at.disabled===Ie}}function no(Ie){return ni(function(at){return at=+at,ni(function($e,Tt){for(var kt,gn=Ie([],$e.length,at),yn=gn.length;yn--;)$e[kt=gn[yn]]&&($e[kt]=!(Tt[kt]=$e[kt]))})})}function uo(Ie){return Ie&&Ie.getElementsByTagName!==void 0&&Ie}function Vi(Ie){var at,$e=Ie?Ie.ownerDocument||Ie:be;return $e!=fe&&$e.nodeType===9&&$e.documentElement&&(_e=(fe=$e).documentElement,Me=!a.isXMLDoc(fe),Ne=_e.matches||_e.webkitMatchesSelector||_e.msMatchesSelector,be!=fe&&(at=fe.defaultView)&&at.top!==at&&at.addEventListener("unload",Ho),R.getById=Ar(function(Tt){return _e.appendChild(Tt).id=a.expando,!fe.getElementsByName||!fe.getElementsByName(a.expando).length}),R.disconnectedMatch=Ar(function(Tt){return Ne.call(Tt,"*")}),R.scope=Ar(function(){return fe.querySelectorAll(":scope")}),R.cssHas=Ar(function(){try{return fe.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),R.getById?(S.filter.ID=function(Tt){var kt=Tt.replace($r,Oi);return function(gn){return gn.getAttribute("id")===kt}},S.find.ID=function(Tt,kt){if(kt.getElementById!==void 0&&Me){var gn=kt.getElementById(Tt);return gn?[gn]:[]}}):(S.filter.ID=function(Tt){var kt=Tt.replace($r,Oi);return function(gn){var yn=gn.getAttributeNode!==void 0&&gn.getAttributeNode("id");return yn&&yn.value===kt}},S.find.ID=function(Tt,kt){if(kt.getElementById!==void 0&&Me){var gn,yn,Ln,It=kt.getElementById(Tt);if(It){if((gn=It.getAttributeNode("id"))&&gn.value===Tt)return[It];for(Ln=kt.getElementsByName(Tt),yn=0;It=Ln[yn++];)if((gn=It.getAttributeNode("id"))&&gn.value===Tt)return[It]}return[]}}),S.find.TAG=function(Tt,kt){return kt.getElementsByTagName!==void 0?kt.getElementsByTagName(Tt):kt.querySelectorAll(Tt)},S.find.CLASS=function(Tt,kt){if(kt.getElementsByClassName!==void 0&&Me)return kt.getElementsByClassName(Tt)},Se=[],Ar(function(Tt){var kt;_e.appendChild(Tt).innerHTML="<a id='"+ft+"' href='' disabled='disabled'></a><select id='"+ft+"-\r\\' disabled='disabled'><option selected=''></option></select>",Tt.querySelectorAll("[selected]").length||Se.push("\\["+V+"*(?:value|"+lo+")"),Tt.querySelectorAll("[id~="+ft+"-]").length||Se.push("~="),Tt.querySelectorAll("a#"+ft+"+*").length||Se.push(".#.+[+~]"),Tt.querySelectorAll(":checked").length||Se.push(":checked"),(kt=fe.createElement("input")).setAttribute("type","hidden"),Tt.appendChild(kt).setAttribute("name","D"),_e.appendChild(Tt).disabled=!0,Tt.querySelectorAll(":disabled").length!==2&&Se.push(":enabled",":disabled"),(kt=fe.createElement("input")).setAttribute("name",""),Tt.appendChild(kt),Tt.querySelectorAll("[name='']").length||Se.push("\\["+V+"*name"+V+"*="+V+`*(?:''|"")`)}),R.cssHas||Se.push(":has"),Se=Se.length&&new RegExp(Se.join("|")),Fr=function(Tt,kt){if(Tt===kt)return de=!0,0;var gn=!Tt.compareDocumentPosition-!kt.compareDocumentPosition;return gn||(1&(gn=(Tt.ownerDocument||Tt)==(kt.ownerDocument||kt)?Tt.compareDocumentPosition(kt):1)||!R.sortDetached&&kt.compareDocumentPosition(Tt)===gn?Tt===fe||Tt.ownerDocument==be&&Jn.contains(be,Tt)?-1:kt===fe||kt.ownerDocument==be&&Jn.contains(be,kt)?1:te?D.call(te,Tt)-D.call(te,kt):0:4&gn?-1:1)}),fe}for(g in Jn.matches=function(Ie,at){return Jn(Ie,null,null,at)},Jn.matchesSelector=function(Ie,at){if(Vi(Ie),Me&&!Zr[at+" "]&&(!Se||!Se.test(at)))try{var $e=Ne.call(Ie,at);if($e||R.disconnectedMatch||Ie.document&&Ie.document.nodeType!==11)return $e}catch{Zr(at,!0)}return Jn(at,fe,null,[Ie]).length>0},Jn.contains=function(Ie,at){return(Ie.ownerDocument||Ie)!=fe&&Vi(Ie),a.contains(Ie,at)},Jn.attr=function(Ie,at){(Ie.ownerDocument||Ie)!=fe&&Vi(Ie);var $e=S.attrHandle[at.toLowerCase()],Tt=$e&&T.call(S.attrHandle,at.toLowerCase())?$e(Ie,at,!Me):void 0;return Tt!==void 0?Tt:Ie.getAttribute(at)},Jn.error=function(Ie){throw new Error("Syntax error, unrecognized expression: "+Ie)},a.uniqueSort=function(Ie){var at,$e=[],Tt=0,kt=0;if(de=!R.sortStable,te=!R.sortStable&&L.call(Ie,0),Y.call(Ie,Fr),de){for(;at=Ie[kt++];)at===Ie[kt]&&(Tt=$e.push(kt));for(;Tt--;)q.call(Ie,$e[Tt],1)}return te=null,Ie},a.fn.uniqueSort=function(){return this.pushStack(a.uniqueSort(L.apply(this)))},(S=a.expr={cacheLength:50,createPseudo:ni,match:Co,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(Ie){return Ie[1]=Ie[1].replace($r,Oi),Ie[3]=(Ie[3]||Ie[4]||Ie[5]||"").replace($r,Oi),Ie[2]==="~="&&(Ie[3]=" "+Ie[3]+" "),Ie.slice(0,4)},CHILD:function(Ie){return Ie[1]=Ie[1].toLowerCase(),Ie[1].slice(0,3)==="nth"?(Ie[3]||Jn.error(Ie[0]),Ie[4]=+(Ie[4]?Ie[5]+(Ie[6]||1):2*(Ie[3]==="even"||Ie[3]==="odd")),Ie[5]=+(Ie[7]+Ie[8]||Ie[3]==="odd")):Ie[3]&&Jn.error(Ie[0]),Ie},PSEUDO:function(Ie){var at,$e=!Ie[6]&&Ie[2];return Co.CHILD.test(Ie[0])?null:(Ie[3]?Ie[2]=Ie[4]||Ie[5]||"":$e&&co.test($e)&&(at=Wo($e,!0))&&(at=$e.indexOf(")",$e.length-at)-$e.length)&&(Ie[0]=Ie[0].slice(0,at),Ie[2]=$e.slice(0,at)),Ie.slice(0,3))}},filter:{TAG:function(Ie){var at=Ie.replace($r,Oi).toLowerCase();return Ie==="*"?function(){return!0}:function($e){return y($e,at)}},CLASS:function(Ie){var at=kn[Ie+" "];return at||(at=new RegExp("(^|"+V+")"+Ie+"("+V+"|$)"))&&kn(Ie,function($e){return at.test(typeof $e.className=="string"&&$e.className||$e.getAttribute!==void 0&&$e.getAttribute("class")||"")})},ATTR:function(Ie,at,$e){return function(Tt){var kt=Jn.attr(Tt,Ie);return kt==null?at==="!=":!at||(kt+="",at==="="?kt===$e:at==="!="?kt!==$e:at==="^="?$e&&kt.indexOf($e)===0:at==="*="?$e&&kt.indexOf($e)>-1:at==="$="?$e&&kt.slice(-$e.length)===$e:at==="~="?(" "+kt.replace(xr," ")+" ").indexOf($e)>-1:at==="|="&&(kt===$e||kt.slice(0,$e.length+1)===$e+"-"))}},CHILD:function(Ie,at,$e,Tt,kt){var gn=Ie.slice(0,3)!=="nth",yn=Ie.slice(-4)!=="last",Ln=at==="of-type";return Tt===1&&kt===0?function(It){return!!It.parentNode}:function(It,Mr,Sn){var en,Rr,tr,ci,bi,pi=gn!==yn?"nextSibling":"previousSibling",we=It.parentNode,Mi=Ln&&It.nodeName.toLowerCase(),on=!Sn&&!Ln,Tr=!1;if(we){if(gn){for(;pi;){for(tr=It;tr=tr[pi];)if(Ln?y(tr,Mi):tr.nodeType===1)return!1;bi=pi=Ie==="only"&&!bi&&"nextSibling"}return!0}if(bi=[yn?we.firstChild:we.lastChild],yn&&on){for(Tr=(ci=(en=(Rr=we[ft]||(we[ft]={}))[Ie]||[])[0]===ut&&en[1])&&en[2],tr=ci&&we.childNodes[ci];tr=++ci&&tr&&tr[pi]||(Tr=ci=0)||bi.pop();)if(tr.nodeType===1&&++Tr&&tr===It){Rr[Ie]=[ut,ci,Tr];break}}else if(on&&(Tr=ci=(en=(Rr=It[ft]||(It[ft]={}))[Ie]||[])[0]===ut&&en[1]),Tr===!1)for(;(tr=++ci&&tr&&tr[pi]||(Tr=ci=0)||bi.pop())&&(!(Ln?y(tr,Mi):tr.nodeType===1)||!++Tr||(on&&((Rr=tr[ft]||(tr[ft]={}))[Ie]=[ut,Tr]),tr!==It)););return(Tr-=kt)===Tt||Tr%Tt==0&&Tr/Tt>=0}}},PSEUDO:function(Ie,at){var $e,Tt=S.pseudos[Ie]||S.setFilters[Ie.toLowerCase()]||Jn.error("unsupported pseudo: "+Ie);return Tt[ft]?Tt(at):Tt.length>1?($e=[Ie,Ie,"",at],S.setFilters.hasOwnProperty(Ie.toLowerCase())?ni(function(kt,gn){for(var yn,Ln=Tt(kt,at),It=Ln.length;It--;)kt[yn=D.call(kt,Ln[It])]=!(gn[yn]=Ln[It])}):function(kt){return Tt(kt,0,$e)}):Tt}},pseudos:{not:ni(function(Ie){var at=[],$e=[],Tt=Ri(Ie.replace(ne,"$1"));return Tt[ft]?ni(function(kt,gn,yn,Ln){for(var It,Mr=Tt(kt,null,Ln,[]),Sn=kt.length;Sn--;)(It=Mr[Sn])&&(kt[Sn]=!(gn[Sn]=It))}):function(kt,gn,yn){return at[0]=kt,Tt(at,null,yn,$e),at[0]=null,!$e.pop()}}),has:ni(function(Ie){return function(at){return Jn(Ie,at).length>0}}),contains:ni(function(Ie){return Ie=Ie.replace($r,Oi),function(at){return(at.textContent||a.text(at)).indexOf(Ie)>-1}}),lang:ni(function(Ie){return Ua.test(Ie||"")||Jn.error("unsupported lang: "+Ie),Ie=Ie.replace($r,Oi).toLowerCase(),function(at){var $e;do if($e=Me?at.lang:at.getAttribute("xml:lang")||at.getAttribute("lang"))return($e=$e.toLowerCase())===Ie||$e.indexOf(Ie+"-")===0;while((at=at.parentNode)&&at.nodeType===1);return!1}}),target:function(Ie){var at=o.location&&o.location.hash;return at&&at.slice(1)===Ie.id},root:function(Ie){return Ie===_e},focus:function(Ie){return Ie===function(){try{return fe.activeElement}catch{}}()&&fe.hasFocus()&&!!(Ie.type||Ie.href||~Ie.tabIndex)},enabled:Tl(!1),disabled:Tl(!0),checked:function(Ie){return y(Ie,"input")&&!!Ie.checked||y(Ie,"option")&&!!Ie.selected},selected:function(Ie){return Ie.parentNode&&Ie.parentNode.selectedIndex,Ie.selected===!0},empty:function(Ie){for(Ie=Ie.firstChild;Ie;Ie=Ie.nextSibling)if(Ie.nodeType<6)return!1;return!0},parent:function(Ie){return!S.pseudos.empty(Ie)},header:function(Ie){return ca.test(Ie.nodeName)},input:function(Ie){return Xi.test(Ie.nodeName)},button:function(Ie){return y(Ie,"input")&&Ie.type==="button"||y(Ie,"button")},text:function(Ie){var at;return y(Ie,"input")&&Ie.type==="text"&&((at=Ie.getAttribute("type"))==null||at.toLowerCase()==="text")},first:no(function(){return[0]}),last:no(function(Ie,at){return[at-1]}),eq:no(function(Ie,at,$e){return[$e<0?$e+at:$e]}),even:no(function(Ie,at){for(var $e=0;$e<at;$e+=2)Ie.push($e);return Ie}),odd:no(function(Ie,at){for(var $e=1;$e<at;$e+=2)Ie.push($e);return Ie}),lt:no(function(Ie,at,$e){var Tt;for(Tt=$e<0?$e+at:$e>at?at:$e;--Tt>=0;)Ie.push(Tt);return Ie}),gt:no(function(Ie,at,$e){for(var Tt=$e<0?$e+at:$e;++Tt<at;)Ie.push(Tt);return Ie})}}).pseudos.nth=S.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})S.pseudos[g]=So(g);for(g in{submit:!0,reset:!0})S.pseudos[g]=Ms(g);function _s(){}function Wo(Ie,at){var $e,Tt,kt,gn,yn,Ln,It,Mr=Pt[Ie+" "];if(Mr)return at?0:Mr.slice(0);for(yn=Ie,Ln=[],It=S.preFilter;yn;){for(gn in $e&&!(Tt=Wn.exec(yn))||(Tt&&(yn=yn.slice(Tt[0].length)||yn),Ln.push(kt=[])),$e=!1,(Tt=la.exec(yn))&&($e=Tt.shift(),kt.push({value:$e,type:Tt[0].replace(ne," ")}),yn=yn.slice($e.length)),S.filter)!(Tt=Co[gn].exec(yn))||It[gn]&&!(Tt=It[gn](Tt))||($e=Tt.shift(),kt.push({value:$e,type:gn,matches:Tt}),yn=yn.slice($e.length));if(!$e)break}return at?yn.length:yn?Jn.error(Ie):Pt(Ie,Ln).slice(0)}function xa(Ie){for(var at=0,$e=Ie.length,Tt="";at<$e;at++)Tt+=Ie[at].value;return Tt}function Ea(Ie,at,$e){var Tt=at.dir,kt=at.next,gn=kt||Tt,yn=$e&&gn==="parentNode",Ln=Lt++;return at.first?function(It,Mr,Sn){for(;It=It[Tt];)if(It.nodeType===1||yn)return Ie(It,Mr,Sn);return!1}:function(It,Mr,Sn){var en,Rr,tr=[ut,Ln];if(Sn){for(;It=It[Tt];)if((It.nodeType===1||yn)&&Ie(It,Mr,Sn))return!0}else for(;It=It[Tt];)if(It.nodeType===1||yn)if(Rr=It[ft]||(It[ft]={}),kt&&y(It,kt))It=It[Tt]||It;else{if((en=Rr[gn])&&en[0]===ut&&en[1]===Ln)return tr[2]=en[2];if(Rr[gn]=tr,tr[2]=Ie(It,Mr,Sn))return!0}return!1}}function Cl(Ie){return Ie.length>1?function(at,$e,Tt){for(var kt=Ie.length;kt--;)if(!Ie[kt](at,$e,Tt))return!1;return!0}:Ie[0]}function di(Ie,at,$e,Tt,kt){for(var gn,yn=[],Ln=0,It=Ie.length,Mr=at!=null;Ln<It;Ln++)(gn=Ie[Ln])&&($e&&!$e(gn,Tt,kt)||(yn.push(gn),Mr&&at.push(Ln)));return yn}function Ai(Ie,at,$e,Tt,kt,gn){return Tt&&!Tt[ft]&&(Tt=Ai(Tt)),kt&&!kt[ft]&&(kt=Ai(kt,gn)),ni(function(yn,Ln,It,Mr){var Sn,en,Rr,tr,ci=[],bi=[],pi=Ln.length,we=yn||function(on,Tr,wr){for(var Yi=0,Jo=Tr.length;Yi<Jo;Yi++)Jn(on,Tr[Yi],wr);return wr}(at||"*",It.nodeType?[It]:It,[]),Mi=!Ie||!yn&&at?we:di(we,ci,Ie,It,Mr);if($e?$e(Mi,tr=kt||(yn?Ie:pi||Tt)?[]:Ln,It,Mr):tr=Mi,Tt)for(Sn=di(tr,bi),Tt(Sn,[],It,Mr),en=Sn.length;en--;)(Rr=Sn[en])&&(tr[bi[en]]=!(Mi[bi[en]]=Rr));if(yn){if(kt||Ie){if(kt){for(Sn=[],en=tr.length;en--;)(Rr=tr[en])&&Sn.push(Mi[en]=Rr);kt(null,tr=[],Sn,Mr)}for(en=tr.length;en--;)(Rr=tr[en])&&(Sn=kt?D.call(yn,Rr):ci[en])>-1&&(yn[Sn]=!(Ln[Sn]=Rr))}}else tr=di(tr===Ln?tr.splice(pi,tr.length):tr),kt?kt(null,Ln,tr,Mr):nt.apply(Ln,tr)})}function Ws(Ie){for(var at,$e,Tt,kt=Ie.length,gn=S.relative[Ie[0].type],yn=gn||S.relative[" "],Ln=gn?1:0,It=Ea(function(en){return en===at},yn,!0),Mr=Ea(function(en){return D.call(at,en)>-1},yn,!0),Sn=[function(en,Rr,tr){var ci=!gn&&(tr||Rr!=Z)||((at=Rr).nodeType?It(en,Rr,tr):Mr(en,Rr,tr));return at=null,ci}];Ln<kt;Ln++)if($e=S.relative[Ie[Ln].type])Sn=[Ea(Cl(Sn),$e)];else{if(($e=S.filter[Ie[Ln].type].apply(null,Ie[Ln].matches))[ft]){for(Tt=++Ln;Tt<kt&&!S.relative[Ie[Tt].type];Tt++);return Ai(Ln>1&&Cl(Sn),Ln>1&&xa(Ie.slice(0,Ln-1).concat({value:Ie[Ln-2].type===" "?"*":""})).replace(ne,"$1"),$e,Ln<Tt&&Ws(Ie.slice(Ln,Tt)),Tt<kt&&Ws(Ie=Ie.slice(Tt)),Tt<kt&&xa(Ie))}Sn.push($e)}return Cl(Sn)}function Ri(Ie,at){var $e,Tt=[],kt=[],gn=Hn[Ie+" "];if(!gn){for(at||(at=Wo(Ie)),$e=at.length;$e--;)(gn=Ws(at[$e]))[ft]?Tt.push(gn):kt.push(gn);(gn=Hn(Ie,function(yn,Ln){var It=Ln.length>0,Mr=yn.length>0,Sn=function(en,Rr,tr,ci,bi){var pi,we,Mi,on=0,Tr="0",wr=en&&[],Yi=[],Jo=Z,Gi=en||Mr&&S.find.TAG("*",bi),wa=ut+=Jo==null?1:Math.random()||.1,ho=Gi.length;for(bi&&(Z=Rr==fe||Rr||bi);Tr!==ho&&(pi=Gi[Tr])!=null;Tr++){if(Mr&&pi){for(we=0,Rr||pi.ownerDocument==fe||(Vi(pi),tr=!Me);Mi=yn[we++];)if(Mi(pi,Rr||fe,tr)){nt.call(ci,pi);break}bi&&(ut=wa)}It&&((pi=!Mi&&pi)&&on--,en&&wr.push(pi))}if(on+=Tr,It&&Tr!==on){for(we=0;Mi=Ln[we++];)Mi(wr,Yi,Rr,tr);if(en){if(on>0)for(;Tr--;)wr[Tr]||Yi[Tr]||(Yi[Tr]=j.call(ci));Yi=di(Yi)}nt.apply(ci,Yi),bi&&!en&&Yi.length>0&&on+Ln.length>1&&a.uniqueSort(ci)}return bi&&(ut=wa,Z=Jo),wr};return It?ni(Sn):Sn}(kt,Tt))).selector=Ie}return gn}function Sl(Ie,at,$e,Tt){var kt,gn,yn,Ln,It,Mr=typeof Ie=="function"&&Ie,Sn=!Tt&&Wo(Ie=Mr.selector||Ie);if($e=$e||[],Sn.length===1){if((gn=Sn[0]=Sn[0].slice(0)).length>2&&(yn=gn[0]).type==="ID"&&at.nodeType===9&&Me&&S.relative[gn[1].type]){if(!(at=(S.find.ID(yn.matches[0].replace($r,Oi),at)||[])[0]))return $e;Mr&&(at=at.parentNode),Ie=Ie.slice(gn.shift().value.length)}for(kt=Co.needsContext.test(Ie)?0:gn.length;kt--&&(yn=gn[kt],!S.relative[Ln=yn.type]);)if((It=S.find[Ln])&&(Tt=It(yn.matches[0].replace($r,Oi),Kr.test(gn[0].type)&&uo(at.parentNode)||at))){if(gn.splice(kt,1),!(Ie=Tt.length&&xa(gn)))return nt.apply($e,Tt),$e;break}}return(Mr||Ri(Ie,Sn))(Tt,at,!Me,$e,!at||Kr.test(Ie)&&uo(at.parentNode)||at),$e}_s.prototype=S.filters=S.pseudos,S.setFilters=new _s,R.sortStable=ft.split("").sort(Fr).join("")===ft,Vi(),R.sortDetached=Ar(function(Ie){return 1&Ie.compareDocumentPosition(fe.createElement("fieldset"))}),a.find=Jn,a.expr[":"]=a.expr.pseudos,a.unique=a.uniqueSort,Jn.compile=Ri,Jn.select=Sl,Jn.setDocument=Vi,Jn.escape=a.escapeSelector,Jn.getText=a.text,Jn.isXML=a.isXMLDoc,Jn.selectors=a.expr,Jn.support=a.support,Jn.uniqueSort=a.uniqueSort})();var xe=function(g,S,Z){for(var te=[],de=Z!==void 0;(g=g[S])&&g.nodeType!==9;)if(g.nodeType===1){if(de&&a(g).is(Z))break;te.push(g)}return te},Fe=function(g,S){for(var Z=[];g;g=g.nextSibling)g.nodeType===1&&g!==S&&Z.push(g);return Z},J=a.expr.match.needsContext,ge=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function oe(g,S,Z){return _(S)?a.grep(g,function(te,de){return!!S.call(te,de,te)!==Z}):S.nodeType?a.grep(g,function(te){return te===S!==Z}):typeof S!="string"?a.grep(g,function(te){return D.call(S,te)>-1!==Z}):a.filter(S,g,Z)}a.filter=function(g,S,Z){var te=S[0];return Z&&(g=":not("+g+")"),S.length===1&&te.nodeType===1?a.find.matchesSelector(te,g)?[te]:[]:a.find.matches(g,a.grep(S,function(de){return de.nodeType===1}))},a.fn.extend({find:function(g){var S,Z,te=this.length,de=this;if(typeof g!="string")return this.pushStack(a(g).filter(function(){for(S=0;S<te;S++)if(a.contains(de[S],this))return!0}));for(Z=this.pushStack([]),S=0;S<te;S++)a.find(g,de[S],Z);return te>1?a.uniqueSort(Z):Z},filter:function(g){return this.pushStack(oe(this,g||[],!1))},not:function(g){return this.pushStack(oe(this,g||[],!0))},is:function(g){return!!oe(this,typeof g=="string"&&J.test(g)?a(g):g||[],!1).length}});var le,Re=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(a.fn.init=function(g,S,Z){var te,de;if(!g)return this;if(Z=Z||le,typeof g=="string"){if(!(te=g[0]==="<"&&g[g.length-1]===">"&&g.length>=3?[null,g,null]:Re.exec(g))||!te[1]&&S)return!S||S.jquery?(S||Z).find(g):this.constructor(S).find(g);if(te[1]){if(S=S instanceof a?S[0]:S,a.merge(this,a.parseHTML(te[1],S&&S.nodeType?S.ownerDocument||S:k,!0)),ge.test(te[1])&&a.isPlainObject(S))for(te in S)_(this[te])?this[te](S[te]):this.attr(te,S[te]);return this}return(de=k.getElementById(te[2]))&&(this[0]=de,this.length=1),this}return g.nodeType?(this[0]=g,this.length=1,this):_(g)?Z.ready!==void 0?Z.ready(g):g(a):a.makeArray(g,this)}).prototype=a.fn,le=a(k);var Ye=/^(?:parents|prev(?:Until|All))/,Be={children:!0,contents:!0,next:!0,prev:!0};function se(g,S){for(;(g=g[S])&&g.nodeType!==1;);return g}a.fn.extend({has:function(g){var S=a(g,this),Z=S.length;return this.filter(function(){for(var te=0;te<Z;te++)if(a.contains(this,S[te]))return!0})},closest:function(g,S){var Z,te=0,de=this.length,fe=[],_e=typeof g!="string"&&a(g);if(!J.test(g)){for(;te<de;te++)for(Z=this[te];Z&&Z!==S;Z=Z.parentNode)if(Z.nodeType<11&&(_e?_e.index(Z)>-1:Z.nodeType===1&&a.find.matchesSelector(Z,g))){fe.push(Z);break}}return this.pushStack(fe.length>1?a.uniqueSort(fe):fe)},index:function(g){return g?typeof g=="string"?D.call(a(g),this[0]):D.call(this,g.jquery?g[0]:g):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(g,S){return this.pushStack(a.uniqueSort(a.merge(this.get(),a(g,S))))},addBack:function(g){return this.add(g==null?this.prevObject:this.prevObject.filter(g))}}),a.each({parent:function(g){var S=g.parentNode;return S&&S.nodeType!==11?S:null},parents:function(g){return xe(g,"parentNode")},parentsUntil:function(g,S,Z){return xe(g,"parentNode",Z)},next:function(g){return se(g,"nextSibling")},prev:function(g){return se(g,"previousSibling")},nextAll:function(g){return xe(g,"nextSibling")},prevAll:function(g){return xe(g,"previousSibling")},nextUntil:function(g,S,Z){return xe(g,"nextSibling",Z)},prevUntil:function(g,S,Z){return xe(g,"previousSibling",Z)},siblings:function(g){return Fe((g.parentNode||{}).firstChild,g)},children:function(g){return Fe(g.firstChild)},contents:function(g){return g.contentDocument!=null&&w(g.contentDocument)?g.contentDocument:(y(g,"template")&&(g=g.content||g),a.merge([],g.childNodes))}},function(g,S){a.fn[g]=function(Z,te){var de=a.map(this,S,Z);return g.slice(-5)!=="Until"&&(te=Z),te&&typeof te=="string"&&(de=a.filter(te,de)),this.length>1&&(Be[g]||a.uniqueSort(de),Ye.test(g)&&de.reverse()),this.pushStack(de)}});var ve=/[^\x20\t\r\n\f]+/g;function Ee(g){return g}function rt(g){throw g}function tt(g,S,Z,te){var de;try{g&&_(de=g.promise)?de.call(g).done(S).fail(Z):g&&_(de=g.then)?de.call(g,S,Z):S.apply(void 0,[g].slice(te))}catch(fe){Z.apply(void 0,[fe])}}a.Callbacks=function(g){g=typeof g=="string"?function(nt){var ft={};return a.each(nt.match(ve)||[],function(ut,Lt){ft[Lt]=!0}),ft}(g):a.extend({},g);var S,Z,te,de,fe=[],_e=[],Me=-1,Se=function(){for(de=de||g.once,te=S=!0;_e.length;Me=-1)for(Z=_e.shift();++Me<fe.length;)fe[Me].apply(Z[0],Z[1])===!1&&g.stopOnFalse&&(Me=fe.length,Z=!1);g.memory||(Z=!1),S=!1,de&&(fe=Z?[]:"")},Ne={add:function(){return fe&&(Z&&!S&&(Me=fe.length-1,_e.push(Z)),function nt(ft){a.each(ft,function(ut,Lt){_(Lt)?g.unique&&Ne.has(Lt)||fe.push(Lt):Lt&&Lt.length&&C(Lt)!=="string"&&nt(Lt)})}(arguments),Z&&!S&&Se()),this},remove:function(){return a.each(arguments,function(nt,ft){for(var ut;(ut=a.inArray(ft,fe,ut))>-1;)fe.splice(ut,1),ut<=Me&&Me--}),this},has:function(nt){return nt?a.inArray(nt,fe)>-1:fe.length>0},empty:function(){return fe&&(fe=[]),this},disable:function(){return de=_e=[],fe=Z="",this},disabled:function(){return!fe},lock:function(){return de=_e=[],Z||S||(fe=Z=""),this},locked:function(){return!!de},fireWith:function(nt,ft){return de||(ft=[nt,(ft=ft||[]).slice?ft.slice():ft],_e.push(ft),S||Se()),this},fire:function(){return Ne.fireWith(this,arguments),this},fired:function(){return!!te}};return Ne},a.extend({Deferred:function(g){var S=[["notify","progress",a.Callbacks("memory"),a.Callbacks("memory"),2],["resolve","done",a.Callbacks("once memory"),a.Callbacks("once memory"),0,"resolved"],["reject","fail",a.Callbacks("once memory"),a.Callbacks("once memory"),1,"rejected"]],Z="pending",te={state:function(){return Z},always:function(){return de.done(arguments).fail(arguments),this},catch:function(fe){return te.then(null,fe)},pipe:function(){var fe=arguments;return a.Deferred(function(_e){a.each(S,function(Me,Se){var Ne=_(fe[Se[4]])&&fe[Se[4]];de[Se[1]](function(){var nt=Ne&&Ne.apply(this,arguments);nt&&_(nt.promise)?nt.promise().progress(_e.notify).done(_e.resolve).fail(_e.reject):_e[Se[0]+"With"](this,Ne?[nt]:arguments)})}),fe=null}).promise()},then:function(fe,_e,Me){var Se=0;function Ne(nt,ft,ut,Lt){return function(){var kn=this,Pt=arguments,Hn=function(){var Fr,lo;if(!(nt<Se)){if((Fr=ut.apply(kn,Pt))===ft.promise())throw new TypeError("Thenable self-resolution");lo=Fr&&(typeof Fr=="object"||typeof Fr=="function")&&Fr.then,_(lo)?Lt?lo.call(Fr,Ne(Se,ft,Ee,Lt),Ne(Se,ft,rt,Lt)):(Se++,lo.call(Fr,Ne(Se,ft,Ee,Lt),Ne(Se,ft,rt,Lt),Ne(Se,ft,Ee,ft.notifyWith))):(ut!==Ee&&(kn=void 0,Pt=[Fr]),(Lt||ft.resolveWith)(kn,Pt))}},Zr=Lt?Hn:function(){try{Hn()}catch(Fr){a.Deferred.exceptionHook&&a.Deferred.exceptionHook(Fr,Zr.error),nt+1>=Se&&(ut!==rt&&(kn=void 0,Pt=[Fr]),ft.rejectWith(kn,Pt))}};nt?Zr():(a.Deferred.getErrorHook?Zr.error=a.Deferred.getErrorHook():a.Deferred.getStackHook&&(Zr.error=a.Deferred.getStackHook()),o.setTimeout(Zr))}}return a.Deferred(function(nt){S[0][3].add(Ne(0,nt,_(Me)?Me:Ee,nt.notifyWith)),S[1][3].add(Ne(0,nt,_(fe)?fe:Ee)),S[2][3].add(Ne(0,nt,_(_e)?_e:rt))}).promise()},promise:function(fe){return fe!=null?a.extend(fe,te):te}},de={};return a.each(S,function(fe,_e){var Me=_e[2],Se=_e[5];te[_e[1]]=Me.add,Se&&Me.add(function(){Z=Se},S[3-fe][2].disable,S[3-fe][3].disable,S[0][2].lock,S[0][3].lock),Me.add(_e[3].fire),de[_e[0]]=function(){return de[_e[0]+"With"](this===de?void 0:this,arguments),this},de[_e[0]+"With"]=Me.fireWith}),te.promise(de),g&&g.call(de,de),de},when:function(g){var S=arguments.length,Z=S,te=Array(Z),de=L.call(arguments),fe=a.Deferred(),_e=function(Me){return function(Se){te[Me]=this,de[Me]=arguments.length>1?L.call(arguments):Se,--S||fe.resolveWith(te,de)}};if(S<=1&&(tt(g,fe.done(_e(Z)).resolve,fe.reject,!S),fe.state()==="pending"||_(de[Z]&&de[Z].then)))return fe.then();for(;Z--;)tt(de[Z],_e(Z),fe.reject);return fe.promise()}});var xt=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;a.Deferred.exceptionHook=function(g,S){o.console&&o.console.warn&&g&&xt.test(g.name)&&o.console.warn("jQuery.Deferred exception: "+g.message,g.stack,S)},a.readyException=function(g){o.setTimeout(function(){throw g})};var Rt=a.Deferred();function At(){k.removeEventListener("DOMContentLoaded",At),o.removeEventListener("load",At),a.ready()}a.fn.ready=function(g){return Rt.then(g).catch(function(S){a.readyException(S)}),this},a.extend({isReady:!1,readyWait:1,ready:function(g){(g===!0?--a.readyWait:a.isReady)||(a.isReady=!0,g!==!0&&--a.readyWait>0||Rt.resolveWith(k,[a]))}}),a.ready.then=Rt.then,k.readyState==="complete"||k.readyState!=="loading"&&!k.documentElement.doScroll?o.setTimeout(a.ready):(k.addEventListener("DOMContentLoaded",At),o.addEventListener("load",At));var He=function(g,S,Z,te,de,fe,_e){var Me=0,Se=g.length,Ne=Z==null;if(C(Z)==="object")for(Me in de=!0,Z)He(g,S,Me,Z[Me],!0,fe,_e);else if(te!==void 0&&(de=!0,_(te)||(_e=!0),Ne&&(_e?(S.call(g,te),S=null):(Ne=S,S=function(nt,ft,ut){return Ne.call(a(nt),ut)})),S))for(;Me<Se;Me++)S(g[Me],Z,_e?te:te.call(g[Me],Me,S(g[Me],Z)));return de?g:Ne?S.call(g):Se?S(g[0],Z):fe},Gt=/^-ms-/,jt=/-([a-z])/g;function Tn(g,S){return S.toUpperCase()}function mn(g){return g.replace(Gt,"ms-").replace(jt,Tn)}var Qn=function(g){return g.nodeType===1||g.nodeType===9||!+g.nodeType};function gt(){this.expando=a.expando+gt.uid++}gt.uid=1,gt.prototype={cache:function(g){var S=g[this.expando];return S||(S={},Qn(g)&&(g.nodeType?g[this.expando]=S:Object.defineProperty(g,this.expando,{value:S,configurable:!0}))),S},set:function(g,S,Z){var te,de=this.cache(g);if(typeof S=="string")de[mn(S)]=Z;else for(te in S)de[mn(te)]=S[te];return de},get:function(g,S){return S===void 0?this.cache(g):g[this.expando]&&g[this.expando][mn(S)]},access:function(g,S,Z){return S===void 0||S&&typeof S=="string"&&Z===void 0?this.get(g,S):(this.set(g,S,Z),Z!==void 0?Z:S)},remove:function(g,S){var Z,te=g[this.expando];if(te!==void 0){if(S!==void 0)for(Z=(S=Array.isArray(S)?S.map(mn):(S=mn(S))in te?[S]:S.match(ve)||[]).length;Z--;)delete te[S[Z]];(S===void 0||a.isEmptyObject(te))&&(g.nodeType?g[this.expando]=void 0:delete g[this.expando])}},hasData:function(g){var S=g[this.expando];return S!==void 0&&!a.isEmptyObject(S)}};var ze=new gt,Zt=new gt,Rn=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Xn=/[A-Z]/g;function pt(g,S,Z){var te;if(Z===void 0&&g.nodeType===1)if(te="data-"+S.replace(Xn,"-$&").toLowerCase(),typeof(Z=g.getAttribute(te))=="string"){try{Z=function(de){return de==="true"||de!=="false"&&(de==="null"?null:de===+de+""?+de:Rn.test(de)?JSON.parse(de):de)}(Z)}catch{}Zt.set(g,S,Z)}else Z=void 0;return Z}a.extend({hasData:function(g){return Zt.hasData(g)||ze.hasData(g)},data:function(g,S,Z){return Zt.access(g,S,Z)},removeData:function(g,S){Zt.remove(g,S)},_data:function(g,S,Z){return ze.access(g,S,Z)},_removeData:function(g,S){ze.remove(g,S)}}),a.fn.extend({data:function(g,S){var Z,te,de,fe=this[0],_e=fe&&fe.attributes;if(g===void 0){if(this.length&&(de=Zt.get(fe),fe.nodeType===1&&!ze.get(fe,"hasDataAttrs"))){for(Z=_e.length;Z--;)_e[Z]&&(te=_e[Z].name).indexOf("data-")===0&&(te=mn(te.slice(5)),pt(fe,te,de[te]));ze.set(fe,"hasDataAttrs",!0)}return de}return typeof g=="object"?this.each(function(){Zt.set(this,g)}):He(this,function(Me){var Se;if(fe&&Me===void 0)return(Se=Zt.get(fe,g))!==void 0||(Se=pt(fe,g))!==void 0?Se:void 0;this.each(function(){Zt.set(this,g,Me)})},null,S,arguments.length>1,null,!0)},removeData:function(g){return this.each(function(){Zt.remove(this,g)})}}),a.extend({queue:function(g,S,Z){var te;if(g)return S=(S||"fx")+"queue",te=ze.get(g,S),Z&&(!te||Array.isArray(Z)?te=ze.access(g,S,a.makeArray(Z)):te.push(Z)),te||[]},dequeue:function(g,S){S=S||"fx";var Z=a.queue(g,S),te=Z.length,de=Z.shift(),fe=a._queueHooks(g,S);de==="inprogress"&&(de=Z.shift(),te--),de&&(S==="fx"&&Z.unshift("inprogress"),delete fe.stop,de.call(g,function(){a.dequeue(g,S)},fe)),!te&&fe&&fe.empty.fire()},_queueHooks:function(g,S){var Z=S+"queueHooks";return ze.get(g,Z)||ze.access(g,Z,{empty:a.Callbacks("once memory").add(function(){ze.remove(g,[S+"queue",Z])})})}}),a.fn.extend({queue:function(g,S){var Z=2;return typeof g!="string"&&(S=g,g="fx",Z--),arguments.length<Z?a.queue(this[0],g):S===void 0?this:this.each(function(){var te=a.queue(this,g,S);a._queueHooks(this,g),g==="fx"&&te[0]!=="inprogress"&&a.dequeue(this,g)})},dequeue:function(g){return this.each(function(){a.dequeue(this,g)})},clearQueue:function(g){return this.queue(g||"fx",[])},promise:function(g,S){var Z,te=1,de=a.Deferred(),fe=this,_e=this.length,Me=function(){--te||de.resolveWith(fe,[fe])};for(typeof g!="string"&&(S=g,g=void 0),g=g||"fx";_e--;)(Z=ze.get(fe[_e],g+"queueHooks"))&&Z.empty&&(te++,Z.empty.add(Me));return Me(),de.promise(S)}});var st=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,qt=new RegExp("^(?:([+-])=|)("+st+")([a-z%]*)$","i"),xn=["Top","Right","Bottom","Left"],nn=k.documentElement,er=function(g){return a.contains(g.ownerDocument,g)},kr={composed:!0};nn.getRootNode&&(er=function(g){return a.contains(g.ownerDocument,g)||g.getRootNode(kr)===g.ownerDocument});var ct=function(g,S){return(g=S||g).style.display==="none"||g.style.display===""&&er(g)&&a.css(g,"display")==="none"};function Ue(g,S,Z,te){var de,fe,_e=20,Me=te?function(){return te.cur()}:function(){return a.css(g,S,"")},Se=Me(),Ne=Z&&Z[3]||(a.cssNumber[S]?"":"px"),nt=g.nodeType&&(a.cssNumber[S]||Ne!=="px"&&+Se)&&qt.exec(a.css(g,S));if(nt&&nt[3]!==Ne){for(Se/=2,Ne=Ne||nt[3],nt=+Se||1;_e--;)a.style(g,S,nt+Ne),(1-fe)*(1-(fe=Me()/Se||.5))<=0&&(_e=0),nt/=fe;nt*=2,a.style(g,S,nt+Ne),Z=Z||[]}return Z&&(nt=+nt||+Se||0,de=Z[1]?nt+(Z[1]+1)*Z[2]:+Z[2],te&&(te.unit=Ne,te.start=nt,te.end=de)),de}var lt={};function Wt(g){var S,Z=g.ownerDocument,te=g.nodeName,de=lt[te];return de||(S=Z.body.appendChild(Z.createElement(te)),de=a.css(S,"display"),S.parentNode.removeChild(S),de==="none"&&(de="block"),lt[te]=de,de)}function Ke(g,S){for(var Z,te,de=[],fe=0,_e=g.length;fe<_e;fe++)(te=g[fe]).style&&(Z=te.style.display,S?(Z==="none"&&(de[fe]=ze.get(te,"display")||null,de[fe]||(te.style.display="")),te.style.display===""&&ct(te)&&(de[fe]=Wt(te))):Z!=="none"&&(de[fe]="none",ze.set(te,"display",Z)));for(fe=0;fe<_e;fe++)de[fe]!=null&&(g[fe].style.display=de[fe]);return g}a.fn.extend({show:function(){return Ke(this,!0)},hide:function(){return Ke(this)},toggle:function(g){return typeof g=="boolean"?g?this.show():this.hide():this.each(function(){ct(this)?a(this).show():a(this).hide()})}});var Ot,$t,rn=/^(?:checkbox|radio)$/i,hr=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,_r=/^$|^module$|\/(?:java|ecma)script/i;Ot=k.createDocumentFragment().appendChild(k.createElement("div")),($t=k.createElement("input")).setAttribute("type","radio"),$t.setAttribute("checked","checked"),$t.setAttribute("name","t"),Ot.appendChild($t),R.checkClone=Ot.cloneNode(!0).cloneNode(!0).lastChild.checked,Ot.innerHTML="<textarea>x</textarea>",R.noCloneChecked=!!Ot.cloneNode(!0).lastChild.defaultValue,Ot.innerHTML="<option></option>",R.option=!!Ot.lastChild;var qr={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Ur(g,S){var Z;return Z=g.getElementsByTagName!==void 0?g.getElementsByTagName(S||"*"):g.querySelectorAll!==void 0?g.querySelectorAll(S||"*"):[],S===void 0||S&&y(g,S)?a.merge([g],Z):Z}function Gr(g,S){for(var Z=0,te=g.length;Z<te;Z++)ze.set(g[Z],"globalEval",!S||ze.get(S[Z],"globalEval"))}qr.tbody=qr.tfoot=qr.colgroup=qr.caption=qr.thead,qr.th=qr.td,R.option||(qr.optgroup=qr.option=[1,"<select multiple='multiple'>","</select>"]);var Or=/<|&#?\w+;/;function Qi(g,S,Z,te,de){for(var fe,_e,Me,Se,Ne,nt,ft=S.createDocumentFragment(),ut=[],Lt=0,kn=g.length;Lt<kn;Lt++)if((fe=g[Lt])||fe===0)if(C(fe)==="object")a.merge(ut,fe.nodeType?[fe]:fe);else if(Or.test(fe)){for(_e=_e||ft.appendChild(S.createElement("div")),Me=(hr.exec(fe)||["",""])[1].toLowerCase(),Se=qr[Me]||qr._default,_e.innerHTML=Se[1]+a.htmlPrefilter(fe)+Se[2],nt=Se[0];nt--;)_e=_e.lastChild;a.merge(ut,_e.childNodes),(_e=ft.firstChild).textContent=""}else ut.push(S.createTextNode(fe));for(ft.textContent="",Lt=0;fe=ut[Lt++];)if(te&&a.inArray(fe,te)>-1)de&&de.push(fe);else if(Ne=er(fe),_e=Ur(ft.appendChild(fe),"script"),Ne&&Gr(_e),Z)for(nt=0;fe=_e[nt++];)_r.test(fe.type||"")&&Z.push(fe);return ft}var Pi=/^([^.]*)(?:\.(.+)|)/;function si(){return!0}function gr(){return!1}function Wi(g,S,Z,te,de,fe){var _e,Me;if(typeof S=="object"){for(Me in typeof Z!="string"&&(te=te||Z,Z=void 0),S)Wi(g,Me,Z,te,S[Me],fe);return g}if(te==null&&de==null?(de=Z,te=Z=void 0):de==null&&(typeof Z=="string"?(de=te,te=void 0):(de=te,te=Z,Z=void 0)),de===!1)de=gr;else if(!de)return g;return fe===1&&(_e=de,(de=function(Se){return a().off(Se),_e.apply(this,arguments)}).guid=_e.guid||(_e.guid=a.guid++)),g.each(function(){a.event.add(this,S,de,te,Z)})}function H(g,S,Z){Z?(ze.set(g,S,!1),a.event.add(g,S,{namespace:!1,handler:function(te){var de,fe=ze.get(this,S);if(1&te.isTrigger&&this[S]){if(fe)(a.event.special[S]||{}).delegateType&&te.stopPropagation();else if(fe=L.call(arguments),ze.set(this,S,fe),this[S](),de=ze.get(this,S),ze.set(this,S,!1),fe!==de)return te.stopImmediatePropagation(),te.preventDefault(),de}else fe&&(ze.set(this,S,a.event.trigger(fe[0],fe.slice(1),this)),te.stopPropagation(),te.isImmediatePropagationStopped=si)}})):ze.get(g,S)===void 0&&a.event.add(g,S,si)}a.event={global:{},add:function(g,S,Z,te,de){var fe,_e,Me,Se,Ne,nt,ft,ut,Lt,kn,Pt,Hn=ze.get(g);if(Qn(g))for(Z.handler&&(Z=(fe=Z).handler,de=fe.selector),de&&a.find.matchesSelector(nn,de),Z.guid||(Z.guid=a.guid++),(Se=Hn.events)||(Se=Hn.events=Object.create(null)),(_e=Hn.handle)||(_e=Hn.handle=function(Zr){return a!==void 0&&a.event.triggered!==Zr.type?a.event.dispatch.apply(g,arguments):void 0}),Ne=(S=(S||"").match(ve)||[""]).length;Ne--;)Lt=Pt=(Me=Pi.exec(S[Ne])||[])[1],kn=(Me[2]||"").split(".").sort(),Lt&&(ft=a.event.special[Lt]||{},Lt=(de?ft.delegateType:ft.bindType)||Lt,ft=a.event.special[Lt]||{},nt=a.extend({type:Lt,origType:Pt,data:te,handler:Z,guid:Z.guid,selector:de,needsContext:de&&a.expr.match.needsContext.test(de),namespace:kn.join(".")},fe),(ut=Se[Lt])||((ut=Se[Lt]=[]).delegateCount=0,ft.setup&&ft.setup.call(g,te,kn,_e)!==!1||g.addEventListener&&g.addEventListener(Lt,_e)),ft.add&&(ft.add.call(g,nt),nt.handler.guid||(nt.handler.guid=Z.guid)),de?ut.splice(ut.delegateCount++,0,nt):ut.push(nt),a.event.global[Lt]=!0)},remove:function(g,S,Z,te,de){var fe,_e,Me,Se,Ne,nt,ft,ut,Lt,kn,Pt,Hn=ze.hasData(g)&&ze.get(g);if(Hn&&(Se=Hn.events)){for(Ne=(S=(S||"").match(ve)||[""]).length;Ne--;)if(Lt=Pt=(Me=Pi.exec(S[Ne])||[])[1],kn=(Me[2]||"").split(".").sort(),Lt){for(ft=a.event.special[Lt]||{},ut=Se[Lt=(te?ft.delegateType:ft.bindType)||Lt]||[],Me=Me[2]&&new RegExp("(^|\\.)"+kn.join("\\.(?:.*\\.|)")+"(\\.|$)"),_e=fe=ut.length;fe--;)nt=ut[fe],!de&&Pt!==nt.origType||Z&&Z.guid!==nt.guid||Me&&!Me.test(nt.namespace)||te&&te!==nt.selector&&(te!=="**"||!nt.selector)||(ut.splice(fe,1),nt.selector&&ut.delegateCount--,ft.remove&&ft.remove.call(g,nt));_e&&!ut.length&&(ft.teardown&&ft.teardown.call(g,kn,Hn.handle)!==!1||a.removeEvent(g,Lt,Hn.handle),delete Se[Lt])}else for(Lt in Se)a.event.remove(g,Lt+S[Ne],Z,te,!0);a.isEmptyObject(Se)&&ze.remove(g,"handle events")}},dispatch:function(g){var S,Z,te,de,fe,_e,Me=new Array(arguments.length),Se=a.event.fix(g),Ne=(ze.get(this,"events")||Object.create(null))[Se.type]||[],nt=a.event.special[Se.type]||{};for(Me[0]=Se,S=1;S<arguments.length;S++)Me[S]=arguments[S];if(Se.delegateTarget=this,!nt.preDispatch||nt.preDispatch.call(this,Se)!==!1){for(_e=a.event.handlers.call(this,Se,Ne),S=0;(de=_e[S++])&&!Se.isPropagationStopped();)for(Se.currentTarget=de.elem,Z=0;(fe=de.handlers[Z++])&&!Se.isImmediatePropagationStopped();)Se.rnamespace&&fe.namespace!==!1&&!Se.rnamespace.test(fe.namespace)||(Se.handleObj=fe,Se.data=fe.data,(te=((a.event.special[fe.origType]||{}).handle||fe.handler).apply(de.elem,Me))!==void 0&&(Se.result=te)===!1&&(Se.preventDefault(),Se.stopPropagation()));return nt.postDispatch&&nt.postDispatch.call(this,Se),Se.result}},handlers:function(g,S){var Z,te,de,fe,_e,Me=[],Se=S.delegateCount,Ne=g.target;if(Se&&Ne.nodeType&&!(g.type==="click"&&g.button>=1)){for(;Ne!==this;Ne=Ne.parentNode||this)if(Ne.nodeType===1&&(g.type!=="click"||Ne.disabled!==!0)){for(fe=[],_e={},Z=0;Z<Se;Z++)_e[de=(te=S[Z]).selector+" "]===void 0&&(_e[de]=te.needsContext?a(de,this).index(Ne)>-1:a.find(de,this,null,[Ne]).length),_e[de]&&fe.push(te);fe.length&&Me.push({elem:Ne,handlers:fe})}}return Ne=this,Se<S.length&&Me.push({elem:Ne,handlers:S.slice(Se)}),Me},addProp:function(g,S){Object.defineProperty(a.Event.prototype,g,{enumerable:!0,configurable:!0,get:_(S)?function(){if(this.originalEvent)return S(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[g]},set:function(Z){Object.defineProperty(this,g,{enumerable:!0,configurable:!0,writable:!0,value:Z})}})},fix:function(g){return g[a.expando]?g:new a.Event(g)},special:{load:{noBubble:!0},click:{setup:function(g){var S=this||g;return rn.test(S.type)&&S.click&&y(S,"input")&&H(S,"click",!0),!1},trigger:function(g){var S=this||g;return rn.test(S.type)&&S.click&&y(S,"input")&&H(S,"click"),!0},_default:function(g){var S=g.target;return rn.test(S.type)&&S.click&&y(S,"input")&&ze.get(S,"click")||y(S,"a")}},beforeunload:{postDispatch:function(g){g.result!==void 0&&g.originalEvent&&(g.originalEvent.returnValue=g.result)}}}},a.removeEvent=function(g,S,Z){g.removeEventListener&&g.removeEventListener(S,Z)},a.Event=function(g,S){if(!(this instanceof a.Event))return new a.Event(g,S);g&&g.type?(this.originalEvent=g,this.type=g.type,this.isDefaultPrevented=g.defaultPrevented||g.defaultPrevented===void 0&&g.returnValue===!1?si:gr,this.target=g.target&&g.target.nodeType===3?g.target.parentNode:g.target,this.currentTarget=g.currentTarget,this.relatedTarget=g.relatedTarget):this.type=g,S&&a.extend(this,S),this.timeStamp=g&&g.timeStamp||Date.now(),this[a.expando]=!0},a.Event.prototype={constructor:a.Event,isDefaultPrevented:gr,isPropagationStopped:gr,isImmediatePropagationStopped:gr,isSimulated:!1,preventDefault:function(){var g=this.originalEvent;this.isDefaultPrevented=si,g&&!this.isSimulated&&g.preventDefault()},stopPropagation:function(){var g=this.originalEvent;this.isPropagationStopped=si,g&&!this.isSimulated&&g.stopPropagation()},stopImmediatePropagation:function(){var g=this.originalEvent;this.isImmediatePropagationStopped=si,g&&!this.isSimulated&&g.stopImmediatePropagation(),this.stopPropagation()}},a.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},a.event.addProp),a.each({focus:"focusin",blur:"focusout"},function(g,S){function Z(te){if(k.documentMode){var de=ze.get(this,"handle"),fe=a.event.fix(te);fe.type=te.type==="focusin"?"focus":"blur",fe.isSimulated=!0,de(te),fe.target===fe.currentTarget&&de(fe)}else a.event.simulate(S,te.target,a.event.fix(te))}a.event.special[g]={setup:function(){var te;if(H(this,g,!0),!k.documentMode)return!1;(te=ze.get(this,S))||this.addEventListener(S,Z),ze.set(this,S,(te||0)+1)},trigger:function(){return H(this,g),!0},teardown:function(){var te;if(!k.documentMode)return!1;(te=ze.get(this,S)-1)?ze.set(this,S,te):(this.removeEventListener(S,Z),ze.remove(this,S))},_default:function(te){return ze.get(te.target,g)},delegateType:S},a.event.special[S]={setup:function(){var te=this.ownerDocument||this.document||this,de=k.documentMode?this:te,fe=ze.get(de,S);fe||(k.documentMode?this.addEventListener(S,Z):te.addEventListener(g,Z,!0)),ze.set(de,S,(fe||0)+1)},teardown:function(){var te=this.ownerDocument||this.document||this,de=k.documentMode?this:te,fe=ze.get(de,S)-1;fe?ze.set(de,S,fe):(k.documentMode?this.removeEventListener(S,Z):te.removeEventListener(g,Z,!0),ze.remove(de,S))}}}),a.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(g,S){a.event.special[g]={delegateType:S,bindType:S,handle:function(Z){var te,de=Z.relatedTarget,fe=Z.handleObj;return de&&(de===this||a.contains(this,de))||(Z.type=fe.origType,te=fe.handler.apply(this,arguments),Z.type=S),te}}}),a.fn.extend({on:function(g,S,Z,te){return Wi(this,g,S,Z,te)},one:function(g,S,Z,te){return Wi(this,g,S,Z,te,1)},off:function(g,S,Z){var te,de;if(g&&g.preventDefault&&g.handleObj)return te=g.handleObj,a(g.delegateTarget).off(te.namespace?te.origType+"."+te.namespace:te.origType,te.selector,te.handler),this;if(typeof g=="object"){for(de in g)this.off(de,S,g[de]);return this}return S!==!1&&typeof S!="function"||(Z=S,S=void 0),Z===!1&&(Z=gr),this.each(function(){a.event.remove(this,g,Z,S)})}});var Hr=/<script|<style|<link/i,Eo=/checked\s*(?:[^=]|=\s*.checked.)/i,Kn=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function ao(g,S){return y(g,"table")&&y(S.nodeType!==11?S:S.firstChild,"tr")&&a(g).children("tbody")[0]||g}function Na(g){return g.type=(g.getAttribute("type")!==null)+"/"+g.type,g}function Fs(g){return(g.type||"").slice(0,5)==="true/"?g.type=g.type.slice(5):g.removeAttribute("type"),g}function es(g,S){var Z,te,de,fe,_e,Me;if(S.nodeType===1){if(ze.hasData(g)&&(Me=ze.get(g).events))for(de in ze.remove(S,"handle events"),Me)for(Z=0,te=Me[de].length;Z<te;Z++)a.event.add(S,de,Me[de][Z]);Zt.hasData(g)&&(fe=Zt.access(g),_e=a.extend({},fe),Zt.set(S,_e))}}function fs(g,S){var Z=S.nodeName.toLowerCase();Z==="input"&&rn.test(g.type)?S.checked=g.checked:Z!=="input"&&Z!=="textarea"||(S.defaultValue=g.defaultValue)}function na(g,S,Z,te){S=U(S);var de,fe,_e,Me,Se,Ne,nt=0,ft=g.length,ut=ft-1,Lt=S[0],kn=_(Lt);if(kn||ft>1&&typeof Lt=="string"&&!R.checkClone&&Eo.test(Lt))return g.each(function(Pt){var Hn=g.eq(Pt);kn&&(S[0]=Lt.call(this,Pt,Hn.html())),na(Hn,S,Z,te)});if(ft&&(fe=(de=Qi(S,g[0].ownerDocument,!1,g,te)).firstChild,de.childNodes.length===1&&(de=fe),fe||te)){for(Me=(_e=a.map(Ur(de,"script"),Na)).length;nt<ft;nt++)Se=de,nt!==ut&&(Se=a.clone(Se,!0,!0),Me&&a.merge(_e,Ur(Se,"script"))),Z.call(g[nt],Se,nt);if(Me)for(Ne=_e[_e.length-1].ownerDocument,a.map(_e,Fs),nt=0;nt<Me;nt++)Se=_e[nt],_r.test(Se.type||"")&&!ze.access(Se,"globalEval")&&a.contains(Ne,Se)&&(Se.src&&(Se.type||"").toLowerCase()!=="module"?a._evalUrl&&!Se.noModule&&a._evalUrl(Se.src,{nonce:Se.nonce||Se.getAttribute("nonce")},Ne):W(Se.textContent.replace(Kn,""),Se,Ne))}return g}function ts(g,S,Z){for(var te,de=S?a.filter(S,g):g,fe=0;(te=de[fe])!=null;fe++)Z||te.nodeType!==1||a.cleanData(Ur(te)),te.parentNode&&(Z&&er(te)&&Gr(Ur(te,"script")),te.parentNode.removeChild(te));return g}a.extend({htmlPrefilter:function(g){return g},clone:function(g,S,Z){var te,de,fe,_e,Me=g.cloneNode(!0),Se=er(g);if(!(R.noCloneChecked||g.nodeType!==1&&g.nodeType!==11||a.isXMLDoc(g)))for(_e=Ur(Me),te=0,de=(fe=Ur(g)).length;te<de;te++)fs(fe[te],_e[te]);if(S)if(Z)for(fe=fe||Ur(g),_e=_e||Ur(Me),te=0,de=fe.length;te<de;te++)es(fe[te],_e[te]);else es(g,Me);return(_e=Ur(Me,"script")).length>0&&Gr(_e,!Se&&Ur(g,"script")),Me},cleanData:function(g){for(var S,Z,te,de=a.event.special,fe=0;(Z=g[fe])!==void 0;fe++)if(Qn(Z)){if(S=Z[ze.expando]){if(S.events)for(te in S.events)de[te]?a.event.remove(Z,te):a.removeEvent(Z,te,S.handle);Z[ze.expando]=void 0}Z[Zt.expando]&&(Z[Zt.expando]=void 0)}}}),a.fn.extend({detach:function(g){return ts(this,g,!0)},remove:function(g){return ts(this,g)},text:function(g){return He(this,function(S){return S===void 0?a.text(this):this.empty().each(function(){this.nodeType!==1&&this.nodeType!==11&&this.nodeType!==9||(this.textContent=S)})},null,g,arguments.length)},append:function(){return na(this,arguments,function(g){this.nodeType!==1&&this.nodeType!==11&&this.nodeType!==9||ao(this,g).appendChild(g)})},prepend:function(){return na(this,arguments,function(g){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var S=ao(this,g);S.insertBefore(g,S.firstChild)}})},before:function(){return na(this,arguments,function(g){this.parentNode&&this.parentNode.insertBefore(g,this)})},after:function(){return na(this,arguments,function(g){this.parentNode&&this.parentNode.insertBefore(g,this.nextSibling)})},empty:function(){for(var g,S=0;(g=this[S])!=null;S++)g.nodeType===1&&(a.cleanData(Ur(g,!1)),g.textContent="");return this},clone:function(g,S){return g=g!=null&&g,S=S??g,this.map(function(){return a.clone(this,g,S)})},html:function(g){return He(this,function(S){var Z=this[0]||{},te=0,de=this.length;if(S===void 0&&Z.nodeType===1)return Z.innerHTML;if(typeof S=="string"&&!Hr.test(S)&&!qr[(hr.exec(S)||["",""])[1].toLowerCase()]){S=a.htmlPrefilter(S);try{for(;te<de;te++)(Z=this[te]||{}).nodeType===1&&(a.cleanData(Ur(Z,!1)),Z.innerHTML=S);Z=0}catch{}}Z&&this.empty().append(S)},null,g,arguments.length)},replaceWith:function(){var g=[];return na(this,arguments,function(S){var Z=this.parentNode;a.inArray(this,g)<0&&(a.cleanData(Ur(this)),Z&&Z.replaceChild(S,this))},g)}}),a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(g,S){a.fn[g]=function(Z){for(var te,de=[],fe=a(Z),_e=fe.length-1,Me=0;Me<=_e;Me++)te=Me===_e?this:this.clone(!0),a(fe[Me])[S](te),N.apply(de,te.get());return this.pushStack(de)}});var so=new RegExp("^("+st+")(?!px)[a-z%]+$","i"),Ba=/^--/,Po=function(g){var S=g.ownerDocument.defaultView;return S&&S.opener||(S=o),S.getComputedStyle(g)},ms=function(g,S,Z){var te,de,fe={};for(de in S)fe[de]=g.style[de],g.style[de]=S[de];for(de in te=Z.call(g),S)g.style[de]=fe[de];return te},Vs=new RegExp(xn.join("|"),"i");function ra(g,S,Z){var te,de,fe,_e,Me=Ba.test(S),Se=g.style;return(Z=Z||Po(g))&&(_e=Z.getPropertyValue(S)||Z[S],Me&&_e&&(_e=_e.replace(ne,"$1")||void 0),_e!==""||er(g)||(_e=a.style(g,S)),!R.pixelBoxStyles()&&so.test(_e)&&Vs.test(S)&&(te=Se.width,de=Se.minWidth,fe=Se.maxWidth,Se.minWidth=Se.maxWidth=Se.width=_e,_e=Z.width,Se.width=te,Se.minWidth=de,Se.maxWidth=fe)),_e!==void 0?_e+"":_e}function gs(g,S){return{get:function(){if(!g())return(this.get=S).apply(this,arguments);delete this.get}}}(function(){function g(){if(Ne){Se.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",Ne.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",nn.appendChild(Se).appendChild(Ne);var nt=o.getComputedStyle(Ne);Z=nt.top!=="1%",Me=S(nt.marginLeft)===12,Ne.style.right="60%",fe=S(nt.right)===36,te=S(nt.width)===36,Ne.style.position="absolute",de=S(Ne.offsetWidth/3)===12,nn.removeChild(Se),Ne=null}}function S(nt){return Math.round(parseFloat(nt))}var Z,te,de,fe,_e,Me,Se=k.createElement("div"),Ne=k.createElement("div");Ne.style&&(Ne.style.backgroundClip="content-box",Ne.cloneNode(!0).style.backgroundClip="",R.clearCloneStyle=Ne.style.backgroundClip==="content-box",a.extend(R,{boxSizingReliable:function(){return g(),te},pixelBoxStyles:function(){return g(),fe},pixelPosition:function(){return g(),Z},reliableMarginLeft:function(){return g(),Me},scrollboxSize:function(){return g(),de},reliableTrDimensions:function(){var nt,ft,ut,Lt;return _e==null&&(nt=k.createElement("table"),ft=k.createElement("tr"),ut=k.createElement("div"),nt.style.cssText="position:absolute;left:-11111px;border-collapse:separate",ft.style.cssText="border:1px solid",ft.style.height="1px",ut.style.height="9px",ut.style.display="block",nn.appendChild(nt).appendChild(ft).appendChild(ut),Lt=o.getComputedStyle(ft),_e=parseInt(Lt.height,10)+parseInt(Lt.borderTopWidth,10)+parseInt(Lt.borderBottomWidth,10)===ft.offsetHeight,nn.removeChild(nt)),_e}}))})();var Oo=["Webkit","Moz","ms"],ys=k.createElement("div").style,ia={};function oa(g){return a.cssProps[g]||ia[g]||(g in ys?g:ia[g]=function(S){for(var Z=S[0].toUpperCase()+S.slice(1),te=Oo.length;te--;)if((S=Oo[te]+Z)in ys)return S}(g)||g)}var Xr=/^(none|table(?!-c[ea]).+)/,Sr={position:"absolute",visibility:"hidden",display:"block"},ns={letterSpacing:"0",fontWeight:"400"};function vs(g,S,Z){var te=qt.exec(S);return te?Math.max(0,te[2]-(Z||0))+(te[3]||"px"):S}function rs(g,S,Z,te,de,fe){var _e=S==="width"?1:0,Me=0,Se=0,Ne=0;if(Z===(te?"border":"content"))return 0;for(;_e<4;_e+=2)Z==="margin"&&(Ne+=a.css(g,Z+xn[_e],!0,de)),te?(Z==="content"&&(Se-=a.css(g,"padding"+xn[_e],!0,de)),Z!=="margin"&&(Se-=a.css(g,"border"+xn[_e]+"Width",!0,de))):(Se+=a.css(g,"padding"+xn[_e],!0,de),Z!=="padding"?Se+=a.css(g,"border"+xn[_e]+"Width",!0,de):Me+=a.css(g,"border"+xn[_e]+"Width",!0,de));return!te&&fe>=0&&(Se+=Math.max(0,Math.ceil(g["offset"+S[0].toUpperCase()+S.slice(1)]-fe-Se-Me-.5))||0),Se+Ne}function Fa(g,S,Z){var te=Po(g),de=(!R.boxSizingReliable()||Z)&&a.css(g,"boxSizing",!1,te)==="border-box",fe=de,_e=ra(g,S,te),Me="offset"+S[0].toUpperCase()+S.slice(1);if(so.test(_e)){if(!Z)return _e;_e="auto"}return(!R.boxSizingReliable()&&de||!R.reliableTrDimensions()&&y(g,"tr")||_e==="auto"||!parseFloat(_e)&&a.css(g,"display",!1,te)==="inline")&&g.getClientRects().length&&(de=a.css(g,"boxSizing",!1,te)==="border-box",(fe=Me in g)&&(_e=g[Me])),(_e=parseFloat(_e)||0)+rs(g,S,Z||(de?"border":"content"),fe,te,_e)+"px"}function Ji(g,S,Z,te,de){return new Ji.prototype.init(g,S,Z,te,de)}a.extend({cssHooks:{opacity:{get:function(g,S){if(S){var Z=ra(g,"opacity");return Z===""?"1":Z}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(g,S,Z,te){if(g&&g.nodeType!==3&&g.nodeType!==8&&g.style){var de,fe,_e,Me=mn(S),Se=Ba.test(S),Ne=g.style;if(Se||(S=oa(Me)),_e=a.cssHooks[S]||a.cssHooks[Me],Z===void 0)return _e&&"get"in _e&&(de=_e.get(g,!1,te))!==void 0?de:Ne[S];(fe=typeof Z)=="string"&&(de=qt.exec(Z))&&de[1]&&(Z=Ue(g,S,de),fe="number"),Z!=null&&Z==Z&&(fe!=="number"||Se||(Z+=de&&de[3]||(a.cssNumber[Me]?"":"px")),R.clearCloneStyle||Z!==""||S.indexOf("background")!==0||(Ne[S]="inherit"),_e&&"set"in _e&&(Z=_e.set(g,Z,te))===void 0||(Se?Ne.setProperty(S,Z):Ne[S]=Z))}},css:function(g,S,Z,te){var de,fe,_e,Me=mn(S);return Ba.test(S)||(S=oa(Me)),(_e=a.cssHooks[S]||a.cssHooks[Me])&&"get"in _e&&(de=_e.get(g,!0,Z)),de===void 0&&(de=ra(g,S,te)),de==="normal"&&S in ns&&(de=ns[S]),Z===""||Z?(fe=parseFloat(de),Z===!0||isFinite(fe)?fe||0:de):de}}),a.each(["height","width"],function(g,S){a.cssHooks[S]={get:function(Z,te,de){if(te)return!Xr.test(a.css(Z,"display"))||Z.getClientRects().length&&Z.getBoundingClientRect().width?Fa(Z,S,de):ms(Z,Sr,function(){return Fa(Z,S,de)})},set:function(Z,te,de){var fe,_e=Po(Z),Me=!R.scrollboxSize()&&_e.position==="absolute",Se=(Me||de)&&a.css(Z,"boxSizing",!1,_e)==="border-box",Ne=de?rs(Z,S,de,Se,_e):0;return Se&&Me&&(Ne-=Math.ceil(Z["offset"+S[0].toUpperCase()+S.slice(1)]-parseFloat(_e[S])-rs(Z,S,"border",!1,_e)-.5)),Ne&&(fe=qt.exec(te))&&(fe[3]||"px")!=="px"&&(Z.style[S]=te,te=a.css(Z,S)),vs(0,te,Ne)}}}),a.cssHooks.marginLeft=gs(R.reliableMarginLeft,function(g,S){if(S)return(parseFloat(ra(g,"marginLeft"))||g.getBoundingClientRect().left-ms(g,{marginLeft:0},function(){return g.getBoundingClientRect().left}))+"px"}),a.each({margin:"",padding:"",border:"Width"},function(g,S){a.cssHooks[g+S]={expand:function(Z){for(var te=0,de={},fe=typeof Z=="string"?Z.split(" "):[Z];te<4;te++)de[g+xn[te]+S]=fe[te]||fe[te-2]||fe[0];return de}},g!=="margin"&&(a.cssHooks[g+S].set=vs)}),a.fn.extend({css:function(g,S){return He(this,function(Z,te,de){var fe,_e,Me={},Se=0;if(Array.isArray(te)){for(fe=Po(Z),_e=te.length;Se<_e;Se++)Me[te[Se]]=a.css(Z,te[Se],!1,fe);return Me}return de!==void 0?a.style(Z,te,de):a.css(Z,te)},g,S,arguments.length>1)}}),a.Tween=Ji,Ji.prototype={constructor:Ji,init:function(g,S,Z,te,de,fe){this.elem=g,this.prop=Z,this.easing=de||a.easing._default,this.options=S,this.start=this.now=this.cur(),this.end=te,this.unit=fe||(a.cssNumber[Z]?"":"px")},cur:function(){var g=Ji.propHooks[this.prop];return g&&g.get?g.get(this):Ji.propHooks._default.get(this)},run:function(g){var S,Z=Ji.propHooks[this.prop];return this.options.duration?this.pos=S=a.easing[this.easing](g,this.options.duration*g,0,1,this.options.duration):this.pos=S=g,this.now=(this.end-this.start)*S+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),Z&&Z.set?Z.set(this):Ji.propHooks._default.set(this),this}},Ji.prototype.init.prototype=Ji.prototype,Ji.propHooks={_default:{get:function(g){var S;return g.elem.nodeType!==1||g.elem[g.prop]!=null&&g.elem.style[g.prop]==null?g.elem[g.prop]:(S=a.css(g.elem,g.prop,""))&&S!=="auto"?S:0},set:function(g){a.fx.step[g.prop]?a.fx.step[g.prop](g):g.elem.nodeType!==1||!a.cssHooks[g.prop]&&g.elem.style[oa(g.prop)]==null?g.elem[g.prop]=g.now:a.style(g.elem,g.prop,g.now+g.unit)}}},Ji.propHooks.scrollTop=Ji.propHooks.scrollLeft={set:function(g){g.elem.nodeType&&g.elem.parentNode&&(g.elem[g.prop]=g.now)}},a.easing={linear:function(g){return g},swing:function(g){return .5-Math.cos(g*Math.PI)/2},_default:"swing"},a.fx=Ji.prototype.init,a.fx.step={};var jr,K,Ce=/^(?:toggle|show|hide)$/,ce=/queueHooks$/;function Te(){K&&(k.hidden===!1&&o.requestAnimationFrame?o.requestAnimationFrame(Te):o.setTimeout(Te,a.fx.interval),a.fx.tick())}function Ze(){return o.setTimeout(function(){jr=void 0}),jr=Date.now()}function yt(g,S){var Z,te=0,de={height:g};for(S=S?1:0;te<4;te+=2-S)de["margin"+(Z=xn[te])]=de["padding"+Z]=g;return S&&(de.opacity=de.width=g),de}function Bt(g,S,Z){for(var te,de=(Xt.tweeners[S]||[]).concat(Xt.tweeners["*"]),fe=0,_e=de.length;fe<_e;fe++)if(te=de[fe].call(Z,S,g))return te}function Xt(g,S,Z){var te,de,fe=0,_e=Xt.prefilters.length,Me=a.Deferred().always(function(){delete Se.elem}),Se=function(){if(de)return!1;for(var ft=jr||Ze(),ut=Math.max(0,Ne.startTime+Ne.duration-ft),Lt=1-(ut/Ne.duration||0),kn=0,Pt=Ne.tweens.length;kn<Pt;kn++)Ne.tweens[kn].run(Lt);return Me.notifyWith(g,[Ne,Lt,ut]),Lt<1&&Pt?ut:(Pt||Me.notifyWith(g,[Ne,1,0]),Me.resolveWith(g,[Ne]),!1)},Ne=Me.promise({elem:g,props:a.extend({},S),opts:a.extend(!0,{specialEasing:{},easing:a.easing._default},Z),originalProperties:S,originalOptions:Z,startTime:jr||Ze(),duration:Z.duration,tweens:[],createTween:function(ft,ut){var Lt=a.Tween(g,Ne.opts,ft,ut,Ne.opts.specialEasing[ft]||Ne.opts.easing);return Ne.tweens.push(Lt),Lt},stop:function(ft){var ut=0,Lt=ft?Ne.tweens.length:0;if(de)return this;for(de=!0;ut<Lt;ut++)Ne.tweens[ut].run(1);return ft?(Me.notifyWith(g,[Ne,1,0]),Me.resolveWith(g,[Ne,ft])):Me.rejectWith(g,[Ne,ft]),this}}),nt=Ne.props;for(function(ft,ut){var Lt,kn,Pt,Hn,Zr;for(Lt in ft)if(Pt=ut[kn=mn(Lt)],Hn=ft[Lt],Array.isArray(Hn)&&(Pt=Hn[1],Hn=ft[Lt]=Hn[0]),Lt!==kn&&(ft[kn]=Hn,delete ft[Lt]),(Zr=a.cssHooks[kn])&&"expand"in Zr)for(Lt in Hn=Zr.expand(Hn),delete ft[kn],Hn)Lt in ft||(ft[Lt]=Hn[Lt],ut[Lt]=Pt);else ut[kn]=Pt}(nt,Ne.opts.specialEasing);fe<_e;fe++)if(te=Xt.prefilters[fe].call(Ne,g,nt,Ne.opts))return _(te.stop)&&(a._queueHooks(Ne.elem,Ne.opts.queue).stop=te.stop.bind(te)),te;return a.map(nt,Bt,Ne),_(Ne.opts.start)&&Ne.opts.start.call(g,Ne),Ne.progress(Ne.opts.progress).done(Ne.opts.done,Ne.opts.complete).fail(Ne.opts.fail).always(Ne.opts.always),a.fx.timer(a.extend(Se,{elem:g,anim:Ne,queue:Ne.opts.queue})),Ne}a.Animation=a.extend(Xt,{tweeners:{"*":[function(g,S){var Z=this.createTween(g,S);return Ue(Z.elem,g,qt.exec(S),Z),Z}]},tweener:function(g,S){_(g)?(S=g,g=["*"]):g=g.match(ve);for(var Z,te=0,de=g.length;te<de;te++)Z=g[te],Xt.tweeners[Z]=Xt.tweeners[Z]||[],Xt.tweeners[Z].unshift(S)},prefilters:[function(g,S,Z){var te,de,fe,_e,Me,Se,Ne,nt,ft="width"in S||"height"in S,ut=this,Lt={},kn=g.style,Pt=g.nodeType&&ct(g),Hn=ze.get(g,"fxshow");for(te in Z.queue||((_e=a._queueHooks(g,"fx")).unqueued==null&&(_e.unqueued=0,Me=_e.empty.fire,_e.empty.fire=function(){_e.unqueued||Me()}),_e.unqueued++,ut.always(function(){ut.always(function(){_e.unqueued--,a.queue(g,"fx").length||_e.empty.fire()})})),S)if(de=S[te],Ce.test(de)){if(delete S[te],fe=fe||de==="toggle",de===(Pt?"hide":"show")){if(de!=="show"||!Hn||Hn[te]===void 0)continue;Pt=!0}Lt[te]=Hn&&Hn[te]||a.style(g,te)}if((Se=!a.isEmptyObject(S))||!a.isEmptyObject(Lt))for(te in ft&&g.nodeType===1&&(Z.overflow=[kn.overflow,kn.overflowX,kn.overflowY],(Ne=Hn&&Hn.display)==null&&(Ne=ze.get(g,"display")),(nt=a.css(g,"display"))==="none"&&(Ne?nt=Ne:(Ke([g],!0),Ne=g.style.display||Ne,nt=a.css(g,"display"),Ke([g]))),(nt==="inline"||nt==="inline-block"&&Ne!=null)&&a.css(g,"float")==="none"&&(Se||(ut.done(function(){kn.display=Ne}),Ne==null&&(nt=kn.display,Ne=nt==="none"?"":nt)),kn.display="inline-block")),Z.overflow&&(kn.overflow="hidden",ut.always(function(){kn.overflow=Z.overflow[0],kn.overflowX=Z.overflow[1],kn.overflowY=Z.overflow[2]})),Se=!1,Lt)Se||(Hn?"hidden"in Hn&&(Pt=Hn.hidden):Hn=ze.access(g,"fxshow",{display:Ne}),fe&&(Hn.hidden=!Pt),Pt&&Ke([g],!0),ut.done(function(){for(te in Pt||Ke([g]),ze.remove(g,"fxshow"),Lt)a.style(g,te,Lt[te])})),Se=Bt(Pt?Hn[te]:0,te,ut),te in Hn||(Hn[te]=Se.start,Pt&&(Se.end=Se.start,Se.start=0))}],prefilter:function(g,S){S?Xt.prefilters.unshift(g):Xt.prefilters.push(g)}}),a.speed=function(g,S,Z){var te=g&&typeof g=="object"?a.extend({},g):{complete:Z||!Z&&S||_(g)&&g,duration:g,easing:Z&&S||S&&!_(S)&&S};return a.fx.off?te.duration=0:typeof te.duration!="number"&&(te.duration in a.fx.speeds?te.duration=a.fx.speeds[te.duration]:te.duration=a.fx.speeds._default),te.queue!=null&&te.queue!==!0||(te.queue="fx"),te.old=te.complete,te.complete=function(){_(te.old)&&te.old.call(this),te.queue&&a.dequeue(this,te.queue)},te},a.fn.extend({fadeTo:function(g,S,Z,te){return this.filter(ct).css("opacity",0).show().end().animate({opacity:S},g,Z,te)},animate:function(g,S,Z,te){var de=a.isEmptyObject(g),fe=a.speed(S,Z,te),_e=function(){var Me=Xt(this,a.extend({},g),fe);(de||ze.get(this,"finish"))&&Me.stop(!0)};return _e.finish=_e,de||fe.queue===!1?this.each(_e):this.queue(fe.queue,_e)},stop:function(g,S,Z){var te=function(de){var fe=de.stop;delete de.stop,fe(Z)};return typeof g!="string"&&(Z=S,S=g,g=void 0),S&&this.queue(g||"fx",[]),this.each(function(){var de=!0,fe=g!=null&&g+"queueHooks",_e=a.timers,Me=ze.get(this);if(fe)Me[fe]&&Me[fe].stop&&te(Me[fe]);else for(fe in Me)Me[fe]&&Me[fe].stop&&ce.test(fe)&&te(Me[fe]);for(fe=_e.length;fe--;)_e[fe].elem!==this||g!=null&&_e[fe].queue!==g||(_e[fe].anim.stop(Z),de=!1,_e.splice(fe,1));!de&&Z||a.dequeue(this,g)})},finish:function(g){return g!==!1&&(g=g||"fx"),this.each(function(){var S,Z=ze.get(this),te=Z[g+"queue"],de=Z[g+"queueHooks"],fe=a.timers,_e=te?te.length:0;for(Z.finish=!0,a.queue(this,g,[]),de&&de.stop&&de.stop.call(this,!0),S=fe.length;S--;)fe[S].elem===this&&fe[S].queue===g&&(fe[S].anim.stop(!0),fe.splice(S,1));for(S=0;S<_e;S++)te[S]&&te[S].finish&&te[S].finish.call(this);delete Z.finish})}}),a.each(["toggle","show","hide"],function(g,S){var Z=a.fn[S];a.fn[S]=function(te,de,fe){return te==null||typeof te=="boolean"?Z.apply(this,arguments):this.animate(yt(S,!0),te,de,fe)}}),a.each({slideDown:yt("show"),slideUp:yt("hide"),slideToggle:yt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(g,S){a.fn[g]=function(Z,te,de){return this.animate(S,Z,te,de)}}),a.timers=[],a.fx.tick=function(){var g,S=0,Z=a.timers;for(jr=Date.now();S<Z.length;S++)(g=Z[S])()||Z[S]!==g||Z.splice(S--,1);Z.length||a.fx.stop(),jr=void 0},a.fx.timer=function(g){a.timers.push(g),a.fx.start()},a.fx.interval=13,a.fx.start=function(){K||(K=!0,Te())},a.fx.stop=function(){K=null},a.fx.speeds={slow:600,fast:200,_default:400},a.fn.delay=function(g,S){return g=a.fx&&a.fx.speeds[g]||g,S=S||"fx",this.queue(S,function(Z,te){var de=o.setTimeout(Z,g);te.stop=function(){o.clearTimeout(de)}})},function(){var g=k.createElement("input"),S=k.createElement("select").appendChild(k.createElement("option"));g.type="checkbox",R.checkOn=g.value!=="",R.optSelected=S.selected,(g=k.createElement("input")).value="t",g.type="radio",R.radioValue=g.value==="t"}();var In,Gn=a.expr.attrHandle;a.fn.extend({attr:function(g,S){return He(this,a.attr,g,S,arguments.length>1)},removeAttr:function(g){return this.each(function(){a.removeAttr(this,g)})}}),a.extend({attr:function(g,S,Z){var te,de,fe=g.nodeType;if(fe!==3&&fe!==8&&fe!==2)return g.getAttribute===void 0?a.prop(g,S,Z):(fe===1&&a.isXMLDoc(g)||(de=a.attrHooks[S.toLowerCase()]||(a.expr.match.bool.test(S)?In:void 0)),Z!==void 0?Z===null?void a.removeAttr(g,S):de&&"set"in de&&(te=de.set(g,Z,S))!==void 0?te:(g.setAttribute(S,Z+""),Z):de&&"get"in de&&(te=de.get(g,S))!==null?te:(te=a.find.attr(g,S))==null?void 0:te)},attrHooks:{type:{set:function(g,S){if(!R.radioValue&&S==="radio"&&y(g,"input")){var Z=g.value;return g.setAttribute("type",S),Z&&(g.value=Z),S}}}},removeAttr:function(g,S){var Z,te=0,de=S&&S.match(ve);if(de&&g.nodeType===1)for(;Z=de[te++];)g.removeAttribute(Z)}}),In={set:function(g,S,Z){return S===!1?a.removeAttr(g,Z):g.setAttribute(Z,Z),Z}},a.each(a.expr.match.bool.source.match(/\w+/g),function(g,S){var Z=Gn[S]||a.find.attr;Gn[S]=function(te,de,fe){var _e,Me,Se=de.toLowerCase();return fe||(Me=Gn[Se],Gn[Se]=_e,_e=Z(te,de,fe)!=null?Se:null,Gn[Se]=Me),_e}});var ar=/^(?:input|select|textarea|button)$/i,hi=/^(?:a|area)$/i;function aa(g){return(g.match(ve)||[]).join(" ")}function Ci(g){return g.getAttribute&&g.getAttribute("class")||""}function va(g){return Array.isArray(g)?g:typeof g=="string"&&g.match(ve)||[]}a.fn.extend({prop:function(g,S){return He(this,a.prop,g,S,arguments.length>1)},removeProp:function(g){return this.each(function(){delete this[a.propFix[g]||g]})}}),a.extend({prop:function(g,S,Z){var te,de,fe=g.nodeType;if(fe!==3&&fe!==8&&fe!==2)return fe===1&&a.isXMLDoc(g)||(S=a.propFix[S]||S,de=a.propHooks[S]),Z!==void 0?de&&"set"in de&&(te=de.set(g,Z,S))!==void 0?te:g[S]=Z:de&&"get"in de&&(te=de.get(g,S))!==null?te:g[S]},propHooks:{tabIndex:{get:function(g){var S=a.find.attr(g,"tabindex");return S?parseInt(S,10):ar.test(g.nodeName)||hi.test(g.nodeName)&&g.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),R.optSelected||(a.propHooks.selected={get:function(g){var S=g.parentNode;return S&&S.parentNode&&S.parentNode.selectedIndex,null},set:function(g){var S=g.parentNode;S&&(S.selectedIndex,S.parentNode&&S.parentNode.selectedIndex)}}),a.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){a.propFix[this.toLowerCase()]=this}),a.fn.extend({addClass:function(g){var S,Z,te,de,fe,_e;return _(g)?this.each(function(Me){a(this).addClass(g.call(this,Me,Ci(this)))}):(S=va(g)).length?this.each(function(){if(te=Ci(this),Z=this.nodeType===1&&" "+aa(te)+" "){for(fe=0;fe<S.length;fe++)de=S[fe],Z.indexOf(" "+de+" ")<0&&(Z+=de+" ");_e=aa(Z),te!==_e&&this.setAttribute("class",_e)}}):this},removeClass:function(g){var S,Z,te,de,fe,_e;return _(g)?this.each(function(Me){a(this).removeClass(g.call(this,Me,Ci(this)))}):arguments.length?(S=va(g)).length?this.each(function(){if(te=Ci(this),Z=this.nodeType===1&&" "+aa(te)+" "){for(fe=0;fe<S.length;fe++)for(de=S[fe];Z.indexOf(" "+de+" ")>-1;)Z=Z.replace(" "+de+" "," ");_e=aa(Z),te!==_e&&this.setAttribute("class",_e)}}):this:this.attr("class","")},toggleClass:function(g,S){var Z,te,de,fe,_e=typeof g,Me=_e==="string"||Array.isArray(g);return _(g)?this.each(function(Se){a(this).toggleClass(g.call(this,Se,Ci(this),S),S)}):typeof S=="boolean"&&Me?S?this.addClass(g):this.removeClass(g):(Z=va(g),this.each(function(){if(Me)for(fe=a(this),de=0;de<Z.length;de++)te=Z[de],fe.hasClass(te)?fe.removeClass(te):fe.addClass(te);else g!==void 0&&_e!=="boolean"||((te=Ci(this))&&ze.set(this,"__className__",te),this.setAttribute&&this.setAttribute("class",te||g===!1?"":ze.get(this,"__className__")||""))}))},hasClass:function(g){var S,Z,te=0;for(S=" "+g+" ";Z=this[te++];)if(Z.nodeType===1&&(" "+aa(Ci(Z))+" ").indexOf(S)>-1)return!0;return!1}});var Ca=/\r/g;a.fn.extend({val:function(g){var S,Z,te,de=this[0];return arguments.length?(te=_(g),this.each(function(fe){var _e;this.nodeType===1&&((_e=te?g.call(this,fe,a(this).val()):g)==null?_e="":typeof _e=="number"?_e+="":Array.isArray(_e)&&(_e=a.map(_e,function(Me){return Me==null?"":Me+""})),(S=a.valHooks[this.type]||a.valHooks[this.nodeName.toLowerCase()])&&"set"in S&&S.set(this,_e,"value")!==void 0||(this.value=_e))})):de?(S=a.valHooks[de.type]||a.valHooks[de.nodeName.toLowerCase()])&&"get"in S&&(Z=S.get(de,"value"))!==void 0?Z:typeof(Z=de.value)=="string"?Z.replace(Ca,""):Z??"":void 0}}),a.extend({valHooks:{option:{get:function(g){var S=a.find.attr(g,"value");return S??aa(a.text(g))}},select:{get:function(g){var S,Z,te,de=g.options,fe=g.selectedIndex,_e=g.type==="select-one",Me=_e?null:[],Se=_e?fe+1:de.length;for(te=fe<0?Se:_e?fe:0;te<Se;te++)if(((Z=de[te]).selected||te===fe)&&!Z.disabled&&(!Z.parentNode.disabled||!y(Z.parentNode,"optgroup"))){if(S=a(Z).val(),_e)return S;Me.push(S)}return Me},set:function(g,S){for(var Z,te,de=g.options,fe=a.makeArray(S),_e=de.length;_e--;)((te=de[_e]).selected=a.inArray(a.valHooks.option.get(te),fe)>-1)&&(Z=!0);return Z||(g.selectedIndex=-1),fe}}}}),a.each(["radio","checkbox"],function(){a.valHooks[this]={set:function(g,S){if(Array.isArray(S))return g.checked=a.inArray(a(g).val(),S)>-1}},R.checkOn||(a.valHooks[this].get=function(g){return g.getAttribute("value")===null?"on":g.value})});var sa=o.location,Gs={guid:Date.now()},Wr=/\?/;a.parseXML=function(g){var S,Z;if(!g||typeof g!="string")return null;try{S=new o.DOMParser().parseFromString(g,"text/xml")}catch{}return Z=S&&S.getElementsByTagName("parsererror")[0],S&&!Z||a.error("Invalid XML: "+(Z?a.map(Z.childNodes,function(te){return te.textContent}).join(`
`):g)),S};var bo=/^(?:focusinfocus|focusoutblur)$/,ko=function(g){g.stopPropagation()};a.extend(a.event,{trigger:function(g,S,Z,te){var de,fe,_e,Me,Se,Ne,nt,ft,ut=[Z||k],Lt=T.call(g,"type")?g.type:g,kn=T.call(g,"namespace")?g.namespace.split("."):[];if(fe=ft=_e=Z=Z||k,Z.nodeType!==3&&Z.nodeType!==8&&!bo.test(Lt+a.event.triggered)&&(Lt.indexOf(".")>-1&&(Lt=(kn=Lt.split(".")).shift(),kn.sort()),Se=Lt.indexOf(":")<0&&"on"+Lt,(g=g[a.expando]?g:new a.Event(Lt,typeof g=="object"&&g)).isTrigger=te?2:3,g.namespace=kn.join("."),g.rnamespace=g.namespace?new RegExp("(^|\\.)"+kn.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,g.result=void 0,g.target||(g.target=Z),S=S==null?[g]:a.makeArray(S,[g]),nt=a.event.special[Lt]||{},te||!nt.trigger||nt.trigger.apply(Z,S)!==!1)){if(!te&&!nt.noBubble&&!ee(Z)){for(Me=nt.delegateType||Lt,bo.test(Me+Lt)||(fe=fe.parentNode);fe;fe=fe.parentNode)ut.push(fe),_e=fe;_e===(Z.ownerDocument||k)&&ut.push(_e.defaultView||_e.parentWindow||o)}for(de=0;(fe=ut[de++])&&!g.isPropagationStopped();)ft=fe,g.type=de>1?Me:nt.bindType||Lt,(Ne=(ze.get(fe,"events")||Object.create(null))[g.type]&&ze.get(fe,"handle"))&&Ne.apply(fe,S),(Ne=Se&&fe[Se])&&Ne.apply&&Qn(fe)&&(g.result=Ne.apply(fe,S),g.result===!1&&g.preventDefault());return g.type=Lt,te||g.isDefaultPrevented()||nt._default&&nt._default.apply(ut.pop(),S)!==!1||!Qn(Z)||Se&&_(Z[Lt])&&!ee(Z)&&((_e=Z[Se])&&(Z[Se]=null),a.event.triggered=Lt,g.isPropagationStopped()&&ft.addEventListener(Lt,ko),Z[Lt](),g.isPropagationStopped()&&ft.removeEventListener(Lt,ko),a.event.triggered=void 0,_e&&(Z[Se]=_e)),g.result}},simulate:function(g,S,Z){var te=a.extend(new a.Event,Z,{type:g,isSimulated:!0});a.event.trigger(te,null,S)}}),a.fn.extend({trigger:function(g,S){return this.each(function(){a.event.trigger(g,S,this)})},triggerHandler:function(g,S){var Z=this[0];if(Z)return a.event.trigger(g,S,Z,!0)}});var eo=/\[\]$/,Va=/\r?\n/g,xs=/^(?:submit|button|image|reset|file)$/i,vr=/^(?:input|select|textarea|keygen)/i;function zt(g,S,Z,te){var de;if(Array.isArray(S))a.each(S,function(fe,_e){Z||eo.test(g)?te(g,_e):zt(g+"["+(typeof _e=="object"&&_e!=null?fe:"")+"]",_e,Z,te)});else if(Z||C(S)!=="object")te(g,S);else for(de in S)zt(g+"["+de+"]",S[de],Z,te)}a.param=function(g,S){var Z,te=[],de=function(fe,_e){var Me=_(_e)?_e():_e;te[te.length]=encodeURIComponent(fe)+"="+encodeURIComponent(Me??"")};if(g==null)return"";if(Array.isArray(g)||g.jquery&&!a.isPlainObject(g))a.each(g,function(){de(this.name,this.value)});else for(Z in g)zt(Z,g[Z],S,de);return te.join("&")},a.fn.extend({serialize:function(){return a.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var g=a.prop(this,"elements");return g?a.makeArray(g):this}).filter(function(){var g=this.type;return this.name&&!a(this).is(":disabled")&&vr.test(this.nodeName)&&!xs.test(g)&&(this.checked||!rn.test(g))}).map(function(g,S){var Z=a(this).val();return Z==null?null:Array.isArray(Z)?a.map(Z,function(te){return{name:S.name,value:te.replace(Va,`\r
`)}}):{name:S.name,value:Z.replace(Va,`\r
`)}}).get()}});var Si=/%20/g,Ga=/#.*$/,lu=/([?&])_=[^&]*/,Yr=/^(.*?):[ \t]*([^\r\n]*)$/gm,Jr=/^(?:GET|HEAD)$/,qi=/^\/\//,zs={},Bi={},ws="*/".concat("*"),Us=k.createElement("a");function Ae(g){return function(S,Z){typeof S!="string"&&(Z=S,S="*");var te,de=0,fe=S.toLowerCase().match(ve)||[];if(_(Z))for(;te=fe[de++];)te[0]==="+"?(te=te.slice(1)||"*",(g[te]=g[te]||[]).unshift(Z)):(g[te]=g[te]||[]).push(Z)}}function Sa(g,S,Z,te){var de={},fe=g===Bi;function _e(Me){var Se;return de[Me]=!0,a.each(g[Me]||[],function(Ne,nt){var ft=nt(S,Z,te);return typeof ft!="string"||fe||de[ft]?fe?!(Se=ft):void 0:(S.dataTypes.unshift(ft),_e(ft),!1)}),Se}return _e(S.dataTypes[0])||!de["*"]&&_e("*")}function to(g,S){var Z,te,de=a.ajaxSettings.flatOptions||{};for(Z in S)S[Z]!==void 0&&((de[Z]?g:te||(te={}))[Z]=S[Z]);return te&&a.extend(!0,g,te),g}Us.href=sa.href,a.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:sa.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(sa.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ws,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":a.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(g,S){return S?to(to(g,a.ajaxSettings),S):to(a.ajaxSettings,g)},ajaxPrefilter:Ae(zs),ajaxTransport:Ae(Bi),ajax:function(g,S){typeof g=="object"&&(S=g,g=void 0),S=S||{};var Z,te,de,fe,_e,Me,Se,Ne,nt,ft,ut=a.ajaxSetup({},S),Lt=ut.context||ut,kn=ut.context&&(Lt.nodeType||Lt.jquery)?a(Lt):a.event,Pt=a.Deferred(),Hn=a.Callbacks("once memory"),Zr=ut.statusCode||{},Fr={},lo={},_o="canceled",dr={readyState:0,getResponseHeader:function(xr){var Wn;if(Se){if(!fe)for(fe={};Wn=Yr.exec(de);)fe[Wn[1].toLowerCase()+" "]=(fe[Wn[1].toLowerCase()+" "]||[]).concat(Wn[2]);Wn=fe[xr.toLowerCase()+" "]}return Wn==null?null:Wn.join(", ")},getAllResponseHeaders:function(){return Se?de:null},setRequestHeader:function(xr,Wn){return Se==null&&(xr=lo[xr.toLowerCase()]=lo[xr.toLowerCase()]||xr,Fr[xr]=Wn),this},overrideMimeType:function(xr){return Se==null&&(ut.mimeType=xr),this},statusCode:function(xr){var Wn;if(xr)if(Se)dr.always(xr[dr.status]);else for(Wn in xr)Zr[Wn]=[Zr[Wn],xr[Wn]];return this},abort:function(xr){var Wn=xr||_o;return Z&&Z.abort(Wn),To(0,Wn),this}};if(Pt.promise(dr),ut.url=((g||ut.url||sa.href)+"").replace(qi,sa.protocol+"//"),ut.type=S.method||S.type||ut.method||ut.type,ut.dataTypes=(ut.dataType||"*").toLowerCase().match(ve)||[""],ut.crossDomain==null){Me=k.createElement("a");try{Me.href=ut.url,Me.href=Me.href,ut.crossDomain=Us.protocol+"//"+Us.host!=Me.protocol+"//"+Me.host}catch{ut.crossDomain=!0}}if(ut.data&&ut.processData&&typeof ut.data!="string"&&(ut.data=a.param(ut.data,ut.traditional)),Sa(zs,ut,S,dr),Se)return dr;for(nt in(Ne=a.event&&ut.global)&&a.active++==0&&a.event.trigger("ajaxStart"),ut.type=ut.type.toUpperCase(),ut.hasContent=!Jr.test(ut.type),te=ut.url.replace(Ga,""),ut.hasContent?ut.data&&ut.processData&&(ut.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(ut.data=ut.data.replace(Si,"+")):(ft=ut.url.slice(te.length),ut.data&&(ut.processData||typeof ut.data=="string")&&(te+=(Wr.test(te)?"&":"?")+ut.data,delete ut.data),ut.cache===!1&&(te=te.replace(lu,"$1"),ft=(Wr.test(te)?"&":"?")+"_="+Gs.guid+++ft),ut.url=te+ft),ut.ifModified&&(a.lastModified[te]&&dr.setRequestHeader("If-Modified-Since",a.lastModified[te]),a.etag[te]&&dr.setRequestHeader("If-None-Match",a.etag[te])),(ut.data&&ut.hasContent&&ut.contentType!==!1||S.contentType)&&dr.setRequestHeader("Content-Type",ut.contentType),dr.setRequestHeader("Accept",ut.dataTypes[0]&&ut.accepts[ut.dataTypes[0]]?ut.accepts[ut.dataTypes[0]]+(ut.dataTypes[0]!=="*"?", "+ws+"; q=0.01":""):ut.accepts["*"]),ut.headers)dr.setRequestHeader(nt,ut.headers[nt]);if(ut.beforeSend&&(ut.beforeSend.call(Lt,dr,ut)===!1||Se))return dr.abort();if(_o="abort",Hn.add(ut.complete),dr.done(ut.success),dr.fail(ut.error),Z=Sa(Bi,ut,S,dr)){if(dr.readyState=1,Ne&&kn.trigger("ajaxSend",[dr,ut]),Se)return dr;ut.async&&ut.timeout>0&&(_e=o.setTimeout(function(){dr.abort("timeout")},ut.timeout));try{Se=!1,Z.send(Fr,To)}catch(xr){if(Se)throw xr;To(-1,xr)}}else To(-1,"No Transport");function To(xr,Wn,la,za){var co,Ua,Co,Xi,ca,Fi=Wn;Se||(Se=!0,_e&&o.clearTimeout(_e),Z=void 0,de=za||"",dr.readyState=xr>0?4:0,co=xr>=200&&xr<300||xr===304,la&&(Xi=function(Kr,$r,Oi){for(var Ho,wi,Jn,li,ni=Kr.contents,Ar=Kr.dataTypes;Ar[0]==="*";)Ar.shift(),Ho===void 0&&(Ho=Kr.mimeType||$r.getResponseHeader("Content-Type"));if(Ho){for(wi in ni)if(ni[wi]&&ni[wi].test(Ho)){Ar.unshift(wi);break}}if(Ar[0]in Oi)Jn=Ar[0];else{for(wi in Oi){if(!Ar[0]||Kr.converters[wi+" "+Ar[0]]){Jn=wi;break}li||(li=wi)}Jn=Jn||li}if(Jn)return Jn!==Ar[0]&&Ar.unshift(Jn),Oi[Jn]}(ut,dr,la)),!co&&a.inArray("script",ut.dataTypes)>-1&&a.inArray("json",ut.dataTypes)<0&&(ut.converters["text script"]=function(){}),Xi=function(Kr,$r,Oi,Ho){var wi,Jn,li,ni,Ar,So={},Ms=Kr.dataTypes.slice();if(Ms[1])for(li in Kr.converters)So[li.toLowerCase()]=Kr.converters[li];for(Jn=Ms.shift();Jn;)if(Kr.responseFields[Jn]&&(Oi[Kr.responseFields[Jn]]=$r),!Ar&&Ho&&Kr.dataFilter&&($r=Kr.dataFilter($r,Kr.dataType)),Ar=Jn,Jn=Ms.shift()){if(Jn==="*")Jn=Ar;else if(Ar!=="*"&&Ar!==Jn){if(!(li=So[Ar+" "+Jn]||So["* "+Jn])){for(wi in So)if((ni=wi.split(" "))[1]===Jn&&(li=So[Ar+" "+ni[0]]||So["* "+ni[0]])){li===!0?li=So[wi]:So[wi]!==!0&&(Jn=ni[0],Ms.unshift(ni[1]));break}}if(li!==!0)if(li&&Kr.throws)$r=li($r);else try{$r=li($r)}catch(Tl){return{state:"parsererror",error:li?Tl:"No conversion from "+Ar+" to "+Jn}}}}return{state:"success",data:$r}}(ut,Xi,dr,co),co?(ut.ifModified&&((ca=dr.getResponseHeader("Last-Modified"))&&(a.lastModified[te]=ca),(ca=dr.getResponseHeader("etag"))&&(a.etag[te]=ca)),xr===204||ut.type==="HEAD"?Fi="nocontent":xr===304?Fi="notmodified":(Fi=Xi.state,Ua=Xi.data,co=!(Co=Xi.error))):(Co=Fi,!xr&&Fi||(Fi="error",xr<0&&(xr=0))),dr.status=xr,dr.statusText=(Wn||Fi)+"",co?Pt.resolveWith(Lt,[Ua,Fi,dr]):Pt.rejectWith(Lt,[dr,Fi,Co]),dr.statusCode(Zr),Zr=void 0,Ne&&kn.trigger(co?"ajaxSuccess":"ajaxError",[dr,ut,co?Ua:Co]),Hn.fireWith(Lt,[dr,Fi]),Ne&&(kn.trigger("ajaxComplete",[dr,ut]),--a.active||a.event.trigger("ajaxStop")))}return dr},getJSON:function(g,S,Z){return a.get(g,S,Z,"json")},getScript:function(g,S){return a.get(g,void 0,S,"script")}}),a.each(["get","post"],function(g,S){a[S]=function(Z,te,de,fe){return _(te)&&(fe=fe||de,de=te,te=void 0),a.ajax(a.extend({url:Z,type:S,dataType:fe,data:te,success:de},a.isPlainObject(Z)&&Z))}}),a.ajaxPrefilter(function(g){var S;for(S in g.headers)S.toLowerCase()==="content-type"&&(g.contentType=g.headers[S]||"")}),a._evalUrl=function(g,S,Z){return a.ajax({url:g,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(te){a.globalEval(te,S,Z)}})},a.fn.extend({wrapAll:function(g){var S;return this[0]&&(_(g)&&(g=g.call(this[0])),S=a(g,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&S.insertBefore(this[0]),S.map(function(){for(var Z=this;Z.firstElementChild;)Z=Z.firstElementChild;return Z}).append(this)),this},wrapInner:function(g){return _(g)?this.each(function(S){a(this).wrapInner(g.call(this,S))}):this.each(function(){var S=a(this),Z=S.contents();Z.length?Z.wrapAll(g):S.append(g)})},wrap:function(g){var S=_(g);return this.each(function(Z){a(this).wrapAll(S?g.call(this,Z):g)})},unwrap:function(g){return this.parent(g).not("body").each(function(){a(this).replaceWith(this.childNodes)}),this}}),a.expr.pseudos.hidden=function(g){return!a.expr.pseudos.visible(g)},a.expr.pseudos.visible=function(g){return!!(g.offsetWidth||g.offsetHeight||g.getClientRects().length)},a.ajaxSettings.xhr=function(){try{return new o.XMLHttpRequest}catch{}};var cu={0:200,1223:204},bs=a.ajaxSettings.xhr();R.cors=!!bs&&"withCredentials"in bs,R.ajax=bs=!!bs,a.ajaxTransport(function(g){var S,Z;if(R.cors||bs&&!g.crossDomain)return{send:function(te,de){var fe,_e=g.xhr();if(_e.open(g.type,g.url,g.async,g.username,g.password),g.xhrFields)for(fe in g.xhrFields)_e[fe]=g.xhrFields[fe];for(fe in g.mimeType&&_e.overrideMimeType&&_e.overrideMimeType(g.mimeType),g.crossDomain||te["X-Requested-With"]||(te["X-Requested-With"]="XMLHttpRequest"),te)_e.setRequestHeader(fe,te[fe]);S=function(Me){return function(){S&&(S=Z=_e.onload=_e.onerror=_e.onabort=_e.ontimeout=_e.onreadystatechange=null,Me==="abort"?_e.abort():Me==="error"?typeof _e.status!="number"?de(0,"error"):de(_e.status,_e.statusText):de(cu[_e.status]||_e.status,_e.statusText,(_e.responseType||"text")!=="text"||typeof _e.responseText!="string"?{binary:_e.response}:{text:_e.responseText},_e.getAllResponseHeaders()))}},_e.onload=S(),Z=_e.onerror=_e.ontimeout=S("error"),_e.onabort!==void 0?_e.onabort=Z:_e.onreadystatechange=function(){_e.readyState===4&&o.setTimeout(function(){S&&Z()})},S=S("abort");try{_e.send(g.hasContent&&g.data||null)}catch(Me){if(S)throw Me}},abort:function(){S&&S()}}}),a.ajaxPrefilter(function(g){g.crossDomain&&(g.contents.script=!1)}),a.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(g){return a.globalEval(g),g}}}),a.ajaxPrefilter("script",function(g){g.cache===void 0&&(g.cache=!1),g.crossDomain&&(g.type="GET")}),a.ajaxTransport("script",function(g){var S,Z;if(g.crossDomain||g.scriptAttrs)return{send:function(te,de){S=a("<script>").attr(g.scriptAttrs||{}).prop({charset:g.scriptCharset,src:g.url}).on("load error",Z=function(fe){S.remove(),Z=null,fe&&de(fe.type==="error"?404:200,fe.type)}),k.head.appendChild(S[0])},abort:function(){Z&&Z()}}});var Da,Hs=[],Mo=/(=)\?(?=&|$)|\?\?/;a.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var g=Hs.pop()||a.expando+"_"+Gs.guid++;return this[g]=!0,g}}),a.ajaxPrefilter("json jsonp",function(g,S,Z){var te,de,fe,_e=g.jsonp!==!1&&(Mo.test(g.url)?"url":typeof g.data=="string"&&(g.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Mo.test(g.data)&&"data");if(_e||g.dataTypes[0]==="jsonp")return te=g.jsonpCallback=_(g.jsonpCallback)?g.jsonpCallback():g.jsonpCallback,_e?g[_e]=g[_e].replace(Mo,"$1"+te):g.jsonp!==!1&&(g.url+=(Wr.test(g.url)?"&":"?")+g.jsonp+"="+te),g.converters["script json"]=function(){return fe||a.error(te+" was not called"),fe[0]},g.dataTypes[0]="json",de=o[te],o[te]=function(){fe=arguments},Z.always(function(){de===void 0?a(o).removeProp(te):o[te]=de,g[te]&&(g.jsonpCallback=S.jsonpCallback,Hs.push(te)),fe&&_(de)&&de(fe[0]),fe=de=void 0}),"script"}),R.createHTMLDocument=((Da=k.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",Da.childNodes.length===2),a.parseHTML=function(g,S,Z){return typeof g!="string"?[]:(typeof S=="boolean"&&(Z=S,S=!1),S||(R.createHTMLDocument?((te=(S=k.implementation.createHTMLDocument("")).createElement("base")).href=k.location.href,S.head.appendChild(te)):S=k),fe=!Z&&[],(de=ge.exec(g))?[S.createElement(de[1])]:(de=Qi([g],S,fe),fe&&fe.length&&a(fe).remove(),a.merge([],de.childNodes)));var te,de,fe},a.fn.load=function(g,S,Z){var te,de,fe,_e=this,Me=g.indexOf(" ");return Me>-1&&(te=aa(g.slice(Me)),g=g.slice(0,Me)),_(S)?(Z=S,S=void 0):S&&typeof S=="object"&&(de="POST"),_e.length>0&&a.ajax({url:g,type:de||"GET",dataType:"html",data:S}).done(function(Se){fe=arguments,_e.html(te?a("<div>").append(a.parseHTML(Se)).find(te):Se)}).always(Z&&function(Se,Ne){_e.each(function(){Z.apply(this,fe||[Se.responseText,Ne,Se])})}),this},a.expr.pseudos.animated=function(g){return a.grep(a.timers,function(S){return g===S.elem}).length},a.offset={setOffset:function(g,S,Z){var te,de,fe,_e,Me,Se,Ne=a.css(g,"position"),nt=a(g),ft={};Ne==="static"&&(g.style.position="relative"),Me=nt.offset(),fe=a.css(g,"top"),Se=a.css(g,"left"),(Ne==="absolute"||Ne==="fixed")&&(fe+Se).indexOf("auto")>-1?(_e=(te=nt.position()).top,de=te.left):(_e=parseFloat(fe)||0,de=parseFloat(Se)||0),_(S)&&(S=S.call(g,Z,a.extend({},Me))),S.top!=null&&(ft.top=S.top-Me.top+_e),S.left!=null&&(ft.left=S.left-Me.left+de),"using"in S?S.using.call(g,ft):nt.css(ft)}},a.fn.extend({offset:function(g){if(arguments.length)return g===void 0?this:this.each(function(de){a.offset.setOffset(this,g,de)});var S,Z,te=this[0];return te?te.getClientRects().length?(S=te.getBoundingClientRect(),Z=te.ownerDocument.defaultView,{top:S.top+Z.pageYOffset,left:S.left+Z.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var g,S,Z,te=this[0],de={top:0,left:0};if(a.css(te,"position")==="fixed")S=te.getBoundingClientRect();else{for(S=this.offset(),Z=te.ownerDocument,g=te.offsetParent||Z.documentElement;g&&(g===Z.body||g===Z.documentElement)&&a.css(g,"position")==="static";)g=g.parentNode;g&&g!==te&&g.nodeType===1&&((de=a(g).offset()).top+=a.css(g,"borderTopWidth",!0),de.left+=a.css(g,"borderLeftWidth",!0))}return{top:S.top-de.top-a.css(te,"marginTop",!0),left:S.left-de.left-a.css(te,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var g=this.offsetParent;g&&a.css(g,"position")==="static";)g=g.offsetParent;return g||nn})}}),a.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(g,S){var Z=S==="pageYOffset";a.fn[g]=function(te){return He(this,function(de,fe,_e){var Me;if(ee(de)?Me=de:de.nodeType===9&&(Me=de.defaultView),_e===void 0)return Me?Me[S]:de[fe];Me?Me.scrollTo(Z?Me.pageXOffset:_e,Z?_e:Me.pageYOffset):de[fe]=_e},g,te,arguments.length)}}),a.each(["top","left"],function(g,S){a.cssHooks[S]=gs(R.pixelPosition,function(Z,te){if(te)return te=ra(Z,S),so.test(te)?a(Z).position()[S]+"px":te})}),a.each({Height:"height",Width:"width"},function(g,S){a.each({padding:"inner"+g,content:S,"":"outer"+g},function(Z,te){a.fn[te]=function(de,fe){var _e=arguments.length&&(Z||typeof de!="boolean"),Me=Z||(de===!0||fe===!0?"margin":"border");return He(this,function(Se,Ne,nt){var ft;return ee(Se)?te.indexOf("outer")===0?Se["inner"+g]:Se.document.documentElement["client"+g]:Se.nodeType===9?(ft=Se.documentElement,Math.max(Se.body["scroll"+g],ft["scroll"+g],Se.body["offset"+g],ft["offset"+g],ft["client"+g])):nt===void 0?a.css(Se,Ne,Me):a.style(Se,Ne,nt,Me)},S,_e?de:void 0,_e)}})}),a.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(g,S){a.fn[S]=function(Z){return this.on(S,Z)}}),a.fn.extend({bind:function(g,S,Z){return this.on(g,null,S,Z)},unbind:function(g,S){return this.off(g,null,S)},delegate:function(g,S,Z,te){return this.on(S,g,Z,te)},undelegate:function(g,S,Z){return arguments.length===1?this.off(g,"**"):this.off(S,g||"**",Z)},hover:function(g,S){return this.mouseenter(g).mouseleave(S||g)}}),a.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(g,S){a.fn[S]=function(Z,te){return arguments.length>0?this.on(S,null,Z,te):this.trigger(S)}});var fr=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;a.proxy=function(g,S){var Z,te,de;if(typeof S=="string"&&(Z=g[S],S=g,g=Z),_(g))return te=L.call(arguments,2),(de=function(){return g.apply(S||this,te.concat(L.call(arguments)))}).guid=g.guid=g.guid||a.guid++,de},a.holdReady=function(g){g?a.readyWait++:a.ready(!0)},a.isArray=Array.isArray,a.parseJSON=JSON.parse,a.nodeName=y,a.isFunction=_,a.isWindow=ee,a.camelCase=mn,a.type=C,a.now=Date.now,a.isNumeric=function(g){var S=a.type(g);return(S==="number"||S==="string")&&!isNaN(g-parseFloat(g))},a.trim=function(g){return g==null?"":(g+"").replace(fr,"$1")};var _l=o.jQuery,oc=o.$;return a.noConflict=function(g){return o.$===a&&(o.$=oc),g&&o.jQuery===a&&(o.jQuery=_l),a},v===void 0&&(o.jQuery=o.$=a),a},b.exports=r.document?s(r,!0):function(o){if(!o.document)throw new Error("jQuery requires a window with a document");return s(o)}}),jquery$1=Object.freeze({__proto__:null,default:jquery,__moduleExports:jquery});function mxcadassemblyinit(){var b,r=(b=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0,typeof __filename<"u"&&(b=b||__filename),function(s){var o,v,u;s=s||{},o||(o=s!==void 0?s:{}),o.ready=new Promise(function(Ke,Ot){v=Ke,u=Ot});var w,L,U,N,D,f,P=Object.assign({},o),T=typeof window=="object",B=typeof importScripts=="function",G=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",R="";G?(R=B?xxxxx("path").dirname(R)+"/":__dirname+"/",f=()=>{D||(N=xxxxx("fs"),D=xxxxx("path"))},w=function(Ke,Ot){var $t=Be(Ke);return $t?Ot?$t:$t.toString():(f(),Ke=D.normalize(Ke),N.readFileSync(Ke,Ot?void 0:"utf8"))},U=Ke=>((Ke=w(Ke,!0)).buffer||(Ke=new Uint8Array(Ke)),Ke),L=(Ke,Ot,$t)=>{var rn=Be(Ke);rn&&Ot(rn),f(),Ke=D.normalize(Ke),N.readFile(Ke,function(hr,_r){hr?$t(hr):Ot(_r.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(Ke){throw Ke}),process.on("unhandledRejection",function(Ke){throw Ke}),o.inspect=function(){return"[Emscripten Module object]"}):(T||B)&&(B?R=self.location.href:typeof document<"u"&&document.currentScript&&(R=document.currentScript.src),b&&(R=b),R=R.indexOf("blob:")!==0?R.substr(0,R.replace(/[?#].*/,"").lastIndexOf("/")+1):"",w=Ke=>{try{var Ot=new XMLHttpRequest;return Ot.open("GET",Ke,!1),Ot.send(null),Ot.responseText}catch(hr){if(Ke=Be(Ke)){Ot=[];for(var $t=0;$t<Ke.length;$t++){var rn=Ke[$t];255<rn&&(rn&=255),Ot.push(String.fromCharCode(rn))}return Ot.join("")}throw hr}},B&&(U=Ke=>{try{var Ot=new XMLHttpRequest;return Ot.open("GET",Ke,!1),Ot.responseType="arraybuffer",Ot.send(null),new Uint8Array(Ot.response)}catch($t){if(Ke=Be(Ke))return Ke;throw $t}}),L=(Ke,Ot,$t)=>{var rn=new XMLHttpRequest;rn.open("GET",Ke,!0),rn.responseType="arraybuffer",rn.onload=()=>{if(rn.status==200||rn.status==0&&rn.response)Ot(rn.response);else{var hr=Be(Ke);hr?Ot(hr.buffer):$t()}},rn.onerror=$t,rn.send(null)}),o.print||console.log.bind(console);var _,ee=o.printErr||console.warn.bind(console);Object.assign(o,P),P=null,o.wasmBinary&&(_=o.wasmBinary),o.noExitRuntime;var k=Error,E={};_=[],typeof E!="object"&&je("no native wasm support detected");var W,C,F,M,a,h=!1,y=o.INITIAL_MEMORY||16777216;(W=o.wasmMemory?o.wasmMemory:new function(){this.buffer=new ArrayBuffer(y/65536*65536)})&&(C=W.buffer),y=C.byteLength;var j=C;C=j,o.HEAP8=F=new Int8Array(j),o.HEAP16=new Int16Array(j),o.HEAP32=a=new Int32Array(j),o.HEAPU8=M=new Uint8Array(j),o.HEAPU16=new Uint16Array(j),o.HEAPU32=new Uint32Array(j),o.HEAPF32=new Float32Array(j),o.HEAPF64=new Float64Array(j);var Y,q=[],V=[],ne=[];function ie(){var Ke=o.preRun.shift();q.unshift(Ke)}var he=0,be=null;function je(Ke){throw o.onAbort&&o.onAbort(Ke),ee(Ke="Aborted("+Ke+")"),h=!0,Ke=new k(Ke+". Build with -s ASSERTIONS=1 for more info."),u(Ke),Ke}o.preloadedImages={},o.preloadedAudios={};var xe,Fe="data:application/octet-stream;base64,";if(!(xe="mxcadassembly_min.wasm").startsWith(Fe)){var J=xe;xe=o.locateFile?o.locateFile(J,R):R+J}function ge(){var Ke=xe;try{if(Ke==xe&&_)return new Uint8Array(_);var Ot=Be(Ke);if(Ot)return Ot;if(U)return U(Ke);throw"both async and sync fetching of the wasm failed"}catch($t){je($t)}}function oe(Ke){for(;0<Ke.length;){var Ot=Ke.shift();if(typeof Ot=="function")Ot(o);else{var $t=Ot.U;typeof $t=="number"?Ot.G===void 0?Re($t)():Re($t)(Ot.G):$t(Ot.G===void 0?null:Ot.G)}}}var le=[];function Re(Ke){var Ot=le[Ke];return Ot||(Ke>=le.length&&(le.length=Ke+1),le[Ke]=Ot=Y.get(Ke)),Ot}var Ye=typeof atob=="function"?atob:function(Ke){var Ot="",$t=0;Ke=Ke.replace(/[^A-Za-z0-9\+\/=]/g,"");do{var rn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(Ke.charAt($t++)),hr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(Ke.charAt($t++)),_r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(Ke.charAt($t++)),qr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(Ke.charAt($t++));rn=rn<<2|hr>>4,hr=(15&hr)<<4|_r>>2;var Ur=(3&_r)<<6|qr;Ot+=String.fromCharCode(rn),_r!==64&&(Ot+=String.fromCharCode(hr)),qr!==64&&(Ot+=String.fromCharCode(Ur))}while($t<Ke.length);return Ot};function Be(Ke){if(Ke.startsWith(Fe)){if(Ke=Ke.slice(Fe.length),typeof G=="boolean"&&G){var Ot=Buffer.from(Ke,"base64");Ot=new Uint8Array(Ot.buffer,Ot.byteOffset,Ot.byteLength)}else try{var $t=Ye(Ke),rn=new Uint8Array($t.length);for(Ke=0;Ke<$t.length;++Ke)rn[Ke]=$t.charCodeAt(Ke);Ot=rn}catch{throw Error("Converting base64 string to bytes failed.")}return Ot}}var se={f:function(Ke){return qt(Ke+16)+16},e:function(Ke,Ot,$t){throw new function(rn){this.C=rn-16,this.P=function(hr){a[this.C+4>>2]=hr},this.M=function(hr){a[this.C+8>>2]=hr},this.N=function(){a[this.C>>2]=0},this.L=function(){F[this.C+12>>0]=0},this.O=function(){F[this.C+13>>0]=0},this.K=function(hr,_r){this.P(hr),this.M(_r),this.N(),this.L(),this.O()}}(Ke).K(Ot,$t),Ke},c:function(){je("")},d:function(Ke,Ot,$t){M.copyWithin(Ke,Ot,Ot+$t)},b:function(){je("OOM")},a:W};(function(){function Ke(hr){o.asm=hr.exports,Y=o.asm.A,V.unshift(o.asm.g),he--,o.monitorRunDependencies&&o.monitorRunDependencies(he),he==0&&be&&(hr=be,be=null,hr())}function Ot(hr){Ke(hr.instance)}function $t(hr){return function(){if(!_&&(T||B)){if(typeof fetch=="function"&&!xe.startsWith("file://"))return fetch(xe,{credentials:"same-origin"}).then(function(_r){if(!_r.ok)throw"failed to load wasm binary file at '"+xe+"'";return _r.arrayBuffer()}).catch(function(){return ge()});if(L)return new Promise(function(_r,qr){L(xe,function(Ur){_r(new Uint8Array(Ur))},qr)})}return Promise.resolve().then(function(){return ge()})}().then(function(){return{then:function(_r){_r({instance:new function(){this.exports=function(qr){for(var Ur,Gr=new Uint8Array(123),Or=25;Or>=0;--Or)Gr[48+Or]=52+Or,Gr[65+Or]=Or,Gr[97+Or]=26+Or;function Qi(Pi,si,gr){for(var Wi,H,Hr=0,Eo=si,Kn=gr.length,ao=si+(3*Kn>>2)-(gr[Kn-2]=="=")-(gr[Kn-1]=="=");Hr<Kn;Hr+=4)Wi=Gr[gr.charCodeAt(Hr+1)],H=Gr[gr.charCodeAt(Hr+2)],Pi[Eo++]=Gr[gr.charCodeAt(Hr)]<<2|Wi>>4,Eo<ao&&(Pi[Eo++]=Wi<<4|H>>2),Eo<ao&&(Pi[Eo++]=H<<6|Gr[gr.charCodeAt(Hr+3)])}return Gr[43]=62,Gr[47]=63,function(Pi){var si=Pi.a.buffer,gr=new Int8Array(si),Wi=new Int16Array(si),H=new Int32Array(si),Hr=new Uint8Array(si),Eo=new Uint32Array(si),Kn=new Float64Array(si),ao=Math.imul,Na=Pi.abort,Fs=Pi.b,es=Pi.c,fs=Pi.d,na=Pi.e,ts=Pi.f,so=5245008;function Ba(K){var Ce,ce=0,Te=0,Ze=0,yt=0,Bt=0,Xt=0,In=0,Gn=0,ar=0,hi=0;so=Ce=so-16|0;e:{t:{n:{o:{i:{l:{r:{c:{u:{s:{a:{if((K|=0)>>>0<=244){if(3&(ce=(yt=H[404])>>>(Te=(Xt=K>>>0<11?16:K+11&-8)>>>3|0)|0)){K=(Bt=H[1664+(ce=(Ze=Te+(1&(-1^ce))|0)<<3)>>2])+8|0,(0|(Te=H[Bt+8>>2]))!=(0|(ce=ce+1656|0))?(H[Te+12>>2]=ce,H[ce+8>>2]=Te):H[404]=Sr(Ze)&yt,ce=Ze<<3,H[Bt+4>>2]=3|ce,H[4+(ce=ce+Bt|0)>>2]=1|H[ce+4>>2];break e}if((hi=H[406])>>>0>=Xt>>>0)break a;if(ce){Te=K=(ce=(0-(K=(0-(K=2<<Te)|K)&ce<<Te)&K)-1|0)>>>12&16,Te|=K=(ce=ce>>>K|0)>>>5&8,Te|=K=(ce=ce>>>K|0)>>>2&4,ar=H[1664+(K=(Te=((Te|=K=(ce=ce>>>K|0)>>>1&2)|(K=(ce=ce>>>K|0)>>>1&1))+(ce>>>K|0)|0)<<3)>>2],(0|(ce=H[ar+8>>2]))!=(0|(K=K+1656|0))?(H[ce+12>>2]=K,H[K+8>>2]=ce):(yt=Sr(Te)&yt,H[404]=yt),K=ar+8|0,H[ar+4>>2]=3|Xt,Bt=(ce=Te<<3)-Xt|0,H[4+(Ze=Xt+ar|0)>>2]=1|Bt,H[ce+ar>>2]=Bt,hi&&(Te=1656+((ce=hi>>>3|0)<<3)|0,ar=H[409],(ce=1<<ce)&yt?ce=H[Te+8>>2]:(H[404]=ce|yt,ce=Te),H[Te+8>>2]=ar,H[ce+12>>2]=ar,H[ar+12>>2]=Te,H[ar+8>>2]=ce),H[409]=Ze,H[406]=Bt;break e}if(!(In=H[405]))break a;for(Te=K=(ce=(0-In&In)-1|0)>>>12&16,Te|=K=(ce=ce>>>K|0)>>>5&8,Te|=K=(ce=ce>>>K|0)>>>2&4,ce=H[1920+(((Te|=K=(ce=ce>>>K|0)>>>1&2)|(K=(ce=ce>>>K|0)>>>1&1))+(ce>>>K|0)<<2)>>2],Ze=(-8&H[ce+4>>2])-Xt|0,Te=ce;(K=H[Te+16>>2])||(K=H[Te+20>>2]);)Ze=(Bt=(Te=(-8&H[K+4>>2])-Xt|0)>>>0<Ze>>>0)?Te:Ze,ce=Bt?K:ce,Te=K;if(Gn=H[ce+24>>2],(0|(Bt=H[ce+12>>2]))!=(0|ce)){K=H[ce+8>>2],H[K+12>>2]=Bt,H[Bt+8>>2]=K;break t}if(!(K=H[(Te=ce+20|0)>>2])){if(!(K=H[ce+16>>2]))break s;Te=ce+16|0}for(;ar=Te,Bt=K,(K=H[(Te=K+20|0)>>2])||(Te=Bt+16|0,K=H[Bt+16>>2]););H[ar>>2]=0;break t}if(Xt=-1,!(K>>>0>4294967231)&&(Xt=-8&(K=K+11|0),Gn=H[405])){Ze=0-Xt|0,yt=0,Xt>>>0<256||(yt=31,Xt>>>0>16777215||(K=K>>>8|0,K<<=ar=K+1048320>>>16&8,yt=28+((K=((K<<=Te=K+520192>>>16&4)<<(ce=K+245760>>>16&2)>>>15|0)-(ce|Te|ar)|0)<<1|Xt>>>K+21&1)|0));h:{d:{if(Te=H[1920+(yt<<2)>>2])for(K=0,ce=Xt<<((0|yt)==31?0:25-(yt>>>1|0)|0);;){if(!((ar=(In=-8&H[Te+4>>2])-Xt|0)>>>0>=Ze>>>0)&&(Ze=ar,Bt=Te,(0|Xt)==(0|In))){Ze=0,K=Te;break d}if(ar=H[Te+20>>2],Te=H[16+((ce>>>29&4)+Te|0)>>2],K=ar?(0|ar)==(0|Te)?K:ar:K,ce<<=1,!Te)break}else K=0;if(!(K|Bt)){if(Bt=0,!(K=(0-(K=2<<yt)|K)&Gn))break a;Te=K=(ce=(K&0-K)-1|0)>>>12&16,Te|=K=(ce=ce>>>K|0)>>>5&8,Te|=K=(ce=ce>>>K|0)>>>2&4,K=H[1920+(((Te|=K=(ce=ce>>>K|0)>>>1&2)|(K=(ce=ce>>>K|0)>>>1&1))+(ce>>>K|0)<<2)>>2]}if(!K)break h}for(;Ze=(Te=(ce=(-8&H[K+4>>2])-Xt|0)>>>0<Ze>>>0)?ce:Ze,Bt=Te?K:Bt,K=(ce=H[K+16>>2])||H[K+20>>2];);}if(!(!Bt|H[406]-Xt>>>0<=Ze>>>0)){if(yt=H[Bt+24>>2],(0|Bt)!=(0|(ce=H[Bt+12>>2]))){K=H[Bt+8>>2],H[K+12>>2]=ce,H[ce+8>>2]=K;break n}if(!(K=H[(Te=Bt+20|0)>>2])){if(!(K=H[Bt+16>>2]))break u;Te=Bt+16|0}for(;ar=Te,ce=K,(K=H[(Te=K+20|0)>>2])||(Te=ce+16|0,K=H[ce+16>>2]););H[ar>>2]=0;break n}}}if((Te=H[406])>>>0>=Xt>>>0){Ze=H[409],(ce=Te-Xt|0)>>>0>=16?(H[406]=ce,K=Ze+Xt|0,H[409]=K,H[K+4>>2]=1|ce,H[Te+Ze>>2]=ce,H[Ze+4>>2]=3|Xt):(H[409]=0,H[406]=0,H[Ze+4>>2]=3|Te,H[4+(K=Te+Ze|0)>>2]=1|H[K+4>>2]),K=Ze+8|0;break e}if((Gn=H[407])>>>0>Xt>>>0){ce=Gn-Xt|0,H[407]=ce,K=(Te=H[410])+Xt|0,H[410]=K,H[K+4>>2]=1|ce,H[Te+4>>2]=3|Xt,K=Te+8|0;break e}if(K=0,In=Xt+47|0,H[522]?Te=H[524]:(H[525]=-1,H[526]=-1,H[523]=4096,H[524]=4096,H[522]=Ce+12&-16^1431655768,H[527]=0,H[515]=0,Te=4096),(Te=(ar=In+Te|0)&(Bt=0-Te|0))>>>0<=Xt>>>0||(Ze=H[514])&&(yt=(ce=H[512])+Te|0)>>>0>Ze>>>0|ce>>>0>=yt>>>0)break e;if(4&Hr[2060])break l;a:{h:{if(Ze=H[410])for(K=2064;;){if((ce=H[K>>2])>>>0<=Ze>>>0&Ze>>>0<ce+H[K+4>>2]>>>0)break h;if(!(K=H[K+8>>2]))break}if((0|(ce=ia(0)))==-1||(yt=Te,(K=(Ze=H[523])-1|0)&ce&&(yt=(Te-ce|0)+(K+ce&0-Ze)|0),yt>>>0<=Xt>>>0|yt>>>0>2147483646)||(Ze=H[514])&&Ze>>>0<(Bt=(K=H[512])+yt|0)>>>0|K>>>0>=Bt>>>0)break r;if((0|ce)!=(0|(K=ia(yt))))break a;break i}if((yt=Bt&ar-Gn)>>>0>2147483646)break r;if((0|(ce=ia(yt)))==(H[K>>2]+H[K+4>>2]|0))break c;K=ce}if(!((0|K)==-1|Xt+48>>>0<=yt>>>0)){if((ce=(ce=H[524])+(In-yt|0)&0-ce)>>>0>2147483646){ce=K;break i}if((0|ia(ce))!=-1){yt=ce+yt|0,ce=K;break i}ia(0-yt|0);break r}if(ce=K,(0|K)!=-1)break i;break r}Bt=0;break t}ce=0;break n}if((0|ce)!=-1)break i}H[515]=4|H[515]}if(Te>>>0>2147483646||(0|(ce=ia(Te)))==-1|(0|(K=ia(0)))==-1|K>>>0<=ce>>>0||(yt=K-ce|0)>>>0<=Xt+40>>>0)break o}K=H[512]+yt|0,H[512]=K,K>>>0>Eo[513]&&(H[513]=K);i:{l:{r:{if(In=H[410]){for(K=2064;;){if(((Ze=H[K>>2])+(Te=H[K+4>>2])|0)==(0|ce))break r;if(!(K=H[K+8>>2]))break}break l}for((K=H[408])>>>0<=ce>>>0&&K||(H[408]=ce),K=0,H[517]=yt,H[516]=ce,H[412]=-1,H[413]=H[522],H[519]=0;Te=1656+(Ze=K<<3)|0,H[Ze+1664>>2]=Te,H[Ze+1668>>2]=Te,(0|(K=K+1|0))!=32;);Te=(Ze=yt-40|0)-(K=ce+8&7?-8-ce&7:0)|0,H[407]=Te,K=K+ce|0,H[410]=K,H[K+4>>2]=1|Te,H[4+(ce+Ze|0)>>2]=40,H[411]=H[526];break i}if(!(8&Hr[K+12|0]|Ze>>>0>In>>>0|ce>>>0<=In>>>0)){H[K+4>>2]=Te+yt,Te=(K=In+8&7?-8-In&7:0)+In|0,H[410]=Te,K=(ce=H[407]+yt|0)-K|0,H[407]=K,H[Te+4>>2]=1|K,H[4+(ce+In|0)>>2]=40,H[411]=H[526];break i}}Eo[408]>ce>>>0&&(H[408]=ce),Te=ce+yt|0,K=2064;l:{r:{c:{u:{s:{a:{for(;;){if((0|Te)!=H[K>>2]){if(K=H[K+8>>2])continue;break a}break}if(!(8&Hr[K+12|0]))break s}for(K=2064;;){if((Te=H[K>>2])>>>0<=In>>>0&&(Bt=Te+H[K+4>>2]|0)>>>0>In>>>0)break u;K=H[K+8>>2]}}if(H[K>>2]=ce,H[K+4>>2]=H[K+4>>2]+yt,H[4+(ar=(ce+8&7?-8-ce&7:0)+ce|0)>>2]=3|Xt,Xt=(yt=Te+(Te+8&7?-8-Te&7:0)|0)-(Gn=Xt+ar|0)|0,(0|yt)==(0|In)){H[410]=Gn,K=H[407]+Xt|0,H[407]=K,H[Gn+4>>2]=1|K;break r}if(H[409]==(0|yt)){H[409]=Gn,K=H[406]+Xt|0,H[406]=K,H[Gn+4>>2]=1|K,H[K+Gn>>2]=K;break r}if((3&(K=H[yt+4>>2]))==1){Bt=-8&K;s:if(K>>>0<=255){if(Te=H[yt+8>>2],K=K>>>3|0,(0|(ce=H[yt+12>>2]))==(0|Te)){H[404]=H[404]&Sr(K);break s}H[Te+12>>2]=ce,H[ce+8>>2]=Te}else{if(In=H[yt+24>>2],(0|yt)==(0|(ce=H[yt+12>>2])))if((Ze=H[(K=yt+20|0)>>2])||(Ze=H[(K=yt+16|0)>>2])){for(;Te=K,(Ze=H[(K=(ce=Ze)+20|0)>>2])||(K=ce+16|0,Ze=H[ce+16>>2]););H[Te>>2]=0}else ce=0;else K=H[yt+8>>2],H[K+12>>2]=ce,H[ce+8>>2]=K;if(In){Te=H[yt+28>>2];a:{if(H[(K=1920+(Te<<2)|0)>>2]==(0|yt)){if(H[K>>2]=ce,ce)break a;H[405]=H[405]&Sr(Te);break s}if(H[In+(H[In+16>>2]==(0|yt)?16:20)>>2]=ce,!ce)break s}H[ce+24>>2]=In,(K=H[yt+16>>2])&&(H[ce+16>>2]=K,H[K+24>>2]=ce),(K=H[yt+20>>2])&&(H[ce+20>>2]=K,H[K+24>>2]=ce)}}Xt=Bt+Xt|0,yt=yt+Bt|0}if(H[yt+4>>2]=-2&H[yt+4>>2],H[Gn+4>>2]=1|Xt,H[Xt+Gn>>2]=Xt,Xt>>>0<=255){ce=1656+((K=Xt>>>3|0)<<3)|0,(Te=H[404])&(K=1<<K)?K=H[ce+8>>2]:(H[404]=K|Te,K=ce),H[ce+8>>2]=Gn,H[K+12>>2]=Gn,H[Gn+12>>2]=ce,H[Gn+8>>2]=K;break r}if(K=31,Xt>>>0<=16777215&&(K=Xt>>>8|0,K<<=Ze=K+1048320>>>16&8,K=28+((K=((K<<=Te=K+520192>>>16&4)<<(ce=K+245760>>>16&2)>>>15|0)-(ce|Te|Ze)|0)<<1|Xt>>>K+21&1)|0),H[Gn+28>>2]=K,H[Gn+16>>2]=0,H[Gn+20>>2]=0,Ze=1920+(K<<2)|0,(Te=H[405])&(ce=1<<K)){for(K=Xt<<((0|K)==31?0:25-(K>>>1|0)|0),ce=H[Ze>>2];;){if(Te=ce,(-8&H[ce+4>>2])==(0|Xt))break c;if(ce=K>>>29|0,K<<=1,!(ce=H[16+(Ze=Te+(4&ce)|0)>>2]))break}H[Ze+16>>2]=Gn,H[Gn+24>>2]=Te}else H[405]=ce|Te,H[Ze>>2]=Gn,H[Gn+24>>2]=Ze;H[Gn+12>>2]=Gn,H[Gn+8>>2]=Gn;break r}for(Te=(Ze=yt-40|0)-(K=ce+8&7?-8-ce&7:0)|0,H[407]=Te,K=K+ce|0,H[410]=K,H[K+4>>2]=1|Te,H[4+(ce+Ze|0)>>2]=40,H[411]=H[526],H[(Te=(K=(Bt+(Bt-39&7?39-Bt&7:0)|0)-47|0)>>>0<In+16>>>0?In:K)+4>>2]=27,K=H[519],H[Te+16>>2]=H[518],H[Te+20>>2]=K,K=H[517],H[Te+8>>2]=H[516],H[Te+12>>2]=K,H[518]=Te+8,H[517]=yt,H[516]=ce,H[519]=0,K=Te+24|0;H[K+4>>2]=7,ce=K+8|0,K=K+4|0,ce>>>0<Bt>>>0;);if((0|Te)==(0|In))break i;if(H[Te+4>>2]=-2&H[Te+4>>2],Bt=Te-In|0,H[In+4>>2]=1|Bt,H[Te>>2]=Bt,Bt>>>0<=255){ce=1656+((K=Bt>>>3|0)<<3)|0,(Te=H[404])&(K=1<<K)?K=H[ce+8>>2]:(H[404]=K|Te,K=ce),H[ce+8>>2]=In,H[K+12>>2]=In,H[In+12>>2]=ce,H[In+8>>2]=K;break i}if(K=31,H[In+16>>2]=0,H[In+20>>2]=0,Bt>>>0<=16777215&&(K=Bt>>>8|0,K<<=Ze=K+1048320>>>16&8,K=28+((K=((K<<=Te=K+520192>>>16&4)<<(ce=K+245760>>>16&2)>>>15|0)-(ce|Te|Ze)|0)<<1|Bt>>>K+21&1)|0),H[In+28>>2]=K,Ze=1920+(K<<2)|0,(Te=H[405])&(ce=1<<K)){for(K=Bt<<((0|K)==31?0:25-(K>>>1|0)|0),ce=H[Ze>>2];;){if(Te=ce,(0|Bt)==(-8&H[ce+4>>2]))break l;if(ce=K>>>29|0,K<<=1,!(ce=H[16+(Ze=Te+(4&ce)|0)>>2]))break}H[Ze+16>>2]=In,H[In+24>>2]=Te}else H[405]=ce|Te,H[Ze>>2]=In,H[In+24>>2]=Ze;H[In+12>>2]=In,H[In+8>>2]=In;break i}K=H[Te+8>>2],H[K+12>>2]=Gn,H[Te+8>>2]=Gn,H[Gn+24>>2]=0,H[Gn+12>>2]=Te,H[Gn+8>>2]=K}K=ar+8|0;break e}K=H[Te+8>>2],H[K+12>>2]=In,H[Te+8>>2]=In,H[In+24>>2]=0,H[In+12>>2]=Te,H[In+8>>2]=K}if(!((K=H[407])>>>0<=Xt>>>0)){ce=K-Xt|0,H[407]=ce,K=(Te=H[410])+Xt|0,H[410]=K,H[K+4>>2]=1|ce,H[Te+4>>2]=3|Xt,K=Te+8|0;break e}}H[403]=48,K=0;break e}n:if(yt){Te=H[Bt+28>>2];o:{if(H[(K=1920+(Te<<2)|0)>>2]==(0|Bt)){if(H[K>>2]=ce,ce)break o;Gn=Sr(Te)&Gn,H[405]=Gn;break n}if(H[yt+(H[yt+16>>2]==(0|Bt)?16:20)>>2]=ce,!ce)break n}H[ce+24>>2]=yt,(K=H[Bt+16>>2])&&(H[ce+16>>2]=K,H[K+24>>2]=ce),(K=H[Bt+20>>2])&&(H[ce+20>>2]=K,H[K+24>>2]=ce)}n:if(Ze>>>0<=15)K=Ze+Xt|0,H[Bt+4>>2]=3|K,H[4+(K=K+Bt|0)>>2]=1|H[K+4>>2];else if(H[Bt+4>>2]=3|Xt,H[4+(yt=Bt+Xt|0)>>2]=1|Ze,H[yt+Ze>>2]=Ze,Ze>>>0<=255)ce=1656+((K=Ze>>>3|0)<<3)|0,(Te=H[404])&(K=1<<K)?K=H[ce+8>>2]:(H[404]=K|Te,K=ce),H[ce+8>>2]=yt,H[K+12>>2]=yt,H[yt+12>>2]=ce,H[yt+8>>2]=K;else{K=31,Ze>>>0<=16777215&&(K=Ze>>>8|0,K<<=ar=K+1048320>>>16&8,K=28+((K=((K<<=Te=K+520192>>>16&4)<<(ce=K+245760>>>16&2)>>>15|0)-(ce|Te|ar)|0)<<1|Ze>>>K+21&1)|0),H[yt+28>>2]=K,H[yt+16>>2]=0,H[yt+20>>2]=0,ce=1920+(K<<2)|0;o:{if((Te=1<<K)&Gn){for(K=Ze<<((0|K)==31?0:25-(K>>>1|0)|0),Te=H[ce>>2];;){if((-8&H[(ce=Te)+4>>2])==(0|Ze))break o;if(Te=K>>>29|0,K<<=1,!(Te=H[16+(ar=(4&Te)+ce|0)>>2]))break}H[ar+16>>2]=yt}else H[405]=Te|Gn,H[ce>>2]=yt;H[yt+24>>2]=ce,H[yt+12>>2]=yt,H[yt+8>>2]=yt;break n}K=H[ce+8>>2],H[K+12>>2]=yt,H[ce+8>>2]=yt,H[yt+24>>2]=0,H[yt+12>>2]=ce,H[yt+8>>2]=K}K=Bt+8|0;break e}t:if(Gn){Te=H[ce+28>>2];n:{if(H[(K=1920+(Te<<2)|0)>>2]==(0|ce)){if(H[K>>2]=Bt,Bt)break n;H[405]=Sr(Te)&In;break t}if(H[Gn+(H[Gn+16>>2]==(0|ce)?16:20)>>2]=Bt,!Bt)break t}H[Bt+24>>2]=Gn,(K=H[ce+16>>2])&&(H[Bt+16>>2]=K,H[K+24>>2]=Bt),(K=H[ce+20>>2])&&(H[Bt+20>>2]=K,H[K+24>>2]=Bt)}Ze>>>0<=15?(K=Ze+Xt|0,H[ce+4>>2]=3|K,H[4+(K=K+ce|0)>>2]=1|H[K+4>>2]):(H[ce+4>>2]=3|Xt,H[4+(Bt=ce+Xt|0)>>2]=1|Ze,H[Ze+Bt>>2]=Ze,hi&&(Te=1656+((K=hi>>>3|0)<<3)|0,ar=H[409],(K=1<<K)&yt?K=H[Te+8>>2]:(H[404]=K|yt,K=Te),H[Te+8>>2]=ar,H[K+12>>2]=ar,H[ar+12>>2]=Te,H[ar+8>>2]=K),H[409]=Bt,H[406]=Ze),K=ce+8|0}return so=Ce+16|0,0|K}function Po(K){var Ce=0,ce=0,Te=0,Ze=0,yt=0,Bt=0,Xt=0;e:if(K){yt=(Te=K-8|0)+(K=-8&(Ce=H[K-4>>2]))|0;t:if(!(1&Ce)){if(!(3&Ce)||(Te=Te-(Ce=H[Te>>2])|0)>>>0<Eo[408])break e;if(K=K+Ce|0,H[409]==(0|Te)){if((3&(Ce=H[yt+4>>2]))==3)return H[406]=K,H[yt+4>>2]=-2&Ce,H[Te+4>>2]=1|K,void(H[K+Te>>2]=K)}else{if(Ce>>>0<=255){if(Ze=H[Te+8>>2],Ce=Ce>>>3|0,(0|(ce=H[Te+12>>2]))==(0|Ze)){H[404]=H[404]&Sr(Ce);break t}H[Ze+12>>2]=ce,H[ce+8>>2]=Ze;break t}if(Xt=H[Te+24>>2],(0|Te)==(0|(Ce=H[Te+12>>2])))if((ce=H[(Ze=Te+20|0)>>2])||(ce=H[(Ze=Te+16|0)>>2])){for(;Bt=Ze,(ce=H[(Ze=(Ce=ce)+20|0)>>2])||(Ze=Ce+16|0,ce=H[Ce+16>>2]););H[Bt>>2]=0}else Ce=0;else ce=H[Te+8>>2],H[ce+12>>2]=Ce,H[Ce+8>>2]=ce;if(!Xt)break t;Ze=H[Te+28>>2];n:{if(H[(ce=1920+(Ze<<2)|0)>>2]==(0|Te)){if(H[ce>>2]=Ce,Ce)break n;H[405]=H[405]&Sr(Ze);break t}if(H[Xt+(H[Xt+16>>2]==(0|Te)?16:20)>>2]=Ce,!Ce)break t}if(H[Ce+24>>2]=Xt,(ce=H[Te+16>>2])&&(H[Ce+16>>2]=ce,H[ce+24>>2]=Ce),!(ce=H[Te+20>>2]))break t;H[Ce+20>>2]=ce,H[ce+24>>2]=Ce}}if(!(Te>>>0>=yt>>>0)&&1&(Ce=H[yt+4>>2])){t:{if(!(2&Ce)){if(H[410]==(0|yt)){if(H[410]=Te,K=H[407]+K|0,H[407]=K,H[Te+4>>2]=1|K,H[409]!=(0|Te))break e;return H[406]=0,void(H[409]=0)}if(H[409]==(0|yt))return H[409]=Te,K=H[406]+K|0,H[406]=K,H[Te+4>>2]=1|K,void(H[K+Te>>2]=K);K=(-8&Ce)+K|0;n:if(Ce>>>0<=255){if(Ze=H[yt+8>>2],Ce=Ce>>>3|0,(0|(ce=H[yt+12>>2]))==(0|Ze)){H[404]=H[404]&Sr(Ce);break n}H[Ze+12>>2]=ce,H[ce+8>>2]=Ze}else{if(Xt=H[yt+24>>2],(0|yt)==(0|(Ce=H[yt+12>>2])))if((ce=H[(Ze=yt+20|0)>>2])||(ce=H[(Ze=yt+16|0)>>2])){for(;Bt=Ze,(ce=H[(Ze=(Ce=ce)+20|0)>>2])||(Ze=Ce+16|0,ce=H[Ce+16>>2]););H[Bt>>2]=0}else Ce=0;else ce=H[yt+8>>2],H[ce+12>>2]=Ce,H[Ce+8>>2]=ce;if(Xt){Ze=H[yt+28>>2];o:{if(H[(ce=1920+(Ze<<2)|0)>>2]==(0|yt)){if(H[ce>>2]=Ce,Ce)break o;H[405]=H[405]&Sr(Ze);break n}if(H[Xt+(H[Xt+16>>2]==(0|yt)?16:20)>>2]=Ce,!Ce)break n}H[Ce+24>>2]=Xt,(ce=H[yt+16>>2])&&(H[Ce+16>>2]=ce,H[ce+24>>2]=Ce),(ce=H[yt+20>>2])&&(H[Ce+20>>2]=ce,H[ce+24>>2]=Ce)}}if(H[Te+4>>2]=1|K,H[K+Te>>2]=K,H[409]!=(0|Te))break t;return void(H[406]=K)}H[yt+4>>2]=-2&Ce,H[Te+4>>2]=1|K,H[K+Te>>2]=K}if(K>>>0<=255)return Ce=1656+((K=K>>>3|0)<<3)|0,(ce=H[404])&(K=1<<K)?K=H[Ce+8>>2]:(H[404]=K|ce,K=Ce),H[Ce+8>>2]=Te,H[K+12>>2]=Te,H[Te+12>>2]=Ce,void(H[Te+8>>2]=K);Ze=31,H[Te+16>>2]=0,H[Te+20>>2]=0,K>>>0<=16777215&&(Ce=K>>>8|0,Ce<<=Bt=Ce+1048320>>>16&8,Ze=28+((Ce=((Ce<<=Ze=Ce+520192>>>16&4)<<(ce=Ce+245760>>>16&2)>>>15|0)-(ce|Ze|Bt)|0)<<1|K>>>Ce+21&1)|0),H[Te+28>>2]=Ze,Bt=1920+(Ze<<2)|0;t:{n:{if((ce=H[405])&(Ce=1<<Ze)){for(Ze=K<<((0|Ze)==31?0:25-(Ze>>>1|0)|0),Ce=H[Bt>>2];;){if(ce=Ce,(-8&H[Ce+4>>2])==(0|K))break n;if(Ce=Ze>>>29|0,Ze<<=1,!(Ce=H[16+(Bt=ce+(4&Ce)|0)>>2]))break}H[Bt+16>>2]=Te,H[Te+24>>2]=ce}else H[405]=Ce|ce,H[Bt>>2]=Te,H[Te+24>>2]=Bt;H[Te+12>>2]=Te,H[Te+8>>2]=Te;break t}K=H[ce+8>>2],H[K+12>>2]=Te,H[ce+8>>2]=Te,H[Te+24>>2]=0,H[Te+12>>2]=ce,H[Te+8>>2]=K}K=H[412]-1|0,H[412]=K||-1}}}function ms(K,Ce,ce){var Te,Ze=0,yt=0;if(ce>>>0>=512)return fs(0|K,0|Ce,0|ce),K;Te=K+ce|0;e:if(3&(K^Ce))if(Te>>>0<4)ce=K;else if((Ze=Te-4|0)>>>0<K>>>0)ce=K;else for(ce=K;gr[0|ce]=Hr[0|Ce],gr[ce+1|0]=Hr[Ce+1|0],gr[ce+2|0]=Hr[Ce+2|0],gr[ce+3|0]=Hr[Ce+3|0],Ce=Ce+4|0,Ze>>>0>=(ce=ce+4|0)>>>0;);else{t:if(3&K)if(ce)for(ce=K;;){if(gr[0|ce]=Hr[0|Ce],Ce=Ce+1|0,!(3&(ce=ce+1|0)))break t;if(!(ce>>>0<Te>>>0))break}else ce=K;else ce=K;if(!((Ze=-4&Te)>>>0<64||(yt=Ze+-64|0)>>>0<ce>>>0))for(;H[ce>>2]=H[Ce>>2],H[ce+4>>2]=H[Ce+4>>2],H[ce+8>>2]=H[Ce+8>>2],H[ce+12>>2]=H[Ce+12>>2],H[ce+16>>2]=H[Ce+16>>2],H[ce+20>>2]=H[Ce+20>>2],H[ce+24>>2]=H[Ce+24>>2],H[ce+28>>2]=H[Ce+28>>2],H[ce+32>>2]=H[Ce+32>>2],H[ce+36>>2]=H[Ce+36>>2],H[ce+40>>2]=H[Ce+40>>2],H[ce+44>>2]=H[Ce+44>>2],H[ce+48>>2]=H[Ce+48>>2],H[ce+52>>2]=H[Ce+52>>2],H[ce+56>>2]=H[Ce+56>>2],H[ce+60>>2]=H[Ce+60>>2],Ce=Ce- -64|0,yt>>>0>=(ce=ce- -64|0)>>>0;);if(ce>>>0>=Ze>>>0)break e;for(;H[ce>>2]=H[Ce>>2],Ce=Ce+4|0,Ze>>>0>(ce=ce+4|0)>>>0;);}if(ce>>>0<Te>>>0)for(;gr[0|ce]=Hr[0|Ce],Ce=Ce+1|0,(0|Te)!=(0|(ce=ce+1|0)););return K}function Vs(K,Ce){var ce=0;if(Ce&&(gr[0|K]=0,gr[(ce=K+Ce|0)-1|0]=0,!(Ce>>>0<3||(gr[K+2|0]=0,gr[K+1|0]=0,gr[ce-3|0]=0,gr[ce-2|0]=0,Ce>>>0<7||(gr[K+3|0]=0,gr[ce-4|0]=0,Ce>>>0<9||(H[(K=(ce=0-K&3)+K|0)>>2]=0,H[(Ce=(ce=Ce-ce&-4)+K|0)-4>>2]=0,ce>>>0<9||(H[K+8>>2]=0,H[K+4>>2]=0,H[Ce-8>>2]=0,H[Ce-12>>2]=0,ce>>>0<25||(H[K+24>>2]=0,H[K+20>>2]=0,H[K+16>>2]=0,H[K+12>>2]=0,H[Ce-16>>2]=0,H[Ce-20>>2]=0,H[Ce-24>>2]=0,H[Ce-28>>2]=0,(Ce=(Ce=ce)-(ce=4&K|24)|0)>>>0<32))))))))for(K=K+ce|0;H[K+24>>2]=0,H[K+28>>2]=0,H[K+16>>2]=0,H[K+20>>2]=0,H[K+8>>2]=0,H[K+12>>2]=0,H[K>>2]=0,H[K+4>>2]=0,K=K+32|0,(Ce=Ce-32|0)>>>0>31;);}function ra(K){var Ce,ce=0,Te=0,Ze=0;Ce=0|ts(8),H[Ce>>2]=1348,H[Ce>>2]=1392;e:{t:{if(3&(ce=K))for(;;){if(!Hr[0|ce])break t;if(!(3&(ce=ce+1|0)))break}for(;Te=ce,ce=ce+4|0,!((-1^(Ze=H[Te>>2]))&Ze-16843009&-2139062144););if(ce=Te-K|0,!(255&Ze))break e;for(;Ze=Hr[Te+1|0],Te=ce=Te+1|0,Ze;);}ce=ce-K|0}Te=oa(ce+13|0),H[Te+8>>2]=0,H[Te+4>>2]=ce,H[Te>>2]=ce,H[Ce+4>>2]=ms(Te+12|0,K,ce+1|0),H[Ce>>2]=1440,na(0|Ce,1472,1),Na()}function gs(K,Ce,ce,Te){gr[K+53|0]=1;e:if(H[K+4>>2]==(0|ce)){gr[K+52|0]=1;t:{if(!(ce=H[K+16>>2])){if(H[K+36>>2]=1,H[K+24>>2]=Te,H[K+16>>2]=Ce,(0|Te)!=1)break e;if(H[K+48>>2]==1)break t;break e}if((0|Ce)==(0|ce)){if((0|(ce=H[K+24>>2]))==2&&(H[K+24>>2]=Te,ce=Te),H[K+48>>2]!=1)break e;if((0|ce)==1)break t;break e}H[K+36>>2]=H[K+36>>2]+1}gr[K+54|0]=1}}function Oo(K,Ce,ce){var Te=0;if(!ce)return H[K+4>>2]==H[Ce+4>>2];if((0|K)==(0|Ce))return 1;Te=H[K+4>>2],K=Hr[0|Te],ce=H[Ce+4>>2];e:if(!(!K|(0|(Ce=Hr[0|ce]))!=(0|K)))for(;;){if(Ce=Hr[ce+1|0],!(K=Hr[Te+1|0]))break e;if(ce=ce+1|0,Te=Te+1|0,(0|K)!=(0|Ce))break}return(0|K)==(0|Ce)}function ys(K,Ce,ce){var Te;if(!(Te=H[K+16>>2]))return H[K+36>>2]=1,H[K+24>>2]=ce,void(H[K+16>>2]=Ce);e:{if((0|Ce)==(0|Te)){if(H[K+24>>2]!=2)break e;return void(H[K+24>>2]=ce)}gr[K+54|0]=1,H[K+24>>2]=2,H[K+36>>2]=H[K+36>>2]+1}}function ia(K){var Ce,ce;return(K=(Ce=H[377])+(ce=K+3&-4)|0)>>>0<=Ce>>>0&&ce||K>>>0>(si.byteLength/65536|0)<<16>>>0&&!(0|Fs(0|K))?(H[403]=48,-1):(H[377]=K,Ce)}function oa(K){var Ce=0;K=K||1;e:{for(;;){if(Ce=Ba(K))break e;if(!(Ce=H[528]))break;jr[0|Ce]()}es(),Na()}return Ce}function Xr(K){var Ce,ce;return H[(K|=0)>>2]=1392,Ce=H[K+4>>2]-12|0,ce=H[Ce+8>>2]-1|0,H[Ce+8>>2]=ce,(0|ce)<0&&Po(Ce),0|K}function Sr(K){var Ce;return(-1>>>(Ce=31&K)&-2)<<Ce|(-1<<(K=0-K&31)&-2)>>>K}function ns(K){(K|=0)&&Po(K)}function vs(K){Xr(K|=0),Po(K)}function rs(K){return 0|K}function Fa(K){Po(K|=0)}function Ji(K){}Qi(Ur=Hr,1024,"dmVjdG9yAHN0ZDo6ZXhjZXB0aW9uAGFsbG9jYXRvcjxUPjo6YWxsb2NhdGUoc2l6ZV90IG4pICduJyBleGNlZWRzIG1heGltdW0gc3VwcG9ydGVkIHNpemUATjEwX19jeHhhYml2MTE2X19zaGltX3R5cGVfaW5mb0UAAOgEAABaBAAA3AUAAE4xMF9fY3h4YWJpdjExN19fY2xhc3NfdHlwZV9pbmZvRQAAAOgEAACIBAAAfAQAAAAAAACsBAAAAgAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAAAAAAMAUAAAIAAAAKAAAABAAAAAUAAAAGAAAACwAAAAwAAAANAAAATjEwX19jeHhhYml2MTIwX19zaV9jbGFzc190eXBlX2luZm9FAAAAAOgEAAAIBQAArAQAAAAAAABgBQAADgAAAA8AAAAQAAAAU3Q5ZXhjZXB0aW9uAAAAAMAEAABQBQAAAAAAAIwFAAABAAAAEQAAABIAAABTdDExbG9naWNfZXJyb3IA6AQAAHwFAABgBQAAAAAAAMAFAAABAAAAEwAAABIAAABTdDEybGVuZ3RoX2Vycm9yAAAAAOgEAACsBQAAjAUAAFN0OXR5cGVfaW5mbwAAAADABAAAzAU="),Qi(Ur,1508,"UAhQ");var jr=function(K){return K.grow=function(Ce){var ce=this.length;return this.length=this.length+Ce,ce},K.set=function(Ce,ce){this[Ce]=ce},K.get=function(Ce){return this[Ce]},K}([null,Xr,rs,Fa,Ji,Ji,function(K,Ce,ce){ce|=0;var Te,Ze=0,yt=0,Bt=0,Xt=0;if(so=Te=so+-64|0,Ze=1,!Oo(K|=0,Ce|=0,0)&&(Ze=0,Ce)){so=Ze=so+-64|0,yt=H[Ce>>2],Bt=H[yt-4>>2],Xt=H[yt-8>>2],H[Ze+20>>2]=0,H[Ze+16>>2]=1148,H[Ze+12>>2]=Ce,H[Ze+8>>2]=1196,yt=0,Vs(Ze+24|0,39),Ce=Ce+Xt|0;e:if(Oo(Bt,1196,0))H[Ze+56>>2]=1,jr[H[H[Bt>>2]+20>>2]](Bt,Ze+8|0,Ce,Ce,1,0),yt=H[Ze+32>>2]==1?Ce:0;else{jr[H[H[Bt>>2]+24>>2]](Bt,Ze+8|0,Ce,1,0);t:switch(H[Ze+44>>2]){case 0:yt=H[Ze+48>>2]==1&&H[Ze+36>>2]==1&&H[Ze+40>>2]==1?H[Ze+28>>2]:0;break e;case 1:break t;default:break e}H[Ze+32>>2]!=1&&H[Ze+48>>2]|H[Ze+36>>2]!=1|H[Ze+40>>2]!=1||(yt=H[Ze+24>>2])}so=Ze- -64|0,Ze=0,yt&&(Vs(4|(Ce=Te+8|0),52),H[Te+56>>2]=1,H[Te+20>>2]=-1,H[Te+16>>2]=K,H[Te+8>>2]=yt,jr[H[H[yt>>2]+28>>2]](yt,Ce,H[ce>>2],1),(0|(K=H[Te+32>>2]))==1&&(H[ce>>2]=H[Te+24>>2]),Ze=(0|K)==1)}return so=Te- -64|0,0|Ze},function(K,Ce,ce,Te,Ze,yt){ce|=0,Te|=0,Ze|=0,yt|=0,Oo(K|=0,H[8+(Ce|=0)>>2],yt)&&gs(Ce,ce,Te,Ze)},function(K,Ce,ce,Te,Ze){if(ce|=0,Te|=0,Ze|=0,Oo(K|=0,H[8+(Ce|=0)>>2],Ze))H[Ce+28>>2]==1|H[Ce+4>>2]!=(0|ce)||(H[Ce+28>>2]=Te);else e:if(Oo(K,H[Ce>>2],Ze)){if(!(H[Ce+16>>2]!=(0|ce)&H[Ce+20>>2]!=(0|ce))){if((0|Te)!=1)break e;return void(H[Ce+32>>2]=1)}H[Ce+20>>2]=ce,H[Ce+32>>2]=Te,H[Ce+40>>2]=H[Ce+40>>2]+1,H[Ce+36>>2]!=1|H[Ce+24>>2]!=2||(gr[Ce+54|0]=1),H[Ce+44>>2]=4}},function(K,Ce,ce,Te){ce|=0,Te|=0,Oo(K|=0,H[8+(Ce|=0)>>2],0)&&ys(Ce,ce,Te)},Fa,function(K,Ce,ce,Te,Ze,yt){ce|=0,Te|=0,Ze|=0,yt|=0,Oo(K|=0,H[8+(Ce|=0)>>2],yt)?gs(Ce,ce,Te,Ze):(K=H[K+8>>2],jr[H[H[K>>2]+20>>2]](K,Ce,ce,Te,Ze,yt))},function(K,Ce,ce,Te,Ze){if(ce|=0,Te|=0,Ze|=0,Oo(K|=0,H[8+(Ce|=0)>>2],Ze))H[Ce+28>>2]==1|H[Ce+4>>2]!=(0|ce)||(H[Ce+28>>2]=Te);else e:{if(Oo(K,H[Ce>>2],Ze)){if(!(H[Ce+16>>2]!=(0|ce)&H[Ce+20>>2]!=(0|ce))){if((0|Te)!=1)break e;return void(H[Ce+32>>2]=1)}H[Ce+32>>2]=Te;t:if(H[Ce+44>>2]!=4){if(Wi[Ce+52>>1]=0,K=H[K+8>>2],jr[H[H[K>>2]+20>>2]](K,Ce,ce,ce,1,Ze),Hr[Ce+53|0]){if(H[Ce+44>>2]=3,!Hr[Ce+52|0])break t;break e}H[Ce+44>>2]=4}if(H[Ce+20>>2]=ce,H[Ce+40>>2]=H[Ce+40>>2]+1,H[Ce+36>>2]!=1|H[Ce+24>>2]!=2)break e;return void(gr[Ce+54|0]=1)}K=H[K+8>>2],jr[H[H[K>>2]+24>>2]](K,Ce,ce,Te,Ze)}},function(K,Ce,ce,Te){ce|=0,Te|=0,Oo(K|=0,H[8+(Ce|=0)>>2],0)?ys(Ce,ce,Te):(K=H[K+8>>2],jr[H[H[K>>2]+28>>2]](K,Ce,ce,Te))},rs,Fa,function(K){return 1031},vs,function(K){return H[4+(K|=0)>>2]},vs]);return{g:function(){},h:ns,i:function(){var K;return K=oa(24),H[K>>2]=0,H[K+4>>2]=0,H[K+16>>2]=0,H[K+20>>2]=0,H[K+8>>2]=0,H[K+12>>2]=0,0|K},j:function(K,Ce,ce){var Te;return K=+K,Ce=+Ce,ce=+ce,Te=oa(24),Kn[Te+16>>3]=ce,Kn[Te+8>>3]=Ce,Kn[Te>>3]=K,0|Te},k:function(K,Ce){Ce|=0,Kn[(K|=0)>>3]=Kn[K>>3]+Kn[Ce>>3],Kn[K+8>>3]=Kn[K+8>>3]+Kn[Ce+8>>3],Kn[K+16>>3]=Kn[K+16>>3]+Kn[Ce+16>>3]},l:function(K,Ce){Ce|=0,Kn[(K|=0)>>3]=Kn[K>>3]-Kn[Ce>>3],Kn[K+8>>3]=Kn[K+8>>3]-Kn[Ce+8>>3],Kn[K+16>>3]=Kn[K+16>>3]-Kn[Ce+16>>3]},m:function(K){return+Kn[(K|=0)>>3]},n:function(K,Ce){Ce=+Ce,Kn[(K|=0)>>3]=Ce},o:function(K){return+Kn[8+(K|=0)>>3]},p:function(K,Ce){Ce=+Ce,Kn[8+(K|=0)>>3]=Ce},q:function(K){return+Kn[16+(K|=0)>>3]},r:function(K,Ce){Ce=+Ce,Kn[16+(K|=0)>>3]=Ce},s:ns,t:function(){var K;return K=oa(12),H[K+8>>2]=0,H[K>>2]=0,H[K+4>>2]=0,0|K},u:function(K,Ce){Ce|=0;var ce=0,Te=0,Ze=0,yt=0,Bt=0,Xt=0;e:if((0|(ce=H[4+(K|=0)>>2]))==H[K+8>>2]){t:{if((Ze=1+(ce=(0|(Xt=ce-(Te=H[K>>2])|0))/24|0)|0)>>>0<178956971){if(yt=ce<<1,Ze=ce>>>0<89478485?Ze>>>0<yt>>>0?yt:Ze:178956970){if(Ze>>>0>=178956971)break t;yt=oa(ao(Ze,24))}else yt=0;ce=yt+ao(ce,24)|0,Bt=H[Ce+4>>2],H[ce>>2]=H[Ce>>2],H[ce+4>>2]=Bt,Bt=H[Ce+20>>2],H[ce+16>>2]=H[Ce+16>>2],H[ce+20>>2]=Bt,Bt=H[Ce+12>>2],H[ce+8>>2]=H[Ce+8>>2],H[ce+12>>2]=Bt,Ce=ce+ao((0|Xt)/-24|0,24)|0,(0|Xt)>0&&ms(Ce,Te,Xt),H[K+8>>2]=yt+ao(Ze,24),H[K+4>>2]=ce+24,H[K>>2]=Ce,Te&&Po(Te);break e}ra(1024),Na()}ra(1046),Na()}else Te=H[Ce+4>>2],H[ce>>2]=H[Ce>>2],H[ce+4>>2]=Te,Te=H[Ce+20>>2],H[ce+16>>2]=H[Ce+16>>2],H[ce+20>>2]=Te,Te=H[Ce+12>>2],H[ce+8>>2]=H[Ce+8>>2],H[ce+12>>2]=Te,H[K+4>>2]=ce+24},v:function(K){var Ce=0;(K|=0)&&((Ce=H[K>>2])&&(H[K+4>>2]=Ce,Po(Ce)),Po(K))},w:function(){return 0|oa(1)},x:function(K,Ce){K|=0;var ce=0,Te=0,Ze=0,yt=0,Bt=0,Xt=0,In=0,Gn=0,ar=0,hi=0,aa=0,Ci=0;if(K=H[(Ce|=0)>>2],(Te=(0|(Ze=H[Ce+4>>2]-K|0))/24|0)>>>0>=2){if(!(Ze-24>>>0<24)){if(ce=Kn[K+8>>3],Ce=1,aa=1&(Te=Te-1|0),Bt=Kn[K>>3],Ze-48>>>0<24)Xt=ce;else for(Ci=-2&Te,Te=0,In=Bt,Gn=ce;Ze=K+ao(Ce,24)|0,yt=.5*((Bt=Kn[Ze+24>>3])-(ar=Kn[Ze>>3]))*((hi=Kn[Ze+8>>3]-ce)+((Xt=Kn[Ze+32>>3])-ce))+(.5*(ar-In)*(Gn-ce+hi)+yt),Ce=Ce+2|0,In=Bt,Gn=Xt,(0|Ci)!=(0|(Te=Te+2|0)););aa&&(K=K+ao(Ce,24)|0,yt=.5*(Kn[K>>3]-Bt)*(Xt-ce+(Kn[K+8>>3]-ce))+yt)}ce=yt<0?-yt:yt}else ce=0;return+ce},y:function(K,Ce,ce){K|=0,Ce|=0;var Te,Ze=0,yt=0,Bt=0,Xt=0,In=0,Gn=0,ar=0;if((Te=((K=H[4+(ce|=0)>>2])-(ce=H[ce>>2])|0)/24|0)>>>0>=3)for(K=Te-1|0,Ze=Kn[Ce+8>>3],ar=Kn[Ce>>3],Ce=0;Xt=ce+ao(K,24)|0,Bt=Kn[Xt+8>>3],K=Ce,Ce=ce+ao(Ce,24)|0,!(Ze<Bt&(yt=Kn[Ce+8>>3])<=Ze)&(!(Ze>=Bt)|!(Ze<yt))||ar-(In=Kn[Ce>>3])<(Ze-yt)*(Kn[Xt>>3]-In)/(Bt-yt)&&(Gn^=1),(0|Te)!=(0|(Ce=K+1|0)););return 1&Gn},z:ns,A:jr,B:Ba}}(qr)}(se)}})}}}).then(function(_r){return _r}).then(hr,function(_r){ee("failed to asynchronously prepare wasm: "+_r),je(_r)})}var rn={a:se};if(he++,o.monitorRunDependencies&&o.monitorRunDependencies(he),o.instantiateWasm)try{return o.instantiateWasm(rn,Ke)}catch(hr){return ee("Module.instantiateWasm callback failed with error: "+hr),!1}(_||typeof E.instantiateStreaming!="function"||xe.startsWith(Fe)||xe.startsWith("file://")||typeof fetch!="function"?$t(Ot):fetch(xe,{credentials:"same-origin"}).then(function(hr){return E.instantiateStreaming(hr,rn).then(Ot,function(_r){return ee("wasm streaming compile failed: "+_r),ee("falling back to ArrayBuffer instantiation"),$t(Ot)})})).catch(u)})(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.g).apply(null,arguments)};var ve,Ee=o._emscripten_bind_VoidPtr___destroy___0=function(){return(Ee=o._emscripten_bind_VoidPtr___destroy___0=o.asm.h).apply(null,arguments)},rt=o._emscripten_bind_McGePoint3d_McGePoint3d_0=function(){return(rt=o._emscripten_bind_McGePoint3d_McGePoint3d_0=o.asm.i).apply(null,arguments)},tt=o._emscripten_bind_McGePoint3d_McGePoint3d_3=function(){return(tt=o._emscripten_bind_McGePoint3d_McGePoint3d_3=o.asm.j).apply(null,arguments)},xt=o._emscripten_bind_McGePoint3d_op_add_1=function(){return(xt=o._emscripten_bind_McGePoint3d_op_add_1=o.asm.k).apply(null,arguments)},Rt=o._emscripten_bind_McGePoint3d_op_sub_1=function(){return(Rt=o._emscripten_bind_McGePoint3d_op_sub_1=o.asm.l).apply(null,arguments)},At=o._emscripten_bind_McGePoint3d_get_x_0=function(){return(At=o._emscripten_bind_McGePoint3d_get_x_0=o.asm.m).apply(null,arguments)},He=o._emscripten_bind_McGePoint3d_set_x_1=function(){return(He=o._emscripten_bind_McGePoint3d_set_x_1=o.asm.n).apply(null,arguments)},Gt=o._emscripten_bind_McGePoint3d_get_y_0=function(){return(Gt=o._emscripten_bind_McGePoint3d_get_y_0=o.asm.o).apply(null,arguments)},jt=o._emscripten_bind_McGePoint3d_set_y_1=function(){return(jt=o._emscripten_bind_McGePoint3d_set_y_1=o.asm.p).apply(null,arguments)},Tn=o._emscripten_bind_McGePoint3d_get_z_0=function(){return(Tn=o._emscripten_bind_McGePoint3d_get_z_0=o.asm.q).apply(null,arguments)},mn=o._emscripten_bind_McGePoint3d_set_z_1=function(){return(mn=o._emscripten_bind_McGePoint3d_set_z_1=o.asm.r).apply(null,arguments)},Qn=o._emscripten_bind_McGePoint3d___destroy___0=function(){return(Qn=o._emscripten_bind_McGePoint3d___destroy___0=o.asm.s).apply(null,arguments)},gt=o._emscripten_bind_McGePoint3dArray_McGePoint3dArray_0=function(){return(gt=o._emscripten_bind_McGePoint3dArray_McGePoint3dArray_0=o.asm.t).apply(null,arguments)},ze=o._emscripten_bind_McGePoint3dArray_append_1=function(){return(ze=o._emscripten_bind_McGePoint3dArray_append_1=o.asm.u).apply(null,arguments)},Zt=o._emscripten_bind_McGePoint3dArray___destroy___0=function(){return(Zt=o._emscripten_bind_McGePoint3dArray___destroy___0=o.asm.v).apply(null,arguments)},Rn=o._emscripten_bind_McGeTool_McGeTool_0=function(){return(Rn=o._emscripten_bind_McGeTool_McGeTool_0=o.asm.w).apply(null,arguments)},Xn=o._emscripten_bind_McGeTool_calcArea_1=function(){return(Xn=o._emscripten_bind_McGeTool_calcArea_1=o.asm.x).apply(null,arguments)},pt=o._emscripten_bind_McGeTool_pointInPolyline_2=function(){return(pt=o._emscripten_bind_McGeTool_pointInPolyline_2=o.asm.y).apply(null,arguments)},st=o._emscripten_bind_McGeTool___destroy___0=function(){return(st=o._emscripten_bind_McGeTool___destroy___0=o.asm.z).apply(null,arguments)},qt=o._malloc=function(){return(qt=o._malloc=o.asm.B).apply(null,arguments)};function xn(){function Ke(){if(!ve&&(ve=!0,o.calledRun=!0,!h)){if(oe(V),v(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;){var Ot=o.postRun.shift();ne.unshift(Ot)}oe(ne)}}if(!(0<he)){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)ie();oe(q),0<he||(o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),Ke()},1)):Ke())}}if(be=function Ke(){ve||xn(),ve||(be=Ke)},o.run=xn,o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);0<o.preInit.length;)o.preInit.pop()();function nn(){}function er(Ke){return(Ke||nn).F}function kr(Ke,Ot){var $t=er(Ot),rn=$t[Ke];return rn||((rn=Object.create((Ot||nn).prototype)).C=Ke,$t[Ke]=rn)}function ct(){throw"cannot construct a VoidPtr, no constructor in IDL"}function Ue(Ke,Ot,$t){Ke&&typeof Ke=="object"&&(Ke=Ke.C),Ot&&typeof Ot=="object"&&(Ot=Ot.C),$t&&typeof $t=="object"&&($t=$t.C),this.C=Ke===void 0?rt():Ot===void 0?_emscripten_bind_McGePoint3d_McGePoint3d_1(Ke):$t===void 0?_emscripten_bind_McGePoint3d_McGePoint3d_2(Ke,Ot):tt(Ke,Ot,$t),er(Ue)[this.C]=this}function lt(){this.C=gt(),er(lt)[this.C]=this}function Wt(){this.C=Rn(),er(Wt)[this.C]=this}return xn(),nn.prototype=Object.create(nn.prototype),nn.prototype.constructor=nn,nn.prototype.D=nn,nn.F={},o.WrapperObject=nn,o.getCache=er,o.wrapPointer=kr,o.castObject=function(Ke,Ot){return kr(Ke.C,Ot)},o.NULL=kr(0),o.destroy=function(Ke){if(!Ke.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";Ke.__destroy__(),delete er(Ke.D)[Ke.C]},o.compare=function(Ke,Ot){return Ke.C===Ot.C},o.getPointer=function(Ke){return Ke.C},o.getClass=function(Ke){return Ke.D},ct.prototype=Object.create(nn.prototype),ct.prototype.constructor=ct,ct.prototype.D=ct,ct.F={},o.VoidPtr=ct,ct.prototype.__destroy__=function(){Ee(this.C)},Ue.prototype=Object.create(nn.prototype),Ue.prototype.constructor=Ue,Ue.prototype.D=Ue,Ue.F={},o.McGePoint3d=Ue,Ue.prototype.op_add=function(Ke){var Ot=this.C;Ke&&typeof Ke=="object"&&(Ke=Ke.C),xt(Ot,Ke)},Ue.prototype.op_sub=function(Ke){var Ot=this.C;Ke&&typeof Ke=="object"&&(Ke=Ke.C),Rt(Ot,Ke)},Ue.prototype.get_x=Ue.prototype.H=function(){return At(this.C)},Ue.prototype.set_x=Ue.prototype.R=function(Ke){var Ot=this.C;Ke&&typeof Ke=="object"&&(Ke=Ke.C),He(Ot,Ke)},Object.defineProperty(Ue.prototype,"x",{get:Ue.prototype.H,set:Ue.prototype.R}),Ue.prototype.get_y=Ue.prototype.I=function(){return Gt(this.C)},Ue.prototype.set_y=Ue.prototype.S=function(Ke){var Ot=this.C;Ke&&typeof Ke=="object"&&(Ke=Ke.C),jt(Ot,Ke)},Object.defineProperty(Ue.prototype,"y",{get:Ue.prototype.I,set:Ue.prototype.S}),Ue.prototype.get_z=Ue.prototype.J=function(){return Tn(this.C)},Ue.prototype.set_z=Ue.prototype.T=function(Ke){var Ot=this.C;Ke&&typeof Ke=="object"&&(Ke=Ke.C),mn(Ot,Ke)},Object.defineProperty(Ue.prototype,"z",{get:Ue.prototype.J,set:Ue.prototype.T}),Ue.prototype.__destroy__=function(){Qn(this.C)},lt.prototype=Object.create(nn.prototype),lt.prototype.constructor=lt,lt.prototype.D=lt,lt.F={},o.McGePoint3dArray=lt,lt.prototype.append=lt.prototype.append=function(Ke){var Ot=this.C;Ke&&typeof Ke=="object"&&(Ke=Ke.C),ze(Ot,Ke)},lt.prototype.__destroy__=function(){Zt(this.C)},Wt.prototype=Object.create(nn.prototype),Wt.prototype.constructor=Wt,Wt.prototype.D=Wt,Wt.F={},o.McGeTool=Wt,Wt.prototype.calcArea=function(Ke){var Ot=this.C;return Ke&&typeof Ke=="object"&&(Ke=Ke.C),Xn(Ot,Ke)},Wt.prototype.pointInPolyline=function(Ke,Ot){var $t=this.C;return Ke&&typeof Ke=="object"&&(Ke=Ke.C),Ot&&typeof Ot=="object"&&(Ot=Ot.C),!!pt($t,Ke,Ot)},Wt.prototype.__destroy__=function(){st(this.C)},s.ready});return typeof exports=="object"&&typeof module=="object"?module.exports=r:typeof define=="function"&&define.amd?define([],function(){return r}):typeof exports=="object"&&(exports.mxcadassembly=r),r()}function loadMxcadAssembly(){mxcadassemblyinit().then(function(b){store.commit("setMxassembly",b)})}function _load(b){window.MxDocumentReady=void 0,window.MxUiMain=r=>{const s=r("./MxFun").MxFun;window.THREE=s.getTHREE(),store.commit("setMxFun",s),store.events.emit("MxUiMain",r),window.MxUiMain=void 0},window.MxMain=r=>(store.events.emit("MxMain",r),window.MxMain=void 0,registerMxDbEntity(),b(),0),mxfun(),loadMxcadAssembly()}async function loadCoreCode(){return new Promise(async(b,r)=>{try{if(store.state.MxFun)return console.warn("loadCoreCode  | The program has automatically called loadCoreCode without actively calling it"),void b();_load(b)}catch(s){r({code:"error",msg:s})}})}function createCanvas(b="mx-canvas"){let r=document.getElementById(b);return r||(console.warn("id:"+b+"canvas"),(r=document.createElement("canvas")).id=b),r}function createCanvasParent(b=createCanvas()){let r;return b||(b=createCanvas()),b.parentNode?r=b.parentNode:((r=document.createElement("div")).style.height="80vh",r.appendChild(b)),r}async function dynamicImport(b){let r;switch(b){case"jquery":r=await dynamicImportJquery();break;case"element-resize-event-polyfill":r=await dynamicImportResize()}return r}async function dynamicImportResize(){try{const b=await Promise.resolve().then(function(){return elementResizeEventPolyfill_umd_min$2});return b.default?b.default:b}catch(b){console.log("importelement-resize-event-polyfill",b)}}async function dynamicImportJquery(){try{const b=await Promise.resolve().then(function(){return jquery$1});return b.default?b.default:b}catch(b){console.log("importjquery",b)}}window.$=window.jQuery=jquery,_load(()=>{});var lodash=createCommonjsModule(function(b,r){(function(){var s,o="Expected a function",v="__lodash_hash_undefined__",u="__lodash_placeholder__",w=16,L=32,U=64,N=128,D=256,f=1/0,P=9007199254740991,T=NaN,B=4294967295,G=[["ary",N],["bind",1],["bindKey",2],["curry",8],["curryRight",w],["flip",512],["partial",L],["partialRight",U],["rearg",D]],R="[object Arguments]",_="[object Array]",ee="[object Boolean]",k="[object Date]",E="[object Error]",W="[object Function]",C="[object GeneratorFunction]",F="[object Map]",M="[object Number]",a="[object Object]",h="[object Promise]",y="[object RegExp]",j="[object Set]",Y="[object String]",q="[object Symbol]",V="[object WeakMap]",ne="[object ArrayBuffer]",ie="[object DataView]",he="[object Float32Array]",be="[object Float64Array]",je="[object Int8Array]",xe="[object Int16Array]",Fe="[object Int32Array]",J="[object Uint8Array]",ge="[object Uint8ClampedArray]",oe="[object Uint16Array]",le="[object Uint32Array]",Re=/\b__p \+= '';/g,Ye=/\b(__p \+=) '' \+/g,Be=/(__e\(.*?\)|\b__t\)) \+\n'';/g,se=/&(?:amp|lt|gt|quot|#39);/g,ve=/[&<>"']/g,Ee=RegExp(se.source),rt=RegExp(ve.source),tt=/<%-([\s\S]+?)%>/g,xt=/<%([\s\S]+?)%>/g,Rt=/<%=([\s\S]+?)%>/g,At=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,He=/^\w*$/,Gt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,jt=/[\\^$.*+?()[\]{}|]/g,Tn=RegExp(jt.source),mn=/^\s+/,Qn=/\s/,gt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ze=/\{\n\/\* \[wrapped with (.+)\] \*/,Zt=/,? & /,Rn=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Xn=/[()=,{}\[\]\/\s]/,pt=/\\(\\)?/g,st=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,qt=/\w*$/,xn=/^[-+]0x[0-9a-f]+$/i,nn=/^0b[01]+$/i,er=/^\[object .+?Constructor\]$/,kr=/^0o[0-7]+$/i,ct=/^(?:0|[1-9]\d*)$/,Ue=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,lt=/($^)/,Wt=/['\n\r\u2028\u2029\\]/g,Ke="\\ud800-\\udfff",Ot="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",$t="\\u2700-\\u27bf",rn="a-z\\xdf-\\xf6\\xf8-\\xff",hr="A-Z\\xc0-\\xd6\\xd8-\\xde",_r="\\ufe0e\\ufe0f",qr="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ur="["+Ke+"]",Gr="["+qr+"]",Or="["+Ot+"]",Qi="\\d+",Pi="["+$t+"]",si="["+rn+"]",gr="[^"+Ke+qr+Qi+$t+rn+hr+"]",Wi="\\ud83c[\\udffb-\\udfff]",H="[^"+Ke+"]",Hr="(?:\\ud83c[\\udde6-\\uddff]){2}",Eo="[\\ud800-\\udbff][\\udc00-\\udfff]",Kn="["+hr+"]",ao="\\u200d",Na="(?:"+si+"|"+gr+")",Fs="(?:"+Kn+"|"+gr+")",es="(?:['](?:d|ll|m|re|s|t|ve))?",fs="(?:['](?:D|LL|M|RE|S|T|VE))?",na="(?:"+Or+"|"+Wi+")?",ts="["+_r+"]?",so=ts+na+"(?:"+ao+"(?:"+[H,Hr,Eo].join("|")+")"+ts+na+")*",Ba="(?:"+[Pi,Hr,Eo].join("|")+")"+so,Po="(?:"+[H+Or+"?",Or,Hr,Eo,Ur].join("|")+")",ms=RegExp("[']","g"),Vs=RegExp(Or,"g"),ra=RegExp(Wi+"(?="+Wi+")|"+Po+so,"g"),gs=RegExp([Kn+"?"+si+"+"+es+"(?="+[Gr,Kn,"$"].join("|")+")",Fs+"+"+fs+"(?="+[Gr,Kn+Na,"$"].join("|")+")",Kn+"?"+Na+"+"+es,Kn+"+"+fs,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Qi,Ba].join("|"),"g"),Oo=RegExp("["+ao+Ke+Ot+_r+"]"),ys=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ia=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],oa=-1,Xr={};Xr[he]=Xr[be]=Xr[je]=Xr[xe]=Xr[Fe]=Xr[J]=Xr[ge]=Xr[oe]=Xr[le]=!0,Xr[R]=Xr[_]=Xr[ne]=Xr[ee]=Xr[ie]=Xr[k]=Xr[E]=Xr[W]=Xr[F]=Xr[M]=Xr[a]=Xr[y]=Xr[j]=Xr[Y]=Xr[V]=!1;var Sr={};Sr[R]=Sr[_]=Sr[ne]=Sr[ie]=Sr[ee]=Sr[k]=Sr[he]=Sr[be]=Sr[je]=Sr[xe]=Sr[Fe]=Sr[F]=Sr[M]=Sr[a]=Sr[y]=Sr[j]=Sr[Y]=Sr[q]=Sr[J]=Sr[ge]=Sr[oe]=Sr[le]=!0,Sr[E]=Sr[W]=Sr[V]=!1;var ns={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},vs=parseFloat,rs=parseInt,Fa=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,Ji=typeof self=="object"&&self&&self.Object===Object&&self,jr=Fa||Ji||Function("return this")(),K=r&&!r.nodeType&&r,Ce=K&&b&&!b.nodeType&&b,ce=Ce&&Ce.exports===K,Te=ce&&Fa.process,Ze=function(){try{return Ce&&Ce.require&&Ce.require("util").types||Te&&Te.binding&&Te.binding("util")}catch{}}(),yt=Ze&&Ze.isArrayBuffer,Bt=Ze&&Ze.isDate,Xt=Ze&&Ze.isMap,In=Ze&&Ze.isRegExp,Gn=Ze&&Ze.isSet,ar=Ze&&Ze.isTypedArray;function hi(Me,Se,Ne){switch(Ne.length){case 0:return Me.call(Se);case 1:return Me.call(Se,Ne[0]);case 2:return Me.call(Se,Ne[0],Ne[1]);case 3:return Me.call(Se,Ne[0],Ne[1],Ne[2])}return Me.apply(Se,Ne)}function aa(Me,Se,Ne,nt){for(var ft=-1,ut=Me==null?0:Me.length;++ft<ut;){var Lt=Me[ft];Se(nt,Lt,Ne(Lt),Me)}return nt}function Ci(Me,Se){for(var Ne=-1,nt=Me==null?0:Me.length;++Ne<nt&&Se(Me[Ne],Ne,Me)!==!1;);return Me}function va(Me,Se){for(var Ne=-1,nt=Me==null?0:Me.length;++Ne<nt;)if(!Se(Me[Ne],Ne,Me))return!1;return!0}function Ca(Me,Se){for(var Ne=-1,nt=Me==null?0:Me.length,ft=0,ut=[];++Ne<nt;){var Lt=Me[Ne];Se(Lt,Ne,Me)&&(ut[ft++]=Lt)}return ut}function sa(Me,Se){return!(Me==null||!Me.length)&&Si(Me,Se,0)>-1}function Gs(Me,Se,Ne){for(var nt=-1,ft=Me==null?0:Me.length;++nt<ft;)if(Ne(Se,Me[nt]))return!0;return!1}function Wr(Me,Se){for(var Ne=-1,nt=Me==null?0:Me.length,ft=Array(nt);++Ne<nt;)ft[Ne]=Se(Me[Ne],Ne,Me);return ft}function bo(Me,Se){for(var Ne=-1,nt=Se.length,ft=Me.length;++Ne<nt;)Me[ft+Ne]=Se[Ne];return Me}function ko(Me,Se,Ne,nt){var ft=-1,ut=Me==null?0:Me.length;for(nt&&ut&&(Ne=Me[++ft]);++ft<ut;)Ne=Se(Ne,Me[ft],ft,Me);return Ne}function eo(Me,Se,Ne,nt){var ft=Me==null?0:Me.length;for(nt&&ft&&(Ne=Me[--ft]);ft--;)Ne=Se(Ne,Me[ft],ft,Me);return Ne}function Va(Me,Se){for(var Ne=-1,nt=Me==null?0:Me.length;++Ne<nt;)if(Se(Me[Ne],Ne,Me))return!0;return!1}var xs=Jr("length");function vr(Me,Se,Ne){var nt;return Ne(Me,function(ft,ut,Lt){if(Se(ft,ut,Lt))return nt=ut,!1}),nt}function zt(Me,Se,Ne,nt){for(var ft=Me.length,ut=Ne+(nt?1:-1);nt?ut--:++ut<ft;)if(Se(Me[ut],ut,Me))return ut;return-1}function Si(Me,Se,Ne){return Se==Se?function(nt,ft,ut){for(var Lt=ut-1,kn=nt.length;++Lt<kn;)if(nt[Lt]===ft)return Lt;return-1}(Me,Se,Ne):zt(Me,lu,Ne)}function Ga(Me,Se,Ne,nt){for(var ft=Ne-1,ut=Me.length;++ft<ut;)if(nt(Me[ft],Se))return ft;return-1}function lu(Me){return Me!=Me}function Yr(Me,Se){var Ne=Me==null?0:Me.length;return Ne?Bi(Me,Se)/Ne:T}function Jr(Me){return function(Se){return Se==null?s:Se[Me]}}function qi(Me){return function(Se){return Me==null?s:Me[Se]}}function zs(Me,Se,Ne,nt,ft){return ft(Me,function(ut,Lt,kn){Ne=nt?(nt=!1,ut):Se(Ne,ut,Lt,kn)}),Ne}function Bi(Me,Se){for(var Ne,nt=-1,ft=Me.length;++nt<ft;){var ut=Se(Me[nt]);ut!==s&&(Ne=Ne===s?ut:Ne+ut)}return Ne}function ws(Me,Se){for(var Ne=-1,nt=Array(Me);++Ne<Me;)nt[Ne]=Se(Ne);return nt}function Us(Me){return Me&&Me.slice(0,de(Me)+1).replace(mn,"")}function Ae(Me){return function(Se){return Me(Se)}}function Sa(Me,Se){return Wr(Se,function(Ne){return Me[Ne]})}function to(Me,Se){return Me.has(Se)}function cu(Me,Se){for(var Ne=-1,nt=Me.length;++Ne<nt&&Si(Se,Me[Ne],0)>-1;);return Ne}function bs(Me,Se){for(var Ne=Me.length;Ne--&&Si(Se,Me[Ne],0)>-1;);return Ne}var Da=qi({:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"}),Hs=qi({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Mo(Me){return"\\"+ns[Me]}function fr(Me){return Oo.test(Me)}function _l(Me){var Se=-1,Ne=Array(Me.size);return Me.forEach(function(nt,ft){Ne[++Se]=[ft,nt]}),Ne}function oc(Me,Se){return function(Ne){return Me(Se(Ne))}}function g(Me,Se){for(var Ne=-1,nt=Me.length,ft=0,ut=[];++Ne<nt;){var Lt=Me[Ne];Lt!==Se&&Lt!==u||(Me[Ne]=u,ut[ft++]=Ne)}return ut}function S(Me){var Se=-1,Ne=Array(Me.size);return Me.forEach(function(nt){Ne[++Se]=nt}),Ne}function Z(Me){return fr(Me)?function(Se){for(var Ne=ra.lastIndex=0;ra.test(Se);)++Ne;return Ne}(Me):xs(Me)}function te(Me){return fr(Me)?function(Se){return Se.match(ra)||[]}(Me):function(Se){return Se.split("")}(Me)}function de(Me){for(var Se=Me.length;Se--&&Qn.test(Me.charAt(Se)););return Se}var fe=qi({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),_e=function Me(Se){var Ne,nt=(Se=Se==null?jr:_e.defaults(jr.Object(),Se,_e.pick(jr,ia))).Array,ft=Se.Date,ut=Se.Error,Lt=Se.Function,kn=Se.Math,Pt=Se.Object,Hn=Se.RegExp,Zr=Se.String,Fr=Se.TypeError,lo=nt.prototype,_o=Lt.prototype,dr=Pt.prototype,To=Se["__core-js_shared__"],xr=_o.toString,Wn=dr.hasOwnProperty,la=0,za=(Ne=/[^.]+$/.exec(To&&To.keys&&To.keys.IE_PROTO||""))?"Symbol(src)_1."+Ne:"",co=dr.toString,Ua=xr.call(Pt),Co=jr._,Xi=Hn("^"+xr.call(Wn).replace(jt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ca=ce?Se.Buffer:s,Fi=Se.Symbol,Kr=Se.Uint8Array,$r=ca?ca.allocUnsafe:s,Oi=oc(Pt.getPrototypeOf,Pt),Ho=Pt.create,wi=dr.propertyIsEnumerable,Jn=lo.splice,li=Fi?Fi.isConcatSpreadable:s,ni=Fi?Fi.iterator:s,Ar=Fi?Fi.toStringTag:s,So=function(){try{var l=Ps(Pt,"defineProperty");return l({},"",{}),l}catch{}}(),Ms=Se.clearTimeout!==jr.clearTimeout&&Se.clearTimeout,Tl=ft&&ft.now!==jr.Date.now&&ft.now,no=Se.setTimeout!==jr.setTimeout&&Se.setTimeout,uo=kn.ceil,Vi=kn.floor,_s=Pt.getOwnPropertySymbols,Wo=ca?ca.isBuffer:s,xa=Se.isFinite,Ea=lo.join,Cl=oc(Pt.keys,Pt),di=kn.max,Ai=kn.min,Ws=ft.now,Ri=Se.parseInt,Sl=kn.random,Ie=lo.reverse,at=Ps(Se,"DataView"),$e=Ps(Se,"Map"),Tt=Ps(Se,"Promise"),kt=Ps(Se,"Set"),gn=Ps(Se,"WeakMap"),yn=Ps(Pt,"create"),Ln=gn&&new gn,It={},Mr=Xa(at),Sn=Xa($e),en=Xa(Tt),Rr=Xa(kt),tr=Xa(gn),ci=Fi?Fi.prototype:s,bi=ci?ci.valueOf:s,pi=ci?ci.toString:s;function we(l){if(yi(l)&&!yr(l)&&!(l instanceof wr)){if(l instanceof Tr)return l;if(Wn.call(l,"__wrapped__"))return Ya(l)}return new Tr(l)}var Mi=function(){function l(){}return function(p){if(!gi(p))return{};if(Ho)return Ho(p);l.prototype=p;var O=new l;return l.prototype=s,O}}();function on(){}function Tr(l,p){this.__wrapped__=l,this.__actions__=[],this.__chain__=!!p,this.__index__=0,this.__values__=s}function wr(l){this.__wrapped__=l,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=B,this.__views__=[]}function Yi(l){var p=-1,O=l==null?0:l.length;for(this.clear();++p<O;){var ae=l[p];this.set(ae[0],ae[1])}}function Jo(l){var p=-1,O=l==null?0:l.length;for(this.clear();++p<O;){var ae=l[p];this.set(ae[0],ae[1])}}function Gi(l){var p=-1,O=l==null?0:l.length;for(this.clear();++p<O;){var ae=l[p];this.set(ae[0],ae[1])}}function wa(l){var p=-1,O=l==null?0:l.length;for(this.__data__=new Gi;++p<O;)this.add(l[p])}function ho(l){var p=this.__data__=new Jo(l);this.size=p.size}function qo(l,p){var O=yr(l),ae=!O&&ro(l),pe=!O&&!ae&&Ra(l),Oe=!O&&!ae&&!pe&&Yl(l),qe=O||ae||pe||Oe,it=qe?ws(l.length,Zr):[],wt=it.length;for(var mt in l)!p&&!Wn.call(l,mt)||qe&&(mt=="length"||pe&&(mt=="offset"||mt=="parent")||Oe&&(mt=="buffer"||mt=="byteLength"||mt=="byteOffset")||Ja(mt,wt))||it.push(mt);return it}function Dl(l){var p=l.length;return p?l[Dr(0,p-1)]:s}function Li(l,p,O){(O!==s&&!$o(l[p],O)||O===s&&!(p in l))&&jo(l,p,O)}function Dn(l,p,O){var ae=l[p];Wn.call(l,p)&&$o(ae,O)&&(O!==s||p in l)||jo(l,p,O)}function ac(l,p){for(var O=l.length;O--;)if($o(l[O][0],p))return O;return-1}function Js(l,p,O,ae){return Pa(l,function(pe,Oe,qe){p(ae,pe,O(pe),qe)}),ae}function uu(l,p){return l&&Ha(p,Ui(p),l)}function jo(l,p,O){p=="__proto__"&&So?So(l,p,{configurable:!0,enumerable:!0,value:O,writable:!0}):l[p]=O}function is(l,p){for(var O=-1,ae=p.length,pe=nt(ae),Oe=l==null;++O<ae;)pe[O]=Oe?s:Gu(l,p[O]);return pe}function ua(l,p,O){return l==l&&(O!==s&&(l=l<=O?l:O),p!==s&&(l=l>=p?l:p)),l}function Xo(l,p,O,ae,pe,Oe){var qe,it=1&p,wt=2&p,mt=4&p;if(O&&(qe=pe?O(l,ae,pe,Oe):O(l)),qe!==s)return qe;if(!gi(l))return l;var Nt=yr(l);if(Nt){if(qe=function(Ut){var an=Ut.length,Nn=new Ut.constructor(an);return an&&typeof Ut[0]=="string"&&Wn.call(Ut,"index")&&(Nn.index=Ut.index,Nn.input=Ut.input),Nn}(l),!it)return Ko(l,qe)}else{var Qt=Ro(l),An=Qt==W||Qt==C;if(Ra(l))return Uh(l,it);if(Qt==a||Qt==R||An&&!pe){if(qe=wt||An?{}:nd(l),!it)return wt?function(Ut,an){return Ha(Ut,Sh(Ut),an)}(l,function(Ut,an){return Ut&&Ha(an,fo(an),Ut)}(qe,l)):function(Ut,an){return Ha(Ut,Ch(Ut),an)}(l,uu(qe,l))}else{if(!Sr[Qt])return pe?l:{};qe=function(Ut,an,Nn){var wn,pr=Ut.constructor;switch(an){case ne:return yh(Ut);case ee:case k:return new pr(+Ut);case ie:return function(lr,Er){var Bn=Er?yh(lr.buffer):lr.buffer;return new lr.constructor(Bn,lr.byteOffset,lr.byteLength)}(Ut,Nn);case he:case be:case je:case xe:case Fe:case J:case ge:case oe:case le:return Hh(Ut,Nn);case F:return new pr;case M:case Y:return new pr(Ut);case y:return function(lr){var Er=new lr.constructor(lr.source,qt.exec(lr));return Er.lastIndex=lr.lastIndex,Er}(Ut);case j:return new pr;case q:return wn=Ut,bi?Pt(bi.call(wn)):{}}}(l,Qt,it)}}Oe||(Oe=new ho);var jn=Oe.get(l);if(jn)return jn;Oe.set(l,qe),Xl(l)?l.forEach(function(Ut){qe.add(Xo(Ut,p,O,Ut,l,Oe))}):Ic(l)&&l.forEach(function(Ut,an){qe.set(an,Xo(Ut,p,O,an,l,Oe))});var $n=Nt?s:(mt?wt?tl:el:wt?fo:Ui)(l);return Ci($n||l,function(Ut,an){$n&&(Ut=l[an=Ut]),Dn(qe,an,Xo(Ut,p,O,an,l,Oe))}),qe}function hu(l,p,O){var ae=O.length;if(l==null)return!ae;for(l=Pt(l);ae--;){var pe=O[ae],Oe=p[pe],qe=l[pe];if(qe===s&&!(pe in l)||!Oe(qe))return!1}return!0}function du(l,p,O){if(typeof l!="function")throw new Fr(o);return jl(function(){l.apply(s,O)},p)}function Ts(l,p,O,ae){var pe=-1,Oe=sa,qe=!0,it=l.length,wt=[],mt=p.length;if(!it)return wt;O&&(p=Wr(p,Ae(O))),ae?(Oe=Gs,qe=!1):p.length>=200&&(Oe=to,qe=!1,p=new wa(p));e:for(;++pe<it;){var Nt=l[pe],Qt=O==null?Nt:O(Nt);if(Nt=ae||Nt!==0?Nt:0,qe&&Qt==Qt){for(var An=mt;An--;)if(p[An]===Qt)continue e;wt.push(Nt)}else Oe(p,Qt,ae)||wt.push(Nt)}return wt}we.templateSettings={escape:tt,evaluate:xt,interpolate:Rt,variable:"",imports:{_:we}},we.prototype=on.prototype,we.prototype.constructor=we,Tr.prototype=Mi(on.prototype),Tr.prototype.constructor=Tr,wr.prototype=Mi(on.prototype),wr.prototype.constructor=wr,Yi.prototype.clear=function(){this.__data__=yn?yn(null):{},this.size=0},Yi.prototype.delete=function(l){var p=this.has(l)&&delete this.__data__[l];return this.size-=p?1:0,p},Yi.prototype.get=function(l){var p=this.__data__;if(yn){var O=p[l];return O===v?s:O}return Wn.call(p,l)?p[l]:s},Yi.prototype.has=function(l){var p=this.__data__;return yn?p[l]!==s:Wn.call(p,l)},Yi.prototype.set=function(l,p){var O=this.__data__;return this.size+=this.has(l)?0:1,O[l]=yn&&p===s?v:p,this},Jo.prototype.clear=function(){this.__data__=[],this.size=0},Jo.prototype.delete=function(l){var p=this.__data__,O=ac(p,l);return!(O<0||(O==p.length-1?p.pop():Jn.call(p,O,1),--this.size,0))},Jo.prototype.get=function(l){var p=this.__data__,O=ac(p,l);return O<0?s:p[O][1]},Jo.prototype.has=function(l){return ac(this.__data__,l)>-1},Jo.prototype.set=function(l,p){var O=this.__data__,ae=ac(O,l);return ae<0?(++this.size,O.push([l,p])):O[ae][1]=p,this},Gi.prototype.clear=function(){this.size=0,this.__data__={hash:new Yi,map:new($e||Jo),string:new Yi}},Gi.prototype.delete=function(l){var p=Cu(this,l).delete(l);return this.size-=p?1:0,p},Gi.prototype.get=function(l){return Cu(this,l).get(l)},Gi.prototype.has=function(l){return Cu(this,l).has(l)},Gi.prototype.set=function(l,p){var O=Cu(this,l),ae=O.size;return O.set(l,p),this.size+=O.size==ae?0:1,this},wa.prototype.add=wa.prototype.push=function(l){return this.__data__.set(l,v),this},wa.prototype.has=function(l){return this.__data__.has(l)},ho.prototype.clear=function(){this.__data__=new Jo,this.size=0},ho.prototype.delete=function(l){var p=this.__data__,O=p.delete(l);return this.size=p.size,O},ho.prototype.get=function(l){return this.__data__.get(l)},ho.prototype.has=function(l){return this.__data__.has(l)},ho.prototype.set=function(l,p){var O=this.__data__;if(O instanceof Jo){var ae=O.__data__;if(!$e||ae.length<199)return ae.push([l,p]),this.size=++O.size,this;O=this.__data__=new Gi(ae)}return O.set(l,p),this.size=O.size,this};var Pa=Xh(Oa),sc=Xh(Ol,!0);function El(l,p){var O=!0;return Pa(l,function(ae,pe,Oe){return O=!!p(ae,pe,Oe)}),O}function os(l,p,O){for(var ae=-1,pe=l.length;++ae<pe;){var Oe=l[ae],qe=p(Oe);if(qe!=null&&(it===s?qe==qe&&!fa(qe):O(qe,it)))var it=qe,wt=Oe}return wt}function qs(l,p){var O=[];return Pa(l,function(ae,pe,Oe){p(ae,pe,Oe)&&O.push(ae)}),O}function zi(l,p,O,ae,pe){var Oe=-1,qe=l.length;for(O||(O=qd),pe||(pe=[]);++Oe<qe;){var it=l[Oe];p>0&&O(it)?p>1?zi(it,p-1,O,ae,pe):bo(pe,it):ae||(pe[pe.length]=it)}return pe}var Pl=Yh(),_i=Yh(!0);function Oa(l,p){return l&&Pl(l,p,Ui)}function Ol(l,p){return l&&_i(l,p,Ui)}function pu(l,p){return Ca(p,function(O){return pa(l[O])})}function Ao(l,p){for(var O=0,ae=(p=Ds(p,l)).length;l!=null&&O<ae;)l=l[da(p[O++])];return O&&O==ae?l:s}function fu(l,p,O){var ae=p(l);return yr(l)?ae:bo(ae,O(l))}function po(l){return l==null?l===s?"[object Undefined]":"[object Null]":Ar&&Ar in Pt(l)?function(p){var O=Wn.call(p,Ar),ae=p[Ar];try{p[Ar]=s;var pe=!0}catch{}var Oe=co.call(p);return pe&&(O?p[Ar]=ae:delete p[Ar]),Oe}(l):function(p){return co.call(p)}(l)}function sr(l,p){return l>p}function ah(l,p){return l!=null&&Wn.call(l,p)}function lc(l,p){return l!=null&&p in Pt(l)}function Cs(l,p,O){for(var ae=O?Gs:sa,pe=l[0].length,Oe=l.length,qe=Oe,it=nt(Oe),wt=1/0,mt=[];qe--;){var Nt=l[qe];qe&&p&&(Nt=Wr(Nt,Ae(p))),wt=Ai(Nt.length,wt),it[qe]=!O&&(p||pe>=120&&Nt.length>=120)?new wa(qe&&Nt):s}Nt=l[0];var Qt=-1,An=it[0];e:for(;++Qt<pe&&mt.length<wt;){var jn=Nt[Qt],$n=p?p(jn):jn;if(jn=O||jn!==0?jn:0,!(An?to(An,$n):ae(mt,$n,O))){for(qe=Oe;--qe;){var Ut=it[qe];if(!(Ut?to(Ut,$n):ae(l[qe],$n,O)))continue e}An&&An.push($n),mt.push(jn)}}return mt}function Zi(l,p,O){var ae=(l=Ph(l,p=Ds(p,l)))==null?l:l[da(Vo(p))];return ae==null?s:hi(ae,l,O)}function sh(l){return yi(l)&&po(l)==R}function cc(l,p,O,ae,pe){return l===p||(l==null||p==null||!yi(l)&&!yi(p)?l!=l&&p!=p:function(Oe,qe,it,wt,mt,Nt){var Qt=yr(Oe),An=yr(qe),jn=Qt?_:Ro(Oe),$n=An?_:Ro(qe),Ut=(jn=jn==R?a:jn)==a,an=($n=$n==R?a:$n)==a,Nn=jn==$n;if(Nn&&Ra(Oe)){if(!Ra(qe))return!1;Qt=!0,Ut=!1}if(Nn&&!Ut)return Nt||(Nt=new ho),Qt||Yl(Oe)?_h(Oe,qe,it,wt,mt,Nt):function(Bn,zn,ui,ri,ji,zr,yo){switch(ui){case ie:if(Bn.byteLength!=zn.byteLength||Bn.byteOffset!=zn.byteOffset)return!1;Bn=Bn.buffer,zn=zn.buffer;case ne:return!(Bn.byteLength!=zn.byteLength||!zr(new Kr(Bn),new Kr(zn)));case ee:case k:case M:return $o(+Bn,+zn);case E:return Bn.name==zn.name&&Bn.message==zn.message;case y:case Y:return Bn==zn+"";case F:var vo=_l;case j:var xo=1&ri;if(vo||(vo=S),Bn.size!=zn.size&&!xo)return!1;var Qo=yo.get(Bn);if(Qo)return Qo==zn;ri|=2,yo.set(Bn,zn);var Vr=_h(vo(Bn),vo(zn),ri,ji,zr,yo);return yo.delete(Bn),Vr;case q:if(bi)return bi.call(Bn)==bi.call(zn)}return!1}(Oe,qe,jn,it,wt,mt,Nt);if(!(1&it)){var wn=Ut&&Wn.call(Oe,"__wrapped__"),pr=an&&Wn.call(qe,"__wrapped__");if(wn||pr){var lr=wn?Oe.value():Oe,Er=pr?qe.value():qe;return Nt||(Nt=new ho),mt(lr,Er,it,wt,Nt)}}return!!Nn&&(Nt||(Nt=new ho),function(Bn,zn,ui,ri,ji,zr){var yo=1&ui,vo=el(Bn),xo=vo.length;if(xo!=el(zn).length&&!yo)return!1;for(var Qo=xo;Qo--;){var Vr=vo[Qo];if(!(yo?Vr in zn:Wn.call(zn,Vr)))return!1}var Jc=zr.get(Bn),Ia=zr.get(zn);if(Jc&&Ia)return Jc==zn&&Ia==Bn;var yl=!0;zr.set(Bn,zn),zr.set(zn,Bn);for(var tc=yo;++Qo<xo;){var nc=Bn[Vr=vo[Qo]],vl=zn[Vr];if(ri)var xl=yo?ri(vl,nc,Vr,zn,Bn,zr):ri(nc,vl,Vr,Bn,zn,zr);if(!(xl===s?nc===vl||ji(nc,vl,ui,ri,zr):xl)){yl=!1;break}tc||(tc=Vr=="constructor")}if(yl&&!tc){var wl=Bn.constructor,bl=zn.constructor;wl==bl||!("constructor"in Bn)||!("constructor"in zn)||typeof wl=="function"&&wl instanceof wl&&typeof bl=="function"&&bl instanceof bl||(yl=!1)}return zr.delete(Bn),zr.delete(zn),yl}(Oe,qe,it,wt,mt,Nt))}(l,p,O,ae,cc,pe))}function lh(l,p,O,ae){var pe=O.length,Oe=pe,qe=!ae;if(l==null)return!Oe;for(l=Pt(l);pe--;){var it=O[pe];if(qe&&it[2]?it[1]!==l[it[0]]:!(it[0]in l))return!1}for(;++pe<Oe;){var wt=(it=O[pe])[0],mt=l[wt],Nt=it[1];if(qe&&it[2]){if(mt===s&&!(wt in l))return!1}else{var Qt=new ho;if(ae)var An=ae(mt,Nt,wt,l,p,Qt);if(!(An===s?cc(Nt,mt,3,ae,Qt):An))return!1}}return!0}function Yo(l){return!(!gi(l)||(p=l,za&&za in p))&&(pa(l)?Xi:er).test(Xa(l));var p}function Aa(l){return typeof l=="function"?l:l==null?mo:typeof l=="object"?yr(l)?Zs(l[0],l[1]):Al(l):go(l)}function Ii(l){if(!qa(l))return Cl(l);var p=[];for(var O in Pt(l))Wn.call(l,O)&&O!="constructor"&&p.push(O);return p}function Xs(l,p){return l<p}function Ys(l,p){var O=-1,ae=Do(l)?nt(l.length):[];return Pa(l,function(pe,Oe,qe){ae[++O]=p(pe,Oe,qe)}),ae}function Al(l){var p=Th(l);return p.length==1&&p[0][2]?id(p[0][0],p[0][1]):function(O){return O===l||lh(O,l,p)}}function Zs(l,p){return Dh(l)&&nl(p)?id(da(l),p):function(O){var ae=Gu(O,l);return ae===s&&ae===p?ul(O,l):cc(p,ae,3)}}function Ks(l,p,O,ae,pe){l!==p&&Pl(p,function(Oe,qe){if(pe||(pe=new ho),gi(Oe))(function(wt,mt,Nt,Qt,An,jn,$n){var Ut=Oh(wt,Nt),an=Oh(mt,Nt),Nn=$n.get(an);if(Nn)Li(wt,Nt,Nn);else{var wn=jn?jn(Ut,an,Nt+"",wt,mt,$n):s,pr=wn===s;if(pr){var lr=yr(an),Er=!lr&&Ra(an),Bn=!lr&&!Er&&Yl(an);wn=an,lr||Er||Bn?yr(Ut)?wn=Ut:mi(Ut)?wn=Ko(Ut):Er?(pr=!1,wn=Uh(an,!0)):Bn?(pr=!1,wn=Hh(an,!0)):wn=[]:ql(an)||ro(an)?(wn=Ut,ro(Ut)?wn=As(Ut):gi(Ut)&&!pa(Ut)||(wn=nd(an))):pr=!1}pr&&($n.set(an,wn),An(wn,an,Qt,jn,$n),$n.delete(an)),Li(wt,Nt,wn)}})(l,p,qe,O,Ks,ae,pe);else{var it=ae?ae(Oh(l,qe),Oe,qe+"",l,p,pe):s;it===s&&(it=Oe),Li(l,qe,it)}},fo)}function $s(l,p){var O=l.length;if(O)return Ja(p+=p<0?O:0,O)?l[p]:s}function bn(l,p,O){var ae=-1;return p=Wr(p=p.length?Wr(p,function(pe){return yr(pe)?function(Oe){return Ao(Oe,pe.length===1?pe[0]:pe)}:pe}):[mo],Ae(nr())),function(pe,Oe){var qe=pe.length;for(pe.sort(Oe);qe--;)pe[qe]=pe[qe].value;return pe}(Ys(l,function(pe,Oe,qe){return{criteria:Wr(p,function(it){return it(pe)}),index:++ae,value:pe}}),function(pe,Oe){return function(qe,it,wt){for(var mt=-1,Nt=qe.criteria,Qt=it.criteria,An=Nt.length,jn=wt.length;++mt<An;){var $n=Wh(Nt[mt],Qt[mt]);if($n)return mt>=jn?$n:$n*(wt[mt]=="desc"?-1:1)}return qe.index-it.index}(pe,Oe,O)})}function ch(l,p,O){for(var ae=-1,pe=p.length,Oe={};++ae<pe;){var qe=p[ae],it=Ao(l,qe);O(it,qe)&&uc(Oe,Ds(qe,l),it)}return Oe}function Rl(l,p,O,ae){var pe=ae?Ga:Si,Oe=-1,qe=p.length,it=l;for(l===p&&(p=Ko(p)),O&&(it=Wr(l,Ae(O)));++Oe<qe;)for(var wt=0,mt=p[Oe],Nt=O?O(mt):mt;(wt=pe(it,Nt,wt,ae))>-1;)it!==l&&Jn.call(it,wt,1),Jn.call(l,wt,1);return l}function Qs(l,p){for(var O=l?p.length:0,ae=O-1;O--;){var pe=p[O];if(O==ae||pe!==Oe){var Oe=pe;Ja(pe)?Jn.call(l,pe,1):yu(l,pe)}}return l}function Dr(l,p){return l+Vi(Sl()*(p-l+1))}function ba(l,p){var O="";if(!l||p<1||p>P)return O;do p%2&&(O+=l),(p=Vi(p/2))&&(l+=l);while(p);return O}function Lr(l,p){return pc(od(l,p,mo),l+"")}function uc(l,p,O,ae){if(!gi(l))return l;for(var pe=-1,Oe=(p=Ds(p,l)).length,qe=Oe-1,it=l;it!=null&&++pe<Oe;){var wt=da(p[pe]),mt=O;if(wt==="__proto__"||wt==="constructor"||wt==="prototype")return l;if(pe!=qe){var Nt=it[wt];(mt=ae?ae(Nt,wt,it):s)===s&&(mt=gi(Nt)?Nt:Ja(p[pe+1])?[]:{})}Dn(it,wt,mt),it=it[wt]}return l}var Ss=Ln?function(l,p){return Ln.set(l,p),l}:mo,mu=So?function(l,p){return So(l,"toString",{configurable:!0,enumerable:!1,value:ks(p),writable:!0})}:mo;function No(l,p,O){var ae=-1,pe=l.length;p<0&&(p=-p>pe?0:pe+p),(O=O>pe?pe:O)<0&&(O+=pe),pe=p>O?0:O-p>>>0,p>>>=0;for(var Oe=nt(pe);++ae<pe;)Oe[ae]=l[ae+p];return Oe}function Gh(l,p){var O;return Pa(l,function(ae,pe,Oe){return!(O=p(ae,pe,Oe))}),!!O}function gu(l,p,O){var ae=0,pe=l==null?ae:l.length;if(typeof p=="number"&&p==p&&pe<=2147483647){for(;ae<pe;){var Oe=ae+pe>>>1,qe=l[Oe];qe!==null&&!fa(qe)&&(O?qe<=p:qe<p)?ae=Oe+1:pe=Oe}return pe}return uh(l,p,mo,O)}function uh(l,p,O,ae){var pe=0,Oe=l==null?0:l.length;if(Oe===0)return 0;for(var qe=(p=O(p))!=p,it=p===null,wt=fa(p),mt=p===s;pe<Oe;){var Nt=Vi((pe+Oe)/2),Qt=O(l[Nt]),An=Qt!==s,jn=Qt===null,$n=Qt==Qt,Ut=fa(Qt);if(qe)var an=ae||$n;else an=mt?$n&&(ae||An):it?$n&&An&&(ae||!jn):wt?$n&&An&&!jn&&(ae||!Ut):!jn&&!Ut&&(ae?Qt<=p:Qt<p);an?pe=Nt+1:Oe=Nt}return Ai(Oe,4294967294)}function hh(l,p){for(var O=-1,ae=l.length,pe=0,Oe=[];++O<ae;){var qe=l[O],it=p?p(qe):qe;if(!O||!$o(it,wt)){var wt=it;Oe[pe++]=qe===0?0:qe}}return Oe}function dh(l){return typeof l=="number"?l:fa(l)?T:+l}function Zo(l){if(typeof l=="string")return l;if(yr(l))return Wr(l,Zo)+"";if(fa(l))return pi?pi.call(l):"";var p=l+"";return p=="0"&&1/l==-1/0?"-0":p}function as(l,p,O){var ae=-1,pe=sa,Oe=l.length,qe=!0,it=[],wt=it;if(O)qe=!1,pe=Gs;else if(Oe>=200){var mt=p?null:wh(l);if(mt)return S(mt);qe=!1,pe=to,wt=new wa}else wt=p?[]:it;e:for(;++ae<Oe;){var Nt=l[ae],Qt=p?p(Nt):Nt;if(Nt=O||Nt!==0?Nt:0,qe&&Qt==Qt){for(var An=wt.length;An--;)if(wt[An]===Qt)continue e;p&&wt.push(Qt),it.push(Nt)}else pe(wt,Qt,O)||(wt!==it&&wt.push(Qt),it.push(Nt))}return it}function yu(l,p){return(l=Ph(l,p=Ds(p,l)))==null||delete l[da(Vo(p))]}function ph(l,p,O,ae){return uc(l,p,O(Ao(l,p)),ae)}function ss(l,p,O,ae){for(var pe=l.length,Oe=ae?pe:-1;(ae?Oe--:++Oe<pe)&&p(l[Oe],Oe,l););return O?No(l,ae?0:Oe,ae?Oe+1:pe):No(l,ae?Oe+1:0,ae?pe:Oe)}function ha(l,p){var O=l;return O instanceof wr&&(O=O.value()),ko(p,function(ae,pe){return pe.func.apply(pe.thisArg,bo([ae],pe.args))},O)}function Bo(l,p,O){var ae=l.length;if(ae<2)return ae?as(l[0]):[];for(var pe=-1,Oe=nt(ae);++pe<ae;)for(var qe=l[pe],it=-1;++it<ae;)it!=pe&&(Oe[pe]=Ts(Oe[pe]||qe,l[it],p,O));return as(zi(Oe,1),p,O)}function fh(l,p,O){for(var ae=-1,pe=l.length,Oe=p.length,qe={};++ae<pe;){var it=ae<Oe?p[ae]:s;O(qe,l[ae],it)}return qe}function mh(l){return mi(l)?l:[]}function gh(l){return typeof l=="function"?l:mo}function Ds(l,p){return yr(l)?l:Dh(l,p)?[l]:Su(Qr(l))}var Wd=Lr;function Es(l,p,O){var ae=l.length;return O=O===s?ae:O,!p&&O>=ae?l:No(l,p,O)}var zh=Ms||function(l){return jr.clearTimeout(l)};function Uh(l,p){if(p)return l.slice();var O=l.length,ae=$r?$r(O):new l.constructor(O);return l.copy(ae),ae}function yh(l){var p=new l.constructor(l.byteLength);return new Kr(p).set(new Kr(l)),p}function Hh(l,p){var O=p?yh(l.buffer):l.buffer;return new l.constructor(O,l.byteOffset,l.length)}function Wh(l,p){if(l!==p){var O=l!==s,ae=l===null,pe=l==l,Oe=fa(l),qe=p!==s,it=p===null,wt=p==p,mt=fa(p);if(!it&&!mt&&!Oe&&l>p||Oe&&qe&&wt&&!it&&!mt||ae&&qe&&wt||!O&&wt||!pe)return 1;if(!ae&&!Oe&&!mt&&l<p||mt&&O&&pe&&!ae&&!Oe||it&&O&&pe||!qe&&pe||!wt)return-1}return 0}function Jh(l,p,O,ae){for(var pe=-1,Oe=l.length,qe=O.length,it=-1,wt=p.length,mt=di(Oe-qe,0),Nt=nt(wt+mt),Qt=!ae;++it<wt;)Nt[it]=p[it];for(;++pe<qe;)(Qt||pe<Oe)&&(Nt[O[pe]]=l[pe]);for(;mt--;)Nt[it++]=l[pe++];return Nt}function qh(l,p,O,ae){for(var pe=-1,Oe=l.length,qe=-1,it=O.length,wt=-1,mt=p.length,Nt=di(Oe-it,0),Qt=nt(Nt+mt),An=!ae;++pe<Nt;)Qt[pe]=l[pe];for(var jn=pe;++wt<mt;)Qt[jn+wt]=p[wt];for(;++qe<it;)(An||pe<Oe)&&(Qt[jn+O[qe]]=l[pe++]);return Qt}function Ko(l,p){var O=-1,ae=l.length;for(p||(p=nt(ae));++O<ae;)p[O]=l[O];return p}function Ha(l,p,O,ae){var pe=!O;O||(O={});for(var Oe=-1,qe=p.length;++Oe<qe;){var it=p[Oe],wt=ae?ae(O[it],l[it],it,O,l):s;wt===s&&(wt=l[it]),pe?jo(O,it,wt):Dn(O,it,wt)}return O}function vu(l,p){return function(O,ae){var pe=yr(O)?aa:Js,Oe=p?p():{};return pe(O,l,nr(ae,2),Oe)}}function Ll(l){return Lr(function(p,O){var ae=-1,pe=O.length,Oe=pe>1?O[pe-1]:s,qe=pe>2?O[2]:s;for(Oe=l.length>3&&typeof Oe=="function"?(pe--,Oe):s,qe&&Fo(O[0],O[1],qe)&&(Oe=pe<3?s:Oe,pe=1),p=Pt(p);++ae<pe;){var it=O[ae];it&&l(p,it,ae,Oe)}return p})}function Xh(l,p){return function(O,ae){if(O==null)return O;if(!Do(O))return l(O,ae);for(var pe=O.length,Oe=p?pe:-1,qe=Pt(O);(p?Oe--:++Oe<pe)&&ae(qe[Oe],Oe,qe)!==!1;);return O}}function Yh(l){return function(p,O,ae){for(var pe=-1,Oe=Pt(p),qe=ae(p),it=qe.length;it--;){var wt=qe[l?it:++pe];if(O(Oe[wt],wt,Oe)===!1)break}return p}}function Zh(l){return function(p){var O=fr(p=Qr(p))?te(p):s,ae=O?O[0]:p.charAt(0),pe=O?Es(O,1).join(""):p.slice(1);return ae[l]()+pe}}function Il(l){return function(p){return ko(Is(dl(p).replace(ms,"")),l,"")}}function hc(l){return function(){var p=arguments;switch(p.length){case 0:return new l;case 1:return new l(p[0]);case 2:return new l(p[0],p[1]);case 3:return new l(p[0],p[1],p[2]);case 4:return new l(p[0],p[1],p[2],p[3]);case 5:return new l(p[0],p[1],p[2],p[3],p[4]);case 6:return new l(p[0],p[1],p[2],p[3],p[4],p[5]);case 7:return new l(p[0],p[1],p[2],p[3],p[4],p[5],p[6])}var O=Mi(l.prototype),ae=l.apply(O,p);return gi(ae)?ae:O}}function Kh(l){return function(p,O,ae){var pe=Pt(p);if(!Do(p)){var Oe=nr(O,3);p=Ui(p),O=function(it){return Oe(pe[it],it,pe)}}var qe=l(p,O,ae);return qe>-1?pe[Oe?p[qe]:qe]:s}}function $h(l){return Wa(function(p){var O=p.length,ae=O,pe=Tr.prototype.thru;for(l&&p.reverse();ae--;){var Oe=p[ae];if(typeof Oe!="function")throw new Fr(o);if(pe&&!qe&&dc(Oe)=="wrapper")var qe=new Tr([],!0)}for(ae=qe?ae:O;++ae<O;){var it=dc(Oe=p[ae]),wt=it=="wrapper"?Tu(Oe):s;qe=wt&&Eh(wt[0])&&wt[1]==424&&!wt[4].length&&wt[9]==1?qe[dc(wt[0])].apply(qe,wt[3]):Oe.length==1&&Eh(Oe)?qe[it]():qe.thru(Oe)}return function(){var mt=arguments,Nt=mt[0];if(qe&&mt.length==1&&yr(Nt))return qe.plant(Nt).value();for(var Qt=0,An=O?p[Qt].apply(this,mt):Nt;++Qt<O;)An=p[Qt].call(this,An);return An}})}function xu(l,p,O,ae,pe,Oe,qe,it,wt,mt){var Nt=p&N,Qt=1&p,An=2&p,jn=24&p,$n=512&p,Ut=An?s:hc(l);return function an(){for(var Nn=arguments.length,wn=nt(Nn),pr=Nn;pr--;)wn[pr]=arguments[pr];if(jn)var lr=kl(an),Er=function(ri,ji){for(var zr=ri.length,yo=0;zr--;)ri[zr]===ji&&++yo;return yo}(wn,lr);if(ae&&(wn=Jh(wn,ae,pe,jn)),Oe&&(wn=qh(wn,Oe,qe,jn)),Nn-=Er,jn&&Nn<mt){var Bn=g(wn,lr);return xh(l,p,xu,an.placeholder,O,wn,Bn,it,wt,mt-Nn)}var zn=Qt?O:this,ui=An?zn[l]:l;return Nn=wn.length,it?wn=function(ri,ji){for(var zr=ri.length,yo=Ai(ji.length,zr),vo=Ko(ri);yo--;){var xo=ji[yo];ri[yo]=Ja(xo,zr)?vo[xo]:s}return ri}(wn,it):$n&&Nn>1&&wn.reverse(),Nt&&wt<Nn&&(wn.length=wt),this&&this!==jr&&this instanceof an&&(ui=Ut||hc(ui)),ui.apply(zn,wn)}}function Qh(l,p){return function(O,ae){return function(pe,Oe,qe,it){return Oa(pe,function(wt,mt,Nt){Oe(it,qe(wt),mt,Nt)}),it}(O,l,p(ae),{})}}function wu(l,p){return function(O,ae){var pe;if(O===s&&ae===s)return p;if(O!==s&&(pe=O),ae!==s){if(pe===s)return ae;typeof O=="string"||typeof ae=="string"?(O=Zo(O),ae=Zo(ae)):(O=dh(O),ae=dh(ae)),pe=l(O,ae)}return pe}}function vh(l){return Wa(function(p){return p=Wr(p,Ae(nr())),Lr(function(O){var ae=this;return l(p,function(pe){return hi(pe,ae,O)})})})}function bu(l,p){var O=(p=p===s?" ":Zo(p)).length;if(O<2)return O?ba(p,l):p;var ae=ba(p,uo(l/Z(p)));return fr(p)?Es(te(ae),0,l).join(""):ae.slice(0,l)}function ed(l){return function(p,O,ae){return ae&&typeof ae!="number"&&Fo(p,O,ae)&&(O=ae=s),p=La(p),O===s?(O=p,p=0):O=La(O),function(pe,Oe,qe,it){for(var wt=-1,mt=di(uo((Oe-pe)/(qe||1)),0),Nt=nt(mt);mt--;)Nt[it?mt:++wt]=pe,pe+=qe;return Nt}(p,O,ae=ae===s?p<O?1:-1:La(ae),l)}}function Mu(l){return function(p,O){return typeof p=="string"&&typeof O=="string"||(p=oi(p),O=oi(O)),l(p,O)}}function xh(l,p,O,ae,pe,Oe,qe,it,wt,mt){var Nt=8&p;p|=Nt?L:U,4&(p&=~(Nt?U:L))||(p&=-4);var Qt=[l,p,pe,Nt?Oe:s,Nt?qe:s,Nt?s:Oe,Nt?s:qe,it,wt,mt],An=O.apply(s,Qt);return Eh(l)&&ad(An,Qt),An.placeholder=ae,fc(An,l,p)}function _u(l){var p=kn[l];return function(O,ae){if(O=oi(O),(ae=ae==null?0:Ai(Cr(ae),292))&&xa(O)){var pe=(Qr(O)+"e").split("e");return+((pe=(Qr(p(pe[0]+"e"+(+pe[1]+ae)))+"e").split("e"))[0]+"e"+(+pe[1]-ae))}return p(O)}}var wh=kt&&1/S(new kt([,-0]))[1]==f?function(l){return new kt(l)}:zo;function bh(l){return function(p){var O=Ro(p);return O==F?_l(p):O==j?function(ae){var pe=-1,Oe=Array(ae.size);return ae.forEach(function(qe){Oe[++pe]=[qe,qe]}),Oe}(p):function(ae,pe){return Wr(pe,function(Oe){return[Oe,ae[Oe]]})}(p,l(p))}}function ls(l,p,O,ae,pe,Oe,qe,it){var wt=2&p;if(!wt&&typeof l!="function")throw new Fr(o);var mt=ae?ae.length:0;if(mt||(p&=-97,ae=pe=s),qe=qe===s?qe:di(Cr(qe),0),it=it===s?it:Cr(it),mt-=pe?pe.length:0,p&U){var Nt=ae,Qt=pe;ae=pe=s}var An=wt?s:Tu(l),jn=[l,p,O,ae,pe,Nt,Qt,Oe,qe,it];if(An&&function(Ut,an){var Nn=Ut[1],wn=an[1],pr=Nn|wn,lr=pr<131,Er=wn==N&&Nn==8||wn==N&&Nn==D&&Ut[7].length<=an[8]||wn==384&&an[7].length<=an[8]&&Nn==8;if(!lr&&!Er)return Ut;1&wn&&(Ut[2]=an[2],pr|=1&Nn?0:4);var Bn=an[3];if(Bn){var zn=Ut[3];Ut[3]=zn?Jh(zn,Bn,an[4]):Bn,Ut[4]=zn?g(Ut[3],u):an[4]}(Bn=an[5])&&(zn=Ut[5],Ut[5]=zn?qh(zn,Bn,an[6]):Bn,Ut[6]=zn?g(Ut[5],u):an[6]),(Bn=an[7])&&(Ut[7]=Bn),wn&N&&(Ut[8]=Ut[8]==null?an[8]:Ai(Ut[8],an[8])),Ut[9]==null&&(Ut[9]=an[9]),Ut[0]=an[0],Ut[1]=pr}(jn,An),l=jn[0],p=jn[1],O=jn[2],ae=jn[3],pe=jn[4],!(it=jn[9]=jn[9]===s?wt?0:l.length:di(jn[9]-mt,0))&&24&p&&(p&=-25),p&&p!=1)$n=p==8||p==w?function(Ut,an,Nn){var wn=hc(Ut);return function pr(){for(var lr=arguments.length,Er=nt(lr),Bn=lr,zn=kl(pr);Bn--;)Er[Bn]=arguments[Bn];var ui=lr<3&&Er[0]!==zn&&Er[lr-1]!==zn?[]:g(Er,zn);return(lr-=ui.length)<Nn?xh(Ut,an,xu,pr.placeholder,s,Er,ui,s,s,Nn-lr):hi(this&&this!==jr&&this instanceof pr?wn:Ut,this,Er)}}(l,p,it):p!=L&&p!=33||pe.length?xu.apply(s,jn):function(Ut,an,Nn,wn){var pr=1&an,lr=hc(Ut);return function Er(){for(var Bn=-1,zn=arguments.length,ui=-1,ri=wn.length,ji=nt(ri+zn),zr=this&&this!==jr&&this instanceof Er?lr:Ut;++ui<ri;)ji[ui]=wn[ui];for(;zn--;)ji[ui++]=arguments[++Bn];return hi(zr,pr?Nn:this,ji)}}(l,p,O,ae);else var $n=function(Ut,an,Nn){var wn=1&an,pr=hc(Ut);return function lr(){return(this&&this!==jr&&this instanceof lr?pr:Ut).apply(wn?Nn:this,arguments)}}(l,p,O);return fc((An?Ss:ad)($n,jn),l,p)}function cs(l,p,O,ae){return l===s||$o(l,dr[O])&&!Wn.call(ae,O)?p:l}function Mh(l,p,O,ae,pe,Oe){return gi(l)&&gi(p)&&(Oe.set(p,l),Ks(l,p,s,Mh,Oe),Oe.delete(p)),l}function Jd(l){return ql(l)?s:l}function _h(l,p,O,ae,pe,Oe){var qe=1&O,it=l.length,wt=p.length;if(it!=wt&&!(qe&&wt>it))return!1;var mt=Oe.get(l),Nt=Oe.get(p);if(mt&&Nt)return mt==p&&Nt==l;var Qt=-1,An=!0,jn=2&O?new wa:s;for(Oe.set(l,p),Oe.set(p,l);++Qt<it;){var $n=l[Qt],Ut=p[Qt];if(ae)var an=qe?ae(Ut,$n,Qt,p,l,Oe):ae($n,Ut,Qt,l,p,Oe);if(an!==s){if(an)continue;An=!1;break}if(jn){if(!Va(p,function(Nn,wn){if(!to(jn,wn)&&($n===Nn||pe($n,Nn,O,ae,Oe)))return jn.push(wn)})){An=!1;break}}else if($n!==Ut&&!pe($n,Ut,O,ae,Oe)){An=!1;break}}return Oe.delete(l),Oe.delete(p),An}function Wa(l){return pc(od(l,s,al),l+"")}function el(l){return fu(l,Ui,Ch)}function tl(l){return fu(l,fo,Sh)}var Tu=Ln?function(l){return Ln.get(l)}:zo;function dc(l){for(var p=l.name+"",O=It[p],ae=Wn.call(It,p)?O.length:0;ae--;){var pe=O[ae],Oe=pe.func;if(Oe==null||Oe==l)return pe.name}return p}function kl(l){return(Wn.call(we,"placeholder")?we:l).placeholder}function nr(){var l=we.iteratee||fl;return l=l===fl?Aa:l,arguments.length?l(arguments[0],arguments[1]):l}function Cu(l,p){var O,ae,pe=l.__data__;return((ae=typeof(O=p))=="string"||ae=="number"||ae=="symbol"||ae=="boolean"?O!=="__proto__":O===null)?pe[typeof p=="string"?"string":"hash"]:pe.map}function Th(l){for(var p=Ui(l),O=p.length;O--;){var ae=p[O],pe=l[ae];p[O]=[ae,pe,nl(pe)]}return p}function Ps(l,p){var O=function(ae,pe){return ae==null?s:ae[pe]}(l,p);return Yo(O)?O:s}var Ch=_s?function(l){return l==null?[]:(l=Pt(l),Ca(_s(l),function(p){return wi.call(l,p)}))}:js,Sh=_s?function(l){for(var p=[];l;)bo(p,Ch(l)),l=Oi(l);return p}:js,Ro=po;function td(l,p,O){for(var ae=-1,pe=(p=Ds(p,l)).length,Oe=!1;++ae<pe;){var qe=da(p[ae]);if(!(Oe=l!=null&&O(l,qe)))break;l=l[qe]}return Oe||++ae!=pe?Oe:!!(pe=l==null?0:l.length)&&Os(pe)&&Ja(qe,pe)&&(yr(l)||ro(l))}function nd(l){return typeof l.constructor!="function"||qa(l)?{}:Mi(Oi(l))}function qd(l){return yr(l)||ro(l)||!!(li&&l&&l[li])}function Ja(l,p){var O=typeof l;return!!(p=p??P)&&(O=="number"||O!="symbol"&&ct.test(l))&&l>-1&&l%1==0&&l<p}function Fo(l,p,O){if(!gi(O))return!1;var ae=typeof p;return!!(ae=="number"?Do(O)&&Ja(p,O.length):ae=="string"&&p in O)&&$o(O[p],l)}function Dh(l,p){if(yr(l))return!1;var O=typeof l;return!(O!="number"&&O!="symbol"&&O!="boolean"&&l!=null&&!fa(l))||He.test(l)||!At.test(l)||p!=null&&l in Pt(p)}function Eh(l){var p=dc(l),O=we[p];if(typeof O!="function"||!(p in wr.prototype))return!1;if(l===O)return!0;var ae=Tu(O);return!!ae&&l===ae[0]}(at&&Ro(new at(new ArrayBuffer(1)))!=ie||$e&&Ro(new $e)!=F||Tt&&Ro(Tt.resolve())!=h||kt&&Ro(new kt)!=j||gn&&Ro(new gn)!=V)&&(Ro=function(l){var p=po(l),O=p==a?l.constructor:s,ae=O?Xa(O):"";if(ae)switch(ae){case Mr:return ie;case Sn:return F;case en:return h;case Rr:return j;case tr:return V}return p});var rd=To?pa:Ql;function qa(l){var p=l&&l.constructor;return l===(typeof p=="function"&&p.prototype||dr)}function nl(l){return l==l&&!gi(l)}function id(l,p){return function(O){return O!=null&&O[l]===p&&(p!==s||l in Pt(O))}}function od(l,p,O){return p=di(p===s?l.length-1:p,0),function(){for(var ae=arguments,pe=-1,Oe=di(ae.length-p,0),qe=nt(Oe);++pe<Oe;)qe[pe]=ae[p+pe];pe=-1;for(var it=nt(p+1);++pe<p;)it[pe]=ae[pe];return it[p]=O(qe),hi(l,this,it)}}function Ph(l,p){return p.length<2?l:Ao(l,No(p,0,-1))}function Oh(l,p){if((p!=="constructor"||typeof l[p]!="function")&&p!="__proto__")return l[p]}var ad=rl(Ss),jl=no||function(l,p){return jr.setTimeout(l,p)},pc=rl(mu);function fc(l,p,O){var ae=p+"";return pc(l,function(pe,Oe){var qe=Oe.length;if(!qe)return pe;var it=qe-1;return Oe[it]=(qe>1?"& ":"")+Oe[it],Oe=Oe.join(qe>2?", ":" "),pe.replace(gt,`{
/* [wrapped with `+Oe+`] */
`)}(ae,function(pe,Oe){return Ci(G,function(qe){var it="_."+qe[0];Oe&qe[1]&&!sa(pe,it)&&pe.push(it)}),pe.sort()}(function(pe){var Oe=ae.match(ze);return Oe?Oe[1].split(Zt):[]}(),O)))}function rl(l){var p=0,O=0;return function(){var ae=Ws(),pe=16-(ae-O);if(O=ae,pe>0){if(++p>=800)return arguments[0]}else p=0;return l.apply(s,arguments)}}function mc(l,p){var O=-1,ae=l.length,pe=ae-1;for(p=p===s?ae:p;++O<p;){var Oe=Dr(O,pe),qe=l[Oe];l[Oe]=l[O],l[O]=qe}return l.length=p,l}var Su=function(l){var p=Ul(function(ae){var pe=[];return ae.charCodeAt(0)===46&&pe.push(""),ae.replace(Gt,function(Oe,qe,it,wt){pe.push(it?wt.replace(pt,"$1"):qe||Oe)}),pe},function(ae){return O.size===500&&O.clear(),ae}),O=p.cache;return p}();function da(l){if(typeof l=="string"||fa(l))return l;var p=l+"";return p=="0"&&1/l==-1/0?"-0":p}function Xa(l){if(l!=null){try{return xr.call(l)}catch{}try{return l+""}catch{}}return""}function Ya(l){if(l instanceof wr)return l.clone();var p=new Tr(l.__wrapped__,l.__chain__);return p.__actions__=Ko(l.__actions__),p.__index__=l.__index__,p.__values__=l.__values__,p}var Nl=Lr(function(l,p){return mi(l)?Ts(l,zi(p,1,mi,!0)):[]}),il=Lr(function(l,p){var O=Vo(p);return mi(O)&&(O=s),mi(l)?Ts(l,zi(p,1,mi,!0),nr(O,2)):[]}),gc=Lr(function(l,p){var O=Vo(p);return mi(O)&&(O=s),mi(l)?Ts(l,zi(p,1,mi,!0),s,O):[]});function ol(l,p,O){var ae=l==null?0:l.length;if(!ae)return-1;var pe=O==null?0:Cr(O);return pe<0&&(pe=di(ae+pe,0)),zt(l,nr(p,3),pe)}function Bl(l,p,O){var ae=l==null?0:l.length;if(!ae)return-1;var pe=ae-1;return O!==s&&(pe=Cr(O),pe=O<0?di(ae+pe,0):Ai(pe,ae-1)),zt(l,nr(p,3),pe,!0)}function al(l){return l!=null&&l.length?zi(l,1):[]}function sl(l){return l&&l.length?l[0]:s}var Fl=Lr(function(l){var p=Wr(l,mh);return p.length&&p[0]===l[0]?Cs(p):[]}),yc=Lr(function(l){var p=Vo(l),O=Wr(l,mh);return p===Vo(O)?p=s:O.pop(),O.length&&O[0]===l[0]?Cs(O,nr(p,2)):[]}),sd=Lr(function(l){var p=Vo(l),O=Wr(l,mh);return(p=typeof p=="function"?p:s)&&O.pop(),O.length&&O[0]===l[0]?Cs(O,s,p):[]});function Vo(l){var p=l==null?0:l.length;return p?l[p-1]:s}var vc=Lr(xc);function xc(l,p){return l&&l.length&&p&&p.length?Rl(l,p):l}var ld=Wa(function(l,p){var O=l==null?0:l.length,ae=is(l,p);return Qs(l,Wr(p,function(pe){return Ja(pe,O)?+pe:pe}).sort(Wh)),ae});function wc(l){return l==null?l:Ie.call(l)}var cd=Lr(function(l){return as(zi(l,1,mi,!0))}),bc=Lr(function(l){var p=Vo(l);return mi(p)&&(p=s),as(zi(l,1,mi,!0),nr(p,2))}),Du=Lr(function(l){var p=Vo(l);return p=typeof p=="function"?p:s,as(zi(l,1,mi,!0),s,p)});function Vl(l){if(!l||!l.length)return[];var p=0;return l=Ca(l,function(O){if(mi(O))return p=di(O.length,p),!0}),ws(p,function(O){return Wr(l,Jr(O))})}function Ah(l,p){if(!l||!l.length)return[];var O=Vl(l);return p==null?O:Wr(O,function(ae){return hi(p,s,ae)})}var Mc=Lr(function(l,p){return mi(l)?Ts(l,p):[]}),_c=Lr(function(l){return Bo(Ca(l,mi))}),ud=Lr(function(l){var p=Vo(l);return mi(p)&&(p=s),Bo(Ca(l,mi),nr(p,2))}),Xd=Lr(function(l){var p=Vo(l);return p=typeof p=="function"?p:s,Bo(Ca(l,mi),s,p)}),Eu=Lr(Vl),Rh=Lr(function(l){var p=l.length,O=p>1?l[p-1]:s;return Ah(l,O=typeof O=="function"?(l.pop(),O):s)});function Lh(l){var p=we(l);return p.__chain__=!0,p}function Tc(l,p){return p(l)}var Gl=Wa(function(l){var p=l.length,O=p?l[0]:0,ae=this.__wrapped__,pe=function(Oe){return is(Oe,l)};return!(p>1||this.__actions__.length)&&ae instanceof wr&&Ja(O)?((ae=ae.slice(O,+O+(p?1:0))).__actions__.push({func:Tc,args:[pe],thisArg:s}),new Tr(ae,this.__chain__).thru(function(Oe){return p&&!Oe.length&&Oe.push(s),Oe})):this.thru(pe)}),Cc=vu(function(l,p,O){Wn.call(l,O)?++l[O]:jo(l,O,1)}),Pu=Kh(ol),ki=Kh(Bl);function Ih(l,p){return(yr(l)?Ci:Pa)(l,nr(p,3))}function kh(l,p){return(yr(l)?function(O,ae){for(var pe=O==null?0:O.length;pe--&&ae(O[pe],pe,O)!==!1;);return O}:sc)(l,nr(p,3))}var hd=vu(function(l,p,O){Wn.call(l,O)?l[O].push(p):jo(l,O,[p])}),Ou=Lr(function(l,p,O){var ae=-1,pe=typeof p=="function",Oe=Do(l)?nt(l.length):[];return Pa(l,function(qe){Oe[++ae]=pe?hi(p,qe,O):Zi(qe,p,O)}),Oe}),Au=vu(function(l,p,O){jo(l,O,p)});function Lo(l,p){return(yr(l)?Wr:Ys)(l,nr(p,3))}var Ru=vu(function(l,p,O){l[O?0:1].push(p)},function(){return[[],[]]}),Lu=Lr(function(l,p){if(l==null)return[];var O=p.length;return O>1&&Fo(l,p[0],p[1])?p=[]:O>2&&Fo(p[0],p[1],p[2])&&(p=[p[0]]),bn(l,zi(p,1),[])}),fi=Tl||function(){return jr.Date.now()};function Sc(l,p,O){return p=O?s:p,p=l&&p==null?l.length:p,ls(l,N,s,s,s,s,p)}function Za(l,p){var O;if(typeof p!="function")throw new Fr(o);return l=Cr(l),function(){return--l>0&&(O=p.apply(this,arguments)),l<=1&&(p=s),O}}var Iu=Lr(function(l,p,O){var ae=1;if(O.length){var pe=g(O,kl(Iu));ae|=L}return ls(l,ae,p,O,pe)}),ku=Lr(function(l,p,O){var ae=3;if(O.length){var pe=g(O,kl(ku));ae|=L}return ls(p,ae,l,O,pe)});function Dc(l,p,O){var ae,pe,Oe,qe,it,wt,mt=0,Nt=!1,Qt=!1,An=!0;if(typeof l!="function")throw new Fr(o);function jn(wn){var pr=ae,lr=pe;return ae=pe=s,mt=wn,qe=l.apply(lr,pr)}function $n(wn){var pr=wn-wt;return wt===s||pr>=p||pr<0||Qt&&wn-mt>=Oe}function Ut(){var wn=fi();if($n(wn))return an(wn);it=jl(Ut,function(pr){var lr=p-(pr-wt);return Qt?Ai(lr,Oe-(pr-mt)):lr}(wn))}function an(wn){return it=s,An&&ae?jn(wn):(ae=pe=s,qe)}function Nn(){var wn=fi(),pr=$n(wn);if(ae=arguments,pe=this,wt=wn,pr){if(it===s)return function(lr){return mt=lr,it=jl(Ut,p),Nt?jn(lr):qe}(wt);if(Qt)return zh(it),it=jl(Ut,p),jn(wt)}return it===s&&(it=jl(Ut,p)),qe}return p=oi(p)||0,gi(O)&&(Nt=!!O.leading,Oe=(Qt="maxWait"in O)?di(oi(O.maxWait)||0,p):Oe,An="trailing"in O?!!O.trailing:An),Nn.cancel=function(){it!==s&&zh(it),mt=0,ae=wt=pe=it=s},Nn.flush=function(){return it===s?qe:an(fi())},Nn}var ju=Lr(function(l,p){return du(l,1,p)}),zl=Lr(function(l,p,O){return du(l,oi(p)||0,O)});function Ul(l,p){if(typeof l!="function"||p!=null&&typeof p!="function")throw new Fr(o);var O=function(){var ae=arguments,pe=p?p.apply(this,ae):ae[0],Oe=O.cache;if(Oe.has(pe))return Oe.get(pe);var qe=l.apply(this,ae);return O.cache=Oe.set(pe,qe)||Oe,qe};return O.cache=new(Ul.Cache||Gi),O}function Hl(l){if(typeof l!="function")throw new Fr(o);return function(){var p=arguments;switch(p.length){case 0:return!l.call(this);case 1:return!l.call(this,p[0]);case 2:return!l.call(this,p[0],p[1]);case 3:return!l.call(this,p[0],p[1],p[2])}return!l.apply(this,p)}}Ul.Cache=Gi;var Nu=Wd(function(l,p){var O=(p=p.length==1&&yr(p[0])?Wr(p[0],Ae(nr())):Wr(zi(p,1),Ae(nr()))).length;return Lr(function(ae){for(var pe=-1,Oe=Ai(ae.length,O);++pe<Oe;)ae[pe]=p[pe].call(this,ae[pe]);return hi(l,this,ae)})}),Ec=Lr(function(l,p){var O=g(p,kl(Ec));return ls(l,L,s,p,O)}),Bu=Lr(function(l,p){var O=g(p,kl(Bu));return ls(l,U,s,p,O)}),Pc=Wa(function(l,p){return ls(l,D,s,s,s,p)});function $o(l,p){return l===p||l!=l&&p!=p}var Oc=Mu(sr),Fu=Mu(function(l,p){return l>=p}),ro=sh(function(){return arguments}())?sh:function(l){return yi(l)&&Wn.call(l,"callee")&&!wi.call(l,"callee")},yr=nt.isArray,Ac=yt?Ae(yt):function(l){return yi(l)&&po(l)==ne};function Do(l){return l!=null&&Os(l.length)&&!pa(l)}function mi(l){return yi(l)&&Do(l)}var Ra=Wo||Ql,Rc=Bt?Ae(Bt):function(l){return yi(l)&&po(l)==k};function Wl(l){if(!yi(l))return!1;var p=po(l);return p==E||p=="[object DOMException]"||typeof l.message=="string"&&typeof l.name=="string"&&!ql(l)}function pa(l){if(!gi(l))return!1;var p=po(l);return p==W||p==C||p=="[object AsyncFunction]"||p=="[object Proxy]"}function Lc(l){return typeof l=="number"&&l==Cr(l)}function Os(l){return typeof l=="number"&&l>-1&&l%1==0&&l<=P}function gi(l){var p=typeof l;return l!=null&&(p=="object"||p=="function")}function yi(l){return l!=null&&typeof l=="object"}var Ic=Xt?Ae(Xt):function(l){return yi(l)&&Ro(l)==F};function Jl(l){return typeof l=="number"||yi(l)&&po(l)==M}function ql(l){if(!yi(l)||po(l)!=a)return!1;var p=Oi(l);if(p===null)return!0;var O=Wn.call(p,"constructor")&&p.constructor;return typeof O=="function"&&O instanceof O&&xr.call(O)==Ua}var ll=In?Ae(In):function(l){return yi(l)&&po(l)==y},Xl=Gn?Ae(Gn):function(l){return yi(l)&&Ro(l)==j};function Vu(l){return typeof l=="string"||!yr(l)&&yi(l)&&po(l)==Y}function fa(l){return typeof l=="symbol"||yi(l)&&po(l)==q}var Yl=ar?Ae(ar):function(l){return yi(l)&&Os(l.length)&&!!Xr[po(l)]},Yd=Mu(Xs),Zd=Mu(function(l,p){return l<=p});function dd(l){if(!l)return[];if(Do(l))return Vu(l)?te(l):Ko(l);if(ni&&l[ni])return function(O){for(var ae,pe=[];!(ae=O.next()).done;)pe.push(ae.value);return pe}(l[ni]());var p=Ro(l);return(p==F?_l:p==j?S:Ka)(l)}function La(l){return l?(l=oi(l))===f||l===-1/0?17976931348623157e292*(l<0?-1:1):l==l?l:0:l===0?l:0}function Cr(l){var p=La(l),O=p%1;return p==p?O?p-O:p:0}function cl(l){return l?ua(Cr(l),0,B):0}function oi(l){if(typeof l=="number")return l;if(fa(l))return T;if(gi(l)){var p=typeof l.valueOf=="function"?l.valueOf():l;l=gi(p)?p+"":p}if(typeof l!="string")return l===0?l:+l;l=Us(l);var O=nn.test(l);return O||kr.test(l)?rs(l.slice(2),O?2:8):xn.test(l)?T:+l}function As(l){return Ha(l,fo(l))}function Qr(l){return l==null?"":Zo(l)}var kc=Ll(function(l,p){if(qa(p)||Do(p))Ha(p,Ui(p),l);else for(var O in p)Wn.call(p,O)&&Dn(l,O,p[O])}),jh=Ll(function(l,p){Ha(p,fo(p),l)}),jc=Ll(function(l,p,O,ae){Ha(p,fo(p),l,ae)}),Nc=Ll(function(l,p,O,ae){Ha(p,Ui(p),l,ae)}),Nh=Wa(is),us=Lr(function(l,p){l=Pt(l);var O=-1,ae=p.length,pe=ae>2?p[2]:s;for(pe&&Fo(p[0],p[1],pe)&&(ae=1);++O<ae;)for(var Oe=p[O],qe=fo(Oe),it=-1,wt=qe.length;++it<wt;){var mt=qe[it],Nt=l[mt];(Nt===s||$o(Nt,dr[mt])&&!Wn.call(l,mt))&&(l[mt]=Oe[mt])}return l}),pd=Lr(function(l){return l.push(s,Mh),hi(hl,s,l)});function Gu(l,p,O){var ae=l==null?s:Ao(l,p);return ae===s?O:ae}function ul(l,p){return l!=null&&td(l,p,lc)}var Rs=Qh(function(l,p,O){p!=null&&typeof p.toString!="function"&&(p=co.call(p)),l[p]=O},ks(mo)),Kd=Qh(function(l,p,O){p!=null&&typeof p.toString!="function"&&(p=co.call(p)),Wn.call(l,p)?l[p].push(O):l[p]=[O]},nr),fd=Lr(Zi);function Ui(l){return Do(l)?qo(l):Ii(l)}function fo(l){return Do(l)?qo(l,!0):function(p){if(!gi(p))return function(Oe){var qe=[];if(Oe!=null)for(var it in Pt(Oe))qe.push(it);return qe}(p);var O=qa(p),ae=[];for(var pe in p)(pe!="constructor"||!O&&Wn.call(p,pe))&&ae.push(pe);return ae}(l)}var zu=Ll(function(l,p,O){Ks(l,p,O)}),hl=Ll(function(l,p,O,ae){Ks(l,p,O,ae)}),Uu=Wa(function(l,p){var O={};if(l==null)return O;var ae=!1;p=Wr(p,function(Oe){return Oe=Ds(Oe,l),ae||(ae=Oe.length>1),Oe}),Ha(l,tl(l),O),ae&&(O=Xo(O,7,Jd));for(var pe=p.length;pe--;)yu(O,p[pe]);return O}),Bc=Wa(function(l,p){return l==null?{}:function(O,ae){return ch(O,ae,function(pe,Oe){return ul(O,Oe)})}(l,p)});function Fc(l,p){if(l==null)return{};var O=Wr(tl(l),function(ae){return[ae]});return p=nr(p),ch(l,O,function(ae,pe){return p(ae,pe[0])})}var Zl=bh(Ui),Kl=bh(fo);function Ka(l){return l==null?[]:Sa(l,Ui(l))}var md=Il(function(l,p,O){return p=p.toLowerCase(),l+(O?$l(p):p)});function $l(l){return pl(Qr(l).toLowerCase())}function dl(l){return(l=Qr(l))&&l.replace(Ue,Da).replace(Vs,"")}var Ls=Il(function(l,p,O){return l+(O?"-":"")+p.toLowerCase()}),Hu=Il(function(l,p,O){return l+(O?" ":"")+p.toLowerCase()}),Wu=Zh("toLowerCase"),Ju=Il(function(l,p,O){return l+(O?"_":"")+p.toLowerCase()}),Vc=Il(function(l,p,O){return l+(O?" ":"")+pl(p)}),Go=Il(function(l,p,O){return l+(O?" ":"")+p.toUpperCase()}),pl=Zh("toUpperCase");function Is(l,p,O){return l=Qr(l),(p=O?s:p)===s?function(ae){return ys.test(ae)}(l)?function(ae){return ae.match(gs)||[]}(l):function(ae){return ae.match(Rn)||[]}(l):l.match(p)||[]}var hs=Lr(function(l,p){try{return hi(l,s,p)}catch(O){return Wl(O)?O:new ut(O)}}),Gc=Wa(function(l,p){return Ci(p,function(O){O=da(O),jo(l,O,Iu(l[O],l))}),l});function ks(l){return function(){return l}}var zc=$h(),Uc=$h(!0);function mo(l){return l}function fl(l){return Aa(typeof l=="function"?l:Xo(l,1))}var Hc=Lr(function(l,p){return function(O){return Zi(O,l,p)}}),$d=Lr(function(l,p){return function(O){return Zi(l,O,p)}});function Di(l,p,O){var ae=Ui(p),pe=pu(p,ae);O!=null||gi(p)&&(pe.length||!ae.length)||(O=p,p=l,l=this,pe=pu(p,Ui(p)));var Oe=!(gi(O)&&"chain"in O&&!O.chain),qe=pa(l);return Ci(pe,function(it){var wt=p[it];l[it]=wt,qe&&(l.prototype[it]=function(){var mt=this.__chain__;if(Oe||mt){var Nt=l(this.__wrapped__);return(Nt.__actions__=Ko(this.__actions__)).push({func:wt,args:arguments,thisArg:l}),Nt.__chain__=mt,Nt}return wt.apply(l,bo([this.value()],arguments))})}),l}function zo(){}var qu=vh(Wr),Wc=vh(va),Xu=vh(Va);function go(l){return Dh(l)?Jr(da(l)):function(p){return function(O){return Ao(O,p)}}(l)}var Yu=ed(),Zu=ed(!0);function js(){return[]}function Ql(){return!1}var ml,Ku=wu(function(l,p){return l+p},0),ec=_u("ceil"),Ma=wu(function(l,p){return l/p},1),Qd=_u("floor"),gl=wu(function(l,p){return l*p},1),Bh=_u("round"),gd=wu(function(l,p){return l-p},0);return we.after=function(l,p){if(typeof p!="function")throw new Fr(o);return l=Cr(l),function(){if(--l<1)return p.apply(this,arguments)}},we.ary=Sc,we.assign=kc,we.assignIn=jh,we.assignInWith=jc,we.assignWith=Nc,we.at=Nh,we.before=Za,we.bind=Iu,we.bindAll=Gc,we.bindKey=ku,we.castArray=function(){if(!arguments.length)return[];var l=arguments[0];return yr(l)?l:[l]},we.chain=Lh,we.chunk=function(l,p,O){p=(O?Fo(l,p,O):p===s)?1:di(Cr(p),0);var ae=l==null?0:l.length;if(!ae||p<1)return[];for(var pe=0,Oe=0,qe=nt(uo(ae/p));pe<ae;)qe[Oe++]=No(l,pe,pe+=p);return qe},we.compact=function(l){for(var p=-1,O=l==null?0:l.length,ae=0,pe=[];++p<O;){var Oe=l[p];Oe&&(pe[ae++]=Oe)}return pe},we.concat=function(){var l=arguments.length;if(!l)return[];for(var p=nt(l-1),O=arguments[0],ae=l;ae--;)p[ae-1]=arguments[ae];return bo(yr(O)?Ko(O):[O],zi(p,1))},we.cond=function(l){var p=l==null?0:l.length,O=nr();return l=p?Wr(l,function(ae){if(typeof ae[1]!="function")throw new Fr(o);return[O(ae[0]),ae[1]]}):[],Lr(function(ae){for(var pe=-1;++pe<p;){var Oe=l[pe];if(hi(Oe[0],this,ae))return hi(Oe[1],this,ae)}})},we.conforms=function(l){return function(p){var O=Ui(p);return function(ae){return hu(ae,p,O)}}(Xo(l,1))},we.constant=ks,we.countBy=Cc,we.create=function(l,p){var O=Mi(l);return p==null?O:uu(O,p)},we.curry=function l(p,O,ae){var pe=ls(p,8,s,s,s,s,s,O=ae?s:O);return pe.placeholder=l.placeholder,pe},we.curryRight=function l(p,O,ae){var pe=ls(p,w,s,s,s,s,s,O=ae?s:O);return pe.placeholder=l.placeholder,pe},we.debounce=Dc,we.defaults=us,we.defaultsDeep=pd,we.defer=ju,we.delay=zl,we.difference=Nl,we.differenceBy=il,we.differenceWith=gc,we.drop=function(l,p,O){var ae=l==null?0:l.length;return ae?No(l,(p=O||p===s?1:Cr(p))<0?0:p,ae):[]},we.dropRight=function(l,p,O){var ae=l==null?0:l.length;return ae?No(l,0,(p=ae-(p=O||p===s?1:Cr(p)))<0?0:p):[]},we.dropRightWhile=function(l,p){return l&&l.length?ss(l,nr(p,3),!0,!0):[]},we.dropWhile=function(l,p){return l&&l.length?ss(l,nr(p,3),!0):[]},we.fill=function(l,p,O,ae){var pe=l==null?0:l.length;return pe?(O&&typeof O!="number"&&Fo(l,p,O)&&(O=0,ae=pe),function(Oe,qe,it,wt){var mt=Oe.length;for((it=Cr(it))<0&&(it=-it>mt?0:mt+it),(wt=wt===s||wt>mt?mt:Cr(wt))<0&&(wt+=mt),wt=it>wt?0:cl(wt);it<wt;)Oe[it++]=qe;return Oe}(l,p,O,ae)):[]},we.filter=function(l,p){return(yr(l)?Ca:qs)(l,nr(p,3))},we.flatMap=function(l,p){return zi(Lo(l,p),1)},we.flatMapDeep=function(l,p){return zi(Lo(l,p),f)},we.flatMapDepth=function(l,p,O){return O=O===s?1:Cr(O),zi(Lo(l,p),O)},we.flatten=al,we.flattenDeep=function(l){return l!=null&&l.length?zi(l,f):[]},we.flattenDepth=function(l,p){return l!=null&&l.length?zi(l,p=p===s?1:Cr(p)):[]},we.flip=function(l){return ls(l,512)},we.flow=zc,we.flowRight=Uc,we.fromPairs=function(l){for(var p=-1,O=l==null?0:l.length,ae={};++p<O;){var pe=l[p];ae[pe[0]]=pe[1]}return ae},we.functions=function(l){return l==null?[]:pu(l,Ui(l))},we.functionsIn=function(l){return l==null?[]:pu(l,fo(l))},we.groupBy=hd,we.initial=function(l){return l!=null&&l.length?No(l,0,-1):[]},we.intersection=Fl,we.intersectionBy=yc,we.intersectionWith=sd,we.invert=Rs,we.invertBy=Kd,we.invokeMap=Ou,we.iteratee=fl,we.keyBy=Au,we.keys=Ui,we.keysIn=fo,we.map=Lo,we.mapKeys=function(l,p){var O={};return p=nr(p,3),Oa(l,function(ae,pe,Oe){jo(O,p(ae,pe,Oe),ae)}),O},we.mapValues=function(l,p){var O={};return p=nr(p,3),Oa(l,function(ae,pe,Oe){jo(O,pe,p(ae,pe,Oe))}),O},we.matches=function(l){return Al(Xo(l,1))},we.matchesProperty=function(l,p){return Zs(l,Xo(p,1))},we.memoize=Ul,we.merge=zu,we.mergeWith=hl,we.method=Hc,we.methodOf=$d,we.mixin=Di,we.negate=Hl,we.nthArg=function(l){return l=Cr(l),Lr(function(p){return $s(p,l)})},we.omit=Uu,we.omitBy=function(l,p){return Fc(l,Hl(nr(p)))},we.once=function(l){return Za(2,l)},we.orderBy=function(l,p,O,ae){return l==null?[]:(yr(p)||(p=p==null?[]:[p]),yr(O=ae?s:O)||(O=O==null?[]:[O]),bn(l,p,O))},we.over=qu,we.overArgs=Nu,we.overEvery=Wc,we.overSome=Xu,we.partial=Ec,we.partialRight=Bu,we.partition=Ru,we.pick=Bc,we.pickBy=Fc,we.property=go,we.propertyOf=function(l){return function(p){return l==null?s:Ao(l,p)}},we.pull=vc,we.pullAll=xc,we.pullAllBy=function(l,p,O){return l&&l.length&&p&&p.length?Rl(l,p,nr(O,2)):l},we.pullAllWith=function(l,p,O){return l&&l.length&&p&&p.length?Rl(l,p,s,O):l},we.pullAt=ld,we.range=Yu,we.rangeRight=Zu,we.rearg=Pc,we.reject=function(l,p){return(yr(l)?Ca:qs)(l,Hl(nr(p,3)))},we.remove=function(l,p){var O=[];if(!l||!l.length)return O;var ae=-1,pe=[],Oe=l.length;for(p=nr(p,3);++ae<Oe;){var qe=l[ae];p(qe,ae,l)&&(O.push(qe),pe.push(ae))}return Qs(l,pe),O},we.rest=function(l,p){if(typeof l!="function")throw new Fr(o);return Lr(l,p=p===s?p:Cr(p))},we.reverse=wc,we.sampleSize=function(l,p,O){return p=(O?Fo(l,p,O):p===s)?1:Cr(p),(yr(l)?function(ae,pe){return mc(Ko(ae),ua(pe,0,ae.length))}:function(ae,pe){var Oe=Ka(ae);return mc(Oe,ua(pe,0,Oe.length))})(l,p)},we.set=function(l,p,O){return l==null?l:uc(l,p,O)},we.setWith=function(l,p,O,ae){return ae=typeof ae=="function"?ae:s,l==null?l:uc(l,p,O,ae)},we.shuffle=function(l){return(yr(l)?function(p){return mc(Ko(p))}:function(p){return mc(Ka(p))})(l)},we.slice=function(l,p,O){var ae=l==null?0:l.length;return ae?(O&&typeof O!="number"&&Fo(l,p,O)?(p=0,O=ae):(p=p==null?0:Cr(p),O=O===s?ae:Cr(O)),No(l,p,O)):[]},we.sortBy=Lu,we.sortedUniq=function(l){return l&&l.length?hh(l):[]},we.sortedUniqBy=function(l,p){return l&&l.length?hh(l,nr(p,2)):[]},we.split=function(l,p,O){return O&&typeof O!="number"&&Fo(l,p,O)&&(p=O=s),(O=O===s?B:O>>>0)?(l=Qr(l))&&(typeof p=="string"||p!=null&&!ll(p))&&!(p=Zo(p))&&fr(l)?Es(te(l),0,O):l.split(p,O):[]},we.spread=function(l,p){if(typeof l!="function")throw new Fr(o);return p=p==null?0:di(Cr(p),0),Lr(function(O){var ae=O[p],pe=Es(O,0,p);return ae&&bo(pe,ae),hi(l,this,pe)})},we.tail=function(l){var p=l==null?0:l.length;return p?No(l,1,p):[]},we.take=function(l,p,O){return l&&l.length?No(l,0,(p=O||p===s?1:Cr(p))<0?0:p):[]},we.takeRight=function(l,p,O){var ae=l==null?0:l.length;return ae?No(l,(p=ae-(p=O||p===s?1:Cr(p)))<0?0:p,ae):[]},we.takeRightWhile=function(l,p){return l&&l.length?ss(l,nr(p,3),!1,!0):[]},we.takeWhile=function(l,p){return l&&l.length?ss(l,nr(p,3)):[]},we.tap=function(l,p){return p(l),l},we.throttle=function(l,p,O){var ae=!0,pe=!0;if(typeof l!="function")throw new Fr(o);return gi(O)&&(ae="leading"in O?!!O.leading:ae,pe="trailing"in O?!!O.trailing:pe),Dc(l,p,{leading:ae,maxWait:p,trailing:pe})},we.thru=Tc,we.toArray=dd,we.toPairs=Zl,we.toPairsIn=Kl,we.toPath=function(l){return yr(l)?Wr(l,da):fa(l)?[l]:Ko(Su(Qr(l)))},we.toPlainObject=As,we.transform=function(l,p,O){var ae=yr(l),pe=ae||Ra(l)||Yl(l);if(p=nr(p,4),O==null){var Oe=l&&l.constructor;O=pe?ae?new Oe:[]:gi(l)&&pa(Oe)?Mi(Oi(l)):{}}return(pe?Ci:Oa)(l,function(qe,it,wt){return p(O,qe,it,wt)}),O},we.unary=function(l){return Sc(l,1)},we.union=cd,we.unionBy=bc,we.unionWith=Du,we.uniq=function(l){return l&&l.length?as(l):[]},we.uniqBy=function(l,p){return l&&l.length?as(l,nr(p,2)):[]},we.uniqWith=function(l,p){return p=typeof p=="function"?p:s,l&&l.length?as(l,s,p):[]},we.unset=function(l,p){return l==null||yu(l,p)},we.unzip=Vl,we.unzipWith=Ah,we.update=function(l,p,O){return l==null?l:ph(l,p,gh(O))},we.updateWith=function(l,p,O,ae){return ae=typeof ae=="function"?ae:s,l==null?l:ph(l,p,gh(O),ae)},we.values=Ka,we.valuesIn=function(l){return l==null?[]:Sa(l,fo(l))},we.without=Mc,we.words=Is,we.wrap=function(l,p){return Ec(gh(p),l)},we.xor=_c,we.xorBy=ud,we.xorWith=Xd,we.zip=Eu,we.zipObject=function(l,p){return fh(l||[],p||[],Dn)},we.zipObjectDeep=function(l,p){return fh(l||[],p||[],uc)},we.zipWith=Rh,we.entries=Zl,we.entriesIn=Kl,we.extend=jh,we.extendWith=jc,Di(we,we),we.add=Ku,we.attempt=hs,we.camelCase=md,we.capitalize=$l,we.ceil=ec,we.clamp=function(l,p,O){return O===s&&(O=p,p=s),O!==s&&(O=(O=oi(O))==O?O:0),p!==s&&(p=(p=oi(p))==p?p:0),ua(oi(l),p,O)},we.clone=function(l){return Xo(l,4)},we.cloneDeep=function(l){return Xo(l,5)},we.cloneDeepWith=function(l,p){return Xo(l,5,p=typeof p=="function"?p:s)},we.cloneWith=function(l,p){return Xo(l,4,p=typeof p=="function"?p:s)},we.conformsTo=function(l,p){return p==null||hu(l,p,Ui(p))},we.deburr=dl,we.defaultTo=function(l,p){return l==null||l!=l?p:l},we.divide=Ma,we.endsWith=function(l,p,O){l=Qr(l),p=Zo(p);var ae=l.length,pe=O=O===s?ae:ua(Cr(O),0,ae);return(O-=p.length)>=0&&l.slice(O,pe)==p},we.eq=$o,we.escape=function(l){return(l=Qr(l))&&rt.test(l)?l.replace(ve,Hs):l},we.escapeRegExp=function(l){return(l=Qr(l))&&Tn.test(l)?l.replace(jt,"\\$&"):l},we.every=function(l,p,O){var ae=yr(l)?va:El;return O&&Fo(l,p,O)&&(p=s),ae(l,nr(p,3))},we.find=Pu,we.findIndex=ol,we.findKey=function(l,p){return vr(l,nr(p,3),Oa)},we.findLast=ki,we.findLastIndex=Bl,we.findLastKey=function(l,p){return vr(l,nr(p,3),Ol)},we.floor=Qd,we.forEach=Ih,we.forEachRight=kh,we.forIn=function(l,p){return l==null?l:Pl(l,nr(p,3),fo)},we.forInRight=function(l,p){return l==null?l:_i(l,nr(p,3),fo)},we.forOwn=function(l,p){return l&&Oa(l,nr(p,3))},we.forOwnRight=function(l,p){return l&&Ol(l,nr(p,3))},we.get=Gu,we.gt=Oc,we.gte=Fu,we.has=function(l,p){return l!=null&&td(l,p,ah)},we.hasIn=ul,we.head=sl,we.identity=mo,we.includes=function(l,p,O,ae){l=Do(l)?l:Ka(l),O=O&&!ae?Cr(O):0;var pe=l.length;return O<0&&(O=di(pe+O,0)),Vu(l)?O<=pe&&l.indexOf(p,O)>-1:!!pe&&Si(l,p,O)>-1},we.indexOf=function(l,p,O){var ae=l==null?0:l.length;if(!ae)return-1;var pe=O==null?0:Cr(O);return pe<0&&(pe=di(ae+pe,0)),Si(l,p,pe)},we.inRange=function(l,p,O){return p=La(p),O===s?(O=p,p=0):O=La(O),function(ae,pe,Oe){return ae>=Ai(pe,Oe)&&ae<di(pe,Oe)}(l=oi(l),p,O)},we.invoke=fd,we.isArguments=ro,we.isArray=yr,we.isArrayBuffer=Ac,we.isArrayLike=Do,we.isArrayLikeObject=mi,we.isBoolean=function(l){return l===!0||l===!1||yi(l)&&po(l)==ee},we.isBuffer=Ra,we.isDate=Rc,we.isElement=function(l){return yi(l)&&l.nodeType===1&&!ql(l)},we.isEmpty=function(l){if(l==null)return!0;if(Do(l)&&(yr(l)||typeof l=="string"||typeof l.splice=="function"||Ra(l)||Yl(l)||ro(l)))return!l.length;var p=Ro(l);if(p==F||p==j)return!l.size;if(qa(l))return!Ii(l).length;for(var O in l)if(Wn.call(l,O))return!1;return!0},we.isEqual=function(l,p){return cc(l,p)},we.isEqualWith=function(l,p,O){var ae=(O=typeof O=="function"?O:s)?O(l,p):s;return ae===s?cc(l,p,s,O):!!ae},we.isError=Wl,we.isFinite=function(l){return typeof l=="number"&&xa(l)},we.isFunction=pa,we.isInteger=Lc,we.isLength=Os,we.isMap=Ic,we.isMatch=function(l,p){return l===p||lh(l,p,Th(p))},we.isMatchWith=function(l,p,O){return O=typeof O=="function"?O:s,lh(l,p,Th(p),O)},we.isNaN=function(l){return Jl(l)&&l!=+l},we.isNative=function(l){if(rd(l))throw new ut("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Yo(l)},we.isNil=function(l){return l==null},we.isNull=function(l){return l===null},we.isNumber=Jl,we.isObject=gi,we.isObjectLike=yi,we.isPlainObject=ql,we.isRegExp=ll,we.isSafeInteger=function(l){return Lc(l)&&l>=-9007199254740991&&l<=P},we.isSet=Xl,we.isString=Vu,we.isSymbol=fa,we.isTypedArray=Yl,we.isUndefined=function(l){return l===s},we.isWeakMap=function(l){return yi(l)&&Ro(l)==V},we.isWeakSet=function(l){return yi(l)&&po(l)=="[object WeakSet]"},we.join=function(l,p){return l==null?"":Ea.call(l,p)},we.kebabCase=Ls,we.last=Vo,we.lastIndexOf=function(l,p,O){var ae=l==null?0:l.length;if(!ae)return-1;var pe=ae;return O!==s&&(pe=(pe=Cr(O))<0?di(ae+pe,0):Ai(pe,ae-1)),p==p?function(Oe,qe,it){for(var wt=pe+1;wt--;)if(Oe[wt]===qe)return wt;return wt}(l,p):zt(l,lu,pe,!0)},we.lowerCase=Hu,we.lowerFirst=Wu,we.lt=Yd,we.lte=Zd,we.max=function(l){return l&&l.length?os(l,mo,sr):s},we.maxBy=function(l,p){return l&&l.length?os(l,nr(p,2),sr):s},we.mean=function(l){return Yr(l,mo)},we.meanBy=function(l,p){return Yr(l,nr(p,2))},we.min=function(l){return l&&l.length?os(l,mo,Xs):s},we.minBy=function(l,p){return l&&l.length?os(l,nr(p,2),Xs):s},we.stubArray=js,we.stubFalse=Ql,we.stubObject=function(){return{}},we.stubString=function(){return""},we.stubTrue=function(){return!0},we.multiply=gl,we.nth=function(l,p){return l&&l.length?$s(l,Cr(p)):s},we.noConflict=function(){return jr._===this&&(jr._=Co),this},we.noop=zo,we.now=fi,we.pad=function(l,p,O){l=Qr(l);var ae=(p=Cr(p))?Z(l):0;if(!p||ae>=p)return l;var pe=(p-ae)/2;return bu(Vi(pe),O)+l+bu(uo(pe),O)},we.padEnd=function(l,p,O){l=Qr(l);var ae=(p=Cr(p))?Z(l):0;return p&&ae<p?l+bu(p-ae,O):l},we.padStart=function(l,p,O){l=Qr(l);var ae=(p=Cr(p))?Z(l):0;return p&&ae<p?bu(p-ae,O)+l:l},we.parseInt=function(l,p,O){return O||p==null?p=0:p&&(p=+p),Ri(Qr(l).replace(mn,""),p||0)},we.random=function(l,p,O){if(O&&typeof O!="boolean"&&Fo(l,p,O)&&(p=O=s),O===s&&(typeof p=="boolean"?(O=p,p=s):typeof l=="boolean"&&(O=l,l=s)),l===s&&p===s?(l=0,p=1):(l=La(l),p===s?(p=l,l=0):p=La(p)),l>p){var ae=l;l=p,p=ae}if(O||l%1||p%1){var pe=Sl();return Ai(l+pe*(p-l+vs("1e-"+((pe+"").length-1))),p)}return Dr(l,p)},we.reduce=function(l,p,O){var ae=yr(l)?ko:zs,pe=arguments.length<3;return ae(l,nr(p,4),O,pe,Pa)},we.reduceRight=function(l,p,O){var ae=yr(l)?eo:zs,pe=arguments.length<3;return ae(l,nr(p,4),O,pe,sc)},we.repeat=function(l,p,O){return p=(O?Fo(l,p,O):p===s)?1:Cr(p),ba(Qr(l),p)},we.replace=function(){var l=arguments,p=Qr(l[0]);return l.length<3?p:p.replace(l[1],l[2])},we.result=function(l,p,O){var ae=-1,pe=(p=Ds(p,l)).length;for(pe||(pe=1,l=s);++ae<pe;){var Oe=l==null?s:l[da(p[ae])];Oe===s&&(ae=pe,Oe=O),l=pa(Oe)?Oe.call(l):Oe}return l},we.round=Bh,we.runInContext=Me,we.sample=function(l){return(yr(l)?Dl:function(p){return Dl(Ka(p))})(l)},we.size=function(l){if(l==null)return 0;if(Do(l))return Vu(l)?Z(l):l.length;var p=Ro(l);return p==F||p==j?l.size:Ii(l).length},we.snakeCase=Ju,we.some=function(l,p,O){var ae=yr(l)?Va:Gh;return O&&Fo(l,p,O)&&(p=s),ae(l,nr(p,3))},we.sortedIndex=function(l,p){return gu(l,p)},we.sortedIndexBy=function(l,p,O){return uh(l,p,nr(O,2))},we.sortedIndexOf=function(l,p){var O=l==null?0:l.length;if(O){var ae=gu(l,p);if(ae<O&&$o(l[ae],p))return ae}return-1},we.sortedLastIndex=function(l,p){return gu(l,p,!0)},we.sortedLastIndexBy=function(l,p,O){return uh(l,p,nr(O,2),!0)},we.sortedLastIndexOf=function(l,p){if(l!=null&&l.length){var O=gu(l,p,!0)-1;if($o(l[O],p))return O}return-1},we.startCase=Vc,we.startsWith=function(l,p,O){return l=Qr(l),O=O==null?0:ua(Cr(O),0,l.length),p=Zo(p),l.slice(O,O+p.length)==p},we.subtract=gd,we.sum=function(l){return l&&l.length?Bi(l,mo):0},we.sumBy=function(l,p){return l&&l.length?Bi(l,nr(p,2)):0},we.template=function(l,p,O){var ae=we.templateSettings;O&&Fo(l,p,O)&&(p=s),l=Qr(l),p=jc({},p,ae,cs);var pe,Oe,qe=jc({},p.imports,ae.imports,cs),it=Ui(qe),wt=Sa(qe,it),mt=0,Nt=p.interpolate||lt,Qt="__p += '",An=Hn((p.escape||lt).source+"|"+Nt.source+"|"+(Nt===Rt?st:lt).source+"|"+(p.evaluate||lt).source+"|$","g"),jn="//# sourceURL="+(Wn.call(p,"sourceURL")?(p.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++oa+"]")+`
`;l.replace(An,function(an,Nn,wn,pr,lr,Er){return wn||(wn=pr),Qt+=l.slice(mt,Er).replace(Wt,Mo),Nn&&(pe=!0,Qt+=`' +
__e(`+Nn+`) +
'`),lr&&(Oe=!0,Qt+=`';
`+lr+`;
__p += '`),wn&&(Qt+=`' +
((__t = (`+wn+`)) == null ? '' : __t) +
'`),mt=Er+an.length,an}),Qt+=`';
`;var $n=Wn.call(p,"variable")&&p.variable;if($n){if(Xn.test($n))throw new ut("Invalid `variable` option passed into `_.template`")}else Qt=`with (obj) {
`+Qt+`
}
`;Qt=(Oe?Qt.replace(Re,""):Qt).replace(Ye,"$1").replace(Be,"$1;"),Qt="function("+($n||"obj")+`) {
`+($n?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(pe?", __e = _.escape":"")+(Oe?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Qt+`return __p
}`;var Ut=hs(function(){return Lt(it,jn+"return "+Qt).apply(s,wt)});if(Ut.source=Qt,Wl(Ut))throw Ut;return Ut},we.times=function(l,p){if((l=Cr(l))<1||l>P)return[];var O=B,ae=Ai(l,B);p=nr(p),l-=B;for(var pe=ws(ae,p);++O<l;)p(O);return pe},we.toFinite=La,we.toInteger=Cr,we.toLength=cl,we.toLower=function(l){return Qr(l).toLowerCase()},we.toNumber=oi,we.toSafeInteger=function(l){return l?ua(Cr(l),-9007199254740991,P):l===0?l:0},we.toString=Qr,we.toUpper=function(l){return Qr(l).toUpperCase()},we.trim=function(l,p,O){if((l=Qr(l))&&(O||p===s))return Us(l);if(!l||!(p=Zo(p)))return l;var ae=te(l),pe=te(p);return Es(ae,cu(ae,pe),bs(ae,pe)+1).join("")},we.trimEnd=function(l,p,O){if((l=Qr(l))&&(O||p===s))return l.slice(0,de(l)+1);if(!l||!(p=Zo(p)))return l;var ae=te(l);return Es(ae,0,bs(ae,te(p))+1).join("")},we.trimStart=function(l,p,O){if((l=Qr(l))&&(O||p===s))return l.replace(mn,"");if(!l||!(p=Zo(p)))return l;var ae=te(l);return Es(ae,cu(ae,te(p))).join("")},we.truncate=function(l,p){var O=30,ae="...";if(gi(p)){var pe="separator"in p?p.separator:pe;O="length"in p?Cr(p.length):O,ae="omission"in p?Zo(p.omission):ae}var Oe=(l=Qr(l)).length;if(fr(l)){var qe=te(l);Oe=qe.length}if(O>=Oe)return l;var it=O-Z(ae);if(it<1)return ae;var wt=qe?Es(qe,0,it).join(""):l.slice(0,it);if(pe===s)return wt+ae;if(qe&&(it+=wt.length-it),ll(pe)){if(l.slice(it).search(pe)){var mt,Nt=wt;for(pe.global||(pe=Hn(pe.source,Qr(qt.exec(pe))+"g")),pe.lastIndex=0;mt=pe.exec(Nt);)var Qt=mt.index;wt=wt.slice(0,Qt===s?it:Qt)}}else if(l.indexOf(Zo(pe),it)!=it){var An=wt.lastIndexOf(pe);An>-1&&(wt=wt.slice(0,An))}return wt+ae},we.unescape=function(l){return(l=Qr(l))&&Ee.test(l)?l.replace(se,fe):l},we.uniqueId=function(l){var p=++la;return Qr(l)+p},we.upperCase=Go,we.upperFirst=pl,we.each=Ih,we.eachRight=kh,we.first=sl,Di(we,(ml={},Oa(we,function(l,p){Wn.call(we.prototype,p)||(ml[p]=l)}),ml),{chain:!1}),we.VERSION="4.17.21",Ci(["bind","bindKey","curry","curryRight","partial","partialRight"],function(l){we[l].placeholder=we}),Ci(["drop","take"],function(l,p){wr.prototype[l]=function(O){O=O===s?1:di(Cr(O),0);var ae=this.__filtered__&&!p?new wr(this):this.clone();return ae.__filtered__?ae.__takeCount__=Ai(O,ae.__takeCount__):ae.__views__.push({size:Ai(O,B),type:l+(ae.__dir__<0?"Right":"")}),ae},wr.prototype[l+"Right"]=function(O){return this.reverse()[l](O).reverse()}}),Ci(["filter","map","takeWhile"],function(l,p){var O=p+1,ae=O==1||O==3;wr.prototype[l]=function(pe){var Oe=this.clone();return Oe.__iteratees__.push({iteratee:nr(pe,3),type:O}),Oe.__filtered__=Oe.__filtered__||ae,Oe}}),Ci(["head","last"],function(l,p){var O="take"+(p?"Right":"");wr.prototype[l]=function(){return this[O](1).value()[0]}}),Ci(["initial","tail"],function(l,p){var O="drop"+(p?"":"Right");wr.prototype[l]=function(){return this.__filtered__?new wr(this):this[O](1)}}),wr.prototype.compact=function(){return this.filter(mo)},wr.prototype.find=function(l){return this.filter(l).head()},wr.prototype.findLast=function(l){return this.reverse().find(l)},wr.prototype.invokeMap=Lr(function(l,p){return typeof l=="function"?new wr(this):this.map(function(O){return Zi(O,l,p)})}),wr.prototype.reject=function(l){return this.filter(Hl(nr(l)))},wr.prototype.slice=function(l,p){l=Cr(l);var O=this;return O.__filtered__&&(l>0||p<0)?new wr(O):(l<0?O=O.takeRight(-l):l&&(O=O.drop(l)),p!==s&&(O=(p=Cr(p))<0?O.dropRight(-p):O.take(p-l)),O)},wr.prototype.takeRightWhile=function(l){return this.reverse().takeWhile(l).reverse()},wr.prototype.toArray=function(){return this.take(B)},Oa(wr.prototype,function(l,p){var O=/^(?:filter|find|map|reject)|While$/.test(p),ae=/^(?:head|last)$/.test(p),pe=we[ae?"take"+(p=="last"?"Right":""):p],Oe=ae||/^find/.test(p);pe&&(we.prototype[p]=function(){var qe=this.__wrapped__,it=ae?[1]:arguments,wt=qe instanceof wr,mt=it[0],Nt=wt||yr(qe),Qt=function(Nn){var wn=pe.apply(we,bo([Nn],it));return ae&&An?wn[0]:wn};Nt&&O&&typeof mt=="function"&&mt.length!=1&&(wt=Nt=!1);var An=this.__chain__,jn=!!this.__actions__.length,$n=Oe&&!An,Ut=wt&&!jn;if(!Oe&&Nt){qe=Ut?qe:new wr(this);var an=l.apply(qe,it);return an.__actions__.push({func:Tc,args:[Qt],thisArg:s}),new Tr(an,An)}return $n&&Ut?l.apply(this,it):(an=this.thru(Qt),$n?ae?an.value()[0]:an.value():an)})}),Ci(["pop","push","shift","sort","splice","unshift"],function(l){var p=lo[l],O=/^(?:push|sort|unshift)$/.test(l)?"tap":"thru",ae=/^(?:pop|shift)$/.test(l);we.prototype[l]=function(){var pe=arguments;if(ae&&!this.__chain__){var Oe=this.value();return p.apply(yr(Oe)?Oe:[],pe)}return this[O](function(qe){return p.apply(yr(qe)?qe:[],pe)})}}),Oa(wr.prototype,function(l,p){var O=we[p];if(O){var ae=O.name+"";Wn.call(It,ae)||(It[ae]=[]),It[ae].push({name:p,func:O})}}),It[xu(s,2).name]=[{name:"wrapper",func:s}],wr.prototype.clone=function(){var l=new wr(this.__wrapped__);return l.__actions__=Ko(this.__actions__),l.__dir__=this.__dir__,l.__filtered__=this.__filtered__,l.__iteratees__=Ko(this.__iteratees__),l.__takeCount__=this.__takeCount__,l.__views__=Ko(this.__views__),l},wr.prototype.reverse=function(){if(this.__filtered__){var l=new wr(this);l.__dir__=-1,l.__filtered__=!0}else(l=this.clone()).__dir__*=-1;return l},wr.prototype.value=function(){var l=this.__wrapped__.value(),p=this.__dir__,O=yr(l),ae=p<0,pe=O?l.length:0,Oe=function(Er,Bn,zn){for(var ui=-1,ri=zn.length;++ui<ri;){var ji=zn[ui],zr=ji.size;switch(ji.type){case"drop":Er+=zr;break;case"dropRight":Bn-=zr;break;case"take":Bn=Ai(Bn,Er+zr);break;case"takeRight":Er=di(Er,Bn-zr)}}return{start:Er,end:Bn}}(0,pe,this.__views__),qe=Oe.start,it=Oe.end,wt=it-qe,mt=ae?it:qe-1,Nt=this.__iteratees__,Qt=Nt.length,An=0,jn=Ai(wt,this.__takeCount__);if(!O||!ae&&pe==wt&&jn==wt)return ha(l,this.__actions__);var $n=[];e:for(;wt--&&An<jn;){for(var Ut=-1,an=l[mt+=p];++Ut<Qt;){var Nn=Nt[Ut],wn=Nn.iteratee,pr=Nn.type,lr=wn(an);if(pr==2)an=lr;else if(!lr){if(pr==1)continue e;break e}}$n[An++]=an}return $n},we.prototype.at=Gl,we.prototype.chain=function(){return Lh(this)},we.prototype.commit=function(){return new Tr(this.value(),this.__chain__)},we.prototype.next=function(){this.__values__===s&&(this.__values__=dd(this.value()));var l=this.__index__>=this.__values__.length;return{done:l,value:l?s:this.__values__[this.__index__++]}},we.prototype.plant=function(l){for(var p,O=this;O instanceof on;){var ae=Ya(O);ae.__index__=0,ae.__values__=s,p?pe.__wrapped__=ae:p=ae;var pe=ae;O=O.__wrapped__}return pe.__wrapped__=l,p},we.prototype.reverse=function(){var l=this.__wrapped__;if(l instanceof wr){var p=l;return this.__actions__.length&&(p=new wr(this)),(p=p.reverse()).__actions__.push({func:Tc,args:[wc],thisArg:s}),new Tr(p,this.__chain__)}return this.thru(wc)},we.prototype.toJSON=we.prototype.valueOf=we.prototype.value=function(){return ha(this.__wrapped__,this.__actions__)},we.prototype.first=we.prototype.head,ni&&(we.prototype[ni]=function(){return this}),we}();Ce?((Ce.exports=_e)._=_e,K._=_e):jr._=_e}).call(commonjsGlobal)}),MrxDbgUiPrBaseReturn;async function useCanvasResizeListener(b,r,s=100){if(!store.state.MxFun)return void console.error("loadCoreCode! ");if(!b)return void console.error("mxdrawObj MxFun.createMxObjectcallbackmxDraw");let o=b;if(!o.isLoadCanvasResizeListene){let v;o.isLoadCanvasResizeListene=!0,b.addEvent("addResizeEvent",w=>{v=w}),await dynamicImport("element-resize-event-polyfill");let u=createCanvasParent(r);u.addEventListener?u.addEventListener("resize",lodash.throttle(function(w){v&&v()},s),!1):console.log("mx: parentdiv[addEventListener] invalid")}}class McEdGetPointWorldDrawObject{constructor(){var r;this._McEdGetPointWorldDraw=new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().McEdGetPointWorldDrawObjectClass()),this._get=()=>this._McEdGetPointWorldDraw}drawCircle(r,s){return this._McEdGetPointWorldDraw.drawCircle(r,s)}drawLine(r,s){return this._McEdGetPointWorldDraw.drawLine(r,s)}drawSolid(r,s){this.drawSolid(r,s)}drawRect(r,s){return this._McEdGetPointWorldDraw.drawRect(r,s)}drawEntity(r,s){return this._McEdGetPointWorldDraw.drawEntity(r,s)}drawMcDbEntity(r,s){return this._McEdGetPointWorldDraw.drawMcDbEntity(r,s)}drawMcDbLine(r,s,o,v,u,w){return this._McEdGetPointWorldDraw.drawMcDbLine(r,s,o,v,u,w)}drawText(r,s,o,v){return this._McEdGetPointWorldDraw.drawText(r,s,o,v)}setDraw(r){return this._McEdGetPointWorldDraw.setDraw(r)}setColor(r){return this._McEdGetPointWorldDraw.setColor(r)}getColor(){return this._McEdGetPointWorldDraw.getColor()}drawCustomEntity(r,s){return this._McEdGetPointWorldDraw.drawCustomEntity(r,s)}}(function(b){b[b.kCancel=-2]="kCancel",b[b.kNone=-1]="kNone",b[b.kOk=0]="kOk",b[b.kKeyWord=1]="kKeyWord"})(MrxDbgUiPrBaseReturn||(MrxDbgUiPrBaseReturn={}));var MrxDbgUiPrBaseReturn$1=MrxDbgUiPrBaseReturn,MxCursorType,DynamicInputType,DetailedResult,UserInputControls;(function(b){b[b.kNormal=0]="kNormal",b[b.kRect=1]="kRect",b[b.kCross=2]="kCross"})(MxCursorType||(MxCursorType={})),function(b){b[b.kNoInput=0]="kNoInput",b[b.kXYCoordInput=1]="kXYCoordInput",b[b.kDistanceInput=2]="kDistanceInput",b[b.kDynTip=3]="kDynTip",b[b.kAutoInput=4]="kAutoInput",b[b.kAngleInput=5]="kAngleInput"}(DynamicInputType||(DynamicInputType={})),function(b){b[b.kUnknown=1]="kUnknown",b[b.kTouchDownIn=2]="kTouchDownIn",b[b.kTouchUpIn=3]="kTouchUpIn",b[b.kMouseLeftIn=4]="kMouseLeftIn",b[b.kMouseLeftUpIn=5]="kMouseLeftUpIn",b[b.kMouseRightIn=6]="kMouseRightIn",b[b.kKeyIn=7]="kKeyIn",b[b.kCoordIn=8]="kCoordIn",b[b.kNullEnterIn=9]="kNullEnterIn",b[b.kNullSpaceIn=10]="kNullSpaceIn",b[b.kEcsIn=11]="kEcsIn",b[b.kNewCommadIn=12]="kNewCommadIn",b[b.kCodeAbort=13]="kCodeAbort"}(DetailedResult||(DetailedResult={})),function(b){b[b.kGovernedByOrthoMode=1]="kGovernedByOrthoMode",b[b.kNullResponseAccepted=2]="kNullResponseAccepted",b[b.kDontEchoCancelForCtrlC=4]="kDontEchoCancelForCtrlC",b[b.kDontUpdateLastPoint=8]="kDontUpdateLastPoint",b[b.kNoDwgLimitsChecking=16]="kNoDwgLimitsChecking",b[b.kNoZeroResponseAccepted=32]="kNoZeroResponseAccepted",b[b.kNoNegativeResponseAccepted=64]="kNoNegativeResponseAccepted",b[b.kAccept3dCoordinates=128]="kAccept3dCoordinates",b[b.kAcceptMouseUpAsPoint=256]="kAcceptMouseUpAsPoint",b[b.kAnyBlankTerminatesInput=512]="kAnyBlankTerminatesInput",b[b.kInitialBlankTerminatesInput=1024]="kInitialBlankTerminatesInput",b[b.kAcceptOtherInputString=2048]="kAcceptOtherInputString",b[b.kGovernedByUCSDetect=4096]="kGovernedByUCSDetect",b[b.kNoZDirectionOrtho=8192]="kNoZDirectionOrtho",b[b.kSpacesInAccepted=16384]="kSpacesInAccepted"}(UserInputControls||(UserInputControls={}));class MrxDbgUiPrBase{constructor(r){this.imp=r,this.status=MrxDbgUiPrBaseReturn$1.kCancel}keyWords(){return this.imp.keyWords()}setKeyWords(r){return this.imp.setKeyWords(r)}message(){return this.imp.message()}setMessage(r){return this.imp.setMessage(r)}clearLastInputPoint(){this.imp.clearLastInputPoint()}setLastInputPoint(r){this.imp.SetLASTPOINT(r)}keyWordPicked(){return this.imp.keyWordPicked()}isKeyWordPicked(r){return this.status==MrxDbgUiPrBaseReturn$1.kKeyWord&&this.imp.isKeyWordPicked(r)}setUserDraw(r){if(typeof r!="function")return this.imp.setUserDraw(r._get?r._get():r);{const s=new McEdGetPointWorldDrawObject;s.setDraw(r),this.imp.setUserDraw(s._get())}}getDetailedResult(){return this.imp.getDetailedResult()}getStatus(){return this.status}drawReserve(r){return this.imp.drawReserve(r)}setInputToucheType(r){return this.imp.setInputToucheType(r)}getInputToucheType(){return this.imp.getInputToucheType()}setCursorType(r){this.imp.setCursorType(r)}getCursorType(){return this.imp.getCursorType()}setDynamicInputType(r){this.imp.setDynamicInputType(r)}getDynamicInputType(){return this.imp.getDynamicInputType()}isDisableDynInput(){return this.imp.isDisableDynInput()}setDisableDynInput(r){return this.imp.setDisableDynInput(r)}setDisableOsnap(r){return this.imp.setDisableOsnap(r)}isOffsetInputPostion(){return this.imp.isOffsetInputPostion()}setOffsetInputPostion(r){return this.imp.setOffsetInputPostion(r)}isDisableOsnap(){return this.imp.isDisableOsnap()}setDisableDynamicTrace(r){this.imp.setDisableDynamicTrace(r)}isDisableDynamicTrace(){return this.imp.isDisableDynamicTrace()}setDisablePolarAxisTrace(r){this.imp.setDisablePolarAxisTrace(r)}isDisablePolarAxisTrace(){return this.imp.isDisablePolarAxisTrace()}setDisableGridTrace(r){this.imp.setDisableGridTrace(r)}isDisableGridTrace(){return this.imp.isDisableGridTrace()}setDisableOrthoTrace(r){this.imp.setDisableOrthoTrace(r)}isDisableOrthoTrace(){return this.imp.isDisableOrtho()}disableAllTrace(r=!0){this.imp.disableAllTrace(r)}userInputControls(){return this.imp.userInputControls()}setUserInputControls(r){this.imp.setUserInputControls(r)}}class MrxDbgUiPrPoint extends MrxDbgUiPrBase{constructor(){var r;super(new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().getMrxDbgUiPrPointClass()))}value(){return this.imp.value()}getCADValue(){return this.imp.getCADValue()}valueDocCoord(){return this.imp.valueDocCoord()}basePt(){return this.imp.basePt()}setBasePt(r){return this.imp.setBasePt(r)}setUseBasePt(r){return this.imp.setUseBasePt(r)}go(r){let s=this;return r?(s.imp.go(o=>{s.status=o,r(o)}),new Promise((o,v)=>{o(null)})):new Promise((o,v)=>{s.imp.go(u=>{s.status=u,o(u!=0?null:s.imp.value())})})}goWhile(r,s){return this.imp.goWhile(r,s)}abort(r){this.imp.abort(r)}}class MxVueComandLine{constructor(){this.msCmdText="",this.msCmdDisplay="",this.msCmdTip="",this.mxFunObject=void 0,this.mountUpDisplayFun=r=>{this.mUpDisplayFun=r},this.setCmdText=r=>{this.msCmdText=r},this.getCmdText=()=>this.msCmdText,this.getCmdDisplay=()=>this.msCmdDisplay,this.setCmdDisplay=r=>{this.msCmdDisplay=r},this.addCmdDisplay=r=>{this.msCmdDisplay.length>1024?(this.msCmdDisplay=this.msCmdDisplay.substring(this.msCmdDisplay.length-1024,this.msCmdDisplay.length),this.msCmdDisplay=this.msCmdDisplay+r):this.msCmdDisplay=this.msCmdDisplay+r},this.setCmdTip=r=>{this.msCmdTip=r},this.getCmdTip=()=>this.msCmdTip}upDisplay(){const{msCmdTip:r,msCmdDisplay:s,msCmdText:o}=this;this.mUpDisplayFun!=null&&this.mUpDisplayFun({msCmdTip:r,msCmdDisplay:s,msCmdText:o})}}const MxInputType={kNoInput:0,kXYCoordInput:1,kDistanceInput:2,kDynTip:3},MxInputPostionType={kRelative:0,kAbsolutely:1};class MxDynamicInput{constructor(){this.mType=MxInputType.kNoInput,this.mPos=[0,0],this.mTip="",this.mValue1="",this.mValue1Pos=[0,0],this.mValue2="",this.mValue2Pos=[0,0],this.misShow=!1,this.focusIndex=0,this.mOnKeydownEvent=void 0,this.mFocusValue="",this.setFocusValue=r=>{this.mFocusValue=r},this.getFocusValue=()=>this.mFocusValue,this.getFocusIndex=()=>this.focusIndex,this.setFocusIndex=r=>{this.focusIndex=r},this.mountKeydownEvent=r=>{this.mOnKeydownEvent=r},this.onKeydown=r=>{this.mOnKeydownEvent!=null&&this.mOnKeydownEvent(r)},this.setType=r=>{this.mType=r},this.getType=()=>this.mType,this.isShow=()=>this.misShow,this.setPos=r=>{this.mPos=r},this.setTip=r=>{this.mTip=r},this.setValue1=r=>{this.mValue1=r},this.getValue1=()=>this.mValue1,this.setValue1Pos=r=>{this.mValue1Pos=r},this.setValue2=r=>{this.mValue2=r},this.getValue2=()=>this.mValue2,this.setValue2Pos=r=>{this.mValue2Pos=r},this.setShow=r=>{this.misShow=r},this.getData=()=>{if(!this.misShow)return;let r={list:[{value:"",readonly:!0},{value:"",readonly:!1},{value:"",readonly:!1}],pos:this.mPos,postype:MxInputPostionType.kRelative};return this.mType!=MxInputType.kNoInput?(this.mType==MxInputType.kXYCoordInput?(r.list[0].show=!0,r.list[0].value=this.mTip,r.list[0].readonly=!0,r.list[1].show=!0,r.list[1].value=this.mValue1,r.list[1].readonly=!1,r.list[2].show=!0,r.list[2].value=this.mValue2,r.list[2].readonly=!1):this.mType==MxInputType.kDistanceInput?(r.list[0].show=!0,r.list[0].value=this.mTip,r.list[0].readonly=!0,r.list[1].show=!0,r.list[1].value=this.mValue1,r.list[1].readonly=!1,r.list[1].pos=this.mValue1Pos,r.list[2].show=!0,r.list[2].value=this.mValue2,r.list[2].readonly=!1,r.list[2].pos=this.mValue2Pos,r.postype=MxInputPostionType.kAbsolutely):this.mType==MxInputType.kDynTip?(r.list[0].show=!0,r.list[0].value=this.mTip,r.list[0].readonly=!0,r.list[1].show=!1,r.list[2].show=!1):r=void 0,r):void 0}}}const CursorType={kNormal:"Normal",kRect:"Rect",kCross:"Cross",kPan:"Pan"};class MxVueInterface{constructor(){this.mSetCoordFun=void 0,this.mUpdateCursorFun=void 0,this.mOnKeydownEvent=void 0,this.mCursorType=CursorType.kNormal,this.mComandLine=new MxVueComandLine,this.mdynamicInput=new MxDynamicInput,this.mMxEvents={},this.mountSetCoordFun=r=>{this.mSetCoordFun=r},this.mountUpdateCursorFun=r=>{this.mUpdateCursorFun=r},this.mountKeydownEvent=r=>{this.mOnKeydownEvent=r},this.onKeydown=r=>{this.mOnKeydownEvent!=null&&this.mOnKeydownEvent(r)},this.setTipCoord=r=>{this.mSetCoordFun!=null&&this.mSetCoordFun(r)},this.getCursorType=()=>this.mCursorType,this.setCursorType=r=>{if(typeof r=="number")switch(r){case 0:this.mCursorType=CursorType.kNormal;break;case 1:this.mCursorType=CursorType.kRect;break;case 2:this.mCursorType=CursorType.kCross;break;case 3:this.mCursorType=CursorType.kPan}else this.mCursorType=r;this.mUpdateCursorFun!=null&&this.mUpdateCursorFun(this.mCursorType)},this.getTitle=()=>this.mTitle,this.getTopButtonBarData=()=>this.mTopButtonBarData,this.getMenuBarData=()=>this.mMenuBarData,this.getRighButtonBarData=()=>this.mRighButtonBarData,this.getLeftButtonBarData=()=>this.mLeftButtonBarData,this.getTitleButtonBarData=()=>this.mTitleButtonBarData,this.getLayerComboxData=()=>this.mLayerComboxData,this.getColorComboxData=()=>this.mColorComboxData,this.getLinetypeComboxData=()=>this.mLinetypeComboxData,this.getFooterData=()=>this.mFooterData,this.sendStringToExecute=r=>{this.mxFunObject.sendStringToExecute(r)},this.getCmdLine=()=>this.mComandLine,this.getDynamicInput=()=>this.mdynamicInput,this.init=r=>{this.mxFunObject=r},this.OnMxEvent=r=>{const s=r.name;if(s==null)return;const o=this.mMxEvents[s];o!=null&&o(r.param)},this.mountMxEvent=(r,s)=>{this.mMxEvents[r]=s}}}const mxUiData$1=new MxVueInterface;function createReandomId(b=10){return new Number(Math.random().toString().substr(3,b)+Date.now()).toString(36)}class Node extends PubSub{constructor(){super(...arguments),this.parent=null,this.children=[]}add(...r){if(r.length>1){for(let o=0;o<r.length;o++){const v=r[o];this.add(v)}return this}const s=r[0];return s===this?(console.error("Node.add "),this):(s&&(s.parent!==null&&s.parent.remove(s),s.parent=this,this.children.push(s)),this)}remove(...r){r.length>1&&r.forEach(v=>{this.remove(v)});const s=r[0],o=this.children.indexOf(s);return o!==-1&&(s.parent=null,this.children.splice(o,1)),this}removeFromParent(){const r=this.parent;return r!==null&&r.remove(this),this}clear(){for(let r=0;r<this.children.length;r++)this.children[r].parent=null;return this.children.length=0,this}getNodeByProperty(r,s){if(this[r]===s)return this;for(let o=0,v=this.children.length;o<v;o++){const u=this.children[o].getNodeByProperty(r,s);if(u!==void 0)return u}}getNodesByProperty(r,s){let o=[];this[r]===s&&o.push(this);for(let v=0,u=this.children.length;v<u;v++){const w=this.children[v].getNodesByProperty(r,s);w.length>0&&(o=o.concat(w))}return o}traverse(r){r(this);const s=this.children;for(let o=0,v=s.length;o<v;o++)s[o].traverse(r)}traverseParent(r){this.parent!==null&&r(this.parent)!==!1&&this.parent.traverseParent(r)}emit(r,...s){super.emit(r,...s),this.traverseParent(o=>(o.emit(r,...s),(s==null?void 0:s.isEventBubbling)!==!1&&void 0))}}class RenderOrderNode extends Node{constructor(){super(),this.renderOrder=30}setRenderOrder(r){this.renderOrder=r}getRenderOrder(){return this.renderOrder}top(){var r;if(!this.parent)return;let s=Math.max(...(r=this.parent)===null||r===void 0?void 0:r.children.map(({renderOrder:o})=>o));s!==this.renderOrder&&s++,this.setRenderOrder(s)}bottom(){var r;if(!this.parent)return;let s=Math.min(...(r=this.parent)===null||r===void 0?void 0:r.children.map(({renderOrder:o})=>o));s--,this.setRenderOrder(s)}restoreDefaultRenderOrder(){this.renderOrder=30}}class Layer extends RenderOrderNode{constructor(r){super(),this.isLayer=!0,this.getLayerMap=()=>this.getDatabase()._mxDatabase.mapNameToLayer,this.getEntityMap=()=>this.getDatabase()._mxDatabase.mapIdToEntity,this.getRootLayerName=()=>this.getNames()[0]||"0";const s=typeof r=="string"?r:Date.now()+Math.random().toString(36).substr(2,9);Object.defineProperty(this,"name",{get:()=>s,set(){throw new Error("Layer.name, Layer ")},configurable:!1});let o=this.renderOrder;Object.defineProperty(this,"renderOrder",{get:()=>o,set(v){this.getLayer().group.renderOrder=v,o=v,MxFun.updateDisplay()}})}get visible(){const r=this.getDatabase().getLayer(this.name);return!r||r.getVisible()}set visible(r){this.getDatabase().showLayer(this.name,r),MxFun.updateDisplay()}setVisible(r){this.visible=r}getDatabase(){return this._database||(this._database=MxFun.getCurrentDatabase()),this._database}getLayer(){return this.getDatabase().getLayer(this.name)||this.getDatabase().addLayer(this.name),this.getDatabase().getLayer(this.name)}getCurrentName(){return this.getDatabase()._mxDatabase.curLayer.toString()}async callLayerContextFun(r){const s=this.getCurrentName();this.getDatabase().setCurrentLayer(this.name);const o=await r();return this.getDatabase().setCurrentLayer(s),o}getNames(){return Array.from(this.getLayerMap().keys())}getAllEntity(){return Array.from(this.getEntityMap().values()).filter(({userObject:r})=>r.layer===this.name).map(({userObject:r})=>r)}add(...r){var s;const o=this.getLayer();return o.group.renderOrder!==this.renderOrder&&(o.group.renderOrder=this.renderOrder,this.children=this.getAllEntity()),this.parent||(this.parent=MxFun.getCurrentDraw(),(s=this.parent)===null||s===void 0||s.add(this)),super.add(...r),this.callLayerContextFun(()=>{r.forEach(v=>{v&&this.getDatabase().addEntity(v)})}),this}remove(...r){super.remove(...r);let s=this.getRootLayerName();return this.callLayerContextFun(()=>{r.forEach(o=>{o&&(o.setLayer(s),o.setNeedUpdateDisplay())})}),this}}class MxDbDatabase{constructor(r){this._mxDatabase=r}addLayer(r){return this._mxDatabase.addLayer(r)}showLayer(r,s){this._mxDatabase.showLayer(r,s)}setCurrentLayer(r){return this._mxDatabase.setCurrentLayer(r)}getLayer(r){return this._mxDatabase.getLayer(r)}addEntity(r){return this._mxDatabase.addMxEntity(r)}getGroup(r){return this._mxDatabase.getGroupDictionary().getAt(r)}addGroup(r){return this._mxDatabase.getGroupDictionary().add(r)}getEntityInGroup(r){return this._mxDatabase.getGroupDictionary().getEntityInGroup(r)}deleteGroup(r){return this._mxDatabase.getGroupDictionary().delete(r)}}function setGeometrPostion(b,r){for(let s=0;s<b.vertices.length;s++)b.vertices[s].x+=r.x,b.vertices[s].y+=r.y,b.vertices[s].z+=r.z}function repairGeometryFaceVertexUvs(b){b.computeBoundingBox();const r=b.boundingBox.min,s=b.boundingBox.max,o=new THREE.Vector2(0-r.x,0-r.y),v=new THREE.Vector2(s.x-r.x,s.y-r.y);b.faceVertexUvs[0]=[];const u=b.faces;for(let w=0;w<u.length;w++){const L=u[w],U=b.vertices[L.a],N=b.vertices[L.b],D=b.vertices[L.c];b.faceVertexUvs[0].push([new THREE.Vector2((U.x+o.x)/v.x,(U.y+o.y)/v.y),new THREE.Vector2((N.x+o.x)/v.x,(N.y+o.y)/v.y),new THREE.Vector2((D.x+o.x)/v.x,(D.y+o.y)/v.y)])}return b.uvsNeedUpdate=!0,b}function insertPointsWithEqualSpacing(b){const r=[];if(b.length<2)return b;let s=Number.MAX_VALUE;for(let o=0;o<b.length-1;o++){const v=b[o].distanceTo(b[o+1]);v<s&&(s=v)}for(let o=0;o<b.length-1;o++){const v=b[o],u=b[o+1];r.push(v);const w=v.distanceTo(u);if(w>s){const L=Math.floor(w/s),U=u.clone().sub(v).normalize();for(let N=1;N<L;N++){const D=v.clone().add(U.clone().multiplyScalar(N*s));r.push(D)}}}return r.push(b[b.length-1]),r}function getToGenerateRoundedCorners(b,r,s=!0){const o=new THREE.CurvePath;if(b.length<2)throw new Error("Points should have at least 2 items");if(!r||r.length===0)return b;!s&&b[0].equals(b[b.length-1])&&b.pop(),s||b.push(b[0]);for(let u=0;u<b.length-1;u++){const w=r[u]||0;if(u===0&&!s){const T=b[0].clone().sub(b[1]);T.normalize();const B=b[1].clone();B.add(T.clone().multiplyScalar(w));const G=new THREE.LineCurve3(b[0],B);o.curves.push(G);continue}const L=!s||b[u-1]?b[u-1].clone().sub(b[u]):b[b.length-1].clone().sub(b[0]);L.normalize();const U=!s||b[u+1]?b[u+1].clone().sub(b[u]):b[1].clone().sub(b[0]);U.normalize();const N=b[u].clone().add(L.clone().multiplyScalar(w)),D=b[u].clone(),f=b[u].clone().add(U.clone().multiplyScalar(w)),P=new THREE.QuadraticBezierCurve3(N,D,f);if(u===b.length-2){const T=b[u].clone().add(U.clone().multiplyScalar(w)),B=b[u+1].clone();s?B.add(U.clone().multiplyScalar(-w)):B.add(U.clone());const G=new THREE.LineCurve3(T,B);o.curves.push(P,G)}else o.curves.push(P);u===0&&b.push(b[0])}let v=o.getPoints();return v=insertPointsWithEqualSpacing(v)}function computeRectPoints(b,r){return[b,b.clone().set(r.x,b.y,r.z),r,r.clone().set(b.x,r.y,b.z)]}function calculateArcOrigin(b,r,s){const o=b.x,v=r.x,u=s.x,w=b.y,L=r.y,U=s.y,N=o-v,D=w-L,f=o-u,P=w-U,T=(o*o-v*v+(w*w-L*L))/2,B=(o*o-u*u+(w*w-U*U))/2,G=D*f-N*P,R=-(P*T-D*B)/G,_=-(N*B-f*T)/G;return new THREE.Vector3(R,_,0)}function calculateRadiusArc(b,r){const s=b.x,o=b.y,v=r.x,u=r.y;return Math.sqrt((s-v)*(s-v)+(o-u)*(o-u))}function calculateArcAngle(b,r,s){const o=b.x,v=r.x;let u,w,L;return u=(b.y-r.y)/s,(w=(o-v)/s)>=.99999&&(w=.99999),w<=-.99999&&(w=-.99999),L=(L=Math.acos(w))/Math.PI*180,u<-.05&&(L=360-L),{sin:u,cos:w,angle:L}}function judgementArcRenderDirection(b,r,s){return(b<r?r-b:r-b+360)>(b<s?s-b:s-b+360)}function createThreePointArc(b,r,s,o=!1,v=!1,u=new THREE.Color("#ff0000")){const w=calculateArcOrigin(b,r,s),L=w.x,U=w.y,N=calculateRadiusArc(b,w),D=calculateArcAngle(b,w,N),f=calculateArcAngle(r,w,N),P=calculateArcAngle(s,w,N);let T,B,G=D.angle,R=f.angle,_=P.angle,ee=judgementArcRenderDirection(G,R,_);v&&(ee=!0),o?(B=new THREE.ArcCurve(L,U,N,THREE.MathUtils.degToRad(G),THREE.MathUtils.degToRad(R),!ee),T=ee?R>G?THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle):360-Math.abs(THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle)):G>R?Math.abs(THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle)):360-THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle)):(B=new THREE.ArcCurve(L,U,N,THREE.MathUtils.degToRad(G),THREE.MathUtils.degToRad(_),ee),T=ee?_>G?360-THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle):Math.abs(THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle)):G>_?360+THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle):THREE.MathUtils.radToDeg(B.aEndAngle-B.aStartAngle));const k=T*Math.PI*N/180,E=new THREE.BufferGeometry().setFromPoints(B.getPoints(50)),W=new THREE.LineBasicMaterial({color:u});return{arc:new THREE.Line(E,W),radius:N,angle:T,arcLength:k}}function computeRegularPolygonVertices(b=new THREE.Vector3,r=new THREE.Vector3,s=3){const o=[];s=Math.max(3,s),o.push(r);const v=2*Math.PI/s;for(let u=1;u<s;u++){const w=Math.cos(v*u),L=Math.sin(v*u),U=b.clone(),N=r.clone(),D=N.x-U.x,f=N.y-U.y,P=new THREE.Vector3(D*w-f*L+U.x,D*L+f*w+U.y);o.push(P)}return o}function computeBounding(b){if(b.length==0){let r=new THREE.Vector3;return{centerPoint:r,minPoint:r,maxPoint:r}}{let r=new THREE.Vector3(b[0].x,b[0].y,b[0].z||0),s=new THREE.Vector3(b[0].x,b[0].y,b[0].z||0),o=b.length;for(let v=1;v<o;v++){let u=b[v];r.x>u.x&&(r.x=u.x),r.y>u.y&&(r.y=u.y),s.x<u.x&&(s.x=u.x),s.y<u.y&&(s.y=u.y)}return{centerPoint:new THREE.Vector3(r.x+.5*(s.x-r.x),r.y+.5*(s.y-r.y),0),minPoint:r,maxPoint:s}}}function MxThreeJSMixin(b){return b.createImage=function(r,s,o,v,u){if(!u)return new Promise((w,L)=>{b.createImage.call(this,r,s,o,v,U=>w(U))});new THREE.TextureLoader().load(v,function(w){let L=new THREE.PlaneGeometry(s,o),U=new THREE.MeshLambertMaterial({map:w,transparent:!0,side:THREE.DoubleSide});U.map&&(U.map.needsUpdate=!0),setGeometrPostion(L,r);let N=new THREE.Mesh(L,U);N.material.depthTest=!1,u&&u(N)},void 0,function(w){console.log(w),u&&u(null)})},b.loadSVG=function(r,s,o,v){return o?(store.state.MxFun.loadSVG(r,s,o,v),new Promise(u=>{u(null)})):new Promise(u=>{store.state.MxFun.loadSVG(r,s,w=>{u(w)},v)})},b.clacTextSize=(r,s)=>store.state.MxFun.getMxThreeJS().clacTextSize(r,s),b.clacTextSpriteSize=(r,s,o)=>store.state.MxFun.getMxThreeJS().clacTextSpriteSize(r,s,o),b.creatTextSprite=(r,s,o,v,u)=>r.length===0?null:(u instanceof Object?u.getHex&&(u=u.getHex()):typeof u=="string"&&(u=parseInt(u)),store.state.MxFun.getMxThreeJS().creatTextSprite(r,s,o,v,u)),b}class MxThreeJS$1{createLine(r,s,o){const v=new THREE.Geometry,u=new THREE.LineBasicMaterial({color:o});return v.vertices.push(r,s),new THREE.Line(v,u)}createCircle(r,s,o){const v=new THREE.CircleGeometry(s,64,3,2*Math.PI),u=new THREE.LineBasicMaterial({color:o});v.vertices.shift();const w=new THREE.LineLoop(v,u),{x:L,y:U,z:N}=r;return w.position.set(L,U,N),w}createPoint(r,s,o=3){const v=new THREE.Geometry;v.vertices.push(r);const u=new THREE.PointsMaterial({color:s,size:o});return new THREE.Points(v,u)}createTriangle(r,s,o=1){if(r.length<3)return null;const v=r.length,u=new THREE.Geometry;for(let L=0;L+2<v;L+=3){u.vertices.push(r[L]),u.vertices.push(r[L+1]),u.vertices.push(r[L+2]);const U=new THREE.Face3(L,L+1,L+2);u.faces.push(U)}u.computeFaceNormals(),u.computeVertexNormals();const w=new THREE.MeshBasicMaterial({color:s,transparent:!0,depthTest:!1,side:THREE.DoubleSide,opacity:o});return new THREE.Mesh(u,w)}createLines(r,s){const o=new THREE.Geometry;o.vertices=r;const v=new THREE.LineBasicMaterial({color:s});return new THREE.Line(o,v)}createDashedLines(r,s,o,v){const u=new THREE.Geometry;u.vertices=r;const w=new THREE.Line(u,new THREE.LineDashedMaterial({color:s,dashSize:o,gapSize:v}));return w.computeLineDistances(),w}}const MxThreeJS=MxThreeJSMixin(new MxThreeJS$1);class MxDrawObject extends Node{constructor(r){super(),this.rootLayer=new Layer(r.m_mxDatabase.curLayer),this.add(this.rootLayer),this._mxdrawObj=r}getMxObjectImplement(){return this._mxdrawObj}getScene(){return this._mxdrawObj.getScene()}setMultipleSelect(r){this._mxdrawObj.isMultipleSelect=r}getCamera(){return this._mxdrawObj.getCamera()}getRenderer(){return this._mxdrawObj.renderer}setMouseRightRotate(r=!0){return this._mxdrawObj.setMouseRightRotate(r)}getFullDisplayRange(){return this._mxdrawObj.getFullDisplayRange()}getCanvas(){return this._mxdrawObj.getCanvas()}updateDisplay(r=!1){return this._mxdrawObj.updateDisplay(r)}createCanvasImageData(r,s){return this._mxdrawObj.createCanvasImageData(r,s)}setViewColor(r){return this._mxdrawObj.setViewColor(r)}getViewColor(){return this._mxdrawObj.getViewColor()}setSize(r,s){return this._mxdrawObj.setSize(r,s)}getIntersectObjects(r){return this._mxdrawObj.getIntersectObjects(r)}addObject(r,s=!0){return this._mxdrawObj.addObject(r,s)}addViewObject(r){return this._mxdrawObj.addViewObject(r)}getViewWidth(){return this._mxdrawObj.getViewWidth()}getViewHeight(){return this._mxdrawObj.getViewHeight()}removeObject(r,s=!0){return this._mxdrawObj.removeObject(r,s)}zoomInitialStates(){return this._mxdrawObj.zoomInitialStates()}zoomScale(r){return this._mxdrawObj.zoomScale(r)}zoomW(r,s,o,v,u){return this._mxdrawObj.zoomW(r,s,o,v,u)}saveZoom(){return this._mxdrawObj.saveZoom()}recoverZoom(){return this._mxdrawObj.recoverZoom()}zoomCenter(r,s){return this._mxdrawObj.zoomCenter(r,s)}initZoomW(r,s){return this._mxdrawObj.initZoomW(r,s)}addEvent(r,s){return this._mxdrawObj.addEvent(r,s)}on(r,s){return super.on(r,s),this._mxdrawObj.addEvent(r,s)}off(r,s){return super.off(r,s),this.removeEventFuction(r,s)}removeEventFuction(r,s){return this._mxdrawObj.removeEventFuction(r,s)}setIniset(r){return this._mxdrawObj.setIniset(r)}getViewDocCoord(){return this._mxdrawObj.getViewDocCoord()}screenCoord2World(r,s,o){return this._mxdrawObj.screenCoord2World(r,s,o)}worldCoord2Screen(r,s,o){return this._mxdrawObj.worldCoord2Screen(r,s,o)}screenCoord2Doc(r,s){return this._mxdrawObj.screenCoord2Doc(r,s,0)}worldCoordLong2Doc(r){return this._mxdrawObj.worldCoordLong2Doc(r)}docCoordLong2World(r){return this._mxdrawObj.docCoordLong2World(r)}docCoord2World(r,s,o){return this._mxdrawObj.docCoord2World(r,s,o)}docCoord2World2(r){return this._mxdrawObj.docCoord2World(r.x,r.y,r.z)}worldCoord2Doc(r,s,o){return this._mxdrawObj.worldCoord2Doc(r,s,o)}worldCoord2Doc2(r){return this._mxdrawObj.worldCoord2Doc(r.x,r.y,r.z)}docCoord2Screen(r,s){return this._mxdrawObj.docCoord2Screen(r,s,0)}screenCoordLong2Doc(r){return this._mxdrawObj.screenCoordLong2Doc(r)}docCoordLong2Screen(r){return this._mxdrawObj.docCoordLong2Screen(r)}screenCoordLong2World(r){return this._mxdrawObj.screenCoordLong2World(r)}worldCoordLong2Screen(r){return this._mxdrawObj.worldCoordLong2Screen(r)}initRendererParam(r){return this._mxdrawObj.initRendererParam(r)}addMxEntity(r){return this.rootLayer.add(r),r.objectId()}getMxCurrentSelect(){let r=this._mxdrawObj.getMxAllSelect();return r.length==0&&(r=this._mxdrawObj.getPrvCommandSelect()),r}getMxCADCurrentSelect(){let r=this._mxdrawObj.getMxCADAllSelect();return r.length==0&&(r=this._mxdrawObj.getPrvCommandMxCADSelect()),r}getSelectPoints(){return this._mxdrawObj.getSelectPoints()}addMxCurrentSelect(r,s=!0,o=!0){return this._mxdrawObj.addMxCurrentSelect(r,s,o)}addMxCADCurrentSelect(r,s=!0,o=!0){return this._mxdrawObj.addMxCADCurrentSelect(r,s,o)}fireSelectChange(r){this._mxdrawObj.fireSelectChange(r)}clearMxCurrentSelect(){return this._mxdrawObj.clearMxCurrentSelect()}getMxEntity(r){return this._mxdrawObj.getMxEntityUserObject(r)}findMxEntityAtPoint(r,s,o){return this._mxdrawObj.findMxEntityAtPoint(r,s,o)}getAllMxEntity(){return this._mxdrawObj.getAllMxEntity()}setViewMovementMethod(r){return this._mxdrawObj.setMouseMiddlePan(r)}setMouseMiddlePan(r){return this._mxdrawObj.setMouseMiddlePan(r)}resetThreeJSControls(){return this._mxdrawObj.resetThreeJSControls()}enableZoom(r){return this._mxdrawObj.enableZoom(r)}enablePan(r){return this._mxdrawObj.enablePan(r)}eraseMxEntity(r){return this._mxdrawObj.eraseMxEntity(r)}removeViewObject(r){this._mxdrawObj.removeViewObject(r)}saveMxEntityToJson(r){return JSON.stringify(this._mxdrawObj.saveMxEntityToJson(r))}saveMxEntityToObject(r){return this._mxdrawObj.saveMxEntityToJson(r)}async loadMxEntityFromJson(r,s=null){if(s){let o=s.length;for(let v=0;v<o;v++)await MxThreeJS.loadSVG(s[v])}return this.getAllMxEntity().forEach(o=>{for(let v in o)Reflect.deleteProperty(o,v)}),typeof r=="string"?this._mxdrawObj.loadMxEntityFromJson(JSON.parse(r)):this._mxdrawObj.loadMxEntityFromJson(r)}eraseAllMxEntity(){return this._mxdrawObj.eraseAllMxEntity()}makeCurrent(){this._mxdrawObj.makeCurrent()}getViewCenterDocCoord(){return this._mxdrawObj.getViewCenterDocCoord()}updateCanvasSize(){this._mxdrawObj.updateCanvasSize()}newFile(r,s,o,v){return this._mxdrawObj.newFile(r,s,o,v)}stopAllLoading(){this._mxdrawObj.stopAllLoading()}getOrbitControls(){return this._mxdrawObj.getOrbitControls()}enableViewControls(r){return this._mxdrawObj.enableViewControls(r)}getMxDatabase(){return new MxDbDatabase(this._mxdrawObj.getMxDatabase())}setZoomSpeed(r){return this._mxdrawObj.setZoomSpeed(r)}resetRenderer(){return this._mxdrawObj.resetRenderer()}setRequestHeader(r){return this._mxdrawObj.setRequestHeader(r)}closeWebSocket(){return this._mxdrawObj.closeWebSocket()}cadCoord2Doc(r,s,o){return this._mxdrawObj.cadCoord2Doc(r,s,o)}cadCoord2Doc2(r){return this._mxdrawObj.cadCoord2Doc2(r)}toSmallcoord(r){return this._mxdrawObj.toSmallcoord(r)}toSmallcoord2(r,s,o=0){return this._mxdrawObj.toSmallcoord2(r,s,o)}docCoord2Cad(r,s,o){return this._mxdrawObj.docCoord2Cad(r,s,o)}docCoord2Cad2(r){return this._mxdrawObj.docCoord2Cad2(r)}viewCoord2Cad(r,s,o){return this._mxdrawObj.viewCoord2Cad(r,s,o)}cadCoord2View(r,s,o){return this._mxdrawObj.cadCoord2View(r,s,o)}cadCoordLong2View(r){return this._mxdrawObj.cadCoordLong2View(r)}viewCoordLong2Cad(r){return this._mxdrawObj.viewCoordLong2Cad(r)}docCoordLong2Cad(r){return this._mxdrawObj.docCoordLong2Cad(r)}cadCoordLong2Doc(r){return this._mxdrawObj.cadCoordLong2Doc(r)}setViewAngle(r){return this._mxdrawObj.setViewAngle(r)}getViewAngle(){return this._mxdrawObj.getViewAngle()}getSysVar(r){return this._mxdrawObj.sysVariable().getSysVar()}setSysVar(r,s){return this._mxdrawObj.sysVariable().setSysVar(r,s)}isMxCAD(){return this._mxdrawObj.isCppMxCAD()}getAllLayoutName(){return this._mxdrawObj.getAllLayoutName()}getDtabaseJsonString(){return this._mxdrawObj.getDtabaseJsonString()}gotoLayout(r){return this._mxdrawObj.gotoLayout(r)}initMxCpp(r){return this._mxdrawObj.initMxCpp(r)}isWebgl2(){return this._mxdrawObj.isWebgl2()}getId(){return this._mxdrawObj.getId()}addControlsEvent(r,s,o=!1){return this._mxdrawObj.addControlsEvent(r,s,o)}clearAllObject(){return this.rootLayer.clear(),this._mxdrawObj.clearAllObject()}setPointMultipleSelect(r=!0){return this._mxdrawObj.setPointMultipleSelect(r)}isWhiteViewColor(){return this._mxdrawObj.isWhiteViewColor()}automaticInversionColor(r){return this._mxdrawObj.automaticInversionColor(r)}renderLoop(r=!0){return this._mxdrawObj.renderLoop(r)}}const initEvents=b=>{let r=[];["click","mousedown","mouseup"].forEach(s=>{b.addEventListener(s,()=>{r.forEach(o=>{o.emit(s)})})}),b.addEventListener("mousemove",()=>{const s=MxFun.getCurrentDraw().findMxEntityAtPoint(MxFun.getCurrentMousePostion(),!1);s.forEach(o=>{o.emit("mousemove")}),s.length===0&&(r.length>0&&r.forEach(o=>{o.emit("mouseout")}),r=[]),r.length===0&&(r=s).forEach(o=>{o.emit("mouseover"),o.emit("hover")})})};function createMxObject({canvasId:b=createReandomId(),cadFile:r="",callback:s,isNewFile:o=!1,useWebsocket:v=!1,isAutoResize:u=!0,mapBox:w,isMxCAD:L=!1,userIdentitySign:U="emptyUserIdentity",isCPPMxCAD:N=!1}){if(this.initUiDataObject(mxUiData$1),!v&&o&&(o=!1),w)if(N){const D=w.canvas;let f=!0;store.state.MxFun.createMxObject(D,"",P=>{let T=new MxDrawObject(P);P.setMouseRightRotate(!1),P.setIniset({EnableOsnapFunction:!0}),s&&s(T,{canvas:D,canvasParent:void 0})},f,!1,!1,w,N)}else{const D=w.canvas;store.state.MxFun.createMxObject(D,r,f=>{let P=new MxDrawObject(f);f.setIniset({EnableOsnapFunction:!0}),s&&s(P,{canvas:D,canvasParent:void 0})},void 0,o,v,w)}else if(N){const D=createCanvas(b),f=createCanvasParent(D);f.parentNode&&f.parentNode.nodeType!=11||document.body.appendChild(f);let P=!0;store.state.MxFun.createMxObject(b,"",T=>{let B=new MxDrawObject(T);T.setMouseRightRotate(!1),T.setIniset({EnableOsnapFunction:!0}),T.addEvent("onResize",()=>(f.tabindex=3,{width:f.clientWidth,height:f.clientHeight})),u&&useCanvasResizeListener(B,D),s&&s(B,{canvas:D,canvasParent:f})},P,!1,!1,void 0,N)}else{const D=createCanvas(b),f=createCanvasParent(D);let P;f.parentNode&&f.parentNode.nodeType!=11||document.body.appendChild(f),L&&(P=!0,v=!0),store.state.MxFun.createMxObject(b,r,T=>{let B=new MxDrawObject(T);L&&(U.length==0&&(U="invalidUserIdentity"),T.initRunMode(2),T.initUserLoginData(U,"")),T.setMouseRightRotate(!1),T.setIniset({EnableOsnapFunction:!0}),T.addEvent("onResize",()=>(f.tabindex=3,{width:f.clientWidth,height:f.clientHeight})),u&&useCanvasResizeListener(B,D),initEvents(D),s&&s(B,{canvas:D,canvasParent:f})},P,o,v,void 0)}}let mxUiData=mxUiData$1;class MxFunClass{constructor(){this.createMxObject=createMxObject,this.getMxFunTHREE=()=>store.state.MxFun.getTHREE()}setMxServer(r="ws://localhost:5090"){store.state.MxFun.setMxServer(r)}screenCoord2Doc(r,s){return store.state.MxFun.screenCoord2Doc(r,s,0)}docCoord2Screen(r,s){return store.state.MxFun.docCoord2Screen(r,s,0)}getCurrentDraw(){const r=store.state.MxFun.getCurrentDraw();return r.tmp||(r.tmp=new MxDrawObject(r)),r.tmp}addToCurrentSpace(r){return MxFun.getCurrentDraw().addMxEntity(r)}initUiDataObject(r){return mxUiData=r,store.state.MxFun.initUiDataObject(r)}getUIData(){return mxUiData}getCurrentDatabase(){return MxFun.getCurrentDraw().getMxDatabase()}testMX(r){return 11}loadImageMaterial(r,s){return s?(store.state.MxFun.loadImageMaterial(r,s),new Promise((o,v)=>{o(null)})):new Promise((o,v)=>{store.state.MxFun.loadImageMaterial(r,u=>{o(u||null)})})}selectEnt(r,s=null){return new Promise((o,v)=>{const u=new MrxDbgUiPrPoint;u.setMessage(r),u.go(w=>{if(w!=0)return void o(0);const L=u.value();let U=MxFun.getCurrentDraw().findMxEntityAtPoint(L),N=0;for(;U.length!=0;){let D=U.length;for(let f=0;f<D;f++){let P=U[f];if(!s||!s.type||s.type==P.getTypeName()){N=P.objectId();break}}break}o(N)})})}listenForCommandLineInput(r){mxUiData.getCmdLine().mountUpDisplayFun(r)}setCommandLineInputData(r,s){mxUiData.getCmdLine().setCmdText(r),mxUiData.onKeydown(s)}listenForCoordTip(r){mxUiData.mountSetCoordFun(r)}listenForUpdateCursor(r){mxUiData.mountUpdateCursorFun(r)}getMxFunThreeTool(){return store.state.MxFun.getMxThreeJS()}ceneratecursor(r=128,s=10,o=!0,v){return store.state.MxFun.ceneratecursor(r,s,o,v)}getCurrentMousePostion(){let r=store.state.MxFun.getCurrentMousePostion();return new THREE.Vector3(r.x,r.y,0)}onUseCreateMxDbEntity(r){store.events.on("use:create:MxDbEntity",r)}}const _MxFun=new MxFunClass,MxFun=new Proxy({},{get:(b,r)=>typeof _MxFun[r]=="function"?_MxFun[r].bind(_MxFun):store.state.MxFun[r]});var MxCloneType,MxCommandFlag,MxDefaultRenderOrder,InputToucheType;(function(b){b[b.kClone=1]="kClone",b[b.kDragClone=2]="kDragClone",b[b.kMxFileClone=3]="kMxFileClone",b[b.kSaveDwgClone=4]="kSaveDwgClone"})(MxCloneType||(MxCloneType={})),function(b){b[b.MCRX_CMD_MODAL=0]="MCRX_CMD_MODAL",b[b.MCRX_CMD_TRANSPARENT=1]="MCRX_CMD_TRANSPARENT",b[b.MCRX_CMD_NO_UNDO_MARKER=2]="MCRX_CMD_NO_UNDO_MARKER",b[b.MCRX_CMD_NOPRV=4]="MCRX_CMD_NOPRV"}(MxCommandFlag||(MxCommandFlag={})),function(b){b[b.kCADMeshRenderOrder=10]="kCADMeshRenderOrder",b[b.kCADCurveRenderOrder=20]="kCADCurveRenderOrder",b[b.kMxEntityRenderOrder=30]="kMxEntityRenderOrder",b[b.kGripRenderOrder=110]="kGripRenderOrder",b[b.kDynJigRenderOrder=120]="kDynJigRenderOrder"}(MxDefaultRenderOrder||(MxDefaultRenderOrder={})),function(b){b[b.kGetBegan=1]="kGetBegan",b[b.kGetEnd=2]="kGetEnd"}(InputToucheType||(InputToucheType={}));var MxType=Object.freeze({__proto__:null,get MxCloneType(){return MxCloneType},get MxCommandFlag(){return MxCommandFlag},get MxDefaultRenderOrder(){return MxDefaultRenderOrder},get InputToucheType(){return InputToucheType}});class MxassemblyClass{constructor(){this.mxassembly=null}initImp(){this.mxassembly||store.state.Mxassembly&&(this.mxassembly=store.state.Mxassembly)}NewMcGePoint3d(r,s,o){this.initImp();let v=new this.mxassembly.McGePoint3d;return r&&(v.x=r),s&&(v.y=s),o&&(v.z=o),v}NewMcGePoint3dArray(r){this.initImp();let s=new this.mxassembly.McGePoint3dArray;return r&&r.forEach(o=>{let v=this.NewMcGePoint3d();v.x=o.x,v.y=o.y,v.z=o.z,s.append(v)}),s}}const Mxassembly=new MxassemblyClass;class McGeToolClass{constructor(){this.mxgeTool=null}initImp(){this.mxgeTool||store.state.Mxassembly&&(this.mxgeTool=new store.state.Mxassembly.McGeTool)}calcArea(r){if(this.initImp(),!store.state.Mxassembly)return 0;if(r instanceof Array){let s=Mxassembly.NewMcGePoint3dArray(r);return this.mxgeTool.calcArea(s)}return this.mxgeTool.calcArea(r)}pointInPolyline(r,s){this.initImp();let o=s;s instanceof Array&&(o=Mxassembly.NewMcGePoint3dArray(s));let v=Mxassembly.NewMcGePoint3d(r.x,r.y,r.z);return this.mxgeTool.pointInPolyline(v,o)}}const McGeTool=new McGeToolClass;class MrxDbgUtilsClass{constructor(){this.imp=null}initImp(){if(!this.imp&&store.state.MxFun){let r=store.state.MxFun;this.imp=new r.getMrxDbgUtilsClass}}findEntAtPoint(r,s=null,o,v=!0,u){return this.initImp(),o||(o=MxFun.getCurrentDraw()),this.imp.findEntAtPoint(o.getMxObjectImplement(),r,s,v,u)}selectEnt(r,s){return this.initImp(),this.imp.selectEnt(r)}getCorner(r,s,o=!1,v,u=!1){return this.initImp(),this.imp.getCorner(r,s,o,v,u)}}const MrxDbgUtils=new MrxDbgUtilsClass,MxPaintBrushProps={},MxPaintBrush={getProps:()=>MxPaintBrushProps,setProps:b=>Object.assign(MxPaintBrushProps,b),use:b=>Object.assign(b,MxPaintBrushProps)};var DataType;(function(b){b[b.Default=0]="Default",b[b.Color=1]="Color",b[b.Vector2=2]="Vector2",b[b.Vector3=3]="Vector3",b[b.Vector4=4]="Vector4",b[b.Matrix3=5]="Matrix3",b[b.Matrix4=6]="Matrix4"})(DataType||(DataType={}));const MXDBDATATYPE="datatype";function getDwgKeyVal(b,r){let s,o="";return lodash.isObject(r)?(s=r.default,o=r.key):typeof r=="string"&&(o=r),[o,b[o]===void 0?s:b[o]]}class MxDbEntity extends RenderOrderNode{constructor(){super(),this.color=16777215,this.opacity=1,this.visible=!0,this.userData={},this.sGuid="",this.dLineWidth=0,this.lineWidthByPixels=!0,this.dDashArray=0,this.dDashRatio=0,this.layer="",this.use_smallcoord_display=!1,this.addEvent=this.on,this.removeEvent=this.off,this.callEvent=this.emit;const r=this.constructor;r.isPaintBrushDraw&&(MxPaintBrush.use(this),store.events.emit("use:create:MxDbEntity",this),r.isPaintBrushDraw=!1)}static register(){const r=this;r.isRegister||(r.cmd&&r.draw&&MxFun.addCommand(r.cmd,s=>r.use.call(r,void 0,s)),new r().rxInit(),r.isRegister=!0)}static async use(r,s){return new Promise((o,v)=>{const u=this;if(!u.isRegister&&u.register(),u.isPaintBrushDraw=!0,!u.cmd&&u.draw)return v();const w=L=>{o(L),r&&r(L),store.events.off("use:create:MxDbEntity",w)};store.events.on("use:create:MxDbEntity",w),u.draw(s)})}initGuid(r){this.sGuid.length>0?console.log("mx: init guid error"):this.sGuid=r}toSmallcoord2(r,s,o,v=0){return this.use_smallcoord_display?r.toSmallcoord2(s,o,v):new THREE.Vector3(s,o,v)}toSmallcoord(r,s){return this.use_smallcoord_display?r.toSmallcoord(s):s}isUseSmallcoordDisplay(){return this.use_smallcoord_display}setUseSmallcoordDisplay(r){this.use_smallcoord_display=r}dwgInHelp(r,s,o){let v=this;const u=r.type===MxType.MxCloneType.kMxFileClone||r.type===MxType.MxCloneType.kSaveDwgClone,w=U=>{if(!U)return;const{value:N,[MXDBDATATYPE]:D}=U;switch(D){case DataType.Color:return new THREE.Color(...N);case DataType.Vector2:return new THREE.Vector2(...N);case DataType.Vector3:return new THREE.Vector3(...N);case DataType.Vector4:return new THREE.Vector4(...N);case DataType.Matrix3:return new THREE.Matrix3().fromArray(N);case DataType.Matrix4:return new THREE.Matrix4().fromArray(N)}return o&&o.getCacheVal?o.getCacheVal(U):void 0};function L(U){return U instanceof THREE.Color||U instanceof THREE.Vector2||U instanceof THREE.Vector3||U instanceof THREE.Vector4||U instanceof THREE.Matrix3||U instanceof THREE.Matrix4?U.clone():o&&o.getVal?o.getVal(U):void 0}return s.forEach(U=>{const[N,D]=getDwgKeyVal(r,U);v[N]=lodash.cloneDeepWith(D,u?w:L)}),!0}dwgOutHelp(r,s){const o=w=>w instanceof THREE.Color?{[MXDBDATATYPE]:DataType.Color,value:w.toArray()}:w instanceof THREE.Vector2?{[MXDBDATATYPE]:DataType.Vector2,value:w.toArray()}:w instanceof THREE.Vector3?{[MXDBDATATYPE]:DataType.Vector3,value:w.toArray()}:w instanceof THREE.Vector4?{[MXDBDATATYPE]:DataType.Vector4,value:w.toArray()}:w instanceof THREE.Matrix3?{[MXDBDATATYPE]:DataType.Matrix3,value:w.toArray()}:w instanceof THREE.Matrix4?{[MXDBDATATYPE]:DataType.Matrix4,value:w.toArray()}:void 0;let v=this;const u=r.type===MxType.MxCloneType.kMxFileClone||r.type===MxType.MxCloneType.kSaveDwgClone;return s.forEach(w=>{const[L,U]=getDwgKeyVal(v,w);r[L]=u?lodash.cloneDeepWith(U,o):U}),r}create(r){return new this.constructor(r)}transformBy(r){}getGeomExtents(){return null}getClosestPointTo(r,s=0){return null}getImp(){return this.MxDbEntityImp}setNeedUpdateDisplay(r){let s=this.getImp();return!!s&&(r?s.upDisplay():s.setDirtyDisplay(!0),!0)}getMxObject(){let r=this.getImp();return r?r.getMxObject():null}onViewChange(){return!1}objectId(){let r=this.getImp();return r?r.objectId():0}erase(){let r=this.getImp();return!!r&&r.erase()}setLayer(r){let s=this.getImp();s&&s.nodifySetLayer(),this.layer=r}getLayer(){return this.layer}setColor(r){return this.color=r,this}getColor(){return this.color||16777215}clone(r){let s=this.create(),o={type:r||MxType.MxCloneType.kClone};return this.dwgOut(o),s.dwgIn(o),s.sGuid="",s}onDwgIn(r){this.color=r.color,this.renderOrder=r.renderOrder,this.opacity=r.opacity,this.visible=r.visible,r.userData?this.userData=JSON.parse(JSON.stringify(r.userData)):this.userData={},this.dLineWidth=r.lineWidth,this.lineWidthByPixels=r.lineWidthByPixels,this.dDashArray=r.dashArray,this.dDashRatio=r.dashRatio,this.layer=r.layer,r.guid&&(this.sGuid=r.guid)}onDwgOut(r){r.color=this.color,r.renderOrder=this.renderOrder,r.opacity=this.opacity,r.visible=this.visible,r.lineWidth=this.dLineWidth,r.lineWidthByPixels=this.lineWidthByPixels,r.dashArray=this.dDashArray,r.dashRatio=this.dDashRatio,r.layer=this.layer,r.guid=this.sGuid,Object.keys(this.userData).length>0&&(r.userData=this.userData)}rxInit(){MxFun.initMxDbEntityType(this)}setRenderOrder(r){this.renderOrder=r}getRenderOrder(){return this.renderOrder}setLineWidthByPixels(r){return this.lineWidthByPixels=r,this}getLineWidthByPixels(){return this.lineWidthByPixels}setLineWidth(r){return this.dLineWidth=r,this}getLineWidth(){return this.dLineWidth}getGetLength(){return 0}setDashLen(r){let s=this.getGetLength();if(s<1e-6||r<1e-6)return this;let o=Math.floor(s/r);return o<1e-6&&(this.dDashRatio=0),this.dDashArray=1/o,this}setDashRatio(r){return this.dDashRatio=r,this}setDashArray(r){return this.dDashArray=r,this}setDash(r,s){return this.dDashArray=r,this.dDashRatio=s,this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0),this}getDash(){return{dDashArray:this.dDashArray,dDashRatio:this.dDashRatio}}setDashLineDisplay(r){return r?(this.dDashArray<1e-5&&(this.dDashArray=.03),this.dDashRatio<1e-5&&(this.dDashRatio=.1),this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0)):(this.dDashArray=0,this.dDashRatio=0),this}isDashLineDisplay(){return this.dDashArray>0&&this.dDashRatio>0}guid(){return this.sGuid}setGuid(r){return this.sGuid=r}onEndGripEidt(){this.callEvent("onEndGripEidt")}onStartGripEidt(){return this.callEvent("onStartGripEidt")}toJsonString(r=MxType.MxCloneType.kMxFileClone){let s={type:r};return this.dwgOut(s),s.TypeName=this.getTypeName(),JSON.stringify(s)}fromJsonString(r){let s=JSON.parse(r);return(s.type==MxType.MxCloneType.kMxFileClone||s.type==MxType.MxCloneType.kClone)&&this.dwgIn(s)}}function drawMxDbImage(){const b=new MrxDbgUiPrPoint;b.setMessage(`
:`);let r=MxFun.getCurrentDraw();b.go(s=>{if(s!=0)return;let o=MxFun.screenCoordLong2Doc(300),v=MxFun.screenCoordLong2Doc(200);const u=b.value();let w=MxFun.screenCoord2Doc(10,10);u.z=w.z;let L=new MxDbImage;L.setRenderOrder(MxType.MxDefaultRenderOrder.kCADMeshRenderOrder-1),L.setPoint1(u);let U=new THREE.Vector3(u.x+o,u.y+v,u.z);L.setPoint2(U);let N=prompt("","https://cdn.pixabay.com/photo/2022/11/15/12/23/winter-7593872_960_720.jpg");N&&(L.setImagePath(N),r.addMxEntity(L),L.addEvent("onStartGripEidt",()=>(L.visible=!1,L.setNeedUpdateDisplay(),{renderOrder:MxType.MxDefaultRenderOrder.kCADMeshRenderOrder-1})),L.addEvent("onEndGripEidt",()=>{L.visible=!0,L.setNeedUpdateDisplay()}))})}MxDbEntity.isRegister=!1;class MxDbImage extends MxDbEntity{constructor(){super(...arguments),this.pt1=new THREE.Vector3,this.pt2=new THREE.Vector3,this.imagePath="",this.isLoadMaterialFromPath=!0,this.material=null,this.angle=0}getTypeName(){return"MxDbImage"}getAngle(){return this.angle}setAngle(r){this.angle=r}worldDraw(r){let s=new THREE.Vector3(this.pt1.x,this.pt2.y),o=new THREE.Vector3(this.pt2.x,this.pt1.y);if(Math.abs(this.angle)>1e-5){let v=new THREE.Vector3(.5*(this.pt1.x-this.pt2.x)+this.pt2.x,.5*(this.pt1.y-this.pt2.y)+this.pt2.y),u=new THREE.Matrix4;u.makeRotationZ(this.angle);let w=new THREE.Matrix4().makeTranslation(v.x,v.y,v.z).multiply(u).multiply(new THREE.Matrix4().makeTranslation(-v.x,-v.y,-v.z));r.setMatrix(w)}if(r.getType()==1){if(r.drawSelectLine(this.pt1,s),r.drawSelectLine(s,this.pt2),r.drawSelectLine(this.pt2,o),r.drawSelectLine(o,this.pt1),this.material){let v=Math.abs(this.pt1.x-this.pt2.x),u=Math.abs(this.pt1.y-this.pt2.y),w=new THREE.PlaneGeometry(v,u),L=Math.min(this.pt1.x,this.pt2.x),U=Math.min(this.pt1.y,this.pt2.y);for(let D=0;D<w.vertices.length;D++)w.vertices[D].x+=L+.5*v,w.vertices[D].y+=U+.5*u,w.vertices[D].z=0;let N=new THREE.Mesh(w,this.material);N.material.depthTest=!1,r.drawEntity(N)}else if(this.imagePath.length>0&&this.isLoadMaterialFromPath){let v=this,u=r.getMxObject();const w=L=>{this.isLoadMaterialFromPath=!1,L&&(v.setMaterial(L),v.setNeedUpdateDisplay(),u.updateDisplay())};MxFun.loadImageMaterial(this.imagePath,L=>{w(L)})}}else if(this.material){let v=Math.abs(this.pt1.x-this.pt2.x),u=Math.abs(this.pt1.y-this.pt2.y),w=new THREE.PlaneGeometry(v,u),L=Math.min(this.pt1.x,this.pt2.x),U=Math.min(this.pt1.y,this.pt2.y);for(let D=0;D<w.vertices.length;D++)w.vertices[D].x+=L+.5*v,w.vertices[D].y+=U+.5*u,w.vertices[D].z=0;let N=new THREE.Mesh(w,this.material);N.material.depthTest=!1,r.drawEntity(N)}else r.drawLine(this.pt1,s),r.drawLine(s,this.pt2),r.drawLine(this.pt2,o),r.drawLine(o,this.pt1);r.setMatrix(null)}setImagePath(r){this.imagePath=r,this.isLoadMaterialFromPath=!0,this.material=null}getImagePath(){return this.imagePath}setMaterial(r){this.material=r}loadMaterial(r){r&&(this.imagePath=r),this.isLoadMaterialFromPath=!1,this.material=null;let s=this;MxFun.loadImageMaterial(this.imagePath,o=>{this.isLoadMaterialFromPath=!1,s.setMaterial(o)})}setPoint1(r){this.pt1=r}getPoint1(){return this.pt1}setPoint2(r){this.pt2=r}getPoint2(){return this.pt2}getGripPoints(){let r=[];r.push(this.pt1),r.push(this.pt2);let s=new THREE.Vector3(this.pt1.x+.5*(this.pt2.x-this.pt1.x),this.pt1.y+.5*(this.pt2.y-this.pt1.y));return r.push(s),r}moveGripPointsAt(r,s){return r==0?this.pt1.add(s):r==1?this.pt2.add(s):r==2&&(this.pt1.add(s),this.pt2.add(s)),!0}dwgIn(r){return this.onDwgIn(r),this.pt1.copy(r.pt1),this.pt2.copy(r.pt2),this.imagePath=r.imagePath.substr(0),this.isLoadMaterialFromPath=!0,r.angle&&(this.angle=r.angle),r.material&&(this.material=r.material),!0}dwgOut(r){return this.onDwgOut(r),r.pt1=this.pt1,r.pt2=this.pt2,r.imagePath=this.imagePath,r.angle=this.angle,r.type==MxType.MxCloneType.kDragClone&&(r.material=this.material),r}create(){return new MxDbImage}}var McGiWorldDrawType;MxDbImage.cmd="Mx_DrawImage",MxDbImage.draw=drawMxDbImage,addRegisterMxDbEntity(MxDbImage),function(b){b[b.kWorldDraw=1]="kWorldDraw",b[b.kDynDragDraw=2]="kDynDragDraw",b[b.kSelectDraw=3]="kSelectDraw"}(McGiWorldDrawType||(McGiWorldDrawType={}));var McGiWorldDrawType$1=McGiWorldDrawType;class MxDbSVGText{constructor(){this.txtPos=new THREE.Vector3,this.txt="",this.txtHeight=1,this.color=void 0,this._txtObject=null,this._txtAspectRatio=-1,this.move=!1,this.drawConnectingLine=!1,this._connectingLine=null,this.fontStyle="",this.underline=!1,this._underLine=null}}async function drawMxDbSVG(){const b=new MrxDbgUiPrPoint;b.setMessage(`
:`);let r=await b.go();if(!r)return;let s=new MxDbSVG,o=prompt("svg","https://img.alicdn.com/imgextra/i2/O1CN01FF1t1g1Q3PDWpSm4b_!!6000000001920-55-tps-508-135.svg");if(!o)return;s.setSvgPath(o),s.setSvgPostion(r),s.svgReverse=!0,s.svgMargin.x=.2,s.setSvgAlignmentRatio(new THREE.Vector2(.5,-1)),s.setRenderOrder(100),s.setSvgSize(new THREE.Vector2(50,0));let v=new MxDbSVGText;v.txt="A1",v.txtPos=new THREE.Vector3(0,-30,0),v.txtHeight=30,s.addText(v),s.fixedSize=!0,s.color=65297,MxFun.addToCurrentSpace(s)}class MxDbSVG extends MxDbEntity{constructor(){super(...arguments),this.svgPos=new THREE.Vector3,this.svg=null,this.svgPath="",this.svgSize=new THREE.Vector2(50,50),this.svgAlignmentRatio=new THREE.Vector2(0,0),this.imagePath="",this.isLoadMaterialFromPath=!0,this.material=null,this.svgRotate=0,this.svgReverse=!1,this.svgMirror=!1,this.svgChildColor=[],this.svgMargin=new THREE.Vector2(0,0),this.isSvgDirtyLocation=!1,this.isLoadFromPath=!0,this.aryText=[],this.svgBoxSize=null,this.fixedSize=!1,this.useSvgColor=!1}setSvgChildColor(r){if(this.svgChildColor=r,!this.useSvgColor&&this.svg){let s=new THREE.Color(this.getColor()),o=0,v=this;this.svg.traverse(function(u){u.material&&(o<v.svgChildColor.length?u.material.color=new THREE.Color(v.svgChildColor[o]):u.material.color=s,o++)}),this.setNeedUpdateDisplay(!0)}}getSvgChildColor(){return this.svgChildColor}calcVewSize(r){let s=this.svgSize.x,o=this.svgSize.y;return o<=0&&(o=this.svgBoxSize?this.svgBoxSize.y/this.svgBoxSize.x*s:s),this.fixedSize&&(s=r.screenCoordLong2Doc(s),o=r.screenCoordLong2Doc(o)),[s,o]}calcSvgDrawRect(r){if(!r)return;this.calcSvgPosition(r);let[s,o]=this.calcVewSize(r),v=new THREE.Matrix4;v.makeScale(this.svgMirror?-1:1,this.svgReverse?-1:1,1);let u=new THREE.Matrix4;u.makeRotationZ(this.svgRotate);let w=new THREE.Matrix4,L=new THREE.Vector3(this.svgPos.x-s*this.svgAlignmentRatio.x,this.svgPos.y-o*this.svgAlignmentRatio.y,0);w.makeTranslation(L.x,L.y,L.z),u.multiply(v),u.premultiply(w);let U=new THREE.Vector3(0,0,0),N=new THREE.Vector3(s,0,0),D=new THREE.Vector3(s,o,0),f=new THREE.Vector3(0,o,0);return U.applyMatrix4(u),N.applyMatrix4(u),D.applyMatrix4(u),f.applyMatrix4(u),{pt1:U,pt2:D,pt3:N,pt4:f,cenpt:D.clone().add(U.clone().sub(D).multiplyScalar(.5)),sizew:s,sizeh:o}}calcImageDrawRect(r){if(!r)return;this.calcSvgPosition(r);let[s,o]=this.calcVewSize(r),v=new THREE.Matrix4;v.makeScale(this.svgMirror?-1:1,this.svgReverse?-1:1,1);let u=new THREE.Matrix4,w=new THREE.Matrix4,L=new THREE.Vector3(this.svgPos.x-s*this.svgAlignmentRatio.x,this.svgPos.y-o*this.svgAlignmentRatio.y,0);w.makeTranslation(L.x,L.y,L.z),u.multiply(v),u.premultiply(w);let U=new THREE.Vector3(0,0,0),N=new THREE.Vector3(s,0,0),D=new THREE.Vector3(s,o,0),f=new THREE.Vector3(0,o,0);return U.applyMatrix4(u),N.applyMatrix4(u),D.applyMatrix4(u),f.applyMatrix4(u),{pt1:U,pt2:D,pt3:N,pt4:f,cenpt:D.clone().add(U.clone().sub(D).multiplyScalar(.5)),sizew:s,sizeh:o}}worldDraw(r){let s,o=r.getMxObject();if(this.imagePath.length>0){if(s=this.calcImageDrawRect(o),Math.abs(this.svgRotate)>1e-5){let f=new THREE.Vector3(.5*(s.pt1.x-s.pt2.x)+s.pt2.x,.5*(s.pt1.y-s.pt2.y)+s.pt2.y),P=new THREE.Matrix4;P.makeRotationZ(this.svgRotate);let T=new THREE.Matrix4().makeTranslation(f.x,f.y,f.z).multiply(P).multiply(new THREE.Matrix4().makeTranslation(-f.x,-f.y,-f.z));r.setMatrix(T)}}else s=this.calcSvgDrawRect(o);let v=s.pt1,u=s.pt2,w=s.pt3,L=s.pt4,U=s.cenpt,N=s.sizew,D=this;if(r.getType()!=McGiWorldDrawType$1.kSelectDraw&&this.aryText.forEach((f,P)=>{if(f.txt.length>0){let G,R=new THREE.Vector3(f.txtPos.x,f.txtPos.y,0);this.fixedSize&&(f.txtPos.x>0?R.x=this.svgPos.x+o.screenCoordLong2Doc(f.txtPos.x):R.x=this.svgPos.x-o.screenCoordLong2Doc(f.txtPos.x),f.txtPos.y>0?R.y=this.svgPos.y+o.screenCoordLong2Doc(f.txtPos.y):R.y=this.svgPos.y-o.screenCoordLong2Doc(f.txtPos.y)),f.color&&(G=r.getColor(),r.setColor(f.color));let _=f.txtHeight;D.fixedSize&&(_=o.screenCoordLong2Doc(f.txtHeight)),r.setXData({type:"text",txt:f.txt,index:P});let ee=r.drawText(f.txt,_,0,R,void 0,k=>f.fontStyle.length>0?`${f.fontStyle} ${k}px Arial`:`normal ${k}px Arial`);if(r.getType()==McGiWorldDrawType$1.kWorldDraw&&(f._txtObject=ee),f.underline&&f._txtObject){const k=new THREE.Box3;k.expandByObject(f._txtObject);let E=new THREE.Vector3(k.min.x,k.min.y+.1*_,0),W=new THREE.Vector3(k.max.x,k.min.y+.1*_,0);var T=new THREE.Geometry;let C=new THREE.LineBasicMaterial({color:r.getColor(),transparent:!0,depthTest:!1});T.vertices.push(E,W);var B=new THREE.Line(T,C);r.drawEntity(B),r.getType()==McGiWorldDrawType$1.kWorldDraw&&(f._underLine=B)}if(f._txtAspectRatio=-1,G&&r.setColor(G),f.drawConnectingLine){let k=U.clone().sub(R);if(k.length()>_+N){k.normalize();let E=U.clone().sub(k.clone().multiplyScalar(N)),W=R.clone().add(k.clone().multiplyScalar(_));T=new THREE.Geometry;let C=new THREE.LineBasicMaterial({color:r.getColor(),transparent:!0,depthTest:!1});T.vertices.push(E,W),B=new THREE.Line(T,C),r.setXData({type:"line"}),r.drawEntity(B),r.getType()==McGiWorldDrawType$1.kWorldDraw&&(f._connectingLine=B)}}}}),r.getType()==1){if(this.svg)r.setXData({type:"svg"}),r.drawEntity(this.svg);else if(this.svgPath.length>0&&this.isLoadFromPath){let f=this,P=r.getMxObject();MxThreeJS.loadSVG(this.svgPath,void 0,T=>{if(T){let B=T;if(B.boxSize)f.svgBoxSize=B.boxSize.clone();else{let k=new THREE.Box3().setFromObject(T);f.svgBoxSize||(f.svgBoxSize=new THREE.Vector3),f.svgBoxSize.x=k.max.x-k.min.x,f.svgBoxSize.y=k.max.y-k.min.y}let[G,R]=f.calcVewSize(o);f.svgBoxSize&&(T.scale.x=G/f.svgBoxSize.x,T.scale.y=R/f.svgBoxSize.y),T.scale.z=T.scale.x,f.svgReverse&&(T.scale.y*=-1),f.svgMirror&&(T.scale.x*=-1),T.rotateZ(f.svgRotate),f.isSvgDirtyLocation=!0;let _=new THREE.Color(r.getColor()),ee=0;T.traverse(function(k){k.material&&(k.material=k.material.clone(),k.material.transparent=!0,k.material.depthTest=!1,f.useSvgColor||(ee<f.svgChildColor.length?k.material.color=new THREE.Color(f.svgChildColor[ee]):k.material.color=_),ee++)}),f.svg=T,f.setNeedUpdateDisplay(),P.updateDisplay()}else console.log("mx LoadSVG:"+f.svgPath+" failed");f.isLoadFromPath=!1})}else if(this.material){let f=Math.abs(v.x-u.x),P=Math.abs(v.y-u.y),T=new THREE.PlaneGeometry(f,P),B=Math.min(v.x,u.x),G=Math.min(v.y,u.y);for(let _=0;_<T.vertices.length;_++)T.vertices[_].x+=B+.5*f,T.vertices[_].y+=G+.5*P,T.vertices[_].z=0;let R=new THREE.Mesh(T,this.material);R.material.depthTest=!1,r.drawEntity(R)}else if(this.isLoadMaterialFromPath&&this.imagePath.length>0){let f=this,P=r.getMxObject();MxFun.loadImageMaterial(this.imagePath,T=>{this.isLoadMaterialFromPath=!1,T&&(f.material=T,f.setNeedUpdateDisplay(),P.updateDisplay())})}this.fixedSize||(r.drawSelectLine(v,u),r.drawSelectLine(w,L),r.drawSelectLine(v,w),r.drawSelectLine(w,u),r.drawSelectLine(u,L),r.drawSelectLine(L,v))}else r.drawLine(v,w),r.drawLine(w,u),r.drawLine(u,L),r.drawLine(L,v);this.imagePath.length>0&&r.setMatrix(null)}async setSvgPath(r,s=!1){this.svgPath=r,this.svg=null,this.isLoadFromPath=!0,this.svgBoxSize=null,s&&await MxThreeJS.loadSVG(r)}getSvgPath(){return this.svgPath}setSvgPostion(r){this.svgPos=r.clone(),this.isSvgDirtyLocation=!0}setImagePath(r,s){this.imagePath=r,s?(this.material=s,this.isLoadMaterialFromPath=!1):(this.material=null,this.isLoadMaterialFromPath=!0)}getImagePath(){return this.imagePath}getSvgPostion(){return this.svgPos}setSvgSize(r){this.svgSize=r,this.isSvgDirtyLocation=!0}getSvgSize(){return this.svgSize}setSvgAlignmentRatio(r){this.svgAlignmentRatio=r,this.isSvgDirtyLocation=!0}getSvgAlignmentRatio(){return this.svgAlignmentRatio}getText(r){return r<this.aryText.length?this.aryText[r]:null}addText(r){this.aryText.push(r)}getGripPoints(){let r=[];r.push(this.svgPos);let s=0;for(;s<this.aryText.length;s++){let o=this.aryText[s];if(o.move){let v=new THREE.Vector3(o.txtPos.x,o.txtPos.y,0);if(this.fixedSize){let u=MxFun.getCurrentDraw();o.txtPos.x>0?v.x=this.svgPos.x+u.screenCoordLong2Doc(o.txtPos.x):v.x=this.svgPos.x-u.screenCoordLong2Doc(o.txtPos.x),o.txtPos.y>0?v.y=this.svgPos.y+u.screenCoordLong2Doc(o.txtPos.y):v.y=this.svgPos.y-u.screenCoordLong2Doc(o.txtPos.y)}r.push(v)}}return r}moveGripPointsAt(r,s){if(r==0)this.svgPos.add(s),this.fixedSize||this.aryText.forEach(o=>{o.txtPos.add(s)});else if(r-1>=0&&r-1<this.aryText.length){let o=this.aryText[r-1];if(o.move)if(this.fixedSize){let v=MxFun.getCurrentDraw();o.txtPos.x+=v.docCoordLong2Screen(s.x),o.txtPos.y+=v.docCoordLong2Screen(s.y)}else o.txtPos.add(s)}return this.isSvgDirtyLocation=!0,!0}calcSvgPosition(r){if(!this.svg||!this.isSvgDirtyLocation)return;this.isSvgDirtyLocation=!1;let[s,o]=this.calcVewSize(r);this.svg.position.x=this.svgPos.x-s*this.svgAlignmentRatio.x-this.svgMargin.x*s,this.svg.position.y=this.svgPos.y-o*this.svgAlignmentRatio.y-this.svgMargin.y*o}dwgIn(r){this.onDwgIn(r),this.fixedSize=r.fixedSize,this.fixedSize?this.svg=null:r.type==MxType.MxCloneType.kClone&&r.svg&&(this.svg=r.svg.clone()),this.svgPos.copy(r.svgPos),this.svgPath=r.svgPath.substr(0),this.svgSize.copy(r.svgSize),this.svgAlignmentRatio.copy(r.svgAlignmentRatio),this.isSvgDirtyLocation=!0,this.svg||(this.isLoadFromPath=!0),this.svgBoxSize=null;let s=r.txts;return this.aryText=[],s.forEach(o=>{let v=new MxDbSVGText;v.txt=o.txt,v.txtHeight=o.txtHeight,v.txtPos.copy(o.txtPos),v.move=o.move,v.drawConnectingLine=o.drawConnectingLine,this.aryText.push(v)}),this.svgRotate=r.svgRotate,this.useSvgColor=r.useSvgColor,this.svgReverse=r.svgReverse,this.svgMirror=r.svgMirror,this.svgMargin=r.svgMargin,r.svgChildColor?this.svgChildColor=r.svgChildColor:this.svgChildColor=[],this.imagePath=r.imagePath.substr(0),this.isLoadMaterialFromPath=!0,r.material&&(this.material=r.material),!0}dwgOut(r){this.onDwgOut(r);let s,o=this.getMxObject();return r.type==MxType.MxCloneType.kClone&&(r.svg=this.svg),r.svgPath=this.svgPath,r.svgPos=this.svgPos,r.svgSize=this.svgSize,r.svgAlignmentRatio=this.svgAlignmentRatio,r.txts=[],r.type==MxType.MxCloneType.kSaveDwgClone&&o&&(s=this.calcSvgDrawRect(o)),this.aryText.forEach(v=>{let u={txtPos:v.txtPos,txt:v.txt,txtHeight:v.txtHeight,color:v.color,_txtAspectRatio:v._txtAspectRatio,move:v.move,drawConnectingLine:v.drawConnectingLine};r.type==MxType.MxCloneType.kSaveDwgClone&&(v._connectingLine&&(u.connectingLine=v._connectingLine.geometry.vertice),v._underLine&&(u._underLine=v._underLine.geometry.vertice)),r.txts.push(u)}),r.fixedSize=this.fixedSize,r.svgRotate=this.svgRotate,r.useSvgColor=this.useSvgColor,r.svgReverse=this.svgReverse,r.svgMirror=this.svgMirror,r.svgMargin=this.svgMargin,r.svgChildColor=this.svgChildColor,r.type==MxType.MxCloneType.kSaveDwgClone&&(r.svgRect=s),r.imagePath=this.imagePath,r.type==MxType.MxCloneType.kDragClone&&(r.material=this.material),r}create(){return new MxDbSVG}transformBy(r){this.svgPos.applyMatrix4(r),this.isSvgDirtyLocation=!0,this.fixedSize||this.aryText.forEach(s=>{s.txtPos.applyMatrix4(r)})}getTypeName(){return"MxDbSVG"}setColor(r){if(super.setColor(r),this.svg){let s=new THREE.Color(this.color);this.svg.traverse(function(o){o.material&&(o.material.color=s)})}return this}setSvg(r){this.svg=r,this.isLoadFromPath=!1,this.svgBoxSize=null}calcSvgBoxSize(r){if(!this.svgBoxSize)if(r.boxSize)this.svgBoxSize=r.boxSize.clone();else{let s=new THREE.Box3().setFromObject(r);this.svgBoxSize||(this.svgBoxSize=new THREE.Vector3),this.svgBoxSize.x=s.max.x-s.min.x,this.svgBoxSize.y=s.max.y-s.min.y}}reComputeSVG(){if(!this.svg)return;let r=this.getMxObject();if(!r)return;this.calcSvgBoxSize(this.svg);let[s,o]=this.calcVewSize(r);this.svgBoxSize&&(this.svg.scale.x=s/this.svgBoxSize.x,this.svg.scale.y=o/this.svgBoxSize.y),this.svg.scale.z=this.svg.scale.x,this.svgReverse&&(this.svg.scale.y*=-1),this.svgMirror&&(this.svg.scale.x*=-1),this.isSvgDirtyLocation=!0,this.calcSvgPosition(r)}onViewChange(){if(!this.fixedSize)return!1;if(this.imagePath.length>0)return this.setNeedUpdateDisplay(!1),!0;let r=this.getMxObject();if(r==null)return!1;if(this.svg){this.calcSvgBoxSize(this.svg);let[w,L]=this.calcVewSize(r);this.svgBoxSize&&(this.svg.scale.x=w/this.svgBoxSize.x,this.svg.scale.y=L/this.svgBoxSize.y),this.svg.scale.z=this.svg.scale.x,this.svgReverse&&(this.svg.scale.y*=-1),this.svgMirror&&(this.svg.scale.x*=-1),this.isSvgDirtyLocation=!0,this.calcSvgPosition(r)}let s=this.calcSvgDrawRect(r),o=s.cenpt,v=s.sizew,u=this;return this.aryText.forEach(w=>{if(w._txtObject&&r){let U=r.screenCoordLong2Doc(w.txtHeight);if(U>1e-5){w._txtAspectRatio<=0&&(w._txtAspectRatio=w._txtObject.scale.x/w._txtObject.scale.y),w._txtObject.scale.set(w._txtAspectRatio*U*1.5,1.5*U,1),w.txtPos.x>0?w._txtObject.position.x=u.svgPos.x+r.screenCoordLong2Doc(w.txtPos.x):w._txtObject.position.x=u.svgPos.x-r.screenCoordLong2Doc(w.txtPos.x),w.txtPos.y>0?w._txtObject.position.y=u.svgPos.y+r.screenCoordLong2Doc(w.txtPos.y):w._txtObject.position.y=u.svgPos.y-r.screenCoordLong2Doc(w.txtPos.y);let N=w._txtObject.position;if(w._txtObject.updateMatrix(),w._underLine){const D=new THREE.Box3;let f=w._txtObject.parent;w._txtObject.parent=null,D.expandByObject(w._txtObject),w._txtObject.parent=f;let P=new THREE.Vector3(D.min.x,D.min.y+.1*U,0),T=new THREE.Vector3(D.max.x,D.min.y+.1*U,0);(L=new THREE.Geometry).vertices.push(P,T),w._underLine.geometry=L}if(w._connectingLine){let D=o.clone().sub(N);D.normalize();let f=o.clone().sub(D.clone().multiplyScalar(v)),P=N.clone().add(D.clone().multiplyScalar(U));var L;(L=new THREE.Geometry).vertices.push(f,P),w._connectingLine.geometry=L}}}}),!0}}function drawMxDbPolyline(){const b=new MrxDbgUiPrPoint;b.setMessage(`
:`);let r,s=new MxDbPolyline;b.go(o=>{if(o!=0)return;let v=b.value();r||(r=v.clone());let u=v;const w=new McEdGetPointWorldDrawObject;w.setDraw((U,N)=>{N.setColor(16711680),N.drawLine(u,U),N.drawCustomEntity(s)}),b.setUserDraw(w),b.setMessage(`
:`);let L=0;s.addVertexAt(v),b.goWhile(U=>{if(U==0)u=b.value(),s.addVertexAt(u),++L>=2?(b.setMessage(`
:`),b.setKeyWords("[(C)/(U)]")):L>0?(b.setMessage(`
:`),b.setKeyWords("[(U)]")):(b.setMessage(`
:`),b.setKeyWords(""));else if(U==1){if(b.isKeyWordPicked("C"))return{exit:!0};b.isKeyWordPicked("U")&&console.log("Mx_Line undo....")}},()=>{MxFun.getCurrentDraw().addMxEntity(s)})})}MxDbSVG.cmd="Mx_ModelFixedSvg",MxDbSVG.draw=drawMxDbSVG,addRegisterMxDbEntity(MxDbSVG);class MxDbPolyline extends MxDbEntity{constructor(){super(...arguments),this.points=[]}getTypeName(){return"MxDbPolyline"}worldDraw(r){this.points.length<2||r.drawLines(this.points)}getGripPoints(){return this.points}moveGripPointsAt(r,s){return!(r>=this.points.length||(this.points[r].add(s),0))}create(){return new MxDbPolyline}dwgIn(r){this.onDwgIn(r);let s=r.points;return this.points=[],s.forEach(o=>{this.points.push(new THREE.Vector3(o.x,o.y,o.z))}),!0}dwgOut(r){return this.onDwgOut(r),r.points=this.points,r}addVertexAt(r){this.points.push(r)}numVerts(){return this.points.length}getPointAt(r){return r<this.points.length?this.points[r]:null}setPointAt(r,s){return r<this.points.length&&(this.points[r]=s,!0)}}function drawMxDb2LineAngularDimension(){const b=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),s=new MxDb2LineAngularDimension,o=new McEdGetPointWorldDrawObject;return b.setMessage(`
:`),b.go(v=>{v===0&&(b.setMessage(`
:`),s.point1=b.value(),o.setDraw((u,w)=>{s.point2=u,o.drawLine(s.point1,u)}),b.setUserDraw(o),b.go(u=>{b.setMessage(`
:`),u===0&&(s.point2=b.value(),o.setDraw((w,L)=>{s.point3=w,o.drawCustomEntity(s)}),b.go(w=>{w===0&&r.addMxEntity(s)}))}))}),s}MxDbPolyline.cmd="Mx_Lines",MxDbPolyline.draw=drawMxDbPolyline,addRegisterMxDbEntity(MxDbPolyline);const propertyDbKeys$6=["colors","point1","point2","point3"];class MxDb2LineAngularDimension extends MxDbEntity{constructor(r){if(super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.point3=new THREE.Vector3,this.colors=[],r){const{points:s,colors:o}=r;s&&this.setPoints(s),o&&this.setColor(o)}}calculateLineAngle(r,s,o){const v=2*Math.PI/360;return{startAngle:180*Math.atan2(s.y-r.y,s.x-r.x)/Math.PI*v,endAngle:180*Math.atan2(o.y-r.y,o.x-r.x)/Math.PI*v}}setPoints(r){const[s,o,v]=r;return s&&(this.point1=s),o&&(this.point2=o),v&&(this.point3=v),this}setColor(r){return lodash.isArray(r)?this.colors=r:this.color=r,this}worldDraw(r){if(r.getType()==McGiWorldDrawType$1.kWorldDraw||r.getType()==McGiWorldDrawType$1.kDynDragDraw){const[s,o,v,u]=this.colors||[],w=this.getColor(),L=r.getMxObject();r.setOpacity(this.opacity),r.setColor(s||w),r.drawLine(this.point1,this.point2),r.setColor(o||w),r.drawLine(this.point2,this.point3);const{startAngle:U,endAngle:N}=this.calculateLineAngle(this.point2,this.point1,this.point3),D=this.point2.distanceTo(this.point1),f=this.point2.distanceTo(this.point3),P=Math.min(D,f)/4;let T=THREE.MathUtils.radToDeg(U-N);T<0&&(T+=360);let B=L.screenCoordLong2Doc(50);const G=new THREE.ArcCurve(this.point2.x,this.point2.y,P,U,N,!0),R=new THREE.Geometry().setFromPoints(G.getPoints(50));r.setColor(v||w),r.drawGeometryLines(R);const _=G.getPoint(.5);let ee=new THREE.Vector3(_.x,_.y,0);const k=ee.sub(this.point2),E=k.length()+.5*B;k.normalize().multiplyScalar(E),ee=this.point2.clone().add(k),r.setColor(u||w),r.drawText(T.toFixed(3)+"",.5*B,0,ee)}else r.drawLine(this.point1,this.point2),r.drawLine(this.point3,this.point2)}getGripPoints(){return[this.point1,this.point2,this.point3]}moveGripPointsAt(r,s){return r===0?this.point1.add(s):r===1?this.point2.add(s):r===2&&this.point3.add(s),!0}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,propertyDbKeys$6),!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,propertyDbKeys$6),r}create(){return new MxDb2LineAngularDimension}transformBy(r){this.point1.applyMatrix4(r),this.point2.applyMatrix4(r)}getTypeName(){return"MxDb2LineAngularDimension"}}MxDb2LineAngularDimension.cmd="Mx_AngleSurveying",MxDb2LineAngularDimension.draw=drawMxDb2LineAngularDimension,addRegisterMxDbEntity(MxDb2LineAngularDimension);class MxFilters{constructor(){this.uniformObj={},this.filtersStr="",this.filtersTypes="",this.VSHADER_SOURCE=`
  varying vec2 v_Uv;
  void main () {
      v_Uv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }
  `,this.FSHADER_SOURCE=`
  varying vec2 v_Uv;
  uniform sampler2D e_Texture;
  uniform mat4 colorMatrix;
  ${this.filtersStr}
  void main () {
    vec4 color = texture2D( e_Texture, v_Uv );
    color = color * colorMatrix;
    ${this.filtersTypes}
    gl_FragColor = color;
  }`,this._matrix=new THREE.Matrix4}channel({r=1,g:s=1,b:o=1}){return this._matrix=new THREE.Matrix4().set(r,0,0,0,0,s,0,0,0,0,o,0,0,0,0,1).multiply(this._matrix),this}brightness(r){return this._matrix=new THREE.Matrix4().set(r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1).multiply(this._matrix),this}saturate(r){const s=.2126*(1-r),o=.7152*(1-r),v=.0722*(1-r);return this._matrix=new THREE.Matrix4().set(s+r,o,v,0,s,o+r,v,0,s,o,v+r,0,0,0,0,1).multiply(this._matrix),this}contrast(r){const s=.5*(1-r);return this._matrix=new THREE.Matrix4().set(r,0,0,0,0,r,0,0,0,0,r,0,s,s,s,1).multiply(this._matrix),this}opacity(r){return this._matrix=new THREE.Matrix4().set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,r).multiply(this._matrix),this}invert(r){const s=1-2*r;return this._matrix=new THREE.Matrix4().set(s,0,0,0,0,s,0,0,0,0,s,0,r,r,r,1).multiply(this._matrix),this}grayscale(r=1){const s=.2126*r,o=.7152*r,v=.0722*r;return this._matrix=new THREE.Matrix4().set(s+1-r,o,v,0,s,o+1-r,v,0,s,o,v+1-r,0,0,0,0,1).multiply(this._matrix),this}sepia(r=1){return this._matrix=new THREE.Matrix4().set(1-.607*r,.769*r,.189*r,0,.349*r,1-.314*r,.168*r,0,.272*r,.534*r,1-.869*r,0,0,0,0,1).multiply(this._matrix),this}hueRotate(r){const s=r/180*Math.PI,o=Math.cos(s),v=Math.sin(s),u=.2126,w=.7152,L=.0722;return this._matrix=new THREE.Matrix4().set(u+.7874*o+v*-u,w+o*-w+v*-w,L+o*-L+.9278*v,0,u+o*-u+.143*v,w+o*(1-w)+.14*v,L+o*-L+-.283*v,0,u+o*-u+-.7874*v,w+o*-w+v*w,L+.9278*o+v*L,0,0,0,0,1).multiply(this._matrix),this}convolution(r,s=1/9,o=521){return this.uniformObj=Object.assign(Object.assign({},this.uniformObj),{cKernel:{value:r.toArray()},stStep:{value:s},scaleFactor:{value:o}}),this.filtersTypes.indexOf("convolutionTextureColor")<0&&(this.filtersStr+=`
        uniform float cKernel[9];
        uniform float stStep;
        uniform float scaleFactor;
        vec4 convolutionTextureColor(vec4 color) {
            vec2 offsets[9];
            offsets[0] = vec2(-1.0,-1.0);
            offsets[1] =  vec2(0.0,-1.0);
            offsets[2] = vec2(1.0,-1.0);
            offsets[3] =  vec2(-1.0,0.0);
            offsets[4] = vec2(0.0,0.0);
            offsets[5] = vec2(1.0,0.0);
            offsets[6] =  vec2(-1.0,1.0);
            offsets[7] = vec2(0.0,1.0);
            offsets[8] = vec2(1.0,1.0);

            vec4 sum = color;
            for(int i = 0; i < 9; i++) {
                sum = sum + cKernel[i] * scaleFactor * texture2D(e_Texture, v_Uv + offsets[i] / stStep);
            };
            return sum;
        }`,this.filtersTypes+=`color = convolutionTextureColor(color);
`),this}reset(){return this.uniformObj={},this.filtersStr="",this.filtersTypes="",this._matrix=new THREE.Matrix4,this}_getFilterShaderData(r){return{uniforms:Object.assign({e_Texture:{value:r},colorMatrix:{value:this._matrix}},this.uniformObj),vertexShader:this.VSHADER_SOURCE,fragmentShader:this.FSHADER_SOURCE}}_getFilterColor(r="#000000",s=1){r=new THREE.Color(r);let{r:o,g:v,b:u}=r;const w=this._matrix.toArray();w[12],w[13],w[14],w[15];const L=w[0]*o+w[1]*o+w[2]*o+w[3]*s,U=w[4]*v+w[5]*v+w[6]*v+w[7]*s,N=w[8]*u+w[9]*u+w[10]*u+w[11]*s;return r.setRGB(L,U,N),r}toJSON(){return JSON.stringify({matrix:this._matrix.toArray(),uniformObj:this.uniformObj,filtersStr:this.filtersStr,filtersTypes:this.filtersTypes})}static fromJSON(r){const{matrix:s,uniformObj:o,filtersStr:v,filtersTypes:u}=JSON.parse(r),w=new MxFilters;return w._matrix=new THREE.Matrix4().fromArray(s),w.uniformObj=o,w.filtersStr=v,w.filtersTypes=u,w}}class MxDbShape extends MxDbEntity{constructor(){super(...arguments),this.isLoadMaterialFromPath=!0,this.stroke="#fff",this.strokeLineWidth=2,this.isStrokeDashLine=!1,this.isFill=!1,this._fillImageSrc=null,this.curveSegments=50,this.closed=!0,this.filter=null,this._cornerRadius=[],this._propertyDbKeys=["isFill","stroke","strokeLineWidth","isStrokeDashLine","closed","cornerRadius","fillImageSrc","fillImageParam","curveSegments"]}setStroke(r){return this.stroke=r,this}setStrokeLineWidth(r){return this.strokeLineWidth=r,this}setIsStrokeDashLine(r){return this.isStrokeDashLine=r,this}setIsFill(r){return this.isFill=r,this}get fillImageSrc(){return this._fillImageSrc}set fillImageSrc(r){this._fillImageSrc=r,this.isLoadMaterialFromPath=!0,this.material=null,this.fillImageSrc&&(this.isFill=!0),r!==!1&&r!==null||(this.setNeedUpdateDisplay(),MxFun.updateDisplay())}setFillImageSrc(r){return this.fillImageSrc=r,this}setFillImageParam(r){this.fillImageParam=r===void 0?r:Object.assign(this.fillImageParam,r)}setCurveSegments(r){return this.curveSegments=r,this}setClosed(r){return this.closed=r,this}getFilter(){return this.filter}setFilter(r){this.filter=r,this.isLoadMaterialFromPath=!0,this.material=null}get cornerRadius(){return this._cornerRadius}set cornerRadius(r){this.setCornerRadius(r)}setCornerRadius(r,s=!0){this._cornerRadius=r instanceof Array?r.map(o=>s?MxFun.screenCoordLong2Doc(o):o):s?MxFun.screenCoordLong2Doc(r):r}getTypeName(){return"MxDbShape"}getShapePoints(r){const{curveSegments:s}=this;return this.points=r.getPoints(s).map(o=>o instanceof THREE.Vector2?new THREE.Vector3(o.x,o.y,0):o),this.points}createPaths(r){return this._paths=new THREE.CurvePath,Array.isArray(r)?r.forEach(s=>this._paths.add(s)):this._paths.add(r),this._paths}_draw(r,s){let{isFill:o,closed:v,opacity:u,dLineWidth:w,lineWidthByPixels:L}=this;r.setOpacity(u),r.setLineWidthByPixels(L),r.setLineWidth(w);const U=r.getColor();r.setColor(this.filter?this.filter._getFilterColor(this.color,this.opacity):this.color);const N=this.getCornerRadiusPoints(v||o?this.getClosedPoints(s):s);o?!this.fillImageSrc&&r.drawSolid(N):r.drawLines(N),this._fillImg(r,N),r.setColor(U)}getCornerRadiusPoints(r){const{cornerRadius:s}=this;if(!s)return r;const o=typeof s=="number"?r.map(()=>s):s;return o.length>0?getToGenerateRoundedCorners(r,o):r}_drawStoreLine(r,s,o){const{isFill:v,stroke:u,strokeLineWidth:w}=this,L=r.getLineWidth(),U=r.getColor(),N=r.isDashLineDisplay();u&&v&&(r.setDashLineDisplay(this.isStrokeDashLine),r.setColor(u),r.setLineWidth(w),o?o(r):r.drawLines(this.getCornerRadiusPoints(this.getClosedPoints(s))),r.setColor(U),r.setLineWidth(L),r.setDashLineDisplay(N))}getClosedPoints(r){return[...r,r[0]]}getTotalLength(){if(this.points){let r=0;return this.points.reduce((s,o)=>(r+=s.distanceTo(o),o)),r}if(this._paths)return this._paths.getLength()+(this.closedLine?this.closedLine.getLength():0)}getGetLength(){return this._paths.getLength()}getArea(){return this.points?McGeTool.calcArea(this.closed?this.getClosedPoints(this.points):this.points):0}worldDraw(r){const s=this.createPaths(new THREE.Curve),o=this.getShapePoints(s);this._draw(r,o),this._drawStoreLine(r,o)}_fillImg(r,s){const o={transparent:!0,depthTest:!1,opacity:this.opacity,visible:this.visible};if(!this.isFill||!this.fillImageSrc)return;if(!this.material){let U=this;return void MxFun.loadImageMaterial(this.fillImageSrc,N=>{U.isLoadMaterialFromPath=!1,N&&(U.material=N,U.setNeedUpdateDisplay(),MxFun.updateDisplay())})}const v=s.map(({x:U,y:N})=>new THREE.Vector2(U,N));let u=this.material,w=new THREE.ShapeGeometry(new THREE.Shape(v));if(w=repairGeometryFaceVertexUvs(w),this.filter){const U=u.map,N=this.filter._getFilterShaderData(U);u=new THREE.ShaderMaterial(Object.assign(Object.assign({},N),o))}if(u.depthTest=!1,u.transparent=!0,u.opacity=this.opacity,u.visible=this.visible,this.fillImageParam){const U=this.fillImageParam;for(let N in this.fillImageParam)this.material.map[N]=U[N]}let L=new THREE.Mesh(w,u);r.drawEntity(L)}getGripPoints(){return[]}moveGripPointsAt(r,s){return!0}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,this._propertyDbKeys),this.isLoadMaterialFromPath=!0,this.material=null,r.type===MxType.MxCloneType.kMxFileClone?r.filter&&(this.filter=MxFilters.fromJSON(r.filter)):r.filter&&(this.filter=r.filter),!0}dwgOut(r){var s;return this.onDwgOut(r),this.dwgOutHelp(r,this._propertyDbKeys),r.type===MxType.MxCloneType.kMxFileClone?this.filter&&(r.filter=(s=this.filter)===null||s===void 0?void 0:s.toJSON()):r.filter=this.filter,r}transformBy(r){this.points&&this.points.forEach(s=>{s.applyMatrix4(r)})}}class MxDbEllipseShape extends MxDbShape{constructor(){super(),this.center=new THREE.Vector3,this.xRadius=10,this.yRadius=10,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!1,this.rotation=0,this.isClosedToCenter=!0,this._propertyDbKeys=[...this._propertyDbKeys,"center","xRadius","yRadius","startAngle","endAngle","clockwise","rotation","isClosedToCenter"]}getTypeName(){return"MxDbEllipseShape"}setCenter(r){return this.center=r,this}setXRadius(r){return this.xRadius=r,this}setYRadius(r){return this.yRadius=r,this}setStartAngle(r){return this.startAngle=r,this}setEndAngle(r){return this.endAngle=r,this}setClockwise(r){return this.clockwise=r,this}setRotation(r){return this.rotation=r,this}setIsClosedToCenter(r){return this.isClosedToCenter=r,this}worldDraw(r){this.drawEllipseShape(r)}drawEllipseShape(r){let{startAngle:s,endAngle:o,clockwise:v}=this;const u=this.createEllipseCurve(),w=this.createPaths(u);let L=this.getShapePoints(w);return this._draw(r,L),this._drawStoreLine(r,L),{centralAngle:v?o>s?THREE.MathUtils.radToDeg(u.aEndAngle-u.aStartAngle):360-Math.abs(THREE.MathUtils.radToDeg(u.aEndAngle-u.aStartAngle)):s>o?Math.abs(THREE.MathUtils.radToDeg(u.aEndAngle-u.aStartAngle)):360-THREE.MathUtils.radToDeg(u.aEndAngle-u.aStartAngle),curve:u,points:L}}createEllipseCurve(r=this.center.x,s=this.center.y,o=this.xRadius,v=this.yRadius,u=this.startAngle,w=this.endAngle,L=this.clockwise,U=this.rotation){return new THREE.EllipseCurve(r,s,o,v,u,w,L,U)}getCornerRadiusPoints(r){return r}getClosedPoints(r){try{let s=(this._paths||new THREE.CatmullRomCurve3(r,!1,"catmullrom",0)).getLength();this.closedLine=this.getClosedLine(r);const o=this.closedLine.getLength();let v=this.curveSegments/s,u=2.5*(s>this.curveSegments?o*v:1);if(u>20*this.curveSegments&&(u=20*this.curveSegments),u<=0)return r;const w=this.closedLine.getPoints(u);return[...r,...w]}catch{return[...r,r[0]]}}getClosedLine(r){const{isClosedToCenter:s,center:o}=this;let v=s?[r[r.length-1],o,r[0]]:[r[r.length-1],r[0]];return new THREE.CatmullRomCurve3(v,!1,"catmullrom",.01)}getGripPoints(){return[this.center]}moveGripPointsAt(r,s){return r===0&&this.center.add(s),!0}}class MxDbCircleShape extends MxDbEllipseShape{getTypeName(){return"MxDbCircleShape"}get radius(){return this.xRadius}set radius(r){this.xRadius=r,this.yRadius=r}setRadius(r){return this.radius=r,this}setXRadius(r){return this.setRadius(r),this}setYRadius(r){return this.setRadius(r),this}}function drawMx3PointArc(){const b=new MrxDbgUiPrPoint,r=new McEdGetPointWorldDrawObject,s=new Mx3PointArc;b.setUserDraw(r),b.setMessage(`
:`),b.go(o=>{o===MrxDbgUiPrBaseReturn$1.kOk&&(s.point1=b.value(),r.setDraw(v=>{r.drawLine(s.point1,v)})),b.setMessage(`
:`),b.go(v=>{v===MrxDbgUiPrBaseReturn$1.kOk&&(s.point2=b.value(),r.setDraw(u=>{s.point3=u,r.drawCustomEntity(s)})),b.setMessage(`
:`),b.go(u=>{if(u===MrxDbgUiPrBaseReturn$1.kOk){MxFun.getCurrentDraw().addMxEntity(s);const{radius:w,angle:L,arcLength:U}=createThreePointArc(s.point1,s.point2,s.point3,!0);console.log(":",w),console.log(":",U,s.getTotalLength())}})})})}class Mx3PointArc extends MxDbCircleShape{constructor(){super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.point3=new THREE.Vector3,this.autoClockwise=!0,this.closed=!1,this.centralAngle=0,this._propertyDbKeys=[...this._propertyDbKeys,"point1","point2","point3","autoClockwise"]}getTypeName(){return"Mx3PointArc"}create(){return new Mx3PointArc}worldDraw(r){this.updateDataInfo();const{centralAngle:s}=this.drawEllipseShape(r);this.centralAngle=s}getGripPoints(){return[this.point1,this.point2,this.point3,this.center]}compute3PointAngle(r=this.point1,s=this.point2,o=this.point3){const v=calculateArcAngle(r,this.center,this.radius),u=calculateArcAngle(s,this.center,this.radius),w=calculateArcAngle(o,this.center,this.radius);return[v.angle,u.angle,w.angle]}upDateCenter(r=this.point1,s=this.point2,o=this.point3){return this.center=calculateArcOrigin(r,s,o),this.center}upDateRadius(r=this.point1){return this.radius=calculateRadiusArc(r,this.center),this.radius}upDataClockwise(r,s,o){const{autoClockwise:v}=this;v&&(this.clockwise=judgementArcRenderDirection(s,r,o))}updateDataInfo(){this.upDateCenter(this.point1,this.point2,this.point3),this.upDateRadius(this.point1);const[r,s,o]=this.compute3PointAngle();this.startAngle=THREE.MathUtils.degToRad(r),this.endAngle=THREE.MathUtils.degToRad(s),this.upDataClockwise(r,s,o)}getArcMidPoint(){const r=MxFun.getMxFunTHREE();this.updateDataInfo();let{startAngle:s,endAngle:o,center:v,radius:u,clockwise:w}=this;w?s<o&&(s+=2*Math.PI):s>o&&(o+=2*Math.PI);const L=(s+o)/2,U=v.x+u*Math.cos(L),N=v.y+u*Math.sin(L);return new r.Vector3(U,N,0)}moveGripPointsAt(r,s){return r===0?this.point1.add(s):r===1?this.point2.add(s):r===2?this.point3.add(s):r===3&&(this.point1.add(s),this.point2.add(s),this.point3.add(s)),this.upDateCenter(),!0}}Mx3PointArc.cmd="Mx_3PointArc",Mx3PointArc.draw=drawMx3PointArc,Mx3PointArc.isRegister=!1,addRegisterMxDbEntity(Mx3PointArc);const drawMx2PointArc=async()=>{const b=new MrxDbgUiPrPoint,r=new Mx2PointArc,s=await b.go();if(!s)return;r.startPoint=s,b.setUserDraw((v,u)=>{r.endPoint=v,u.drawCustomEntity(r)});const o=await b.go();o&&(r.endPoint=o,MxFun.getCurrentDraw().addMxEntity(r))};class Mx2PointArc extends Mx3PointArc{getTypeName(){return"Mx2PointArc"}create(){return new Mx2PointArc}get startPoint(){return this.point1}set startPoint(r){this.point1=r,this.point3.x,this.point1.x,this.point3.y,this.point2.y}get endPoint(){return this.point2}set endPoint(r){this.point2=r,this.point3=this.getArcMidPoint()}}function drawMxDbCoord(){const b=new MrxDbgUiPrPoint;b.setMessage(`
:`),b.go(r=>{if(r!=0)return;const s=b.value();let o=new MxDbCoord;o.point1=s,o.point2=s.clone(),b.setBasePt(s),b.setUseBasePt(!0),b.setUserDraw((v,u)=>{o.point2=v,u.drawCustomEntity(o)}),b.setMessage(`
:`),b.go(v=>{v==0?(o.point2=b.value(),MxFun.addToCurrentSpace(o)):console.log(v)})})}Mx2PointArc.cmd="Mx_2PointArc",Mx2PointArc.draw=drawMx2PointArc,Mx2PointArc.isRegister=!1,addRegisterMxDbEntity(Mx2PointArc);class MxDbCoord extends MxDbEntity{constructor(){super(...arguments),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3}worldDraw(r){let s=r.getMxObject();r.drawLine(this.point1,this.point2);let o=this.point2.clone();var v=s.screenCoordLong2Doc(20),u=6*v;o.x=o.x+u,r.drawLine(this.point2,o);var w=new THREE.Vector3,L=new THREE.Vector3;let U=s.docCoord2Cad(this.point1.x,this.point1.y,this.point1.z),N=U.x.toFixed(3),D=U.y.toFixed(3);w.x=this.point2.x+.3*v+.5*u,w.y=this.point2.y+.1*v+.5*v,r.drawText(N,v,0,w),L.x=this.point2.x+.3*v+.5*u,L.y=this.point2.y-.1*v-.5*v,r.drawText(D,v,0,L)}getGripPoints(){let r=[];return r.push(this.point1),r.push(this.point2),r}moveGripPointsAt(r,s){return r==0?this.point1.add(s):r==1&&this.point2.add(s),!0}dwgIn(r){return this.onDwgIn(r),this.point1.copy(r.point1),this.point2.copy(r.point2),!0}dwgOut(r){return this.onDwgOut(r),r.point1=this.point1,r.point2=this.point2,r}create(){return new MxDbCoord}transformBy(r){this.point1.applyMatrix4(r),this.point2.applyMatrix4(r)}getTypeName(){return"MxDbCoord"}}async function drawMxDbLine(){const b=new MrxDbgUiPrPoint;b.setMessage(`
:`);let r=await b.go();if(r==null)return;b.setBasePt(r.clone()),b.setUseBasePt(!0),b.setMessage(`
:`);let s=await b.go();if(s==null)return;let o=new MxDbLine;o.pt1=r,o.pt2=s,MxFun.addToCurrentSpace(o)}MxDbCoord.cmd="Mx_Coord",MxDbCoord.draw=drawMxDbCoord,addRegisterMxDbEntity(MxDbCoord);class MxDbLine extends MxDbEntity{constructor(){super(...arguments),this.pt1=new THREE.Vector3,this.pt2=new THREE.Vector3}getTypeName(){return"MxDbLine"}worldDraw(r){r.drawLine(this.pt1,this.pt2)}setPoint1(r){this.pt1=r}getPoint1(){return this.pt1}setPoint2(r){this.pt2=r}getPoint2(){return this.pt2}getGripPoints(){let r=[];r.push(this.pt1),r.push(this.pt2);let s=new THREE.Vector3(this.pt1.x+.5*(this.pt2.x-this.pt1.x),this.pt1.y+.5*(this.pt2.y-this.pt1.y),0);return r.push(s),r}moveGripPointsAt(r,s){return r==0?this.pt1.add(s):r==1?this.pt2.add(s):r==2&&(this.pt1.add(s),this.pt2.add(s)),!0}dwgIn(r){return this.onDwgIn(r),this.pt1.copy(r.pt1),this.pt2.copy(r.pt2),!0}dwgOut(r){return this.onDwgOut(r),r.pt1=this.pt1,r.pt2=this.pt2,r}create(){return new MxDbLine}getGeomExtents(){return new THREE.Box3(this.pt1,this.pt2)}getGetLength(){return this.pt1.distanceTo(this.pt2)}}async function drawMxDbRect(){const b=new MrxDbgUiPrPoint;b.setMessage(`
:`);let r=await b.go();if(!r)return;let s=new MxDbRect;s.pt1=r;const o=new McEdGetPointWorldDrawObject;o.setDraw(v=>{s.pt2=v,o.drawCustomEntity(s)}),b.setBasePt(r),b.setUseBasePt(!0),b.setUserDraw(o),b.setMessage(`
:`),await b.go()&&(s.pt2=b.value(),MxFun.getCurrentDraw().addMxEntity(s))}MxDbLine.cmd="Mx_Line",MxDbLine.draw=drawMxDbLine,addRegisterMxDbEntity(MxDbLine);class MxDbRect extends MxDbEntity{constructor(){super(...arguments),this.cornerRadius=[],this.pt1=new THREE.Vector3,this.pt2=new THREE.Vector3,this.isSolidColorFill=!1,this.isLoadMaterialFromPath=!0,this.material=null}worldDraw(r){let s=computeRectPoints(this.pt1,this.pt2);if(this.cornerRadius.length>0&&(s=getToGenerateRoundedCorners(s,this.cornerRadius)),r.getType()!=McGiWorldDrawType$1.kWorldDraw)return s.push(s[0]),void r.drawLines(s);const o={transparent:!0,depthTest:!1,opacity:this.opacity,visible:this.visible};if(this.isSolidColorFill){let v;s=s.map(({x:L,y:U})=>new THREE.Vector2(L,U)),v=new THREE.ShapeGeometry(new THREE.Shape(s));let u=new THREE.MeshBasicMaterial(Object.assign({color:this.filter?this.filter._getFilterColor(this.color,this.opacity):new THREE.Color(this.color)},o)),w=new THREE.Mesh(v,u);r.drawEntity(w)}else if(this.fillImageSrc){if(this.material){s=s.map(({x:L,y:U})=>new THREE.Vector2(L,U));let v=this.material,u=new THREE.ShapeGeometry(new THREE.Shape(s));if(u=repairGeometryFaceVertexUvs(u),this.filter){const L=v.map;this.fillImageParam&&(this.fillImageParam.center&&(L.center=this.fillImageParam.center),this.fillImageParam.offset&&(L.offset=this.fillImageParam.offset),this.fillImageParam.repeat&&(L.repeat=this.fillImageParam.repeat),this.fillImageParam.rotation&&(L.rotation=this.fillImageParam.rotation));const U=this.filter._getFilterShaderData(L);v=new THREE.ShaderMaterial(Object.assign(Object.assign({},U),o))}v.depthTest=!1,v.transparent=!0,v.opacity=this.opacity,v.visible=this.visible;let w=new THREE.Mesh(u,v);r.drawEntity(w)}else if(this.fillImageSrc.length>0&&this.isLoadMaterialFromPath){let v=this;MxFun.loadImageMaterial(this.fillImageSrc,u=>{this.isLoadMaterialFromPath=!1,u&&(v.material=u,v.setNeedUpdateDisplay(),MxFun.updateDisplay())})}}else{let v=new THREE.BufferGeometry().setFromPoints(s),u=new THREE.LineBasicMaterial(Object.assign({color:this.getColor()},o)),w=new THREE.LineLoop(v,u);r.drawEntity(w)}}getGripPoints(){let r=[];r.push(this.pt1);const s=new THREE.Line3(this.pt1,this.pt2);let o=new THREE.Vector3;return s.getCenter(o),r.push(o),r.push(this.pt2),r}moveGripPointsAt(r,s){return r==0?this.pt1.add(s):r==1?(this.pt1.add(s),this.pt2.add(s)):r==2&&this.pt2.add(s),!0}dwgIn(r){return this.onDwgIn(r),this.pt1.copy(r.pt1),this.pt2.copy(r.pt2),this.isSolidColorFill=r.isSolidColorFill,this.fillImageSrc=r.fillImageSrc,this.fillImageParam=r.fillImageParam,this.cornerRadius=r.cornerRadius,this.filter=r.filter,this.isLoadMaterialFromPath=!0,this.material=null,!0}dwgOut(r){return this.onDwgOut(r),r.pt1=this.pt1,r.pt2=this.pt2,r.isSolidColorFill=this.isSolidColorFill,r.fillImageSrc=this.fillImageSrc,r.fillImageParam=this.fillImageParam,r.cornerRadius=this.cornerRadius,r.filter=this.filter,r}create(){return new MxDbRect}transformBy(r){this.pt1.applyMatrix4(r),this.pt2.applyMatrix4(r)}setRadius(r,s=!0){this.cornerRadius=r instanceof Array?r.map(o=>s?MxFun.screenCoordLong2Doc(o):o):r>0?s?[MxFun.screenCoordLong2Doc(r),MxFun.screenCoordLong2Doc(r),MxFun.screenCoordLong2Doc(r),MxFun.screenCoordLong2Doc(r)]:[r,r,r,r]:[]}getTypeName(){return"MxDbRect"}getFilter(){return this.filter}setFilter(r){this.filter=r,this.isLoadMaterialFromPath=!0,this.material=null}setFillImagePath(r){this.fillImageSrc=r,this.isLoadMaterialFromPath=!0,this.material=null,this.fillImageSrc&&(this.isSolidColorFill=!1)}getFillImagePath(){return this.fillImageSrc}}function drawMxDbAlignedDimension(){let b=new MxDbAlignedDimension;const r=new MrxDbgUiPrPoint;return r.setMessage(`
:`),r.go(s=>{if(s!=0)return;const o=r.value();b.setPoint1(o),b.setColor(65314);const v=new McEdGetPointWorldDrawObject;v.setDraw(u=>{b.setPoint2(u),v.drawCustomEntity(b)}),r.setBasePt(o),r.setUseBasePt(!0),r.setUserDraw(v),r.setMessage(`
:`),r.setInputToucheType(MxType.InputToucheType.kGetEnd),r.go(u=>{if(u!=0)return void console.log(u);const w=r.value();b.setPoint2(w),MxFun.getCurrentDraw().addMxEntity(b)})}),b}MxDbRect.cmd="Mx_DrawRect",MxDbRect.draw=drawMxDbRect,addRegisterMxDbEntity(MxDbRect);const propertyDbKeys$5=["point1","point2","fontColor"];class MxDbAlignedDimension extends MxDbEntity{constructor(r){if(super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,r){const{points:s,fontColor:o}=r;s&&this.setPoints(s),o&&(this.fontColor=o)}}setPoints(r){const[s,o]=r;s&&(this.point1=s),o&&(this.point2=o)}getTypeName(){return"MxDbAlignedDimension"}getDirection(r,s,o){const v=new THREE.Vector3(r.x,r.y,0),u=new THREE.Vector3(1,0,0),w=r.angleTo(u);let L=-1;(w<7*Math.PI/18||w>10*Math.PI/18)&&s.x>o.x&&(L=1);const U=new THREE.Matrix4;return U.makeRotationZ(Math.PI/2*L),v.applyMatrix4(U),v}getDimText(){return new THREE.Vector3(this.point1.x-this.point2.x,this.point1.y-this.point2.y,0).length().toFixed(3)}worldDraw(r){if(r.setOpacity(this.opacity),r.getType()==McGiWorldDrawType$1.kWorldDraw||r.getType()==McGiWorldDrawType$1.kDynDragDraw){let E=function(W,C){Array.isArray(W)?W.forEach(F=>{E(F,C)}):W.opacity=C};const s=this.point1,o=this.point2;let v,u,w,L,U,N,D;const f=new THREE.Vector3(s.x-o.x,s.y-o.y,0),P=this.getDirection(f,s,o),T=new THREE.Matrix4;T.makeScale(.01,.01,.01);const B=new THREE.Vector3(P.x,P.y,0);B.applyMatrix4(T);const G=new THREE.Vector3(s.x+B.x,s.y+B.y,0),R=new THREE.Vector3(o.x+B.x,o.y+B.y,0),_=this.getColor();N=MxThreeJS.createPoint(s,_),D=MxThreeJS.createPoint(o,_);const ee=new THREE.Vector3(P.x,P.y,0),k=new THREE.Vector3(P.x,P.y,0);T.identity(),T.makeScale(.2,.2,0),ee.applyMatrix4(T),T.identity(),T.makeScale(.02,.02,0),k.applyMatrix4(T),r.drawLine(G.x+2*k.x,G.y+2*k.y,R.x+2*k.x,R.y+2*k.y),v=MxThreeJS.createLine(new THREE.Vector3(G.x+3*k.x,G.y+3*k.y,0),new THREE.Vector3(s.x+.5*k.x,s.y+.5*k.y,0),_),u=MxThreeJS.createLine(new THREE.Vector3(R.x+3*k.x,R.y+3*k.y,0),new THREE.Vector3(o.x+.5*k.x,o.y+.5*k.y,0),_);{const W=new THREE.Vector3(1,0,0);let C=f.angleTo(W);const F=new THREE.Vector3(P.x,P.y,0);F.normalize();const M=s.distanceTo(o);f.y<0?C=C<Math.PI/2?2*Math.PI-C:Math.PI-C:C>Math.PI/2&&(C=Math.PI+C);const a=r.getMxObject();a&&(C-=a.getViewAngle());const h=this.getDimText();(w=MxThreeJS.creatTextSprite(h,new THREE.Vector3(R.x+f.x/2+F.x*M/15,R.y+f.y/2+F.y*M/15,0),.07*M,C,this.fontColor||_))!=null&&(w.material.opacity=this.opacity,r.drawEntity(w))}{T.identity(),T.makeScale(.08,.08,.08);const W=new THREE.Matrix4;W.makeRotationZ(17*Math.PI/18);let C=new THREE.Vector3(f.x,f.y,0);C.applyMatrix4(T),C.applyMatrix4(W),W.identity(),W.makeRotationZ(17*-Math.PI/18);let F=new THREE.Vector3(f.x,f.y,0);F.applyMatrix4(T),F.applyMatrix4(W);const M=new Array;M.push(new THREE.Vector3(G.x+2*k.x,G.y+2*k.y,0),new THREE.Vector3(G.x+2*k.x+C.x,G.y+C.y+2*k.y,0),new THREE.Vector3(G.x+2*k.x+F.x,G.y+F.y+2*k.y,0)),L=MxThreeJS.createTriangle(M,_),W.identity(),W.makeRotationZ(Math.PI/18),(C=new THREE.Vector3(f.x,f.y,0)).applyMatrix4(T),C.applyMatrix4(W),W.identity(),W.makeRotationZ(-Math.PI/18),(F=new THREE.Vector3(f.x,f.y,0)).applyMatrix4(T),F.applyMatrix4(W);const a=new Array;a.push(new THREE.Vector3(R.x+2*k.x,R.y+2*k.y,0),new THREE.Vector3(R.x+C.x+2*k.x,R.y+C.y+2*k.y,0),new THREE.Vector3(R.x+F.x+2*k.x,R.y+F.y+2*k.y,0)),U=MxThreeJS.createTriangle(a,_)}r.drawEntity(v),r.drawEntity(u),L&&(E(L.material,this.opacity),r.drawEntity(L)),U&&(E(U.material,this.opacity),r.drawEntity(U)),r.drawEntity(N),r.drawEntity(D)}else r.drawLine(this.point1,this.point2)}setPoint1(r){this.point1=r}setPoint2(r){this.point2=r}setColor(r){return lodash.isArray(r)?([this.color=this.color,this.fontColor=this.fontColor||this.color]=r,console.log("this.fontColor : ",this.fontColor)):this.color=r,this}getGripPoints(){let r=[];return r.push(this.point1),r.push(this.point2),r}moveGripPointsAt(r,s){return r==0?this.point1.add(s):(r=1)&&this.point2.add(s),!0}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,propertyDbKeys$5),!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,propertyDbKeys$5),r}create(){return new MxDbAlignedDimension}}MxDbAlignedDimension.cmd="Mx_DimensionMeasurement",MxDbAlignedDimension.draw=drawMxDbAlignedDimension,addRegisterMxDbEntity(MxDbAlignedDimension);class MxDbHatch extends MxDbEntity{constructor(){super(...arguments),this.points=[]}worldDraw(r){r.getType()===McGiWorldDrawType$1.kWorldDraw?r.drawSolid(this.points):r.drawLines([...this.points,this.points[0]])}getTypeName(){return"MxDbHatch"}moveGripPointsAt(r,s){return r===0?this.points.forEach(o=>{o.add(s)}):this.points[r-1]&&this.points[r-1].add(s),!0}setPoints(r){this.points=r.map(s=>s.clone())}getGripPoints(){if(this.points.length>0){const{centerPoint:r}=computeBounding(this.points);return[r,...this.points]}return[]}dwgIn(r){this.onDwgIn(r);const s=r.points;return this.points=s.map(({x:o,y:v,z:u})=>new THREE.Vector3(o,v,u)),!0}dwgOut(r){return this.onDwgOut(r),r.points=this.points,r}}function drawMxDbArea(){const b=new MrxDbgUiPrPoint;b.setMessage(`
:`),b.go(r=>{if(r!=0)return;const s=b.value();let o=new MxDbArea;o.addPoint(s);const v=new McEdGetPointWorldDrawObject;v.setDraw((u,w)=>{let L=o.clone();L.addPoint(u),v.drawCustomEntity(L)}),b.setUserDraw(v),b.setMessage(`
:`),b.goWhile(u=>{if(u==0){const w=b.value();o.addPoint(w)}},u=>{o.isFill=!0,o.fillOpacity=.7,o.fillColor=6697540,MxFun.getCurrentDraw().addMxEntity(o)})})}addRegisterMxDbEntity(MxDbHatch);class MxDbArea extends MxDbEntity{constructor(){super(...arguments),this.points=[],this.isFill=!1,this.fillColor=6697540,this.fillOpacity=.7}getTypeName(){return"MxDbArea"}create(){return new MxDbArea}getDimText(){return McGeTool.calcArea(this.points).toFixed(2)}worldDraw(r){if(this.points.length<3)return void(this.points.length==2&&r.drawLine(this.points[0],this.points[1]));let s=this.points[0],o=s.clone(),v=s.clone(),u=this.points.length;for(let D=1;D<u;D++){let f=this.points[D];o.x>f.x&&(o.x=f.x),o.y>f.y&&(o.y=f.y),v.x<f.x&&(v.x=f.x),v.y<f.y&&(v.y=f.y),r.drawLine(s,f),s=f}r.drawLine(s,this.points[0]);let w=new THREE.Vector3(o.x+.5*(v.x-o.x),o.y+.5*(v.y-o.y));const L=r.getColor();let U=MxFun.screenCoordLong2Doc(20),N=MxThreeJS.creatTextSprite(this.getDimText(),w,U,0,L);if(N!=null&&r.drawEntity(N),r.getType()==McGiWorldDrawType$1.kWorldDraw&&this.isFill){r.setColor(this.fillColor),r.setOpacity(this.fillOpacity),r.setRenderOrder(r.getRenderOrder()-1);const D=new MxDbHatch;D.points=this.points,D.worldDraw(r)}}getGripPoints(){return this.points}moveGripPointsAt(r,s){return!(r>=this.points.length||(this.points[r].add(s),0))}dwgIn(r){this.onDwgIn(r);let s=r.points;return this.points=[],s.forEach(o=>{this.points.push(new THREE.Vector3(o.x,o.y,o.z))}),this.dwgInHelp(r,["isFill","fillColor","fillOpacity"]),!0}dwgOut(r){return this.onDwgOut(r),r.points=this.points,this.dwgOutHelp(r,["isFill","fillColor","fillOpacity"]),r}addPoint(r){this.points.push(r.clone())}getPoints(){return this.points}clearPoint(){this.points=[]}}async function drawMxDbLeadTag(){let r=await new MrxDbgUiPrPoint().go();if(!r)return;let s=prompt("","");if(!s)return;const o=new MxDbLeadTag;o.point=r,o.text=s,MxFun.addToCurrentSpace(o)}MxDbArea.cmd="Mx_Area",MxDbArea.draw=drawMxDbArea,addRegisterMxDbEntity(MxDbArea);class MxDbLeadTag extends MxDbEntity{constructor(){super(...arguments),this.point=new THREE.Vector3,this.leadLen=88,this.text="",this.textHeight=24}getTypeName(){return"MxDbLeadTag"}createDots(r,s){const{x:o,y:v,z:u}=r,w=new THREE.Shape;w.arc(o,v,s.screenCoordLong2Doc(6),0,2*Math.PI,!0);const L=new THREE.Path;L.arc(o,v,s.screenCoordLong2Doc(3),0,2*Math.PI,!0),w.holes.push(L);const U=new THREE.ShapeGeometry(w),N=new THREE.MeshPhongMaterial({color:"#ff0000",transparent:!0}),D=new THREE.Shape;D.arc(o,v,s.screenCoordLong2Doc(3),0,2*Math.PI,!0);const f=new THREE.ShapeGeometry(D),P=new THREE.MeshPhongMaterial({color:"#e2da8f",transparent:!0}),T=new THREE.Mesh(U,N),B=new THREE.Mesh(f,P);return T.add(B),T}worldDraw(r){let s=r.getMxObject();const o=this.createDots(this.point,s);if(r.drawEntity(o),o.geometry.computeBoundingBox(),r.drawSelectLine(o.geometry.boundingBox.max,o.geometry.boundingBox.min),r.getType()===2)return;let v=r.getMxObject().screenCoordLong2Doc(this.leadLen),u=new THREE.Vector3(this.point.x+2*v,this.point.y+v,0);const w=u.x-v,L=new THREE.Vector3(w,u.y,u.z);r.setLineWidth(4),r.setColor(16770565),r.drawLines([this.point,L,u]);const U=r.getMxObject().screenCoordLong2Doc(this.textHeight),N=u.clone().setX(u.x);r.setColor(16744448);const D=MxThreeJS.creatTextSprite(this.text,N,U,0,r.getColor());if(D){const f=new THREE.Box3,P=new THREE.Vector3;f.expandByObject(D),f.getSize(P),D.position.setX(D.position.x+P.x/2);const T=r.getMxObject().screenCoordLong2Doc(5),B=f.min.clone().setX(f.min.x+P.x/2).setY(f.min.y-T),G=f.max.clone().setX(f.max.x+P.x/2).setY(f.min.y+T);G.setY(f.max.y+T);const R=new THREE.Vector3(B.x,G.y),_=new THREE.Vector3(G.x,B.y);r.setColor(16777215),r.setLineWidth(0),r.drawLine(B,R),r.drawLine(G,_),r.drawLine(B,_),r.drawLine(R,G);const ee=T/2,k=[],E=[];k.push(new THREE.Vector3(R.x+ee,R.y-T,R.z),new THREE.Vector3(R.x+ee,R.y-ee,R.z),new THREE.Vector3(R.x+T,R.y-ee,R.z)),E.push(new THREE.Vector3(_.x-ee,_.y+T,_.z),new THREE.Vector3(_.x-ee,_.y+ee,_.z),new THREE.Vector3(_.x-T,_.y+ee,_.z)),r.drawLines(k),r.drawLines(E),r.setOpacity(.5),r.setColor(6697540),r.setRenderOrder(-100),r.drawSolid([B,R,G,_]),r.setRenderOrder(100),r.drawEntity(D)}}getGripPoints(){return[this.point]}onViewChange(){return this.setNeedUpdateDisplay(),!0}moveGripPointsAt(r,s){return r===0&&this.point.add(s),!0}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,["point","text","textHeight","leadLen"]),!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,["point","text","textHeight","leadLen"]),r}}function drawMxDbAnyLine(){const b=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),s=new McEdGetPointWorldDrawObject,o=new MxDbAnyLine;b.setUserDraw(s),b.setMessage(`
:`),b.go(v=>{v===MrxDbgUiPrBaseReturn$1.kOk&&(o.points.push(b.value()),s.setDraw(u=>{o.points.push(u.clone()),s.drawCustomEntity(o)})),b.setMessage(`
:`),b.go(u=>{u===MrxDbgUiPrBaseReturn$1.kOk&&r.addMxEntity(o)})})}MxDbLeadTag.cmd="Mx_LeadTag",MxDbLeadTag.draw=drawMxDbLeadTag,addRegisterMxDbEntity(MxDbLeadTag);const propertyDbKeys$4=["points"];class MxDbAnyLine extends MxDbEntity{constructor(){super(...arguments),this.points=[]}getTypeName(){return"MxDbAnyLine"}create(){return new MxDbAnyLine}worldDraw(r){let s=r.getMxObject();const o=new THREE.Box3().setFromPoints(this.points);let v=new THREE.Vector3;if(o.getCenter(v),r.drawLines(this.points),r.getType()===McGiWorldDrawType$1.kSelectDraw){const u=new THREE.Vector3;o.getSize(u),u.addScalar(s.screenCoordLong2Doc(20));const w=u.x/2,L=u.y/2,U={x:v.x-w,y:v.y-L},N={x:v.x+w,y:v.y-L},D={x:v.x+w,y:v.y+L},f={x:v.x-w,y:v.y+L};r.drawLine(N.x,N.y,D.x,D.y),r.drawLine(U.x,U.y,N.x,N.y),r.drawLine(D.x,D.y,f.x,f.y),r.drawLine(f.x,f.y,U.x,U.y)}}setPoints(r){return this.points=r,this}getCenter(){const r=new THREE.Geometry;r.vertices=this.points;const s=new THREE.Vector3;return r.computeBoundingBox(),r.boundingBox.getCenter(s),s}getGripPoints(){return[this.getCenter()]}moveGripPointsAt(r,s){return r===0&&this.points.forEach(o=>{o.add(s)}),!0}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,propertyDbKeys$4),!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,propertyDbKeys$4),r}}function drawMxDbCloudLine(){const b=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),s=new McEdGetPointWorldDrawObject;b.setMessage(`
:`),b.go(()=>{const o=MxFun.screenCoordLong2Doc(16);let v=b.value();const u=new MxDbCloudLine;u.setRadius(o),u.addPoint(v),s.setDraw(w=>{v.distanceTo(w)>o&&(v=w.clone(),u.addPoint(w,!0)),s.drawCustomEntity(u)}),b.setUserDraw(s),b.setMessage(`
:`),b.go(()=>{r.addMxEntity(u)})})}MxDbAnyLine.cmd="Mx_AnyLine",MxDbAnyLine.draw=drawMxDbAnyLine,addRegisterMxDbEntity(MxDbAnyLine);const propertyDbKeys$3=["points","radius"];class MxDbCloudLine extends MxDbEntity{constructor(){super(),this.points=[],this.radius=16,this.cachePoint=null,this.use_smallcoord_display=!0}getTypeName(){return"MxDbCloudLine"}create(){return new MxDbCloudLine}setRadius(r){this.radius=r}getRadius(){return this.radius}getCachePoint(){return this.cachePoint}clacNewArcDiameterPoint(r){if(this.points.length==0)return r;let s=this.points[this.points.length-1];const o=2*this.radius,v=s.distanceTo(r);if(v<o)return null;const u=o*(r.x-s.x)/v+s.x,w=o*(r.y-s.y)/v+s.y;return new THREE.Vector3(u,w,s.z)}createCloudArcCurvePoints(r,s,o){const v=new THREE.Vector3((r.x+s.x)/2,(r.y+s.y)/2,0);o||(o=v.distanceTo(r));const{startAngle:u,endAngle:w}=function(L,U,N){const D=2*Math.PI/360;return{startAngle:180*Math.atan2(U.y-L.y,U.x-L.x)/Math.PI*D,endAngle:180*Math.atan2(N.y-L.y,N.x-L.x)/Math.PI*D}}(v,r,s);return new THREE.ArcCurve(v.x,v.y,o,u,w,!0).getPoints(10)}addPoint(r,s){let o=this.clacNewArcDiameterPoint(r);o&&(this.points.push(o),this.cachePoint=null,s&&(this.cachePoint=this.reCalculateDrawGeometryPoint()))}addLine(r,s){this.addPoint(r);const o=2*this.radius;let v=this.points[this.points.length-1],u=v.distanceTo(s);const w=Math.round(u/o);for(let L=0;L<w;L++){u=v.distanceTo(s);const U=o*(s.x-v.x)/u+v.x,N=o*(s.y-v.y)/u+v.y;let D=new THREE.Vector3(U,N,s.z);this.addPoint(D),v=D}return this.points[this.points.length-1]}reCalculateDrawGeometryPoint(){if(this.points.length<2)return null;let r=this.points[0],s=this.points.length,o=[];for(let v=1;v<s;v++){let u=this.points[v];this.createCloudArcCurvePoints(r,u).forEach(w=>{o.push(new THREE.Vector3(w.x,w.y,0))}),r=u}return o}worldDraw(r){if(this.cachePoint||(this.cachePoint=this.reCalculateDrawGeometryPoint()),!this.cachePoint)return;let s=r.getMxObject();if(r.getType()===McGiWorldDrawType$1.kSelectDraw){let o=new THREE.Geometry;this.cachePoint.forEach(P=>{o.vertices.push(new THREE.Vector3(P.x,P.y,0))}),o.computeBoundingBox();const v=new THREE.Vector3;o.boundingBox.getSize(v);let u=new THREE.Vector3;o.boundingBox.getCenter(u);const w=v.x/2,L=v.y/2,U={x:u.x-w,y:u.y-L},N={x:u.x+w,y:u.y-L},D={x:u.x+w,y:u.y+L},f={x:u.x-w,y:u.y+L};r.drawLine(this.toSmallcoord2(s,U.x,U.y),this.toSmallcoord2(s,N.x,N.y)),r.drawLine(this.toSmallcoord2(s,N.x,N.y),this.toSmallcoord2(s,D.x,D.y)),r.drawLine(this.toSmallcoord2(s,D.x,D.y),this.toSmallcoord2(s,f.x,f.y)),r.drawLine(this.toSmallcoord2(s,f.x,f.y),this.toSmallcoord2(s,U.x,U.y))}else{let o=[];this.cachePoint.forEach(v=>{o.push(this.toSmallcoord(s,v))}),r.drawLines(o)}}getCenter(){const r=new THREE.Geometry;r.vertices=this.points;let s=new THREE.Vector3;return r.computeBoundingBox(),r.boundingBox.getCenter(s),s}getGripPoints(){return[this.getCenter()]}moveGripPointsAt(r,s){return this.points.forEach(o=>{o.add(s)}),this.cachePoint=null,!0}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,propertyDbKeys$3),this.cachePoint=null,!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,propertyDbKeys$3),r.type===MxType.MxCloneType.kSaveDwgClone&&this.dwgOutHelp(r,["cachePoint"]),r}}function drawMxDbRegularPolygon(){const b=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),s=new McEdGetPointWorldDrawObject,o=new MxDbRegularPolygon;b.setMessage(`
:`),b.go(()=>{let v=prompt("","8");v&&(o.sidesNumber=Number(v),o.centerPoint=b.value(),b.setUserDraw(s),s.setDraw(u=>{o.otherPoint=u,s.drawCustomEntity(o)}),b.setMessage(`
:`),b.go(()=>{r.addMxEntity(o)}))})}MxDbCloudLine.isRegister=!1,MxDbCloudLine.cmd="Mx_CloudLine",MxDbCloudLine.draw=drawMxDbCloudLine,addRegisterMxDbEntity(MxDbCloudLine);class MxDbRegularPolygon extends MxDbShape{getTypeName(){return"MxDbRegularPolygon"}constructor(){super(),this.centerPoint=new THREE.Vector3,this.otherPoint=new THREE.Vector3,this.sidesNumber=5,this._propertyDbKeys=[...this._propertyDbKeys,"centerPoint","otherPoint","sidesNumber"]}worldDraw(r){const s=computeRegularPolygonVertices(this.centerPoint,this.otherPoint,this.sidesNumber);this.closed=!1,s.push(s[0]),this._draw(r,s),this._drawStoreLine(r,s)}getGripPoints(){return[this.centerPoint,this.otherPoint]}moveGripPointsAt(r,s){return r===0?(this.centerPoint.add(s),this.otherPoint.add(s)):r===1&&this.otherPoint.add(s),!0}}function drawMxDbLeadComment(){const b=new MrxDbgUiPrPoint;b.setMessage(`
:`),b.go(r=>{if(r!=0)return;const s=b.value();let o=new MxDbLeadComment;o.point1=s.clone(),o.textHeight=MxFun.screenCoordLong2Doc(50);let v=prompt("","");if(!v)return;o.text=v,o.textWidth=MxFun.screenCoordLong2Doc(10*v.length),o.fixedSize=!0,o.fixedSize&&(o.textHeight=50,o.textWidth=50*v.length);const u=new McEdGetPointWorldDrawObject;u.setDraw((w,L)=>{o.point2=w,L.drawCustomEntity(o)}),b.setBasePt(s),b.setUseBasePt(!0),b.setUserDraw(u),b.setMessage(`
:`),b.go(w=>{if(w!=0)return void console.log(w);const L=b.value();o.point2=L,MxFun.addToCurrentSpace(o)})})}MxDbRegularPolygon.cmd="Mx_RegularPolygon",MxDbRegularPolygon.draw=drawMxDbRegularPolygon,addRegisterMxDbEntity(MxDbRegularPolygon);class MxDbLeadComment extends MxDbEntity{constructor(){super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.text="",this.textHeight=20,this.textWidth=0,this.fixedSize=!1,this.use_smallcoord_display=!0}getTypeName(){return"MxDbLeadComment"}create(){return new MxDbLeadComment}worldDraw(r){let s=r.getMxObject(),o=this.toSmallcoord(s,this.point1),v=this.toSmallcoord(s,this.point2);if(r.drawLine(o,v),this.text.length>0){const u=new THREE.Vector3;let w=this.textHeight,L=this.textWidth;this.fixedSize&&(w=s.screenCoordLong2Doc(w),L=s.screenCoordLong2Doc(L));let U=MxThreeJS.clacTextSpriteSize(this.text,w,L);u.x=v.x+.5*U.textwidth,u.y=v.y+.5*U.allTextHeight,r.drawText(this.text,w,0,u,L);const N=new THREE.Vector3;N.x=v.x+U.textwidth,N.y=v.y,r.drawLine(N,v)}}getGripPoints(){let r=[];return r.push(this.point1),r.push(this.point2),r}moveGripPointsAt(r,s){return r==0?this.point1.add(s):r==1&&this.point2.add(s),!0}dwgIn(r){return this.onDwgIn(r),this.point1.copy(r.point1),this.point2.copy(r.point2),this.text=r.text.substr(0),this.textHeight=r.textHeight,r.textWidth&&(this.textWidth=r.textWidth),this.fixedSize=r.fixedSize,!0}dwgOut(r){return this.onDwgOut(r),r.point1=this.point1,r.point2=this.point2,r.textHeight=this.textHeight,r.text=this.text,r.textWidth=this.textWidth,r.fixedSize=this.fixedSize,r}onViewChange(){return!!this.fixedSize&&(this.setNeedUpdateDisplay(!1),!0)}}function drawMxDbRectBoxLeadComment(){const b=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),s=new McEdGetPointWorldDrawObject,o=new MxDbRectBoxLeadComment;o.setLineWidth(3),o.setLineWidthByPixels(!0),b.setMessage(`
:`),b.go(v=>{o.radius=MxFun.screenCoordLong2Doc(8),v==MrxDbgUiPrBaseReturn$1.kOk&&(o.point1=b.value(),s.setDraw(u=>{o.point2=u,s.drawCustomEntity(o)}),b.setUserDraw(s),b.setMessage(`
:`),b.go(u=>{if(u!=MrxDbgUiPrBaseReturn$1.kOk)return;o.point2=b.value(),s.setDraw(L=>{o.point3=L,s.drawCustomEntity(o)});let w=prompt("","");w||(w=""),o.text=w,o.textWidth=MxFun.screenCoordLong2Doc(10*w.length),o.textHeight=MxFun.screenCoordLong2Doc(5*w.length),o.fixedSize=!0,o.fixedSize&&(o.textHeight=20,o.textWidth=20*w.length),b.setMessage(`
:`),b.go(L=>{L==MrxDbgUiPrBaseReturn$1.kOk&&(o.point3=b.value(),r.addMxEntity(o))})}))})}MxDbLeadComment.cmd="Mx_Comment",MxDbLeadComment.draw=drawMxDbLeadComment,addRegisterMxDbEntity(MxDbLeadComment);class MxDbRectBoxLeadComment extends MxDbEntity{constructor(){super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.point3=new THREE.Vector3,this.text="",this.textHeight=20,this.radius=16,this.textWidth=0,this.fixedSize=!1,this.use_smallcoord_display=!0}getTypeName(){return"MxDbRectBoxLeadComment"}create(){return new MxDbRectBoxLeadComment}getCloudLine(){let r=new MxDbCloudLine;r.setRadius(this.radius);let s=this.point1.clone(),o=this.point2.clone();if(s.x>o.x){let U=s.x;s.x=o.x,o.x=U}if(s.y>o.y){let U=s.y;s.y=o.y,o.y=U}let v=new THREE.Vector3(s.x,o.y,s.z);v=r.addLine(s,v),o=new THREE.Vector3(o.x,v.y,o.z),o=r.addLine(v,o);let u=new THREE.Vector3(o.x,s.y,s.z);u=r.addLine(o,u);let w=s=r.addLine(u,s),L=s.distanceTo(this.point3);return L>v.distanceTo(this.point3)&&(w=v,L=v.distanceTo(this.point3)),L>o.distanceTo(this.point3)&&(w=o,L=o.distanceTo(this.point3)),L>u.distanceTo(this.point3)&&(w=u,L=u.distanceTo(this.point3)),{cloudLine:r,pt1:s,pt2:v,pt3:o,pt4:u,leadPt:w}}worldDraw(r){let s=this.getCloudLine(),o=s.cloudLine;if(o.setUseSmallcoordDisplay(this.use_smallcoord_display),o.worldDraw(r),this.text.length>0){let v=s.leadPt,u=new MxDbLeadComment;u.setUseSmallcoordDisplay(this.use_smallcoord_display),u.point1=v,u.point2=this.point3,u.text=this.text,u.textHeight=this.textHeight,u.textWidth=this.textWidth,u.fixedSize=this.fixedSize,u.worldDraw(r)}}getGripPoints(){let r=[];return r.push(this.point1),r.push(this.point2),r.push(this.point3),r}moveGripPointsAt(r,s){return r==0?this.point1.add(s):r==1?this.point2.add(s):r==2&&this.point3.add(s),!0}dwgIn(r){return this.onDwgIn(r),this.point1.copy(r.point1),this.point2.copy(r.point2),this.point3.copy(r.point3),this.text=r.text.substr(0),this.textHeight=r.textHeight,this.radius=r.radius,r.textWidth&&(this.textWidth=r.textWidth),this.fixedSize=r.fixedSize,!0}dwgOut(r){if(this.onDwgOut(r),r.point1=this.point1,r.point2=this.point2,r.point3=this.point3,r.textHeight=this.textHeight,r.text=this.text,r.radius=this.radius,r.textWidth=this.textWidth,r.fixedSize=this.fixedSize,r.type===MxType.MxCloneType.kSaveDwgClone){let s=this.getCloudLine(),o=s.cloudLine.reCalculateDrawGeometryPoint();r.cachePoint=o||[],r.leadPt=s.leadPt}return r}onViewChange(){return!!this.fixedSize&&(this.setNeedUpdateDisplay(!1),!0)}}function drawMxDbEllipse(){const b=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),s=new McEdGetPointWorldDrawObject,o=new MxDbEllipse;b.setMessage(`
:`),b.go(()=>{o.point1=b.value(),s.setDraw(v=>{o.point2=v,s.drawCustomEntity(o)}),b.setUserDraw(s),b.setMessage(`
:`),b.go(()=>{r.addMxEntity(o)})})}MxDbRectBoxLeadComment.cmd="Mx_CheckDraw",MxDbRectBoxLeadComment.draw=drawMxDbRectBoxLeadComment,addRegisterMxDbEntity(MxDbRectBoxLeadComment);class MxDbEllipse extends MxDbEllipseShape{constructor(){super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.isClosedToCenter=!1,this.closed=!1,this._propertyDbKeys=[...this._propertyDbKeys,"point1","point2"]}getTypeName(){return"MxDbEllipse"}create(){return new MxDbEllipse}setPoint1(r){return this.point1=r,this}setPoint2(r){return this.point2=r,this}worldDraw(r){const{point1:s,point2:o}=this,v=s.clone().set(o.x,s.y,o.z),u=o.clone().set(s.x,o.y,s.z);this.xRadius=s.distanceTo(v)/2,this.yRadius=s.distanceTo(u)/2;const w=s.x>o.x,L=s.y>o.y,U=w?s.x-this.xRadius:s.x+this.xRadius,N=L?s.y-this.yRadius:s.y+this.yRadius;this.center=new THREE.Vector3(U,N,0),this.drawEllipseShape(r),r.getType()===McGiWorldDrawType$1.kSelectDraw&&r.drawLines([s,new THREE.Vector3(s.x,o.y),o,new THREE.Vector3(o.x,s.y),s])}getGripPoints(){let r=new THREE.Vector3(.5*(this.point2.x+this.point1.x),.5*(this.point2.y+this.point1.y),0);return[this.point1,this.point2,r]}moveGripPointsAt(r,s){return r===0?this.point1.add(s):r===1?this.point2.add(s):r===2&&(this.point1.add(s),this.point2.add(s)),!0}}async function drawMxDbText(){const b=new MrxDbgUiPrPoint;b.setMessage(`
 :`);let r=await b.go();if(r==null)return;let s=prompt("");if(!s)return;let o=new MxDbText;o.position=r,o.height=MxFun.screenCoordLong2Doc(50),o.text=s,MxFun.addToCurrentSpace(o)}let _SpriteText;function getSpriteTextColor(b){return b?b instanceof THREE.Color?b.getStyle():typeof b=="number"?new THREE.Color(b).getStyle():b:"#fff"}function toCSSFont(b,r,s,o,v){let u=document.createElement("span");return u.style.font="1px serif",u.style.fontFamily=b,u.style.fontSize=`${r}px`,u.style.fontStyle=s,u.style.fontVariant=o,u.style.fontWeight=v,u.style.font}function getSpriteTextClass(){if(!_SpriteText){class b extends THREE.Sprite{constructor(s){super(new THREE.SpriteMaterial);const{text:o,textHeight:v,color:u,backgroundColor:w,padding:L,borderWidth:U,borderRadius:N,borderColor:D,strokeWidth:f,strokeColor:P,fontFace:T,fontSize:B,fontWeight:G,textAlign:R,textShadowBlur:_,textShadowColor:ee,textShadowOffsetX:k,textShadowOffsetY:E,angle:W,scale:C,underline:F,fontStyle:M,fontVariant:a}=s||{};this._text=`${o}`,this._textHeight=v||10,this._color=u,this._backgroundColor=w,this._padding=L||0,this._borderWidth=U||0,this._borderRadius=N||0,this._borderColor=D||"white",this._strokeWidth=f||0,this._strokeColor=P||"white",this._fontFace=T||"Arial",this._fontSize=B||90,this._fontWeight=(G==null?void 0:G.toString())||"normal",this._textAlign=R||"start",this._fontStyle=M||"normal",this._fontVariant=a||"normal",this._textShadowBlur=_||0,this._textShadowColor=ee,this._textShadowOffsetX=k||0,this._textShadowOffsetY=E||0,this._angle=W||0,this._textScale=C||1,this._underline=F||!1,this._canvas=document.createElement("canvas"),this._genCanvas()}get text(){return this._text}set text(s){this._text=s,this._genCanvas()}get textHeight(){return this._textHeight}set textHeight(s){this._textHeight=s,this._genCanvas()}get color(){return this._color}set color(s){this._color=s,this._genCanvas()}get backgroundColor(){return this._backgroundColor}set backgroundColor(s){this._backgroundColor=s,this._genCanvas()}get padding(){return this._padding}set padding(s){this._padding=s,this._genCanvas()}get borderWidth(){return this._borderWidth}set borderWidth(s){this._borderWidth=s,this._genCanvas()}get borderRadius(){return this._borderRadius}set borderRadius(s){this._borderRadius=s,this._genCanvas()}get borderColor(){return this._borderColor}set borderColor(s){this._borderColor=s,this._genCanvas()}get fontFace(){return this._fontFace}set fontFace(s){this._fontFace=s,this._genCanvas()}get fontSize(){return this._fontSize}set fontSize(s){this._fontSize=s,this._genCanvas()}get fontWeight(){return this._fontWeight}set fontWeight(s){this._fontWeight=s,this._genCanvas()}get strokeWidth(){return this._strokeWidth}set strokeWidth(s){this._strokeWidth=s,this._genCanvas()}get strokeColor(){return this._strokeColor}set strokeColor(s){this._strokeColor=s,this._genCanvas()}get textAlign(){return this._textAlign}set textAlign(s){this._textAlign=s,this._genCanvas()}get textShadowBlur(){return this._textShadowBlur}set textShadowBlur(s){this._textShadowBlur=s,this._genCanvas()}get textShadowColor(){return this._textShadowColor}set textShadowColor(s){this._textShadowColor=s,this._genCanvas()}get textShadowOffsetX(){return this._textShadowOffsetX}set textShadowOffsetX(s){this._textShadowOffsetX=s,this._genCanvas()}get textShadowOffsetY(){return this._textShadowOffsetY}set textShadowOffsetY(s){this._textShadowOffsetY=s,this._genCanvas()}get angle(){return this._angle}set angle(s){this._angle=s,this._genCanvas()}get textScale(){return this._textScale}set textScale(s){this._textScale=s,this._genCanvas()}get underline(){return this._underline}set underline(s){this._underline=s,this._genCanvas()}get fontStyle(){return this._fontStyle}set fontStyle(s){this._fontStyle=s,this._genCanvas()}get fontVariant(){return this._fontVariant}set fontVariant(s){this._fontVariant=s,this._genCanvas()}_genCanvas(){const s=this._canvas,o=s.getContext("2d"),v=Array.isArray(this.borderWidth)?this.borderWidth:[this.borderWidth,this.borderWidth],u=v.map(E=>E*this.fontSize*.1),w=(Array.isArray(this.borderRadius)?this.borderRadius:[this.borderRadius,this.borderRadius,this.borderRadius,this.borderRadius]).map(E=>E*this.fontSize*.1),L=Array.isArray(this.padding)?this.padding:[this.padding,this.padding],U=L.map(E=>E*this.fontSize*.1),N=this.text.split(`
`),D=this.font;o.font=D;const f=Math.max(...N.map(E=>o.measureText(E).width)),P=4*this.strokeWidth+(this.underline?this.fontSize/15*4:this.fontSize/15),T=(this.fontSize+P)*N.length;if(s.width=f+2*u[0]+2*U[0],s.height=T+2*u[1]+2*U[1],this.borderWidth){if(o.strokeStyle=getSpriteTextColor(this.borderColor),u[0]){const E=u[0]/2;o.lineWidth=u[0],o.beginPath(),o.moveTo(E,w[0]),o.lineTo(E,s.height-w[3]),o.moveTo(s.width-E,w[1]),o.lineTo(s.width-E,s.height-w[2]),o.stroke()}if(u[1]){const E=u[1]/2;o.lineWidth=u[1],o.beginPath(),o.moveTo(Math.max(u[0],w[0]),E),o.lineTo(s.width-Math.max(u[0],w[1]),E),o.moveTo(Math.max(u[0],w[3]),s.height-E),o.lineTo(s.width-Math.max(u[0],w[2]),s.height-E),o.stroke()}if(this.borderRadius){const E=Math.max(...u),W=E/2;o.lineWidth=E,o.beginPath(),[!!w[0]&&[w[0],W,W,w[0]],!!w[1]&&[s.width-w[1],s.width-W,W,w[1]],!!w[2]&&[s.width-w[2],s.width-W,s.height-W,s.height-w[2]],!!w[3]&&[w[3],W,s.height-W,s.height-w[3]]].filter(C=>C).forEach(C=>{const[F,M,a,h]=C;o.moveTo(F,a),o.quadraticCurveTo(M,a,M,h)}),o.stroke()}}this.backgroundColor&&(o.fillStyle=getSpriteTextColor(this.backgroundColor),this.borderRadius?(o.beginPath(),o.moveTo(u[0],w[0]),[[u[0],w[0],s.width-w[1],u[1],u[1],u[1]],[s.width-u[0],s.width-u[0],s.width-u[0],u[1],w[1],s.height-w[2]],[s.width-u[0],s.width-w[2],w[3],s.height-u[1],s.height-u[1],s.height-u[1]],[u[0],u[0],u[0],s.height-u[1],s.height-w[3],w[0]]].forEach(([E,W,C,F,M,a])=>{o.quadraticCurveTo(E,F,W,M),o.lineTo(C,a)}),o.closePath(),o.fill()):o.fillRect(u[0],u[1],s.width-2*u[0],s.height-2*u[1])),o.translate(u[0],u[1]),o.translate(U[0],U[1]),o.font=D,o.fillStyle=getSpriteTextColor(this.color),o.textBaseline="bottom",o.shadowBlur=this.textShadowBlur,o.shadowColor=new THREE.Color(this.textShadowColor).getStyle(),o.shadowOffsetX=this.textShadowOffsetX,o.shadowOffsetY=this.textShadowOffsetY;const B=this.strokeWidth>0;B&&(o.lineWidth=this.strokeWidth*this.fontSize/10,o.strokeStyle=getSpriteTextColor(this.strokeColor));const G=this.textAlign==="center",R=this.textAlign==="start"||this.textAlign==="left";N.forEach(async(E,W)=>{let C=G?2:1;const F=o.measureText(E).width,M=R?0:(f-F)/C,a=(W+1)*(this.fontSize+P);B&&o.strokeText(E,M,a),o.fillText(E,M,a),this.underline&&o.fillRect(M,s.height-this.fontSize/25,F,this.fontSize/25)}),this.material.map&&this.material.map.dispose();const _=this.material.map=new THREE.Texture(s);_.minFilter=THREE.LinearFilter,_.needsUpdate=!0;const ee=this.textHeight*N.length+2*v[1]+2*L[1],k=ee*s.width/s.height;this.scale.set(k,ee,this.scale.z),this.material.rotation=this.angle,this.scale.applyMatrix4(new THREE.Matrix4().makeScale(this.textScale,this.textScale,1))}clone(){return new this.constructor(this.text,this.textHeight,this.color).copy(THREE.Sprite.prototype.clone.call(this))}copy(s){return THREE.Sprite.prototype.copy.call(this,s),this.color=s.color,this.backgroundColor=s.backgroundColor,this.padding=s.padding,this.borderWidth=s.borderWidth,this.borderColor=s.borderColor,this.fontFace=s.fontFace,this.fontSize=s.fontSize,this.fontWeight=s.fontWeight,this.strokeWidth=s.strokeWidth,this.strokeColor=s.strokeColor,this.textAlign=s.textAlign,this.textShadowBlur=s.textShadowBlur,this.textShadowColor=s.textShadowColor,this.textShadowOffsetX=s.textShadowOffsetX,this.textShadowOffsetY=s.textShadowOffsetY,this.angle=s.angle,this.textScale=s.textScale,this}get font(){return toCSSFont(this.fontFace,this.fontSize,this.fontStyle,this.fontVariant,this.fontWeight)}checkFontFace(){try{const{fontFace:s}=this;return document.fonts.check(s)}catch{}return!0}async loadFontFace(){try{const{fontFace:s}=this;await document.fonts.load(s)}catch{}}dispose(){var s;(s=this.material.map)===null||s===void 0||s.dispose(),this.material.dispose(),this.geometry.dispose(),this.dispatchEvent({type:"dispose"})}}_SpriteText=b}return _SpriteText}MxDbEllipse.cmd="Mx_Ellipse",MxDbEllipse.draw=drawMxDbEllipse,addRegisterMxDbEntity(MxDbEllipse);const propertyDbKeys$2=["text","position","height","backgroundColor","padding","borderWidth","borderRadius","borderColor","fontFace","fontSize","fontWeight","strokeWidth","strokeColor","angle","textAlign","textShadowBlur","textShadowColor","textShadowOffsetX","textShadowOffsetY","scale","underline"];class MxDbText extends MxDbEntity{constructor(){super(...arguments),this.position=new THREE.Vector3,this._text="",this._height=16,this._angle=0,this._scale=1,this._underline=!1}setPosition(r){return this.position=r,this}get text(){return this.spriteText?this.spriteText.text:this._text}set text(r){this.spriteText?this.spriteText.text=r:this._text=r}setText(r){return this.text=r,this}get height(){return this.spriteText?this.spriteText.textHeight:this._height}set height(r){this.spriteText?this.spriteText.textHeight=r:this._height=r}setHeight(r){return this.height=r,this}get backgroundColor(){return this.spriteText?this.spriteText.backgroundColor:this._backgroundColor}set backgroundColor(r){this.spriteText?this.spriteText.backgroundColor=r:this._backgroundColor=r}setBackgroundColor(r){return this.backgroundColor=r,this}get padding(){return this.spriteText?this.spriteText.padding:this._padding}set padding(r){this.spriteText?this.spriteText.padding=r:this._padding=r}setPadding(r){return this.padding=r,this}get borderWidth(){return this.spriteText?this.spriteText.borderWidth:this._borderWidth}set borderWidth(r){this.spriteText?this.spriteText.borderWidth=r:this._borderWidth=r}setBorderWidth(r){return this.borderWidth=r,this}get borderRadius(){return this.spriteText?this.spriteText.borderRadius:this._borderRadius}set borderRadius(r){this.spriteText?this.spriteText.borderRadius=r:this._borderRadius=r}setBorderRadius(r){return this.borderRadius=r,this}get borderColor(){return this.spriteText?this.spriteText.borderColor:this._borderColor}set borderColor(r){this.spriteText?this.spriteText.borderColor=r:this._borderColor=r}setBorderColor(r){return this.borderColor=r,this}get fontFace(){return this.spriteText?this.spriteText.fontFace:this._fontFace}set fontFace(r){this.spriteText?this.spriteText.fontFace=r:this._fontFace=r}setFontFace(r){return this.fontFace=r,this}get fontSize(){return this.spriteText?this.spriteText.fontSize:this._fontSize}set fontSize(r){this.spriteText?this.spriteText.fontSize=r:this._fontSize=r}setFontSize(r){return this.fontSize=r,this}get fontWeight(){return this.spriteText?this.spriteText.fontWeight:this._fontWeight}set fontWeight(r){this.spriteText?this.spriteText.fontWeight=r:this._fontWeight=r}setFontWeight(r){return this.fontWeight=r,this}get strokeWidth(){return this.spriteText?this.spriteText.strokeWidth:this._strokeWidth}set strokeWidth(r){this.spriteText?this.spriteText.strokeWidth=r:this._strokeWidth=r}setStrokeWidth(r){return this.strokeWidth=r,this}get strokeColor(){return this.spriteText?this.spriteText.strokeColor:this._strokeColor}set strokeColor(r){this.spriteText?this.spriteText.strokeColor=r:this._strokeColor=r}setStrokeColor(r){return this.strokeColor=r,this}get textAlign(){return this.spriteText?this.spriteText.textAlign:this._textAlign}set textAlign(r){this.spriteText?this.spriteText.textAlign=r:this._textAlign=r}setTextAlign(r){return this.textAlign=r,this}get textShadowBlur(){return this.spriteText?this.spriteText.textShadowBlur:this._textShadowBlur}set textShadowBlur(r){this.spriteText?this.spriteText.textShadowBlur=r:this._textShadowBlur=r}setTextShadowBlur(r){return this.textShadowBlur=r,this}get textShadowColor(){return this.spriteText?this.spriteText.textShadowColor:this._textShadowColor}set textShadowColor(r){this.spriteText?this.spriteText.textShadowColor=r:this._textShadowColor=r}setTextShadowColor(r){return this.textShadowColor=r,this}get textShadowOffsetX(){return this.spriteText?this.spriteText.textShadowOffsetX:this._textShadowOffsetX}set textShadowOffsetX(r){this.spriteText?this.spriteText.textShadowOffsetX=r:this._textShadowOffsetX=r}setTextShadowOffsetX(r){return this.textShadowOffsetX=r,this}get textShadowOffsetY(){return this.spriteText?this.spriteText.textShadowOffsetY:this._textShadowOffsetY}set textShadowOffsetY(r){this.spriteText?this.spriteText.textShadowOffsetY=r:this._textShadowOffsetY=r}setTextShadowOffsetY(r){return this.textShadowOffsetY=r,this}get angle(){return this.spriteText?this.spriteText.angle:this._angle}set angle(r){this.spriteText?this.spriteText.angle=r:this._angle=r}setAngle(r){return this.angle=r,this}get scale(){return this.spriteText?this.spriteText.textScale:this._scale}set scale(r){this.spriteText?this.spriteText.textScale=r:this._scale=r}setScale(r){return this.scale=r,this}get underline(){return this.spriteText?this.spriteText.underline:this._underline}set underline(r){this.spriteText?this.spriteText.underline=r:this._underline=r}setUnderline(r){this.underline=r}getTypeName(){return"MxDbText"}worldDraw(r){if(this.text.length>0){r.getType()!==McGiWorldDrawType$1.kWorldDraw||this.spriteText||this.createSpriteText(),this.color!==this.spriteText.color&&(this.spriteText.color=this.color),this.spriteText.material.setValues({opacity:this.opacity,visible:this.visible});const{x:s,y:o,z:v}=this.position;this.spriteText.position.set(s,o,v),r.drawEntity(this.spriteText)}}createSpriteText(){const r=getSpriteTextClass(),{text:s,height:o,color:v,backgroundColor:u,padding:w,borderWidth:L,borderRadius:U,borderColor:N,strokeWidth:D,strokeColor:f,fontFace:P,fontSize:T,fontWeight:B,textAlign:G,textShadowBlur:R,textShadowColor:_,textShadowOffsetX:ee,textShadowOffsetY:k,angle:E,scale:W,underline:C}=this;this.spriteText=new r({text:s,textHeight:o,color:v,backgroundColor:u,padding:w,borderWidth:L,borderRadius:U,borderColor:N,strokeWidth:D,strokeColor:f,fontFace:P,fontSize:T,fontWeight:B,textAlign:G,textShadowBlur:R,textShadowColor:_,textShadowOffsetX:ee,textShadowOffsetY:k,angle:E,scale:W,underline:C})}getGripPoints(){return[this.position]}moveGripPointsAt(r,s){return r===0&&this.position.add(s),!0}create(){return new MxDbText}dwgIn(r){var s,o;return this.onDwgIn(r),this.dwgInHelp(r,propertyDbKeys$2),typeof r.path=="string"&&(r.path=JSON.parse(r.path)),((o=(s=r==null?void 0:r.path)===null||s===void 0?void 0:s.metadata)===null||o===void 0?void 0:o.generator)==="Curve.toJSON"&&(r.path=new THREE.Path().fromJSON(r.path)),r.type===MxType.MxCloneType.kMxFileClone||r.type===MxType.MxCloneType.kSaveDwgClone?this.createSpriteText():this.spriteText=r.spriteText,!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,propertyDbKeys$2),r.type===MxType.MxCloneType.kMxFileClone||r.type===MxType.MxCloneType.kSaveDwgClone?r.spriteText=void 0:r.spriteText=this.spriteText,r}getGeomExtents(){return new THREE.Box3().expandByObject(this.spriteText)}erase(){return super.erase(),this.spriteText&&this.spriteText.dispose(),!0}}function createCurvePath(b=!1){const r=new THREE.CurvePath;return r.autoClose=b,r}function createQuadraticBezierCurve3(b){let r=0,s=[];for(let o=0;o<b.length;o++){const v=b[r],u=b[++r]||v,w=b[++r]||u;if(!v||!u||!w)break;s.push(new THREE.QuadraticBezierCurve3(v,u,w))}return s}function createCubicBezierCurve3(b){let r=0,s=[];for(let o=0;o<b.length;o++){const v=b[r],u=b[++r]||v,w=b[++r]||u,L=b[++r]||w;if(!(v&&u&&w&&L))break;s.push(new THREE.CubicBezierCurve3(v,u,w,L))}return s}function getCurveColorGradientData(b,r){let s=0,o=[],v=[];const u=Number((1/r.length).toFixed(2));let w=new THREE.Color(r[s]),L=new THREE.Color(r[s+1]);for(let U=0,N=b.length;U<N;U++){const D=b[U],f=U/b.length;f/s>=u&&(s++,L.set(new THREE.Color(r[s]||r[--s]))),o.push(D.x,D.y,D.z||0),w.lerpHSL(L,f),v.push(w.r,w.g,w.b)}return[o,v]}function getColorGradientData(b,r){let s=[],o=[];for(let v=0,u=b.length;v<u;v++){const w=b[v];s.push(w.x,w.y,w.z||0);const L=new THREE.Color(r[v]);o.push(L.r,L.g,L.b)}return[s,o]}MxDbText.cmd="Mx_Text",MxDbText.draw=drawMxDbText,addRegisterMxDbEntity(MxDbText);const propertyDbKeys$1=["points","colors","linecap","linejoin","closed","curveType","tension","bezierType"];class MxDbGradientLine extends MxDbEntity{constructor(){super(...arguments),this.linecap="round",this.linejoin="round",this.closed=!1,this.curveType="centripetal",this.tension=0,this.bezierType="quadratic"}create(){return new MxDbGradientLine}getTypeName(){return"MxDbGradientLine"}setPoints(r){return this.points=r,this}setColors(r){return this.colors=r,this}addColor(r){return this.colors.push(r),this}setLinecap(r){this.linecap=r}setClosed(r){this.closed=r}setCurveType(r){this.curveType=r}setTension(r){this.tension=r}setBezierType(r){this.bezierType=r}worldDraw(r){const s=r.getType();let o=this.getPoints();const{closed:v,curveType:u,tension:w,bezierType:L}=this,U=new THREE.BufferGeometry;let N=[],D=[];const f=L==="cubic",P=L==="quadratic";w!==0?this.curve=new THREE.CatmullRomCurve3(o,v,u,w):L?(this.curve=createCurvePath(v),f?this.curve.curves=createCubicBezierCurve3(o):P?this.curve.curves=createQuadraticBezierCurve3(o):this.curve=void 0):this.curve=void 0,this.curve&&(o=this.curve.getPoints(50));const{linecap:T,linejoin:B}=this;let G;if(this.colors&&this.colors.length>1){const _=v?[...this.colors,this.colors[0]]:this.colors;[N,D]=this.curve?getCurveColorGradientData(o,_):getColorGradientData(o,_),U.setAttribute("position",new THREE.Float32BufferAttribute(N,3)),U.setAttribute("color",new THREE.Float32BufferAttribute(D,3)),G=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linecap:T,linejoin:B})}else U.setFromPoints(o),G=new THREE.LineBasicMaterial({color:this.color,linecap:T,linejoin:B});const R=v?new THREE.LineLoop(U,G):new THREE.Line(U,G);if(r.drawEntity(R),(s===McGiWorldDrawType$1.kSelectDraw||s===McGiWorldDrawType$1.kDynDragDraw)&&this.curve){let _=this.getPoints();const ee=r.getLineWidth();r.setLineWidth(1),r.drawLines(_),r.setLineWidth(ee)}}getGripPoints(){return this.getPoints()}getPoints(){return this.closed?[...this.points,this.points[0]]:this.points}moveGripPointsAt(r,s){return this.move(r,s),!0}move(r,s){return this.points[r].add(s),this}dwgIn(r){return this.dwgInHelp(r,propertyDbKeys$1),this.curve=r.curve,!0}dwgOut(r){return this.dwgOutHelp(r,propertyDbKeys$1),r.curve=this.curve,r}}function drawMxDbEllipseArc(){const b=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),s=new McEdGetPointWorldDrawObject;let o=new MxDbEllipseArc;b.setUserDraw(s),b.go(async()=>{o.center=b.value(),s.setDraw((v,u)=>{o.startPoint=v,o.yRadius=o.center.distanceTo(v),u.drawCustomEntity(o)}),o.startPoint=await b.go()||new THREE.Vector3,s.setDraw((v,u)=>{o.endPoint=v,u.drawCustomEntity(o)}),o.endPoint=await b.go()||new THREE.Vector3,r.addMxEntity(o)})}addRegisterMxDbEntity(MxDbGradientLine);class MxDbEllipseArc extends MxDbEllipseShape{getTypeName(){return"MxDbEllipseArc"}constructor(){super(),this._propertyDbKeys=[...this._propertyDbKeys,"startPoint","endPoint"]}setStartPoint(r){return this.startPoint=r,this}setEndPoint(r){return this.endPoint=r,this}worldDraw(r){let{center:s,startPoint:o,endPoint:v}=this;o&&(this.xRadius=s.distanceTo(o),this.startAngle=THREE.MathUtils.degToRad(calculateArcAngle(o,s,this.xRadius).angle)),v&&(this.yRadius=s.distanceTo(v),this.endAngle=THREE.MathUtils.degToRad(calculateArcAngle(v,s,this.yRadius).angle)),this.drawEllipseShape(r)}getGripPoints(){return[this.center,this.startPoint,this.endPoint]}moveGripPointsAt(r,s){return r===0&&(this.center.add(s),this.startPoint.add(s),this.endPoint.add(s)),r===1&&this.startPoint.add(s),r===2&&this.endPoint.add(s),!0}}function drawMxDbCircleArc(){const b=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),s=new McEdGetPointWorldDrawObject;let o=new MxDbCircleArc;o.stroke="#ff0000",b.setUserDraw(s),b.setMessage(`
:`),b.go(async()=>{o.center=b.value(),s.setDraw(v=>{s.drawLine(o.center,v)}),b.setMessage(`
:`),o.startPoint=await b.go()||new THREE.Vector3,s.setDraw(v=>{o.endPoint=v,s.drawCustomEntity(o)}),b.setMessage(`
:`),o.endPoint=await b.go()||new THREE.Vector3,s.setDraw(()=>{}),r.addMxEntity(o)})}MxDbEllipseArc.cmd="Mx_MxDbEllipseArc",MxDbEllipseArc.draw=drawMxDbEllipseArc,addRegisterMxDbEntity(MxDbEllipseArc);class MxDbCircleArc extends MxDbCircleShape{constructor(){super(),this._propertyDbKeys=[...this._propertyDbKeys,"startPoint","endPoint"]}getTypeName(){return"MxDbCircleArc"}setStartPoint(r){return this.startPoint=r,this}setEndPoint(r){return this.endPoint=r,this}worldDraw(r){let{startPoint:s,endPoint:o}=this;if(s&&(this.startAngle=this.computePointAngle(s)),o&&(this.endAngle=this.computePointAngle(o)),s&&o){const{points:v}=this.drawEllipseShape(r);this.startPoint=v[0]}}computePointAngle(r){return this.radius=this.center.distanceTo(r),THREE.MathUtils.degToRad(calculateArcAngle(r,this.center,this.radius).angle)}getGripPoints(){return[this.center,this.startPoint,this.endPoint]}moveGripPointsAt(r,s){return r===0?(this.center.add(s),this.startPoint.add(s),this.endPoint.add(s)):r===1?this.startPoint.add(s):r===2&&this.endPoint.add(s),!0}}MxDbCircleArc.cmd="Mx_MxDbCircleArc",MxDbCircleArc.draw=drawMxDbCircleArc,addRegisterMxDbEntity(MxDbCircleArc);class MxDbArcShape extends MxDbCircleArc{constructor(){super(),this.center=new THREE.Vector3,this.innerRadius=10,this.outerRadius=20,this._propertyDbKeys=[...this._propertyDbKeys,"center","innerRadius","outerRadius"]}getTypeName(){return"MxDbArcShape"}worldDraw(r){r.getType()===McGiWorldDrawType$1.kDynDragDraw?(r.drawCircle(this.center,this.innerRadius),r.drawCircle(this.center,this.outerRadius)):this.drawArcShape(r)}drawArcShape(r){const{center:s,startAngle:o,endAngle:v,clockwise:u}=this,{x:w,y:L}=s;this.isClosedToCenter=!1;const U=this.createEllipseCurve(w,L,this.innerRadius,this.innerRadius,o,v,u),N=this.createEllipseCurve(w,L,this.outerRadius,this.outerRadius,v,o,!u),D=this.createPaths([U,N]);let f=this.getShapePoints(D);this._draw(r,f),this._drawStoreLine(r,f)}getGripPoints(){return[this.center]}moveGripPointsAt(r,s){return r===0&&this.center.add(s),!0}}function drawMxDbArcShape(){const b=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),s=new McEdGetPointWorldDrawObject;let o=new MxDbArcShapeDraw;b.setMessage(`
:`),b.setUserDraw(s),b.go(async()=>{b.setMessage(`
:`),o.center=b.value(),s.setDraw(v=>{o.interRadiusPoint=v,s.drawCircle(o.center,v.distanceTo(o.center))}),o.interRadiusPoint=await b.go()||new THREE.Vector3,s.setDraw(v=>{o.outerRadiusPoint=v,s.drawCustomEntity(o)}),o.outerRadiusPoint=await b.go()||new THREE.Vector3,r.addMxEntity(o)})}class MxDbArcShapeDraw extends MxDbArcShape{getTypeName(){return"MxDbArcShapeDraw"}constructor(){super(),this.outerRadiusPoint=new THREE.Vector3,this.interRadiusPoint=new THREE.Vector3,this._propertyDbKeys=[...this._propertyDbKeys,"interRadiusPoint","outerRadiusPoint"]}worldDraw(r){this.innerRadius=this.center.distanceTo(this.interRadiusPoint),this.outerRadius=this.center.distanceTo(this.outerRadiusPoint),this.startAngle=THREE.MathUtils.degToRad(calculateArcAngle(this.interRadiusPoint,this.center,this.innerRadius).angle),this.endAngle=THREE.MathUtils.degToRad(calculateArcAngle(this.outerRadiusPoint,this.center,this.outerRadius).angle),this.drawArcShape(r)}getGripPoints(){return[this.center,this.interRadiusPoint,this.outerRadiusPoint]}moveGripPointsAt(r,s){return r===0&&(this.center.add(s),this.interRadiusPoint.add(s),this.outerRadiusPoint.add(s)),r===1&&this.interRadiusPoint.add(s),r===2&&this.outerRadiusPoint.add(s),!0}}function drawMxDbRingShape(){const b=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),s=new McEdGetPointWorldDrawObject;b.setUserDraw(s);const o=new McEdGetPointWorldDrawObject,v=new MxDbRingShapeDraw;b.setUserDraw(o),b.setMessage(`
:`),b.go(async u=>{console.log(123),v.center=b.value(),o.setDraw(w=>{o.drawCircle(v.center,v.center.distanceTo(w))}),v.innerPoint=await b.go()||new THREE.Vector3,o.setDraw(w=>{v.outerPoint=w,o.drawCustomEntity(v)}),v.outerPoint=await b.go()||new THREE.Vector3,r.addMxEntity(v)})}MxDbArcShapeDraw.isRegister=!1,MxDbArcShapeDraw.cmd="Mx_MxDbArcShape",MxDbArcShapeDraw.draw=drawMxDbArcShape,addRegisterMxDbEntity(MxDbArcShapeDraw);class MxDbRingShape extends MxDbArcShape{getTypeName(){return"MxDbRingShape"}worldDraw(r){const{center:s,startAngle:o,endAngle:v,clockwise:u}=this,{x:w,y:L}=s;this.isClosedToCenter=!1;const U=this.createEllipseCurve(w,L,this.innerRadius,this.innerRadius,o,v,u),N=this.createEllipseCurve(w,L,this.outerRadius,this.outerRadius,o,v,!u),D=this.createPaths([U,N]);let f=this.getShapePoints(D);const P=this.createPaths(U);let T=this.getShapePoints(P);const B=this.createPaths(N);let G=this.getShapePoints(B);this.isFill?(this._draw(r,f),this._drawStoreLine(r,T),this._drawStoreLine(r,G)):(this._draw(r,T),this._drawStoreLine(r,T),this._draw(r,G),this._drawStoreLine(r,G))}}MxDbRingShape.isRegister=!1,MxDbRingShape.cmd="Mx_MxDbRingShape",MxDbRingShape.draw=drawMxDbRingShape;class MxDbRingShapeDraw extends MxDbRingShape{constructor(){super(),this.innerPoint=new THREE.Vector3,this.outerPoint=new THREE.Vector3,this._propertyDbKeys=[...this._propertyDbKeys,"innerPoint","outerPoint"]}getGripPoints(){return[this.center,this.innerPoint,this.outerPoint]}moveGripPointsAt(r,s){return r===0&&(this.center.add(s),this.innerPoint.add(s),this.outerPoint.add(s)),r===1&&this.innerPoint.add(s),r===2&&this.outerPoint.add(s),!0}worldDraw(r){this.innerPoint&&(this.innerRadius=this.center.distanceTo(this.innerPoint)),this.outerPoint&&(this.outerRadius=this.center.distanceTo(this.outerPoint)),super.worldDraw(r)}}function drawMxDbStarShape(){const b=new MrxDbgUiPrPoint,r=MxFun.getCurrentDraw(),s=new McEdGetPointWorldDrawObject;b.setUserDraw(s);const o=new McEdGetPointWorldDrawObject,v=new MxDbStarShapeDraw;b.setUserDraw(o),b.setMessage(`
:`),b.go(async u=>{v.center=b.value(),o.setDraw(w=>{v.innerPoint=w,o.drawCircle(v.center,v.center.distanceTo(w))}),v.innerPoint=await b.go()||new THREE.Vector3,o.setDraw(w=>{v.outerPoint=w,o.drawCustomEntity(v)}),v.outerPoint=await b.go()||new THREE.Vector3,r.addMxEntity(v)})}addRegisterMxDbEntity(MxDbRingShape);class MxDbStarShape extends MxDbShape{getTypeName(){return"MxDbStarShape"}constructor(){super(),this.center=new THREE.Vector3,this.numPoints=10,this.innerRadius=10,this.outerRadius=10,this._propertyDbKeys=[...this._propertyDbKeys,"center","numPoints","innerRadius","outerRadius"]}worldDraw(r){const{x:s,y:o}=this.center,v=new THREE.Path;v.moveTo(s,o-this.outerRadius);for(let L=1;L<2*this.numPoints;L++){const U=L%2==0?this.outerRadius:this.innerRadius,N=U*Math.sin(L*Math.PI/this.numPoints)+s,D=-1*U*Math.cos(L*Math.PI/this.numPoints)+o;v.lineTo(N,D)}v.closePath();const u=this.createPaths(v),w=this.getShapePoints(u);this._draw(r,w),this._drawStoreLine(r,w)}getGripPoints(){return[this.center]}moveGripPointsAt(r,s){return r===0&&this.center.add(s),!0}}MxDbStarShape.cmd="Mx_MxDbStarShape",MxDbStarShape.draw=drawMxDbStarShape;class MxDbStarShapeDraw extends MxDbStarShape{constructor(){super(),this.innerPoint=new THREE.Vector3,this.outerPoint=new THREE.Vector3,this._propertyDbKeys=[...this._propertyDbKeys,"innerPoint","outerPoint"]}getGripPoints(){return[this.center,this.innerPoint,this.outerPoint]}moveGripPointsAt(r,s){return r===0&&(this.center.add(s),this.innerPoint.add(s),this.outerPoint.add(s)),r===1&&this.innerPoint.add(s),r===2&&this.outerPoint.add(s),!0}worldDraw(r){this.innerPoint&&(this.innerRadius=this.center.distanceTo(this.innerPoint)),this.outerPoint&&(this.outerRadius=this.center.distanceTo(this.outerPoint)),super.worldDraw(r)}}addRegisterMxDbEntity(MxDbStarShape);class MxDbRegularPolygonShape extends MxDbShape{getTypeName(){return"MxDbRegularPolygonShape"}constructor(){super(),this.center=new THREE.Vector3,this.sidesNumber=6,this.radius=70,this._propertyDbKeys=[...this._propertyDbKeys,"center","sidesNumber","radius"]}worldDraw(r){this._drawPolygonShape(r)}_drawPolygonShape(r){const s=this._getPoints(),o=new THREE.Path;o.moveTo(s[0].x,s[0].y);for(let w=0;w<s.length;w++)o.lineTo(s[w].x,s[w].y);o.closePath();const v=this.createPaths(o),u=this.getShapePoints(v);this._draw(r,u),this._drawStoreLine(r,u)}_getPoints(){const{sidesNumber:r,radius:s}=this,{x:o,y:v}=this.center,u=[];for(let w=0;w<r;w++)u.push({x:s*Math.sin(2*w*Math.PI/r)+o,y:-1*s*Math.cos(2*w*Math.PI/r)+v});return u}getGripPoints(){return[this.center]}moveGripPointsAt(r,s){return r===0&&this.center.add(s),!0}}function getScreenPixel(b,r){let s=MxFun.screenCoordLong2World(r?b:b-b/3);return s=MxFun.worldCoordLong2Doc(s)}function drawMxDbArrow(){const b=new McEdGetPointWorldDrawObject,r=new MxDbArrow,s=MxFun.getCurrentDraw(),o=new MrxDbgUiPrPoint;o.setUserDraw(b),r.setLineWidth(10),o.go(()=>{r.innerOffset=getScreenPixel(10),r.outerOffset=getScreenPixel(22),r.topOffset=getScreenPixel(36),r.startPoint=o.value(),b.setDraw(v=>{r.endPoint=v,b.drawCustomEntity(r)}),o.go(async v=>{r.endPoint=o.value(),s.addMxEntity(r)})})}addRegisterMxDbEntity(MxDbRegularPolygonShape);class MxDbArrow extends MxDbShape{constructor(){super(),this.isSharpCorner=!1,this.innerOffset=10,this.outerOffset=22,this.topOffset=36,this.startPoint=new THREE.Vector3,this.endPoint=new THREE.Vector3,this._propertyDbKeys=[...this._propertyDbKeys,"outerOffset","topOffset","innerOffset","isSharpCorner","startPoint","endPoint"]}worldDraw(r){const s=this.getArrowVertex(this.startPoint,this.endPoint);s&&(this._draw(r,s),this._drawStoreLine(r,s))}getArrowVertex(r,s,o=this.isSharpCorner){let{innerOffset:v,topOffset:u,outerOffset:w}=this;const L=[];L[3]=s;const U=Math.sqrt((r.x-s.x)*(r.x-s.x)+(r.y-s.y)*(r.y-s.y));if(U===0)return;const N=-(s.x-r.x)/U,D=(s.y-r.y)/U,f=r.x+v,P=r.y+U-u,T=r.x+w,B=r.y+U-u,G=r.x-v,R=r.y+U-u,_=r.x-w,ee=r.y+U-u;return o?(L[0]=r,L[6]=L[0]):(L[0]=new THREE.Vector3(r.x-(G-r.x)*D,r.y-(G-r.x)*N),L[6]=new THREE.Vector3(r.x+(G-r.x)*D,r.y+(G-r.x)*N),L[7]=L[0]),L[1]=new THREE.Vector3(r.x+(f-r.x)*D-(P-r.y)*N,r.y+(f-r.x)*N+(P-r.y)*D),L[2]=new THREE.Vector3(r.x+(T-r.x)*D-(B-r.y)*N,r.y+(T-r.x)*N+(B-r.y)*D),L[4]=new THREE.Vector3(r.x+(_-r.x)*D-(ee-r.y)*N,r.y+(_-r.x)*N+(ee-r.y)*D),L[5]=new THREE.Vector3(r.x+(G-r.x)*D-(R-r.y)*N,r.y+(G-r.x)*N+(R-r.y)*D),L}getGripPoints(){const r=new THREE.Vector3;return new THREE.Line3(this.startPoint,this.endPoint).getCenter(r),[this.startPoint,r,this.endPoint]}moveGripPointsAt(r,s){return r===0&&this.startPoint.add(s),r===1&&(this.startPoint.add(s),this.endPoint.add(s)),r===2&&this.endPoint.add(s),!0}getCornerRadiusPoints(r){return r}}MxDbArrow.cmd="Mx_MxDbArrow",MxDbArrow.draw=drawMxDbArrow,addRegisterMxDbEntity(MxDbArrow);class MxDbLineShape extends MxDbShape{setPoints(r){return this.points=r,this}addPoint(r){return this.points.push(r),this}removePoint(r){return this.points.splice(r,1),this}constructor(){super(),this.points=[],this._propertyDbKeys=[...this._propertyDbKeys,"points"]}getTypeName(){return"MxDbLineShape"}worldDraw(r){this._draw(r,this.points),this._drawStoreLine(r,this.points)}getGripPoints(){return this.points}moveGripPointsAt(r,s){return this.points[r].add(s),!0}getGeomExtents(){return new THREE.Box3().setFromPoints(this.points)}getGetLength(){let r=0;for(let s=0;s++;s<this.points.length)this.points[s+1]&&(r+=this.points[s].distanceTo(this.points[s+1]));return r}}async function drawMxDbSplineCurve(){const b=new MrxDbgUiPrPoint,r=new MxDbSplineCurve;b.setMessage(`
:`),b.goWhile(async s=>{if(s===MrxDbgUiPrBaseReturn$1.kOk)r.points.push(b.value()),b.setUserDraw((o,v)=>{const u=r.clone();u.points.push(o),v.drawCustomEntity(u),r.points.length===0?b.setMessage(`
:`):(b.setMessage(`
:`),b.setKeyWords("[(C)/ (U)]"))});else if(s===MrxDbgUiPrBaseReturn$1.kKeyWord){if(b.isKeyWordPicked("C"))return r.closed=!0,{exit:!0};b.isKeyWordPicked("U")&&r.points.pop()}},()=>{MxFun.getCurrentDraw().addMxEntity(r)})}addRegisterMxDbEntity(MxDbLineShape);const propertyDbKeys=["points","closed","tension","curveType"];class MxDbSplineCurve extends MxDbEntity{constructor(){super(...arguments),this.points=[],this.closed=!1,this.tension=.5,this.curveType="centripetal"}worldDraw(r){const s=new THREE.CatmullRomCurve3(this.points,this.closed,"catmullrom",this.tension).getPoints(15*this.points.length),o=new THREE.Geometry().setFromPoints(s),v=new THREE.LineBasicMaterial({color:this.color}),u=new THREE.Line(o,v);r.drawEntity(u)}getGripPoints(){return this.points}moveGripPointsAt(r,s){return this.points[r].add(s),!0}create(){return new MxDbSplineCurve}dwgIn(r){return this.onDwgIn(r),this.dwgInHelp(r,propertyDbKeys),!0}dwgOut(r){return this.onDwgOut(r),this.dwgOutHelp(r,propertyDbKeys),r}getTypeName(){return"MxDbSplineCurve"}}MxDbSplineCurve.draw=drawMxDbSplineCurve,MxDbSplineCurve.cmd="Mx_Spline",addRegisterMxDbEntity(MxDbSplineCurve);class MrxDbgUiPrDist extends MrxDbgUiPrBase{constructor(){var r;super(new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().getMrxDbgUiPrDistClass()))}value(){return this.imp.value()}basePt(){return this.imp.basePt()}setBasePt(r){return this.imp.setBasePt(r)}setUseBasePt(r){return this.imp.setUseBasePt(r)}go(r){let s=this;return r?(s.imp.go(o=>{s.status=o,r(o)}),new Promise((o,v)=>{o(null)})):new Promise((o,v)=>{s.imp.go(u=>{s.status=u,o(u!=0?null:s.imp.value())})})}}class MrxDbgUiPrInt extends MrxDbgUiPrBase{constructor(){var r;super(new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().getMrxDbgUiPrIntClass()))}value(){return this.imp.value()}go(r){let s=this;return r?(s.imp.go(o=>{s.status=o,r(o)}),new Promise((o,v)=>{o(null)})):new Promise((o,v)=>{s.imp.go(u=>{s.status=u,o(u!=0?null:s.imp.value())})})}}class MrxDbgUiPrString extends MrxDbgUiPrBase{constructor(){var r;super(new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().getMrxDbgUiPrStringClass()))}value(){return this.imp.value()}go(r){let s=this;return r?(s.imp.go(o=>{s.status=o,r(o)}),new Promise((o,v)=>{o(null)})):new Promise((o,v)=>{s.imp.go(u=>{s.status=u,o(u!=0?null:s.imp.value())})})}}class MrxDbgUiPrKeyWord extends MrxDbgUiPrBase{constructor(){var r;super(new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().getMrxDbgUiPrKeyWordClass()))}go(r){let s=this;return r?(s.imp.go(o=>{s.status=o,r(o)}),new Promise((o,v)=>{o(null)})):new Promise((o,v)=>{s.imp.go(u=>{s.status=u,o(u!=0?null:s.keyWordPicked())})})}}class MrxDbgUiPrAngle extends MrxDbgUiPrBase{constructor(){var r;super(new((r=store.state.MxFun)===null||r===void 0?void 0:r.getMxJigCmdManager().getMrxDbgUiPrAngleClass()))}value(){return this.imp.value()}basePt(){return this.imp.basePt()}setBasePt(r){return this.imp.setBasePt(r)}setUseBasePt(r){return this.imp.setUseBasePt(r)}go(r){let s=this;return r?(s.imp.go(o=>{s.status=o,r(o)}),new Promise((o,v)=>{o(null)})):new Promise((o,v)=>{s.imp.go(u=>{s.status=u,o(u!=0?null:s.imp.value())})})}}var Mx=Object.freeze({__proto__:null,loadCoreCode,useCanvasResizeListener,store,MxFun,MxThreeJS,MxType,Mxassembly,McGeTool,MrxDbgUtils,MxPaintBrush,MrxDbgUiPrPoint,McEdGetPointWorldDrawObject,MrxDbgUiPrBaseReturn:MrxDbgUiPrBaseReturn$1,MxDbEntity,MxDbImage,MxDbSVG,MxDbSVGText,MxDbPolyline,MxDb2LineAngularDimension,Mx3PointArc,Mx2PointArc,MxDbCoord,MxDbLine,MxDbRect,MxDbAlignedDimension,MxFilters,McGiWorldDrawType:McGiWorldDrawType$1,MxDbArea,MxDbLeadTag,MxDbAnyLine,MxDbCloudLine,MxDbRegularPolygon,MxDbLeadComment,MxDbRectBoxLeadComment,MxDbEllipse,MxDbText,MxDrawObject,MxDbHatch,MxDbDatabase,MxDbGradientLine,MxDbShape,MxDbEllipseShape,MxDbEllipseArc,MxDbCircleShape,MxDbCircleArc,MxDbArcShapeDraw,MxDbRingShape,MxDbStarShape,MxDbRegularPolygonShape,MxDbArrow,MxDbLineShape,Layer,MxDbSplineCurve,MrxDbgUiPrBase,get MxCursorType(){return MxCursorType},get DetailedResult(){return DetailedResult},get DynamicInputType(){return DynamicInputType},get UserInputControls(){return UserInputControls},MrxDbgUiPrDist,MrxDbgUiPrInt,MrxDbgUiPrString,MrxDbgUiPrKeyWord,MrxDbgUiPrAngle}),elementResizeEventPolyfill_umd_min=createCommonjsModule(function(b,r){b.exports=function(s){var o={};function v(u){if(o[u])return o[u].exports;var w=o[u]={i:u,l:!1,exports:{}};return s[u].call(w.exports,w,w.exports,v),w.l=!0,w.exports}return v.m=s,v.c=o,v.d=function(u,w,L){v.o(u,w)||Object.defineProperty(u,w,{enumerable:!0,get:L})},v.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},v.t=function(u,w){if(1&w&&(u=v(u)),8&w||4&w&&typeof u=="object"&&u&&u.__esModule)return u;var L=Object.create(null);if(v.r(L),Object.defineProperty(L,"default",{enumerable:!0,value:u}),2&w&&typeof u!="string")for(var U in u)v.d(L,U,function(N){return u[N]}.bind(null,U));return L},v.n=function(u){var w=u&&u.__esModule?function(){return u.default}:function(){return u};return v.d(w,"a",w),w},v.o=function(u,w){return Object.prototype.hasOwnProperty.call(u,w)},v.p="",v(v.s="fae3")}({"6dd8":function(s,o,v){(function(u){var w=function(){if(typeof Map<"u")return Map;function q(V,ne){var ie=-1;return V.some(function(he,be){return he[0]===ne&&(ie=be,!0)}),ie}return function(){function V(){this.__entries__=[]}return Object.defineProperty(V.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),V.prototype.get=function(ne){var ie=q(this.__entries__,ne),he=this.__entries__[ie];return he&&he[1]},V.prototype.set=function(ne,ie){var he=q(this.__entries__,ne);~he?this.__entries__[he][1]=ie:this.__entries__.push([ne,ie])},V.prototype.delete=function(ne){var ie=this.__entries__,he=q(ie,ne);~he&&ie.splice(he,1)},V.prototype.has=function(ne){return!!~q(this.__entries__,ne)},V.prototype.clear=function(){this.__entries__.splice(0)},V.prototype.forEach=function(ne,ie){ie===void 0&&(ie=null);for(var he=0,be=this.__entries__;he<be.length;he++){var je=be[he];ne.call(ie,je[1],je[0])}},V}()}(),L=typeof window<"u"&&typeof document<"u"&&window.document===document,U=u!==void 0&&u.Math===Math?u:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")(),N=typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(U):function(q){return setTimeout(function(){return q(Date.now())},1e3/60)},D=2,f=20,P=["top","right","bottom","left","width","height","size","weight"],T=typeof MutationObserver<"u",B=function(){function q(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(V,ne){var ie=!1,he=!1,be=0;function je(){ie&&(ie=!1,V()),he&&Fe()}function xe(){N(je)}function Fe(){var J=Date.now();if(ie){if(J-be<D)return;he=!0}else ie=!0,he=!1,setTimeout(xe,ne);be=J}return Fe}(this.refresh.bind(this),f)}return q.prototype.addObserver=function(V){~this.observers_.indexOf(V)||this.observers_.push(V),this.connected_||this.connect_()},q.prototype.removeObserver=function(V){var ne=this.observers_,ie=ne.indexOf(V);~ie&&ne.splice(ie,1),!ne.length&&this.connected_&&this.disconnect_()},q.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},q.prototype.updateObservers_=function(){var V=this.observers_.filter(function(ne){return ne.gatherActive(),ne.hasActive()});return V.forEach(function(ne){return ne.broadcastActive()}),V.length>0},q.prototype.connect_=function(){L&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),T?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},q.prototype.disconnect_=function(){L&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},q.prototype.onTransitionEnd_=function(V){var ne=V.propertyName,ie=ne===void 0?"":ne;P.some(function(he){return!!~ie.indexOf(he)})&&this.refresh()},q.getInstance=function(){return this.instance_||(this.instance_=new q),this.instance_},q.instance_=null,q}(),G=function(q,V){for(var ne=0,ie=Object.keys(V);ne<ie.length;ne++){var he=ie[ne];Object.defineProperty(q,he,{value:V[he],enumerable:!1,writable:!1,configurable:!0})}return q},R=function(q){return q&&q.ownerDocument&&q.ownerDocument.defaultView||U},_=F(0,0,0,0);function ee(q){return parseFloat(q)||0}function k(q){for(var V=[],ne=1;ne<arguments.length;ne++)V[ne-1]=arguments[ne];return V.reduce(function(ie,he){return ie+ee(q["border-"+he+"-width"])},0)}function E(q){var V=q.clientWidth,ne=q.clientHeight;if(!V&&!ne)return _;var ie=R(q).getComputedStyle(q),he=function(oe){for(var le={},Re=0,Ye=["top","right","bottom","left"];Re<Ye.length;Re++){var Be=Ye[Re],se=oe["padding-"+Be];le[Be]=ee(se)}return le}(ie),be=he.left+he.right,je=he.top+he.bottom,xe=ee(ie.width),Fe=ee(ie.height);if(ie.boxSizing==="border-box"&&(Math.round(xe+be)!==V&&(xe-=k(ie,"left","right")+be),Math.round(Fe+je)!==ne&&(Fe-=k(ie,"top","bottom")+je)),!function(oe){return oe===R(oe).document.documentElement}(q)){var J=Math.round(xe+be)-V,ge=Math.round(Fe+je)-ne;Math.abs(J)!==1&&(xe-=J),Math.abs(ge)!==1&&(Fe-=ge)}return F(he.left,he.top,xe,Fe)}var W=typeof SVGGraphicsElement<"u"?function(q){return q instanceof R(q).SVGGraphicsElement}:function(q){return q instanceof R(q).SVGElement&&typeof q.getBBox=="function"};function C(q){return L?W(q)?function(V){var ne=V.getBBox();return F(0,0,ne.width,ne.height)}(q):E(q):_}function F(q,V,ne,ie){return{x:q,y:V,width:ne,height:ie}}var M=function(){function q(V){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=F(0,0,0,0),this.target=V}return q.prototype.isActive=function(){var V=C(this.target);return this.contentRect_=V,V.width!==this.broadcastWidth||V.height!==this.broadcastHeight},q.prototype.broadcastRect=function(){var V=this.contentRect_;return this.broadcastWidth=V.width,this.broadcastHeight=V.height,V},q}(),a=function(){return function(q,V){var ne=function(ie){var he=ie.x,be=ie.y,je=ie.width,xe=ie.height,Fe=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,J=Object.create(Fe.prototype);return G(J,{x:he,y:be,width:je,height:xe,top:be,right:he+je,bottom:xe+be,left:he}),J}(V);G(this,{target:q,contentRect:ne})}}(),h=function(){function q(V,ne,ie){if(this.activeObservations_=[],this.observations_=new w,typeof V!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=V,this.controller_=ne,this.callbackCtx_=ie}return q.prototype.observe=function(V){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(typeof Element<"u"&&Element instanceof Object){if(!(V instanceof R(V).Element))throw new TypeError('parameter 1 is not of type "Element".');var ne=this.observations_;ne.has(V)||(ne.set(V,new M(V)),this.controller_.addObserver(this),this.controller_.refresh())}},q.prototype.unobserve=function(V){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(typeof Element<"u"&&Element instanceof Object){if(!(V instanceof R(V).Element))throw new TypeError('parameter 1 is not of type "Element".');var ne=this.observations_;ne.has(V)&&(ne.delete(V),ne.size||this.controller_.removeObserver(this))}},q.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},q.prototype.gatherActive=function(){var V=this;this.clearActive(),this.observations_.forEach(function(ne){ne.isActive()&&V.activeObservations_.push(ne)})},q.prototype.broadcastActive=function(){if(this.hasActive()){var V=this.callbackCtx_,ne=this.activeObservations_.map(function(ie){return new a(ie.target,ie.broadcastRect())});this.callback_.call(V,ne,V),this.clearActive()}},q.prototype.clearActive=function(){this.activeObservations_.splice(0)},q.prototype.hasActive=function(){return this.activeObservations_.length>0},q}(),y=typeof WeakMap<"u"?new WeakMap:new w,j=function(){return function q(V){if(!(this instanceof q))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var ne=B.getInstance(),ie=new h(V,ne,this);y.set(this,ie)}}();["observe","unobserve","disconnect"].forEach(function(q){j.prototype[q]=function(){var V;return(V=y.get(this))[q].apply(V,arguments)}});var Y=U.ResizeObserver!==void 0?U.ResizeObserver:j;o.a=Y}).call(this,v("c8ba"))},c8ba:function(s,o){var v;v=function(){return this}();try{v=v||new Function("return this")()}catch{typeof window=="object"&&(v=window)}s.exports=v},f6fd:function(s,o){(function(v){var u="currentScript",w=v.getElementsByTagName("script");u in v||Object.defineProperty(v,u,{get:function(){try{throw new Error}catch(N){var L,U=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(N.stack)||[!1])[1];for(L in w)if(w[L].src==U||w[L].readyState=="interactive")return w[L];return null}}})})(document)},fae3:function(s,o,v){var u;v.r(o),v.d(o,"EventListenerWrapper",function(){return N}),typeof window<"u"&&(v("f6fd"),(u=window.document.currentScript)&&(u=u.src.match(/(.+\/)[^/]+\.js(\?.*)?$/))&&(v.p=u[1]));var w=v("6dd8");const L=EventTarget.prototype.addEventListener,U=function(P){const T=document.createEvent("HTMLEvents");return T.initEvent(P),T},N=function(P){P==="resize"&&f(this),L.apply(this,arguments)};function D(P){const T=D.observer=D.observer||new w.a(P);return T.initialized=!0,T}function f(P){const T=D(B=>{if(T.initialized)T.initialized=!1;else for(let G of B){const R=U("resize");G.target.dispatchEvent(R),G&&G.target&&typeof G.target.onresize=="function"&&G.target.onresize(R)}});T.observe(P)}HTMLElement.prototype.addEventListener=N,Reflect.defineProperty(HTMLElement.prototype,"onresize",{set(P){this._onresize=P,typeof P=="function"&&f(this)},get(){return this._onresize||null}})}})}),elementResizeEventPolyfill_umd_min$1=unwrapExports(elementResizeEventPolyfill_umd_min),elementResizeEventPolyfill_umd_min$2=Object.freeze({__proto__:null,default:elementResizeEventPolyfill_umd_min$1,__moduleExports:elementResizeEventPolyfill_umd_min});export{DetailedResult,DynamicInputType,Layer,McEdGetPointWorldDrawObject,McGeTool,McGiWorldDrawType$1 as McGiWorldDrawType,MrxDbgUiPrAngle,MrxDbgUiPrBase,MrxDbgUiPrBaseReturn$1 as MrxDbgUiPrBaseReturn,MrxDbgUiPrDist,MrxDbgUiPrInt,MrxDbgUiPrKeyWord,MrxDbgUiPrPoint,MrxDbgUiPrString,MrxDbgUtils,Mx2PointArc,Mx3PointArc,MxCursorType,MxDb2LineAngularDimension,MxDbAlignedDimension,MxDbAnyLine,MxDbArcShapeDraw,MxDbArea,MxDbArrow,MxDbCircleArc,MxDbCircleShape,MxDbCloudLine,MxDbCoord,MxDbDatabase,MxDbEllipse,MxDbEllipseArc,MxDbEllipseShape,MxDbEntity,MxDbGradientLine,MxDbHatch,MxDbImage,MxDbLeadComment,MxDbLeadTag,MxDbLine,MxDbLineShape,MxDbPolyline,MxDbRect,MxDbRectBoxLeadComment,MxDbRegularPolygon,MxDbRegularPolygonShape,MxDbRingShape,MxDbSVG,MxDbSVGText,MxDbShape,MxDbSplineCurve,MxDbStarShape,MxDbText,MxDrawObject,MxFilters,MxFun,MxPaintBrush,MxThreeJS,MxType,Mxassembly,UserInputControls,Mx as default,loadCoreCode,store,useCanvasResizeListener};
